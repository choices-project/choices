{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/jest.setup.js"],"sourcesContent":["/**\n * Jest Setup - Simple and Clean\n * \n * This setup file provides minimal configuration for testing.\n * We use real Supabase credentials and real test users instead of complex mocks.\n */\n\n// Import testing library matchers\nrequire('@testing-library/jest-dom');\n\n// Load environment variables from .env.local\nrequire('dotenv').config({ path: '.env.local' });\n\n// Simple environment setup for testing\nprocess.env.NODE_ENV = 'test';\nprocess.env.NEXTAUTH_SECRET = 'test-secret';\nprocess.env.NEXTAUTH_URL = 'http://localhost:3000';\n\n// Set up privacy pepper environment variables for testing\nprocess.env.PRIVACY_PEPPER_DEV = 'dev-pepper-consistent-for-testing-12345678901234567890';\nprocess.env.PRIVACY_PEPPER_CURRENT = 'hex:' + 'ab'.repeat(32);\n\n// Browser API mocks (only for jsdom environment)\nif (typeof window !== 'undefined') {\n  // Mock window.matchMedia for responsive components\n  Object.defineProperty(window, 'matchMedia', {\n    writable: true,\n    value: jest.fn().mockImplementation(query => ({\n      matches: false,\n      media: query,\n      onchange: null,\n      addListener: jest.fn(),\n      removeListener: jest.fn(),\n      addEventListener: jest.fn(),\n      removeEventListener: jest.fn(),\n      dispatchEvent: jest.fn(),\n    })),\n  });\n\n  // Mock navigator.onLine for offline functionality\n  Object.defineProperty(navigator, 'onLine', {\n    writable: true,\n    value: true,\n  });\n\n  // Mock service worker\n  Object.defineProperty(navigator, 'serviceWorker', {\n    writable: true,\n    value: {\n      register: jest.fn(() => Promise.resolve()),\n      ready: Promise.resolve(),\n    },\n  });\n\n  // Mock PushManager\n  Object.defineProperty(window, 'PushManager', {\n    writable: true,\n    value: {\n      supportedContentEncodings: ['aesgcm'],\n    },\n  });\n\n  // Mock Notification\n  Object.defineProperty(window, 'Notification', {\n    writable: true,\n    value: class Notification {\n      constructor(title, options = {}) {\n        this.title = title;\n        this.options = options;\n      }\n      \n      static requestPermission = jest.fn(() => Promise.resolve('granted'));\n      static permission = 'granted';\n    },\n  });\n\n  // Mock IntersectionObserver for components using infinite scroll\n  if (typeof window.IntersectionObserver === 'undefined') {\n    class MockIntersectionObserver {\n      constructor(callback, options) {\n        this.callback = callback;\n        this.options = options;\n      }\n      observe() {}\n      unobserve() {}\n      disconnect() {}\n      takeRecords() { return []; }\n    }\n    Object.defineProperty(window, 'IntersectionObserver', {\n      writable: true,\n      configurable: true,\n      value: MockIntersectionObserver,\n    });\n  }\n}\n\n// Enhanced fetch polyfill for Node.js (for Supabase compatibility)\nif (typeof global.fetch === 'undefined') {\n  // Create a comprehensive fetch mock that works with Supabase\n  global.fetch = jest.fn().mockImplementation(async (url, options = {}) => {\n    // Mock successful response for Supabase requests\n    const mockResponse = {\n      ok: true,\n      status: 200,\n      statusText: 'OK',\n      headers: new Map([\n        ['content-type', 'application/json']\n      ]),\n      json: async () => ({ data: [], error: null }),\n      text: async () => '{\"data\":[],\"error\":null}',\n      url: url,\n      type: 'basic',\n      redirected: false,\n      clone: () => global.fetch(url, options)\n    };\n    \n    return Promise.resolve(mockResponse);\n  });\n}\n\n// Simple Response polyfill for Node.js (minimal)\nif (typeof global.Response === 'undefined') {\n  global.Response = class Response {\n    constructor(body, options = {}) {\n      this.body = body;\n      this.status = options.status || 200;\n      this.statusText = options.statusText || 'OK';\n      this.headers = new Map();\n      if (options.headers) {\n        Object.entries(options.headers).forEach(([key, value]) => {\n          this.headers.set(key.toLowerCase(), value);\n        });\n      }\n    }\n\n    async json() {\n      return JSON.parse(this.body || '{}');\n    }\n\n    async text() {\n      return this.body || '';\n    }\n\n    static json(data, options = {}) {\n      return new Response(JSON.stringify(data), {\n        ...options,\n        headers: {\n          'Content-Type': 'application/json',\n          ...options.headers\n        }\n      });\n    }\n  };\n}\n\n// Simple Headers polyfill for Node.js (minimal)\nif (typeof global.Headers === 'undefined') {\n  global.Headers = class Headers {\n    constructor(init = {}) {\n      this.map = new Map();\n      if (init) {\n        Object.entries(init).forEach(([key, value]) => {\n          this.map.set(key.toLowerCase(), value);\n        });\n      }\n    }\n\n    get(name) {\n      return this.map.get(name.toLowerCase());\n    }\n\n    set(name, value) {\n      this.map.set(name.toLowerCase(), value);\n    }\n\n    has(name) {\n      return this.map.has(name.toLowerCase());\n    }\n\n    delete(name) {\n      this.map.delete(name.toLowerCase());\n    }\n  };\n}\n\n// Simple Request polyfill for Node.js (minimal)\nif (typeof global.Request === 'undefined') {\n  global.Request = class Request {\n    constructor(input, init = {}) {\n      // Use Object.defineProperty to make url writable\n      Object.defineProperty(this, 'url', {\n        value: input,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n      this.method = init.method || 'GET';\n      this.headers = new Headers(init.headers);\n      this.body = init.body;\n    }\n  };\n}\n\n// TextEncoder/TextDecoder polyfills for Node.js\nif (typeof global.TextEncoder === 'undefined') {\n  const { TextEncoder, TextDecoder } = require('util');\n  global.TextEncoder = TextEncoder;\n  global.TextDecoder = TextDecoder;\n}\n\n// Mock Next.js router\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    prefetch: jest.fn(),\n    back: jest.fn(),\n    forward: jest.fn(),\n    refresh: jest.fn(),\n    pathname: '/',\n    route: '/',\n    query: {},\n    asPath: '/',\n  }),\n  usePathname: () => '/',\n  useSearchParams: () => new URLSearchParams(),\n}));\n\n// Per-suite mocks should be declared within tests. Avoid global virtual mocks for app modules.\n\n// Enhanced fetch polyfill for Node.js (for Supabase compatibility)\nif (typeof global.fetch === 'undefined') {\n  // Create a comprehensive fetch mock that works with Supabase\n  global.fetch = jest.fn().mockImplementation(async (url, options = {}) => {\n    // Mock successful response for Supabase requests\n    const mockResponse = {\n      ok: true,\n      status: 200,\n      statusText: 'OK',\n      headers: new Map([\n        ['content-type', 'application/json']\n      ]),\n      json: async () => ({ data: [], error: null }),\n      text: async () => '{\"data\":[],\"error\":null}',\n      url: url,\n      type: 'basic',\n      redirected: false,\n      clone: () => global.fetch(url, options)\n    };\n    \n    return Promise.resolve(mockResponse);\n  });\n}\n\n// lucide-react is mocked via moduleNameMapper in jest.config.js"],"names":["jest","mock","useRouter","push","fn","replace","prefetch","back","forward","refresh","pathname","route","query","asPath","usePathname","useSearchParams","URLSearchParams","require","config","path","process","env","NODE_ENV","NEXTAUTH_SECRET","NEXTAUTH_URL","PRIVACY_PEPPER_DEV","PRIVACY_PEPPER_CURRENT","repeat","window","Object","defineProperty","writable","value","mockImplementation","matches","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent","navigator","register","Promise","resolve","ready","supportedContentEncodings","Notification","title","options","requestPermission","permission","IntersectionObserver","MockIntersectionObserver","callback","observe","unobserve","disconnect","takeRecords","configurable","global","fetch","url","mockResponse","ok","status","statusText","headers","Map","json","data","error","text","type","redirected","clone","Response","body","entries","forEach","key","set","toLowerCase","JSON","parse","stringify","Headers","init","map","get","name","has","delete","Request","input","enumerable","method","TextEncoder","TextDecoder"],"mappings":"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"}
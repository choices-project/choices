{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/test-admin-client.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\n\n/**\n * Test Admin Client Approach\n * \n * Tests database access using the admin client approach from server utils\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Test Admin Client Approach', () => {\n  it('should test database access using admin client approach', async () => {\n    // Use same approach as server utils\n    const { createClient } = await import('@supabase/supabase-js');\n    \n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SECRET_KEY!,\n      {\n        auth: {\n          autoRefreshToken: false,\n          persistSession: false\n        }\n      }\n    );\n    \n    console.log('üîç Testing database access using admin client approach...');\n    console.log('Supabase URL:', process.env.NEXT_PUBLIC_SUPABASE_URL);\n    console.log('Supabase Key (first 10 chars):', process.env.SUPABASE_SECRET_KEY?.substring(0, 10));\n    \n    // Test 1: Query polls table\n    console.log('üîç Test 1: Query polls table');\n    const { data: polls, error: pollsError } = await supabase\n      .from('polls')\n      .select('id, title, description, privacy_level, status')\n      .limit(5);\n    \n    console.log('Polls result:', { polls, pollsError });\n    \n    // Test 2: Get polls count\n    console.log('üîç Test 2: Get polls count');\n    const { count: pollsCount, error: pollsCountError } = await supabase\n      .from('polls')\n      .select('*', { count: 'exact', head: true });\n    \n    console.log('Polls count result:', { pollsCount, pollsCountError });\n    \n    // Test 3: Insert a test poll\n    console.log('üîç Test 3: Insert test poll');\n    const testPoll = {\n      title: 'Test Poll from Admin Client',\n      description: 'Testing database access using admin client approach',\n      options: ['Option 1', 'Option 2', 'Option 3'],\n      voting_method: 'single_choice',\n      status: 'active',\n      created_by: '00000000-0000-0000-0000-000000000001',\n      privacy_level: 'public',\n      category: 'test',\n      tags: ['test', 'admin-client'],\n      hashtags: ['test', 'admin-client'],\n      primary_hashtag: 'test'\n    };\n    \n    const { data: insertedPoll, error: insertError } = await supabase\n      .from('polls')\n      .insert(testPoll)\n      .select();\n    \n    console.log('Insert poll result:', { insertedPoll, insertError });\n    \n    // Test 4: Query the inserted poll\n    if (insertedPoll && insertedPoll.length > 0) {\n      console.log('üîç Test 4: Query inserted poll');\n      const { data: queriedPoll, error: queryError } = await supabase\n        .from('polls')\n        .select('*')\n        .eq('id', insertedPoll[0].id);\n      \n      console.log('Query inserted poll result:', { queriedPoll, queryError });\n      \n      // Clean up - delete the test poll\n      console.log('üîç Cleanup: Delete test poll');\n      const { error: deleteError } = await supabase\n        .from('polls')\n        .delete()\n        .eq('id', insertedPoll[0].id);\n      \n      console.log('Delete poll result:', { deleteError });\n    }\n    \n    // Test 5: Test with different privacy levels\n    console.log('üîç Test 5: Test different privacy levels');\n    const { data: publicPolls, error: publicPollsError } = await supabase\n      .from('polls')\n      .select('id, title, privacy_level')\n      .eq('privacy_level', 'public')\n      .limit(3);\n    \n    console.log('Public polls result:', { publicPolls, publicPollsError });\n    \n    // Test 6: Test with different statuses\n    console.log('üîç Test 6: Test different statuses');\n    const { data: activePolls, error: activePollsError } = await supabase\n      .from('polls')\n      .select('id, title, status')\n      .eq('status', 'active')\n      .limit(3);\n    \n    console.log('Active polls result:', { activePolls, activePollsError });\n    \n    // Test 7: Test with different created_by values\n    console.log('üîç Test 7: Test different created_by values');\n    const { data: userPolls, error: userPollsError } = await supabase\n      .from('polls')\n      .select('id, title, created_by')\n      .eq('created_by', '00000000-0000-0000-0000-000000000001')\n      .limit(3);\n    \n    console.log('User polls result:', { userPolls, userPollsError });\n    \n    // Test 8: Test with different categories\n    console.log('üîç Test 8: Test different categories');\n    const { data: categoryPolls, error: categoryPollsError } = await supabase\n      .from('polls')\n      .select('id, title, category')\n      .eq('category', 'technology')\n      .limit(3);\n    \n    console.log('Category polls result:', { categoryPolls, categoryPollsError });\n    \n    // Test 9: Test with different voting methods\n    console.log('üîç Test 9: Test different voting methods');\n    const { data: votingMethodPolls, error: votingMethodPollsError } = await supabase\n      .from('polls')\n      .select('id, title, voting_method')\n      .eq('voting_method', 'single_choice')\n      .limit(3);\n    \n    console.log('Voting method polls result:', { votingMethodPolls, votingMethodPollsError });\n    \n    // Test 10: Test with different statuses\n    console.log('üîç Test 10: Test different statuses');\n    const { data: statusPolls, error: statusPollsError } = await supabase\n      .from('polls')\n      .select('id, title, status')\n      .eq('status', 'active')\n      .limit(3);\n    \n    console.log('Status polls result:', { statusPolls, statusPollsError });\n    \n    // The test should pass if we can access the database\n    expect(pollsError).toBeNull();\n    expect(pollsCountError).toBeNull();\n    expect(insertError).toBeNull();\n    expect(publicPollsError).toBeNull();\n    expect(activePollsError).toBeNull();\n    expect(userPollsError).toBeNull();\n    expect(categoryPollsError).toBeNull();\n    expect(votingMethodPollsError).toBeNull();\n    expect(statusPollsError).toBeNull();\n  });\n});\n"],"names":["describe","it","createClient","supabase","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SECRET_KEY","auth","autoRefreshToken","persistSession","console","log","substring","data","polls","error","pollsError","from","select","limit","count","pollsCount","pollsCountError","head","testPoll","title","description","options","voting_method","status","created_by","privacy_level","category","tags","hashtags","primary_hashtag","insertedPoll","insertError","insert","length","queriedPoll","queryError","eq","id","deleteError","delete","publicPolls","publicPollsError","activePolls","activePollsError","userPolls","userPollsError","categoryPolls","categoryPollsError","votingMethodPolls","votingMethodPollsError","statusPolls","statusPollsError","expect","toBeNull"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/test-rest-api.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\n\n/**\n * Test REST API Approach\n * \n * Tests database access using direct REST API calls (like curl)\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Test REST API Approach', () => {\n  it('should test database access using REST API', async () => {\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.SUPABASE_SECRET_KEY;\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    console.log('üîç Testing database access using REST API...');\n    console.log('Supabase URL:', supabaseUrl);\n    console.log('Supabase Key (first 10 chars):', supabaseKey.substring(0, 10));\n    \n    // Test 1: Query polls using REST API\n    console.log('üîç Test 1: Query polls using REST API');\n    const pollsResponse = await fetch(`${supabaseUrl}/rest/v1/polls?select=id,title,description,privacy_level,status&limit=5`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    const pollsData = await pollsResponse.json();\n    console.log('Polls REST API result:', { pollsData, status: pollsResponse.status });\n    \n    // Test 2: Get polls count using REST API\n    console.log('üîç Test 2: Get polls count using REST API');\n    const countResponse = await fetch(`${supabaseUrl}/rest/v1/polls?select=id&limit=1`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json',\n        'Prefer': 'count=exact'\n      }\n    });\n    \n    const countHeader = countResponse.headers.get('content-range');\n    console.log('Polls count REST API result:', { countHeader, status: countResponse.status });\n    \n    // Test 3: Insert a test poll using REST API\n    console.log('üîç Test 3: Insert test poll using REST API');\n    const testPoll = {\n      title: 'Test Poll from REST API',\n      description: 'Testing database access using REST API approach',\n      options: ['Option 1', 'Option 2', 'Option 3'],\n      voting_method: 'single_choice',\n      status: 'active',\n      created_by: '00000000-0000-0000-0000-000000000001',\n      privacy_level: 'public',\n      category: 'test',\n      tags: ['test', 'rest-api'],\n      hashtags: ['test', 'rest-api'],\n      primary_hashtag: 'test'\n    };\n    \n    const insertResponse = await fetch(`${supabaseUrl}/rest/v1/polls`, {\n      method: 'POST',\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json',\n        'Prefer': 'return=representation'\n      },\n      body: JSON.stringify(testPoll)\n    });\n    \n    const insertData = await insertResponse.json();\n    console.log('Insert poll REST API result:', { insertData, status: insertResponse.status });\n    \n    // Test 4: Query the inserted poll using REST API\n    if (insertData && insertData.length > 0) {\n      console.log('üîç Test 4: Query inserted poll using REST API');\n      const queryResponse = await fetch(`${supabaseUrl}/rest/v1/polls?id=eq.${insertData[0].id}`, {\n        headers: {\n          'apikey': supabaseKey,\n          'Authorization': `Bearer ${supabaseKey}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      const queryData = await queryResponse.json();\n      console.log('Query inserted poll REST API result:', { queryData, status: queryResponse.status });\n      \n      // Clean up - delete the test poll using REST API\n      console.log('üîç Cleanup: Delete test poll using REST API');\n      const deleteResponse = await fetch(`${supabaseUrl}/rest/v1/polls?id=eq.${insertData[0].id}`, {\n        method: 'DELETE',\n        headers: {\n          'apikey': supabaseKey,\n          'Authorization': `Bearer ${supabaseKey}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      console.log('Delete poll REST API result:', { status: deleteResponse.status });\n    }\n    \n    // Test 5: Test with different privacy levels using REST API\n    console.log('üîç Test 5: Test different privacy levels using REST API');\n    const publicPollsResponse = await fetch(`${supabaseUrl}/rest/v1/polls?privacy_level=eq.public&select=id,title,privacy_level&limit=3`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    const publicPollsData = await publicPollsResponse.json();\n    console.log('Public polls REST API result:', { publicPollsData, status: publicPollsResponse.status });\n    \n    // Test 6: Test with different statuses using REST API\n    console.log('üîç Test 6: Test different statuses using REST API');\n    const activePollsResponse = await fetch(`${supabaseUrl}/rest/v1/polls?status=eq.active&select=id,title,status&limit=3`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    const activePollsData = await activePollsResponse.json();\n    console.log('Active polls REST API result:', { activePollsData, status: activePollsResponse.status });\n    \n    // Test 7: Test with different created_by values using REST API\n    console.log('üîç Test 7: Test different created_by values using REST API');\n    const userPollsResponse = await fetch(`${supabaseUrl}/rest/v1/polls?created_by=eq.00000000-0000-0000-0000-000000000001&select=id,title,created_by&limit=3`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    const userPollsData = await userPollsResponse.json();\n    console.log('User polls REST API result:', { userPollsData, status: userPollsResponse.status });\n    \n    // Test 8: Test with different categories using REST API\n    console.log('üîç Test 8: Test different categories using REST API');\n    const categoryPollsResponse = await fetch(`${supabaseUrl}/rest/v1/polls?category=eq.technology&select=id,title,category&limit=3`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    const categoryPollsData = await categoryPollsResponse.json();\n    console.log('Category polls REST API result:', { categoryPollsData, status: categoryPollsResponse.status });\n    \n    // Test 9: Test with different voting methods using REST API\n    console.log('üîç Test 9: Test different voting methods using REST API');\n    const votingMethodPollsResponse = await fetch(`${supabaseUrl}/rest/v1/polls?voting_method=eq.single_choice&select=id,title,voting_method&limit=3`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    const votingMethodPollsData = await votingMethodPollsResponse.json();\n    console.log('Voting method polls REST API result:', { votingMethodPollsData, status: votingMethodPollsResponse.status });\n    \n    // Test 10: Test with different statuses using REST API\n    console.log('üîç Test 10: Test different statuses using REST API');\n    const statusPollsResponse = await fetch(`${supabaseUrl}/rest/v1/polls?status=eq.active&select=id,title,status&limit=3`, {\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': `Bearer ${supabaseKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    const statusPollsData = await statusPollsResponse.json();\n    console.log('Status polls REST API result:', { statusPollsData, status: statusPollsResponse.status });\n    \n    // The test should pass if we can access the database\n    expect(pollsResponse.status).toBe(200);\n    expect(countResponse.status).toBe(200);\n    expect(insertResponse.status).toBe(201);\n    expect(publicPollsResponse.status).toBe(200);\n    expect(activePollsResponse.status).toBe(200);\n    expect(userPollsResponse.status).toBe(200);\n    expect(categoryPollsResponse.status).toBe(200);\n    expect(votingMethodPollsResponse.status).toBe(200);\n    expect(statusPollsResponse.status).toBe(200);\n    \n    // Verify we got actual data\n    expect(pollsData.length).toBeGreaterThan(0);\n    expect(publicPollsData.length).toBeGreaterThan(0);\n    expect(activePollsData.length).toBeGreaterThan(0);\n  });\n});\n"],"names":["describe","it","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","SUPABASE_SECRET_KEY","Error","console","log","substring","pollsResponse","fetch","headers","pollsData","json","status","countResponse","countHeader","get","testPoll","title","description","options","voting_method","created_by","privacy_level","category","tags","hashtags","primary_hashtag","insertResponse","method","body","JSON","stringify","insertData","length","queryResponse","id","queryData","deleteResponse","publicPollsResponse","publicPollsData","activePollsResponse","activePollsData","userPollsResponse","userPollsData","categoryPollsResponse","categoryPollsData","votingMethodPollsResponse","votingMethodPollsData","statusPollsResponse","statusPollsData","expect","toBe","toBeGreaterThan"],"mappings":"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"}
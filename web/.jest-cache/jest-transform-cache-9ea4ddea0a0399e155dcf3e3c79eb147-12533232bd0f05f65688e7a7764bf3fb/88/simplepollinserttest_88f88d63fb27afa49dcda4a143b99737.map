{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/simple-poll-insert.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\n\n/**\n * Simple Poll Insert Test\n * \n * Tests inserting a simple poll to debug database issues\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Simple Poll Insert', () => {\n  it('should insert a minimal poll successfully', async () => {\n    const { createClient } = await import('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SECRET_KEY;\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    const supabase = createClient(supabaseUrl, supabaseKey);\n    \n    console.log('üîç Testing minimal poll insert...');\n    \n    // Try the simplest possible poll insert\n    const minimalPoll = {\n      title: 'Test Poll',\n      description: 'Test Description',\n      options: ['Option 1', 'Option 2'],\n      voting_method: 'single_choice',\n      status: 'active',\n      created_by: 'test-user',\n      privacy_level: 'public'\n    };\n    \n    console.log('Minimal poll data:', minimalPoll);\n    \n    const { data: insertResult, error: insertError } = await supabase\n      .from('polls')\n      .insert(minimalPoll)\n      .select();\n    \n    console.log('Insert result:', { insertResult, insertError });\n    \n    if (insertError) {\n      console.log('‚ùå Insert error:', insertError);\n      console.log('Error details:', {\n        message: insertError.message,\n        details: insertError.details,\n        hint: insertError.hint,\n        code: insertError.code\n      });\n    }\n    \n    expect(insertError).toBeNull();\n    expect(insertResult).toBeDefined();\n    \n    if (insertResult && insertResult.length > 0) {\n      console.log('‚úÖ Successfully inserted poll:', insertResult[0]);\n      \n      // Clean up\n      const { error: deleteError } = await supabase\n        .from('polls')\n        .delete()\n        .eq('id', insertResult[0].id);\n      \n      if (deleteError) {\n        console.log('‚ö†Ô∏è Could not clean up test poll:', deleteError);\n      } else {\n        console.log('üßπ Test poll cleaned up');\n      }\n    }\n  });\n  \n  it('should insert a poll with user_id', async () => {\n    const { createClient } = await import('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SECRET_KEY;\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    const supabase = createClient(supabaseUrl, supabaseKey);\n    \n    console.log('üîç Testing poll insert with user_id...');\n    \n    // Try with user_id\n    const pollWithUserId = {\n      title: 'Test Poll with User',\n      description: 'Test Description',\n      options: ['Option 1', 'Option 2'],\n      voting_method: 'single_choice',\n      status: 'active',\n      created_by: 'test-user',\n      user_id: '00000000-0000-0000-0000-000000000001',\n      privacy_level: 'public'\n    };\n    \n    console.log('Poll with user_id data:', pollWithUserId);\n    \n    const { data: insertResult, error: insertError } = await supabase\n      .from('polls')\n      .insert(pollWithUserId)\n      .select();\n    \n    console.log('Insert result:', { insertResult, insertError });\n    \n    if (insertError) {\n      console.log('‚ùå Insert error:', insertError);\n      console.log('Error details:', {\n        message: insertError.message,\n        details: insertError.details,\n        hint: insertError.hint,\n        code: insertError.code\n      });\n    }\n    \n    expect(insertError).toBeNull();\n    expect(insertResult).toBeDefined();\n    \n    if (insertResult && insertResult.length > 0) {\n      console.log('‚úÖ Successfully inserted poll with user_id:', insertResult[0]);\n      \n      // Clean up\n      const { error: deleteError } = await supabase\n        .from('polls')\n        .delete()\n        .eq('id', insertResult[0].id);\n      \n      if (deleteError) {\n        console.log('‚ö†Ô∏è Could not clean up test poll:', deleteError);\n      } else {\n        console.log('üßπ Test poll cleaned up');\n      }\n    }\n  });\n});\n"],"names":["describe","it","createClient","supabaseUrl","process","env","SUPABASE_URL","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","SUPABASE_SERVICE_ROLE_KEY","SUPABASE_SECRET_KEY","Error","supabase","console","log","minimalPoll","title","description","options","voting_method","status","created_by","privacy_level","data","insertResult","error","insertError","from","insert","select","message","details","hint","code","expect","toBeNull","toBeDefined","length","deleteError","delete","eq","id","pollWithUserId","user_id"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/database-seeding.test.ts"],"sourcesContent":["import { describe, it, expect, beforeAll, afterAll } from '@jest/globals';\nimport { seedTestPolls, seedTestVotes, cleanupTestData, getDatabaseStats } from '../helpers/seed-test-data';\n\n/**\n * Database Seeding Integration Test\n * \n * Tests the database seeding functionality and provides test data\n * for other integration tests.\n * \n * Created: January 27, 2025\n * Status: âœ… PRODUCTION READY\n */\n\ndescribe('Database Seeding Integration', () => {\n  let seededPollIds: string[] = [];\n\n  beforeAll(async () => {\n    console.log('ðŸš€ Starting database seeding test...');\n  });\n\n  afterAll(async () => {\n    console.log('ðŸ§¹ Cleaning up seeded test data...');\n    await cleanupTestData();\n  });\n\n  it('should seed test polls successfully', async () => {\n    console.log('ðŸŒ± Seeding test polls...');\n    \n    seededPollIds = await seedTestPolls();\n    \n    expect(seededPollIds).toBeDefined();\n    expect(seededPollIds.length).toBeGreaterThan(0);\n    expect(seededPollIds.length).toBe(6); // We expect 6 test polls\n    \n    console.log(`âœ… Successfully seeded ${seededPollIds.length} test polls`);\n  });\n\n  it('should seed test votes successfully', async () => {\n    console.log('ðŸ—³ï¸ Seeding test votes...');\n    \n    await seedTestVotes(seededPollIds);\n    \n    console.log('âœ… Successfully seeded test votes');\n  });\n\n  it('should verify database stats after seeding', async () => {\n    console.log('ðŸ“Š Checking database stats...');\n    \n    const stats = await getDatabaseStats();\n    \n    expect(stats.pollsCount).toBeGreaterThan(0);\n    expect(stats.votesCount).toBeGreaterThan(0);\n    expect(stats.activePolls).toBeGreaterThan(0);\n    \n    console.log('ðŸ“ˆ Database Stats:', {\n      polls: stats.pollsCount,\n      votes: stats.votesCount,\n      active: stats.activePolls,\n      closed: stats.closedPolls\n    });\n  });\n\n  it('should have polls with different types and statuses', async () => {\n    console.log('ðŸ” Verifying poll variety...');\n    \n    const { createClient } = await import('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    const supabase = createClient(supabaseUrl, supabaseKey);\n\n    const { data: polls, error } = await supabase\n      .from('polls')\n      .select('title, poll_type, status')\n      .in('id', seededPollIds);\n\n    expect(error).toBeNull();\n    expect(polls).toBeDefined();\n    expect(polls?.length).toBe(6);\n\n    // Check for different poll types\n    const pollTypes = polls?.map(p => p.poll_type) || [];\n    expect(pollTypes).toContain('single_choice');\n    expect(pollTypes).toContain('multiple_choice');\n    expect(pollTypes).toContain('ranked_choice');\n    expect(pollTypes).toContain('approval_voting');\n\n    // Check for different statuses\n    const statuses = polls?.map(p => p.status) || [];\n    expect(statuses).toContain('active');\n    expect(statuses).toContain('draft');\n    expect(statuses).toContain('closed');\n\n    console.log('âœ… Poll variety verified:', {\n      types: [...new Set(pollTypes)],\n      statuses: [...new Set(statuses)]\n    });\n  });\n});\n"],"names":["describe","seededPollIds","beforeAll","console","log","afterAll","cleanupTestData","it","seedTestPolls","expect","toBeDefined","length","toBeGreaterThan","toBe","seedTestVotes","stats","getDatabaseStats","pollsCount","votesCount","activePolls","polls","votes","active","closed","closedPolls","createClient","supabaseUrl","process","env","SUPABASE_URL","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","SUPABASE_ANON_KEY","NEXT_PUBLIC_SUPABASE_ANON_KEY","Error","supabase","data","error","from","select","in","toBeNull","pollTypes","map","p","poll_type","toContain","statuses","status","types","Set"],"mappings":"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"}
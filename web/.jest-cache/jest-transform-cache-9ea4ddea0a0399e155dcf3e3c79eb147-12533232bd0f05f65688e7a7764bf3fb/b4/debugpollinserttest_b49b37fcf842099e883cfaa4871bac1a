16342b60aef2f846986f9c448a6e252e
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
/**
 * Debug Poll Insert Test
 * 
 * Tests to debug why polls aren't being inserted/retrieved
 * 
 * Created: January 27, 2025
 * Status: ‚úÖ PRODUCTION READY
 */ (0, _globals.describe)('Debug Poll Insert', ()=>{
    (0, _globals.it)('should debug poll insertion step by step', async ()=>{
        const { createClient } = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("@supabase/supabase-js")));
        const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;
        const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SECRET_KEY;
        if (!supabaseUrl || !supabaseKey) {
            throw new Error('Supabase credentials not found');
        }
        const supabase = createClient(supabaseUrl, supabaseKey);
        console.log('üîç Step 1: Check if polls table exists...');
        // Try to query the polls table directly
        const { data: pollsData, error: pollsError } = await supabase.from('polls').select('*').limit(1);
        console.log('Polls table query result:', {
            pollsData,
            pollsError
        });
        if (pollsError) {
            console.log('‚ùå Polls table error:', pollsError.message);
            if (pollsError.message.includes('relation "polls" does not exist')) {
                console.log('‚ùå Polls table does not exist!');
                return;
            }
        } else {
            console.log('‚úÖ Polls table exists and is accessible');
        }
        console.log('üîç Step 2: Check polls table structure...');
        // Get table structure
        const { data: columns, error: columnsError } = await supabase.from('information_schema.columns').select('column_name, data_type, is_nullable').eq('table_name', 'polls').eq('table_schema', 'public');
        console.log('Polls table columns:', {
            columns,
            columnsError
        });
        console.log('üîç Step 3: Try to insert a minimal poll...');
        const minimalPoll = {
            title: 'Debug Test Poll',
            description: 'Debug Test Description',
            options: [
                'Option 1',
                'Option 2'
            ],
            voting_method: 'single_choice',
            status: 'active',
            created_by: 'debug-user',
            privacy_level: 'public'
        };
        console.log('Minimal poll data:', minimalPoll);
        const { data: insertResult, error: insertError } = await supabase.from('polls').insert(minimalPoll).select();
        console.log('Insert result:', {
            insertResult,
            insertError
        });
        if (insertError) {
            console.log('‚ùå Insert error details:', {
                message: insertError.message,
                details: insertError.details,
                hint: insertError.hint,
                code: insertError.code
            });
        }
        console.log('üîç Step 4: Query all polls to see what exists...');
        const { data: allPolls, error: queryError } = await supabase.from('polls').select('*');
        console.log('All polls query result:', {
            allPolls,
            queryError
        });
        console.log('üîç Step 5: Query specific poll by title...');
        const { data: specificPoll, error: specificError } = await supabase.from('polls').select('*').eq('title', 'Debug Test Poll');
        console.log('Specific poll query result:', {
            specificPoll,
            specificError
        });
        // The test should pass if we can at least connect and query
        (0, _globals.expect)(insertError).toBeNull();
        (0, _globals.expect)(queryError).toBeNull();
        (0, _globals.expect)(specificError).toBeNull();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L2ludGVncmF0aW9uL2RlYnVnLXBvbGwtaW5zZXJ0LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuLyoqXG4gKiBEZWJ1ZyBQb2xsIEluc2VydCBUZXN0XG4gKiBcbiAqIFRlc3RzIHRvIGRlYnVnIHdoeSBwb2xscyBhcmVuJ3QgYmVpbmcgaW5zZXJ0ZWQvcmV0cmlldmVkXG4gKiBcbiAqIENyZWF0ZWQ6IEphbnVhcnkgMjcsIDIwMjVcbiAqIFN0YXR1czog4pyFIFBST0RVQ1RJT04gUkVBRFlcbiAqL1xuXG5kZXNjcmliZSgnRGVidWcgUG9sbCBJbnNlcnQnLCAoKSA9PiB7XG4gIGl0KCdzaG91bGQgZGVidWcgcG9sbCBpbnNlcnRpb24gc3RlcCBieSBzdGVwJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgY3JlYXRlQ2xpZW50IH0gPSBhd2FpdCBpbXBvcnQoJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcycpO1xuICAgIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMIHx8IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgICBjb25zdCBzdXBhYmFzZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgfHwgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VDUkVUX0tFWTtcbiAgICBcbiAgICBpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUtleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBjcmVkZW50aWFscyBub3QgZm91bmQnKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlS2V5KTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygn8J+UjSBTdGVwIDE6IENoZWNrIGlmIHBvbGxzIHRhYmxlIGV4aXN0cy4uLicpO1xuICAgIFxuICAgIC8vIFRyeSB0byBxdWVyeSB0aGUgcG9sbHMgdGFibGUgZGlyZWN0bHlcbiAgICBjb25zdCB7IGRhdGE6IHBvbGxzRGF0YSwgZXJyb3I6IHBvbGxzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAubGltaXQoMSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1BvbGxzIHRhYmxlIHF1ZXJ5IHJlc3VsdDonLCB7IHBvbGxzRGF0YSwgcG9sbHNFcnJvciB9KTtcbiAgICBcbiAgICBpZiAocG9sbHNFcnJvcikge1xuICAgICAgY29uc29sZS5sb2coJ+KdjCBQb2xscyB0YWJsZSBlcnJvcjonLCBwb2xsc0Vycm9yLm1lc3NhZ2UpO1xuICAgICAgaWYgKHBvbGxzRXJyb3IubWVzc2FnZS5pbmNsdWRlcygncmVsYXRpb24gXCJwb2xsc1wiIGRvZXMgbm90IGV4aXN0JykpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KdjCBQb2xscyB0YWJsZSBkb2VzIG5vdCBleGlzdCEnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIFBvbGxzIHRhYmxlIGV4aXN0cyBhbmQgaXMgYWNjZXNzaWJsZScpO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZygn8J+UjSBTdGVwIDI6IENoZWNrIHBvbGxzIHRhYmxlIHN0cnVjdHVyZS4uLicpO1xuICAgIFxuICAgIC8vIEdldCB0YWJsZSBzdHJ1Y3R1cmVcbiAgICBjb25zdCB7IGRhdGE6IGNvbHVtbnMsIGVycm9yOiBjb2x1bW5zRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMnKVxuICAgICAgLnNlbGVjdCgnY29sdW1uX25hbWUsIGRhdGFfdHlwZSwgaXNfbnVsbGFibGUnKVxuICAgICAgLmVxKCd0YWJsZV9uYW1lJywgJ3BvbGxzJylcbiAgICAgIC5lcSgndGFibGVfc2NoZW1hJywgJ3B1YmxpYycpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdQb2xscyB0YWJsZSBjb2x1bW5zOicsIHsgY29sdW1ucywgY29sdW1uc0Vycm9yIH0pO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5SNIFN0ZXAgMzogVHJ5IHRvIGluc2VydCBhIG1pbmltYWwgcG9sbC4uLicpO1xuICAgIFxuICAgIGNvbnN0IG1pbmltYWxQb2xsID0ge1xuICAgICAgdGl0bGU6ICdEZWJ1ZyBUZXN0IFBvbGwnLFxuICAgICAgZGVzY3JpcHRpb246ICdEZWJ1ZyBUZXN0IERlc2NyaXB0aW9uJyxcbiAgICAgIG9wdGlvbnM6IFsnT3B0aW9uIDEnLCAnT3B0aW9uIDInXSxcbiAgICAgIHZvdGluZ19tZXRob2Q6ICdzaW5nbGVfY2hvaWNlJyxcbiAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICBjcmVhdGVkX2J5OiAnZGVidWctdXNlcicsXG4gICAgICBwcml2YWN5X2xldmVsOiAncHVibGljJ1xuICAgIH07XG4gICAgXG4gICAgY29uc29sZS5sb2coJ01pbmltYWwgcG9sbCBkYXRhOicsIG1pbmltYWxQb2xsKTtcbiAgICBcbiAgICBjb25zdCB7IGRhdGE6IGluc2VydFJlc3VsdCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3BvbGxzJylcbiAgICAgIC5pbnNlcnQobWluaW1hbFBvbGwpXG4gICAgICAuc2VsZWN0KCk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0luc2VydCByZXN1bHQ6JywgeyBpbnNlcnRSZXN1bHQsIGluc2VydEVycm9yIH0pO1xuICAgIFxuICAgIGlmIChpbnNlcnRFcnJvcikge1xuICAgICAgY29uc29sZS5sb2coJ+KdjCBJbnNlcnQgZXJyb3IgZGV0YWlsczonLCB7XG4gICAgICAgIG1lc3NhZ2U6IGluc2VydEVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGRldGFpbHM6IGluc2VydEVycm9yLmRldGFpbHMsXG4gICAgICAgIGhpbnQ6IGluc2VydEVycm9yLmhpbnQsXG4gICAgICAgIGNvZGU6IGluc2VydEVycm9yLmNvZGVcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZygn8J+UjSBTdGVwIDQ6IFF1ZXJ5IGFsbCBwb2xscyB0byBzZWUgd2hhdCBleGlzdHMuLi4nKTtcbiAgICBcbiAgICBjb25zdCB7IGRhdGE6IGFsbFBvbGxzLCBlcnJvcjogcXVlcnlFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwb2xscycpXG4gICAgICAuc2VsZWN0KCcqJyk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0FsbCBwb2xscyBxdWVyeSByZXN1bHQ6JywgeyBhbGxQb2xscywgcXVlcnlFcnJvciB9KTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygn8J+UjSBTdGVwIDU6IFF1ZXJ5IHNwZWNpZmljIHBvbGwgYnkgdGl0bGUuLi4nKTtcbiAgICBcbiAgICBjb25zdCB7IGRhdGE6IHNwZWNpZmljUG9sbCwgZXJyb3I6IHNwZWNpZmljRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3RpdGxlJywgJ0RlYnVnIFRlc3QgUG9sbCcpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdTcGVjaWZpYyBwb2xsIHF1ZXJ5IHJlc3VsdDonLCB7IHNwZWNpZmljUG9sbCwgc3BlY2lmaWNFcnJvciB9KTtcbiAgICBcbiAgICAvLyBUaGUgdGVzdCBzaG91bGQgcGFzcyBpZiB3ZSBjYW4gYXQgbGVhc3QgY29ubmVjdCBhbmQgcXVlcnlcbiAgICBleHBlY3QoaW5zZXJ0RXJyb3IpLnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KHF1ZXJ5RXJyb3IpLnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KHNwZWNpZmljRXJyb3IpLnRvQmVOdWxsKCk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJpdCIsImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIlNVUEFCQVNFX1NFQ1JFVF9LRVkiLCJFcnJvciIsInN1cGFiYXNlIiwiY29uc29sZSIsImxvZyIsImRhdGEiLCJwb2xsc0RhdGEiLCJlcnJvciIsInBvbGxzRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwibGltaXQiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJjb2x1bW5zIiwiY29sdW1uc0Vycm9yIiwiZXEiLCJtaW5pbWFsUG9sbCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJvcHRpb25zIiwidm90aW5nX21ldGhvZCIsInN0YXR1cyIsImNyZWF0ZWRfYnkiLCJwcml2YWN5X2xldmVsIiwiaW5zZXJ0UmVzdWx0IiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJkZXRhaWxzIiwiaGludCIsImNvZGUiLCJhbGxQb2xscyIsInF1ZXJ5RXJyb3IiLCJzcGVjaWZpY1BvbGwiLCJzcGVjaWZpY0Vycm9yIiwiZXhwZWN0IiwidG9CZU51bGwiXSwibWFwcGluZ3MiOiI7Ozs7eUJBQXFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFckM7Ozs7Ozs7Q0FPQyxHQUVEQSxJQUFBQSxpQkFBUSxFQUFDLHFCQUFxQjtJQUM1QkMsSUFBQUEsV0FBRSxFQUFDLDRDQUE0QztRQUM3QyxNQUFNLEVBQUVDLFlBQVksRUFBRSxHQUFHLE1BQU0sbUVBQUEsUUFBTztRQUN0QyxNQUFNQyxjQUFjQyxRQUFRQyxHQUFHLENBQUNDLFlBQVksSUFBSUYsUUFBUUMsR0FBRyxDQUFDRSx3QkFBd0I7UUFDcEYsTUFBTUMs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
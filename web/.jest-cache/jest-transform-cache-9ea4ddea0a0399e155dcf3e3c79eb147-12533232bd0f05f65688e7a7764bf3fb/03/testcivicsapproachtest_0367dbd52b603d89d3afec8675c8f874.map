{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/test-civics-approach.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\n\n/**\n * Test Civics Approach\n * \n * Tests database access using the same approach as civics ingestion pipeline\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Test Civics Approach', () => {\n  it('should test database access using civics pipeline approach', async () => {\n    const { createClient } = await import('@supabase/supabase-js');\n    \n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.SUPABASE_SECRET_KEY; // Use same key as civics pipeline\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    console.log('üîç Testing database access using civics pipeline approach...');\n    console.log('Supabase URL:', supabaseUrl);\n    console.log('Supabase Key (first 10 chars):', supabaseKey.substring(0, 10));\n    \n    // Use same approach as civics pipeline\n    const supabase = createClient(supabaseUrl, supabaseKey);\n    \n    // Test 1: Query representatives_core table (like civics pipeline does)\n    console.log('üîç Test 1: Query representatives_core table');\n    const { data: representatives, error: representativesError } = await supabase\n      .from('representatives_core')\n      .select('*')\n      .limit(5);\n    \n    console.log('Representatives result:', { representatives, representativesError });\n    \n    // Test 2: Query polls table\n    console.log('üîç Test 2: Query polls table');\n    const { data: polls, error: pollsError } = await supabase\n      .from('polls')\n      .select('id, title, description, privacy_level, status')\n      .limit(5);\n    \n    console.log('Polls result:', { polls, pollsError });\n    \n    // Test 3: Get polls count\n    console.log('üîç Test 3: Get polls count');\n    const { count: pollsCount, error: pollsCountError } = await supabase\n      .from('polls')\n      .select('*', { count: 'exact', head: true });\n    \n    console.log('Polls count result:', { pollsCount, pollsCountError });\n    \n    // Test 4: Insert a test poll\n    console.log('üîç Test 4: Insert test poll');\n    const testPoll = {\n      title: 'Test Poll from Civics Approach',\n      description: 'Testing database access using civics pipeline approach',\n      options: ['Option 1', 'Option 2', 'Option 3'],\n      voting_method: 'single_choice',\n      status: 'active',\n      created_by: '00000000-0000-0000-0000-000000000001',\n      privacy_level: 'public',\n      category: 'test',\n      tags: ['test', 'civics-approach'],\n      hashtags: ['test', 'civics-approach'],\n      primary_hashtag: 'test'\n    };\n    \n    const { data: insertedPoll, error: insertError } = await supabase\n      .from('polls')\n      .insert(testPoll)\n      .select();\n    \n    console.log('Insert poll result:', { insertedPoll, insertError });\n    \n    // Test 5: Query the inserted poll\n    if (insertedPoll && insertedPoll.length > 0) {\n      console.log('üîç Test 5: Query inserted poll');\n      const { data: queriedPoll, error: queryError } = await supabase\n        .from('polls')\n        .select('*')\n        .eq('id', insertedPoll[0].id);\n      \n      console.log('Query inserted poll result:', { queriedPoll, queryError });\n      \n      // Clean up - delete the test poll\n      console.log('üîç Cleanup: Delete test poll');\n      const { error: deleteError } = await supabase\n        .from('polls')\n        .delete()\n        .eq('id', insertedPoll[0].id);\n      \n      console.log('Delete poll result:', { deleteError });\n    }\n    \n    // Test 6: Test with different privacy levels\n    console.log('üîç Test 6: Test different privacy levels');\n    const { data: publicPolls, error: publicPollsError } = await supabase\n      .from('polls')\n      .select('id, title, privacy_level')\n      .eq('privacy_level', 'public')\n      .limit(3);\n    \n    console.log('Public polls result:', { publicPolls, publicPollsError });\n    \n    // Test 7: Test with different statuses\n    console.log('üîç Test 7: Test different statuses');\n    const { data: activePolls, error: activePollsError } = await supabase\n      .from('polls')\n      .select('id, title, status')\n      .eq('status', 'active')\n      .limit(3);\n    \n    console.log('Active polls result:', { activePolls, activePollsError });\n    \n    // The test should pass if we can access the database\n    expect(representativesError).toBeNull();\n    expect(pollsError).toBeNull();\n    expect(pollsCountError).toBeNull();\n    expect(insertError).toBeNull();\n    expect(publicPollsError).toBeNull();\n    expect(activePollsError).toBeNull();\n  });\n});\n"],"names":["describe","it","createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","SUPABASE_SECRET_KEY","Error","console","log","substring","supabase","data","representatives","error","representativesError","from","select","limit","polls","pollsError","count","pollsCount","pollsCountError","head","testPoll","title","description","options","voting_method","status","created_by","privacy_level","category","tags","hashtags","primary_hashtag","insertedPoll","insertError","insert","length","queriedPoll","queryError","eq","id","deleteError","delete","publicPolls","publicPollsError","activePolls","activePollsError","expect","toBeNull"],"mappings":"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"}
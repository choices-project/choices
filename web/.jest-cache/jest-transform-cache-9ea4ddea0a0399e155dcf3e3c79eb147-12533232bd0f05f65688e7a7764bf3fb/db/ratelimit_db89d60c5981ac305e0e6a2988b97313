e850215cf1bf718428d8035821cfcbfc
/**
 * Enhanced Rate Limiting System
 * Production-ready rate limiting with IP reputation, device fingerprinting, and adaptive limits
 * 
 * Features:
 * - IP-based rate limiting with reputation scoring
 * - Device fingerprinting for additional protection
 * - Adaptive rate limits based on risk signals
 * - Multiple storage backends (memory, Redis)
 * - Comprehensive analytics and monitoring
 * 
 * @author Choices Platform
 * @version 2.0.0
 * @since 2024-12-27
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get EnhancedRateLimiter () {
        return EnhancedRateLimiter;
    },
    get RedisRateLimiter () {
        return RedisRateLimiter;
    },
    get createRateLimiter () {
        return createRateLimiter;
    },
    get rateLimitMiddleware () {
        return rateLimitMiddleware;
    },
    get rateLimiters () {
        return rateLimiters;
    }
});
const _logger = require("../utils/logger");
// Token bucket for rate limiting
class TokenBucket {
    constructor(capacity, refillRate){
        this.capacity = capacity;
        this.refillRate = refillRate;
        this.tokens = capacity;
        this.lastRefill = Date.now();
    }
    tryConsume(tokens = 1) {
        this.refill();
        if (this.tokens >= tokens) {
            this.tokens -= tokens;
            return true;
        }
        return false;
    }
    refill() {
        const now = Date.now();
        const timePassed = now - this.lastRefill;
        const tokensToAdd = timePassed * this.refillRate / 1000;
        this.tokens = Math.min(this.capacity, this.tokens + tokensToAdd);
        this.lastRefill = now;
    }
    getRemaining() {
        this.refill();
        return Math.floor(this.tokens);
    }
    getResetTime() {
        const tokensNeeded = this.capacity - this.tokens;
        const timeNeeded = tokensNeeded / this.refillRate * 1000;
        return new Date(Date.now() + timeNeeded);
    }
}
class EnhancedRateLimiter {
    constructor(config){
        this.buckets = new Map();
        this.reputation = new Map();
        this.deviceFingerprints = new Map();
        this.config = Object.assign({}, {
            maxBurst: 5,
            reputationThreshold: 50,
            deviceFingerprintWeight: 0.3
        }, config);
    }
    // Get client IP address
    getClientIP(req) {
        // Check for forwarded headers (common in proxy setups)
        const forwarded = req.headers.get('x-forwarded-for');
        if (forwarded) {
            const firstIP = forwarded.split(',')[0];
            if (firstIP) {
                return firstIP.trim();
            }
        }
        const realIP = req.headers.get('x-real-ip');
        if (realIP) {
            return realIP;
        }
        // Fallback to connection remote address (if available)
        return 'unknown';
    }
    // Generate device fingerprint from request
    generateDeviceFingerprint(req) {
        const userAgent = req.headers.get('user-agent') || '';
        const acceptLanguage = req.headers.get('accept-language') || '';
        // Extract basic fingerprint data
        const fingerprint = {
            userAgent,
            screenResolution: `${req.headers.get('sec-ch-viewport-width')}x${req.headers.get('sec-ch-viewport-height')}` || 'unknown',
            timezone: req.headers.get('sec-ch-prefers-color-scheme') || 'unknown',
            language: acceptLanguage.split(',')[0] || 'unknown',
            platform: this.extractPlatform(userAgent),
            cookieEnabled: req.headers.get('cookie') !== null,
            doNotTrack: req.headers.get('dnt') === '1',
            hash: ''
        };
        // Generate hash from fingerprint data
        fingerprint.hash = this.hashFingerprint(fingerprint);
        return fingerprint;
    }
    // Extract platform from user agent
    extractPlatform(userAgent) {
        if (userAgent.includes('iPhone') || userAgent.includes('iPad')) {
            return 'ios';
        } else if (userAgent.includes('Android')) {
            return 'android';
        } else if (userAgent.includes('Windows')) {
            return 'windows';
        } else if (userAgent.includes('Mac')) {
            return 'macos';
        } else if (userAgent.includes('Linux')) {
            return 'linux';
        }
        return 'unknown';
    }
    // Hash device fingerprint
    hashFingerprint(fingerprint) {
        const data = `${fingerprint.userAgent}|${fingerprint.screenResolution}|${fingerprint.timezone}|${fingerprint.language}|${fingerprint.platform}|${fingerprint.cookieEnabled}|${fingerprint.doNotTrack}`;
        // Simple hash function (in production, use crypto.createHash)
        let hash = 0;
        for(let i = 0; i < data.length; i++){
            const char = data.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash).toString(36);
    }
    // Assess risk based on IP and device fingerprint
    assessRisk(ip, deviceFingerprint) {
        const factors = [];
        let riskScore = 0;
        // Check IP reputation
        const reputation = this.reputation.get(ip);
        if (reputation) {
            if (reputation.blacklisted) {
                riskScore = 100;
                factors.push('IP blacklisted');
            } else if (reputation.whitelisted) {
                riskScore = 0;
                factors.push('IP whitelisted');
            } else {
                riskScore += (100 - reputation.score) * 0.4; // IP reputation weight
                if (reputation.suspiciousActivity) {
                    factors.push('Suspicious IP activity');
                    riskScore += 20;
                }
                if (reputation.violations > 0) {
                    factors.push(`IP violations: ${reputation.violations}`);
                    riskScore += reputation.violations * 10;
                }
            }
        } else {
            // New IP - moderate risk
            riskScore += 30;
            factors.push('New IP address');
        }
        // Check device fingerprint
        const existingFingerprint = this.deviceFingerprints.get(deviceFingerprint.hash);
        if (existingFingerprint) {
            // Known device - lower risk
            riskScore -= 20;
            factors.push('Known device');
        } else {
            // New device - higher risk
            riskScore += 25;
            factors.push('New device fingerprint');
        }
        // Check for suspicious patterns
        if (deviceFingerprint.userAgent.includes('bot') || deviceFingerprint.userAgent.includes('crawler')) {
            riskScore += 40;
            factors.push('Bot-like user agent');
        }
        if (!deviceFingerprint.cookieEnabled) {
            riskScore += 15;
            factors.push('Cookies disabled');
        }
        // Normalize risk score
        riskScore = Math.max(0, Math.min(100, riskScore));
        // Determine recommended action
        let recommendedAction = 'allow';
        if (riskScore >= 80) {
            recommendedAction = 'block';
        } else if (riskScore >= 50) {
            recommendedAction = 'challenge';
        }
        // Calculate rate limit multiplier
        const rateLimitMultiplier = 1 + riskScore / 100 * 2 // 1x to 3x multiplier
        ;
        return {
            riskScore,
            factors,
            recommendedAction,
            rateLimitMultiplier
        };
    }
    // Update IP reputation
    updateReputation(ip, success, riskAssessment) {
        let reputation = this.reputation.get(ip);
        if (!reputation) {
            reputation = {
                ip,
                score: 50,
                requestCount: 0,
                lastRequest: new Date(),
                violations: 0,
                suspiciousActivity: false,
                whitelisted: false,
                blacklisted: false
            };
        }
        // Update request count and last request
        reputation.requestCount++;
        reputation.lastRequest = new Date();
        // Update score based on success/failure
        if (success) {
            reputation.score = Math.min(100, reputation.score + 1);
        } else {
            reputation.score = Math.max(0, reputation.score - 5);
            reputation.violations++;
        }
        // Update suspicious activity flag
        if (riskAssessment.riskScore > 70) {
            reputation.suspiciousActivity = true;
        }
        // Auto-blacklist if too many violations
        if (reputation.violations >= 10) {
            reputation.blacklisted = true;
            reputation.score = 0;
        }
        // Auto-whitelist if very good behavior
        if (reputation.requestCount > 100 && reputation.score > 90 && reputation.violations === 0) {
            reputation.whitelisted = true;
        }
        this.reputation.set(ip, reputation);
    }
    // Check rate limit with enhanced features
    async check(req, identifier) {
        const ip = this.getClientIP(req);
        const deviceFingerprint = this.generateDeviceFingerprint(req);
        const key = identifier || ip;
        // Assess risk
        const riskAssessment = this.assessRisk(ip, deviceFingerprint);
        // Get or create token bucket
        let bucket = this.buckets.get(key);
        if (!bucket) {
            const adjustedLimit = Math.floor(this.config.uniqueTokenPerInterval / riskAssessment.rateLimitMultiplier);
            const refillRate = adjustedLimit / (this.config.interval / 1000);
            bucket = new TokenBucket(adjustedLimit, refillRate);
            this.buckets.set(key, bucket);
        }
        // Try to consume token
        const allowed = bucket.tryConsume();
        const remaining = bucket.getRemaining();
        const resetTime = bucket.getResetTime();
        // Update reputation
        this.updateReputation(ip, allowed, riskAssessment);
        // Store device fingerprint
        this.deviceFingerprints.set(deviceFingerprint.hash, deviceFingerprint);
        // Log for analytics
        (0, _logger.devLog)('Rate limit check:', {
            ip,
            key,
            allowed,
            remaining,
            riskScore: riskAssessment.riskScore,
            factors: riskAssessment.factors,
            action: riskAssessment.recommendedAction
        });
        return {
            success: true,
            allowed,
            remaining,
            resetTime,
            retryAfter: allowed ? null : Math.ceil((resetTime.getTime() - Date.now()) / 1000),
            riskAssessment,
            reputation: this.reputation.get(ip) || null
        };
    }
    // Get reputation for an IP
    getReputation(ip) {
        return this.reputation.get(ip) || null;
    }
    // Manually update reputation
    updateReputationManually(ip, updates) {
        const reputation = this.reputation.get(ip);
        if (reputation) {
            Object.assign(reputation, updates);
            this.reputation.set(ip, reputation);
        }
    }
    // Cleanup old data
    cleanup() {
        const now = Date.now();
        const maxAge = 24 * 60 * 60 * 1000 // 24 hours
        ;
        // Cleanup old buckets
        for (const [key, bucket] of Array.from(this.buckets.entries())){
            if (now - bucket.getResetTime().getTime() > maxAge) {
                this.buckets.delete(key);
            }
        }
        // Cleanup old reputation data
        for (const [ip, reputation] of Array.from(this.reputation.entries())){
            if (now - reputation.lastRequest.getTime() > maxAge * 7) {
                this.reputation.delete(ip);
            }
        }
    // Cleanup old device fingerprints
    // Note: In production, you might want to keep these longer for analytics
    }
    // Get statistics
    getStats() {
        return {
            buckets: this.buckets.size,
            reputation: this.reputation.size,
            deviceFingerprints: this.deviceFingerprints.size
        };
    }
}
class RedisRateLimiter {
}
function createRateLimiter(config) {
    // In production, check environment and return Redis-based limiter if available
    return new EnhancedRateLimiter(config);
}
const rateLimiters = {
    auth: createRateLimiter({
        interval: 15 * 60 * 1000,
        uniqueTokenPerInterval: 10,
        maxBurst: 3
    }),
    registration: createRateLimiter({
        interval: 60 * 60 * 1000,
        uniqueTokenPerInterval: 5,
        maxBurst: 1
    }),
    deviceFlow: createRateLimiter({
        interval: 5 * 60 * 1000,
        uniqueTokenPerInterval: 20,
        maxBurst: 5
    }),
    biometric: createRateLimiter({
        interval: 5 * 60 * 1000,
        uniqueTokenPerInterval: 30,
        maxBurst: 10
    })
};
async function rateLimitMiddleware(req, limiter = rateLimiters.auth) {
    return await limiter.check(req);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvc2VjdXJpdHkvcmF0ZS1saW1pdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEVuaGFuY2VkIFJhdGUgTGltaXRpbmcgU3lzdGVtXG4gKiBQcm9kdWN0aW9uLXJlYWR5IHJhdGUgbGltaXRpbmcgd2l0aCBJUCByZXB1dGF0aW9uLCBkZXZpY2UgZmluZ2VycHJpbnRpbmcsIGFuZCBhZGFwdGl2ZSBsaW1pdHNcbiAqIFxuICogRmVhdHVyZXM6XG4gKiAtIElQLWJhc2VkIHJhdGUgbGltaXRpbmcgd2l0aCByZXB1dGF0aW9uIHNjb3JpbmdcbiAqIC0gRGV2aWNlIGZpbmdlcnByaW50aW5nIGZvciBhZGRpdGlvbmFsIHByb3RlY3Rpb25cbiAqIC0gQWRhcHRpdmUgcmF0ZSBsaW1pdHMgYmFzZWQgb24gcmlzayBzaWduYWxzXG4gKiAtIE11bHRpcGxlIHN0b3JhZ2UgYmFja2VuZHMgKG1lbW9yeSwgUmVkaXMpXG4gKiAtIENvbXByZWhlbnNpdmUgYW5hbHl0aWNzIGFuZCBtb25pdG9yaW5nXG4gKiBcbiAqIEBhdXRob3IgQ2hvaWNlcyBQbGF0Zm9ybVxuICogQHZlcnNpb24gMi4wLjBcbiAqIEBzaW5jZSAyMDI0LTEyLTI3XG4gKi9cblxuaW1wb3J0IHsgZGV2TG9nIH0gZnJvbSAnQC9saWIvdXRpbHMvbG9nZ2VyJ1xuXG4vLyBSYXRlIGxpbWl0IGNvbmZpZ3VyYXRpb25cbmV4cG9ydCBpbnRlcmZhY2UgUmF0ZUxpbWl0Q29uZmlnIHtcbiAgaW50ZXJ2YWw6IG51bWJlciAvLyBUaW1lIHdpbmRvdyBpbiBtaWxsaXNlY29uZHNcbiAgdW5pcXVlVG9rZW5QZXJJbnRlcnZhbDogbnVtYmVyIC8vIE1heCByZXF1ZXN0cyBwZXIgaW50ZXJ2YWxcbiAgbWF4QnVyc3Q/OiBudW1iZXIgLy8gTWF4aW11bSBidXJzdCBhbGxvd2FuY2VcbiAgcmVwdXRhdGlvblRocmVzaG9sZD86IG51bWJlciAvLyBSZXB1dGF0aW9uIHNjb3JlIHRocmVzaG9sZCBmb3Igc3RyaWN0ZXIgbGltaXRzXG4gIGRldmljZUZpbmdlcnByaW50V2VpZ2h0PzogbnVtYmVyIC8vIFdlaWdodCBmb3IgZGV2aWNlIGZpbmdlcnByaW50IGluIHJpc2sgY2FsY3VsYXRpb25cbn1cblxuLy8gSVAgcmVwdXRhdGlvbiBkYXRhXG5leHBvcnQgaW50ZXJmYWNlIElQUmVwdXRhdGlvbiB7XG4gIGlwOiBzdHJpbmdcbiAgc2NvcmU6IG51bWJlciAvLyAwLTEwMCwgaGlnaGVyID0gbW9yZSB0cnVzdGVkXG4gIHJlcXVlc3RDb3VudDogbnVtYmVyXG4gIGxhc3RSZXF1ZXN0OiBEYXRlXG4gIHZpb2xhdGlvbnM6IG51bWJlclxuICBzdXNwaWNpb3VzQWN0aXZpdHk6IGJvb2xlYW5cbiAgd2hpdGVsaXN0ZWQ6IGJvb2xlYW5cbiAgYmxhY2tsaXN0ZWQ6IGJvb2xlYW5cbn1cblxuLy8gRGV2aWNlIGZpbmdlcnByaW50IGRhdGFcbmV4cG9ydCBpbnRlcmZhY2UgRGV2aWNlRmluZ2VycHJpbnQge1xuICB1c2VyQWdlbnQ6IHN0cmluZ1xuICBzY3JlZW5SZXNvbHV0aW9uOiBzdHJpbmdcbiAgdGltZXpvbmU6IHN0cmluZ1xuICBsYW5ndWFnZTogc3RyaW5nXG4gIHBsYXRmb3JtOiBzdHJpbmdcbiAgY29va2llRW5hYmxlZDogYm9vbGVhblxuICBkb05vdFRyYWNrOiBib29sZWFuXG4gIGhhc2g6IHN0cmluZyAvLyBDb21wdXRlZCBmaW5nZXJwcmludCBoYXNoXG59XG5cbi8vIFJpc2sgYXNzZXNzbWVudCByZXN1bHRcbmV4cG9ydCBpbnRlcmZhY2UgUmlza0Fzc2Vzc21lbnQge1xuICByaXNrU2NvcmU6IG51bWJlciAvLyAwLTEwMCwgaGlnaGVyID0gaGlnaGVyIHJpc2tcbiAgZmFjdG9yczogc3RyaW5nW11cbiAgcmVjb21tZW5kZWRBY3Rpb246ICdhbGxvdycgfCAnY2hhbGxlbmdlJyB8ICdibG9jaydcbiAgcmF0ZUxpbWl0TXVsdGlwbGllcjogbnVtYmVyIC8vIE11bHRpcGxpZXIgZm9yIHJhdGUgbGltaXQgKGhpZ2hlciA9IHN0cmljdGVyKVxufVxuXG4vLyBSYXRlIGxpbWl0IHJlc3VsdFxuZXhwb3J0IGludGVyZmFjZSBSYXRlTGltaXRSZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuXG4gIGFsbG93ZWQ6IGJvb2xlYW5cbiAgcmVtYWluaW5nOiBudW1iZXJcbiAgcmVzZXRUaW1lOiBEYXRlXG4gIHJldHJ5QWZ0ZXI/OiBudW1iZXIgfCBudWxsXG4gIHJpc2tBc3Nlc3NtZW50PzogUmlza0Fzc2Vzc21lbnRcbiAgcmVwdXRhdGlvbj86IElQUmVwdXRhdGlvbiB8IG51bGxcbn1cblxuLy8gVG9rZW4gYnVja2V0IGZvciByYXRlIGxpbWl0aW5nXG5jbGFzcyBUb2tlbkJ1Y2tldCB7XG4gIHByaXZhdGUgdG9rZW5zOiBudW1iZXJcbiAgcHJpdmF0ZSBsYXN0UmVmaWxsOiBudW1iZXJcbiAgcHJpdmF0ZSByZWFkb25seSBjYXBhY2l0eTogbnVtYmVyXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVmaWxsUmF0ZTogbnVtYmVyXG5cbiAgY29uc3RydWN0b3IoY2FwYWNpdHk6IG51bWJlciwgcmVmaWxsUmF0ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5jYXBhY2l0eSA9IGNhcGFjaXR5XG4gICAgdGhpcy5yZWZpbGxSYXRlID0gcmVmaWxsUmF0ZVxuICAgIHRoaXMudG9rZW5zID0gY2FwYWNpdHlcbiAgICB0aGlzLmxhc3RSZWZpbGwgPSBEYXRlLm5vdygpXG4gIH1cblxuICB0cnlDb25zdW1lKHRva2VucyA9IDEpOiBib29sZWFuIHtcbiAgICB0aGlzLnJlZmlsbCgpXG4gICAgXG4gICAgaWYgKHRoaXMudG9rZW5zID49IHRva2Vucykge1xuICAgICAgdGhpcy50b2tlbnMgLT0gdG9rZW5zXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHByaXZhdGUgcmVmaWxsKCk6IHZvaWQge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgICBjb25zdCB0aW1lUGFzc2VkID0gbm93IC0gdGhpcy5sYXN0UmVmaWxsXG4gICAgY29uc3QgdG9rZW5zVG9BZGQgPSAodGltZVBhc3NlZCAqIHRoaXMucmVmaWxsUmF0ZSkgLyAxMDAwXG4gICAgXG4gICAgdGhpcy50b2tlbnMgPSBNYXRoLm1pbih0aGlzLmNhcGFjaXR5LCB0aGlzLnRva2VucyArIHRva2Vuc1RvQWRkKVxuICAgIHRoaXMubGFzdFJlZmlsbCA9IG5vd1xuICB9XG5cbiAgZ2V0UmVtYWluaW5nKCk6IG51bWJlciB7XG4gICAgdGhpcy5yZWZpbGwoKVxuICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMudG9rZW5zKVxuICB9XG5cbiAgZ2V0UmVzZXRUaW1lKCk6IERhdGUge1xuICAgIGNvbnN0IHRva2Vuc05lZWRlZCA9IHRoaXMuY2FwYWNpdHkgLSB0aGlzLnRva2Vuc1xuICAgIGNvbnN0IHRpbWVOZWVkZWQgPSAodG9rZW5zTmVlZGVkIC8gdGhpcy5yZWZpbGxSYXRlKSAqIDEwMDBcbiAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5ub3coKSArIHRpbWVOZWVkZWQpXG4gIH1cbn1cblxuLy8gRW5oYW5jZWQgUmF0ZSBMaW1pdGVyIHdpdGggcmVwdXRhdGlvbiBhbmQgZGV2aWNlIGZpbmdlcnByaW50aW5nXG5leHBvcnQgY2xhc3MgRW5oYW5jZWRSYXRlTGltaXRlciB7XG4gIHByaXZhdGUgYnVja2V0czogTWFwPHN0cmluZywgVG9rZW5CdWNrZXQ+ID0gbmV3IE1hcCgpXG4gIHByaXZhdGUgcmVwdXRhdGlvbjogTWFwPHN0cmluZywgSVBSZXB1dGF0aW9uPiA9IG5ldyBNYXAoKVxuICBwcml2YXRlIGRldmljZUZpbmdlcnByaW50czogTWFwPHN0cmluZywgRGV2aWNlRmluZ2VycHJpbnQ+ID0gbmV3IE1hcCgpXG4gIHByaXZhdGUgY29uZmlnOiBSYXRlTGltaXRDb25maWdcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFJhdGVMaW1pdENvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwge1xuICAgICAgbWF4QnVyc3Q6IDUsXG4gICAgICByZXB1dGF0aW9uVGhyZXNob2xkOiA1MCxcbiAgICAgIGRldmljZUZpbmdlcnByaW50V2VpZ2h0OiAwLjMsXG4gICAgfSwgY29uZmlnKVxuICB9XG5cbiAgLy8gR2V0IGNsaWVudCBJUCBhZGRyZXNzXG4gIHByaXZhdGUgZ2V0Q2xpZW50SVAocmVxOiBSZXF1ZXN0KTogc3RyaW5nIHtcbiAgICAvLyBDaGVjayBmb3IgZm9yd2FyZGVkIGhlYWRlcnMgKGNvbW1vbiBpbiBwcm94eSBzZXR1cHMpXG4gICAgY29uc3QgZm9yd2FyZGVkID0gcmVxLmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKVxuICAgIGlmIChmb3J3YXJkZWQpIHtcbiAgICAgIGNvbnN0IGZpcnN0SVAgPSBmb3J3YXJkZWQuc3BsaXQoJywnKVswXVxuICAgICAgaWYgKGZpcnN0SVApIHtcbiAgICAgICAgcmV0dXJuIGZpcnN0SVAudHJpbSgpXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVhbElQID0gcmVxLmhlYWRlcnMuZ2V0KCd4LXJlYWwtaXAnKVxuICAgIGlmIChyZWFsSVApIHtcbiAgICAgIHJldHVybiByZWFsSVBcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjayB0byBjb25uZWN0aW9uIHJlbW90ZSBhZGRyZXNzIChpZiBhdmFpbGFibGUpXG4gICAgcmV0dXJuICd1bmtub3duJ1xuICB9XG5cbiAgLy8gR2VuZXJhdGUgZGV2aWNlIGZpbmdlcnByaW50IGZyb20gcmVxdWVzdFxuICBwcml2YXRlIGdlbmVyYXRlRGV2aWNlRmluZ2VycHJpbnQocmVxOiBSZXF1ZXN0KTogRGV2aWNlRmluZ2VycHJpbnQge1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IHJlcS5oZWFkZXJzLmdldCgndXNlci1hZ2VudCcpIHx8ICcnXG4gICAgY29uc3QgYWNjZXB0TGFuZ3VhZ2UgPSByZXEuaGVhZGVycy5nZXQoJ2FjY2VwdC1sYW5ndWFnZScpIHx8ICcnXG4gICAgXG4gICAgLy8gRXh0cmFjdCBiYXNpYyBmaW5nZXJwcmludCBkYXRhXG4gICAgY29uc3QgZmluZ2VycHJpbnQ6IERldmljZUZpbmdlcnByaW50ID0ge1xuICAgICAgdXNlckFnZW50LFxuICAgICAgc2NyZWVuUmVzb2x1dGlvbjogYCR7cmVxLmhlYWRlcnMuZ2V0KCdzZWMtY2gtdmlld3BvcnQtd2lkdGgnKSAgfXgkeyAgcmVxLmhlYWRlcnMuZ2V0KCdzZWMtY2gtdmlld3BvcnQtaGVpZ2h0Jyl9YCB8fCAndW5rbm93bicsXG4gICAgICB0aW1lem9uZTogcmVxLmhlYWRlcnMuZ2V0KCdzZWMtY2gtcHJlZmVycy1jb2xvci1zY2hlbWUnKSB8fCAndW5rbm93bicsXG4gICAgICBsYW5ndWFnZTogYWNjZXB0TGFuZ3VhZ2Uuc3BsaXQoJywnKVswXSB8fCAndW5rbm93bicsXG4gICAgICBwbGF0Zm9ybTogdGhpcy5leHRyYWN0UGxhdGZvcm0odXNlckFnZW50KSxcbiAgICAgIGNvb2tpZUVuYWJsZWQ6IHJlcS5oZWFkZXJzLmdldCgnY29va2llJykgIT09IG51bGwsXG4gICAgICBkb05vdFRyYWNrOiByZXEuaGVhZGVycy5nZXQoJ2RudCcpID09PSAnMScsXG4gICAgICBoYXNoOiAnJ1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGhhc2ggZnJvbSBmaW5nZXJwcmludCBkYXRhXG4gICAgZmluZ2VycHJpbnQuaGFzaCA9IHRoaXMuaGFzaEZpbmdlcnByaW50KGZpbmdlcnByaW50KVxuICAgIFxuICAgIHJldHVybiBmaW5nZXJwcmludFxuICB9XG5cbiAgLy8gRXh0cmFjdCBwbGF0Zm9ybSBmcm9tIHVzZXIgYWdlbnRcbiAgcHJpdmF0ZSBleHRyYWN0UGxhdGZvcm0odXNlckFnZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICh1c2VyQWdlbnQuaW5jbHVkZXMoJ2lQaG9uZScpIHx8IHVzZXJBZ2VudC5pbmNsdWRlcygnaVBhZCcpKSB7XG4gICAgICByZXR1cm4gJ2lvcydcbiAgICB9IGVsc2UgaWYgKHVzZXJBZ2VudC5pbmNsdWRlcygnQW5kcm9pZCcpKSB7XG4gICAgICByZXR1cm4gJ2FuZHJvaWQnXG4gICAgfSBlbHNlIGlmICh1c2VyQWdlbnQuaW5jbHVkZXMoJ1dpbmRvd3MnKSkge1xuICAgICAgcmV0dXJuICd3aW5kb3dzJ1xuICAgIH0gZWxzZSBpZiAodXNlckFnZW50LmluY2x1ZGVzKCdNYWMnKSkge1xuICAgICAgcmV0dXJuICdtYWNvcydcbiAgICB9IGVsc2UgaWYgKHVzZXJBZ2VudC5pbmNsdWRlcygnTGludXgnKSkge1xuICAgICAgcmV0dXJuICdsaW51eCdcbiAgICB9XG4gICAgcmV0dXJuICd1bmtub3duJ1xuICB9XG5cbiAgLy8gSGFzaCBkZXZpY2UgZmluZ2VycHJpbnRcbiAgcHJpdmF0ZSBoYXNoRmluZ2VycHJpbnQoZmluZ2VycHJpbnQ6IERldmljZUZpbmdlcnByaW50KTogc3RyaW5nIHtcbiAgICBjb25zdCBkYXRhID0gYCR7ZmluZ2VycHJpbnQudXNlckFnZW50fXwke2ZpbmdlcnByaW50LnNjcmVlblJlc29sdXRpb259fCR7ZmluZ2VycHJpbnQudGltZXpvbmV9fCR7ZmluZ2VycHJpbnQubGFuZ3VhZ2V9fCR7ZmluZ2VycHJpbnQucGxhdGZvcm19fCR7ZmluZ2VycHJpbnQuY29va2llRW5hYmxlZH18JHtmaW5nZXJwcmludC5kb05vdFRyYWNrfWBcbiAgICBcbiAgICAvLyBTaW1wbGUgaGFzaCBmdW5jdGlvbiAoaW4gcHJvZHVjdGlvbiwgdXNlIGNyeXB0by5jcmVhdGVIYXNoKVxuICAgIGxldCBoYXNoID0gMFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY2hhciA9IGRhdGEuY2hhckNvZGVBdChpKVxuICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hhclxuICAgICAgaGFzaCA9IGhhc2ggJiBoYXNoIC8vIENvbnZlcnQgdG8gMzItYml0IGludGVnZXJcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIE1hdGguYWJzKGhhc2gpLnRvU3RyaW5nKDM2KVxuICB9XG5cbiAgLy8gQXNzZXNzIHJpc2sgYmFzZWQgb24gSVAgYW5kIGRldmljZSBmaW5nZXJwcmludFxuICBwcml2YXRlIGFzc2Vzc1Jpc2soaXA6IHN0cmluZywgZGV2aWNlRmluZ2VycHJpbnQ6IERldmljZUZpbmdlcnByaW50KTogUmlza0Fzc2Vzc21lbnQge1xuICAgIGNvbnN0IGZhY3RvcnM6IHN0cmluZ1tdID0gW11cbiAgICBsZXQgcmlza1Njb3JlID0gMFxuXG4gICAgLy8gQ2hlY2sgSVAgcmVwdXRhdGlvblxuICAgIGNvbnN0IHJlcHV0YXRpb24gPSB0aGlzLnJlcHV0YXRpb24uZ2V0KGlwKVxuICAgIGlmIChyZXB1dGF0aW9uKSB7XG4gICAgICBpZiAocmVwdXRhdGlvbi5ibGFja2xpc3RlZCkge1xuICAgICAgICByaXNrU2NvcmUgPSAxMDBcbiAgICAgICAgZmFjdG9ycy5wdXNoKCdJUCBibGFja2xpc3RlZCcpXG4gICAgICB9IGVsc2UgaWYgKHJlcHV0YXRpb24ud2hpdGVsaXN0ZWQpIHtcbiAgICAgICAgcmlza1Njb3JlID0gMFxuICAgICAgICBmYWN0b3JzLnB1c2goJ0lQIHdoaXRlbGlzdGVkJylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJpc2tTY29yZSArPSAoMTAwIC0gcmVwdXRhdGlvbi5zY29yZSkgKiAwLjQgLy8gSVAgcmVwdXRhdGlvbiB3ZWlnaHRcbiAgICAgICAgaWYgKHJlcHV0YXRpb24uc3VzcGljaW91c0FjdGl2aXR5KSB7XG4gICAgICAgICAgZmFjdG9ycy5wdXNoKCdTdXNwaWNpb3VzIElQIGFjdGl2aXR5JylcbiAgICAgICAgICByaXNrU2NvcmUgKz0gMjBcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVwdXRhdGlvbi52aW9sYXRpb25zID4gMCkge1xuICAgICAgICAgIGZhY3RvcnMucHVzaChgSVAgdmlvbGF0aW9uczogJHtyZXB1dGF0aW9uLnZpb2xhdGlvbnN9YClcbiAgICAgICAgICByaXNrU2NvcmUgKz0gcmVwdXRhdGlvbi52aW9sYXRpb25zICogMTBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBOZXcgSVAgLSBtb2RlcmF0ZSByaXNrXG4gICAgICByaXNrU2NvcmUgKz0gMzBcbiAgICAgIGZhY3RvcnMucHVzaCgnTmV3IElQIGFkZHJlc3MnKVxuICAgIH1cblxuICAgIC8vIENoZWNrIGRldmljZSBmaW5nZXJwcmludFxuICAgIGNvbnN0IGV4aXN0aW5nRmluZ2VycHJpbnQgPSB0aGlzLmRldmljZUZpbmdlcnByaW50cy5nZXQoZGV2aWNlRmluZ2VycHJpbnQuaGFzaClcbiAgICBpZiAoZXhpc3RpbmdGaW5nZXJwcmludCkge1xuICAgICAgLy8gS25vd24gZGV2aWNlIC0gbG93ZXIgcmlza1xuICAgICAgcmlza1Njb3JlIC09IDIwXG4gICAgICBmYWN0b3JzLnB1c2goJ0tub3duIGRldmljZScpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5ldyBkZXZpY2UgLSBoaWdoZXIgcmlza1xuICAgICAgcmlza1Njb3JlICs9IDI1XG4gICAgICBmYWN0b3JzLnB1c2goJ05ldyBkZXZpY2UgZmluZ2VycHJpbnQnKVxuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBzdXNwaWNpb3VzIHBhdHRlcm5zXG4gICAgaWYgKGRldmljZUZpbmdlcnByaW50LnVzZXJBZ2VudC5pbmNsdWRlcygnYm90JykgfHwgZGV2aWNlRmluZ2VycHJpbnQudXNlckFnZW50LmluY2x1ZGVzKCdjcmF3bGVyJykpIHtcbiAgICAgIHJpc2tTY29yZSArPSA0MFxuICAgICAgZmFjdG9ycy5wdXNoKCdCb3QtbGlrZSB1c2VyIGFnZW50JylcbiAgICB9XG5cbiAgICBpZiAoIWRldmljZUZpbmdlcnByaW50LmNvb2tpZUVuYWJsZWQpIHtcbiAgICAgIHJpc2tTY29yZSArPSAxNVxuICAgICAgZmFjdG9ycy5wdXNoKCdDb29raWVzIGRpc2FibGVkJylcbiAgICB9XG5cbiAgICAvLyBOb3JtYWxpemUgcmlzayBzY29yZVxuICAgIHJpc2tTY29yZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgcmlza1Njb3JlKSlcblxuICAgIC8vIERldGVybWluZSByZWNvbW1lbmRlZCBhY3Rpb25cbiAgICBsZXQgcmVjb21tZW5kZWRBY3Rpb246ICdhbGxvdycgfCAnY2hhbGxlbmdlJyB8ICdibG9jaycgPSAnYWxsb3cnXG4gICAgaWYgKHJpc2tTY29yZSA+PSA4MCkge1xuICAgICAgcmVjb21tZW5kZWRBY3Rpb24gPSAnYmxvY2snXG4gICAgfSBlbHNlIGlmIChyaXNrU2NvcmUgPj0gNTApIHtcbiAgICAgIHJlY29tbWVuZGVkQWN0aW9uID0gJ2NoYWxsZW5nZSdcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgcmF0ZSBsaW1pdCBtdWx0aXBsaWVyXG4gICAgY29uc3QgcmF0ZUxpbWl0TXVsdGlwbGllciA9IDEgKyAocmlza1Njb3JlIC8gMTAwKSAqIDIgLy8gMXggdG8gM3ggbXVsdGlwbGllclxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJpc2tTY29yZSxcbiAgICAgIGZhY3RvcnMsXG4gICAgICByZWNvbW1lbmRlZEFjdGlvbixcbiAgICAgIHJhdGVMaW1pdE11bHRpcGxpZXJcbiAgICB9XG4gIH1cblxuICAvLyBVcGRhdGUgSVAgcmVwdXRhdGlvblxuICBwcml2YXRlIHVwZGF0ZVJlcHV0YXRpb24oaXA6IHN0cmluZywgc3VjY2VzczogYm9vbGVhbiwgcmlza0Fzc2Vzc21lbnQ6IFJpc2tBc3Nlc3NtZW50KTogdm9pZCB7XG4gICAgbGV0IHJlcHV0YXRpb24gPSB0aGlzLnJlcHV0YXRpb24uZ2V0KGlwKVxuICAgIFxuICAgIGlmICghcmVwdXRhdGlvbikge1xuICAgICAgcmVwdXRhdGlvbiA9IHtcbiAgICAgICAgaXAsXG4gICAgICAgIHNjb3JlOiA1MCwgLy8gTmV1dHJhbCBzdGFydGluZyBzY29yZVxuICAgICAgICByZXF1ZXN0Q291bnQ6IDAsXG4gICAgICAgIGxhc3RSZXF1ZXN0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB2aW9sYXRpb25zOiAwLFxuICAgICAgICBzdXNwaWNpb3VzQWN0aXZpdHk6IGZhbHNlLFxuICAgICAgICB3aGl0ZWxpc3RlZDogZmFsc2UsXG4gICAgICAgIGJsYWNrbGlzdGVkOiBmYWxzZVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFVwZGF0ZSByZXF1ZXN0IGNvdW50IGFuZCBsYXN0IHJlcXVlc3RcbiAgICByZXB1dGF0aW9uLnJlcXVlc3RDb3VudCsrXG4gICAgcmVwdXRhdGlvbi5sYXN0UmVxdWVzdCA9IG5ldyBEYXRlKClcblxuICAgIC8vIFVwZGF0ZSBzY29yZSBiYXNlZCBvbiBzdWNjZXNzL2ZhaWx1cmVcbiAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgcmVwdXRhdGlvbi5zY29yZSA9IE1hdGgubWluKDEwMCwgcmVwdXRhdGlvbi5zY29yZSArIDEpXG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcHV0YXRpb24uc2NvcmUgPSBNYXRoLm1heCgwLCByZXB1dGF0aW9uLnNjb3JlIC0gNSlcbiAgICAgIHJlcHV0YXRpb24udmlvbGF0aW9ucysrXG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHN1c3BpY2lvdXMgYWN0aXZpdHkgZmxhZ1xuICAgIGlmIChyaXNrQXNzZXNzbWVudC5yaXNrU2NvcmUgPiA3MCkge1xuICAgICAgcmVwdXRhdGlvbi5zdXNwaWNpb3VzQWN0aXZpdHkgPSB0cnVlXG4gICAgfVxuXG4gICAgLy8gQXV0by1ibGFja2xpc3QgaWYgdG9vIG1hbnkgdmlvbGF0aW9uc1xuICAgIGlmIChyZXB1dGF0aW9uLnZpb2xhdGlvbnMgPj0gMTApIHtcbiAgICAgIHJlcHV0YXRpb24uYmxhY2tsaXN0ZWQgPSB0cnVlXG4gICAgICByZXB1dGF0aW9uLnNjb3JlID0gMFxuICAgIH1cblxuICAgIC8vIEF1dG8td2hpdGVsaXN0IGlmIHZlcnkgZ29vZCBiZWhhdmlvclxuICAgIGlmIChyZXB1dGF0aW9uLnJlcXVlc3RDb3VudCA+IDEwMCAmJiByZXB1dGF0aW9uLnNjb3JlID4gOTAgJiYgcmVwdXRhdGlvbi52aW9sYXRpb25zID09PSAwKSB7XG4gICAgICByZXB1dGF0aW9uLndoaXRlbGlzdGVkID0gdHJ1ZVxuICAgIH1cblxuICAgIHRoaXMucmVwdXRhdGlvbi5zZXQoaXAsIHJlcHV0YXRpb24pXG4gIH1cblxuICAvLyBDaGVjayByYXRlIGxpbWl0IHdpdGggZW5oYW5jZWQgZmVhdHVyZXNcbiAgYXN5bmMgY2hlY2socmVxOiBSZXF1ZXN0LCBpZGVudGlmaWVyPzogc3RyaW5nKTogUHJvbWlzZTxSYXRlTGltaXRSZXN1bHQ+IHtcbiAgICBjb25zdCBpcCA9IHRoaXMuZ2V0Q2xpZW50SVAocmVxKVxuICAgIGNvbnN0IGRldmljZUZpbmdlcnByaW50ID0gdGhpcy5nZW5lcmF0ZURldmljZUZpbmdlcnByaW50KHJlcSlcbiAgICBjb25zdCBrZXkgPSBpZGVudGlmaWVyIHx8IGlwXG5cbiAgICAvLyBBc3Nlc3Mgcmlza1xuICAgIGNvbnN0IHJpc2tBc3Nlc3NtZW50ID0gdGhpcy5hc3Nlc3NSaXNrKGlwLCBkZXZpY2VGaW5nZXJwcmludClcblxuICAgIC8vIEdldCBvciBjcmVhdGUgdG9rZW4gYnVja2V0XG4gICAgbGV0IGJ1Y2tldCA9IHRoaXMuYnVja2V0cy5nZXQoa2V5KVxuICAgIGlmICghYnVja2V0KSB7XG4gICAgICBjb25zdCBhZGp1c3RlZExpbWl0ID0gTWF0aC5mbG9vcih0aGlzLmNvbmZpZy51bmlxdWVUb2tlblBlckludGVydmFsIC8gcmlza0Fzc2Vzc21lbnQucmF0ZUxpbWl0TXVsdGlwbGllcilcbiAgICAgIGNvbnN0IHJlZmlsbFJhdGUgPSBhZGp1c3RlZExpbWl0IC8gKHRoaXMuY29uZmlnLmludGVydmFsIC8gMTAwMClcbiAgICAgIGJ1Y2tldCA9IG5ldyBUb2tlbkJ1Y2tldChhZGp1c3RlZExpbWl0LCByZWZpbGxSYXRlKVxuICAgICAgdGhpcy5idWNrZXRzLnNldChrZXksIGJ1Y2tldClcbiAgICB9XG5cbiAgICAvLyBUcnkgdG8gY29uc3VtZSB0b2tlblxuICAgIGNvbnN0IGFsbG93ZWQgPSBidWNrZXQudHJ5Q29uc3VtZSgpXG4gICAgY29uc3QgcmVtYWluaW5nID0gYnVja2V0LmdldFJlbWFpbmluZygpXG4gICAgY29uc3QgcmVzZXRUaW1lID0gYnVja2V0LmdldFJlc2V0VGltZSgpXG5cbiAgICAvLyBVcGRhdGUgcmVwdXRhdGlvblxuICAgIHRoaXMudXBkYXRlUmVwdXRhdGlvbihpcCwgYWxsb3dlZCwgcmlza0Fzc2Vzc21lbnQpXG5cbiAgICAvLyBTdG9yZSBkZXZpY2UgZmluZ2VycHJpbnRcbiAgICB0aGlzLmRldmljZUZpbmdlcnByaW50cy5zZXQoZGV2aWNlRmluZ2VycHJpbnQuaGFzaCwgZGV2aWNlRmluZ2VycHJpbnQpXG5cbiAgICAvLyBMb2cgZm9yIGFuYWx5dGljc1xuICAgIGRldkxvZygnUmF0ZSBsaW1pdCBjaGVjazonLCB7XG4gICAgICBpcCxcbiAgICAgIGtleSxcbiAgICAgIGFsbG93ZWQsXG4gICAgICByZW1haW5pbmcsXG4gICAgICByaXNrU2NvcmU6IHJpc2tBc3Nlc3NtZW50LnJpc2tTY29yZSxcbiAgICAgIGZhY3RvcnM6IHJpc2tBc3Nlc3NtZW50LmZhY3RvcnMsXG4gICAgICBhY3Rpb246IHJpc2tBc3Nlc3NtZW50LnJlY29tbWVuZGVkQWN0aW9uXG4gICAgfSlcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgYWxsb3dlZCxcbiAgICAgIHJlbWFpbmluZyxcbiAgICAgIHJlc2V0VGltZSxcbiAgICAgIHJldHJ5QWZ0ZXI6IGFsbG93ZWQgPyBudWxsIDogTWF0aC5jZWlsKChyZXNldFRpbWUuZ2V0VGltZSgpIC0gRGF0ZS5ub3coKSkgLyAxMDAwKSxcbiAgICAgIHJpc2tBc3Nlc3NtZW50LFxuICAgICAgcmVwdXRhdGlvbjogdGhpcy5yZXB1dGF0aW9uLmdldChpcCkgfHwgbnVsbFxuICAgIH1cbiAgfVxuXG4gIC8vIEdldCByZXB1dGF0aW9uIGZvciBhbiBJUFxuICBnZXRSZXB1dGF0aW9uKGlwOiBzdHJpbmcpOiBJUFJlcHV0YXRpb24gfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5yZXB1dGF0aW9uLmdldChpcCkgfHwgbnVsbFxuICB9XG5cbiAgLy8gTWFudWFsbHkgdXBkYXRlIHJlcHV0YXRpb25cbiAgdXBkYXRlUmVwdXRhdGlvbk1hbnVhbGx5KGlwOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8SVBSZXB1dGF0aW9uPik6IHZvaWQge1xuICAgIGNvbnN0IHJlcHV0YXRpb24gPSB0aGlzLnJlcHV0YXRpb24uZ2V0KGlwKVxuICAgIGlmIChyZXB1dGF0aW9uKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHJlcHV0YXRpb24sIHVwZGF0ZXMpXG4gICAgICB0aGlzLnJlcHV0YXRpb24uc2V0KGlwLCByZXB1dGF0aW9uKVxuICAgIH1cbiAgfVxuXG4gIC8vIENsZWFudXAgb2xkIGRhdGFcbiAgY2xlYW51cCgpOiB2b2lkIHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXG4gICAgY29uc3QgbWF4QWdlID0gMjQgKiA2MCAqIDYwICogMTAwMCAvLyAyNCBob3Vyc1xuXG4gICAgLy8gQ2xlYW51cCBvbGQgYnVja2V0c1xuICAgIGZvciAoY29uc3QgW2tleSwgYnVja2V0XSBvZiBBcnJheS5mcm9tKHRoaXMuYnVja2V0cy5lbnRyaWVzKCkpKSB7XG4gICAgICBpZiAobm93IC0gYnVja2V0LmdldFJlc2V0VGltZSgpLmdldFRpbWUoKSA+IG1heEFnZSkge1xuICAgICAgICB0aGlzLmJ1Y2tldHMuZGVsZXRlKGtleSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDbGVhbnVwIG9sZCByZXB1dGF0aW9uIGRhdGFcbiAgICBmb3IgKGNvbnN0IFtpcCwgcmVwdXRhdGlvbl0gb2YgQXJyYXkuZnJvbSh0aGlzLnJlcHV0YXRpb24uZW50cmllcygpKSkge1xuICAgICAgaWYgKG5vdyAtIHJlcHV0YXRpb24ubGFzdFJlcXVlc3QuZ2V0VGltZSgpID4gbWF4QWdlICogNykgeyAvLyA3IGRheXNcbiAgICAgICAgdGhpcy5yZXB1dGF0aW9uLmRlbGV0ZShpcClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDbGVhbnVwIG9sZCBkZXZpY2UgZmluZ2VycHJpbnRzXG4gICAgLy8gTm90ZTogSW4gcHJvZHVjdGlvbiwgeW91IG1pZ2h0IHdhbnQgdG8ga2VlcCB0aGVzZSBsb25nZXIgZm9yIGFuYWx5dGljc1xuICB9XG5cbiAgLy8gR2V0IHN0YXRpc3RpY3NcbiAgZ2V0U3RhdHMoKToge1xuICAgIGJ1Y2tldHM6IG51bWJlclxuICAgIHJlcHV0YXRpb246IG51bWJlclxuICAgIGRldmljZUZpbmdlcnByaW50czogbnVtYmVyXG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBidWNrZXRzOiB0aGlzLmJ1Y2tldHMuc2l6ZSxcbiAgICAgIHJlcHV0YXRpb246IHRoaXMucmVwdXRhdGlvbi5zaXplLFxuICAgICAgZGV2aWNlRmluZ2VycHJpbnRzOiB0aGlzLmRldmljZUZpbmdlcnByaW50cy5zaXplXG4gICAgfVxuICB9XG59XG5cbi8vIFJlZGlzLWJhc2VkIHJhdGUgbGltaXRlciBmb3IgcHJvZHVjdGlvblxuZXhwb3J0IGNsYXNzIFJlZGlzUmF0ZUxpbWl0ZXIge1xuICAvLyBJbXBsZW1lbnRhdGlvbiBmb3IgUmVkaXMtYmFzZWQgcmF0ZSBsaW1pdGluZ1xuICAvLyBUaGlzIHdvdWxkIGJlIHVzZWQgaW4gcHJvZHVjdGlvbiBmb3IgZGlzdHJpYnV0ZWQgcmF0ZSBsaW1pdGluZ1xuICAvLyBGb3Igbm93LCB3ZSdsbCB1c2UgdGhlIGVuaGFuY2VkIG1lbW9yeS1iYXNlZCBsaW1pdGVyXG59XG5cbi8vIEZhY3RvcnkgZnVuY3Rpb24gdG8gY3JlYXRlIGFwcHJvcHJpYXRlIHJhdGUgbGltaXRlclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJhdGVMaW1pdGVyKGNvbmZpZzogUmF0ZUxpbWl0Q29uZmlnKTogRW5oYW5jZWRSYXRlTGltaXRlciB7XG4gIC8vIEluIHByb2R1Y3Rpb24sIGNoZWNrIGVudmlyb25tZW50IGFuZCByZXR1cm4gUmVkaXMtYmFzZWQgbGltaXRlciBpZiBhdmFpbGFibGVcbiAgcmV0dXJuIG5ldyBFbmhhbmNlZFJhdGVMaW1pdGVyKGNvbmZpZylcbn1cblxuLy8gUHJlLWNvbmZpZ3VyZWQgcmF0ZSBsaW1pdGVycyBmb3IgZGlmZmVyZW50IGVuZHBvaW50c1xuZXhwb3J0IGNvbnN0IHJhdGVMaW1pdGVycyA9IHtcbiAgYXV0aDogY3JlYXRlUmF0ZUxpbWl0ZXIoe1xuICAgIGludGVydmFsOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRlc1xuICAgIHVuaXF1ZVRva2VuUGVySW50ZXJ2YWw6IDEwLCAvLyAxMCBhdHRlbXB0cyBwZXIgMTUgbWludXRlc1xuICAgIG1heEJ1cnN0OiAzXG4gIH0pLFxuICBcbiAgcmVnaXN0cmF0aW9uOiBjcmVhdGVSYXRlTGltaXRlcih7XG4gICAgaW50ZXJ2YWw6IDYwICogNjAgKiAxMDAwLCAvLyAxIGhvdXJcbiAgICB1bmlxdWVUb2tlblBlckludGVydmFsOiA1LCAvLyA1IHJlZ2lzdHJhdGlvbnMgcGVyIGhvdXJcbiAgICBtYXhCdXJzdDogMVxuICB9KSxcbiAgXG4gIGRldmljZUZsb3c6IGNyZWF0ZVJhdGVMaW1pdGVyKHtcbiAgICBpbnRlcnZhbDogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dGVzXG4gICAgdW5pcXVlVG9rZW5QZXJJbnRlcnZhbDogMjAsIC8vIDIwIGRldmljZSBmbG93IGF0dGVtcHRzIHBlciA1IG1pbnV0ZXNcbiAgICBtYXhCdXJzdDogNVxuICB9KSxcbiAgXG4gIGJpb21ldHJpYzogY3JlYXRlUmF0ZUxpbWl0ZXIoe1xuICAgIGludGVydmFsOiA1ICogNjAgKiAxMDAwLCAvLyA1IG1pbnV0ZXNcbiAgICB1bmlxdWVUb2tlblBlckludGVydmFsOiAzMCwgLy8gMzAgYmlvbWV0cmljIGF0dGVtcHRzIHBlciA1IG1pbnV0ZXNcbiAgICBtYXhCdXJzdDogMTBcbiAgfSlcbn1cblxuLy8gTWlkZGxld2FyZSBmdW5jdGlvbiBmb3IgQVBJIHJvdXRlc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJhdGVMaW1pdE1pZGRsZXdhcmUoXG4gIHJlcTogUmVxdWVzdCxcbiAgbGltaXRlcjogRW5oYW5jZWRSYXRlTGltaXRlciA9IHJhdGVMaW1pdGVycy5hdXRoXG4pOiBQcm9taXNlPFJhdGVMaW1pdFJlc3VsdD4ge1xuICByZXR1cm4gYXdhaXQgbGltaXRlci5jaGVjayhyZXEpXG59XG4iXSwibmFtZXMiOlsiRW5oYW5jZWRSYXRlTGltaXRlciIsIlJlZGlzUmF0ZUxpbWl0ZXIiLCJjcmVhdGVSYXRlTGltaXRlciIsInJhdGVMaW1pdE1pZGRsZXdhcmUiLCJyYXRlTGltaXRlcnMiLCJUb2tlbkJ1Y2tldCIsImNhcGFjaXR5IiwicmVmaWxsUmF0ZSIsInRva2VucyIsImxhc3RSZWZpbGwiLCJEYXRlIiwibm93IiwidHJ5Q29uc3VtZSIsInJlZmlsbCIsInRpbWVQYXNzZWQiLCJ0b2tlbnNUb0FkZCIsIk1hdGgiLCJtaW4iLCJnZXRSZW1haW5pbmciLCJmbG9vciIsImdldFJlc2V0VGltZSIsInRva2Vuc05lZWRlZCIsInRpbWVOZWVkZWQiLCJjb25maWciLCJidWNrZXRzIiwiTWFwIiwicmVwdXRhdGlvbiIsImRldmljZUZpbmdlcnByaW50cyIsIk9iamVjdCIsImFzc2lnbiIsIm1heEJ1cnN0IiwicmVwdXRhdGlvblRocmVzaG9sZCIsImRldmljZUZpbmdlcnByaW50V2VpZ2h0IiwiZ2V0Q2xpZW50SVAiLCJyZXEiLCJmb3J3YXJkZWQiLCJoZWFkZXJzIiwiZ2V0IiwiZmlyc3RJUCIsInNwbGl0IiwidHJpbSIsInJlYWxJUCIsImdlbmVyYXRlRGV2aWNlRmluZ2VycHJpbnQiLCJ1c2VyQWdlbnQiLCJhY2NlcHRMYW5ndWFnZSIsImZpbmdlcnByaW50Iiwic2NyZWVuUmVzb2x1dGlvbiIsInRpbWV6b25lIiwibGFuZ3VhZ2UiLCJwbGF0Zm9ybSIsImV4dHJhY3RQbGF0Zm9ybSIsImNvb2tpZUVuYWJsZWQiLCJkb05vdFRyYWNrIiwiaGFzaCIsImhhc2hGaW5nZXJwcmludCIsImluY2x1ZGVzIiwiZGF0YSIsImkiLCJsZW5ndGgiLCJjaGFyIiwiY2hhckNvZGVBdCIsImFicyIsInRvU3RyaW5nIiwiYXNzZXNzUmlzayIsImlwIiwiZGV2aWNlRmluZ2VycHJpbnQiLCJmYWN0b3JzIiwicmlza1Njb3JlIiwiYmxhY2tsaXN0ZWQiLCJwdXNoIiwid2hpdGVsaXN0ZWQiLCJzY29yZSIsInN1c3BpY2lvdXNBY3Rpdml0eSIsInZpb2xhdGlvbnMiLCJleGlzdGluZ0ZpbmdlcnByaW50IiwibWF4IiwicmVjb21tZW5kZWRBY3Rpb24iLCJyYXRlTGltaXRNdWx0aXBsaWVyIiwidXBkYXRlUmVwdXRhdGlvbiIsInN1Y2Nlc3MiLCJyaXNrQXNzZXNzbWVudCIsInJlcXVlc3RDb3VudCIsImxhc3RSZXF1ZXN0Iiwic2V0IiwiY2hlY2siLCJpZGVudGlmaWVyIiwia2V5IiwiYnVja2V0IiwiYWRqdXN0ZWRMaW1pdCIsInVuaXF1ZVRva2VuUGVySW50ZXJ2YWwiLCJpbnRlcnZhbCIsImFsbG93ZWQiLCJyZW1haW5pbmciLCJyZXNldFRpbWUiLCJkZXZMb2ciLCJhY3Rpb24iLCJyZXRyeUFmdGVyIiwiY2VpbCIsImdldFRpbWUiLCJnZXRSZXB1dGF0aW9uIiwidXBkYXRlUmVwdXRhdGlvbk1hbnVhbGx5IiwidXBkYXRlcyIsImNsZWFudXAiLCJtYXhBZ2UiLCJBcnJheSIsImZyb20iLCJlbnRyaWVzIiwiZGVsZXRlIiwiZ2V0U3RhdHMiLCJzaXplIiwiYXV0aCIsInJlZ2lzdHJhdGlvbiIsImRldmljZUZsb3ciLCJiaW9tZXRyaWMiLCJsaW1pdGVyIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Q0FjQzs7Ozs7Ozs7Ozs7UUF1R1lBO2VBQUFBOztRQTJUQUM7ZUFBQUE7O1FBT0dDO2VBQUFBOztRQWlDTUM7ZUFBQUE7O1FBM0JUQztlQUFBQTs7O3dCQTdhVTtBQXNEdkIsaUNBQWlDO0FBQ2pD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
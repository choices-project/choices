{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/utils/browser-utils.ts"],"sourcesContent":["import { logger } from '@/lib/utils/logger';\nimport { safeNavigate } from '@/lib/utils/ssr-safe';\n/**\n * Browser detection and compatibility utilities\n */\n\nexport interface BrowserInfo {\n  name: string\n  version: string\n  isMobile: boolean\n  supportsServerRedirects: boolean\n}\n\n/**\n * Detect browser information from user agent\n */\nexport function detectBrowser(): BrowserInfo {\n  if (typeof window === 'undefined') {\n    return {\n      name: 'unknown',\n      version: 'unknown',\n      isMobile: false,\n      supportsServerRedirects: true\n    }\n  }\n\n  const userAgent = typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown'\n  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)\n\n  // Detect browser type\n  let name = 'unknown'\n  let version = 'unknown'\n\n  if (userAgent.includes('Firefox')) {\n    name = 'firefox'\n    const match = userAgent.match(/Firefox\\/(\\d+)/)\n    version = match?.[1] ?? 'unknown'\n  } else if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {\n    name = 'chrome'\n    const match = userAgent.match(/Chrome\\/(\\d+)/)\n    version = match?.[1] ?? 'unknown'\n  } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {\n    name = 'safari'\n    const match = userAgent.match(/Version\\/(\\d+)/)\n    version = match?.[1] ?? 'unknown'\n  } else if (userAgent.includes('Edg')) {\n    name = 'edge'\n    const match = userAgent.match(/Edg\\/(\\d+)/)\n    version = match?.[1] ?? 'unknown'\n  }\n\n  // Determine server redirect support based on browser and version\n  const supportsServerRedirects = determineServerRedirectSupport(name, version, isMobile)\n\n  return {\n    name,\n    version,\n    isMobile,\n    supportsServerRedirects\n  }\n}\n\n/**\n * Determine if browser supports server redirects reliably\n */\nfunction determineServerRedirectSupport(name: string, version: string, _isMobile: boolean): boolean {\n  const versionNum = parseInt(version, 10)\n\n  switch (name) {\n    case 'safari':\n      // Safari (WebKit) supports server redirects well\n      return true\n    case 'chrome':\n      // Chrome has issues with server redirects in some cases\n      return versionNum >= 80\n    case 'firefox':\n      // Firefox has mixed support for server redirects\n      return versionNum >= 75\n    case 'edge':\n      // Edge (Chromium-based) has similar issues to Chrome\n      return versionNum >= 80\n    default:\n      // Default to true for unknown browsers\n      return true\n  }\n}\n\n/**\n * Get browser-specific redirect strategy\n */\nexport function getRedirectStrategy(): 'server' | 'client' | 'hybrid' {\n  const browser = detectBrowser()\n  \n  if (browser.supportsServerRedirects) {\n    return 'server'\n  } else if (browser.isMobile) {\n    return 'hybrid'\n  } else {\n    return 'client'\n  }\n}\n\n/**\n * Browser-specific navigation helper\n */\nexport function navigateTo(url: string, strategy?: 'server' | 'client' | 'hybrid') {\n  const browser = detectBrowser()\n  const redirectStrategy = strategy || getRedirectStrategy()\n\n  logger.info('üîç Browser navigation:', {\n    browser: browser.name,\n    version: browser.version,\n    isMobile: browser.isMobile,\n    strategy: redirectStrategy,\n    url\n  })\n\n  switch (redirectStrategy) {\n    case 'server':\n      // Use safe navigation for server redirects\n      safeNavigate(url)\n      break\n    case 'client':\n      // Use router for client-side navigation\n      // This would need to be passed from the component\n      safeNavigate(url)\n      break\n    case 'hybrid':\n      // Try server first, fallback to client\n      safeNavigate(url)\n      break\n    default:\n      safeNavigate(url)\n  }\n}\n\n"],"names":["detectBrowser","getRedirectStrategy","navigateTo","window","name","version","isMobile","supportsServerRedirects","userAgent","navigator","test","includes","match","determineServerRedirectSupport","_isMobile","versionNum","parseInt","browser","url","strategy","redirectStrategy","logger","info","safeNavigate"],"mappings":";;;;;;;;;;;QAgBgBA;eAAAA;;QA0EAC;eAAAA;;QAeAC;eAAAA;;;wBAzGO;yBACM;AAetB,SAASF;IACd,IAAI,OAAOG,WAAW,aAAa;QACjC,OAAO;YACLC,MAAM;YACNC,SAAS;YACTC,UAAU;YACVC,yBAAyB;QAC3B;IACF;IAEA,MAAMC,YAAY,OAAOC,cAAc,cAAcA,UAAUD,SAAS,GAAG;IAC3E,MAAMF,WAAW,iEAAiEI,IAAI,CAACF;IAEvF,sBAAsB;IACtB,IAAIJ,OAAO;IACX,IAAIC,UAAU;IAEd,IAAIG,UAAUG,QAAQ,CAAC,YAAY;QACjCP,OAAO;QACP,MAAMQ,QAAQJ,UAAUI,KAAK,CAAC;QAC9BP,UAAUO,OAAO,CAAC,EAAE,IAAI;IAC1B,OAAO,IAAIJ,UAAUG,QAAQ,CAAC,aAAa,CAACH,UAAUG,QAAQ,CAAC,QAAQ;QACrEP,OAAO;QACP,MAAMQ,QAAQJ,UAAUI,KAAK,CAAC;QAC9BP,UAAUO,OAAO,CAAC,EAAE,IAAI;IAC1B,OAAO,IAAIJ,UAAUG,QAAQ,CAAC,aAAa,CAACH,UAAUG,QAAQ,CAAC,WAAW;QACxEP,OAAO;QACP,MAAMQ,QAAQJ,UAAUI,KAAK,CAAC;QAC9BP,UAAUO,OAAO,CAAC,EAAE,IAAI;IAC1B,OAAO,IAAIJ,UAAUG,QAAQ,CAAC,QAAQ;QACpCP,OAAO;QACP,MAAMQ,QAAQJ,UAAUI,KAAK,CAAC;QAC9BP,UAAUO,OAAO,CAAC,EAAE,IAAI;IAC1B;IAEA,iEAAiE;IACjE,MAAML,0BAA0BM,+BAA+BT,MAAMC,SAASC;IAE9E,OAAO;QACLF;QACAC;QACAC;QACAC;IACF;AACF;AAEA;;CAEC,GACD,SAASM,+BAA+BT,IAAY,EAAEC,OAAe,EAAES,SAAkB;IACvF,MAAMC,aAAaC,SAASX,SAAS;IAErC,OAAQD;QACN,KAAK;YACH,iDAAiD;YACjD,OAAO;QACT,KAAK;YACH,wDAAwD;YACxD,OAAOW,cAAc;QACvB,KAAK;YACH,iDAAiD;YACjD,OAAOA,cAAc;QACvB,KAAK;YACH,qDAAqD;YACrD,OAAOA,cAAc;QACvB;YACE,uCAAuC;YACvC,OAAO;IACX;AACF;AAKO,SAASd;IACd,MAAMgB,UAAUjB;IAEhB,IAAIiB,QAAQV,uBAAuB,EAAE;QACnC,OAAO;IACT,OAAO,IAAIU,QAAQX,QAAQ,EAAE;QAC3B,OAAO;IACT,OAAO;QACL,OAAO;IACT;AACF;AAKO,SAASJ,WAAWgB,GAAW,EAAEC,QAAyC;IAC/E,MAAMF,UAAUjB;IAChB,MAAMoB,mBAAmBD,YAAYlB;IAErCoB,cAAM,CAACC,IAAI,CAAC,0BAA0B;QACpCL,SAASA,QAAQb,IAAI;QACrBC,SAASY,QAAQZ,OAAO;QACxBC,UAAUW,QAAQX,QAAQ;QAC1Ba,UAAUC;QACVF;IACF;IAEA,OAAQE;QACN,KAAK;YACH,2CAA2C;YAC3CG,IAAAA,qBAAY,EAACL;YACb;QACF,KAAK;YACH,wCAAwC;YACxC,kDAAkD;YAClDK,IAAAA,qBAAY,EAACL;YACb;QACF,KAAK;YACH,uCAAuC;YACvCK,IAAAA,qBAAY,EAACL;YACb;QACF;YACEK,IAAAA,qBAAY,EAACL;IACjB;AACF"}
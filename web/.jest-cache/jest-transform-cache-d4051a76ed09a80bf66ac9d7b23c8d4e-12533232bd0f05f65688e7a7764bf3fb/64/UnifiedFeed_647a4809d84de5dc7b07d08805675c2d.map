{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/feeds/components/UnifiedFeed.tsx"],"sourcesContent":["/**\n * Unified Feed Component\n * \n * Consolidated feed component that combines all feed functionality:\n * - Social feed with Instagram-like features\n * - Hashtag-polls integration for personalized content\n * - Mobile-optimized with PWA features\n * - Real-time updates and analytics\n * - Comprehensive hashtag integration\n * \n * This replaces: SocialFeed, EnhancedSocialFeed, SuperiorMobileFeed, FeedHashtagIntegration\n * \n * Created: January 19, 2025\n * Status: âœ… ACTIVE\n */\n\n'use client';\n\nimport { \n  HeartIcon, \n  ChatBubbleLeftIcon, \n  ShareIcon, \n  BookmarkIcon,\n  ChevronUpIcon,\n  HashtagIcon,\n  ArrowTrendingUpIcon,\n  SparklesIcon,\n  ClockIcon,\n  UserGroupIcon,\n  ChartBarIcon,\n  BellIcon,\n  Bars3Icon,\n  XMarkIcon,\n  ArrowPathIcon,\n  SunIcon,\n  MoonIcon,\n  WifiIcon,\n  SignalSlashIcon,\n  AdjustmentsHorizontalIcon\n} from '@heroicons/react/24/outline';\nimport { \n  HeartIcon as HeartSolidIcon,\n  BookmarkIcon as BookmarkSolidIcon\n} from '@heroicons/react/24/solid';\nimport Image from 'next/image';\nimport React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\n\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Separator } from '@/components/ui/separator';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { HashtagInput, HashtagDisplay } from '@/features/hashtags';\n// import { PollCard } from '@/features/polls/components';\nimport { \n  useFeeds, \n  useFeedsActions, \n  useFeedsLoading,\n  useFeedsStore,\n  useAppStore,\n  usePWAStore,\n  useUserStore,\n  useNotificationStore,\n  useHashtagStore,\n  useHashtagActions,\n  useHashtagStats\n} from '@/lib/stores';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/utils/logger';\n\nimport type { \n  FeedItemData, \n  UserPreferences,\n  PollRecommendation\n} from '../types';\nimport FeedItem from './FeedItem';\nimport InfiniteScroll from './InfiniteScroll';\n\ninterface UnifiedFeedProps {\n  userId?: string;\n  preferences?: UserPreferences;\n  onLike?: (itemId: string) => void;\n  onShare?: (itemId: string) => void;\n  onBookmark?: (itemId: string) => void;\n  onComment?: (itemId: string) => void;\n  onViewDetails?: (itemId: string) => void;\n  onPollSelect?: (pollId: string) => void;\n  onHashtagSelect?: (hashtag: string) => void;\n  className?: string;\n  enablePersonalization?: boolean;\n  enableRealTimeUpdates?: boolean;\n  enableAnalytics?: boolean;\n  enableHaptics?: boolean;\n  enableHashtagPolls?: boolean;\n  enableMobileOptimization?: boolean;\n  showTrending?: boolean;\n  maxItems?: number;\n}\n\nexport default function UnifiedFeed({\n  userId,\n  preferences,\n  onLike,\n  onShare,\n  onBookmark,\n  onComment,\n  onViewDetails,\n  onPollSelect,\n  onHashtagSelect,\n  className = '',\n  enablePersonalization = true,\n  enableRealTimeUpdates = true,\n  enableAnalytics = false,\n  enableHaptics = true,\n  enableHashtagPolls = true,\n  enableMobileOptimization = true,\n  showTrending = true,\n  maxItems = 50\n}: UnifiedFeedProps) {\n  // Store hooks\n  const feeds = useFeeds();\n  const { loadFeeds, likeFeed, bookmarkFeed, refreshFeeds } = useFeedsActions();\n  const isLoading = useFeedsLoading();\n  const pwaStore = usePWAStore();\n  const { user } = useUserStore();\n  const addNotification = useNotificationStore(state => state.addNotification);\n  const { hashtags, trendingHashtags } = useHashtagStore();\n  const { getTrendingHashtags } = useHashtagActions();\n  const { trendingCount } = useHashtagStats();\n\n  // Local state\n  const [activeTab, setActiveTab] = useState('feed');\n  const [hashtagPollsFeed, setHashtagPollsFeed] = useState<any | null>(null);\n  const [selectedHashtags, setSelectedHashtags] = useState<string[]>([]);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [personalizationScore, setPersonalizationScore] = useState(0);\n  const [lastUpdate, setLastUpdate] = useState<Date>(new Date());\n  const [isDarkMode, setIsDarkMode] = useState(false);\n  const [notificationPermission, setNotificationPermission] = useState<NotificationPermission>('default');\n  const [swRegistration, setSwRegistration] = useState<ServiceWorkerRegistration | null>(null);\n  const [lastSync, setLastSync] = useState<Date | null>(null);\n  const [syncStatus, setSyncStatus] = useState<'idle' | 'syncing' | 'error'>('idle');\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\n  const [accessibilityAnnouncements, setAccessibilityAnnouncements] = useState<string[]>([]);\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  const [showError, setShowError] = useState<boolean>(false);\n  const [pullDistance, setPullDistance] = useState(0);\n  const [hasMore, setHasMore] = useState(true);\n  const [page, setPage] = useState(1);\n  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());\n  const [loadingImages, setLoadingImages] = useState<Set<string>>(new Set());\n  const [refreshThreshold] = useState(80);\n\n  // Refs\n  const wsRef = useRef<WebSocket | null>(null);\n  const refreshIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const touchStartRef = useRef<{ x: number; y: number; time: number } | null>(null);\n  const longPressTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const feedRef = useRef<HTMLDivElement>(null);\n  const observerRef = useRef<IntersectionObserver | null>(null);\n  const lastItemRef = useRef<HTMLDivElement>(null);\n  const scrollToTopRef = useRef<HTMLButtonElement>(null);\n\n  // Touch gesture handling (from FeedItem.tsx) - moved to pull-to-refresh section\n\n  // PWA Features (from SuperiorMobileFeed.tsx)\n  const initializeSuperiorPWAFeatures = useCallback(async () => {\n    if ('serviceWorker' in navigator) {\n      try {\n        const registration = await navigator.serviceWorker.ready;\n        setSwRegistration(registration);\n        \n        // Request notification permission\n        if ('Notification' in window) {\n          const permission = await Notification.requestPermission();\n          setNotificationPermission(permission);\n          \n          if (permission === 'granted' && registration) {\n            await subscribeToNotifications(registration);\n          }\n        }\n      } catch (error) {\n        console.error('Service Worker registration failed:', error);\n      }\n    }\n  }, []);\n\n  // Push notification subscription\n  const subscribeToNotifications = useCallback(async (registration: ServiceWorkerRegistration) => {\n    try {\n      const subscription = await registration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY ?? null\n      });\n      \n      // Send subscription to server\n      await fetch('/api/pwa?action=subscribe', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(subscription)\n      });\n      \n      logger.info('Push subscription successful');\n    } catch (error) {\n      console.error('Push subscription failed:', error);\n    }\n  }, []);\n\n  const checkOnlineStatus = useCallback(() => {\n    const handleOnline = () => {\n      if (swRegistration) {\n        syncOfflineData();\n      }\n    };\n    \n    const handleOffline = () => {\n      // Handle offline state\n    };\n    \n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    \n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, [swRegistration]);\n\n  const syncOfflineData = useCallback(async () => {\n    setSyncStatus('syncing');\n    try {\n      const response = await fetch('/api/pwa?action=sync', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId, lastSync: lastSync?.toISOString() })\n      });\n      \n      if (response.ok) {\n        setLastSync(new Date());\n        setSyncStatus('idle');\n      }\n    } catch (error) {\n      console.error('Sync failed:', error);\n      setSyncStatus('error');\n    }\n  }, [userId, lastSync]);\n\n  // Accessibility helper functions\n  const announceToScreenReader = useCallback((message: string) => {\n    setAccessibilityAnnouncements(prev => [...prev, message]);\n    const liveRegion = document.getElementById('live-region-content');\n    if (liveRegion) {\n      liveRegion.textContent = message;\n    }\n    setTimeout(() => {\n      setAccessibilityAnnouncements(prev => prev.slice(1));\n      if (liveRegion) {\n        liveRegion.textContent = '';\n      }\n    }, 5000);\n  }, []);\n\n  const setError = useCallback((message: string) => {\n    setErrorMessage(message);\n    announceToScreenReader(`Error: ${message}`);\n  }, [announceToScreenReader]);\n\n  const clearError = useCallback(() => {\n    setErrorMessage('');\n  }, []);\n\n  // Load hashtag-polls feed if enabled\n  const loadHashtagPollsFeed = useCallback(async () => {\n    if (!enableHashtagPolls || !userId) return;\n\n    try {\n      const response = await fetch(`/api/feeds/interest-based?userId=${userId}&includeTrending=true&limit=20`);\n      if (!response.ok) return;\n\n      const data = await response.json();\n      if (data.ok && data.data?.hashtagPollsFeed) {\n        setHashtagPollsFeed({\n          user_id: userId,\n          hashtag_interests: data.data.hashtagPollsFeed.user_followed_hashtags || [],\n          recommended_polls: data.data.hashtagPollsFeed.recommended_polls || [],\n          trending_hashtags: data.data.hashtagPollsFeed.trending_hashtags || [],\n          hashtag_analytics: data.data.hashtagPollsFeed.hashtag_analytics || [],\n          feed_score: data.data.hashtagPollsFeed.feed_score || 0,\n          last_updated: new Date()\n        });\n      }\n    } catch (error) {\n      logger.warn('Failed to load hashtag-polls feed:', { error: error as Error });\n    }\n  }, [userId, enableHashtagPolls]);\n\n  // Load feed data\n  const loadFeedData = useCallback(async () => {\n    try {\n      await loadFeeds();\n      await loadHashtagPollsFeed();\n      setLastUpdate(new Date());\n    } catch (error) {\n      logger.error('Failed to load feed data:', error as Error);\n    }\n  }, [loadFeeds, loadHashtagPollsFeed]);\n\n  // Initialize feed data\n  useEffect(() => {\n    if (userId) {\n      loadFeedData();\n    }\n  }, [userId, loadFeedData]);\n\n  // Load trending hashtags\n  useEffect(() => {\n    if (showTrending) {\n      getTrendingHashtags();\n    }\n  }, [showTrending, getTrendingHashtags]);\n\n  // Filtered feed items based on hashtag selection\n  const filteredFeedItems = useMemo(() => {\n    let filtered = feeds || [];\n\n    // Filter by selected hashtags\n    if (selectedHashtags.length > 0) {\n      filtered = filtered.filter(item => \n        selectedHashtags.some(hashtag => \n          (item as any).hashtags?.includes(hashtag)\n        )\n      );\n    }\n\n    // Filter by search query\n    if (searchQuery) {\n      filtered = filtered.filter(item => \n        item.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        (item as any).description?.toLowerCase().includes(searchQuery.toLowerCase())\n      );\n    }\n\n    return filtered.slice(0, maxItems);\n  }, [feeds, selectedHashtags, searchQuery, maxItems]);\n\n  // Handle hashtag selection\n  const handleHashtagSelect = useCallback((hashtag: string) => {\n    setSelectedHashtags(prev => {\n      if (prev.includes(hashtag)) {\n        return prev.filter(h => h !== hashtag);\n      } else {\n        return [...prev, hashtag];\n      }\n    });\n    onHashtagSelect?.(hashtag);\n  }, [onHashtagSelect]);\n\n  // Handle poll selection\n  const handlePollSelect = useCallback((pollId: string) => {\n    onPollSelect?.(pollId);\n  }, [onPollSelect]);\n\n  // Analytics tracking (from EnhancedSocialFeed.tsx)\n  const trackEvent = useCallback((event: string, data?: any) => {\n    if (enableAnalytics) {\n      logger.info('Analytics:', { event, data });\n      \n      try {\n        // Track social media click event\n        if (typeof window !== 'undefined' && (window as any).gtag) {\n          (window as any).gtag('event', 'social_media_click', {\n            event_category: 'civics',\n            event_label: data?.platform ?? 'unknown',\n            value: 1\n          });\n        }\n        \n        // Track in local analytics if available\n        if (typeof window !== 'undefined' && (window as any).analytics) {\n          (window as any).analytics.track('Social Media Clicked', {\n            platform: data?.platform ?? 'unknown',\n            handle: data?.handle ?? 'unknown',\n            url: data?.url ?? 'unknown',\n            representative: data?.representative ?? 'unknown'\n          });\n        }\n      } catch (error) {\n        console.warn('Analytics tracking failed:', error);\n      }\n    }\n  }, [enableAnalytics]);\n\n  // Enhanced engagement tracking\n  const trackEngagement = useCallback((action: string, itemId: string, metadata?: any) => {\n    trackEvent(`feed_item_${action}`, { itemId, ...metadata });\n    \n    // Update personalization score based on engagement\n    if (action === 'liked' || action === 'bookmarked') {\n      setPersonalizationScore(prev => Math.min(prev + 0.1, 1.0));\n    }\n  }, [trackEvent]);\n\n  // Handle feed item interactions\n  const handleLike = useCallback(async (itemId: string) => {\n    try {\n      await likeFeed(itemId);\n      onLike?.(itemId);\n      \n      if (enableHaptics && 'vibrate' in navigator) {\n        navigator.vibrate(50);\n      }\n      \n      trackEngagement('liked', itemId);\n      announceToScreenReader(`Liked item ${itemId}`);\n    } catch (error) {\n      logger.error('Failed to like item:', error as Error);\n      setError('Failed to like item');\n    }\n  }, [likeFeed, onLike, enableHaptics, trackEngagement, announceToScreenReader, setError]);\n\n  const handleBookmark = useCallback(async (itemId: string) => {\n    try {\n      await bookmarkFeed(itemId);\n      onBookmark?.(itemId);\n      \n      if (enableHaptics && 'vibrate' in navigator) {\n        navigator.vibrate(50);\n      }\n      \n      trackEngagement('bookmarked', itemId);\n      announceToScreenReader(`Bookmarked item ${itemId}`);\n    } catch (error) {\n      logger.error('Failed to bookmark item:', error as Error);\n      setError('Failed to bookmark item');\n    }\n  }, [bookmarkFeed, onBookmark, enableHaptics, trackEngagement, announceToScreenReader, setError]);\n\n  const handleShare = useCallback((itemId: string) => {\n    if (enableHaptics && 'vibrate' in navigator) {\n      navigator.vibrate(25);\n    }\n    onShare?.(itemId);\n    \n    // Native sharing if available\n    if (navigator.share) {\n      const item = feeds.find((item: any) => item.id === itemId);\n      if (item) {\n        navigator.share({\n          title: item.title,\n          text: (item as any).description || '',\n          url: window.location.href\n        }).catch((error) => {\n          console.warn('Share failed:', error);\n        });\n      }\n    }\n    \n    trackEngagement('shared', itemId);\n    announceToScreenReader(`Shared item ${itemId}`);\n  }, [onShare, enableHaptics, feeds, trackEngagement, announceToScreenReader]);\n\n  const handleComment = useCallback((itemId: string) => {\n    if (enableHaptics && 'vibrate' in navigator) {\n      navigator.vibrate(25);\n    }\n    onComment?.(itemId);\n    \n    trackEngagement('commented', itemId);\n    announceToScreenReader(`Opened comments for item ${itemId}`);\n  }, [onComment, enableHaptics, trackEngagement, announceToScreenReader]);\n\n  const handleViewDetails = useCallback((itemId: string) => {\n    onViewDetails?.(itemId);\n    \n    trackEngagement('viewed_details', itemId);\n    announceToScreenReader(`Viewing details for item ${itemId}`);\n  }, [onViewDetails, trackEngagement, announceToScreenReader]);\n\n  // Infinite scroll setup\n  useEffect(() => {\n    if (observerRef.current) {\n      observerRef.current.disconnect();\n    }\n\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        if (entries[0]?.isIntersecting && hasMore && !isLoading) {\n          handleLoadMore();\n        }\n      },\n      { threshold: 0.1 }\n    );\n\n    if (lastItemRef.current) {\n      observerRef.current.observe(lastItemRef.current);\n    }\n\n    return () => {\n      if (observerRef.current) {\n        observerRef.current.disconnect();\n      }\n    };\n  }, [hasMore, isLoading]);\n\n  // Load more functionality\n  const handleLoadMore = useCallback(async () => {\n    if (hasMore && !isLoading) {\n      setPage(prev => prev + 1);\n      await loadFeeds('all');\n      setHasMore(feeds.length === 20); // Adjust based on your pagination\n    }\n  }, [hasMore, isLoading, loadFeeds, feeds.length]);\n\n  // Scroll to top functionality\n  const scrollToTop = useCallback(() => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n    announceToScreenReader('Scrolled to top');\n  }, [announceToScreenReader]);\n\n  // Dark mode toggle - moved to later in file\n\n  // Refresh functionality\n  const handleRefresh = useCallback(async () => {\n    setIsRefreshing(true);\n    try {\n      await refreshFeeds();\n      await loadHashtagPollsFeed();\n      setLastUpdate(new Date());\n      announceToScreenReader('Feed refreshed');\n    } catch (error) {\n      logger.error('Failed to refresh feeds:', error as Error);\n      setError('Failed to refresh feed');\n    } finally {\n      setIsRefreshing(false);\n    }\n  }, [refreshFeeds, loadHashtagPollsFeed, announceToScreenReader, setError]);\n\n  // Real-time updates with WebSocket (from EnhancedSocialFeed.tsx)\n  useEffect(() => {\n    if (enableRealTimeUpdates && userId) {\n      // WebSocket connection for real-time updates\n      const ws = new WebSocket(`wss://your-websocket-endpoint/feed/${userId}`);\n      wsRef.current = ws;\n\n      ws.onmessage = (event) => {\n        const data = JSON.parse(event.data);\n        if (data.label === 'new_item') {\n          logger.info('New item received:', data.item);\n          announceToScreenReader('New content available');\n        } else if (data.label === 'engagement_update') {\n          logger.info('Engagement update received:', data);\n          announceToScreenReader('Engagement updated');\n        }\n      };\n\n      // Fallback polling for updates\n      refreshIntervalRef.current = setInterval(() => {\n        handleRefresh();\n      }, 30000); // Refresh every 30 seconds\n\n      return () => {\n        ws.close();\n        if (refreshIntervalRef.current) {\n          clearInterval(refreshIntervalRef.current);\n        }\n      };\n    }\n  }, [enableRealTimeUpdates, userId, handleRefresh, announceToScreenReader]);\n\n  // Initialize PWA features on mount\n  useEffect(() => {\n    const initializeApp = async () => {\n      try {\n        if (typeof window !== 'undefined') {\n          await initializeSuperiorPWAFeatures();\n          checkOnlineStatus();\n        }\n      } catch (error) {\n        console.error('Error initializing app:', error);\n        setError('Failed to initialize app features');\n      }\n    };\n    \n    const timeoutId = setTimeout(initializeApp, 0);\n    return () => clearTimeout(timeoutId);\n  }, [initializeSuperiorPWAFeatures, checkOnlineStatus, setError]);\n\n  // Content type icons (from FeedItem.tsx)\n  const getContentTypeIcon = useCallback((type: string) => {\n    const iconClass = \"w-5 h-5\";\n    \n    switch (type) {\n      case 'vote':\n        return <div className={`${iconClass} bg-green-100 rounded-full flex items-center justify-center`}>\n          <span className=\"text-green-600 text-xs font-bold\">V</span>\n        </div>;\n      case 'bill':\n        return <div className={`${iconClass} bg-blue-100 rounded-full flex items-center justify-center`}>\n          <span className=\"text-blue-600 text-xs font-bold\">B</span>\n        </div>;\n      case 'statement':\n        return <div className={`${iconClass} bg-purple-100 rounded-full flex items-center justify-center`}>\n          <span className=\"text-purple-600 text-xs font-bold\">S</span>\n        </div>;\n      case 'social_media':\n        return <div className={`${iconClass} bg-pink-100 rounded-full flex items-center justify-center`}>\n          <span className=\"text-pink-600 text-xs font-bold\">@</span>\n        </div>;\n      case 'photo':\n        return <div className={`${iconClass} bg-gray-100 rounded-full flex items-center justify-center`}>\n          <span className=\"text-gray-600 text-xs font-bold\">ðŸ“·</span>\n        </div>;\n      default:\n        return <div className={`${iconClass} bg-gray-100 rounded-full flex items-center justify-center`}>\n          <span className=\"text-gray-600 text-xs font-bold\">?</span>\n        </div>;\n    }\n  }, []);\n\n  // Party colors (from FeedItem.tsx)\n  const getPartyColor = useCallback((party: string) => {\n    const partyColors: Record<string, string> = {\n      'Republican': 'text-red-600 bg-red-50 border-red-200',\n      'Democrat': 'text-blue-600 bg-blue-50 border-blue-200',\n      'Independent': 'text-gray-600 bg-gray-50 border-gray-200',\n      'Green': 'text-green-600 bg-green-50 border-green-200',\n      'Libertarian': 'text-yellow-600 bg-yellow-50 border-yellow-200'\n    };\n    \n    return partyColors[party] ?? 'text-gray-600 bg-gray-50 border-gray-200';\n  }, []);\n\n  // Format date (from FeedItem.tsx)\n  const formatDate = useCallback((date: Date | string | null | undefined) => {\n    if (!date) return 'Unknown date';\n    \n    const now = new Date();\n    const dateObj = typeof date === 'string' ? new Date(date) : date;\n    \n    if (!dateObj || isNaN(dateObj.getTime())) {\n      return 'Invalid date';\n    }\n    \n    const diffInHours = Math.floor((now.getTime() - dateObj.getTime()) / (1000 * 60 * 60));\n    \n    if (diffInHours < 1) return 'Just now';\n    if (diffInHours < 24) return `${diffInHours}h ago`;\n    if (diffInHours < 48) return 'Yesterday';\n    return new Date(date).toLocaleDateString();\n  }, []);\n\n  // Personalization algorithms (from EnhancedSocialFeed.tsx)\n  const calculatePersonalizationScore = useCallback((userInterests: string[], contentTags: string[]) => {\n    if (!userInterests.length || !contentTags.length) return 0;\n    \n    const matchingTags = contentTags.filter(tag => \n      userInterests.some(interest => \n        interest.toLowerCase().includes(tag.toLowerCase()) ||\n        tag.toLowerCase().includes(interest.toLowerCase())\n      )\n    );\n    \n    return matchingTags.length / Math.max(userInterests.length, contentTags.length);\n  }, []);\n\n  // Progressive disclosure functionality\n  const toggleItemExpansion = useCallback((itemId: string) => {\n    setExpandedItems(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(itemId)) {\n        newSet.delete(itemId);\n        announceToScreenReader(`Collapsed item ${itemId}`);\n      } else {\n        newSet.add(itemId);\n        announceToScreenReader(`Expanded item ${itemId}`);\n      }\n      return newSet;\n    });\n  }, [announceToScreenReader]);\n\n  // Image loading with progressive enhancement\n  const handleImageLoad = useCallback((itemId: string) => {\n    setLoadingImages(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(itemId);\n      return newSet;\n    });\n  }, []);\n\n  const handleImageError = useCallback((itemId: string) => {\n    setLoadingImages(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(itemId);\n      return newSet;\n    });\n    setError(`Failed to load image for item ${itemId}`);\n  }, [setError]);\n\n  // Lazy loading for images\n  const loadImage = useCallback((itemId: string, imageUrl: string) => {\n    setLoadingImages(prev => new Set(prev).add(itemId));\n    \n    const img = new window.Image();\n    img.onload = () => handleImageLoad(itemId);\n    img.onerror = () => handleImageError(itemId);\n    img.src = imageUrl;\n  }, [handleImageLoad, handleImageError]);\n\n  // Pull-to-refresh functionality\n  const handlePullToRefresh = useCallback(async () => {\n    if (isRefreshing) return;\n    \n    setIsRefreshing(true);\n    announceToScreenReader('Refreshing feed...');\n    \n    try {\n      // Refresh feed data\n      await refreshFeeds();\n      \n      // Reset pagination\n      setPage(1);\n      setHasMore(true);\n      \n      // Clear expanded items\n      setExpandedItems(new Set());\n      \n      // Announce success\n      announceToScreenReader('Feed refreshed successfully');\n      \n      // Haptic feedback\n      if (enableHaptics && 'vibrate' in navigator) {\n        navigator.vibrate([50, 100, 50]);\n      }\n    } catch (error) {\n      console.error('Pull to refresh failed:', error);\n      announceToScreenReader('Failed to refresh feed');\n      setError('Failed to refresh feed');\n    } finally {\n      setIsRefreshing(false);\n    }\n  }, [isRefreshing, refreshFeeds, announceToScreenReader, enableHaptics, setError]);\n\n  // Enhanced touch handling for pull-to-refresh\n  const handleTouchStart = useCallback((e: React.TouchEvent) => {\n    if (window.scrollY === 0 && e.touches[0]) {\n      touchStartRef.current = {\n        x: e.touches[0].clientX,\n        y: e.touches[0].clientY,\n        time: Date.now()\n      };\n    }\n  }, []);\n\n  const handleTouchMove = useCallback((e: React.TouchEvent) => {\n    if (!touchStartRef.current || window.scrollY > 0 || !e.touches[0]) return;\n    \n    const touch = e.touches[0];\n    const deltaY = touch.clientY - touchStartRef.current.y;\n    \n    if (deltaY > 0) {\n      const distance = Math.min(deltaY * 0.5, refreshThreshold);\n      setPullDistance(distance);\n      \n      if (distance >= refreshThreshold && !isRefreshing) {\n        announceToScreenReader('Release to refresh');\n      }\n    }\n  }, [refreshThreshold, isRefreshing, announceToScreenReader]);\n\n  const handleTouchEnd = useCallback((e: React.TouchEvent) => {\n    if (!touchStartRef.current || !e.changedTouches[0]) return;\n    \n    const touch = e.changedTouches[0];\n    const deltaY = touch.clientY - touchStartRef.current.y;\n    const deltaTime = Date.now() - touchStartRef.current.time;\n    \n    if (deltaY >= refreshThreshold && deltaTime < 1000 && window.scrollY === 0) {\n      handlePullToRefresh();\n    }\n    \n    setPullDistance(0);\n    touchStartRef.current = null;\n  }, [refreshThreshold, handlePullToRefresh]);\n\n  // Dark mode functionality\n  const toggleDarkMode = useCallback(() => {\n    setIsDarkMode(prev => {\n      const newMode = !prev;\n      \n      // Update document class for global dark mode\n      if (newMode) {\n        document.documentElement.classList.add('dark');\n      } else {\n        document.documentElement.classList.remove('dark');\n      }\n      \n      // Store preference in localStorage\n      localStorage.setItem('darkMode', newMode.toString());\n      \n      // Announce to screen reader\n      announceToScreenReader(`Switched to ${newMode ? 'dark' : 'light'} mode`);\n      \n      // Haptic feedback\n      if (enableHaptics && 'vibrate' in navigator) {\n        navigator.vibrate(25);\n      }\n      \n      return newMode;\n    });\n  }, [announceToScreenReader, enableHaptics]);\n\n  // Initialize dark mode from localStorage and system preference\n  useEffect(() => {\n    const stored = localStorage.getItem('darkMode');\n    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n    const shouldBeDark = stored ? stored === 'true' : systemPrefersDark;\n    \n    setIsDarkMode(shouldBeDark);\n    \n    if (shouldBeDark) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }, []);\n\n  return (\n    <div \n      ref={feedRef}\n      className={cn(\n        \"space-y-6 transition-colors duration-300\",\n        isDarkMode ? \"bg-gray-900 text-white\" : \"bg-white text-gray-900\",\n        className\n      )} \n      role=\"main\" \n      aria-label=\"Unified Feed\"\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    >\n      {/* Pull-to-refresh indicator */}\n      {pullDistance > 0 && (\n        <div \n          className=\"fixed top-0 left-0 right-0 z-50 bg-blue-500 text-white text-center py-2 transition-transform duration-200\"\n          style={{ transform: `translateY(${Math.max(0, pullDistance - 50)}px)` }}\n          role=\"status\"\n          aria-live=\"polite\"\n        >\n          {pullDistance >= refreshThreshold ? 'Release to refresh' : 'Pull to refresh'}\n        </div>\n      )}\n\n      {/* Status Bar with PWA indicators */}\n      <div className=\"bg-blue-50 dark:bg-blue-900 border-b border-gray-200 dark:border-gray-700 p-2\">\n        <div className=\"flex items-center justify-between text-sm\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex items-center space-x-1\" role=\"status\" aria-live=\"polite\">\n              <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" aria-hidden=\"true\"></div>\n              <span className=\"text-green-600\">Online</span>\n            </div>\n            {syncStatus === 'syncing' && (\n              <div className=\"flex items-center space-x-1\" role=\"status\" aria-live=\"polite\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500\" aria-hidden=\"true\"></div>\n                <span className=\"text-blue-600\">Syncing...</span>\n              </div>\n            )}\n            {isRefreshing && (\n              <div className=\"flex items-center space-x-1\" role=\"status\" aria-live=\"polite\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500\" aria-hidden=\"true\"></div>\n                <span className=\"text-blue-600\">Refreshing...</span>\n              </div>\n            )}\n          </div>\n          {lastSync && (\n            <span className=\"text-gray-500\">\n              Last sync: {lastSync.toLocaleTimeString()}\n            </span>\n          )}\n        </div>\n      </div>\n\n      {/* Header with feed controls */}\n      <header className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Unified Feed</h1>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            Personalized content with hashtag-polls integration\n            {personalizationScore > 0 && (\n              <span className=\"flex items-center space-x-1 ml-2\">\n                <span className=\"w-2 h-2 bg-blue-500 rounded-full animate-pulse\" aria-hidden=\"true\"></span>\n                <span>Personalized ({Math.round(personalizationScore * 100)}% match)</span>\n              </span>\n            )}\n          </p>\n        </div>\n        <div className=\"flex items-center space-x-4\">\n          {/* Dark mode toggle */}\n          <button\n            onClick={toggleDarkMode}\n            className=\"p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\n            aria-label={`Switch to ${isDarkMode ? 'light' : 'dark'} mode`}\n          >\n            {isDarkMode ? (\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\" />\n              </svg>\n            ) : (\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\n              </svg>\n            )}\n          </button>\n\n          {/* Advanced filters toggle */}\n          <button\n            onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}\n            className=\"p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\n            aria-label=\"Toggle advanced filters\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4\" />\n            </svg>\n          </button>\n\n          {/* Refresh button */}\n          <button\n            onClick={handleRefresh}\n            disabled={isRefreshing}\n            className=\"p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors disabled:opacity-50\"\n            aria-label=\"Refresh feed\"\n          >\n            <svg className={`w-5 h-5 ${isRefreshing ? 'animate-spin' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n            </svg>\n          </button>\n\n          {enableAnalytics && (\n            <div className=\"text-right\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Personalization</p>\n              <p className=\"text-lg font-semibold text-blue-600\">\n                {Math.round(personalizationScore * 100)}%\n              </p>\n            </div>\n          )}\n          <Button\n            onClick={handleRefresh}\n            disabled={isRefreshing}\n            variant=\"outline\"\n            size=\"sm\"\n            aria-label={isRefreshing ? \"Refreshing feed\" : \"Refresh feed\"}\n            aria-describedby=\"refresh-status\"\n          >\n            <ArrowPathIcon className={cn(\"h-4 w-4\", isRefreshing && \"animate-spin\")} />\n            {isRefreshing ? \"Refreshing...\" : \"Refresh\"}\n          </Button>\n          <div id=\"refresh-status\" className=\"sr-only\">\n            {isRefreshing ? \"Feed is being refreshed\" : \"Click to refresh the feed\"}\n          </div>\n        </div>\n      </header>\n\n      {/* Advanced Filters Section */}\n      {showAdvancedFilters && (\n        <div \n          className=\"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\"\n          role=\"complementary\"\n          aria-label=\"Advanced filter options\"\n        >\n          <h4 className=\"text-sm font-medium text-gray-900 dark:text-white mb-2\">Advanced Filters</h4>\n          <div className=\"space-y-2\">\n            <label className=\"block text-sm text-gray-600 dark:text-gray-400\">\n              <input type=\"checkbox\" className=\"mr-2\" /> Federal Representatives\n            </label>\n            <label className=\"block text-sm text-gray-600 dark:text-gray-400\">\n              <input type=\"checkbox\" className=\"mr-2\" /> State Representatives\n            </label>\n            <label className=\"block text-sm text-gray-600 dark:text-gray-400\">\n              <input type=\"checkbox\" className=\"mr-2\" /> Local Representatives\n            </label>\n            <label className=\"block text-sm text-gray-600 dark:text-gray-400\">\n              <input type=\"checkbox\" className=\"mr-2\" /> Trending Content\n            </label>\n            <label className=\"block text-sm text-gray-600 dark:text-gray-400\">\n              <input type=\"checkbox\" className=\"mr-2\" /> Hashtag-Polls Integration\n            </label>\n          </div>\n        </div>\n      )}\n\n      {/* Pull-to-refresh indicator */}\n      {pullDistance > 0 && (\n        <div className=\"flex items-center justify-center py-4 text-gray-500\">\n          <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500\"></div>\n          <span className=\"ml-2\">Pull to refresh...</span>\n        </div>\n      )}\n\n      {/* Hashtag filters and search */}\n      <Card role=\"region\" aria-label=\"Content filters\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <HashtagIcon className=\"h-5 w-5\" aria-hidden=\"true\" />\n            Content Filters\n            {selectedHashtags.length > 0 && (\n              <Badge variant=\"secondary\" aria-label={`${selectedHashtags.length} hashtags selected`}>\n                {selectedHashtags.length}\n              </Badge>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {/* Search */}\n            <div className=\"relative\">\n              <label htmlFor=\"content-search\" className=\"sr-only\">\n                Search content\n              </label>\n              <Input\n                id=\"content-search\"\n                placeholder=\"Search content...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n                aria-describedby=\"search-help\"\n              />\n              <HashtagIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" aria-hidden=\"true\" />\n              <div id=\"search-help\" className=\"sr-only\">\n                Search through feed content by title or description\n              </div>\n            </div>\n\n            {/* Selected hashtags */}\n            {selectedHashtags.length > 0 && (\n              <div className=\"flex flex-wrap gap-2\" role=\"list\" aria-label=\"Selected hashtags\">\n                {selectedHashtags.map(hashtag => (\n                  <Badge\n                    key={hashtag}\n                    variant=\"default\"\n                    className=\"cursor-pointer hover:bg-red-100\"\n                    onClick={() => handleHashtagSelect(hashtag)}\n                    role=\"listitem\"\n                    tabIndex={0}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' || e.key === ' ') {\n                        e.preventDefault();\n                        handleHashtagSelect(hashtag);\n                      }\n                    }}\n                    aria-label={`Remove hashtag ${hashtag} from filters`}\n                  >\n                    #{hashtag} Ã—\n                  </Badge>\n                ))}\n              </div>\n            )}\n\n            {/* Trending hashtags */}\n            {showTrending && trendingHashtags.length > 0 && (\n              <div>\n                <p className=\"text-sm font-medium text-gray-700 mb-2\">Trending:</p>\n                <div className=\"flex flex-wrap gap-2\" role=\"list\" aria-label=\"Trending hashtags\">\n                  {trendingHashtags.slice(0, 10).map((hashtag: any) => (\n                    <Badge\n                      key={hashtag.name || hashtag}\n                      variant={selectedHashtags.includes(hashtag.name || hashtag) ? \"default\" : \"outline\"}\n                      className=\"cursor-pointer hover:bg-blue-100\"\n                      onClick={() => handleHashtagSelect(hashtag.name || hashtag)}\n                      role=\"listitem\"\n                      tabIndex={0}\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter' || e.key === ' ') {\n                          e.preventDefault();\n                          handleHashtagSelect(hashtag.name || hashtag);\n                        }\n                      }}\n                      aria-label={`${selectedHashtags.includes(hashtag.name || hashtag) ? 'Remove' : 'Add'} hashtag ${hashtag.name || hashtag} ${selectedHashtags.includes(hashtag.name || hashtag) ? 'from' : 'to'} filters`}\n                    >\n                      <ArrowTrendingUpIcon className=\"h-3 w-3 mr-1\" aria-hidden=\"true\" />\n                      #{hashtag.name || hashtag}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Main content tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} role=\"tablist\" aria-label=\"Feed content sections\">\n        <TabsList className=\"grid w-full grid-cols-3\" role=\"tablist\">\n          <TabsTrigger value=\"feed\" role=\"tab\" aria-selected={activeTab === 'feed'} aria-controls=\"feed-panel\">\n            Feed\n          </TabsTrigger>\n          <TabsTrigger value=\"polls\" role=\"tab\" aria-selected={activeTab === 'polls'} aria-controls=\"polls-panel\">\n            Polls\n          </TabsTrigger>\n          <TabsTrigger value=\"analytics\" role=\"tab\" aria-selected={activeTab === 'analytics'} aria-controls=\"analytics-panel\">\n            Analytics\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Main feed */}\n        <TabsContent value=\"feed\" className=\"space-y-4\" id=\"feed-panel\" role=\"tabpanel\" aria-labelledby=\"feed-tab\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\" role=\"status\" aria-live=\"polite\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\" aria-hidden=\"true\"></div>\n              <span className=\"sr-only\">Loading feed content...</span>\n            </div>\n          ) : filteredFeedItems.length === 0 ? (\n            <Card role=\"status\" aria-live=\"polite\">\n              <CardContent className=\"p-6 text-center\">\n                <HashtagIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\n                <p className=\"text-gray-600\">No content matches your filters</p>\n                <Button \n                  variant=\"outline\" \n                  onClick={() => {\n                    setSelectedHashtags([]);\n                    setSearchQuery('');\n                  }}\n                  className=\"mt-4\"\n                  aria-label=\"Clear all filters to show all content\"\n                >\n                  Clear Filters\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-4\" role=\"feed\" aria-label=\"Feed content\">\n              {filteredFeedItems.map((item, index) => (\n                <article key={item.id} role=\"article\" aria-posinset={index + 1} aria-setsize={filteredFeedItems.length}>\n                  <FeedItem\n                    item={item as any}\n                    onLike={() => handleLike(item.id)}\n                    onBookmark={() => handleBookmark(item.id)}\n                    onShare={() => onShare?.(item.id)}\n                    onComment={() => onComment?.(item.id)}\n                    onViewDetails={() => onViewDetails?.(item.id)}\n                  />\n                </article>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        {/* Hashtag-polls integration */}\n        <TabsContent value=\"polls\" className=\"space-y-4\" id=\"polls-panel\" role=\"tabpanel\" aria-labelledby=\"polls-tab\">\n          {hashtagPollsFeed ? (\n            <div className=\"space-y-4\">\n              {hashtagPollsFeed.recommended_polls.map((poll: any) => (\n                <Card key={poll.poll_id} className=\"hover:shadow-md transition-shadow\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-start justify-between mb-4\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                          {poll.title}\n                        </h3>\n                        <p className=\"text-gray-600 mb-4\">{poll.description}</p>\n                        \n                        {/* Poll hashtags */}\n                        {poll.hashtags && poll.hashtags.length > 0 && (\n                          <div className=\"flex flex-wrap gap-2 mb-4\">\n                            {poll.hashtags.map((hashtag: any) => (\n                              <Badge\n                                key={hashtag}\n                                variant=\"outline\"\n                                className=\"cursor-pointer hover:bg-blue-100\"\n                                onClick={() => handleHashtagSelect(hashtag)}\n                              >\n                                #{hashtag}\n                              </Badge>\n                            ))}\n                          </div>\n                        )}\n\n                        {/* Poll metadata */}\n                        <div className=\"flex items-center space-x-4 text-sm text-gray-500\">\n                          <div className=\"flex items-center\">\n                            <UserGroupIcon className=\"h-4 w-4 mr-1\" />\n                            {poll.total_votes} votes\n                          </div>\n                          <div className=\"flex items-center\">\n                            <ClockIcon className=\"h-4 w-4 mr-1\" />\n                            {new Date(poll.created_at).toLocaleDateString()}\n                          </div>\n                          <div className=\"flex items-center\">\n                            <ChartBarIcon className=\"h-4 w-4 mr-1\" />\n                            {Math.round(poll.relevance_score * 100)}% match\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"text-sm text-gray-600\">\n                        {poll.reason}\n                      </div>\n                      <Button\n                        onClick={() => handlePollSelect(poll.poll_id)}\n                        className=\"ml-4\"\n                      >\n                        View Poll\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <Card>\n              <CardContent className=\"p-6 text-center\">\n                <HashtagIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-600\">No personalized polls available</p>\n                <p className=\"text-sm text-gray-500\">Follow some hashtags to get personalized recommendations</p>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        {/* Analytics */}\n        <TabsContent value=\"analytics\" className=\"space-y-4\">\n          {enableAnalytics && hashtagPollsFeed?.hashtag_analytics ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {hashtagPollsFeed.hashtag_analytics.map((analytic: any) => (\n                <Card key={analytic.hashtag}>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <HashtagIcon className=\"h-4 w-4\" />\n                      #{analytic.hashtag}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-sm text-gray-600\">Polls:</span>\n                        <span className=\"font-medium\">{analytic.poll_count}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-sm text-gray-600\">Engagement:</span>\n                        <span className=\"font-medium\">\n                          {Math.round(analytic.engagement_rate * 100)}%\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-sm text-gray-600\">Interest:</span>\n                        <span className=\"font-medium\">\n                          {Math.round(analytic.user_interest_level * 100)}%\n                        </span>\n                      </div>\n                      {analytic.trending_position > 0 && (\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-sm text-gray-600\">Trending:</span>\n                          <span className=\"font-medium text-green-600\">\n                            #{analytic.trending_position}\n                          </span>\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <Card>\n              <CardContent className=\"p-6 text-center\">\n                <ChartBarIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-600\">Analytics not available</p>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      {/* Scroll to top button */}\n      {feeds.length > 5 && (\n        <button\n          ref={scrollToTopRef}\n          onClick={scrollToTop}\n          className=\"fixed bottom-20 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors z-30 min-w-[44px] min-h-[44px]\"\n          aria-label=\"Scroll to top\"\n        >\n          <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 10l7-7m0 0l7 7m-7-7v18\" />\n          </svg>\n        </button>\n      )}\n\n      {/* Loading indicator for infinite scroll */}\n      {isLoading && (\n        <div className=\"flex items-center justify-center py-8\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n          <span className=\"ml-3 text-gray-500\">Loading more...</span>\n        </div>\n      )}\n\n      {/* End of feed indicator */}\n      {!hasMore && feeds.length > 0 && (\n        <div className=\"text-center py-8 text-gray-500\">\n          <p>You&apos;ve reached the end of the feed</p>\n          <p className=\"text-sm mt-1\">Check back later for more updates</p>\n        </div>\n      )}\n\n      {/* Last item ref for infinite scroll */}\n      <div ref={lastItemRef} className=\"h-1\" />\n\n      {/* Accessibility Announcements */}\n      <div \n        className=\"sr-only\" \n        aria-live=\"polite\" \n        aria-atomic=\"true\"\n      >\n        {accessibilityAnnouncements.map((announcement, index) => (\n          <div key={`announcement-${index}-${announcement.slice(0, 20)}`}>{announcement}</div>\n        ))}\n      </div>\n\n      {/* Dedicated Live Region for Dynamic Content */}\n      <div \n        className=\"sr-only\" \n        aria-live=\"polite\" \n        aria-atomic=\"true\"\n        id=\"live-region\"\n      >\n        <span id=\"live-region-content\"></span>\n      </div>\n\n      {/* Error Messages */}\n      {errorMessage && (\n        <div \n          role=\"alert\" \n          className=\"fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50\"\n        >\n          {errorMessage}\n          <button \n            onClick={clearError}\n            className=\"ml-2 text-red-700 hover:text-red-900 min-w-[44px] min-h-[44px]\"\n            aria-label=\"Close error message\"\n          >\n            Ã—\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["UnifiedFeed","userId","preferences","onLike","onShare","onBookmark","onComment","onViewDetails","onPollSelect","onHashtagSelect","className","enablePersonalization","enableRealTimeUpdates","enableAnalytics","enableHaptics","enableHashtagPolls","enableMobileOptimization","showTrending","maxItems","feeds","useFeeds","loadFeeds","likeFeed","bookmarkFeed","refreshFeeds","useFeedsActions","isLoading","useFeedsLoading","pwaStore","usePWAStore","user","useUserStore","addNotification","useNotificationStore","state","hashtags","trendingHashtags","useHashtagStore","getTrendingHashtags","useHashtagActions","trendingCount","useHashtagStats","activeTab","setActiveTab","useState","hashtagPollsFeed","setHashtagPollsFeed","selectedHashtags","setSelectedHashtags","searchQuery","setSearchQuery","isRefreshing","setIsRefreshing","personalizationScore","setPersonalizationScore","lastUpdate","setLastUpdate","Date","isDarkMode","setIsDarkMode","notificationPermission","setNotificationPermission","swRegistration","setSwRegistration","lastSync","setLastSync","syncStatus","setSyncStatus","showAdvancedFilters","setShowAdvancedFilters","accessibilityAnnouncements","setAccessibilityAnnouncements","errorMessage","setErrorMessage","showError","setShowError","pullDistance","setPullDistance","hasMore","setHasMore","page","setPage","expandedItems","setExpandedItems","Set","loadingImages","setLoadingImages","refreshThreshold","wsRef","useRef","refreshIntervalRef","touchStartRef","longPressTimerRef","feedRef","observerRef","lastItemRef","scrollToTopRef","initializeSuperiorPWAFeatures","useCallback","navigator","registration","serviceWorker","ready","window","permission","Notification","requestPermission","subscribeToNotifications","error","console","subscription","pushManager","subscribe","userVisibleOnly","applicationServerKey","process","env","NEXT_PUBLIC_VAPID_PUBLIC_KEY","fetch","method","headers","body","JSON","stringify","logger","info","checkOnlineStatus","handleOnline","syncOfflineData","handleOffline","addEventListener","removeEventListener","response","toISOString","ok","announceToScreenReader","message","prev","liveRegion","document","getElementById","textContent","setTimeout","slice","setError","clearError","loadHashtagPollsFeed","data","json","user_id","hashtag_interests","user_followed_hashtags","recommended_polls","trending_hashtags","hashtag_analytics","feed_score","last_updated","warn","loadFeedData","useEffect","filteredFeedItems","useMemo","filtered","length","filter","item","some","hashtag","includes","title","toLowerCase","description","handleHashtagSelect","h","handlePollSelect","pollId","trackEvent","event","gtag","event_category","event_label","platform","value","analytics","track","handle","url","representative","trackEngagement","action","itemId","metadata","Math","min","handleLike","vibrate","handleBookmark","handleShare","share","find","id","text","location","href","catch","handleComment","handleViewDetails","current","disconnect","IntersectionObserver","entries","isIntersecting","handleLoadMore","threshold","observe","scrollToTop","scrollTo","top","behavior","handleRefresh","ws","WebSocket","onmessage","parse","label","setInterval","close","clearInterval","initializeApp","timeoutId","clearTimeout","getContentTypeIcon","type","iconClass","div","span","getPartyColor","party","partyColors","formatDate","date","now","dateObj","isNaN","getTime","diffInHours","floor","toLocaleDateString","calculatePersonalizationScore","userInterests","contentTags","matchingTags","tag","interest","max","toggleItemExpansion","newSet","has","delete","add","handleImageLoad","handleImageError","loadImage","imageUrl","img","Image","onload","onerror","src","handlePullToRefresh","handleTouchStart","e","scrollY","touches","x","clientX","y","clientY","time","handleTouchMove","touch","deltaY","distance","handleTouchEnd","changedTouches","deltaTime","toggleDarkMode","newMode","documentElement","classList","remove","localStorage","setItem","toString","stored","getItem","systemPrefersDark","matchMedia","matches","shouldBeDark","ref","cn","role","aria-label","onTouchStart","onTouchMove","onTouchEnd","style","transform","aria-live","aria-hidden","toLocaleTimeString","header","h1","p","round","button","onClick","svg","fill","stroke","viewBox","path","strokeLinecap","strokeLinejoin","strokeWidth","d","disabled","Button","variant","size","aria-describedby","ArrowPathIcon","h4","input","Card","CardHeader","CardTitle","HashtagIcon","Badge","CardContent","htmlFor","Input","placeholder","onChange","target","map","tabIndex","onKeyDown","key","preventDefault","name","ArrowTrendingUpIcon","Tabs","onValueChange","TabsList","TabsTrigger","aria-selected","aria-controls","TabsContent","aria-labelledby","index","article","aria-posinset","aria-setsize","FeedItem","poll","h3","UserGroupIcon","total_votes","ClockIcon","created_at","ChartBarIcon","relevance_score","reason","poll_id","analytic","poll_count","engagement_rate","user_interest_level","trending_position","aria-atomic","announcement"],"mappings":"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"}
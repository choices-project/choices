{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/components/shared/FeatureWrapper.tsx"],"sourcesContent":["/**\n * @fileoverview Feature Wrapper Component\n * \n * React component that conditionally renders content based on feature flags.\n * Provides a clean way to wrap components or sections that depend on specific features.\n * \n * @author Choices Platform Team\n * @created 2025-10-24\n * @version 2.0.0\n * @since 1.0.0\n */\n\nimport type { ReactNode } from 'react';\nimport React from 'react';\n\nimport { useFeatureFlag, useFeatureFlagsBatch, useFeatureFlagWithDependencies, useFeatureFlags } from '@/features/pwa/hooks/useFeatureFlags';\n\nexport interface FeatureWrapperProps {\n  /** Feature flag ID to check */\n  feature: string;\n  /** Content to render when feature is enabled */\n  children: ReactNode;\n  /** Content to render when feature is disabled (optional) */\n  fallback?: ReactNode;\n  /** Whether to show loading state while checking flag */\n  showLoading?: boolean;\n  /** Loading component to show */\n  loadingComponent?: ReactNode;\n  /** Whether to render nothing when disabled (default: false) */\n  hideWhenDisabled?: boolean;\n  /** Additional CSS classes */\n  className?: string;\n  /** Additional styles */\n  style?: React.CSSProperties;\n}\n\n/**\n * Wrapper component for a single feature flag\n * \n * @param {FeatureWrapperProps} props - Component props\n * @returns {React.ReactElement | null} Rendered component or null\n * \n * @example\n * <FeatureWrapper feature=\"new-feature\">\n *   <NewFeatureComponent />\n * </FeatureWrapper>\n */\nexport function FeatureWrapper({\n  feature,\n  children,\n  fallback = null,\n  showLoading = false,\n  loadingComponent = <div>Loading...</div>,\n  hideWhenDisabled = false,\n  className,\n  style\n}: FeatureWrapperProps): React.ReactElement | null {\n  const { enabled, disabled: _disabled, loading } = useFeatureFlag(feature);\n\n  // Show loading state if requested and loading\n  if (showLoading && loading) {\n    return <>{loadingComponent}</>;\n  }\n\n  // If feature is enabled, render children\n  if (enabled) {\n    return (\n      <div className={className} style={style}>\n        {children}\n      </div>\n    );\n  }\n\n  // If feature is disabled\n  if (hideWhenDisabled) {\n    return null;\n  }\n\n  // Render fallback if provided\n  return (\n    <div className={className} style={style}>\n      {fallback}\n    </div>\n  );\n}\n\nexport interface FeatureWrapperBatchProps {\n  /** Array of feature flag IDs to check */\n  features: string[];\n  /** Content to render when all features are enabled */\n  children: ReactNode;\n  /** Content to render when any feature is disabled (optional) */\n  fallback?: ReactNode;\n  /** Whether to render when any feature is enabled (default: false, requires all) */\n  anyEnabled?: boolean;\n  /** Whether to show loading state while checking flags */\n  showLoading?: boolean;\n  /** Loading component to show */\n  loadingComponent?: ReactNode;\n  /** Whether to render nothing when conditions not met */\n  hideWhenDisabled?: boolean;\n  /** Additional CSS classes */\n  className?: string;\n  /** Additional styles */\n  style?: React.CSSProperties;\n}\n\n/**\n * Wrapper component for multiple feature flags\n * \n * @param {FeatureWrapperBatchProps} props - Component props\n * @returns {React.ReactElement | null} Rendered component or null\n * \n * @example\n * <FeatureWrapperBatch features={[\"feature1\", \"feature2\"]}>\n *   <MultipleFeatureComponent />\n * </FeatureWrapperBatch>\n */\nexport function FeatureWrapperBatch({\n  features,\n  children,\n  fallback = null,\n  anyEnabled = false,\n  showLoading = false,\n  loadingComponent = <div>Loading...</div>,\n  hideWhenDisabled = false,\n  className,\n  style\n}: FeatureWrapperBatchProps): React.ReactElement | null {\n  const { allEnabled, anyEnabled: anyEnabledResult, loading } = useFeatureFlagsBatch(features);\n\n  // Show loading state if requested and loading\n  if (showLoading && loading) {\n    return <>{loadingComponent}</>;\n  }\n\n  // Check if conditions are met\n  const shouldRender = anyEnabled ? anyEnabledResult : allEnabled;\n\n  // If conditions are met, render children\n  if (shouldRender) {\n    return (\n      <div className={className} style={style}>\n        {children}\n      </div>\n    );\n  }\n\n  // If conditions are not met\n  if (hideWhenDisabled) {\n    return null;\n  }\n\n  // Render fallback if provided\n  return (\n    <div className={className} style={style}>\n      {fallback}\n    </div>\n  );\n}\n\nexport interface FeatureWrapperWithDependenciesProps {\n  /** Feature flag ID to check */\n  feature: string;\n  /** Content to render when feature is enabled and dependencies are met */\n  children: ReactNode;\n  /** Content to render when feature is disabled (optional) */\n  fallback?: ReactNode;\n  /** Content to render when dependencies are not met (optional) */\n  dependenciesFallback?: ReactNode;\n  /** Whether to show loading state while checking flag */\n  showLoading?: boolean;\n  /** Loading component to show */\n  loadingComponent?: ReactNode;\n  /** Whether to render nothing when disabled */\n  hideWhenDisabled?: boolean;\n  /** Additional CSS classes */\n  className?: string;\n  /** Additional styles */\n  style?: React.CSSProperties;\n}\n\n/**\n * Wrapper component for feature flags with dependencies\n * \n * @param {FeatureWrapperWithDependenciesProps} props - Component props\n * @returns {React.ReactElement | null} Rendered component or null\n * \n * @example\n * <FeatureWrapperWithDependencies feature=\"main-feature\">\n *   <MainFeatureComponent />\n * </FeatureWrapperWithDependencies>\n */\nexport function FeatureWrapperWithDependencies({\n  feature,\n  children,\n  fallback = null,\n  dependenciesFallback = null,\n  showLoading = false,\n  loadingComponent = <div>Loading...</div>,\n  hideWhenDisabled = false,\n  className,\n  style\n}: FeatureWrapperWithDependenciesProps): React.ReactElement | null {\n  const { enabled, disabled: _disabled, dependenciesMet, loading } = useFeatureFlagWithDependencies(feature);\n\n  // Show loading state if requested and loading\n  if (showLoading && loading) {\n    return <>{loadingComponent}</>;\n  }\n\n  // If feature is enabled and dependencies are met, render children\n  if (enabled && dependenciesMet) {\n    return (\n      <div className={className} style={style}>\n        {children}\n      </div>\n    );\n  }\n\n  // If dependencies are not met, render dependencies fallback\n  if (!dependenciesMet && dependenciesFallback !== null) {\n    return (\n      <div className={className} style={style}>\n        {dependenciesFallback}\n      </div>\n    );\n  }\n\n  // If feature is disabled\n  if (hideWhenDisabled) {\n    return null;\n  }\n\n  // Render fallback if provided\n  return (\n    <div className={className} style={style}>\n      {fallback}\n    </div>\n  );\n}\n\n/**\n * Higher-order component for wrapping components with a single feature flag\n * \n * @param {React.ComponentType<P>} WrappedComponent - Component to wrap\n * @param {string} feature - Feature flag to check\n * @param {React.ComponentType<P>} [fallback] - Fallback component when feature is disabled\n * @returns {React.ComponentType<P>} Wrapped component\n * \n * @example\n * const MyComponent = withFeatureFlag(MyComponent, 'new-feature');\n */\nexport function withFeatureFlag<P extends object>(\n  WrappedComponent: React.ComponentType<P>,\n  feature: string,\n  fallback?: React.ComponentType<P>\n) {\n  return function WithFeatureFlagComponent(props: P): React.ReactElement | null {\n    const { enabled, disabled: _disabled, loading } = useFeatureFlag(feature);\n\n    if (loading) {\n      return <div>Loading...</div>;\n    }\n\n    if (enabled) {\n      return <WrappedComponent {...props} />;\n    }\n\n    if (fallback) {\n      const FallbackComponent = fallback;\n      return <FallbackComponent {...props} />;\n    }\n\n    return null;\n  };\n}\n\n/**\n * Higher-order component for wrapping components with multiple feature flags\n * \n * @param {React.ComponentType<P>} WrappedComponent - Component to wrap\n * @param {string[]} features - Feature flags to check\n * @param {React.ComponentType<P>} [fallback] - Fallback component when features are disabled\n * @param {boolean} [anyEnabled] - Whether any feature needs to be enabled (default: false)\n * @returns {React.ComponentType<P>} Wrapped component\n * \n * @example\n * const MyComponent = withFeatureFlagsBatch(MyComponent, ['feature1', 'feature2']);\n */\nexport function withFeatureFlagsBatch<P extends object>(\n  WrappedComponent: React.ComponentType<P>,\n  features: string[],\n  fallback?: React.ComponentType<P>,\n  anyEnabled = false\n) {\n  return function WithFeatureFlagsBatchComponent(props: P): React.ReactElement | null {\n    const { anyEnabled: anyEnabledResult, loading } = useFeatureFlagsBatch(features);\n\n    if (loading) {\n      return <div>Loading...</div>;\n    }\n\n    const shouldRender = anyEnabled ? anyEnabledResult : true;\n\n    if (shouldRender) {\n      return <WrappedComponent {...props} />;\n    }\n\n    if (fallback) {\n      const FallbackComponent = fallback;\n      return <FallbackComponent {...props} />;\n    }\n\n    return null;\n  };\n}\n\n/**\n * Utility component for debugging feature flags\n * \n * @returns {React.ReactElement} Debug component showing feature flag status\n * \n * @example\n * <FeatureFlagDebugger />\n */\nexport function FeatureFlagDebugger(): React.ReactElement {\n  const { getAllFlags, systemInfo, isLoading } = useFeatureFlags();\n  \n  if (isLoading) {\n    return <div>Loading feature flags...</div>;\n  }\n\n  const flags = Array.from(getAllFlags().values());\n\n  return (\n    <div style={{ padding: '1rem', border: '1px solid #ccc', borderRadius: '4px', margin: '1rem 0' }}>\n      <h3>Feature Flags Debugger</h3>\n      <div>\n        <strong>System Info:</strong>\n        <ul>\n          <li>Total Flags: {systemInfo.totalFlags}</li>\n          <li>Enabled: {systemInfo.enabledFlags}</li>\n          <li>Disabled: {systemInfo.disabledFlags}</li>\n          <li>Environment: {systemInfo.environment}</li>\n        </ul>\n      </div>\n      <div>\n        <strong>Flags:</strong>\n        <ul>\n          {flags.map(flag => (\n            <li key={flag.id} style={{ color: flag.enabled ? 'green' : 'red' }}>\n              {flag.name} ({flag.id}): {flag.enabled ? 'ENABLED' : 'DISABLED'}\n              <br />\n              <small>{flag.description}</small>\n            </li>\n          ))}\n        </ul>\n      </div>\n    </div>\n  );\n}\n\n// Export convenience components\nexport const AuthFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"authentication\" {...props} />\n);\n\nexport const VotingFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"voting\" {...props} />\n);\n\nexport const DatabaseFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"database\" {...props} />\n);\n\nexport const APIFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"api\" {...props} />\n);\n\nexport const UIFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"ui\" {...props} />\n);\n\nexport const AdvancedPrivacyFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"advancedPrivacy\" {...props} />\n);\n\nexport const AnalyticsFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"analytics\" {...props} />\n);\n\nexport const PWAFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"pwa\" {...props} />\n);\n\nexport const AdminFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"admin\" {...props} />\n);\n\nexport const AuditFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"audit\" {...props} />\n);\n\nexport const ExperimentalUIFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"experimentalUI\" {...props} />\n);\n\nexport const AIFeaturesFeature = (props: Omit<FeatureWrapperProps, 'feature'>) => (\n  <FeatureWrapper feature=\"aiFeatures\" {...props} />\n);\n\n\nexport default FeatureWrapper;\n"],"names":["AIFeaturesFeature","APIFeature","AdminFeature","AdvancedPrivacyFeature","AnalyticsFeature","AuditFeature","AuthFeature","DatabaseFeature","ExperimentalUIFeature","FeatureFlagDebugger","FeatureWrapper","FeatureWrapperBatch","FeatureWrapperWithDependencies","PWAFeature","UIFeature","VotingFeature","withFeatureFlag","withFeatureFlagsBatch","feature","children","fallback","showLoading","loadingComponent","div","hideWhenDisabled","className","style","enabled","disabled","_disabled","loading","useFeatureFlag","features","anyEnabled","allEnabled","anyEnabledResult","useFeatureFlagsBatch","shouldRender","dependenciesFallback","dependenciesMet","useFeatureFlagWithDependencies","WrappedComponent","WithFeatureFlagComponent","props","FallbackComponent","WithFeatureFlagsBatchComponent","getAllFlags","systemInfo","isLoading","useFeatureFlags","flags","Array","from","values","padding","border","borderRadius","margin","h3","strong","ul","li","totalFlags","enabledFlags","disabledFlags","environment","map","flag","color","name","id","br","small","description"],"mappings":"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"}
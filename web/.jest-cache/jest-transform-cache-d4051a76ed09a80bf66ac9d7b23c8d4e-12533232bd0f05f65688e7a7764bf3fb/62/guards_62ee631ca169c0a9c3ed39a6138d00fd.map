{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/utils/guards.ts"],"sourcesContent":["/**\n * Type guard utilities for safe boundary handling\n * \n * These utilities provide type-safe ways to handle unknown data at API/IO boundaries,\n * eliminating the need for unsafe type assertions and reducing no-unsafe-* errors.\n * \n * @fileoverview Safe type guards and data validation utilities\n */\n\n/**\n * Type guard to check if a value is a record (object with string keys)\n */\nexport function isRecord(x: unknown): x is Record<string, unknown> {\n  return typeof x === 'object' && x !== null && !Array.isArray(x);\n}\n\n/**\n * Type guard to check if an object has a specific key\n */\nexport function has<T extends string>(\n  obj: unknown, \n  key: T\n): obj is Record<T, unknown> {\n  return isRecord(obj) && key in obj;\n}\n\n/**\n * Type guard to check if an object has multiple keys\n */\nexport function hasKeys<T extends string>(\n  obj: unknown, \n  keys: T[]\n): obj is Record<T, unknown> {\n  return isRecord(obj) && keys.every(key => key in obj);\n}\n\n/**\n * Safely convert unknown value to array\n */\nexport function asArray<T>(x: unknown): T[] {\n  return Array.isArray(x) ? (x as T[]) : [];\n}\n\n/**\n * Safely convert unknown value to string with fallback\n */\nexport function toString(x: unknown, fallback = ''): string {\n  if (typeof x === 'string') return x;\n  if (typeof x === 'number' || typeof x === 'boolean') return String(x);\n  return fallback;\n}\n\n/**\n * Safely convert unknown value to number with fallback\n */\nexport function toNumber(x: unknown, fallback = 0): number {\n  if (typeof x === 'number' && Number.isFinite(x)) return x;\n  if (typeof x === 'string') {\n    const parsed = Number(x);\n    if (Number.isFinite(parsed)) return parsed;\n  }\n  return fallback;\n}\n\n/**\n * Safely convert unknown value to boolean\n */\nexport function toBoolean(x: unknown): boolean {\n  if (typeof x === 'boolean') return x;\n  if (typeof x === 'string') {\n    const lower = x.toLowerCase();\n    return lower === 'true' || lower === '1' || lower === 'yes';\n  }\n  if (typeof x === 'number') return x !== 0;\n  return Boolean(x);\n}\n\n/**\n * Safely get a property from an object with type checking\n */\nexport function getProperty<T>(\n  obj: unknown, \n  key: string, \n  fallback: T\n): T {\n  if (has(obj, key)) {\n    return obj[key] as T;\n  }\n  return fallback;\n}\n\n/**\n * Safely get a nested property from an object\n */\nexport function getNestedProperty<T>(\n  obj: unknown, \n  path: string[], \n  fallback: T\n): T {\n  let current: unknown = obj;\n  \n  for (const key of path) {\n    if (!isRecord(current) || !(key in current)) {\n      return fallback;\n    }\n    current = current[key];\n  }\n  \n  return current as T;\n}\n\n/**\n * Type guard for string arrays\n */\nexport function isStringArray(x: unknown): x is string[] {\n  return Array.isArray(x) && x.every(item => typeof item === 'string');\n}\n\n/**\n * Type guard for number arrays\n */\nexport function isNumberArray(x: unknown): x is number[] {\n  return Array.isArray(x) && x.every(item => typeof item === 'number');\n}\n\n/**\n * Type guard for non-empty strings\n */\nexport function isNonEmptyString(x: unknown): x is string {\n  return typeof x === 'string' && x.length > 0;\n}\n\n/**\n * Type guard for valid email format (basic check)\n */\nexport function isEmail(x: unknown): x is string {\n  if (!isNonEmptyString(x)) return false;\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(x);\n}\n\n/**\n * Type guard for valid UUID format\n */\nexport function isUUID(x: unknown): x is string {\n  if (!isNonEmptyString(x)) return false;\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n  return uuidRegex.test(x);\n}\n\n/**\n * Type guard for valid date strings (ISO format)\n */\nexport function isISODateString(x: unknown): x is string {\n  if (!isNonEmptyString(x)) return false;\n  const date = new Date(x);\n  return !isNaN(date.getTime()) && date.toISOString() === x;\n}\n\n/**\n * Safe JSON parsing with type checking\n */\nexport function safeJsonParse<T>(json: string, fallback: T): T {\n  try {\n    const parsed = JSON.parse(json);\n    return parsed as T;\n  } catch {\n    return fallback;\n  }\n}\n\n/**\n * Safe JSON stringify with error handling\n */\nexport function safeJsonStringify(obj: unknown, fallback = '{}'): string {\n  try {\n    return JSON.stringify(obj);\n  } catch {\n    return fallback;\n  }\n}\n\n/**\n * Create a type-safe property accessor\n */\nexport function createPropertyAccessor<T>(obj: Record<string, unknown>, key: string): T | undefined {\n  return has(obj, key) ? (obj[key] as T) : undefined;\n}\n\n/**\n * Validate and transform data with a schema-like approach\n */\nexport function validateData<T>(\n  data: unknown,\n  validator: (x: unknown) => x is T,\n  fallback: T\n): T {\n  return validator(data) ? data : fallback;\n}\n\n/**\n * Assert that a value is present (not null or undefined)\n * Throws an error with a descriptive message if the value is null or undefined\n */\nexport function assertPresent<T>(value: T | null | undefined, name: string): asserts value is T {\n  if (value === null || value === undefined) {\n    throw new Error(`${name} is required but was ${value === null ? 'null' : 'undefined'}`);\n  }\n}\n\n/**\n * Common validation patterns for API responses\n */\nexport const ApiValidators = {\n  /**\n   * Validate a standard API response structure\n   */\n  isApiResponse: (x: unknown): x is { data: unknown; error: unknown } => {\n    return isRecord(x) && has(x, 'data') && has(x, 'error');\n  },\n\n  /**\n   * Validate a paginated response structure\n   */\n  isPaginatedResponse: (x: unknown): x is { \n    data: unknown[]; \n    error: unknown; \n    count: number \n  } => {\n    return isRecord(x) && \n           has(x, 'data') && \n           has(x, 'error') && \n           has(x, 'count') &&\n           Array.isArray(x.data);\n  },\n\n  /**\n   * Validate a success response (no error)\n   */\n  isSuccessResponse: (x: unknown): x is { data: unknown; error: null } => {\n    return ApiValidators.isApiResponse(x) && x.error === null;\n  },\n\n  /**\n   * Validate an error response\n   */\n  isErrorResponse: (x: unknown): x is { data: null; error: { message: string } } => {\n    return ApiValidators.isApiResponse(x) && \n           x.error !== null && \n           isRecord(x.error) && \n           has(x.error, 'message') &&\n           typeof x.error.message === 'string';\n  }\n} as const;"],"names":["ApiValidators","asArray","assertPresent","createPropertyAccessor","getNestedProperty","getProperty","has","hasKeys","isEmail","isISODateString","isNonEmptyString","isNumberArray","isRecord","isStringArray","isUUID","safeJsonParse","safeJsonStringify","toBoolean","toNumber","toString","validateData","x","Array","isArray","obj","key","keys","every","fallback","String","Number","isFinite","parsed","lower","toLowerCase","Boolean","path","current","item","length","emailRegex","test","uuidRegex","date","Date","isNaN","getTime","toISOString","json","JSON","parse","stringify","undefined","data","validator","value","name","Error","isApiResponse","isPaginatedResponse","isSuccessResponse","error","isErrorResponse","message"],"mappings":"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"}
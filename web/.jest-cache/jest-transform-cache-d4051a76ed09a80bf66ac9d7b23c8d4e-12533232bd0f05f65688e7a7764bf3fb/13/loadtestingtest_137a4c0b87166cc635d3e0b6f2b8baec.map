{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/performance/load-testing.test.ts"],"sourcesContent":["/**\n * Performance Tests - Simplified\n * \n * Tests that the application can handle concurrent operations without crashing.\n * Focuses on functionality, not timing measurements.\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals';\n\n// Mock fetch globally\nconst mockFetch = jest.fn();\nglobal.fetch = mockFetch;\n\ndescribe('Load Testing', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Concurrent Operations', () => {\n    it('should handle 1000 concurrent users', async () => {\n      const concurrentUsers = 1000;\n      \n      // Simple mock that just resolves immediately\n      mockFetch.mockImplementation(() => \n        Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve({ success: true, data: [] })\n        })\n      );\n\n      // Test that we can handle many concurrent operations without crashing\n      const promises = Array.from({ length: concurrentUsers }, (_, i) => \n        fetch(`/api/feeds`).then(response => ({\n          userId: `user-${i}`,\n          status: response.status\n        }))\n      );\n\n      const responses = await Promise.all(promises);\n\n      // Basic assertions - just verify we can handle the load\n      expect(responses.length).toBe(concurrentUsers);\n      responses.forEach(response => {\n        expect(response.status).toBe(200);\n      });\n    });\n\n    it('should handle 5000 concurrent feed requests', async () => {\n      const feedRequests = 5000;\n      \n      // Simple mock\n      mockFetch.mockImplementation(() => \n        Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve(Array.from({ length: 100 }, (_, i) => ({ id: i })))\n        })\n      );\n\n      // Test concurrent operations\n      const promises = Array.from({ length: feedRequests }, () => \n        fetch('/api/feeds').then(response => response.json())\n      );\n\n      const responses = await Promise.all(promises);\n\n      // Basic assertions\n      expect(responses.length).toBe(feedRequests);\n      responses.forEach(response => {\n        expect(Array.isArray(response)).toBe(true);\n        expect(response.length).toBe(100);\n      });\n    });\n\n    it('should handle mixed concurrent operations', async () => {\n      const operations = [\n        { type: 'feed', count: 1000 },\n        { type: 'auth', count: 500 },\n        { type: 'vote', count: 200 }\n      ];\n      \n      // Mock different endpoints\n      mockFetch.mockImplementation((url) => {\n        if (url.includes('/api/feeds')) {\n          return Promise.resolve({\n            ok: true,\n            status: 200,\n            json: () => Promise.resolve({ feeds: [] })\n          });\n        }\n        if (url.includes('/api/auth/login')) {\n          return Promise.resolve({\n            ok: true,\n            status: 200,\n            json: () => Promise.resolve({ token: 'auth-token' })\n          });\n        }\n        if (url.includes('/api/votes')) {\n          return Promise.resolve({\n            ok: true,\n            status: 200,\n            json: () => Promise.resolve({ success: true })\n          });\n        }\n        return Promise.resolve({ ok: true, status: 200, json: () => Promise.resolve({}) });\n      });\n\n      // Execute all operations concurrently\n      const allRequests = operations.flatMap(op => \n        Array.from({ length: op.count }, (_, i) => ({\n          type: op.type,\n          id: `${op.type}-${i}`,\n          endpoint: op.type === 'feed' ? '/api/feeds' : \n                   op.type === 'auth' ? '/api/auth/login' : '/api/votes'\n        }))\n      );\n\n      const responses = await Promise.all(\n        allRequests.map(async (request) => {\n          const response = await fetch(request.endpoint);\n          return {\n            ...request,\n            status: response.status\n          };\n        })\n      );\n\n      // Basic assertions\n      expect(responses.length).toBe(1700); // Total operations\n      responses.forEach(response => {\n        expect(response.status).toBe(200);\n      });\n    });\n  });\n\n  describe('Database Operations', () => {\n    it('should handle large dataset queries', async () => {\n      const queryCount = 100;\n      \n      mockFetch.mockImplementation(() => \n        Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve(Array.from({ length: 100 }, (_, i) => ({ id: i })))\n        })\n      );\n\n      const promises = Array.from({ length: queryCount }, () => \n        fetch('/api/data').then(response => response.json())\n      );\n\n      const results = await Promise.all(promises);\n\n      expect(results.length).toBe(queryCount);\n      results.forEach(result => {\n        expect(Array.isArray(result)).toBe(true);\n        expect(result.length).toBe(100);\n      });\n    });\n\n    it('should handle concurrent database writes', async () => {\n      const writeOperations = 500;\n      \n      mockFetch.mockImplementation(() => \n        Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve({ success: true })\n        })\n      );\n\n      const promises = Array.from({ length: writeOperations }, (_, i) => \n        fetch('/api/write', {\n          method: 'POST',\n          body: JSON.stringify({ id: i, data: `test-${i}` })\n        }).then(response => response.json())\n      );\n\n      const results = await Promise.all(promises);\n\n      expect(results.length).toBe(writeOperations);\n      results.forEach(result => {\n        expect(result.success).toBe(true);\n      });\n    });\n  });\n\n  describe('API Response Testing', () => {\n    it('should maintain consistent API responses under load', async () => {\n      const requestsPerEndpoint = 100;\n      const endpoints = ['/api/feeds', '/api/polls', '/api/users'];\n      \n      mockFetch.mockImplementation((url) => \n        Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve({ endpoint: url, success: true })\n        })\n      );\n\n      const allRequests = endpoints.flatMap(endpoint => \n        Array.from({ length: requestsPerEndpoint }, () => \n          fetch(endpoint).then(response => response.json())\n        )\n      );\n\n      const responses = await Promise.all(allRequests);\n\n      expect(responses.length).toBe(300); // 3 endpoints * 100 requests\n      responses.forEach(response => {\n        expect(response.success).toBe(true);\n        expect(endpoints).toContain(response.endpoint);\n      });\n    });\n  });\n\n  describe('Stress Testing', () => {\n    it('should handle resource exhaustion gracefully', async () => {\n      const maxConcurrentRequests = 2000;\n      \n      mockFetch.mockImplementation(() => \n        Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve({ success: true })\n        })\n      );\n\n      // Test that we can handle a large number of concurrent requests\n      const promises = Array.from({ length: maxConcurrentRequests }, (_, i) => \n        fetch(`/api/stress-test-${i}`).then(response => ({\n          id: i,\n          status: response.status\n        }))\n      );\n\n      const responses = await Promise.all(promises);\n\n      expect(responses.length).toBe(maxConcurrentRequests);\n      const successCount = responses.filter(r => r.status === 200).length;\n      expect(successCount).toBeGreaterThan(0); // At least some should succeed\n    });\n\n    it('should handle memory-intensive operations', async () => {\n      const dataSize = 1000;\n      \n      mockFetch.mockImplementation(() => \n        Promise.resolve({\n          ok: true,\n          status: 200,\n          json: () => Promise.resolve(Array.from({ length: dataSize }, (_, i) => ({ \n            id: i, \n            data: `item-${i}`.repeat(100) // Large data strings\n          })))\n        })\n      );\n\n      const promises = Array.from({ length: 10 }, () => \n        fetch('/api/large-data').then(response => response.json())\n      );\n\n      const results = await Promise.all(promises);\n\n      expect(results.length).toBe(10);\n      results.forEach(result => {\n        expect(Array.isArray(result)).toBe(true);\n        expect(result.length).toBe(dataSize);\n      });\n    });\n  });\n});"],"names":["mockFetch","jest","fn","global","fetch","describe","beforeEach","clearAllMocks","it","concurrentUsers","mockImplementation","Promise","resolve","ok","status","json","success","data","promises","Array","from","length","_","i","then","response","userId","responses","all","expect","toBe","forEach","feedRequests","id","isArray","operations","type","count","url","includes","feeds","token","allRequests","flatMap","op","endpoint","map","request","queryCount","results","result","writeOperations","method","body","JSON","stringify","requestsPerEndpoint","endpoints","toContain","maxConcurrentRequests","successCount","filter","r","toBeGreaterThan","dataSize","repeat"],"mappings":"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"}
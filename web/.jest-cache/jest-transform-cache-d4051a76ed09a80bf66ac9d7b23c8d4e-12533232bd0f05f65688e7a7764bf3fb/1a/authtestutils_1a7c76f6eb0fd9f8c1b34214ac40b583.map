{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/helpers/auth-test-utils.ts"],"sourcesContent":["// Mock auth utilities for testing\nimport { jest } from '@jest/globals';\n\nexport const getUser = (jest.fn() as any).mockResolvedValue({\n  user: {\n    id: 'test-user-id',\n    email: 'test@example.com',\n    name: 'Test User',\n  },\n  error: null,\n})\n\nexport const requireAuth = jest.fn().mockImplementation((handler: any) => {\n  return async (req: any, res: any) => {\n    const user = await getUser()\n    if (!user.user) {\n      return res.status(401).json({ error: 'Unauthorized' })\n    }\n    return handler(req, res)\n  }\n})\n\nexport const checkPermissions = (jest.fn() as any).mockResolvedValue(true)\n\nexport const validateSession = (jest.fn() as any).mockResolvedValue({\n  valid: true,\n  user: {\n    id: 'test-user-id',\n    email: 'test@example.com',\n  },\n})\n\n// Mock context creator\nexport const createAuthMockContext = jest.fn().mockReturnValue({\n  user: {\n    id: 'test-user-id',\n    email: 'test@example.com',\n    name: 'Test User',\n  },\n  session: {\n    id: 'test-session-id',\n    userId: 'test-user-id',\n    expiresAt: new Date(Date.now() + 86400000), // 24 hours from now\n  },\n  ip: '192.168.1.1',\n  userAgent: 'Mozilla/5.0 (Test Browser)',\n  headers: {\n    'x-forwarded-for': '192.168.1.1',\n    'user-agent': 'Mozilla/5.0 (Test Browser)',\n  },\n})\n\n// Mock rate limiting\nexport const mockRateLimiting = (jest.fn() as any).mockResolvedValue({\n  allowed: true,\n  remaining: 10,\n  resetTime: Date.now() + 60000,\n})\n\n// Mock CSRF protection\nexport const mockCSRFProtection = (jest.fn() as any).mockResolvedValue({\n  valid: true,\n  token: 'test-csrf-token',\n})\n\n// Mock secure server action creator\nexport const createSecureServerAction = jest.fn().mockImplementation((handler: any, options: any) => {\n  return async (data: any, context: any) => {\n    // Mock authentication check\n    if (options?.requireAuth && !context?.user) {\n      throw new Error('Authentication required')\n    }\n    \n    // Mock rate limiting check\n    if (options?.rateLimit) {\n      const rateLimitResult = await mockRateLimiting()\n      if (!rateLimitResult.allowed) {\n        throw new Error('Rate limit exceeded')\n      }\n    }\n    \n    // Mock CSRF protection check\n    if (options?.csrfProtection) {\n      const csrfResult = await mockCSRFProtection()\n      if (!csrfResult.valid) {\n        throw new Error('CSRF token validation failed')\n      }\n    }\n    \n    // Mock missing context check\n    if (!context) {\n      throw new Error('Server action context is required')\n    }\n    \n    // Mock invalid input check\n    if (!data) {\n      throw new Error('Invalid input')\n    }\n    \n    return await handler(data, context)\n  }\n})"],"names":["checkPermissions","createAuthMockContext","createSecureServerAction","getUser","mockCSRFProtection","mockRateLimiting","requireAuth","validateSession","jest","fn","mockResolvedValue","user","id","email","name","error","mockImplementation","handler","req","res","status","json","valid","mockReturnValue","session","userId","expiresAt","Date","now","ip","userAgent","headers","allowed","remaining","resetTime","token","options","data","context","Error","rateLimit","rateLimitResult","csrfProtection","csrfResult"],"mappings":"AAAA,kCAAkC;;;;;;;;;;;;QAsBrBA;eAAAA;;QAWAC;eAAAA;;QAiCAC;eAAAA;;QA/DAC;eAAAA;;QAyDAC;eAAAA;;QAPAC;eAAAA;;QAzCAC;eAAAA;;QAYAC;eAAAA;;;yBAvBQ;AAEd,MAAMJ,UAAU,AAACK,aAAI,CAACC,EAAE,GAAWC,iBAAiB,CAAC;IAC1DC,MAAM;QACJC,IAAI;QACJC,OAAO;QACPC,MAAM;IACR;IACAC,OAAO;AACT;AAEO,MAAMT,cAAcE,aAAI,CAACC,EAAE,GAAGO,kBAAkB,CAAC,CAACC;IACvD,OAAO,OAAOC,KAAUC;QACtB,MAAMR,OAAO,MAAMR;QACnB,IAAI,CAACQ,KAAKA,IAAI,EAAE;YACd,OAAOQ,IAAIC,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEN,OAAO;YAAe;QACtD;QACA,OAAOE,QAAQC,KAAKC;IACtB;AACF;AAEO,MAAMnB,mBAAmB,AAACQ,aAAI,CAACC,EAAE,GAAWC,iBAAiB,CAAC;AAE9D,MAAMH,kBAAkB,AAACC,aAAI,CAACC,EAAE,GAAWC,iBAAiB,CAAC;IAClEY,OAAO;IACPX,MAAM;QACJC,IAAI;QACJC,OAAO;IACT;AACF;AAGO,MAAMZ,wBAAwBO,aAAI,CAACC,EAAE,GAAGc,eAAe,CAAC;IAC7DZ,MAAM;QACJC,IAAI;QACJC,OAAO;QACPC,MAAM;IACR;IACAU,SAAS;QACPZ,IAAI;QACJa,QAAQ;QACRC,WAAW,IAAIC,KAAKA,KAAKC,GAAG,KAAK;IACnC;IACAC,IAAI;IACJC,WAAW;IACXC,SAAS;QACP,mBAAmB;QACnB,cAAc;IAChB;AACF;AAGO,MAAM1B,mBAAmB,AAACG,aAAI,CAACC,EAAE,GAAWC,iBAAiB,CAAC;IACnEsB,SAAS;IACTC,WAAW;IACXC,WAAWP,KAAKC,GAAG,KAAK;AAC1B;AAGO,MAAMxB,qBAAqB,AAACI,aAAI,CAACC,EAAE,GAAWC,iBAAiB,CAAC;IACrEY,OAAO;IACPa,OAAO;AACT;AAGO,MAAMjC,2BAA2BM,aAAI,CAACC,EAAE,GAAGO,kBAAkB,CAAC,CAACC,SAAcmB;IAClF,OAAO,OAAOC,MAAWC;QACvB,4BAA4B;QAC5B,IAAIF,SAAS9B,eAAe,CAACgC,SAAS3B,MAAM;YAC1C,MAAM,IAAI4B,MAAM;QAClB;QAEA,2BAA2B;QAC3B,IAAIH,SAASI,WAAW;YACtB,MAAMC,kBAAkB,MAAMpC;YAC9B,IAAI,CAACoC,gBAAgBT,OAAO,EAAE;gBAC5B,MAAM,IAAIO,MAAM;YAClB;QACF;QAEA,6BAA6B;QAC7B,IAAIH,SAASM,gBAAgB;YAC3B,MAAMC,aAAa,MAAMvC;YACzB,IAAI,CAACuC,WAAWrB,KAAK,EAAE;gBACrB,MAAM,IAAIiB,MAAM;YAClB;QACF;QAEA,6BAA6B;QAC7B,IAAI,CAACD,SAAS;YACZ,MAAM,IAAIC,MAAM;QAClB;QAEA,2BAA2B;QAC3B,IAAI,CAACF,MAAM;YACT,MAAM,IAAIE,MAAM;QAClB;QAEA,OAAO,MAAMtB,QAAQoB,MAAMC;IAC7B;AACF"}
22fd345a8f8027b0833031a175c1566a
// Mock auth utilities for testing
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get checkPermissions () {
        return checkPermissions;
    },
    get createAuthMockContext () {
        return createAuthMockContext;
    },
    get createSecureServerAction () {
        return createSecureServerAction;
    },
    get getUser () {
        return getUser;
    },
    get mockCSRFProtection () {
        return mockCSRFProtection;
    },
    get mockRateLimiting () {
        return mockRateLimiting;
    },
    get requireAuth () {
        return requireAuth;
    },
    get validateSession () {
        return validateSession;
    }
});
const _globals = require("@jest/globals");
const getUser = _globals.jest.fn().mockResolvedValue({
    user: {
        id: 'test-user-id',
        email: 'test@example.com',
        name: 'Test User'
    },
    error: null
});
const requireAuth = _globals.jest.fn().mockImplementation((handler)=>{
    return async (req, res)=>{
        const user = await getUser();
        if (!user.user) {
            return res.status(401).json({
                error: 'Unauthorized'
            });
        }
        return handler(req, res);
    };
});
const checkPermissions = _globals.jest.fn().mockResolvedValue(true);
const validateSession = _globals.jest.fn().mockResolvedValue({
    valid: true,
    user: {
        id: 'test-user-id',
        email: 'test@example.com'
    }
});
const createAuthMockContext = _globals.jest.fn().mockReturnValue({
    user: {
        id: 'test-user-id',
        email: 'test@example.com',
        name: 'Test User'
    },
    session: {
        id: 'test-session-id',
        userId: 'test-user-id',
        expiresAt: new Date(Date.now() + 86400000)
    },
    ip: '192.168.1.1',
    userAgent: 'Mozilla/5.0 (Test Browser)',
    headers: {
        'x-forwarded-for': '192.168.1.1',
        'user-agent': 'Mozilla/5.0 (Test Browser)'
    }
});
const mockRateLimiting = _globals.jest.fn().mockResolvedValue({
    allowed: true,
    remaining: 10,
    resetTime: Date.now() + 60000
});
const mockCSRFProtection = _globals.jest.fn().mockResolvedValue({
    valid: true,
    token: 'test-csrf-token'
});
const createSecureServerAction = _globals.jest.fn().mockImplementation((handler, options)=>{
    return async (data, context)=>{
        // Mock authentication check
        if (options?.requireAuth && !context?.user) {
            throw new Error('Authentication required');
        }
        // Mock rate limiting check
        if (options?.rateLimit) {
            const rateLimitResult = await mockRateLimiting();
            if (!rateLimitResult.allowed) {
                throw new Error('Rate limit exceeded');
            }
        }
        // Mock CSRF protection check
        if (options?.csrfProtection) {
            const csrfResult = await mockCSRFProtection();
            if (!csrfResult.valid) {
                throw new Error('CSRF token validation failed');
            }
        }
        // Mock missing context check
        if (!context) {
            throw new Error('Server action context is required');
        }
        // Mock invalid input check
        if (!data) {
            throw new Error('Invalid input');
        }
        return await handler(data, context);
    };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L2hlbHBlcnMvYXV0aC10ZXN0LXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIE1vY2sgYXV0aCB1dGlsaXRpZXMgZm9yIHRlc3RpbmdcbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuZXhwb3J0IGNvbnN0IGdldFVzZXIgPSAoamVzdC5mbigpIGFzIGFueSkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICB1c2VyOiB7XG4gICAgaWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgbmFtZTogJ1Rlc3QgVXNlcicsXG4gIH0sXG4gIGVycm9yOiBudWxsLFxufSlcblxuZXhwb3J0IGNvbnN0IHJlcXVpcmVBdXRoID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGFuZGxlcjogYW55KSA9PiB7XG4gIHJldHVybiBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXIoKVxuICAgIGlmICghdXNlci51c2VyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSlcbiAgICB9XG4gICAgcmV0dXJuIGhhbmRsZXIocmVxLCByZXMpXG4gIH1cbn0pXG5cbmV4cG9ydCBjb25zdCBjaGVja1Blcm1pc3Npb25zID0gKGplc3QuZm4oKSBhcyBhbnkpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpXG5cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZVNlc3Npb24gPSAoamVzdC5mbigpIGFzIGFueSkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICB2YWxpZDogdHJ1ZSxcbiAgdXNlcjoge1xuICAgIGlkOiAndGVzdC11c2VyLWlkJyxcbiAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICB9LFxufSlcblxuLy8gTW9jayBjb250ZXh0IGNyZWF0b3JcbmV4cG9ydCBjb25zdCBjcmVhdGVBdXRoTW9ja0NvbnRleHQgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgdXNlcjoge1xuICAgIGlkOiAndGVzdC11c2VyLWlkJyxcbiAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgIG5hbWU6ICdUZXN0IFVzZXInLFxuICB9LFxuICBzZXNzaW9uOiB7XG4gICAgaWQ6ICd0ZXN0LXNlc3Npb24taWQnLFxuICAgIHVzZXJJZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgODY0MDAwMDApLCAvLyAyNCBob3VycyBmcm9tIG5vd1xuICB9LFxuICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgdXNlckFnZW50OiAnTW96aWxsYS81LjAgKFRlc3QgQnJvd3NlciknLFxuICBoZWFkZXJzOiB7XG4gICAgJ3gtZm9yd2FyZGVkLWZvcic6ICcxOTIuMTY4LjEuMScsXG4gICAgJ3VzZXItYWdlbnQnOiAnTW96aWxsYS81LjAgKFRlc3QgQnJvd3NlciknLFxuICB9LFxufSlcblxuLy8gTW9jayByYXRlIGxpbWl0aW5nXG5leHBvcnQgY29uc3QgbW9ja1JhdGVMaW1pdGluZyA9IChqZXN0LmZuKCkgYXMgYW55KS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gIGFsbG93ZWQ6IHRydWUsXG4gIHJlbWFpbmluZzogMTAsXG4gIHJlc2V0VGltZTogRGF0ZS5ub3coKSArIDYwMDAwLFxufSlcblxuLy8gTW9jayBDU1JGIHByb3RlY3Rpb25cbmV4cG9ydCBjb25zdCBtb2NrQ1NSRlByb3RlY3Rpb24gPSAoamVzdC5mbigpIGFzIGFueSkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICB2YWxpZDogdHJ1ZSxcbiAgdG9rZW46ICd0ZXN0LWNzcmYtdG9rZW4nLFxufSlcblxuLy8gTW9jayBzZWN1cmUgc2VydmVyIGFjdGlvbiBjcmVhdG9yXG5leHBvcnQgY29uc3QgY3JlYXRlU2VjdXJlU2VydmVyQWN0aW9uID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGFuZGxlcjogYW55LCBvcHRpb25zOiBhbnkpID0+IHtcbiAgcmV0dXJuIGFzeW5jIChkYXRhOiBhbnksIGNvbnRleHQ6IGFueSkgPT4ge1xuICAgIC8vIE1vY2sgYXV0aGVudGljYXRpb24gY2hlY2tcbiAgICBpZiAob3B0aW9ucz8ucmVxdWlyZUF1dGggJiYgIWNvbnRleHQ/LnVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXV0aGVudGljYXRpb24gcmVxdWlyZWQnKVxuICAgIH1cbiAgICBcbiAgICAvLyBNb2NrIHJhdGUgbGltaXRpbmcgY2hlY2tcbiAgICBpZiAob3B0aW9ucz8ucmF0ZUxpbWl0KSB7XG4gICAgICBjb25zdCByYXRlTGltaXRSZXN1bHQgPSBhd2FpdCBtb2NrUmF0ZUxpbWl0aW5nKClcbiAgICAgIGlmICghcmF0ZUxpbWl0UmVzdWx0LmFsbG93ZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSYXRlIGxpbWl0IGV4Y2VlZGVkJylcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gTW9jayBDU1JGIHByb3RlY3Rpb24gY2hlY2tcbiAgICBpZiAob3B0aW9ucz8uY3NyZlByb3RlY3Rpb24pIHtcbiAgICAgIGNvbnN0IGNzcmZSZXN1bHQgPSBhd2FpdCBtb2NrQ1NSRlByb3RlY3Rpb24oKVxuICAgICAgaWYgKCFjc3JmUmVzdWx0LnZhbGlkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ1NSRiB0b2tlbiB2YWxpZGF0aW9uIGZhaWxlZCcpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIE1vY2sgbWlzc2luZyBjb250ZXh0IGNoZWNrXG4gICAgaWYgKCFjb250ZXh0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlcnZlciBhY3Rpb24gY29udGV4dCBpcyByZXF1aXJlZCcpXG4gICAgfVxuICAgIFxuICAgIC8vIE1vY2sgaW52YWxpZCBpbnB1dCBjaGVja1xuICAgIGlmICghZGF0YSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGlucHV0JylcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIoZGF0YSwgY29udGV4dClcbiAgfVxufSkiXSwibmFtZXMiOlsiY2hlY2tQZXJtaXNzaW9ucyIsImNyZWF0ZUF1dGhNb2NrQ29udGV4dCIsImNyZWF0ZVNlY3VyZVNlcnZlckFjdGlvbiIsImdldFVzZXIiLCJtb2NrQ1NSRlByb3RlY3Rpb24iLCJtb2NrUmF0ZUxpbWl0aW5nIiwicmVxdWlyZUF1dGgiLCJ2YWxpZGF0ZVNlc3Npb24iLCJqZXN0IiwiZm4iLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInVzZXIiLCJpZCIsImVtYWlsIiwibmFtZSIsImVycm9yIiwibW9ja0ltcGxlbWVudGF0aW9uIiwiaGFuZGxlciIsInJlcSIsInJlcyIsInN0YXR1cyIsImpzb24iLCJ2YWxpZCIsIm1vY2tSZXR1cm5WYWx1ZSIsInNlc3Npb24iLCJ1c2VySWQiLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwiaXAiLCJ1c2VyQWdlbnQiLCJoZWFkZXJzIiwiYWxsb3dlZCIsInJlbWFpbmluZyIsInJlc2V0VGltZSIsInRva2VuIiwib3B0aW9ucyIsImRhdGEiLCJjb250ZXh0IiwiRXJyb3IiLCJyYXRlTGltaXQiLCJyYXRlTGltaXRSZXN1bHQiLCJjc3JmUHJvdGVjdGlvbiIsImNzcmZSZXN1bHQiXSwibWFwcGluZ3MiOiJBQUFBLGtDQUFrQzs7Ozs7Ozs7Ozs7O1FBc0JyQkE7ZUFBQUE7O1FBV0FDO2VBQUFBOztRQWlDQUM7ZUFBQUE7O1FBL0RBQztlQUFBQTs7UUF5REFDO2VBQUFBOztRQVBBQztlQUFBQTs7UUF6Q0FDO2VBQUFBOztRQVlBQztlQUFBQTs7O3lCQXZCUTtBQUVkLE1BQU1KLFVBQVUsQUFBQ0ssYUFBSSxDQUFDQyxFQUFFLEdBQVdDLGlCQUFpQixDQUFDO0lBQzFEQyxNQUFNO1FBQ0pDLElBQUk7UUFDSkMsT0FBTztRQUNQQyxNQUFNO0lBQ1I7SUFDQUMsT0FBTztBQUNUO0FBRU8sTUFBTVQsY0FBY0UsYUFBSSxDQUFDQyxFQUFFLEdBQUdPLGtCQUFrQixDQUFDLENBQUNDO0lBQ3ZELE9BQU8sT0FBT0MsS0FBVUM7UUFDdEIsTUFBTVIsT0FBTyxNQUFNUjtRQUNuQixJQUFJLENBQUNRLEtBQUtBLElBQUksRUFBRTtZQUNkLE9BQU9RLElBQUlDLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVOLE9BQU87WUFBZTtRQUN0RDtRQUNBLE9BQU9FLFFBQVFDLEtBQUtDO0lBQ3RCO0FBQ0Y7QUFFTyxNQUFNbkIsbUJBQW1CLEFBQUNRLGFBQUksQ0FBQ0MsRUFBRSxHQUFXQyxpQkFBaUIsQ0FBQztBQUU5RCxNQUFNSCxrQkFBa0IsQUFBQ0MsYUFBSSxDQUFDQyxFQUFFLEdBQVdDLGlCQUFpQixDQUFDO0lBQ2xFWSxPQUFPO0lBQ1BYLE1BQU07UUFDSkMsSUFBSTtRQUNKQyxPQUFPO0lBQ1Q7QUFDRjtBQUdPLE1BQU1aLHdCQUF3Qk8sYUFBSSxDQUFDQyxFQUFFLEdBQUdjLGVBQWUsQ0FBQztJQUM3RFosTUFBTTtRQUNKQyxJQUFJO1FBQ0pDLE9BQU87UUFDUEMsTUFBTTtJQUNSO0lBQ0FVLFNBQVM7UUFDUFosSUFBSTtRQUNKYSxRQUFRO1FBQ1JDLFdBQVcsSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLO0lBQ25DO0lBQ0FDLElBQUk7SUFDSkMsV0FBVztJQUNYQyxTQUFTO1FBQ1AsbUJBQW1CO1FBQ25CLGNBQWM7SUFDaEI7QUFDRjtBQUdPLE1BQU0xQixtQkFBbUIsQUFBQ0csYUFBSSxDQUFDQyxFQUFFLEdBQVdDLGlCQUFpQixDQUFDO0lBQ25Fc0IsU0FBUztJQUNUQyxXQUFXO0lBQ1hDLFdBQVdQLEtBQUtDLEdBQUcsS0FBSztBQUMxQjtBQUdPLE1BQU14QixxQkFBcUIsQUFBQ0ksYUFBSSxDQUFDQyxFQUFFLEdBQVdDLGlCQUFpQixDQUFDO0lBQ3JFWSxPQUFPO0lBQ1BhLE9BQU87QUFDVDtBQUdPLE1BQU1qQywyQkFBMkJNLGFBQUksQ0FBQ0MsRUFBRSxHQUFHTyxrQkFBa0IsQ0FBQyxDQUFDQyxTQUFjbUI7SUFDbEYsT0FBTyxPQUFPQyxNQUFXQztRQUN2Qiw0QkFBNEI7UUFDNUIsSUFBSUYsU0FBUzlCLGVBQWUsQ0FBQ2dDLFNBQVMzQixNQUFNO1lBQzFDLE1BQU0sSUFBSTRCLE1BQU07UUFDbEI7UUFFQSwyQkFBMkI7UUFDM0IsSUFBSUgsU0FBU0ksV0FBVztZQUN0QixNQUFNQyxrQkFBa0IsTUFBTXBDO1lBQzlCLElBQUksQ0FBQ29DLGdCQUFnQlQsT0FBTyxFQUFFO2dCQUM1QixNQUFNLElBQUlPLE1BQU07WUFDbEI7UUFDRjtRQUVBLDZCQUE2QjtRQUM3QixJQUFJSCxTQUFTTSxnQkFBZ0I7WUFDM0IsTUFBTUMsYUFBYSxNQUFNdkM7WUFDekIsSUFBSSxDQUFDdUMsV0FBV3JCLEtBQUssRUFBRTtnQkFDckIsTUFBTSxJQUFJaUIsTUFBTTtZQUNsQjtRQUNGO1FBRUEsNkJBQTZCO1FBQzdCLElBQUksQ0FBQ0QsU0FBUztZQUNaLE1BQU0sSUFBSUMsTUFBTTtRQUNsQjtRQUVBLDJCQUEyQjtRQUMzQixJQUFJLENBQUNGLE1BQU07WUFDVCxNQUFNLElBQUlFLE1BQU07UUFDbEI7UUFFQSxPQUFPLE1BQU10QixRQUFRb0IsTUFBTUM7SUFDN0I7QUFDRiJ9
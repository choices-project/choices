{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/hashtags/hooks/useHashtags.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { \n  getHashtagById, \n  searchHashtags, \n  getTrendingHashtags, \n  followHashtag, \n  unfollowHashtag,\n  getUserHashtags,\n  getHashtagSuggestions\n} from '../lib/hashtag-service';\nimport type { \n  Hashtag, \n  HashtagSearchResult, \n  TrendingHashtag, \n  UserHashtag, \n  HashtagSuggestion,\n  HashtagSearchQuery \n} from '../types';\n\ninterface UseHashtagsOptions {\n  autoLoad?: boolean;\n  refreshInterval?: number;\n}\n\nexport function useHashtags(options: UseHashtagsOptions = {}) {\n  const { autoLoad = true, refreshInterval = 0 } = options;\n  \n  const [hashtags, setHashtags] = useState<Hashtag[]>([]);\n  const [trendingHashtags, setTrendingHashtags] = useState<TrendingHashtag[]>([]);\n  const [userHashtags, setUserHashtags] = useState<UserHashtag[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Load trending hashtags\n  const loadTrendingHashtags = useCallback(async (limit = 10) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      \n        const result = await getTrendingHashtags('politics', limit);\n      if (result.success && result.data) {\n        setTrendingHashtags(result.data);\n      } else {\n        setError(result.error || 'Failed to load trending hashtags');\n      }\n    } catch (err) {\n      setError('Failed to load trending hashtags');\n      console.error('Trending hashtags error:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Load user's followed hashtags\n  const loadUserHashtags = useCallback(async () => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      \n      const result = await getUserHashtags();\n      if (result.success && result.data) {\n        setUserHashtags(result.data);\n      } else {\n        setError(result.error || 'Failed to load user hashtags');\n      }\n    } catch (err) {\n      setError('Failed to load user hashtags');\n      console.error('User hashtags error:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Search hashtags\n  const searchHashtagsQuery = useCallback(async (query: HashtagSearchQuery) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      \n      const result = await searchHashtags(query);\n      if (result.success && result.data) {\n        setHashtags(result.data.hashtags);\n        return result.data;\n      } else {\n        setError(result.error || 'Failed to search hashtags');\n        return null;\n      }\n    } catch (err) {\n      setError('Failed to search hashtags');\n      console.error('Search hashtags error:', err);\n      return null;\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Follow hashtag\n  const followHashtagAction = useCallback(async (hashtagId: string) => {\n    try {\n      setError(null);\n      \n      const result = await followHashtag(hashtagId);\n      if (result.success && result.data) {\n        // Add to user hashtags\n        setUserHashtags(prev => [...prev, result.data!]);\n        return true;\n      } else {\n        setError(result.error || 'Failed to follow hashtag');\n        return false;\n      }\n    } catch (err) {\n      setError('Failed to follow hashtag');\n      console.error('Follow hashtag error:', err);\n      return false;\n    }\n  }, []);\n\n  // Unfollow hashtag\n  const unfollowHashtagAction = useCallback(async (hashtagId: string) => {\n    try {\n      setError(null);\n      \n      const result = await unfollowHashtag(hashtagId);\n      if (result.success) {\n        // Remove from user hashtags\n        setUserHashtags(prev => prev.filter(uh => uh.hashtag_id !== hashtagId));\n        return true;\n      } else {\n        setError(result.error || 'Failed to unfollow hashtag');\n        return false;\n      }\n    } catch (err) {\n      setError('Failed to unfollow hashtag');\n      console.error('Unfollow hashtag error:', err);\n      return false;\n    }\n  }, []);\n\n  // Get hashtag suggestions\n  const getSuggestions = useCallback(async (input: string, limit = 5) => {\n    try {\n      setError(null);\n      \n      const result = await getHashtagSuggestions(input, undefined, limit);\n      if (result.success && result.data) {\n        return result.data;\n      } else {\n        setError(result.error || 'Failed to get suggestions');\n        return [];\n      }\n    } catch (err) {\n      setError('Failed to get suggestions');\n      console.error('Suggestions error:', err);\n      return [];\n    }\n  }, []);\n\n  // Check if user is following a hashtag\n  const isFollowingHashtag = useCallback((hashtagId: string) => {\n    return userHashtags.some(uh => uh.hashtag_id === hashtagId);\n  }, [userHashtags]);\n\n  // Auto-load on mount\n  useEffect(() => {\n    if (autoLoad) {\n      loadTrendingHashtags();\n      loadUserHashtags();\n    }\n  }, [autoLoad, loadTrendingHashtags, loadUserHashtags]);\n\n  // Auto-refresh\n  useEffect(() => {\n    if (refreshInterval > 0) {\n      const interval = setInterval(() => {\n        loadTrendingHashtags();\n        loadUserHashtags();\n      }, refreshInterval);\n      \n      return () => clearInterval(interval);\n    }\n  }, [refreshInterval, loadTrendingHashtags, loadUserHashtags]);\n\n  return {\n    // State\n    hashtags,\n    trendingHashtags,\n    userHashtags,\n    isLoading,\n    error,\n    \n    // Actions\n    loadTrendingHashtags,\n    loadUserHashtags,\n    searchHashtagsQuery,\n    followHashtagAction,\n    unfollowHashtagAction,\n    getSuggestions,\n    isFollowingHashtag,\n    \n    // Utilities\n    clearError: () => setError(null),\n    refresh: () => {\n      loadTrendingHashtags();\n      loadUserHashtags();\n    }\n  };\n}\n\ninterface UseHashtagSearchOptions {\n  debounceMs?: number;\n  minQueryLength?: number;\n}\n\nexport function useHashtagSearch(options: UseHashtagSearchOptions = {}) {\n  const { debounceMs = 300, minQueryLength = 2 } = options;\n  \n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState<HashtagSearchResult | null>(null);\n  const [suggestions, setSuggestions] = useState<HashtagSuggestion[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Debounced search\n  useEffect(() => {\n    if (query.length < minQueryLength) {\n      setResults(null);\n      setSuggestions([]);\n      return;\n    }\n\n    const timeoutId = setTimeout(async () => {\n      try {\n        setIsLoading(true);\n        setError(null);\n\n        const searchQuery: HashtagSearchQuery = {\n          query: query,\n          filters: {},\n          limit: 20,\n          offset: 0\n        };\n\n        const searchResult = await searchHashtags(searchQuery);\n        if (searchResult.success && searchResult.data) {\n          setResults(searchResult.data);\n        } else {\n          setError(searchResult.error || 'Search failed');\n        }\n\n        // Also get suggestions\n        const suggestionsResult = await getHashtagSuggestions(query, undefined, 5);\n        if (suggestionsResult.success && suggestionsResult.data) {\n          setSuggestions(suggestionsResult.data);\n        }\n      } catch (err) {\n        setError('Search failed');\n        console.error('Search error:', err);\n      } finally {\n        setIsLoading(false);\n      }\n    }, debounceMs);\n\n    return () => clearTimeout(timeoutId);\n  }, [query, debounceMs, minQueryLength]);\n\n  return {\n    query,\n    setQuery,\n    results,\n    suggestions,\n    isLoading,\n    error,\n    clearError: () => setError(null)\n  };\n}\n"],"names":["useHashtagSearch","useHashtags","options","autoLoad","refreshInterval","hashtags","setHashtags","useState","trendingHashtags","setTrendingHashtags","userHashtags","setUserHashtags","isLoading","setIsLoading","error","setError","loadTrendingHashtags","useCallback","limit","result","getTrendingHashtags","success","data","err","console","loadUserHashtags","getUserHashtags","searchHashtagsQuery","query","searchHashtags","followHashtagAction","hashtagId","followHashtag","prev","unfollowHashtagAction","unfollowHashtag","filter","uh","hashtag_id","getSuggestions","input","getHashtagSuggestions","undefined","isFollowingHashtag","some","useEffect","interval","setInterval","clearInterval","clearError","refresh","debounceMs","minQueryLength","setQuery","results","setResults","suggestions","setSuggestions","length","timeoutId","setTimeout","searchQuery","filters","offset","searchResult","suggestionsResult","clearTimeout"],"mappings":"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"}
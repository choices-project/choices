{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/pwa/hooks/useFeatureFlags.ts"],"sourcesContent":["/**\n * Feature Flags Hook\n * \n * Enhanced React hook for feature flags with Zustand integration and API support.\n * Integrates with existing appStore and provides real-time updates.\n */\n\nimport { useState, useEffect } from 'react';\nimport { useAppStore } from '@/lib/stores/appStore';\nimport { featureFlagManager } from '@/lib/core/feature-flags';\n\nexport function useFeatureFlags() {\n  const { features, setFeatureFlag, toggleFeatureFlag } = useAppStore();\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Fetch flags from API and sync with appStore\n  const fetchFlags = async () => {\n    setIsLoading(true);\n    setError(null);\n    \n    try {\n      const response = await fetch('/api/feature-flags');\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      \n      const data = await response.json();\n      \n      if (data.success) {\n        // Update appStore with fetched flags\n        const flagUpdates: Record<string, boolean> = {};\n        Object.entries(data.flags).forEach(([key, value]) => {\n          flagUpdates[key] = value as boolean;\n        });\n        \n        useAppStore.getState().setFeatureFlags(flagUpdates);\n      } else {\n        throw new Error(data.error || 'Failed to fetch feature flags');\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error';\n      setError(errorMessage);\n      console.error('Failed to fetch feature flags:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Auto-fetch flags on mount\n  useEffect(() => {\n    fetchFlags();\n  }, []);\n\n  return {\n    // State\n    flags: features,\n    isLoading,\n    error,\n    \n    // Actions\n    fetchFlags,\n    setFeatureFlag,\n    toggleFeatureFlag,\n    clearError: () => setError(null),\n    \n        // Utilities\n        isEnabled: (flagId: string) => features[flagId] ?? false,\n        getAllFlags: () => featureFlagManager.getAllFlags(),\n        getEnabledFlags: () => featureFlagManager.getEnabledFlags(),\n        getDisabledFlags: () => featureFlagManager.getDisabledFlags(),\n        getFlagsByCategory: (category: string) => featureFlagManager.getFlagsByCategory(category),\n        getSystemInfo: () => featureFlagManager.getSystemInfo(),\n        systemInfo: featureFlagManager.getSystemInfo(),\n        areDependenciesEnabled: (flagId: string) => featureFlagManager.areDependenciesEnabled(flagId),\n        subscribe: (callback: (flags: any) => void) => featureFlagManager.subscribe(callback)\n  };\n}\n\n// Convenience hook for single flag\nexport function useFeatureFlag(flagId: string) {\n  const { isEnabled, isLoading } = useFeatureFlags();\n  return {\n    enabled: isEnabled(flagId),\n    disabled: !isEnabled(flagId),\n    loading: isLoading\n  };\n}\n\n// Hook for batch flag checking\nexport function useFeatureFlagsBatch(flagIds: string[]) {\n  const { isEnabled, isLoading } = useFeatureFlags();\n  \n  const flags = flagIds.reduce((acc, flagId) => {\n    acc[flagId] = isEnabled(flagId);\n    return acc;\n  }, {} as Record<string, boolean>);\n  \n  const allEnabled = flagIds.every(flagId => isEnabled(flagId));\n  const anyEnabled = flagIds.some(flagId => isEnabled(flagId));\n  \n  return {\n    flags,\n    allEnabled,\n    anyEnabled,\n    allDisabled: !anyEnabled,\n    loading: isLoading\n  };\n}\n\n// Hook for feature flag with dependencies\nexport function useFeatureFlagWithDependencies(flagId: string) {\n  const { isEnabled, areDependenciesEnabled, isLoading } = useFeatureFlags();\n  \n  return {\n    enabled: isEnabled(flagId),\n    disabled: !isEnabled(flagId),\n    dependenciesMet: areDependenciesEnabled(flagId),\n    loading: isLoading\n  };\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"],"names":["useFeatureFlag","useFeatureFlagWithDependencies","useFeatureFlags","useFeatureFlagsBatch","features","setFeatureFlag","toggleFeatureFlag","useAppStore","isLoading","setIsLoading","useState","error","setError","fetchFlags","response","fetch","ok","Error","status","data","json","success","flagUpdates","Object","entries","flags","forEach","key","value","getState","setFeatureFlags","err","errorMessage","message","console","useEffect","clearError","isEnabled","flagId","getAllFlags","featureFlagManager","getEnabledFlags","getDisabledFlags","getFlagsByCategory","category","getSystemInfo","systemInfo","areDependenciesEnabled","subscribe","callback","enabled","disabled","loading","flagIds","reduce","acc","allEnabled","every","anyEnabled","some","allDisabled","dependenciesMet"],"mappings":"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"}
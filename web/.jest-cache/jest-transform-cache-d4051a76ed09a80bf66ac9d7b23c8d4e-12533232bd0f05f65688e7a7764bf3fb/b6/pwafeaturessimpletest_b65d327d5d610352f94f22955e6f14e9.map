{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/components/features/pwa/pwa-features-simple.test.tsx"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\n\n// Mock window.matchMedia before any imports\nObject.defineProperty(window, 'matchMedia', {\n  value: jest.fn().mockImplementation(query => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(),\n    removeListener: jest.fn(),\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn(),\n  })),\n  writable: true,\n});\n\n// Mock browser APIs\nObject.defineProperty(navigator, 'serviceWorker', {\n  value: {\n    register: jest.fn(),\n    ready: Promise.resolve(),\n  },\n  writable: true,\n});\n\n// Mock online/offline events\nObject.defineProperty(navigator, 'onLine', {\n  value: true,\n  writable: true,\n});\n\n// Mock lucide-react icons\njest.mock('lucide-react', () => ({\n  Bell: () => <div data-testid=\"bell-icon\" />,\n  BellOff: () => <div data-testid=\"bell-off-icon\" />,\n  CheckCircle: () => <div data-testid=\"check-circle-icon\" />,\n  AlertCircle: () => <div data-testid=\"alert-circle-icon\" />,\n  Wifi: () => <div data-testid=\"wifi-icon\" />,\n  WifiOff: () => <div data-testid=\"wifi-off-icon\" />,\n  Download: () => <div data-testid=\"download-icon\" />,\n  Settings: () => <div data-testid=\"settings-icon\" />,\n  RefreshCw: () => <div data-testid=\"refresh-icon\" />,\n  Database: () => <div data-testid=\"database-icon\" />,\n  Clock: () => <div data-testid=\"clock-icon\" />,\n  Check: () => <div data-testid=\"check-icon\" />,\n  X: () => <div data-testid=\"x-icon\" />,\n}));\n\n// Mock Zustand PWA store hooks\njest.mock('@/lib/stores', () => ({\n  usePWAInstallation: jest.fn(() => ({\n    isInstalled: false,\n    canInstall: true,\n    installPrompt: null,\n    installSource: 'manual',\n    version: '1.0.0',\n  })),\n  usePWAOffline: jest.fn(() => ({\n    isOnline: true,\n    isOffline: false,\n    lastOnline: new Date().toISOString(),\n    offlineData: {\n      cachedPages: [],\n      cachedResources: [],\n      queuedActions: []\n    },\n  })),\n  usePWANotifications: jest.fn(() => []),\n  usePWALoading: jest.fn(() => false),\n  usePWAError: jest.fn(() => null),\n  usePWAActions: jest.fn(() => {\n    console.log('usePWAActions mock called');\n    return {\n      setInstallation: jest.fn(),\n      setInstallPrompt: jest.fn(),\n      setCanInstall: jest.fn(),\n      installPWA: jest.fn(),\n      uninstallPWA: jest.fn(),\n      setOnlineStatus: jest.fn(),\n    setOfflineData: jest.fn(),\n    addCachedPage: jest.fn(),\n    removeCachedPage: jest.fn(),\n    addCachedResource: jest.fn(),\n    removeCachedResource: jest.fn(),\n    queueOfflineAction: jest.fn(),\n    processOfflineActions: jest.fn(),\n    setUpdateAvailable: jest.fn(),\n    downloadUpdate: jest.fn(),\n    installUpdate: jest.fn(),\n    skipUpdate: jest.fn(),\n    setAutoUpdate: jest.fn(),\n    addNotification: jest.fn(),\n    removeNotification: jest.fn(),\n    markNotificationRead: jest.fn(),\n    clearNotifications: jest.fn(),\n    setPerformance: jest.fn(),\n    updatePerformanceMetrics: jest.fn(),\n    updatePreferences: jest.fn(),\n    resetPreferences: jest.fn(),\n    registerServiceWorker: jest.fn(),\n    unregisterServiceWorker: jest.fn(),\n    updateServiceWorker: jest.fn(),\n    syncData: jest.fn(),\n    clearCache: jest.fn(),\n    exportData: jest.fn(),\n    importData: jest.fn(),\n    setLoading: jest.fn(),\n    setInstalling: jest.fn(),\n    setUpdating: jest.fn(),\n    setSyncing: jest.fn(),\n      setError: jest.fn(),\n      clearError: jest.fn(),\n    };\n  }),\n}));\n\nimport React from 'react';\nimport { render, screen } from '@testing-library/react';\nimport { BrowserRouter } from 'react-router-dom';\nimport PWAFeatures from '@/features/pwa/components/PWAFeatures';\n\n// Mock Notification API\nObject.defineProperty(window, 'Notification', {\n  value: {\n    permission: 'granted',\n    requestPermission: jest.fn().mockResolvedValue('granted'),\n  },\n  writable: true,\n});\n\n// Mock localStorage\nObject.defineProperty(window, 'localStorage', {\n  value: {\n    getItem: jest.fn(),\n    setItem: jest.fn(),\n    removeItem: jest.fn(),\n    clear: jest.fn(),\n  },\n  writable: true,\n});\n\ndescribe('PWA Features - Simple Testing', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Component Rendering', () => {\n    it('should render PWA features when installation is available', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      // Debug: Check what's actually rendered\n      console.log('Rendered HTML:', document.body.innerHTML);\n      \n      // Check for basic PWA elements\n      expect(screen.getByTestId('pwa-features')).toBeInTheDocument();\n      expect(screen.getByTestId('offline-features')).toBeInTheDocument();\n    });\n\n    it('should not render when PWA is already installed and no features available', () => {\n      // Mock already installed state\n      const { usePWAInstallation } = require('@/lib/stores');\n      usePWAInstallation.mockReturnValue({\n        isInstalled: true,\n        canInstall: false,\n        installPrompt: null,\n        installSource: 'manual',\n        version: '1.0.0',\n      });\n\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      // When PWA is installed and no features available, component returns null\n      expect(screen.queryByTestId('pwa-features')).not.toBeInTheDocument();\n    });\n\n    it('should render with custom className', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures className=\"custom-class\" />\n        </BrowserRouter>\n      );\n\n      const container = screen.getByTestId('pwa-features');\n      expect(container).toHaveClass('custom-class');\n    });\n  });\n\n  describe('Offline Features', () => {\n    it('should display offline indicator', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      expect(screen.getByTestId('offline-features')).toBeInTheDocument();\n    });\n\n    it('should show offline polls when cached pages exist', () => {\n      // Mock offline data with cached pages\n      const { usePWAOffline } = require('@/lib/stores');\n      usePWAOffline.mockReturnValue({\n        isOnline: false,\n        isOffline: true,\n        lastOnline: new Date().toISOString(),\n        offlineData: {\n          cachedPages: ['poll-1', 'poll-2'],\n          cachedResources: [],\n          queuedActions: [],\n        },\n      });\n\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      expect(screen.getByTestId('offline-polls')).toBeInTheDocument();\n    });\n\n    it('should show offline queue when queued actions exist', () => {\n      // Mock offline data with queued actions\n      const { usePWAOffline } = require('@/lib/stores');\n      usePWAOffline.mockReturnValue({\n        isOnline: false,\n        isOffline: true,\n        lastOnline: new Date().toISOString(),\n        offlineData: {\n          cachedPages: [],\n          cachedResources: [],\n          queuedActions: ['action-1', 'action-2'],\n        },\n      });\n\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      expect(screen.getByTestId('offline-queue-container')).toBeInTheDocument();\n    });\n  });\n\n  describe('Notification Features', () => {\n    it('should display notification features', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      expect(screen.getByTestId('notification-features')).toBeInTheDocument();\n    });\n\n    it('should show different notification types for different user roles', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      expect(screen.getByTestId('regular-user-notifications')).toBeInTheDocument();\n      expect(screen.getByTestId('admin-user-notifications')).toBeInTheDocument();\n    });\n  });\n\n  describe('Performance', () => {\n    it('should render within performance budget', () => {\n      const startTime = performance.now();\n      \n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n      \n      const endTime = performance.now();\n      const renderTime = endTime - startTime;\n      \n      expect(renderTime).toBeLessThan(100); // 100ms budget\n    });\n  });\n});"],"names":["jest","mock","Bell","div","data-testid","BellOff","CheckCircle","AlertCircle","Wifi","WifiOff","Download","Settings","RefreshCw","Database","Clock","Check","X","usePWAInstallation","fn","isInstalled","canInstall","installPrompt","installSource","version","usePWAOffline","isOnline","isOffline","lastOnline","Date","toISOString","offlineData","cachedPages","cachedResources","queuedActions","usePWANotifications","usePWALoading","usePWAError","usePWAActions","console","log","setInstallation","setInstallPrompt","setCanInstall","installPWA","uninstallPWA","setOnlineStatus","setOfflineData","addCachedPage","removeCachedPage","addCachedResource","removeCachedResource","queueOfflineAction","processOfflineActions","setUpdateAvailable","downloadUpdate","installUpdate","skipUpdate","setAutoUpdate","addNotification","removeNotification","markNotificationRead","clearNotifications","setPerformance","updatePerformanceMetrics","updatePreferences","resetPreferences","registerServiceWorker","unregisterServiceWorker","updateServiceWorker","syncData","clearCache","exportData","importData","setLoading","setInstalling","setUpdating","setSyncing","setError","clearError","Object","defineProperty","window","value","mockImplementation","query","matches","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent","writable","navigator","register","ready","Promise","resolve","permission","requestPermission","mockResolvedValue","getItem","setItem","removeItem","clear","describe","beforeEach","clearAllMocks","it","render","BrowserRouter","PWAFeatures","document","body","innerHTML","expect","screen","getByTestId","toBeInTheDocument","require","mockReturnValue","queryByTestId","not","className","container","toHaveClass","startTime","performance","now","endTime","renderTime","toBeLessThan"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/features/trending-hashtag-system.test.ts"],"sourcesContent":["/**\n * Unit Tests for Trending Hashtag System\n * \n * Tests the hashtag-based trending polls implementation:\n * - HashtagPollsIntegrationService\n * - TrendingHashtagsTracker\n * - Hashtag analytics and scoring\n * - Trending polls API integration\n * \n * Created: January 23, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals';\nimport { HashtagPollsIntegrationService } from '@/features/feeds/lib/hashtag-polls-integration';\nimport { TrendingHashtagsTracker } from '@/features/feeds/lib/TrendingHashtags';\nimport { calculateTrendingHashtags } from '@/features/hashtags/lib/hashtag-analytics';\nimport { T } from '@/tests/registry/testIds';\n\n// Mock Supabase\nconst mockSupabase = {\n  from: jest.fn(() => ({\n    select: jest.fn(() => ({\n      eq: jest.fn(() => ({\n        gte: jest.fn(() => ({\n          order: jest.fn(() => ({\n            limit: jest.fn(() => Promise.resolve({ data: [], error: null }))\n          }))\n        }))\n      }))\n    })),\n    insert: jest.fn(() => Promise.resolve({ data: [], error: null })),\n    update: jest.fn(() => Promise.resolve({ data: [], error: null }))\n  }))\n};\n\njest.mock('@/lib/supabase/client', () => ({\n  createClient: () => mockSupabase\n}));\n\ndescribe('Trending Hashtag System - Unit Tests', () => {\n  let hashtagService: HashtagPollsIntegrationService;\n  let trendingTracker: TrendingHashtagsTracker;\n\n  beforeEach(() => {\n    hashtagService = new HashtagPollsIntegrationService(mockSupabase);\n    trendingTracker = TrendingHashtagsTracker.getInstance();\n    jest.clearAllMocks();\n  });\n\n  describe('HashtagPollsIntegrationService', () => {\n    it('should initialize with proper configuration', () => {\n      expect(hashtagService).toBeDefined();\n      expect(hashtagService).toBeInstanceOf(HashtagPollsIntegrationService);\n    });\n\n    it('should generate personalized feed with trending hashtags', async () => {\n      const mockUserId = 'test-user-123';\n      const mockHashtagData = [\n        { hashtag: '#politics', usage_count: 45, recency_score: 0.8 },\n        { hashtag: '#climate', usage_count: 32, recency_score: 0.9 },\n        { hashtag: '#economy', usage_count: 28, recency_score: 0.7 }\n      ];\n\n      // Mock the analytics_events query\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            gte: jest.fn(() => ({\n              order: jest.fn(() => Promise.resolve({ \n                data: mockHashtagData, \n                error: null \n              }))\n            }))\n          }))\n        }))\n      });\n\n      const result = await hashtagService.generatePersonalizedFeed(mockUserId, 10);\n      \n      expect(result).toBeDefined();\n      expect(result.recommended_polls).toBeDefined();\n      expect(result.trending_hashtags).toBeDefined();\n      expect(result.user_interests).toBeDefined();\n    });\n\n    it('should calculate trending scores with proper weighting', () => {\n      const mockHashtagUsage = [\n        { hashtag: '#politics', count: 50, recency: 0.9 },\n        { hashtag: '#climate', count: 30, recency: 0.8 },\n        { hashtag: '#economy', count: 20, recency: 0.7 }\n      ];\n\n      // Test trending score calculation (count * 0.7 + recency * 0.3)\n      const trendingScores = mockHashtagUsage.map(item => ({\n        hashtag: item.hashtag,\n        score: item.count * 0.7 + item.recency * 0.3\n      })).sort((a, b) => b.score - a.score);\n\n      expect(trendingScores[0].hashtag).toBe('#politics');\n      expect(trendingScores[0].score).toBe(50 * 0.7 + 0.9 * 0.3); // 35.27\n      expect(trendingScores[1].hashtag).toBe('#climate');\n      expect(trendingScores[2].hashtag).toBe('#economy');\n    });\n\n    it('should track hashtag engagement correctly', async () => {\n      const mockEngagement = {\n        hashtag: '#politics',\n        action: 'view' as const,\n        userId: 'test-user-123',\n        timestamp: new Date().toISOString()\n      };\n\n      mockSupabase.from.mockReturnValue({\n        insert: jest.fn(() => Promise.resolve({ \n          data: [mockEngagement], \n          error: null \n        }))\n      });\n\n      const result = await hashtagService.trackHashtagEngagement(\n        mockEngagement.userId,\n        mockEngagement.hashtag,\n        mockEngagement.action\n      );\n\n      expect(result).toBe(true);\n      expect(mockSupabase.from).toHaveBeenCalledWith('analytics_events');\n    });\n\n    it('should handle empty hashtag data gracefully', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            gte: jest.fn(() => ({\n              order: jest.fn(() => Promise.resolve({ \n                data: [], \n                error: null \n              }))\n            }))\n          }))\n        }))\n      });\n\n      const result = await hashtagService.generatePersonalizedFeed('test-user', 10);\n      \n      expect(result.recommended_polls).toEqual([]);\n      expect(result.trending_hashtags).toEqual([]);\n      expect(result.user_interests).toBeDefined();\n    });\n  });\n\n  describe('TrendingHashtagsTracker', () => {\n    it('should track hashtag usage correctly', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Track some hashtag usage\n      tracker.trackHashtagUsage('user1', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('user2', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('user3', '#climate', { category: 'environment' });\n\n      const trendingHashtags = tracker.getTrendingHashtags(5);\n      \n      expect(trendingHashtags).toBeDefined();\n      expect(Array.isArray(trendingHashtags)).toBe(true);\n    });\n\n    it('should provide comprehensive hashtag analytics', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Add test data\n      tracker.trackHashtagUsage('user1', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('user2', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('user3', '#climate', { category: 'environment' });\n      tracker.trackHashtagUsage('user4', '#economy', { category: 'economics' });\n\n      const analytics = tracker.getHashtagAnalytics();\n      \n      expect(analytics.totalHashtags).toBeGreaterThan(0);\n      expect(analytics.totalUsage).toBeGreaterThan(0);\n      expect(analytics.trendingHashtags).toBeDefined();\n      expect(analytics.categoryBreakdown).toBeDefined();\n      expect(analytics.userEngagement).toBeDefined();\n    });\n\n    it('should identify viral potential hashtags', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Simulate high-engagement hashtag\n      for (let i = 0; i < 15; i++) {\n        tracker.trackHashtagUsage(`user${i}`, '#viral', { category: 'trending' });\n      }\n\n      const analytics = tracker.getHashtagAnalytics();\n      \n      expect(analytics.viralPotential).toBeDefined();\n      expect(Array.isArray(analytics.viralPotential)).toBe(true);\n    });\n\n    it('should handle time-based trending calculations', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Simulate hashtag usage over time\n      const now = Date.now();\n      const oneHourAgo = now - (60 * 60 * 1000);\n      const twoHoursAgo = now - (2 * 60 * 60 * 1000);\n\n      // Mock time-based usage\n      tracker.trackHashtagUsage('user1', '#trending', { \n        category: 'trending',\n        timestamp: new Date(oneHourAgo).toISOString()\n      });\n      \n      tracker.trackHashtagUsage('user2', '#trending', { \n        category: 'trending',\n        timestamp: new Date(twoHoursAgo).toISOString()\n      });\n\n      const analytics = tracker.getHashtagAnalytics();\n      \n      expect(analytics.trendingHashtags).toBeDefined();\n      expect(Array.isArray(analytics.trendingHashtags)).toBe(true);\n    });\n  });\n\n  describe('Hashtag Analytics Integration', () => {\n    it('should calculate trending hashtags with proper metrics', async () => {\n      const mockUsageData = [\n        { hashtag_id: 'hashtag-1', created_at: new Date().toISOString(), user_id: 'user1' },\n        { hashtag_id: 'hashtag-1', created_at: new Date().toISOString(), user_id: 'user2' },\n        { hashtag_id: 'hashtag-2', created_at: new Date().toISOString(), user_id: 'user3' }\n      ];\n\n      const mockHashtags = [\n        { id: 'hashtag-1', name: '#politics', category: 'politics' },\n        { id: 'hashtag-2', name: '#climate', category: 'environment' }\n      ];\n\n      // Mock database queries\n      mockSupabase.from.mockImplementation((table: string) => {\n        if (table === 'hashtag_usage') {\n          return {\n            select: jest.fn(() => ({\n              gte: jest.fn(() => ({\n                order: jest.fn(() => Promise.resolve({ \n                  data: mockUsageData, \n                  error: null \n                }))\n              }))\n            }))\n          };\n        } else if (table === 'hashtags') {\n          return {\n            select: jest.fn(() => ({\n              in: jest.fn(() => Promise.resolve({ \n                data: mockHashtags, \n                error: null \n              }))\n            }))\n          };\n        }\n        return { select: jest.fn(() => ({ eq: jest.fn(() => Promise.resolve({ data: [], error: null })) })) };\n      });\n\n      const trendingHashtags = await calculateTrendingHashtags('politics', 10);\n      \n      expect(trendingHashtags).toBeDefined();\n      expect(Array.isArray(trendingHashtags)).toBe(true);\n    });\n\n    it('should handle different time periods correctly', async () => {\n      const periods = ['24h', '7d', '30d', '90d', '1y'] as const;\n      \n      for (const period of periods) {\n        const mockUsageData = [\n          { hashtag_id: 'hashtag-1', created_at: new Date().toISOString(), user_id: 'user1' }\n        ];\n\n        mockSupabase.from.mockReturnValue({\n          select: jest.fn(() => ({\n            gte: jest.fn(() => ({\n              order: jest.fn(() => Promise.resolve({ \n                data: mockUsageData, \n                error: null \n              }))\n            }))\n          }))\n        });\n\n        const result = await calculateTrendingHashtags('politics', 10);\n        expect(result).toBeDefined();\n      }\n    });\n  });\n\n  describe('Component Integration with Test IDs', () => {\n    it('should use proper test IDs for trending polls components', () => {\n      const expectedTestIds = [\n        T.dashboard.trendingPollsSection,\n        T.dashboard.trendingHashtags,\n        T.dashboard.trendingPolls,\n        T.poll.item,\n        T.poll.title,\n        T.poll.category\n      ];\n\n      expectedTestIds.forEach(testId => {\n        expect(testId).toBeDefined();\n        expect(typeof testId).toBe('string');\n        expect(testId.length).toBeGreaterThan(0);\n      });\n    });\n\n    it('should handle hashtag selection with proper test IDs', () => {\n      const hashtagSelectionTestIds = [\n        T.poll.categoryFilter,\n        T.poll.search,\n        T.dashboard.feedTab\n      ];\n\n      hashtagSelectionTestIds.forEach(testId => {\n        expect(testId).toBeDefined();\n        expect(typeof testId).toBe('string');\n      });\n    });\n  });\n\n  describe('Performance and Caching', () => {\n    it('should implement proper caching for trending hashtags', () => {\n      const cache = new Map();\n      const cacheKey = 'trending_hashtags_10';\n      const mockData = ['#politics', '#climate', '#economy'];\n      \n      cache.set(cacheKey, mockData);\n      const cached = cache.get(cacheKey);\n      \n      expect(cached).toEqual(mockData);\n    });\n\n    it('should handle cache expiration correctly', () => {\n      const cache = new Map();\n      const cacheKey = 'trending_hashtags_10';\n      const cacheData = {\n        data: ['#politics', '#climate'],\n        timestamp: Date.now() - 25 * 60 * 60 * 1000 // 25 hours ago\n      };\n\n      cache.set(cacheKey, cacheData);\n\n      // Check if cache is expired (24 hour TTL)\n      const isExpired = Date.now() - cacheData.timestamp > 24 * 60 * 60 * 1000;\n      expect(isExpired).toBe(true);\n    });\n\n    it('should handle concurrent hashtag tracking', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Simulate concurrent usage tracking\n      const promises = [];\n      for (let i = 0; i < 100; i++) {\n        promises.push(\n          Promise.resolve(tracker.trackHashtagUsage(`user${i}`, '#concurrent', { category: 'test' }))\n        );\n      }\n\n      return Promise.all(promises).then(() => {\n        const analytics = tracker.getHashtagAnalytics();\n        expect(analytics.totalUsage).toBeGreaterThanOrEqual(100);\n      });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle database errors gracefully', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            gte: jest.fn(() => ({\n              order: jest.fn(() => Promise.resolve({ \n                data: null, \n                error: new Error('Database connection failed') \n              }))\n            }))\n          }))\n        }))\n      });\n\n      const result = await hashtagService.generatePersonalizedFeed('test-user', 10);\n      \n      // Should return empty results instead of throwing\n      expect(result.recommended_polls).toEqual([]);\n      expect(result.trending_hashtags).toEqual([]);\n    });\n\n    it('should provide fallback data when analytics fail', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => Promise.resolve({ \n            data: [], \n            error: new Error('Analytics service unavailable') \n          }))\n        }))\n      });\n\n      const result = await hashtagService.generatePersonalizedFeed('test-user', 10);\n      \n      expect(result.user_interests).toBeDefined();\n      expect(Array.isArray(result.user_interests)).toBe(true);\n    });\n  });\n});\n"],"names":["mockSupabase","from","jest","fn","select","eq","gte","order","limit","Promise","resolve","data","error","insert","update","mock","createClient","describe","hashtagService","trendingTracker","beforeEach","HashtagPollsIntegrationService","TrendingHashtagsTracker","getInstance","clearAllMocks","it","expect","toBeDefined","toBeInstanceOf","mockUserId","mockHashtagData","hashtag","usage_count","recency_score","mockReturnValue","result","generatePersonalizedFeed","recommended_polls","trending_hashtags","user_interests","mockHashtagUsage","count","recency","trendingScores","map","item","score","sort","a","b","toBe","mockEngagement","action","userId","timestamp","Date","toISOString","trackHashtagEngagement","toHaveBeenCalledWith","toEqual","tracker","trackHashtagUsage","category","trendingHashtags","getTrendingHashtags","Array","isArray","analytics","getHashtagAnalytics","totalHashtags","toBeGreaterThan","totalUsage","categoryBreakdown","userEngagement","i","viralPotential","now","oneHourAgo","twoHoursAgo","mockUsageData","hashtag_id","created_at","user_id","mockHashtags","id","name","mockImplementation","table","in","calculateTrendingHashtags","periods","period","expectedTestIds","T","dashboard","trendingPollsSection","trendingPolls","poll","title","forEach","testId","length","hashtagSelectionTestIds","categoryFilter","search","feedTab","cache","Map","cacheKey","mockData","set","cached","get","cacheData","isExpired","promises","push","all","then","toBeGreaterThanOrEqual","Error"],"mappings":"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"}
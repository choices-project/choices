cada563f6dc0f1f2c37948cceba6da4b
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
/**
 * Check RLS Policies Test
 * 
 * Tests to understand why we can't see data despite service role key
 * 
 * Created: January 27, 2025
 * Status: âœ… PRODUCTION READY
 */ (0, _globals.describe)('Check RLS Policies', ()=>{
    (0, _globals.it)('should check if RLS is blocking our queries', async ()=>{
        const { createClient } = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("@supabase/supabase-js")));
        const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;
        const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
        if (!supabaseUrl || !supabaseKey) {
            throw new Error('Supabase credentials not found');
        }
        const supabase = createClient(supabaseUrl, supabaseKey);
        console.log('ðŸ” Checking RLS policies...');
        // Try to get a count of polls without RLS
        const { data: countData, error: countError } = await supabase.from('polls').select('id', {
            count: 'exact',
            head: true
        });
        console.log('Count query result:', {
            countData,
            countError
        });
        // Try to get all polls with explicit RLS bypass
        const { data: allPolls, error: allPollsError } = await supabase.from('polls').select('*').limit(5);
        console.log('All polls query result:', {
            allPolls,
            allPollsError
        });
        // Try to get specific columns that we know exist
        const { data: specificColumns, error: specificError } = await supabase.from('polls').select('id, title, description').limit(5);
        console.log('Specific columns query result:', {
            specificColumns,
            specificError
        });
        // Try to insert a test poll to see if that works
        const testPoll = {
            title: 'RLS Test Poll',
            description: 'Testing RLS policies',
            question: 'Does RLS work?',
            options: [
                'Yes',
                'No'
            ],
            voting_method: 'single_choice',
            status: 'active',
            created_by: 'test-user',
            privacy_level: 'public'
        };
        const { data: insertResult, error: insertError } = await supabase.from('polls').insert(testPoll).select();
        console.log('Insert test result:', {
            insertResult,
            insertError
        });
        // If insert worked, try to query it back
        if (!insertError && insertResult) {
            const { data: queryBack, error: queryBackError } = await supabase.from('polls').select('*').eq('title', 'RLS Test Poll');
            console.log('Query back result:', {
                queryBack,
                queryBackError
            });
            // Clean up
            if (queryBack && queryBack.length > 0) {
                const { error: deleteError } = await supabase.from('polls').delete().eq('id', queryBack[0].id);
                console.log('Cleanup result:', {
                    deleteError
                });
            }
        }
        // The test should pass if we can at least connect
        (0, _globals.expect)(countError).toBeNull();
        (0, _globals.expect)(allPollsError).toBeNull();
        (0, _globals.expect)(specificError).toBeNull();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L2ludGVncmF0aW9uL2NoZWNrLXJscy1wb2xpY2llcy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5cbi8qKlxuICogQ2hlY2sgUkxTIFBvbGljaWVzIFRlc3RcbiAqIFxuICogVGVzdHMgdG8gdW5kZXJzdGFuZCB3aHkgd2UgY2FuJ3Qgc2VlIGRhdGEgZGVzcGl0ZSBzZXJ2aWNlIHJvbGUga2V5XG4gKiBcbiAqIENyZWF0ZWQ6IEphbnVhcnkgMjcsIDIwMjVcbiAqIFN0YXR1czog4pyFIFBST0RVQ1RJT04gUkVBRFlcbiAqL1xuXG5kZXNjcmliZSgnQ2hlY2sgUkxTIFBvbGljaWVzJywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIGNoZWNrIGlmIFJMUyBpcyBibG9ja2luZyBvdXIgcXVlcmllcycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IGNyZWF0ZUNsaWVudCB9ID0gYXdhaXQgaW1wb3J0KCdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnKTtcbiAgICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTCB8fCBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gICAgY29uc3Qgc3VwYWJhc2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xuICAgIFxuICAgIGlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlS2V5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGNyZWRlbnRpYWxzIG5vdCBmb3VuZCcpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXkpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5SNIENoZWNraW5nIFJMUyBwb2xpY2llcy4uLicpO1xuICAgIFxuICAgIC8vIFRyeSB0byBnZXQgYSBjb3VudCBvZiBwb2xscyB3aXRob3V0IFJMU1xuICAgIGNvbnN0IHsgZGF0YTogY291bnREYXRhLCBlcnJvcjogY291bnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwb2xscycpXG4gICAgICAuc2VsZWN0KCdpZCcsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0NvdW50IHF1ZXJ5IHJlc3VsdDonLCB7IGNvdW50RGF0YSwgY291bnRFcnJvciB9KTtcbiAgICBcbiAgICAvLyBUcnkgdG8gZ2V0IGFsbCBwb2xscyB3aXRoIGV4cGxpY2l0IFJMUyBieXBhc3NcbiAgICBjb25zdCB7IGRhdGE6IGFsbFBvbGxzLCBlcnJvcjogYWxsUG9sbHNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwb2xscycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5saW1pdCg1KTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnQWxsIHBvbGxzIHF1ZXJ5IHJlc3VsdDonLCB7IGFsbFBvbGxzLCBhbGxQb2xsc0Vycm9yIH0pO1xuICAgIFxuICAgIC8vIFRyeSB0byBnZXQgc3BlY2lmaWMgY29sdW1ucyB0aGF0IHdlIGtub3cgZXhpc3RcbiAgICBjb25zdCB7IGRhdGE6IHNwZWNpZmljQ29sdW1ucywgZXJyb3I6IHNwZWNpZmljRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLnNlbGVjdCgnaWQsIHRpdGxlLCBkZXNjcmlwdGlvbicpXG4gICAgICAubGltaXQoNSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1NwZWNpZmljIGNvbHVtbnMgcXVlcnkgcmVzdWx0OicsIHsgc3BlY2lmaWNDb2x1bW5zLCBzcGVjaWZpY0Vycm9yIH0pO1xuICAgIFxuICAgIC8vIFRyeSB0byBpbnNlcnQgYSB0ZXN0IHBvbGwgdG8gc2VlIGlmIHRoYXQgd29ya3NcbiAgICBjb25zdCB0ZXN0UG9sbCA9IHtcbiAgICAgIHRpdGxlOiAnUkxTIFRlc3QgUG9sbCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ1Rlc3RpbmcgUkxTIHBvbGljaWVzJyxcbiAgICAgIHF1ZXN0aW9uOiAnRG9lcyBSTFMgd29yaz8nLFxuICAgICAgb3B0aW9uczogWydZZXMnLCAnTm8nXSxcbiAgICAgIHZvdGluZ19tZXRob2Q6ICdzaW5nbGVfY2hvaWNlJyxcbiAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICBjcmVhdGVkX2J5OiAndGVzdC11c2VyJyxcbiAgICAgIHByaXZhY3lfbGV2ZWw6ICdwdWJsaWMnXG4gICAgfTtcbiAgICBcbiAgICBjb25zdCB7IGRhdGE6IGluc2VydFJlc3VsdCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3BvbGxzJylcbiAgICAgIC5pbnNlcnQodGVzdFBvbGwpXG4gICAgICAuc2VsZWN0KCk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0luc2VydCB0ZXN0IHJlc3VsdDonLCB7IGluc2VydFJlc3VsdCwgaW5zZXJ0RXJyb3IgfSk7XG4gICAgXG4gICAgLy8gSWYgaW5zZXJ0IHdvcmtlZCwgdHJ5IHRvIHF1ZXJ5IGl0IGJhY2tcbiAgICBpZiAoIWluc2VydEVycm9yICYmIGluc2VydFJlc3VsdCkge1xuICAgICAgY29uc3QgeyBkYXRhOiBxdWVyeUJhY2ssIGVycm9yOiBxdWVyeUJhY2tFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3BvbGxzJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5lcSgndGl0bGUnLCAnUkxTIFRlc3QgUG9sbCcpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnUXVlcnkgYmFjayByZXN1bHQ6JywgeyBxdWVyeUJhY2ssIHF1ZXJ5QmFja0Vycm9yIH0pO1xuICAgICAgXG4gICAgICAvLyBDbGVhbiB1cFxuICAgICAgaWYgKHF1ZXJ5QmFjayAmJiBxdWVyeUJhY2subGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgICAgIC5kZWxldGUoKVxuICAgICAgICAgIC5lcSgnaWQnLCBxdWVyeUJhY2tbMF0uaWQpO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coJ0NsZWFudXAgcmVzdWx0OicsIHsgZGVsZXRlRXJyb3IgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFRoZSB0ZXN0IHNob3VsZCBwYXNzIGlmIHdlIGNhbiBhdCBsZWFzdCBjb25uZWN0XG4gICAgZXhwZWN0KGNvdW50RXJyb3IpLnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KGFsbFBvbGxzRXJyb3IpLnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KHNwZWNpZmljRXJyb3IpLnRvQmVOdWxsKCk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJpdCIsImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwic3VwYWJhc2UiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsImNvdW50RGF0YSIsImVycm9yIiwiY291bnRFcnJvciIsImZyb20iLCJzZWxlY3QiLCJjb3VudCIsImhlYWQiLCJhbGxQb2xscyIsImFsbFBvbGxzRXJyb3IiLCJsaW1pdCIsInNwZWNpZmljQ29sdW1ucyIsInNwZWNpZmljRXJyb3IiLCJ0ZXN0UG9sbCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJxdWVzdGlvbiIsIm9wdGlvbnMiLCJ2b3RpbmdfbWV0aG9kIiwic3RhdHVzIiwiY3JlYXRlZF9ieSIsInByaXZhY3lfbGV2ZWwiLCJpbnNlcnRSZXN1bHQiLCJpbnNlcnRFcnJvciIsImluc2VydCIsInF1ZXJ5QmFjayIsInF1ZXJ5QmFja0Vycm9yIiwiZXEiLCJsZW5ndGgiLCJkZWxldGVFcnJvciIsImRlbGV0ZSIsImlkIiwiZXhwZWN0IiwidG9CZU51bGwiXSwibWFwcGluZ3MiOiI7Ozs7eUJBQXFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFckM7Ozs7Ozs7Q0FPQyxHQUVEQSxJQUFBQSxpQkFBUSxFQUFDLHNCQUFzQjtJQUM3QkMsSUFBQUEsV0FBRSxFQUFDLCtDQUErQztRQUNoRCxNQUFNLEVBQUVDLFlBQVksRUFBRSxHQUFHLE1BQU0sbUVBQUEsUUFBTztRQUN0QyxNQUFNQyxjQUFjQyxRQUFRQyxHQUFHLENBQUNDLFlBQVksSUFBSUYsUUFBUUMsR0FBRyxDQUFDRSx3QkFBd0I7UUFDcEYsTUFBTUMsY0FBY0osUUFBUUMsR0FBRyxDQUFDSSx5QkFBeUI7UUFFekQsSUFBSSxDQUFDTixlQUFlLENBQUNLLGFBQWE7WUFDaEMsTUFBTSxJQUFJRSxNQUFNO1FBQ2xCO1FBRUEsTUFBTUMsV0FBV1QsYUFBYUMsYUFBYUs7UUFFM0NJLFFBQVFDLEdBQUcsQ0FBQztRQUVaLDBDQUEwQztRQUMxQyxNQUFNLEVBQUVDLE1BQU1DLFNBQVMsRUFBRUMsT0FBT0MsVUFBVSxFQUFFLEdBQUcsTUFBTU4sU0FDbERPLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsTUFBTTtZQUFFQyxPQUFPO1lBQVNDLE1BQU07UUFBSztRQUU3Q1QsUUFBUUMsR0FBRyxDQUFDLHVCQUF1QjtZQUFFRTtZQUFXRTtRQUFXO1FBRTNELGdEQUFnRDtRQUNoRCxNQUFNLEVBQUVILE1BQU1RLFFBQVEsRUFBRU4sT0FBT08sYUFBYSxFQUFFLEdBQUcsTUFBTVosU0FDcERPLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsS0FDUEssS0FBSyxDQUFDO1FBRVRaLFFBQVFDLEdBQUcsQ0FBQywyQkFBMkI7WUFBRVM7WUFBVUM7UUFBYztRQUVqRSxpREFBaUQ7UUFDakQsTUFBTSxFQUFFVCxNQUFNVyxlQUFlLEVBQUVULE9BQU9VLGFBQWEsRUFBRSxHQUFHLE1BQU1mLFNBQzNETyxJQUFJLENBQUMsU0FDTEMsTUFBTSxDQUFDLDBCQUNQSyxLQUFLLENBQUM7UUFFVFosUUFBUUMsR0FBRyxDQUFDLGtDQUFrQztZQUFFWTtZQUFpQkM7UUFBYztRQUUvRSxpREFBaUQ7UUFDakQsTUFBTUMsV0FBVztZQUNmQyxPQUFPO1lBQ1BDLGFBQWE7WUFDYkMsVUFBVTtZQUNWQyxTQUFTO2dCQUFDO2dCQUFPO2FBQUs7WUFDdEJDLGVBQWU7WUFDZkMsUUFBUTtZQUNSQyxZQUFZO1lBQ1pDLGVBQWU7UUFDakI7UUFFQSxNQUFNLEVBQUVyQixNQUFNc0IsWUFBWSxFQUFFcEIsT0FBT3FCLFdBQVcsRUFBRSxHQUFHLE1BQU0xQixTQUN0RE8sSUFBSSxDQUFDLFNBQ0xvQixNQUFNLENBQUNYLFVBQ1BSLE1BQU07UUFFVFAsUUFBUUMsR0FBRyxDQUFDLHVCQUF1QjtZQUFFdUI7WUFBY0M7UUFBWTtRQUUvRCx5Q0FBeUM7UUFDekMsSUFBSSxDQUFDQSxlQUFlRCxjQUFjO1lBQ2hDLE1BQU0sRUFBRXRCLE1BQU15QixTQUFTLEVBQUV2QixPQUFPd0IsY0FBYyxFQUFFLEdBQUcsTUFBTTdCLFNBQ3RETyxJQUFJLENBQUMsU0FDTEMsTUFBTSxDQUFDLEtBQ1BzQixFQUFFLENBQUMsU0FBUztZQUVmN0IsUUFBUUMsR0FBRyxDQUFDLHNCQUFzQjtnQkFBRTBCO2dCQUFXQztZQUFlO1lBRTlELFdBQVc7WUFDWCxJQUFJRCxhQUFhQSxVQUFVRyxNQUFNLEdBQUcsR0FBRztnQkFDckMsTUFBTSxFQUFFMUIsT0FBTzJCLFdBQVcsRUFBRSxHQUFHLE1BQU1oQyxTQUNsQ08sSUFBSSxDQUFDLFNBQ0wwQixNQUFNLEdBQ05ILEVBQUUsQ0FBQyxNQUFNRixTQUFTLENBQUMsRUFBRSxDQUFDTSxFQUFFO2dCQUUzQmpDLFFBQVFDLEdBQUcsQ0FBQyxtQkFBbUI7b0JBQUU4QjtnQkFBWTtZQUMvQztRQUNGO1FBRUEsa0RBQWtEO1FBQ2xERyxJQUFBQSxlQUFNLEVBQUM3QixZQUFZOEIsUUFBUTtRQUMzQkQsSUFBQUEsZUFBTSxFQUFDdkIsZUFBZXdCLFFBQVE7UUFDOUJELElBQUFBLGVBQU0sRUFBQ3BCLGVBQWVxQixRQUFRO0lBQ2hDO0FBQ0YifQ==
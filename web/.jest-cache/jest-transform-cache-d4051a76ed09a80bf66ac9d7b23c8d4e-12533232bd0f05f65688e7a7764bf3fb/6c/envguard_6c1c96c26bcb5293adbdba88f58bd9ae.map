{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/civics/lib/civics/env-guard.ts"],"sourcesContent":["// Run once at server start (import from your route/util entry point)\nfunction isDev() {\n  const env = process.env.NODE_ENV;\n  return env === 'development' || env === 'test';\n}\n\nfunction isPrefixed(v?: string) {\n  return !!v && /^(base64|hex):/.test(v);\n}\nfunction byteLenFromPrefixed(v: string): number {\n  const m = v.match(/^(base64|hex):(.*)$/);\n  if (!m) return 0;\n  const [, enc, body] = m;\n  if (!body) return 0;\n  return enc === 'hex' ? Buffer.from(body, 'hex').length : Buffer.from(body, 'base64').length;\n}\n\nexport function assertPepperConfig() {\n  if (isDev()) {\n    if (!process.env.PRIVACY_PEPPER_DEV) {\n      throw new Error('PRIVACY_PEPPER_DEV required in dev/test');\n    }\n    return;\n  }\n\n  if (process.env.PRIVACY_PEPPER_DEV) {\n    throw new Error('PRIVACY_PEPPER_DEV must NOT be set in preview/prod');\n  }\n  const cur = process.env.PRIVACY_PEPPER_CURRENT;\n  if (!isPrefixed(cur)) throw new Error('PRIVACY_PEPPER_CURRENT must be base64:/hex: prefixed');\n  if (byteLenFromPrefixed(cur!) < 32) throw new Error('PRIVACY_PEPPER_CURRENT must be ≥32 bytes');\n\n  const prev = process.env.PRIVACY_PEPPER_PREVIOUS;\n  if (prev) {\n    if (!isPrefixed(prev)) throw new Error('PRIVACY_PEPPER_PREVIOUS must be base64:/hex: prefixed');\n    if (byteLenFromPrefixed(prev) < 32) throw new Error('PRIVACY_PEPPER_PREVIOUS must be ≥32 bytes');\n  }\n}\n"],"names":["assertPepperConfig","isDev","env","process","NODE_ENV","isPrefixed","v","test","byteLenFromPrefixed","m","match","enc","body","Buffer","from","length","PRIVACY_PEPPER_DEV","Error","cur","PRIVACY_PEPPER_CURRENT","prev","PRIVACY_PEPPER_PREVIOUS"],"mappings":"AAAA,qEAAqE;;;;;+BAiBrDA;;;eAAAA;;;AAhBhB,SAASC;IACP,MAAMC,MAAMC,QAAQD,GAAG,CAACE,QAAQ;IAChC,OAAOF,QAAQ,iBAAiBA,QAAQ;AAC1C;AAEA,SAASG,WAAWC,CAAU;IAC5B,OAAO,CAAC,CAACA,KAAK,iBAAiBC,IAAI,CAACD;AACtC;AACA,SAASE,oBAAoBF,CAAS;IACpC,MAAMG,IAAIH,EAAEI,KAAK,CAAC;IAClB,IAAI,CAACD,GAAG,OAAO;IACf,MAAM,GAAGE,KAAKC,KAAK,GAAGH;IACtB,IAAI,CAACG,MAAM,OAAO;IAClB,OAAOD,QAAQ,QAAQE,OAAOC,IAAI,CAACF,MAAM,OAAOG,MAAM,GAAGF,OAAOC,IAAI,CAACF,MAAM,UAAUG,MAAM;AAC7F;AAEO,SAASf;IACd,IAAIC,SAAS;QACX,IAAI,CAACE,QAAQD,GAAG,CAACc,kBAAkB,EAAE;YACnC,MAAM,IAAIC,MAAM;QAClB;QACA;IACF;IAEA,IAAId,QAAQD,GAAG,CAACc,kBAAkB,EAAE;QAClC,MAAM,IAAIC,MAAM;IAClB;IACA,MAAMC,MAAMf,QAAQD,GAAG,CAACiB,sBAAsB;IAC9C,IAAI,CAACd,WAAWa,MAAM,MAAM,IAAID,MAAM;IACtC,IAAIT,oBAAoBU,OAAQ,IAAI,MAAM,IAAID,MAAM;IAEpD,MAAMG,OAAOjB,QAAQD,GAAG,CAACmB,uBAAuB;IAChD,IAAID,MAAM;QACR,IAAI,CAACf,WAAWe,OAAO,MAAM,IAAIH,MAAM;QACvC,IAAIT,oBAAoBY,QAAQ,IAAI,MAAM,IAAIH,MAAM;IACtD;AACF"}
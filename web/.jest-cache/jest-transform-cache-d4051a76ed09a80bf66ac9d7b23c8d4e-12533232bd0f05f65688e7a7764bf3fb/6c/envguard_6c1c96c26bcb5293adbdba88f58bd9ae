734070e3a9af6517b434d248d68a7f17
// Run once at server start (import from your route/util entry point)
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "assertPepperConfig", {
    enumerable: true,
    get: function() {
        return assertPepperConfig;
    }
});
function isDev() {
    const env = process.env.NODE_ENV;
    return env === 'development' || env === 'test';
}
function isPrefixed(v) {
    return !!v && /^(base64|hex):/.test(v);
}
function byteLenFromPrefixed(v) {
    const m = v.match(/^(base64|hex):(.*)$/);
    if (!m) return 0;
    const [, enc, body] = m;
    if (!body) return 0;
    return enc === 'hex' ? Buffer.from(body, 'hex').length : Buffer.from(body, 'base64').length;
}
function assertPepperConfig() {
    if (isDev()) {
        if (!process.env.PRIVACY_PEPPER_DEV) {
            throw new Error('PRIVACY_PEPPER_DEV required in dev/test');
        }
        return;
    }
    if (process.env.PRIVACY_PEPPER_DEV) {
        throw new Error('PRIVACY_PEPPER_DEV must NOT be set in preview/prod');
    }
    const cur = process.env.PRIVACY_PEPPER_CURRENT;
    if (!isPrefixed(cur)) throw new Error('PRIVACY_PEPPER_CURRENT must be base64:/hex: prefixed');
    if (byteLenFromPrefixed(cur) < 32) throw new Error('PRIVACY_PEPPER_CURRENT must be ≥32 bytes');
    const prev = process.env.PRIVACY_PEPPER_PREVIOUS;
    if (prev) {
        if (!isPrefixed(prev)) throw new Error('PRIVACY_PEPPER_PREVIOUS must be base64:/hex: prefixed');
        if (byteLenFromPrefixed(prev) < 32) throw new Error('PRIVACY_PEPPER_PREVIOUS must be ≥32 bytes');
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9mZWF0dXJlcy9jaXZpY3MvbGliL2Npdmljcy9lbnYtZ3VhcmQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gUnVuIG9uY2UgYXQgc2VydmVyIHN0YXJ0IChpbXBvcnQgZnJvbSB5b3VyIHJvdXRlL3V0aWwgZW50cnkgcG9pbnQpXG5mdW5jdGlvbiBpc0RldigpIHtcbiAgY29uc3QgZW52ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG4gIHJldHVybiBlbnYgPT09ICdkZXZlbG9wbWVudCcgfHwgZW52ID09PSAndGVzdCc7XG59XG5cbmZ1bmN0aW9uIGlzUHJlZml4ZWQodj86IHN0cmluZykge1xuICByZXR1cm4gISF2ICYmIC9eKGJhc2U2NHxoZXgpOi8udGVzdCh2KTtcbn1cbmZ1bmN0aW9uIGJ5dGVMZW5Gcm9tUHJlZml4ZWQodjogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgbSA9IHYubWF0Y2goL14oYmFzZTY0fGhleCk6KC4qKSQvKTtcbiAgaWYgKCFtKSByZXR1cm4gMDtcbiAgY29uc3QgWywgZW5jLCBib2R5XSA9IG07XG4gIGlmICghYm9keSkgcmV0dXJuIDA7XG4gIHJldHVybiBlbmMgPT09ICdoZXgnID8gQnVmZmVyLmZyb20oYm9keSwgJ2hleCcpLmxlbmd0aCA6IEJ1ZmZlci5mcm9tKGJvZHksICdiYXNlNjQnKS5sZW5ndGg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRQZXBwZXJDb25maWcoKSB7XG4gIGlmIChpc0RldigpKSB7XG4gICAgaWYgKCFwcm9jZXNzLmVudi5QUklWQUNZX1BFUFBFUl9ERVYpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUFJJVkFDWV9QRVBQRVJfREVWIHJlcXVpcmVkIGluIGRldi90ZXN0Jyk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChwcm9jZXNzLmVudi5QUklWQUNZX1BFUFBFUl9ERVYpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BSSVZBQ1lfUEVQUEVSX0RFViBtdXN0IE5PVCBiZSBzZXQgaW4gcHJldmlldy9wcm9kJyk7XG4gIH1cbiAgY29uc3QgY3VyID0gcHJvY2Vzcy5lbnYuUFJJVkFDWV9QRVBQRVJfQ1VSUkVOVDtcbiAgaWYgKCFpc1ByZWZpeGVkKGN1cikpIHRocm93IG5ldyBFcnJvcignUFJJVkFDWV9QRVBQRVJfQ1VSUkVOVCBtdXN0IGJlIGJhc2U2NDovaGV4OiBwcmVmaXhlZCcpO1xuICBpZiAoYnl0ZUxlbkZyb21QcmVmaXhlZChjdXIhKSA8IDMyKSB0aHJvdyBuZXcgRXJyb3IoJ1BSSVZBQ1lfUEVQUEVSX0NVUlJFTlQgbXVzdCBiZSDiiaUzMiBieXRlcycpO1xuXG4gIGNvbnN0IHByZXYgPSBwcm9jZXNzLmVudi5QUklWQUNZX1BFUFBFUl9QUkVWSU9VUztcbiAgaWYgKHByZXYpIHtcbiAgICBpZiAoIWlzUHJlZml4ZWQocHJldikpIHRocm93IG5ldyBFcnJvcignUFJJVkFDWV9QRVBQRVJfUFJFVklPVVMgbXVzdCBiZSBiYXNlNjQ6L2hleDogcHJlZml4ZWQnKTtcbiAgICBpZiAoYnl0ZUxlbkZyb21QcmVmaXhlZChwcmV2KSA8IDMyKSB0aHJvdyBuZXcgRXJyb3IoJ1BSSVZBQ1lfUEVQUEVSX1BSRVZJT1VTIG11c3QgYmUg4omlMzIgYnl0ZXMnKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImFzc2VydFBlcHBlckNvbmZpZyIsImlzRGV2IiwiZW52IiwicHJvY2VzcyIsIk5PREVfRU5WIiwiaXNQcmVmaXhlZCIsInYiLCJ0ZXN0IiwiYnl0ZUxlbkZyb21QcmVmaXhlZCIsIm0iLCJtYXRjaCIsImVuYyIsImJvZHkiLCJCdWZmZXIiLCJmcm9tIiwibGVuZ3RoIiwiUFJJVkFDWV9QRVBQRVJfREVWIiwiRXJyb3IiLCJjdXIiLCJQUklWQUNZX1BFUFBFUl9DVVJSRU5UIiwicHJldiIsIlBSSVZBQ1lfUEVQUEVSX1BSRVZJT1VTIl0sIm1hcHBpbmdzIjoiQUFBQSxxRUFBcUU7Ozs7OytCQWlCckRBOzs7ZUFBQUE7OztBQWhCaEIsU0FBU0M7SUFDUCxNQUFNQyxNQUFNQyxRQUFRRCxHQUFHLENBQUNFLFFBQVE7SUFDaEMsT0FBT0YsUUFBUSxpQkFBaUJBLFFBQVE7QUFDMUM7QUFFQSxTQUFTRyxXQUFXQyxDQUFVO0lBQzVCLE9BQU8sQ0FBQyxDQUFDQSxLQUFLLGlCQUFpQkMsSUFBSSxDQUFDRDtBQUN0QztBQUNBLFNBQVNFLG9CQUFvQkYsQ0FBUztJQUNwQyxNQUFNRyxJQUFJSCxFQUFFSSxLQUFLLENBQUM7SUFDbEIsSUFBSSxDQUFDRCxHQUFHLE9BQU87SUFDZixNQUFNLEdBQUdFLEtBQUtDLEtBQUssR0FBR0g7SUFDdEIsSUFBSSxDQUFDRyxNQUFNLE9BQU87SUFDbEIsT0FBT0QsUUFBUSxRQUFRRSxPQUFPQyxJQUFJLENBQUNGLE1BQU0sT0FBT0csTUFBTSxHQUFHRixPQUFPQyxJQUFJLENBQUNGLE1BQU0sVUFBVUcsTUFBTTtBQUM3RjtBQUVPLFNBQVNmO0lBQ2QsSUFBSUMsU0FBUztRQUNYLElBQUksQ0FBQ0UsUUFBUUQsR0FBRyxDQUFDYyxrQkFBa0IsRUFBRTtZQUNuQyxNQUFNLElBQUlDLE1BQU07UUFDbEI7UUFDQTtJQUNGO0lBRUEsSUFBSWQsUUFBUUQsR0FBRyxDQUFDYyxrQkFBa0IsRUFBRTtRQUNsQyxNQUFNLElBQUlDLE1BQU07SUFDbEI7SUFDQSxNQUFNQyxNQUFNZixRQUFRRCxHQUFHLENBQUNpQixzQkFBc0I7SUFDOUMsSUFBSSxDQUFDZCxXQUFXYSxNQUFNLE1BQU0sSUFBSUQsTUFBTTtJQUN0QyxJQUFJVCxvQkFBb0JVLE9BQVEsSUFBSSxNQUFNLElBQUlELE1BQU07SUFFcEQsTUFBTUcsT0FBT2pCLFFBQVFELEdBQUcsQ0FBQ21CLHVCQUF1QjtJQUNoRCxJQUFJRCxNQUFNO1FBQ1IsSUFBSSxDQUFDZixXQUFXZSxPQUFPLE1BQU0sSUFBSUgsTUFBTTtRQUN2QyxJQUFJVCxvQkFBb0JZLFFBQVEsSUFBSSxNQUFNLElBQUlILE1BQU07SUFDdEQ7QUFDRiJ9
173d3fbf225d261daf0093bfa61522f3
/**
 * Enhanced Rate Limiting System
 * Production-ready rate limiting with IP reputation, device fingerprinting, and adaptive limits
 * 
 * Features:
 * - IP-based rate limiting with reputation scoring
 * - Device fingerprinting for additional protection
 * - Adaptive rate limits based on risk signals
 * - Multiple storage backends (memory, Redis)
 * - Comprehensive analytics and monitoring
 * 
 * @author Choices Platform
 * @version 2.0.0
 * @since 2024-12-27
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get EnhancedRateLimiter () {
        return EnhancedRateLimiter;
    },
    get RedisRateLimiter () {
        return RedisRateLimiter;
    },
    get createRateLimiter () {
        return createRateLimiter;
    },
    get rateLimitMiddleware () {
        return rateLimitMiddleware;
    },
    get rateLimiters () {
        return rateLimiters;
    }
});
const _logger = require("../../utils/logger");
// Token bucket for rate limiting
class TokenBucket {
    constructor(capacity, refillRate){
        this.capacity = capacity;
        this.refillRate = refillRate;
        this.tokens = capacity;
        this.lastRefill = Date.now();
    }
    tryConsume(tokens = 1) {
        this.refill();
        if (this.tokens >= tokens) {
            this.tokens -= tokens;
            return true;
        }
        return false;
    }
    refill() {
        const now = Date.now();
        const timePassed = now - this.lastRefill;
        const tokensToAdd = timePassed * this.refillRate / 1000;
        this.tokens = Math.min(this.capacity, this.tokens + tokensToAdd);
        this.lastRefill = now;
    }
    getRemaining() {
        this.refill();
        return Math.floor(this.tokens);
    }
    getResetTime() {
        const tokensNeeded = this.capacity - this.tokens;
        const timeNeeded = tokensNeeded / this.refillRate * 1000;
        return new Date(Date.now() + timeNeeded);
    }
}
class EnhancedRateLimiter {
    constructor(config){
        this.buckets = new Map();
        this.reputation = new Map();
        this.deviceFingerprints = new Map();
        this.config = Object.assign({}, {
            maxBurst: 5,
            reputationThreshold: 50,
            deviceFingerprintWeight: 0.3
        }, config);
    }
    // Get client IP address
    getClientIP(req) {
        // Check for forwarded headers (common in proxy setups)
        const forwarded = req.headers.get('x-forwarded-for');
        if (forwarded) {
            const firstIP = forwarded.split(',')[0];
            if (firstIP) {
                return firstIP.trim();
            }
        }
        const realIP = req.headers.get('x-real-ip');
        if (realIP) {
            return realIP;
        }
        // Fallback to connection remote address (if available)
        return 'unknown';
    }
    // Generate device fingerprint from request
    generateDeviceFingerprint(req) {
        const userAgent = req.headers.get('user-agent') || '';
        const acceptLanguage = req.headers.get('accept-language') || '';
        // Extract basic fingerprint data
        const fingerprint = {
            userAgent,
            screenResolution: `${req.headers.get('sec-ch-viewport-width')}x${req.headers.get('sec-ch-viewport-height')}` || 'unknown',
            timezone: req.headers.get('sec-ch-prefers-color-scheme') || 'unknown',
            language: acceptLanguage.split(',')[0] || 'unknown',
            platform: this.extractPlatform(userAgent),
            cookieEnabled: req.headers.get('cookie') !== null,
            doNotTrack: req.headers.get('dnt') === '1',
            hash: ''
        };
        // Generate hash from fingerprint data
        fingerprint.hash = this.hashFingerprint(fingerprint);
        return fingerprint;
    }
    // Extract platform from user agent
    extractPlatform(userAgent) {
        if (userAgent.includes('iPhone') || userAgent.includes('iPad')) {
            return 'ios';
        } else if (userAgent.includes('Android')) {
            return 'android';
        } else if (userAgent.includes('Windows')) {
            return 'windows';
        } else if (userAgent.includes('Mac')) {
            return 'macos';
        } else if (userAgent.includes('Linux')) {
            return 'linux';
        }
        return 'unknown';
    }
    // Hash device fingerprint
    hashFingerprint(fingerprint) {
        const data = `${fingerprint.userAgent}|${fingerprint.screenResolution}|${fingerprint.timezone}|${fingerprint.language}|${fingerprint.platform}|${fingerprint.cookieEnabled}|${fingerprint.doNotTrack}`;
        // Simple hash function (in production, use crypto.createHash)
        let hash = 0;
        for(let i = 0; i < data.length; i++){
            const char = data.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash).toString(36);
    }
    // Assess risk based on IP and device fingerprint
    assessRisk(ip, deviceFingerprint) {
        const factors = [];
        let riskScore = 0;
        // Check IP reputation
        const reputation = this.reputation.get(ip);
        if (reputation) {
            if (reputation.blacklisted) {
                riskScore = 100;
                factors.push('IP blacklisted');
            } else if (reputation.whitelisted) {
                riskScore = 0;
                factors.push('IP whitelisted');
            } else {
                riskScore += (100 - reputation.score) * 0.4; // IP reputation weight
                if (reputation.suspiciousActivity) {
                    factors.push('Suspicious IP activity');
                    riskScore += 20;
                }
                if (reputation.violations > 0) {
                    factors.push(`IP violations: ${reputation.violations}`);
                    riskScore += reputation.violations * 10;
                }
            }
        } else {
            // New IP - moderate risk
            riskScore += 30;
            factors.push('New IP address');
        }
        // Check device fingerprint
        const existingFingerprint = this.deviceFingerprints.get(deviceFingerprint.hash);
        if (existingFingerprint) {
            // Known device - lower risk
            riskScore -= 20;
            factors.push('Known device');
        } else {
            // New device - higher risk
            riskScore += 25;
            factors.push('New device fingerprint');
        }
        // Check for suspicious patterns
        if (deviceFingerprint.userAgent.includes('bot') || deviceFingerprint.userAgent.includes('crawler')) {
            riskScore += 40;
            factors.push('Bot-like user agent');
        }
        if (!deviceFingerprint.cookieEnabled) {
            riskScore += 15;
            factors.push('Cookies disabled');
        }
        // Normalize risk score
        riskScore = Math.max(0, Math.min(100, riskScore));
        // Determine recommended action
        let recommendedAction = 'allow';
        if (riskScore >= 80) {
            recommendedAction = 'block';
        } else if (riskScore >= 50) {
            recommendedAction = 'challenge';
        }
        // Calculate rate limit multiplier
        const rateLimitMultiplier = 1 + riskScore / 100 * 2 // 1x to 3x multiplier
        ;
        return {
            riskScore,
            factors,
            recommendedAction,
            rateLimitMultiplier
        };
    }
    // Update IP reputation
    updateReputation(ip, success, riskAssessment) {
        let reputation = this.reputation.get(ip);
        if (!reputation) {
            reputation = {
                ip,
                score: 50,
                requestCount: 0,
                lastRequest: new Date(),
                violations: 0,
                suspiciousActivity: false,
                whitelisted: false,
                blacklisted: false
            };
        }
        // Update request count and last request
        reputation.requestCount++;
        reputation.lastRequest = new Date();
        // Update score based on success/failure
        if (success) {
            reputation.score = Math.min(100, reputation.score + 1);
        } else {
            reputation.score = Math.max(0, reputation.score - 5);
            reputation.violations++;
        }
        // Update suspicious activity flag
        if (riskAssessment.riskScore > 70) {
            reputation.suspiciousActivity = true;
        }
        // Auto-blacklist if too many violations
        if (reputation.violations >= 10) {
            reputation.blacklisted = true;
            reputation.score = 0;
        }
        // Auto-whitelist if very good behavior
        if (reputation.requestCount > 100 && reputation.score > 90 && reputation.violations === 0) {
            reputation.whitelisted = true;
        }
        this.reputation.set(ip, reputation);
    }
    // Check rate limit with enhanced features
    async check(req, identifier) {
        const ip = this.getClientIP(req);
        const deviceFingerprint = this.generateDeviceFingerprint(req);
        const key = identifier || ip;
        // Assess risk
        const riskAssessment = this.assessRisk(ip, deviceFingerprint);
        // Get or create token bucket
        let bucket = this.buckets.get(key);
        if (!bucket) {
            const adjustedLimit = Math.floor(this.config.uniqueTokenPerInterval / riskAssessment.rateLimitMultiplier);
            const refillRate = adjustedLimit / (this.config.interval / 1000);
            bucket = new TokenBucket(adjustedLimit, refillRate);
            this.buckets.set(key, bucket);
        }
        // Try to consume token
        const allowed = bucket.tryConsume();
        const remaining = bucket.getRemaining();
        const resetTime = bucket.getResetTime();
        // Update reputation
        this.updateReputation(ip, allowed, riskAssessment);
        // Store device fingerprint
        this.deviceFingerprints.set(deviceFingerprint.hash, deviceFingerprint);
        // Log for analytics
        (0, _logger.devLog)('Rate limit check:', {
            ip,
            key,
            allowed,
            remaining,
            riskScore: riskAssessment.riskScore,
            factors: riskAssessment.factors,
            action: riskAssessment.recommendedAction
        });
        return {
            success: true,
            allowed,
            remaining,
            resetTime,
            retryAfter: allowed ? null : Math.ceil((resetTime.getTime() - Date.now()) / 1000),
            riskAssessment,
            reputation: this.reputation.get(ip) || null
        };
    }
    // Get reputation for an IP
    getReputation(ip) {
        return this.reputation.get(ip) || null;
    }
    // Manually update reputation
    updateReputationManually(ip, updates) {
        const reputation = this.reputation.get(ip);
        if (reputation) {
            Object.assign(reputation, updates);
            this.reputation.set(ip, reputation);
        }
    }
    // Cleanup old data
    cleanup() {
        const now = Date.now();
        const maxAge = 24 * 60 * 60 * 1000 // 24 hours
        ;
        // Cleanup old buckets
        for (const [key, bucket] of Array.from(this.buckets.entries())){
            if (now - bucket.getResetTime().getTime() > maxAge) {
                this.buckets.delete(key);
            }
        }
        // Cleanup old reputation data
        for (const [ip, reputation] of Array.from(this.reputation.entries())){
            if (now - reputation.lastRequest.getTime() > maxAge * 7) {
                this.reputation.delete(ip);
            }
        }
    // Cleanup old device fingerprints
    // Note: In production, you might want to keep these longer for analytics
    }
    // Get statistics
    getStats() {
        return {
            buckets: this.buckets.size,
            reputation: this.reputation.size,
            deviceFingerprints: this.deviceFingerprints.size
        };
    }
}
class RedisRateLimiter {
}
function createRateLimiter(config) {
    // In production, check environment and return Redis-based limiter if available
    return new EnhancedRateLimiter(config);
}
const rateLimiters = {
    auth: createRateLimiter({
        interval: 15 * 60 * 1000,
        uniqueTokenPerInterval: 10,
        maxBurst: 3
    }),
    registration: createRateLimiter({
        interval: 60 * 60 * 1000,
        uniqueTokenPerInterval: 5,
        maxBurst: 1
    }),
    deviceFlow: createRateLimiter({
        interval: 5 * 60 * 1000,
        uniqueTokenPerInterval: 20,
        maxBurst: 5
    }),
    biometric: createRateLimiter({
        interval: 5 * 60 * 1000,
        uniqueTokenPerInterval: 30,
        maxBurst: 10
    })
};
async function rateLimitMiddleware(req, limiter = rateLimiters.auth) {
    return await limiter.check(req);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvY29yZS9zZWN1cml0eS9yYXRlLWxpbWl0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW5oYW5jZWQgUmF0ZSBMaW1pdGluZyBTeXN0ZW1cbiAqIFByb2R1Y3Rpb24tcmVhZHkgcmF0ZSBsaW1pdGluZyB3aXRoIElQIHJlcHV0YXRpb24sIGRldmljZSBmaW5nZXJwcmludGluZywgYW5kIGFkYXB0aXZlIGxpbWl0c1xuICogXG4gKiBGZWF0dXJlczpcbiAqIC0gSVAtYmFzZWQgcmF0ZSBsaW1pdGluZyB3aXRoIHJlcHV0YXRpb24gc2NvcmluZ1xuICogLSBEZXZpY2UgZmluZ2VycHJpbnRpbmcgZm9yIGFkZGl0aW9uYWwgcHJvdGVjdGlvblxuICogLSBBZGFwdGl2ZSByYXRlIGxpbWl0cyBiYXNlZCBvbiByaXNrIHNpZ25hbHNcbiAqIC0gTXVsdGlwbGUgc3RvcmFnZSBiYWNrZW5kcyAobWVtb3J5LCBSZWRpcylcbiAqIC0gQ29tcHJlaGVuc2l2ZSBhbmFseXRpY3MgYW5kIG1vbml0b3JpbmdcbiAqIFxuICogQGF1dGhvciBDaG9pY2VzIFBsYXRmb3JtXG4gKiBAdmVyc2lvbiAyLjAuMFxuICogQHNpbmNlIDIwMjQtMTItMjdcbiAqL1xuXG5pbXBvcnQgeyBkZXZMb2cgfSBmcm9tICdAL2xpYi91dGlscy9sb2dnZXInXG5cbi8vIFJhdGUgbGltaXQgY29uZmlndXJhdGlvblxuZXhwb3J0IGludGVyZmFjZSBSYXRlTGltaXRDb25maWcge1xuICBpbnRlcnZhbDogbnVtYmVyIC8vIFRpbWUgd2luZG93IGluIG1pbGxpc2Vjb25kc1xuICB1bmlxdWVUb2tlblBlckludGVydmFsOiBudW1iZXIgLy8gTWF4IHJlcXVlc3RzIHBlciBpbnRlcnZhbFxuICBtYXhCdXJzdD86IG51bWJlciAvLyBNYXhpbXVtIGJ1cnN0IGFsbG93YW5jZVxuICByZXB1dGF0aW9uVGhyZXNob2xkPzogbnVtYmVyIC8vIFJlcHV0YXRpb24gc2NvcmUgdGhyZXNob2xkIGZvciBzdHJpY3RlciBsaW1pdHNcbiAgZGV2aWNlRmluZ2VycHJpbnRXZWlnaHQ/OiBudW1iZXIgLy8gV2VpZ2h0IGZvciBkZXZpY2UgZmluZ2VycHJpbnQgaW4gcmlzayBjYWxjdWxhdGlvblxufVxuXG4vLyBJUCByZXB1dGF0aW9uIGRhdGFcbmV4cG9ydCBpbnRlcmZhY2UgSVBSZXB1dGF0aW9uIHtcbiAgaXA6IHN0cmluZ1xuICBzY29yZTogbnVtYmVyIC8vIDAtMTAwLCBoaWdoZXIgPSBtb3JlIHRydXN0ZWRcbiAgcmVxdWVzdENvdW50OiBudW1iZXJcbiAgbGFzdFJlcXVlc3Q6IERhdGVcbiAgdmlvbGF0aW9uczogbnVtYmVyXG4gIHN1c3BpY2lvdXNBY3Rpdml0eTogYm9vbGVhblxuICB3aGl0ZWxpc3RlZDogYm9vbGVhblxuICBibGFja2xpc3RlZDogYm9vbGVhblxufVxuXG4vLyBEZXZpY2UgZmluZ2VycHJpbnQgZGF0YVxuZXhwb3J0IGludGVyZmFjZSBEZXZpY2VGaW5nZXJwcmludCB7XG4gIHVzZXJBZ2VudDogc3RyaW5nXG4gIHNjcmVlblJlc29sdXRpb246IHN0cmluZ1xuICB0aW1lem9uZTogc3RyaW5nXG4gIGxhbmd1YWdlOiBzdHJpbmdcbiAgcGxhdGZvcm06IHN0cmluZ1xuICBjb29raWVFbmFibGVkOiBib29sZWFuXG4gIGRvTm90VHJhY2s6IGJvb2xlYW5cbiAgaGFzaDogc3RyaW5nIC8vIENvbXB1dGVkIGZpbmdlcnByaW50IGhhc2hcbn1cblxuLy8gUmlzayBhc3Nlc3NtZW50IHJlc3VsdFxuZXhwb3J0IGludGVyZmFjZSBSaXNrQXNzZXNzbWVudCB7XG4gIHJpc2tTY29yZTogbnVtYmVyIC8vIDAtMTAwLCBoaWdoZXIgPSBoaWdoZXIgcmlza1xuICBmYWN0b3JzOiBzdHJpbmdbXVxuICByZWNvbW1lbmRlZEFjdGlvbjogJ2FsbG93JyB8ICdjaGFsbGVuZ2UnIHwgJ2Jsb2NrJ1xuICByYXRlTGltaXRNdWx0aXBsaWVyOiBudW1iZXIgLy8gTXVsdGlwbGllciBmb3IgcmF0ZSBsaW1pdCAoaGlnaGVyID0gc3RyaWN0ZXIpXG59XG5cbi8vIFJhdGUgbGltaXQgcmVzdWx0XG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdFJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgYWxsb3dlZDogYm9vbGVhblxuICByZW1haW5pbmc6IG51bWJlclxuICByZXNldFRpbWU6IERhdGVcbiAgcmV0cnlBZnRlcj86IG51bWJlciB8IG51bGxcbiAgcmlza0Fzc2Vzc21lbnQ/OiBSaXNrQXNzZXNzbWVudFxuICByZXB1dGF0aW9uPzogSVBSZXB1dGF0aW9uIHwgbnVsbFxufVxuXG4vLyBUb2tlbiBidWNrZXQgZm9yIHJhdGUgbGltaXRpbmdcbmNsYXNzIFRva2VuQnVja2V0IHtcbiAgcHJpdmF0ZSB0b2tlbnM6IG51bWJlclxuICBwcml2YXRlIGxhc3RSZWZpbGw6IG51bWJlclxuICBwcml2YXRlIHJlYWRvbmx5IGNhcGFjaXR5OiBudW1iZXJcbiAgcHJpdmF0ZSByZWFkb25seSByZWZpbGxSYXRlOiBudW1iZXJcblxuICBjb25zdHJ1Y3RvcihjYXBhY2l0eTogbnVtYmVyLCByZWZpbGxSYXRlOiBudW1iZXIpIHtcbiAgICB0aGlzLmNhcGFjaXR5ID0gY2FwYWNpdHlcbiAgICB0aGlzLnJlZmlsbFJhdGUgPSByZWZpbGxSYXRlXG4gICAgdGhpcy50b2tlbnMgPSBjYXBhY2l0eVxuICAgIHRoaXMubGFzdFJlZmlsbCA9IERhdGUubm93KClcbiAgfVxuXG4gIHRyeUNvbnN1bWUodG9rZW5zID0gMSk6IGJvb2xlYW4ge1xuICAgIHRoaXMucmVmaWxsKClcbiAgICBcbiAgICBpZiAodGhpcy50b2tlbnMgPj0gdG9rZW5zKSB7XG4gICAgICB0aGlzLnRva2VucyAtPSB0b2tlbnNcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcHJpdmF0ZSByZWZpbGwoKTogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICAgIGNvbnN0IHRpbWVQYXNzZWQgPSBub3cgLSB0aGlzLmxhc3RSZWZpbGxcbiAgICBjb25zdCB0b2tlbnNUb0FkZCA9ICh0aW1lUGFzc2VkICogdGhpcy5yZWZpbGxSYXRlKSAvIDEwMDBcbiAgICBcbiAgICB0aGlzLnRva2VucyA9IE1hdGgubWluKHRoaXMuY2FwYWNpdHksIHRoaXMudG9rZW5zICsgdG9rZW5zVG9BZGQpXG4gICAgdGhpcy5sYXN0UmVmaWxsID0gbm93XG4gIH1cblxuICBnZXRSZW1haW5pbmcoKTogbnVtYmVyIHtcbiAgICB0aGlzLnJlZmlsbCgpXG4gICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy50b2tlbnMpXG4gIH1cblxuICBnZXRSZXNldFRpbWUoKTogRGF0ZSB7XG4gICAgY29uc3QgdG9rZW5zTmVlZGVkID0gdGhpcy5jYXBhY2l0eSAtIHRoaXMudG9rZW5zXG4gICAgY29uc3QgdGltZU5lZWRlZCA9ICh0b2tlbnNOZWVkZWQgLyB0aGlzLnJlZmlsbFJhdGUpICogMTAwMFxuICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLm5vdygpICsgdGltZU5lZWRlZClcbiAgfVxufVxuXG4vLyBFbmhhbmNlZCBSYXRlIExpbWl0ZXIgd2l0aCByZXB1dGF0aW9uIGFuZCBkZXZpY2UgZmluZ2VycHJpbnRpbmdcbmV4cG9ydCBjbGFzcyBFbmhhbmNlZFJhdGVMaW1pdGVyIHtcbiAgcHJpdmF0ZSBidWNrZXRzOiBNYXA8c3RyaW5nLCBUb2tlbkJ1Y2tldD4gPSBuZXcgTWFwKClcbiAgcHJpdmF0ZSByZXB1dGF0aW9uOiBNYXA8c3RyaW5nLCBJUFJlcHV0YXRpb24+ID0gbmV3IE1hcCgpXG4gIHByaXZhdGUgZGV2aWNlRmluZ2VycHJpbnRzOiBNYXA8c3RyaW5nLCBEZXZpY2VGaW5nZXJwcmludD4gPSBuZXcgTWFwKClcbiAgcHJpdmF0ZSBjb25maWc6IFJhdGVMaW1pdENvbmZpZ1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUmF0ZUxpbWl0Q29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCB7XG4gICAgICBtYXhCdXJzdDogNSxcbiAgICAgIHJlcHV0YXRpb25UaHJlc2hvbGQ6IDUwLFxuICAgICAgZGV2aWNlRmluZ2VycHJpbnRXZWlnaHQ6IDAuMyxcbiAgICB9LCBjb25maWcpXG4gIH1cblxuICAvLyBHZXQgY2xpZW50IElQIGFkZHJlc3NcbiAgcHJpdmF0ZSBnZXRDbGllbnRJUChyZXE6IFJlcXVlc3QpOiBzdHJpbmcge1xuICAgIC8vIENoZWNrIGZvciBmb3J3YXJkZWQgaGVhZGVycyAoY29tbW9uIGluIHByb3h5IHNldHVwcylcbiAgICBjb25zdCBmb3J3YXJkZWQgPSByZXEuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpXG4gICAgaWYgKGZvcndhcmRlZCkge1xuICAgICAgY29uc3QgZmlyc3RJUCA9IGZvcndhcmRlZC5zcGxpdCgnLCcpWzBdXG4gICAgICBpZiAoZmlyc3RJUCkge1xuICAgICAgICByZXR1cm4gZmlyc3RJUC50cmltKClcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZWFsSVAgPSByZXEuaGVhZGVycy5nZXQoJ3gtcmVhbC1pcCcpXG4gICAgaWYgKHJlYWxJUCkge1xuICAgICAgcmV0dXJuIHJlYWxJUFxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHRvIGNvbm5lY3Rpb24gcmVtb3RlIGFkZHJlc3MgKGlmIGF2YWlsYWJsZSlcbiAgICByZXR1cm4gJ3Vua25vd24nXG4gIH1cblxuICAvLyBHZW5lcmF0ZSBkZXZpY2UgZmluZ2VycHJpbnQgZnJvbSByZXF1ZXN0XG4gIHByaXZhdGUgZ2VuZXJhdGVEZXZpY2VGaW5nZXJwcmludChyZXE6IFJlcXVlc3QpOiBEZXZpY2VGaW5nZXJwcmludCB7XG4gICAgY29uc3QgdXNlckFnZW50ID0gcmVxLmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgJydcbiAgICBjb25zdCBhY2NlcHRMYW5ndWFnZSA9IHJlcS5oZWFkZXJzLmdldCgnYWNjZXB0LWxhbmd1YWdlJykgfHwgJydcbiAgICBcbiAgICAvLyBFeHRyYWN0IGJhc2ljIGZpbmdlcnByaW50IGRhdGFcbiAgICBjb25zdCBmaW5nZXJwcmludDogRGV2aWNlRmluZ2VycHJpbnQgPSB7XG4gICAgICB1c2VyQWdlbnQsXG4gICAgICBzY3JlZW5SZXNvbHV0aW9uOiBgJHtyZXEuaGVhZGVycy5nZXQoJ3NlYy1jaC12aWV3cG9ydC13aWR0aCcpICB9eCR7ICByZXEuaGVhZGVycy5nZXQoJ3NlYy1jaC12aWV3cG9ydC1oZWlnaHQnKX1gIHx8ICd1bmtub3duJyxcbiAgICAgIHRpbWV6b25lOiByZXEuaGVhZGVycy5nZXQoJ3NlYy1jaC1wcmVmZXJzLWNvbG9yLXNjaGVtZScpIHx8ICd1bmtub3duJyxcbiAgICAgIGxhbmd1YWdlOiBhY2NlcHRMYW5ndWFnZS5zcGxpdCgnLCcpWzBdIHx8ICd1bmtub3duJyxcbiAgICAgIHBsYXRmb3JtOiB0aGlzLmV4dHJhY3RQbGF0Zm9ybSh1c2VyQWdlbnQpLFxuICAgICAgY29va2llRW5hYmxlZDogcmVxLmhlYWRlcnMuZ2V0KCdjb29raWUnKSAhPT0gbnVsbCxcbiAgICAgIGRvTm90VHJhY2s6IHJlcS5oZWFkZXJzLmdldCgnZG50JykgPT09ICcxJyxcbiAgICAgIGhhc2g6ICcnXG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgaGFzaCBmcm9tIGZpbmdlcnByaW50IGRhdGFcbiAgICBmaW5nZXJwcmludC5oYXNoID0gdGhpcy5oYXNoRmluZ2VycHJpbnQoZmluZ2VycHJpbnQpXG4gICAgXG4gICAgcmV0dXJuIGZpbmdlcnByaW50XG4gIH1cblxuICAvLyBFeHRyYWN0IHBsYXRmb3JtIGZyb20gdXNlciBhZ2VudFxuICBwcml2YXRlIGV4dHJhY3RQbGF0Zm9ybSh1c2VyQWdlbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKHVzZXJBZ2VudC5pbmNsdWRlcygnaVBob25lJykgfHwgdXNlckFnZW50LmluY2x1ZGVzKCdpUGFkJykpIHtcbiAgICAgIHJldHVybiAnaW9zJ1xuICAgIH0gZWxzZSBpZiAodXNlckFnZW50LmluY2x1ZGVzKCdBbmRyb2lkJykpIHtcbiAgICAgIHJldHVybiAnYW5kcm9pZCdcbiAgICB9IGVsc2UgaWYgKHVzZXJBZ2VudC5pbmNsdWRlcygnV2luZG93cycpKSB7XG4gICAgICByZXR1cm4gJ3dpbmRvd3MnXG4gICAgfSBlbHNlIGlmICh1c2VyQWdlbnQuaW5jbHVkZXMoJ01hYycpKSB7XG4gICAgICByZXR1cm4gJ21hY29zJ1xuICAgIH0gZWxzZSBpZiAodXNlckFnZW50LmluY2x1ZGVzKCdMaW51eCcpKSB7XG4gICAgICByZXR1cm4gJ2xpbnV4J1xuICAgIH1cbiAgICByZXR1cm4gJ3Vua25vd24nXG4gIH1cblxuICAvLyBIYXNoIGRldmljZSBmaW5nZXJwcmludFxuICBwcml2YXRlIGhhc2hGaW5nZXJwcmludChmaW5nZXJwcmludDogRGV2aWNlRmluZ2VycHJpbnQpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRhdGEgPSBgJHtmaW5nZXJwcmludC51c2VyQWdlbnR9fCR7ZmluZ2VycHJpbnQuc2NyZWVuUmVzb2x1dGlvbn18JHtmaW5nZXJwcmludC50aW1lem9uZX18JHtmaW5nZXJwcmludC5sYW5ndWFnZX18JHtmaW5nZXJwcmludC5wbGF0Zm9ybX18JHtmaW5nZXJwcmludC5jb29raWVFbmFibGVkfXwke2ZpbmdlcnByaW50LmRvTm90VHJhY2t9YFxuICAgIFxuICAgIC8vIFNpbXBsZSBoYXNoIGZ1bmN0aW9uIChpbiBwcm9kdWN0aW9uLCB1c2UgY3J5cHRvLmNyZWF0ZUhhc2gpXG4gICAgbGV0IGhhc2ggPSAwXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjaGFyID0gZGF0YS5jaGFyQ29kZUF0KGkpXG4gICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaGFyXG4gICAgICBoYXNoID0gaGFzaCAmIGhhc2ggLy8gQ29udmVydCB0byAzMi1iaXQgaW50ZWdlclxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gTWF0aC5hYnMoaGFzaCkudG9TdHJpbmcoMzYpXG4gIH1cblxuICAvLyBBc3Nlc3MgcmlzayBiYXNlZCBvbiBJUCBhbmQgZGV2aWNlIGZpbmdlcnByaW50XG4gIHByaXZhdGUgYXNzZXNzUmlzayhpcDogc3RyaW5nLCBkZXZpY2VGaW5nZXJwcmludDogRGV2aWNlRmluZ2VycHJpbnQpOiBSaXNrQXNzZXNzbWVudCB7XG4gICAgY29uc3QgZmFjdG9yczogc3RyaW5nW10gPSBbXVxuICAgIGxldCByaXNrU2NvcmUgPSAwXG5cbiAgICAvLyBDaGVjayBJUCByZXB1dGF0aW9uXG4gICAgY29uc3QgcmVwdXRhdGlvbiA9IHRoaXMucmVwdXRhdGlvbi5nZXQoaXApXG4gICAgaWYgKHJlcHV0YXRpb24pIHtcbiAgICAgIGlmIChyZXB1dGF0aW9uLmJsYWNrbGlzdGVkKSB7XG4gICAgICAgIHJpc2tTY29yZSA9IDEwMFxuICAgICAgICBmYWN0b3JzLnB1c2goJ0lQIGJsYWNrbGlzdGVkJylcbiAgICAgIH0gZWxzZSBpZiAocmVwdXRhdGlvbi53aGl0ZWxpc3RlZCkge1xuICAgICAgICByaXNrU2NvcmUgPSAwXG4gICAgICAgIGZhY3RvcnMucHVzaCgnSVAgd2hpdGVsaXN0ZWQnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmlza1Njb3JlICs9ICgxMDAgLSByZXB1dGF0aW9uLnNjb3JlKSAqIDAuNCAvLyBJUCByZXB1dGF0aW9uIHdlaWdodFxuICAgICAgICBpZiAocmVwdXRhdGlvbi5zdXNwaWNpb3VzQWN0aXZpdHkpIHtcbiAgICAgICAgICBmYWN0b3JzLnB1c2goJ1N1c3BpY2lvdXMgSVAgYWN0aXZpdHknKVxuICAgICAgICAgIHJpc2tTY29yZSArPSAyMFxuICAgICAgICB9XG4gICAgICAgIGlmIChyZXB1dGF0aW9uLnZpb2xhdGlvbnMgPiAwKSB7XG4gICAgICAgICAgZmFjdG9ycy5wdXNoKGBJUCB2aW9sYXRpb25zOiAke3JlcHV0YXRpb24udmlvbGF0aW9uc31gKVxuICAgICAgICAgIHJpc2tTY29yZSArPSByZXB1dGF0aW9uLnZpb2xhdGlvbnMgKiAxMFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5ldyBJUCAtIG1vZGVyYXRlIHJpc2tcbiAgICAgIHJpc2tTY29yZSArPSAzMFxuICAgICAgZmFjdG9ycy5wdXNoKCdOZXcgSVAgYWRkcmVzcycpXG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZGV2aWNlIGZpbmdlcnByaW50XG4gICAgY29uc3QgZXhpc3RpbmdGaW5nZXJwcmludCA9IHRoaXMuZGV2aWNlRmluZ2VycHJpbnRzLmdldChkZXZpY2VGaW5nZXJwcmludC5oYXNoKVxuICAgIGlmIChleGlzdGluZ0ZpbmdlcnByaW50KSB7XG4gICAgICAvLyBLbm93biBkZXZpY2UgLSBsb3dlciByaXNrXG4gICAgICByaXNrU2NvcmUgLT0gMjBcbiAgICAgIGZhY3RvcnMucHVzaCgnS25vd24gZGV2aWNlJylcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTmV3IGRldmljZSAtIGhpZ2hlciByaXNrXG4gICAgICByaXNrU2NvcmUgKz0gMjVcbiAgICAgIGZhY3RvcnMucHVzaCgnTmV3IGRldmljZSBmaW5nZXJwcmludCcpXG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIHN1c3BpY2lvdXMgcGF0dGVybnNcbiAgICBpZiAoZGV2aWNlRmluZ2VycHJpbnQudXNlckFnZW50LmluY2x1ZGVzKCdib3QnKSB8fCBkZXZpY2VGaW5nZXJwcmludC51c2VyQWdlbnQuaW5jbHVkZXMoJ2NyYXdsZXInKSkge1xuICAgICAgcmlza1Njb3JlICs9IDQwXG4gICAgICBmYWN0b3JzLnB1c2goJ0JvdC1saWtlIHVzZXIgYWdlbnQnKVxuICAgIH1cblxuICAgIGlmICghZGV2aWNlRmluZ2VycHJpbnQuY29va2llRW5hYmxlZCkge1xuICAgICAgcmlza1Njb3JlICs9IDE1XG4gICAgICBmYWN0b3JzLnB1c2goJ0Nvb2tpZXMgZGlzYWJsZWQnKVxuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6ZSByaXNrIHNjb3JlXG4gICAgcmlza1Njb3JlID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCByaXNrU2NvcmUpKVxuXG4gICAgLy8gRGV0ZXJtaW5lIHJlY29tbWVuZGVkIGFjdGlvblxuICAgIGxldCByZWNvbW1lbmRlZEFjdGlvbjogJ2FsbG93JyB8ICdjaGFsbGVuZ2UnIHwgJ2Jsb2NrJyA9ICdhbGxvdydcbiAgICBpZiAocmlza1Njb3JlID49IDgwKSB7XG4gICAgICByZWNvbW1lbmRlZEFjdGlvbiA9ICdibG9jaydcbiAgICB9IGVsc2UgaWYgKHJpc2tTY29yZSA+PSA1MCkge1xuICAgICAgcmVjb21tZW5kZWRBY3Rpb24gPSAnY2hhbGxlbmdlJ1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSByYXRlIGxpbWl0IG11bHRpcGxpZXJcbiAgICBjb25zdCByYXRlTGltaXRNdWx0aXBsaWVyID0gMSArIChyaXNrU2NvcmUgLyAxMDApICogMiAvLyAxeCB0byAzeCBtdWx0aXBsaWVyXG5cbiAgICByZXR1cm4ge1xuICAgICAgcmlza1Njb3JlLFxuICAgICAgZmFjdG9ycyxcbiAgICAgIHJlY29tbWVuZGVkQWN0aW9uLFxuICAgICAgcmF0ZUxpbWl0TXVsdGlwbGllclxuICAgIH1cbiAgfVxuXG4gIC8vIFVwZGF0ZSBJUCByZXB1dGF0aW9uXG4gIHByaXZhdGUgdXBkYXRlUmVwdXRhdGlvbihpcDogc3RyaW5nLCBzdWNjZXNzOiBib29sZWFuLCByaXNrQXNzZXNzbWVudDogUmlza0Fzc2Vzc21lbnQpOiB2b2lkIHtcbiAgICBsZXQgcmVwdXRhdGlvbiA9IHRoaXMucmVwdXRhdGlvbi5nZXQoaXApXG4gICAgXG4gICAgaWYgKCFyZXB1dGF0aW9uKSB7XG4gICAgICByZXB1dGF0aW9uID0ge1xuICAgICAgICBpcCxcbiAgICAgICAgc2NvcmU6IDUwLCAvLyBOZXV0cmFsIHN0YXJ0aW5nIHNjb3JlXG4gICAgICAgIHJlcXVlc3RDb3VudDogMCxcbiAgICAgICAgbGFzdFJlcXVlc3Q6IG5ldyBEYXRlKCksXG4gICAgICAgIHZpb2xhdGlvbnM6IDAsXG4gICAgICAgIHN1c3BpY2lvdXNBY3Rpdml0eTogZmFsc2UsXG4gICAgICAgIHdoaXRlbGlzdGVkOiBmYWxzZSxcbiAgICAgICAgYmxhY2tsaXN0ZWQ6IGZhbHNlXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHJlcXVlc3QgY291bnQgYW5kIGxhc3QgcmVxdWVzdFxuICAgIHJlcHV0YXRpb24ucmVxdWVzdENvdW50KytcbiAgICByZXB1dGF0aW9uLmxhc3RSZXF1ZXN0ID0gbmV3IERhdGUoKVxuXG4gICAgLy8gVXBkYXRlIHNjb3JlIGJhc2VkIG9uIHN1Y2Nlc3MvZmFpbHVyZVxuICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICByZXB1dGF0aW9uLnNjb3JlID0gTWF0aC5taW4oMTAwLCByZXB1dGF0aW9uLnNjb3JlICsgMSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmVwdXRhdGlvbi5zY29yZSA9IE1hdGgubWF4KDAsIHJlcHV0YXRpb24uc2NvcmUgLSA1KVxuICAgICAgcmVwdXRhdGlvbi52aW9sYXRpb25zKytcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgc3VzcGljaW91cyBhY3Rpdml0eSBmbGFnXG4gICAgaWYgKHJpc2tBc3Nlc3NtZW50LnJpc2tTY29yZSA+IDcwKSB7XG4gICAgICByZXB1dGF0aW9uLnN1c3BpY2lvdXNBY3Rpdml0eSA9IHRydWVcbiAgICB9XG5cbiAgICAvLyBBdXRvLWJsYWNrbGlzdCBpZiB0b28gbWFueSB2aW9sYXRpb25zXG4gICAgaWYgKHJlcHV0YXRpb24udmlvbGF0aW9ucyA+PSAxMCkge1xuICAgICAgcmVwdXRhdGlvbi5ibGFja2xpc3RlZCA9IHRydWVcbiAgICAgIHJlcHV0YXRpb24uc2NvcmUgPSAwXG4gICAgfVxuXG4gICAgLy8gQXV0by13aGl0ZWxpc3QgaWYgdmVyeSBnb29kIGJlaGF2aW9yXG4gICAgaWYgKHJlcHV0YXRpb24ucmVxdWVzdENvdW50ID4gMTAwICYmIHJlcHV0YXRpb24uc2NvcmUgPiA5MCAmJiByZXB1dGF0aW9uLnZpb2xhdGlvbnMgPT09IDApIHtcbiAgICAgIHJlcHV0YXRpb24ud2hpdGVsaXN0ZWQgPSB0cnVlXG4gICAgfVxuXG4gICAgdGhpcy5yZXB1dGF0aW9uLnNldChpcCwgcmVwdXRhdGlvbilcbiAgfVxuXG4gIC8vIENoZWNrIHJhdGUgbGltaXQgd2l0aCBlbmhhbmNlZCBmZWF0dXJlc1xuICBhc3luYyBjaGVjayhyZXE6IFJlcXVlc3QsIGlkZW50aWZpZXI/OiBzdHJpbmcpOiBQcm9taXNlPFJhdGVMaW1pdFJlc3VsdD4ge1xuICAgIGNvbnN0IGlwID0gdGhpcy5nZXRDbGllbnRJUChyZXEpXG4gICAgY29uc3QgZGV2aWNlRmluZ2VycHJpbnQgPSB0aGlzLmdlbmVyYXRlRGV2aWNlRmluZ2VycHJpbnQocmVxKVxuICAgIGNvbnN0IGtleSA9IGlkZW50aWZpZXIgfHwgaXBcblxuICAgIC8vIEFzc2VzcyByaXNrXG4gICAgY29uc3Qgcmlza0Fzc2Vzc21lbnQgPSB0aGlzLmFzc2Vzc1Jpc2soaXAsIGRldmljZUZpbmdlcnByaW50KVxuXG4gICAgLy8gR2V0IG9yIGNyZWF0ZSB0b2tlbiBidWNrZXRcbiAgICBsZXQgYnVja2V0ID0gdGhpcy5idWNrZXRzLmdldChrZXkpXG4gICAgaWYgKCFidWNrZXQpIHtcbiAgICAgIGNvbnN0IGFkanVzdGVkTGltaXQgPSBNYXRoLmZsb29yKHRoaXMuY29uZmlnLnVuaXF1ZVRva2VuUGVySW50ZXJ2YWwgLyByaXNrQXNzZXNzbWVudC5yYXRlTGltaXRNdWx0aXBsaWVyKVxuICAgICAgY29uc3QgcmVmaWxsUmF0ZSA9IGFkanVzdGVkTGltaXQgLyAodGhpcy5jb25maWcuaW50ZXJ2YWwgLyAxMDAwKVxuICAgICAgYnVja2V0ID0gbmV3IFRva2VuQnVja2V0KGFkanVzdGVkTGltaXQsIHJlZmlsbFJhdGUpXG4gICAgICB0aGlzLmJ1Y2tldHMuc2V0KGtleSwgYnVja2V0KVxuICAgIH1cblxuICAgIC8vIFRyeSB0byBjb25zdW1lIHRva2VuXG4gICAgY29uc3QgYWxsb3dlZCA9IGJ1Y2tldC50cnlDb25zdW1lKClcbiAgICBjb25zdCByZW1haW5pbmcgPSBidWNrZXQuZ2V0UmVtYWluaW5nKClcbiAgICBjb25zdCByZXNldFRpbWUgPSBidWNrZXQuZ2V0UmVzZXRUaW1lKClcblxuICAgIC8vIFVwZGF0ZSByZXB1dGF0aW9uXG4gICAgdGhpcy51cGRhdGVSZXB1dGF0aW9uKGlwLCBhbGxvd2VkLCByaXNrQXNzZXNzbWVudClcblxuICAgIC8vIFN0b3JlIGRldmljZSBmaW5nZXJwcmludFxuICAgIHRoaXMuZGV2aWNlRmluZ2VycHJpbnRzLnNldChkZXZpY2VGaW5nZXJwcmludC5oYXNoLCBkZXZpY2VGaW5nZXJwcmludClcblxuICAgIC8vIExvZyBmb3IgYW5hbHl0aWNzXG4gICAgZGV2TG9nKCdSYXRlIGxpbWl0IGNoZWNrOicsIHtcbiAgICAgIGlwLFxuICAgICAga2V5LFxuICAgICAgYWxsb3dlZCxcbiAgICAgIHJlbWFpbmluZyxcbiAgICAgIHJpc2tTY29yZTogcmlza0Fzc2Vzc21lbnQucmlza1Njb3JlLFxuICAgICAgZmFjdG9yczogcmlza0Fzc2Vzc21lbnQuZmFjdG9ycyxcbiAgICAgIGFjdGlvbjogcmlza0Fzc2Vzc21lbnQucmVjb21tZW5kZWRBY3Rpb25cbiAgICB9KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBhbGxvd2VkLFxuICAgICAgcmVtYWluaW5nLFxuICAgICAgcmVzZXRUaW1lLFxuICAgICAgcmV0cnlBZnRlcjogYWxsb3dlZCA/IG51bGwgOiBNYXRoLmNlaWwoKHJlc2V0VGltZS5nZXRUaW1lKCkgLSBEYXRlLm5vdygpKSAvIDEwMDApLFxuICAgICAgcmlza0Fzc2Vzc21lbnQsXG4gICAgICByZXB1dGF0aW9uOiB0aGlzLnJlcHV0YXRpb24uZ2V0KGlwKSB8fCBudWxsXG4gICAgfVxuICB9XG5cbiAgLy8gR2V0IHJlcHV0YXRpb24gZm9yIGFuIElQXG4gIGdldFJlcHV0YXRpb24oaXA6IHN0cmluZyk6IElQUmVwdXRhdGlvbiB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLnJlcHV0YXRpb24uZ2V0KGlwKSB8fCBudWxsXG4gIH1cblxuICAvLyBNYW51YWxseSB1cGRhdGUgcmVwdXRhdGlvblxuICB1cGRhdGVSZXB1dGF0aW9uTWFudWFsbHkoaXA6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxJUFJlcHV0YXRpb24+KTogdm9pZCB7XG4gICAgY29uc3QgcmVwdXRhdGlvbiA9IHRoaXMucmVwdXRhdGlvbi5nZXQoaXApXG4gICAgaWYgKHJlcHV0YXRpb24pIHtcbiAgICAgIE9iamVjdC5hc3NpZ24ocmVwdXRhdGlvbiwgdXBkYXRlcylcbiAgICAgIHRoaXMucmVwdXRhdGlvbi5zZXQoaXAsIHJlcHV0YXRpb24pXG4gICAgfVxuICB9XG5cbiAgLy8gQ2xlYW51cCBvbGQgZGF0YVxuICBjbGVhbnVwKCk6IHZvaWQge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgICBjb25zdCBtYXhBZ2UgPSAyNCAqIDYwICogNjAgKiAxMDAwIC8vIDI0IGhvdXJzXG5cbiAgICAvLyBDbGVhbnVwIG9sZCBidWNrZXRzXG4gICAgZm9yIChjb25zdCBba2V5LCBidWNrZXRdIG9mIEFycmF5LmZyb20odGhpcy5idWNrZXRzLmVudHJpZXMoKSkpIHtcbiAgICAgIGlmIChub3cgLSBidWNrZXQuZ2V0UmVzZXRUaW1lKCkuZ2V0VGltZSgpID4gbWF4QWdlKSB7XG4gICAgICAgIHRoaXMuYnVja2V0cy5kZWxldGUoa2V5KVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENsZWFudXAgb2xkIHJlcHV0YXRpb24gZGF0YVxuICAgIGZvciAoY29uc3QgW2lwLCByZXB1dGF0aW9uXSBvZiBBcnJheS5mcm9tKHRoaXMucmVwdXRhdGlvbi5lbnRyaWVzKCkpKSB7XG4gICAgICBpZiAobm93IC0gcmVwdXRhdGlvbi5sYXN0UmVxdWVzdC5nZXRUaW1lKCkgPiBtYXhBZ2UgKiA3KSB7IC8vIDcgZGF5c1xuICAgICAgICB0aGlzLnJlcHV0YXRpb24uZGVsZXRlKGlwKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENsZWFudXAgb2xkIGRldmljZSBmaW5nZXJwcmludHNcbiAgICAvLyBOb3RlOiBJbiBwcm9kdWN0aW9uLCB5b3UgbWlnaHQgd2FudCB0byBrZWVwIHRoZXNlIGxvbmdlciBmb3IgYW5hbHl0aWNzXG4gIH1cblxuICAvLyBHZXQgc3RhdGlzdGljc1xuICBnZXRTdGF0cygpOiB7XG4gICAgYnVja2V0czogbnVtYmVyXG4gICAgcmVwdXRhdGlvbjogbnVtYmVyXG4gICAgZGV2aWNlRmluZ2VycHJpbnRzOiBudW1iZXJcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1Y2tldHM6IHRoaXMuYnVja2V0cy5zaXplLFxuICAgICAgcmVwdXRhdGlvbjogdGhpcy5yZXB1dGF0aW9uLnNpemUsXG4gICAgICBkZXZpY2VGaW5nZXJwcmludHM6IHRoaXMuZGV2aWNlRmluZ2VycHJpbnRzLnNpemVcbiAgICB9XG4gIH1cbn1cblxuLy8gUmVkaXMtYmFzZWQgcmF0ZSBsaW1pdGVyIGZvciBwcm9kdWN0aW9uXG5leHBvcnQgY2xhc3MgUmVkaXNSYXRlTGltaXRlciB7XG4gIC8vIEltcGxlbWVudGF0aW9uIGZvciBSZWRpcy1iYXNlZCByYXRlIGxpbWl0aW5nXG4gIC8vIFRoaXMgd291bGQgYmUgdXNlZCBpbiBwcm9kdWN0aW9uIGZvciBkaXN0cmlidXRlZCByYXRlIGxpbWl0aW5nXG4gIC8vIEZvciBub3csIHdlJ2xsIHVzZSB0aGUgZW5oYW5jZWQgbWVtb3J5LWJhc2VkIGxpbWl0ZXJcbn1cblxuLy8gRmFjdG9yeSBmdW5jdGlvbiB0byBjcmVhdGUgYXBwcm9wcmlhdGUgcmF0ZSBsaW1pdGVyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmF0ZUxpbWl0ZXIoY29uZmlnOiBSYXRlTGltaXRDb25maWcpOiBFbmhhbmNlZFJhdGVMaW1pdGVyIHtcbiAgLy8gSW4gcHJvZHVjdGlvbiwgY2hlY2sgZW52aXJvbm1lbnQgYW5kIHJldHVybiBSZWRpcy1iYXNlZCBsaW1pdGVyIGlmIGF2YWlsYWJsZVxuICByZXR1cm4gbmV3IEVuaGFuY2VkUmF0ZUxpbWl0ZXIoY29uZmlnKVxufVxuXG4vLyBQcmUtY29uZmlndXJlZCByYXRlIGxpbWl0ZXJzIGZvciBkaWZmZXJlbnQgZW5kcG9pbnRzXG5leHBvcnQgY29uc3QgcmF0ZUxpbWl0ZXJzID0ge1xuICBhdXRoOiBjcmVhdGVSYXRlTGltaXRlcih7XG4gICAgaW50ZXJ2YWw6IDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dGVzXG4gICAgdW5pcXVlVG9rZW5QZXJJbnRlcnZhbDogMTAsIC8vIDEwIGF0dGVtcHRzIHBlciAxNSBtaW51dGVzXG4gICAgbWF4QnVyc3Q6IDNcbiAgfSksXG4gIFxuICByZWdpc3RyYXRpb246IGNyZWF0ZVJhdGVMaW1pdGVyKHtcbiAgICBpbnRlcnZhbDogNjAgKiA2MCAqIDEwMDAsIC8vIDEgaG91clxuICAgIHVuaXF1ZVRva2VuUGVySW50ZXJ2YWw6IDUsIC8vIDUgcmVnaXN0cmF0aW9ucyBwZXIgaG91clxuICAgIG1heEJ1cnN0OiAxXG4gIH0pLFxuICBcbiAgZGV2aWNlRmxvdzogY3JlYXRlUmF0ZUxpbWl0ZXIoe1xuICAgIGludGVydmFsOiA1ICogNjAgKiAxMDAwLCAvLyA1IG1pbnV0ZXNcbiAgICB1bmlxdWVUb2tlblBlckludGVydmFsOiAyMCwgLy8gMjAgZGV2aWNlIGZsb3cgYXR0ZW1wdHMgcGVyIDUgbWludXRlc1xuICAgIG1heEJ1cnN0OiA1XG4gIH0pLFxuICBcbiAgYmlvbWV0cmljOiBjcmVhdGVSYXRlTGltaXRlcih7XG4gICAgaW50ZXJ2YWw6IDUgKiA2MCAqIDEwMDAsIC8vIDUgbWludXRlc1xuICAgIHVuaXF1ZVRva2VuUGVySW50ZXJ2YWw6IDMwLCAvLyAzMCBiaW9tZXRyaWMgYXR0ZW1wdHMgcGVyIDUgbWludXRlc1xuICAgIG1heEJ1cnN0OiAxMFxuICB9KVxufVxuXG4vLyBNaWRkbGV3YXJlIGZ1bmN0aW9uIGZvciBBUEkgcm91dGVzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmF0ZUxpbWl0TWlkZGxld2FyZShcbiAgcmVxOiBSZXF1ZXN0LFxuICBsaW1pdGVyOiBFbmhhbmNlZFJhdGVMaW1pdGVyID0gcmF0ZUxpbWl0ZXJzLmF1dGhcbik6IFByb21pc2U8UmF0ZUxpbWl0UmVzdWx0PiB7XG4gIHJldHVybiBhd2FpdCBsaW1pdGVyLmNoZWNrKHJlcSlcbn1cbiJdLCJuYW1lcyI6WyJFbmhhbmNlZFJhdGVMaW1pdGVyIiwiUmVkaXNSYXRlTGltaXRlciIsImNyZWF0ZVJhdGVMaW1pdGVyIiwicmF0ZUxpbWl0TWlkZGxld2FyZSIsInJhdGVMaW1pdGVycyIsIlRva2VuQnVja2V0IiwiY2FwYWNpdHkiLCJyZWZpbGxSYXRlIiwidG9rZW5zIiwibGFzdFJlZmlsbCIsIkRhdGUiLCJub3ciLCJ0cnlDb25zdW1lIiwicmVmaWxsIiwidGltZVBhc3NlZCIsInRva2Vuc1RvQWRkIiwiTWF0aCIsIm1pbiIsImdldFJlbWFpbmluZyIsImZsb29yIiwiZ2V0UmVzZXRUaW1lIiwidG9rZW5zTmVlZGVkIiwidGltZU5lZWRlZCIsImNvbmZpZyIsImJ1Y2tldHMiLCJNYXAiLCJyZXB1dGF0aW9uIiwiZGV2aWNlRmluZ2VycHJpbnRzIiwiT2JqZWN0IiwiYXNzaWduIiwibWF4QnVyc3QiLCJyZXB1dGF0aW9uVGhyZXNob2xkIiwiZGV2aWNlRmluZ2VycHJpbnRXZWlnaHQiLCJnZXRDbGllbnRJUCIsInJlcSIsImZvcndhcmRlZCIsImhlYWRlcnMiLCJnZXQiLCJmaXJzdElQIiwic3BsaXQiLCJ0cmltIiwicmVhbElQIiwiZ2VuZXJhdGVEZXZpY2VGaW5nZXJwcmludCIsInVzZXJBZ2VudCIsImFjY2VwdExhbmd1YWdlIiwiZmluZ2VycHJpbnQiLCJzY3JlZW5SZXNvbHV0aW9uIiwidGltZXpvbmUiLCJsYW5ndWFnZSIsInBsYXRmb3JtIiwiZXh0cmFjdFBsYXRmb3JtIiwiY29va2llRW5hYmxlZCIsImRvTm90VHJhY2siLCJoYXNoIiwiaGFzaEZpbmdlcnByaW50IiwiaW5jbHVkZXMiLCJkYXRhIiwiaSIsImxlbmd0aCIsImNoYXIiLCJjaGFyQ29kZUF0IiwiYWJzIiwidG9TdHJpbmciLCJhc3Nlc3NSaXNrIiwiaXAiLCJkZXZpY2VGaW5nZXJwcmludCIsImZhY3RvcnMiLCJyaXNrU2NvcmUiLCJibGFja2xpc3RlZCIsInB1c2giLCJ3aGl0ZWxpc3RlZCIsInNjb3JlIiwic3VzcGljaW91c0FjdGl2aXR5IiwidmlvbGF0aW9ucyIsImV4aXN0aW5nRmluZ2VycHJpbnQiLCJtYXgiLCJyZWNvbW1lbmRlZEFjdGlvbiIsInJhdGVMaW1pdE11bHRpcGxpZXIiLCJ1cGRhdGVSZXB1dGF0aW9uIiwic3VjY2VzcyIsInJpc2tBc3Nlc3NtZW50IiwicmVxdWVzdENvdW50IiwibGFzdFJlcXVlc3QiLCJzZXQiLCJjaGVjayIsImlkZW50aWZpZXIiLCJrZXkiLCJidWNrZXQiLCJhZGp1c3RlZExpbWl0IiwidW5pcXVlVG9rZW5QZXJJbnRlcnZhbCIsImludGVydmFsIiwiYWxsb3dlZCIsInJlbWFpbmluZyIsInJlc2V0VGltZSIsImRldkxvZyIsImFjdGlvbiIsInJldHJ5QWZ0ZXIiLCJjZWlsIiwiZ2V0VGltZSIsImdldFJlcHV0YXRpb24iLCJ1cGRhdGVSZXB1dGF0aW9uTWFudWFsbHkiLCJ1cGRhdGVzIiwiY2xlYW51cCIsIm1heEFnZSIsIkFycmF5IiwiZnJvbSIsImVudHJpZXMiLCJkZWxldGUiLCJnZXRTdGF0cyIsInNpemUiLCJhdXRoIiwicmVnaXN0cmF0aW9uIiwiZGV2aWNlRmxvdyIsImJpb21ldHJpYyIsImxpbWl0ZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7OztDQWNDOzs7Ozs7Ozs7OztRQXVHWUE7ZUFBQUE7O1FBMlRBQztlQUFBQTs7UUFPR0M7ZUFBQUE7O1FBaUNNQztlQUFBQTs7UUEzQlRDO2VBQUFBOzs7d0JBN2FVO0FBc0R2QixpQ0FBaUM7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
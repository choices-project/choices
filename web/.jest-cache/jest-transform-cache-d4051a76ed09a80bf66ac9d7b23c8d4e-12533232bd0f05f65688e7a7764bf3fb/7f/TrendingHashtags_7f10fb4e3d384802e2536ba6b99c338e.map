{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/feeds/lib/TrendingHashtags.ts"],"sourcesContent":["/**\n * Trending Hashtags System\n * \n * Tracks hashtag-style interests and identifies trending content\n * for viral content discovery and user engagement\n */\n\nimport { devLog } from '@/lib/utils/logger';\n\n// Local type definitions\nexport interface HashtagAnalytics {\n  hashtag: string;\n  usageCount: number;\n  trendScore: number;\n  engagementRate: number;\n  lastUsed: Date;\n  totalHashtags?: number;\n  trendingHashtags?: TrendingHashtag[];\n  categoryBreakdown?: Record<string, number>;\n  userEngagement?: Record<string, number>;\n  viralPotential?: TrendingHashtag[];\n}\n\nexport interface TrendingHashtag {\n  hashtag: string;\n  trendScore: number;\n  usageCount: number;\n  growthRate: number;\n  category?: string;\n}\n\nexport interface HashtagUsage {\n  hashtag: string;\n  count: number;\n  lastUsed: Date;\n  users: string[];\n  source?: string;\n  userId?: string;\n  timestamp?: string;\n  metadata?: Record<string, any>;\n}\n\n// Types are now imported from ../types\n\nexport class TrendingHashtagsTracker {\n  private static instance: TrendingHashtagsTracker;\n  private hashtagUsage: HashtagUsage[] = [];\n  private trendingCache: TrendingHashtag[] = [];\n  private lastUpdate: Date = new Date();\n\n  public static getInstance(): TrendingHashtagsTracker {\n    if (!TrendingHashtagsTracker.instance) {\n      TrendingHashtagsTracker.instance = new TrendingHashtagsTracker();\n    }\n    return TrendingHashtagsTracker.instance;\n  }\n\n  /**\n   * Track hashtag usage\n   */\n  trackHashtagUsage(usage: HashtagUsage): void {\n    try {\n      // Store locally (in production, this would go to database)\n      this.hashtagUsage.push(usage);\n      \n      // Update trending cache\n      this.updateTrendingCache();\n      \n      devLog('Hashtag usage tracked:', { usage });\n    } catch (error) {\n      devLog('Error tracking hashtag usage:', { error });\n    }\n  }\n\n  /**\n   * Track multiple hashtag usages (e.g., from onboarding)\n   */\n  trackMultipleHashtags(hashtags: string[], userId: string, source: HashtagUsage['source']): void {\n    const timestamp = new Date().toISOString();\n    \n    for (const hashtag of hashtags) {\n      this.trackHashtagUsage({\n        hashtag: hashtag.toLowerCase().trim(),\n        userId,\n        timestamp,\n        source,\n        count: 1,\n        lastUsed: new Date(),\n        users: [userId]\n      });\n    }\n  }\n\n  /**\n   * Get trending hashtags\n   */\n  getTrendingHashtags(limit = 20): TrendingHashtag[] {\n    // Return cached results if recent\n    if (this.trendingCache.length > 0 && \n        Date.now() - this.lastUpdate.getTime() < 5 * 60 * 1000) { // 5 minutes\n      return this.trendingCache.slice(0, limit);\n    }\n\n    this.updateTrendingCache();\n    return this.trendingCache.slice(0, limit);\n  }\n\n  /**\n   * Get hashtag analytics\n   */\n  getHashtagAnalytics(): HashtagAnalytics {\n    const now = new Date();\n    const last24Hours = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n    const last7Days = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n    // Filter recent usage\n    const recentUsage = this.hashtagUsage.filter(usage => \n      usage.timestamp && new Date(usage.timestamp) > last24Hours\n    );\n\n    // Calculate trending hashtags\n    let trendingHashtags = this.calculateTrendingHashtags(recentUsage);\n\n    // Build 7-day baseline (exclude the last 24h window)\n    const baselineCounts: Record<string, number> = {};\n    this.hashtagUsage.forEach(u => {\n      if (u.timestamp) {\n        const t = new Date(u.timestamp);\n        if (t > last7Days && t <= last24Hours) {\n          baselineCounts[u.hashtag] = (baselineCounts[u.hashtag] ?? 0) + 1;\n        }\n      }\n    });\n\n    // Normalize trending score by 7-day baseline\n    trendingHashtags = trendingHashtags.map(h => {\n      const baselinePerDay = (baselineCounts[h.hashtag] ?? 0) / 7;\n      // Adjustment factor emphasizes spikes above baseline, bounded for stability\n      const factor = 1 + Math.min(0.5, (h.usageCount - baselinePerDay) / (baselinePerDay + 1)) * 0.3;\n      return Object.assign({}, h, {\n        trendScore: Number((h.trendScore * factor).toFixed(2))\n      });\n    });\n\n    // Category breakdown\n    const categoryBreakdown: Record<string, number> = {};\n    recentUsage.forEach(usage => {\n      const category = usage.metadata?.category ?? 'general';\n      categoryBreakdown[category] = (categoryBreakdown[category] || 0) + 1;\n    });\n\n    // User engagement\n    const userEngagement: Record<string, number> = {};\n    recentUsage.forEach(usage => {\n      if (usage.userId) {\n        userEngagement[usage.userId] = (userEngagement[usage.userId] ?? 0) + 1;\n      }\n    });\n\n    // Viral potential (hashtags with high growth rate and engagement)\n    const viralPotential = trendingHashtags\n      .filter(hashtag => hashtag.growthRate > 50 && hashtag.usageCount > 5)\n      .sort((a, b) => b.trendScore - a.trendScore)\n      .slice(0, 10);\n\n    return {\n      hashtag: 'all',\n      usageCount: this.hashtagUsage.length,\n      trendScore: trendingHashtags.length > 0 ? trendingHashtags[0]?.trendScore || 0 : 0,\n      engagementRate: Object.keys(userEngagement).length > 0 ? Object.values(userEngagement).reduce((a, b) => a + b, 0) / Object.keys(userEngagement).length : 0,\n      lastUsed: new Date(),\n      totalHashtags: new Set(this.hashtagUsage.map(u => u.hashtag)).size,\n      trendingHashtags: trendingHashtags.slice(0, 20),\n      categoryBreakdown,\n      userEngagement,\n      viralPotential\n    };\n  }\n\n  /**\n   * Get suggested hashtags for a user based on their interests\n   */\n  getSuggestedHashtags(userInterests: string[], limit = 10): string[] {\n    const analytics = this.getHashtagAnalytics();\n    \n    // Find hashtags that are trending and related to user interests\n    const relatedTrending = analytics.trendingHashtags?.filter((hashtag: any) => {\n      return userInterests.some(interest => \n        hashtag.hashtag.includes(interest) || \n        interest.includes(hashtag.hashtag) ||\n        this.calculateSimilarity(hashtag.hashtag, interest) > 0.3\n      );\n    }) || [];\n\n    // Add some viral potential hashtags\n    const viralSuggestions = analytics.viralPotential\n      ?.filter((hashtag: any) => !userInterests.includes(hashtag.hashtag))\n      .slice(0, 5) || [];\n\n    return [\n      ...relatedTrending.map((h: any) => h.hashtag),\n      ...viralSuggestions.map((h: any) => h.hashtag)\n    ].slice(0, limit);\n  }\n\n  /**\n   * Get hashtag performance for admin dashboard\n   */\n  getHashtagPerformance(hashtag: string): {\n    hashtag: string;\n    totalUsage: number;\n    uniqueUsers: number;\n    growthRate: number;\n    topCategories: string[];\n    recentActivity: HashtagUsage[];\n  } {\n    const hashtagUsage = this.hashtagUsage.filter(u => u.hashtag === hashtag);\n    const uniqueUsers = new Set(hashtagUsage.map(u => u.userId)).size;\n    \n    // Calculate growth rate (last 7 days vs previous 7 days)\n    const now = new Date();\n    const last7Days = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const previous7Days = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);\n    \n    const recentUsage = hashtagUsage.filter(u => u.timestamp && new Date(u.timestamp) > last7Days).length;\n    const previousUsage = hashtagUsage.filter(u => {\n      if (!u.timestamp) return false;\n      const date = new Date(u.timestamp);\n      return date > previous7Days && date <= last7Days;\n    }).length;\n    \n    const growthRate = previousUsage > 0 ? ((recentUsage - previousUsage) / previousUsage) * 100 : 0;\n    \n    // Top categories\n    const categoryCount: Record<string, number> = {};\n    hashtagUsage.forEach(usage => {\n      const category = usage.metadata?.category ?? 'general';\n      categoryCount[category] = (categoryCount[category] || 0) + 1;\n    });\n    \n    const topCategories = Object.entries(categoryCount)\n      .sort(([,a], [,b]) => b - a)\n      .slice(0, 5)\n      .map(([category]) => category);\n\n    return {\n      hashtag,\n      totalUsage: hashtagUsage.length,\n      uniqueUsers,\n      growthRate,\n      topCategories,\n      recentActivity: hashtagUsage.slice(-10)\n    };\n  }\n\n  // Private helper methods\n\n  private updateTrendingCache(): void {\n    const now = new Date();\n    const last24Hours = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n    const last48Hours = new Date(now.getTime() - 48 * 60 * 60 * 1000);\n\n    // Prune entries older than 48 hours to keep memory bounded and focus on recency\n    this.hashtagUsage = this.hashtagUsage.filter(usage => {\n      return usage.timestamp && new Date(usage.timestamp) > last48Hours;\n    });\n\n    const recentUsage = this.hashtagUsage.filter(usage => \n      usage.timestamp && new Date(usage.timestamp) > last24Hours\n    );\n\n    this.trendingCache = this.calculateTrendingHashtags(recentUsage);\n    this.lastUpdate = now;\n  }\n\n  private calculateTrendingHashtags(usage: HashtagUsage[]): TrendingHashtag[] {\n    const hashtagStats: Record<string, {\n      usageCount: number;\n      uniqueUsers: Set<string>;\n      categories: Set<string>;\n      lastUsed: string;\n      previousCount: number;\n    }> = {};\n\n    // Count current usage\n    usage.forEach(usage => {\n      if (!hashtagStats[usage.hashtag]) {\n        hashtagStats[usage.hashtag] = {\n          usageCount: 0,\n          uniqueUsers: new Set(),\n          categories: new Set(),\n          lastUsed: usage.timestamp || new Date().toISOString(),\n          previousCount: 0\n        };\n      }\n      \n      const stats = hashtagStats[usage.hashtag];\n      if (stats) {\n        stats.usageCount++;\n        if (usage.userId) {\n          stats.uniqueUsers.add(usage.userId);\n        }\n        if (usage.metadata?.category) {\n          stats.categories.add(usage.metadata.category);\n        }\n        if (usage.timestamp && usage.timestamp > stats.lastUsed) {\n          stats.lastUsed = usage.timestamp;\n        }\n      }\n    });\n\n    // Calculate previous period usage for growth rate\n    const now = new Date();\n    const last48Hours = new Date(now.getTime() - 48 * 60 * 60 * 1000);\n    const last24Hours = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n    \n    const previousUsage = this.hashtagUsage.filter(usage => {\n      if (!usage.timestamp) return false;\n      const date = new Date(usage.timestamp);\n      return date > last48Hours && date <= last24Hours;\n    });\n\n    previousUsage.forEach(usage => {\n      const stats = hashtagStats[usage.hashtag];\n      if (stats) {\n        stats.previousCount++;\n      }\n    });\n\n    // Convert to TrendingHashtag objects\n    const trendingHashtags: TrendingHashtag[] = Object.entries(hashtagStats).map(([hashtag, stats]) => {\n      const growthRate = stats.previousCount > 0 \n        ? ((stats.usageCount - stats.previousCount) / stats.previousCount) * 100 \n        : stats.usageCount > 0 ? 100 : 0;\n\n      // Calculate trending score (usage count + growth rate + unique users)\n      const trendingScore = stats.usageCount + (growthRate * 0.1) + (stats.uniqueUsers.size * 0.5);\n\n      return {\n        hashtag,\n        usageCount: stats.usageCount,\n        growthRate,\n        recentUsers: Array.from(stats.uniqueUsers),\n        categories: Array.from(stats.categories),\n        lastUsed: stats.lastUsed,\n        trendScore: trendingScore\n      };\n    });\n\n    // Sort by trending score\n    return trendingHashtags.sort((a, b) => b.trendScore - a.trendScore);\n  }\n\n  private calculateSimilarity(str1: string, str2: string): number {\n    // Simple similarity calculation based on common words\n    const words1 = str1.split('-');\n    const words2 = str2.split('-');\n    const commonWords = words1.filter(word => words2.includes(word));\n    return commonWords.length / Math.max(words1.length, words2.length);\n  }\n}\n\n// Export singleton instance\nexport const trendingHashtagsTracker = TrendingHashtagsTracker.getInstance();\n"],"names":["TrendingHashtagsTracker","trendingHashtagsTracker","getInstance","instance","trackHashtagUsage","usage","hashtagUsage","push","updateTrendingCache","devLog","error","trackMultipleHashtags","hashtags","userId","source","timestamp","Date","toISOString","hashtag","toLowerCase","trim","count","lastUsed","users","getTrendingHashtags","limit","trendingCache","length","now","lastUpdate","getTime","slice","getHashtagAnalytics","last24Hours","last7Days","recentUsage","filter","trendingHashtags","calculateTrendingHashtags","baselineCounts","forEach","u","t","map","h","baselinePerDay","factor","Math","min","usageCount","Object","assign","trendScore","Number","toFixed","categoryBreakdown","category","metadata","userEngagement","viralPotential","growthRate","sort","a","b","engagementRate","keys","values","reduce","totalHashtags","Set","size","getSuggestedHashtags","userInterests","analytics","relatedTrending","some","interest","includes","calculateSimilarity","viralSuggestions","getHashtagPerformance","uniqueUsers","previous7Days","previousUsage","date","categoryCount","topCategories","entries","totalUsage","recentActivity","last48Hours","hashtagStats","categories","previousCount","stats","add","trendingScore","recentUsers","Array","from","str1","str2","words1","split","words2","commonWords","word","max"],"mappings":"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"}
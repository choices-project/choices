{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/hashtags/lib/hashtag-service.ts"],"sourcesContent":["/**\n * Hashtag Service\n * \n * Core service layer for hashtag operations including CRUD, search, trending,\n * analytics, and cross-feature integration\n * \n * Created: December 19, 2024\n * Updated: October 11, 2025\n * Status: âœ… ACTIVE\n */\n\n// import { logger } from '@/lib/utils/logger';\n\n// Temporary logger for development\nconst logger = {\n  info: (message: string, context?: any) => console.log(`[INFO] ${message}`, context),\n  error: (message: string, context?: any) => console.error(`[ERROR] ${message}`, context),\n  warn: (message: string, context?: any) => console.warn(`[WARN] ${message}`, context)\n};\n\nimport { createClient } from '../../../utils/supabase/client';\n\n// Helper function to transform database data to Hashtag type\nfunction transformHashtagData(data: any): Hashtag {\n  return {\n    ...data,\n    description: data.description || undefined,\n    category: (data.category as any) || 'general', // Cast to any to handle string -> HashtagCategory conversion\n    created_by: data.created_by || undefined,\n    follower_count: data.follower_count || 0,\n    usage_count: data.usage_count || 0,\n    is_featured: data.is_featured || false,\n    is_trending: data.is_trending || false,\n    is_verified: data.is_verified || false,\n    trend_score: data.trend_score || 0,\n    created_at: data.created_at || new Date().toISOString(),\n    updated_at: data.updated_at || new Date().toISOString(),\n    metadata: data.metadata as Record<string, any> || undefined\n  };\n}\nimport type {\n  Hashtag,\n  HashtagSuggestion,\n  HashtagValidation,\n  HashtagCategory,\n  UserHashtag,\n  TrendingHashtag,\n  HashtagSearchQuery,\n  HashtagSearchResult,\n  HashtagAnalytics,\n  HashtagApiResponse,\n  HashtagStatsResponse,\n  HashtagUserPreferences,\n  ProfileHashtagIntegration,\n  PollHashtagIntegration,\n  FeedHashtagIntegration\n} from '../types';\n\nconst supabase = createClient();\n\n// ============================================================================\n// CORE HASHTAG OPERATIONS\n// ============================================================================\n\n/**\n * Get hashtag by ID\n */\nexport async function getHashtagById(id: string): Promise<HashtagApiResponse<Hashtag>> {\n  try {\n    const result = await supabase\n      .from('hashtags')\n      .select('*')\n      .eq('id', id)\n      .single();\n    \n    const { data, error } = result;\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data: data ? transformHashtagData(data) : undefined };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch hashtag' \n    };\n  }\n}\n\n/**\n * Get hashtag by name\n */\nexport async function getHashtagByName(name: string): Promise<HashtagApiResponse<Hashtag>> {\n  try {\n    const normalizedName = name.toLowerCase().replace(/^#/, '');\n    \n    const result = await supabase\n      .from('hashtags')\n      .select('*')\n      .eq('name', normalizedName)\n      .single();\n    \n    const { data, error } = result;\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data: transformHashtagData(data) };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch hashtag' \n    };\n  }\n}\n\n/**\n * Create new hashtag\n */\nexport async function createHashtag(\n  name: string, \n  description?: string,\n  category?: HashtagCategory\n): Promise<HashtagApiResponse<Hashtag>> {\n  try {\n    const normalizedName = name.toLowerCase().replace(/^#/, '');\n    \n    // Check if hashtag already exists\n    const existing = await getHashtagByName(normalizedName);\n    if (existing.success && existing.data) {\n      return { success: false, error: 'Hashtag already exists' };\n    }\n\n    const result = await supabase\n      .from('hashtags')\n      .insert({\n        name: normalizedName,\n        display_name: name,\n        description,\n        category,\n        usage_count: 0,\n        follower_count: 0,\n        is_trending: false,\n        trend_score: 0,\n        is_verified: false,\n        is_featured: false\n      })\n      .select()\n      .single();\n    \n    const { data, error } = result;\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data: transformHashtagData(data) };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to create hashtag' \n    };\n  }\n}\n\n/**\n * Update hashtag\n */\nexport async function updateHashtag(\n  id: string, \n  updates: Partial<Hashtag>\n): Promise<HashtagApiResponse<Hashtag>> {\n  try {\n    const result = await supabase\n      .from('hashtags')\n      .update({\n        ...updates,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', id)\n      .select()\n      .single();\n    \n    const { data, error } = result;\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data: transformHashtagData(data) };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to update hashtag' \n    };\n  }\n}\n\n/**\n * Delete hashtag\n */\nexport async function deleteHashtag(id: string): Promise<HashtagApiResponse<boolean>> {\n  try {\n    const { error } = await supabase\n      .from('hashtags')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data: true };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to delete hashtag' \n    };\n  }\n}\n\n// ============================================================================\n// HASHTAG SEARCH AND DISCOVERY\n// ============================================================================\n\n/**\n * Search hashtags\n */\nexport async function searchHashtags(query: HashtagSearchQuery): Promise<HashtagApiResponse<HashtagSearchResult>> {\n  try {\n    const startTime = Date.now();\n    let supabaseQuery = supabase\n      .from('hashtags')\n      .select('*');\n\n    // Apply text search\n    if (query.query) {\n      supabaseQuery = supabaseQuery.or(`name.ilike.%${query.query}%,display_name.ilike.%${query.query}%,description.ilike.%${query.query}%`);\n    }\n\n    // Apply filters\n    if (query.filters) {\n      if (query.filters.category) {\n        supabaseQuery = supabaseQuery.eq('category', query.filters.category);\n      }\n      if (query.filters.is_trending !== undefined) {\n        supabaseQuery = supabaseQuery.eq('is_trending', query.filters.is_trending);\n      }\n      if (query.filters.is_verified !== undefined) {\n        supabaseQuery = supabaseQuery.eq('is_verified', query.filters.is_verified);\n      }\n      if (query.filters.min_usage_count !== undefined) {\n        supabaseQuery = supabaseQuery.gte('usage_count', query.filters.min_usage_count);\n      }\n      if (query.filters.created_after) {\n        supabaseQuery = supabaseQuery.gte('created_at', query.filters.created_after);\n      }\n      if (query.filters.created_before) {\n        supabaseQuery = supabaseQuery.lte('created_at', query.filters.created_before);\n      }\n    }\n\n    // Apply sorting\n    const sortField = query.sort ?? 'relevance';\n    switch (sortField) {\n      case 'usage':\n        supabaseQuery = supabaseQuery.order('usage_count', { ascending: false });\n        break;\n      case 'trending':\n        supabaseQuery = supabaseQuery.order('trend_score', { ascending: false });\n        break;\n      case 'alphabetical':\n        supabaseQuery = supabaseQuery.order('name', { ascending: true });\n        break;\n      case 'created':\n        supabaseQuery = supabaseQuery.order('created_at', { ascending: false });\n        break;\n      default:\n        supabaseQuery = supabaseQuery.order('usage_count', { ascending: false });\n    }\n\n    // Apply pagination\n    const limit = query.limit || 20;\n    const offset = query.offset || 0;\n    supabaseQuery = supabaseQuery.range(offset, offset + limit - 1);\n\n    const { data: hashtags, error, count } = await supabaseQuery;\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    const result: HashtagSearchResult = {\n      hashtags: (hashtags || []).map(transformHashtagData),\n      total_count: count || 0,\n      suggestions: generateSuggestions(query.query, (hashtags || []).map(transformHashtagData)),\n      related_queries: await generateRelatedQueries(query.query),\n      filters_applied: query.filters || {},\n      search_time_ms: Date.now() - startTime\n    };\n\n    return { success: true, data: result };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to search hashtags' \n    };\n  }\n}\n\n/**\n * Get trending hashtags\n */\nexport async function getTrendingHashtags(\n  category?: HashtagCategory,\n  limit = 20\n): Promise<HashtagApiResponse<TrendingHashtag[]>> {\n  try {\n    let supabaseQuery = supabase\n      .from('hashtags')\n      .select('*')\n      .eq('is_trending', true)\n      .order('trend_score', { ascending: false })\n      .limit(limit);\n\n    if (category) {\n      supabaseQuery = supabaseQuery.eq('category', category);\n    }\n\n    const { data: hashtags, error } = await supabaseQuery;\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    // Transform to trending hashtags with additional metrics\n    const trendingHashtags: TrendingHashtag[] = await Promise.all((hashtags || []).map(async hashtag => ({\n      hashtag: transformHashtagData(hashtag),\n      trend_score: hashtag.trend_score || 0,\n      growth_rate: await calculateGrowthRate(transformHashtagData(hashtag)),\n      usage_count_24h: await calculateUsage24h(transformHashtagData(hashtag)),\n      usage_count_7d: await calculateUsage7d(transformHashtagData(hashtag)),\n      peak_position: await calculatePeakPosition(hashtag.id),\n      current_position: await calculateCurrentPosition(hashtag.id),\n      related_hashtags: await calculateRelatedHashtags(hashtag.id),\n      trending_since: hashtag.created_at || '',\n      category_trends: await calculateCategoryTrends((hashtag.category as any) || 'general')\n    })));\n\n    return { success: true, data: trendingHashtags };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch trending hashtags' \n    };\n  }\n}\n\n/**\n * Get hashtag suggestions\n */\nexport async function getHashtagSuggestions(\n  input: string,\n  context?: string,\n  limit = 10\n): Promise<HashtagApiResponse<HashtagSuggestion[]>> {\n  try {\n    const normalizedInput = input.toLowerCase().replace(/^#/, '');\n    \n    // Search for matching hashtags\n    const { data: hashtags, error } = await supabase\n      .from('hashtags')\n      .select('*')\n      .or(`name.ilike.%${normalizedInput}%,display_name.ilike.%${normalizedInput}%`)\n      .order('usage_count', { ascending: false })\n      .limit(limit);\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    const suggestions: HashtagSuggestion[] = (hashtags || []).map(hashtag => ({\n      hashtag: transformHashtagData(hashtag),\n      reason: determineSuggestionReason(transformHashtagData(hashtag), input),\n      confidence: calculateConfidenceScore(transformHashtagData(hashtag), input),\n      confidence_score: calculateConfidenceScore(transformHashtagData(hashtag), input),\n      source: 'search' as const,\n      ...(context && { context })\n    }));\n\n    return { success: true, data: suggestions };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch hashtag suggestions' \n    };\n  }\n}\n\n// ============================================================================\n// USER HASHTAG INTERACTIONS\n// ============================================================================\n\n/**\n * Follow hashtag\n */\nexport async function followHashtag(hashtagId: string): Promise<HashtagApiResponse<UserHashtag>> {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n      return { success: false, error: 'User not authenticated' };\n    }\n\n    // Check if already following\n    const { data: existing } = await supabase\n      .from('user_hashtags')\n      .select('*')\n      .eq('user_id', user.id)\n      .eq('hashtag_id', hashtagId)\n      .single();\n\n    if (existing) {\n      return { success: false, error: 'Already following this hashtag' };\n    }\n\n    const { data, error } = await supabase\n      .from('user_hashtags')\n      .insert({\n        user_id: user.id,\n        hashtag_id: hashtagId,\n        followed_at: new Date().toISOString(),\n        is_primary: false,\n        usage_count: 0\n      })\n      .select(`\n        *,\n        hashtag:hashtags(*)\n      `)\n      .single();\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    // Update follower count manually\n    const { data: currentHashtag } = await supabase\n      .from('hashtags')\n      .select('follower_count')\n      .eq('id', hashtagId)\n      .single();\n    \n    if (currentHashtag) {\n      await supabase\n        .from('hashtags')\n        .update({ follower_count: (currentHashtag.follower_count || 0) + 1 })\n        .eq('id', hashtagId);\n    }\n\n    return { success: true, data: {\n      ...data,\n      hashtag: transformHashtagData(data.hashtag),\n      followed_at: data.followed_at || new Date().toISOString(),\n      is_primary: data.is_primary || false,\n      usage_count: data.usage_count || 0,\n      last_used_at: data.last_used_at || undefined,\n      preferences: data.preferences || undefined\n    } as UserHashtag };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to follow hashtag' \n    };\n  }\n}\n\n/**\n * Unfollow hashtag\n */\nexport async function unfollowHashtag(hashtagId: string): Promise<HashtagApiResponse<boolean>> {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n      return { success: false, error: 'User not authenticated' };\n    }\n\n    const { error } = await supabase\n      .from('user_hashtags')\n      .delete()\n      .eq('user_id', user.id)\n      .eq('hashtag_id', hashtagId);\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    // Update follower count manually\n    const { data: currentHashtag } = await supabase\n      .from('hashtags')\n      .select('follower_count')\n      .eq('id', hashtagId)\n      .single();\n    \n    if (currentHashtag) {\n      await supabase\n        .from('hashtags')\n        .update({ follower_count: Math.max((currentHashtag.follower_count || 0) - 1, 0) })\n        .eq('id', hashtagId);\n    }\n\n    return { success: true, data: true };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to unfollow hashtag' \n    };\n  }\n}\n\n/**\n * Get user's followed hashtags\n */\nexport async function getUserHashtags(): Promise<HashtagApiResponse<UserHashtag[]>> {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n      return { success: false, error: 'User not authenticated' };\n    }\n\n    const { data, error } = await supabase\n      .from('user_hashtags')\n      .select(`\n        *,\n        hashtag:hashtags(*)\n      `)\n      .eq('user_id', user.id)\n      .order('followed_at', { ascending: false });\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data: (data || []).map(item => ({\n      ...item,\n      hashtag: transformHashtagData(item.hashtag),\n      followed_at: item.followed_at || new Date().toISOString(),\n      is_primary: item.is_primary || false,\n      usage_count: item.usage_count || 0,\n      last_used_at: item.last_used_at || undefined,\n      preferences: item.preferences || undefined\n    } as UserHashtag)) };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch user hashtags' \n    };\n  }\n}\n\n// ============================================================================\n// HASHTAG ANALYTICS AND INSIGHTS\n// ============================================================================\n\n/**\n * Get hashtag analytics\n */\nexport async function getHashtagAnalytics(\n  hashtagId: string,\n  period: '24h' | '7d' | '30d' | '90d' | '1y' = '7d'\n): Promise<HashtagApiResponse<HashtagAnalytics>> {\n  try {\n    // Import the analytics function from hashtag-analytics.ts\n    const { calculateHashtagAnalytics } = await import('./hashtag-analytics');\n    const analytics = await calculateHashtagAnalytics(hashtagId, period);\n\n    return { success: true, data: analytics };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch hashtag analytics' \n    };\n  }\n}\n\n/**\n * Get hashtag stats\n */\nexport async function getHashtagStats(): Promise<HashtagApiResponse<HashtagStatsResponse>> {\n  try {\n    const { data: stats, error } = await supabase\n      .from('hashtags')\n      .select('*')\n      .order('usage_count', { ascending: false })\n      .limit(100);\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    const statsResponse: HashtagStatsResponse = {\n      total_hashtags: stats?.length || 0,\n      trending_count: stats?.filter(s => s.is_trending).length || 0,\n      verified_count: stats?.filter(s => s.is_verified).length || 0,\n      categories: {} as Record<HashtagCategory, number>,\n      top_hashtags: stats?.slice(0, 10) as Hashtag[] || [],\n      recent_activity: await getRecentActivity() as any,\n      system_health: {\n        api_response_time: 0,\n        database_performance: 0,\n        cache_hit_rate: 0\n      }\n    };\n\n    return { success: true, data: statsResponse };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch hashtag stats' \n    };\n  }\n}\n\n// ============================================================================\n// HASHTAG VALIDATION\n// ============================================================================\n\n/**\n * Validate hashtag name\n */\nexport async function validateHashtagName(name: string): Promise<HashtagApiResponse<HashtagValidation>> {\n  try {\n    const normalizedName = name.toLowerCase().replace(/^#/, '');\n    const errors: string[] = [];\n    const warnings: string[] = [];\n    const suggestions: string[] = [];\n\n    // Basic validation\n    if (!normalizedName || normalizedName.length < 2) {\n      errors.push('Hashtag must be at least 2 characters long');\n    }\n\n    if (normalizedName.length > 50) {\n      errors.push('Hashtag must be less than 50 characters');\n    }\n\n    if (!/^[a-z0-9_]+$/.test(normalizedName)) {\n      errors.push('Hashtag can only contain letters, numbers, and underscores');\n    }\n\n    // Check availability\n    const existing = await getHashtagByName(normalizedName);\n    const _isAvailable = !existing.success || !existing.data;\n\n    const validation: HashtagValidation = {\n      name: normalizedName,\n      is_valid: errors.length === 0,\n      errors,\n      warnings,\n      suggestions,\n      normalized_name: normalizedName,\n      availability: {\n        is_available: errors.length === 0,\n        similar_hashtags: [],\n        conflict_reason: errors.length > 0 ? errors[0] : undefined\n      }\n    };\n\n    return { success: true, data: validation };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to validate hashtag' \n    };\n  }\n}\n\n// ============================================================================\n// CROSS-FEATURE INTEGRATION\n// ============================================================================\n\n/**\n * Get profile hashtag integration\n */\nexport async function getProfileHashtagIntegration(userId: string): Promise<HashtagApiResponse<ProfileHashtagIntegration>> {\n  try {\n    // Get user's followed hashtags\n    const { data: userHashtags, error: userHashtagsError } = await supabase\n      .from('user_hashtags')\n      .select('*, hashtag:hashtags(*)')\n      .eq('user_id', userId);\n\n    if (userHashtagsError) throw userHashtagsError;\n\n    // Get user's hashtag preferences (fallback to user_profiles if table doesn't exist)\n    let preferences, preferencesError;\n    try {\n      const result = await (supabase as any)\n        .from('hashtag_user_preferences')\n        .select('*')\n        .eq('user_id', userId)\n        .single();\n      preferences = result.data;\n      preferencesError = result.error;\n    } catch (tableError) {\n      // Fallback to user_profiles table\n      logger.warn('hashtag_user_preferences table not available, using user_profiles', { tableError });\n      const result = await supabase\n        .from('user_profiles')\n        .select('*')\n        .eq('id', userId)\n        .single();\n      preferences = result.data ? {\n        preferences: {\n          followed_hashtags: (result.data as any).followed_hashtags || [],\n          hashtag_filters: (result.data as any).hashtag_filters || []\n        }\n      } : null;\n      preferencesError = result.error;\n    }\n\n    if (preferencesError) throw preferencesError;\n\n    // Get user's hashtag activity (fallback to hashtag_usage if table doesn't exist)\n    let activity, activityError;\n    try {\n      const result = await supabase\n        .from('hashtag_engagement')\n        .select('*')\n        .eq('user_id', userId)\n        .order('timestamp', { ascending: false })\n        .limit(50);\n      activity = result.data as any;\n      activityError = result.error;\n    } catch (tableError) {\n      // Fallback to hashtag_usage table\n      logger.warn('hashtag_engagement table not available, using hashtag_usage', { tableError });\n      const result = await supabase\n        .from('hashtag_usage')\n        .select('*')\n        .eq('user_id', userId)\n        .order('created_at', { ascending: false })\n        .limit(50);\n      activity = result.data as any;\n      activityError = result.error;\n    }\n\n    if (activityError) throw activityError;\n\n    const integration: ProfileHashtagIntegration = {\n      user_id: userId,\n      primary_hashtags: userHashtags?.filter(uh => uh.is_primary).map(uh => uh.hashtag.name) || [],\n      interest_hashtags: userHashtags?.filter(uh => !uh.is_primary).map(uh => uh.hashtag.name) || [],\n      custom_hashtags: await getUserCustomHashtags(userId),\n      followed_hashtags: userHashtags?.map(uh => uh.hashtag.name) || [],\n      hashtag_preferences: preferences || {} as HashtagUserPreferences,\n      hashtag_activity: activity || [],\n      last_updated: new Date().toISOString()\n    };\n\n    return { success: true, data: integration };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch profile hashtag integration' \n    };\n  }\n}\n\n/**\n * Get poll hashtag integration\n */\nexport async function getPollHashtagIntegration(pollId: string): Promise<HashtagApiResponse<PollHashtagIntegration>> {\n  try {\n    // Get poll details with hashtags\n    const { data: poll, error: pollError } = await supabase\n      .from('polls')\n      .select('hashtags, primary_hashtag, total_views')\n      .eq('id', pollId)\n      .single();\n\n    if (pollError) throw pollError;\n\n    // Get hashtag engagement data (fallback to hashtag_usage if table doesn't exist)\n    let engagement, engagementError;\n    try {\n      const result = await supabase\n        .from('hashtag_engagement')\n        .select('engagement_type')\n        .eq('content_id', pollId)\n        .eq('content_type', 'poll');\n      engagement = result.data;\n      engagementError = result.error;\n    } catch (tableError) {\n      // Fallback to hashtag_usage table\n      logger.warn('hashtag_engagement table not available, using hashtag_usage', { tableError });\n      const result = await supabase\n        .from('hashtag_usage')\n        .select('*')\n        .eq('content_id', pollId)\n        .eq('content_type', 'poll');\n      engagement = result.data;\n      engagementError = result.error;\n    }\n\n    if (engagementError) throw engagementError;\n\n    // Get related polls\n    const { data: relatedPolls, error: relatedError } = await supabase\n      .from('polls')\n      .select('id')\n      .overlaps('hashtags', poll.hashtags || [])\n      .neq('id', pollId)\n      .limit(10);\n\n    if (relatedError) throw relatedError;\n\n    // Calculate trending score\n    const trendingScore = poll.hashtags?.length ? poll.hashtags.length * 10 : 0;\n\n    const integration: PollHashtagIntegration = {\n      poll_id: pollId,\n      hashtags: poll.hashtags || [],\n      primary_hashtag: poll.primary_hashtag || undefined,\n      hashtag_engagement: {\n        total_views: poll.total_views || 0,\n        hashtag_clicks: engagement?.filter(e => (e as any).engagement_type === 'click').length || 0,\n        hashtag_shares: engagement?.filter(e => (e as any).engagement_type === 'share').length || 0\n      },\n      related_polls: relatedPolls?.map(p => p.id) || [],\n      hashtag_trending_score: trendingScore\n    };\n\n    return { success: true, data: integration };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch poll hashtag integration' \n    };\n  }\n}\n\n/**\n * Get feed hashtag integration\n */\nexport async function getFeedHashtagIntegration(feedId: string): Promise<HashtagApiResponse<FeedHashtagIntegration>> {\n  try {\n    // Get feed details (fallback to user_profiles if feeds table doesn't exist)\n    let feed, feedError;\n    try {\n      const result = await (supabase as any)\n        .from('feeds')\n        .select('hashtag_filters, user_id')\n        .eq('id', feedId)\n        .single();\n      feed = result.data;\n      feedError = result.error;\n    } catch (tableError) {\n      // Fallback to user_profiles table\n      logger.warn('feeds table not available, using user_profiles', { tableError });\n      const result = await supabase\n        .from('user_profiles')\n        .select('*')\n        .eq('id', feedId)\n        .single();\n      feed = result.data ? {\n        hashtag_filters: (result.data as any).hashtag_filters || [],\n        user_id: result.data.id\n      } : null;\n      feedError = result.error;\n    }\n\n    if (feedError) throw feedError;\n\n    // Get trending hashtags\n    const { data: trendingHashtags, error: trendingError } = await supabase\n      .from('hashtags')\n      .select('name')\n      .eq('is_trending', true)\n      .order('trend_score', { ascending: false })\n      .limit(10);\n\n    if (trendingError) throw trendingError;\n\n    // Get hashtag content (fallback to hashtag_usage if table doesn't exist)\n    let hashtagContent, contentError;\n    try {\n      const result = await (supabase as any)\n        .from('hashtag_content')\n        .select('*')\n        .eq('feed_id', feedId)\n        .order('created_at', { ascending: false })\n        .limit(20);\n      hashtagContent = result.data;\n      contentError = result.error;\n    } catch (tableError) {\n      // Fallback to hashtag_usage table\n      logger.warn('hashtag_content table not available, using hashtag_usage', { tableError });\n      const result = await supabase\n        .from('hashtag_usage')\n        .select('*')\n        .eq('user_id', feed.user_id)\n        .order('created_at', { ascending: false })\n        .limit(20);\n      hashtagContent = result.data;\n      contentError = result.error;\n    }\n\n    if (contentError) throw contentError;\n\n    // Get personalized hashtags for user\n    const { data: personalizedHashtags, error: personalError } = await supabase\n      .from('user_hashtags')\n      .select('hashtag:hashtags(name)')\n      .eq('user_id', feed.user_id)\n      .order('usage_count', { ascending: false })\n      .limit(10);\n\n    if (personalError) throw personalError;\n\n    // Get hashtag analytics (fallback to basic analytics if table doesn't exist)\n    let analytics, analyticsError;\n    try {\n      const result = await (supabase as any)\n        .from('hashtag_analytics')\n        .select('*')\n        .eq('feed_id', feedId)\n        .single();\n      analytics = result.data;\n      analyticsError = result.error;\n    } catch (tableError) {\n      // Fallback to basic analytics\n      logger.warn('hashtag_analytics table not available, using basic analytics', { tableError });\n      analytics = {\n        total_hashtags: hashtagContent?.length || 0,\n        trending_count: trendingHashtags?.length || 0,\n        engagement_rate: 0,\n        last_updated: new Date().toISOString()\n      };\n      analyticsError = null;\n    }\n\n    if (analyticsError) throw analyticsError;\n\n    const integration: FeedHashtagIntegration = {\n      feed_id: feedId,\n      hashtag_filters: feed.hashtag_filters || [],\n      trending_hashtags: trendingHashtags?.map(h => h.name) || [],\n      hashtag_content: hashtagContent || [],\n      hashtag_analytics: analytics || {} as HashtagAnalytics,\n      personalized_hashtags: personalizedHashtags?.map((uh: any) => uh.hashtag.name) || []\n    };\n\n    return { success: true, data: integration };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to fetch feed hashtag integration' \n    };\n  }\n}\n\n// ============================================================================\n// UTILITY FUNCTIONS\n// ============================================================================\n\nfunction generateSuggestions(query: string, hashtags: Hashtag[]): string[] {\n  if (!query || hashtags.length === 0) return [];\n  \n  return hashtags\n    .slice(0, 5)\n    .map(h => h.name)\n    .filter(name => name.toLowerCase().includes(query.toLowerCase()));\n}\n\nasync function generateRelatedQueries(query: string): Promise<string[]> {\n  try {\n    const normalizedQuery = query.toLowerCase().trim();\n    if (!normalizedQuery) return [];\n\n    // Get hashtags that contain the query\n    const { data: hashtags, error } = await supabase\n      .from('hashtags')\n      .select('name, usage_count')\n      .ilike('name', `%${normalizedQuery}%`)\n      .order('usage_count', { ascending: false })\n      .limit(10);\n\n    if (error) throw error;\n\n    // Generate related queries based on hashtag names and usage patterns\n    const relatedQueries: string[] = [];\n    \n    hashtags?.forEach(hashtag => {\n      const name = hashtag.name;\n      \n      // Add the hashtag name itself\n      if (name !== normalizedQuery) {\n        relatedQueries.push(name);\n      }\n      \n      // Add variations (remove # if present, add common suffixes)\n      const baseName = name.replace('#', '');\n      if (baseName !== normalizedQuery) {\n        relatedQueries.push(baseName);\n      }\n      \n      // Add common variations\n      const variations = [\n        `${baseName}2024`,\n        `${baseName}2025`,\n        `new${baseName}`,\n        `latest${baseName}`,\n        `${baseName}news`,\n        `${baseName}update`\n      ];\n      \n      variations.forEach(variation => {\n        if (!relatedQueries.includes(variation) && relatedQueries.length < 10) {\n          relatedQueries.push(variation);\n        }\n      });\n    });\n\n    // Remove duplicates and limit results\n    return [...new Set(relatedQueries)].slice(0, 8);\n  } catch (error) {\n    console.error('Failed to generate related queries:', error);\n    return [];\n  }\n}\n\nasync function calculateGrowthRate(hashtag: Hashtag): Promise<number> {\n  try {\n    const now = new Date();\n    const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const fourteenDaysAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);\n\n    // Get usage data for the last 7 days\n    const { data: recentUsage, error: recentError } = await supabase\n      .from('hashtag_usage')\n      .select('id')\n      .eq('hashtag_id', hashtag.id)\n      .gte('created_at', sevenDaysAgo.toISOString())\n      .lte('created_at', now.toISOString());\n\n    if (recentError) throw recentError;\n\n    // Get usage data for the previous 7 days\n    const { data: previousUsage, error: previousError } = await supabase\n      .from('hashtag_usage')\n      .select('id')\n      .eq('hashtag_id', hashtag.id)\n      .gte('created_at', fourteenDaysAgo.toISOString())\n      .lt('created_at', sevenDaysAgo.toISOString());\n\n    if (previousError) throw previousError;\n\n    const recentCount = recentUsage?.length || 0;\n    const previousCount = previousUsage?.length || 0;\n\n    // Calculate growth rate as percentage change\n    if (previousCount === 0) {\n      return recentCount > 0 ? 100 : 0; // 100% growth if no previous usage\n    }\n\n    const growthRate = ((recentCount - previousCount) / previousCount) * 100;\n    return Math.round(growthRate * 100) / 100; // Round to 2 decimal places\n  } catch (error) {\n    console.error('Failed to calculate growth rate:', error);\n    return 0;\n  }\n}\n\nasync function calculateUsage24h(hashtag: Hashtag): Promise<number> {\n  try {\n    const now = new Date();\n    const twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n\n    const { data, error } = await supabase\n      .from('hashtag_usage')\n      .select('id')\n      .eq('hashtag_id', hashtag.id)\n      .gte('created_at', twentyFourHoursAgo.toISOString())\n      .lte('created_at', now.toISOString());\n\n    if (error) throw error;\n\n    return data?.length || 0;\n  } catch (error) {\n    console.error('Failed to calculate 24h usage:', error);\n    return 0;\n  }\n}\n\nasync function calculateUsage7d(hashtag: Hashtag): Promise<number> {\n  try {\n    const now = new Date();\n    const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n    const { data, error } = await supabase\n      .from('hashtag_usage')\n      .select('id')\n      .eq('hashtag_id', hashtag.id)\n      .gte('created_at', sevenDaysAgo.toISOString())\n      .lte('created_at', now.toISOString());\n\n    if (error) throw error;\n\n    return data?.length || 0;\n  } catch (error) {\n    console.error('Failed to calculate 7d usage:', error);\n    return 0;\n  }\n}\n\nfunction determineSuggestionReason(hashtag: Hashtag, input: string): 'trending' | 'related' | 'popular' | 'recent' | 'personal' {\n  logger.info(`Determining suggestion reason for hashtag: ${hashtag.name}, input: ${input}`, { hashtagName: hashtag.name, input });\n  if (hashtag.is_trending) return 'trending';\n  if (hashtag.usage_count > 1000) return 'popular';\n  return 'related';\n}\n\nfunction calculateConfidenceScore(hashtag: Hashtag, input: string): number {\n  const normalizedInput = input.toLowerCase();\n  const normalizedHashtag = hashtag.name.toLowerCase();\n  \n  // Exact match gets highest confidence\n  if (normalizedHashtag === normalizedInput) return 1.0;\n  \n  // Starts with input gets high confidence\n  if (normalizedHashtag.startsWith(normalizedInput)) return 0.9;\n  \n  // Contains input gets medium confidence\n  if (normalizedHashtag.includes(normalizedInput)) return 0.7;\n  \n  // High usage hashtags get higher confidence\n  if (hashtag.usage_count > 1000) return 0.6;\n  if (hashtag.usage_count > 100) return 0.4;\n  \n  return 0.2;\n}\n\n/**\n * Get user's custom hashtags (user-created hashtags)\n */\nasync function getUserCustomHashtags(userId: string): Promise<string[]> {\n  try {\n    const { data, error } = await supabase\n      .from('hashtags')\n      .select('name')\n      .eq('created_by', userId)\n      .order('created_at', { ascending: false })\n      .limit(20);\n\n    if (error) throw error;\n\n    return data?.map(h => h.name) || [];\n  } catch (error) {\n    console.error('Failed to get user custom hashtags:', error);\n    return [];\n  }\n}\n\n// ============================================================================\n// ADDITIONAL CALCULATION FUNCTIONS\n// ============================================================================\n\nasync function calculatePeakPosition(hashtagId: string): Promise<number> {\n  try {\n    // Get historical trending data (fallback to hashtags table if history table doesn't exist)\n    let historicalData, error;\n    try {\n      const result = await (supabase as any)\n        .from('hashtag_trending_history')\n        .select('position')\n        .eq('hashtag_id', hashtagId)\n        .order('created_at', { ascending: false })\n        .limit(30);\n      historicalData = result.data;\n      error = result.error;\n    } catch (tableError) {\n      // Fallback to hashtags table\n      logger.warn('hashtag_trending_history table not available, using hashtags table', { tableError });\n      const result = await supabase\n        .from('hashtags')\n        .select('trend_score')\n        .eq('id', hashtagId)\n        .single();\n      historicalData = result.data ? [{ position: Math.max(1, 100 - (result.data.trend_score || 0)) }] : [];\n      error = result.error;\n    }\n\n    if (error || !historicalData?.length) return 1;\n\n    // Find the best (lowest) position\n    const positions = historicalData.map((d: any) => d.position || 1);\n    return Math.min(...positions);\n  } catch (error) {\n    console.error('Failed to calculate peak position:', error);\n    return 1;\n  }\n}\n\nasync function calculateCurrentPosition(hashtagId: string): Promise<number> {\n  try {\n    // Get current trending ranking\n    const { data: currentRanking, error } = await supabase\n      .from('hashtags')\n      .select('id, trend_score')\n      .eq('is_trending', true)\n      .order('trend_score', { ascending: false });\n\n    if (error || !currentRanking?.length) return 1;\n\n    const position = currentRanking.findIndex(h => h.id === hashtagId);\n    return position >= 0 ? position + 1 : 1;\n  } catch (error) {\n    console.error('Failed to calculate current position:', error);\n    return 1;\n  }\n}\n\nasync function calculateRelatedHashtags(hashtagId: string): Promise<string[]> {\n  try {\n    // Get hashtag details\n    const { data: hashtag, error: hashtagError } = await supabase\n      .from('hashtags')\n      .select('category')\n      .eq('id', hashtagId)\n      .single();\n\n    if (hashtagError) return [];\n\n    // Find related hashtags by category\n    const { data: relatedHashtags, error: relatedError } = await supabase\n      .from('hashtags')\n      .select('name')\n      .eq('category', hashtag.category || 'general')\n      .neq('id', hashtagId)\n      .order('usage_count', { ascending: false })\n      .limit(5);\n\n    if (relatedError) return [];\n\n    return relatedHashtags?.map(h => h.name) || [];\n  } catch (error) {\n    console.error('Failed to calculate related hashtags:', error);\n    return [];\n  }\n}\n\nasync function calculateCategoryTrends(category: string): Promise<Record<string, number>> {\n  try {\n    // Get category trending data\n    const { data: categoryData, error } = await supabase\n      .from('hashtags')\n      .select('trend_score, usage_count')\n      .eq('category', category)\n      .eq('is_trending', true);\n\n    if (error || !categoryData?.length) return {};\n\n    const totalTrendScore = categoryData.reduce((sum, h) => sum + (h.trend_score || 0), 0);\n    const totalUsage = categoryData.reduce((sum, h) => sum + (h.usage_count || 0), 0);\n\n    return {\n      total_trend_score: totalTrendScore,\n      total_usage: totalUsage,\n      trending_count: categoryData.length,\n      average_trend_score: totalTrendScore / categoryData.length,\n      average_usage: totalUsage / categoryData.length\n    };\n  } catch (error) {\n    console.error('Failed to calculate category trends:', error);\n    return {};\n  }\n}\n\nasync function getRecentActivity() {\n  try {\n    // Get recent hashtag usage activity\n    const { data: recentUsage, error } = await supabase\n      .from('hashtag_usage')\n      .select('*, hashtag:hashtags(name), user:profiles(username)')\n      .order('created_at', { ascending: false })\n      .limit(20);\n\n    if (error) return [];\n\n    return recentUsage?.map(usage => ({\n      id: usage.id,\n      hashtag_id: usage.hashtag_id,\n      hashtag: {\n        id: usage.hashtag_id,\n        name: usage.hashtag?.name || '',\n        display_name: usage.hashtag?.name || '',\n        usage_count: 0,\n        follower_count: 0,\n        is_trending: false,\n        trend_score: 0,\n        created_at: usage.created_at || new Date().toISOString(),\n        updated_at: usage.created_at || new Date().toISOString(),\n        is_verified: false,\n        is_featured: false\n      },\n      content_type: (usage.content_type as 'poll' | 'comment' | 'profile' | 'feed') || 'poll',\n      content_id: usage.content_id || '',\n      user_id: usage.user_id,\n      created_at: usage.created_at,\n      context: (usage as any).context || undefined,\n      sentiment: ((usage as any).sentiment as 'positive' | 'neutral' | 'negative') || 'neutral',\n      engagement_score: (usage as any).engagement_score || 0\n    })) || [];\n  } catch (error) {\n    console.error('Failed to get recent activity:', error);\n    return [];\n  }\n}\n\n/**\n * Update user preferences\n */\nexport async function updateUserPreferences(preferences: Partial<HashtagUserPreferences>): Promise<HashtagApiResponse<HashtagUserPreferences>> {\n  try {\n    const { data, error } = await (supabase as any)\n      .from('hashtag_user_preferences')\n      .upsert(preferences)\n      .select()\n      .single();\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to update user preferences' \n    };\n  }\n}\n\n/**\n * Get user preferences\n */\nexport async function getUserPreferences(): Promise<HashtagApiResponse<HashtagUserPreferences>> {\n  try {\n    const { data, error } = await (supabase as any)\n      .from('hashtag_user_preferences')\n      .select('*')\n      .single();\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, data };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Failed to get user preferences' \n    };\n  }\n}\n"],"names":["createHashtag","deleteHashtag","followHashtag","getFeedHashtagIntegration","getHashtagAnalytics","getHashtagById","getHashtagByName","getHashtagStats","getHashtagSuggestions","getPollHashtagIntegration","getProfileHashtagIntegration","getTrendingHashtags","getUserHashtags","getUserPreferences","searchHashtags","unfollowHashtag","updateHashtag","updateUserPreferences","validateHashtagName","logger","info","message","context","console","log","error","warn","transformHashtagData","data","description","undefined","category","created_by","follower_count","usage_count","is_featured","is_trending","is_verified","trend_score","created_at","Date","toISOString","updated_at","metadata","supabase","createClient","id","result","from","select","eq","single","success","Error","name","normalizedName","toLowerCase","replace","existing","insert","display_name","updates","update","delete","query","startTime","now","supabaseQuery","or","filters","min_usage_count","gte","created_after","created_before","lte","sortField","sort","order","ascending","limit","offset","range","hashtags","count","map","total_count","suggestions","generateSuggestions","related_queries","generateRelatedQueries","filters_applied","search_time_ms","trendingHashtags","Promise","all","hashtag","growth_rate","calculateGrowthRate","usage_count_24h","calculateUsage24h","usage_count_7d","calculateUsage7d","peak_position","calculatePeakPosition","current_position","calculateCurrentPosition","related_hashtags","calculateRelatedHashtags","trending_since","category_trends","calculateCategoryTrends","input","normalizedInput","reason","determineSuggestionReason","confidence","calculateConfidenceScore","confidence_score","source","hashtagId","user","auth","getUser","user_id","hashtag_id","followed_at","is_primary","currentHashtag","last_used_at","preferences","Math","max","item","period","calculateHashtagAnalytics","analytics","stats","statsResponse","total_hashtags","length","trending_count","filter","s","verified_count","categories","top_hashtags","slice","recent_activity","getRecentActivity","system_health","api_response_time","database_performance","cache_hit_rate","errors","warnings","push","test","_isAvailable","validation","is_valid","normalized_name","availability","is_available","similar_hashtags","conflict_reason","userId","userHashtags","userHashtagsError","preferencesError","tableError","followed_hashtags","hashtag_filters","activity","activityError","integration","primary_hashtags","uh","interest_hashtags","custom_hashtags","getUserCustomHashtags","hashtag_preferences","hashtag_activity","last_updated","pollId","poll","pollError","engagement","engagementError","relatedPolls","relatedError","overlaps","neq","trendingScore","poll_id","primary_hashtag","hashtag_engagement","total_views","hashtag_clicks","e","engagement_type","hashtag_shares","related_polls","p","hashtag_trending_score","feedId","feed","feedError","trendingError","hashtagContent","contentError","personalizedHashtags","personalError","analyticsError","engagement_rate","feed_id","trending_hashtags","h","hashtag_content","hashtag_analytics","personalized_hashtags","includes","normalizedQuery","trim","ilike","relatedQueries","forEach","baseName","variations","variation","Set","sevenDaysAgo","getTime","fourteenDaysAgo","recentUsage","recentError","previousUsage","previousError","lt","recentCount","previousCount","growthRate","round","twentyFourHoursAgo","hashtagName","normalizedHashtag","startsWith","historicalData","position","positions","d","min","currentRanking","findIndex","hashtagError","relatedHashtags","categoryData","totalTrendScore","reduce","sum","totalUsage","total_trend_score","total_usage","average_trend_score","average_usage","usage","content_type","content_id","sentiment","engagement_score","upsert"],"mappings":"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"}
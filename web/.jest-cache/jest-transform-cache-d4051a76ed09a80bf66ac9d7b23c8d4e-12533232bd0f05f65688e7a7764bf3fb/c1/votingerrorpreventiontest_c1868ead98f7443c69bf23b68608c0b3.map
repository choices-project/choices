{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/features/voting/voting-error-prevention.test.ts"],"sourcesContent":["/**\n * Voting Error Prevention Tests\n * \n * Ensures voting components handle errors gracefully and\n * maintain vote integrity across all voting operations.\n * \n * Created: January 27, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect } from '@jest/globals';\nimport * as fs from 'fs';\nimport * as glob from 'glob';\n\ndescribe('Voting Error Prevention', () => {\n  it('voting components should validate input properly', () => {\n    const votingFiles = glob.sync('web/features/voting/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    votingFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for input validation\n      if (content.includes('onVote') || content.includes('submitVote')) {\n        // Should have input validation\n        if (!content.includes('validate') && !content.includes('check')) {\n          problematicFiles.push(`${file}: voting operations should validate input`);\n        }\n      }\n      \n      // Check for form validation\n      if (content.includes('form') && content.includes('submit')) {\n        // Should have form validation\n        if (!content.includes('required') && !content.includes('validation')) {\n          problematicFiles.push(`${file}: forms should have validation`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Voting files with missing input validation:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('vote submission should handle errors gracefully', () => {\n    const votingFiles = glob.sync('web/features/voting/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    votingFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for vote submission\n      if (content.includes('submitVote') || content.includes('onVote')) {\n        // Should have error handling\n        if (!content.includes('try') && !content.includes('catch')) {\n          problematicFiles.push(`${file}: vote submission should have error handling`);\n        }\n      }\n      \n      // Check for async operations\n      if (content.includes('async') && content.includes('vote')) {\n        // Should have error handling\n        if (!content.includes('catch') && !content.includes('error')) {\n          problematicFiles.push(`${file}: async vote operations should have error handling`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Voting files with missing error handling:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('voting state should be properly managed', () => {\n    const votingFiles = glob.sync('web/features/voting/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    votingFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for voting state management\n      if (content.includes('useState') && content.includes('vote')) {\n        // Should have proper state management\n        if (!content.includes('setVote') && !content.includes('setLoading')) {\n          problematicFiles.push(`${file}: voting state not properly managed`);\n        }\n      }\n      \n      // Check for loading states\n      if (content.includes('loading') && content.includes('vote')) {\n        // Should have proper loading state management\n        if (!content.includes('setLoading') && !content.includes('isLoading')) {\n          problematicFiles.push(`${file}: loading state not properly managed`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Voting files with state management issues:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('voting should prevent duplicate submissions', () => {\n    const votingFiles = glob.sync('web/features/voting/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    votingFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for duplicate prevention\n      if (content.includes('submit') && content.includes('vote')) {\n        // Should have duplicate prevention\n        if (!content.includes('disabled') && !content.includes('loading') && !content.includes('submitted')) {\n          problematicFiles.push(`${file}: vote submission should prevent duplicates`);\n        }\n      }\n      \n      // Check for button states\n      if (content.includes('button') && content.includes('submit')) {\n        // Should have proper button state management\n        if (!content.includes('disabled') && !content.includes('loading')) {\n          problematicFiles.push(`${file}: submit buttons should have state management`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Voting files with missing duplicate prevention:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n});\n"],"names":["describe","it","votingFiles","glob","sync","ignore","problematicFiles","forEach","file","content","fs","readFileSync","includes","push","length","logger","info","expect","toHaveLength"],"mappings":"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"}
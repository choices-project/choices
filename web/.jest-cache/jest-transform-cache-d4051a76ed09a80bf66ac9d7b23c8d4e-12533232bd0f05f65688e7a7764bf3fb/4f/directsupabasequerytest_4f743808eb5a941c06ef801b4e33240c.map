{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/direct-supabase-query.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\n\n/**\n * Direct Supabase Query Test\n * \n * Tests direct queries to understand the database structure\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Direct Supabase Query', () => {\n  it('should query polls table with different approaches', async () => {\n    const { createClient } = await import('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n    \n    // Try with anon key first\n    const anonKey = process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    \n    if (!supabaseUrl || !anonKey || !serviceKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    console.log('üîç Testing with anon key...');\n    const anonSupabase = createClient(supabaseUrl, anonKey);\n    \n    const { data: anonData, error: anonError } = await anonSupabase\n      .from('polls')\n      .select('*')\n      .limit(5);\n    \n    console.log('Anon key result:', { anonData, anonError });\n    \n    console.log('üîç Testing with service role key...');\n    const serviceSupabase = createClient(supabaseUrl, serviceKey);\n    \n    const { data: serviceData, error: serviceError } = await serviceSupabase\n      .from('polls')\n      .select('*')\n      .limit(5);\n    \n    console.log('Service key result:', { serviceData, serviceError });\n    \n    // Try to get table info\n    console.log('üîç Getting table information...');\n    const { data: tableInfo, error: tableInfoError } = await serviceSupabase\n      .from('information_schema.tables')\n      .select('table_name')\n      .eq('table_schema', 'public')\n      .eq('table_name', 'polls');\n    \n    console.log('Table info result:', { tableInfo, tableInfoError });\n    \n    // Try to get column info\n    console.log('üîç Getting column information...');\n    const { data: columnInfo, error: columnInfoError } = await serviceSupabase\n      .from('information_schema.columns')\n      .select('column_name, data_type')\n      .eq('table_name', 'polls')\n      .eq('table_schema', 'public');\n    \n    console.log('Column info result:', { columnInfo, columnInfoError });\n    \n    // Try a simple count\n    console.log('üîç Getting count...');\n    const { count, error: countError } = await serviceSupabase\n      .from('polls')\n      .select('*', { count: 'exact', head: true });\n    \n    console.log('Count result:', { count, countError });\n    \n    // Try to insert a simple record\n    console.log('üîç Testing insert...');\n    const testRecord = {\n      title: 'Direct Test Poll',\n      description: 'Testing direct insert',\n      question: 'Does this work?',\n      options: ['Yes', 'No'],\n      voting_method: 'single_choice',\n      status: 'active',\n      created_by: 'direct-test',\n      privacy_level: 'public'\n    };\n    \n    const { data: insertData, error: insertError } = await serviceSupabase\n      .from('polls')\n      .insert(testRecord)\n      .select();\n    \n    console.log('Insert result:', { insertData, insertError });\n    \n    // If insert worked, try to query it back\n    if (!insertError && insertData && insertData.length > 0) {\n      console.log('üîç Querying back inserted record...');\n      const { data: queryBack, error: queryBackError } = await serviceSupabase\n        .from('polls')\n        .select('*')\n        .eq('id', insertData[0].id);\n      \n      console.log('Query back result:', { queryBack, queryBackError });\n      \n      // Clean up\n      const { error: deleteError } = await serviceSupabase\n        .from('polls')\n        .delete()\n        .eq('id', insertData[0].id);\n      \n      console.log('Cleanup result:', { deleteError });\n    }\n    \n    // The test should pass if we can at least connect\n    expect(anonError).toBeNull();\n    expect(serviceError).toBeNull();\n  });\n});\n"],"names":["describe","it","createClient","supabaseUrl","process","env","SUPABASE_URL","NEXT_PUBLIC_SUPABASE_URL","anonKey","SUPABASE_ANON_KEY","NEXT_PUBLIC_SUPABASE_ANON_KEY","serviceKey","SUPABASE_SERVICE_ROLE_KEY","Error","console","log","anonSupabase","data","anonData","error","anonError","from","select","limit","serviceSupabase","serviceData","serviceError","tableInfo","tableInfoError","eq","columnInfo","columnInfoError","count","countError","head","testRecord","title","description","question","options","voting_method","status","created_by","privacy_level","insertData","insertError","insert","length","queryBack","queryBackError","id","deleteError","delete","expect","toBeNull"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/features/voting/MultipleChoiceVoting.test.tsx"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport MultipleChoiceVoting from '@/features/voting/components/MultipleChoiceVoting'\n\n// Mock the SSR-safe utility\njest.mock('@/lib/utils/ssr-safe', () => ({\n  safeWindow: jest.fn(() => null)\n}))\n\nconst mockOptions = [\n  { id: '1', text: 'Option 1', description: 'First option' },\n  { id: '2', text: 'Option 2', description: 'Second option' },\n  { id: '3', text: 'Option 3', description: 'Third option' }\n]\n\nconst defaultProps = {\n  pollId: 'test-poll-123',\n  title: 'Test Multiple Choice Poll',\n  description: 'Choose all options you support',\n  options: mockOptions,\n  onVote: jest.fn(),\n  isVoting: false,\n  hasVoted: false,\n  maxSelections: 2\n}\n\ndescribe('MultipleChoiceVoting', () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n  })\n\n  it('renders poll title and description', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    expect(screen.getByText('Test Multiple Choice Poll')).toBeInTheDocument()\n    expect(screen.getByText('Choose all options you support')).toBeInTheDocument()\n  })\n\n  it('renders all poll options', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    expect(screen.getByText('Option 1')).toBeInTheDocument()\n    expect(screen.getByText('Option 2')).toBeInTheDocument()\n    expect(screen.getByText('Option 3')).toBeInTheDocument()\n  })\n\n  it('allows selecting multiple options', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    const option1 = screen.getByTestId('option-1-checkbox')\n    const option2 = screen.getByTestId('option-2-checkbox')\n    \n    fireEvent.click(option1)\n    fireEvent.click(option2)\n    \n    // Both options should be selected\n    expect(option1).toHaveClass('border-green-500')\n    expect(option2).toHaveClass('border-green-500')\n  })\n\n  it('allows deselecting options', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    const option1 = screen.getByTestId('option-1-checkbox')\n    \n    // Select then deselect\n    fireEvent.click(option1)\n    expect(option1).toHaveClass('border-green-500')\n    \n    fireEvent.click(option1)\n    expect(option1).not.toHaveClass('border-green-500')\n  })\n\n  it('enforces maximum selections limit', () => {\n    render(<MultipleChoiceVoting {...defaultProps} maxSelections={2} />)\n    \n    const option1 = screen.getByTestId('option-1-checkbox')\n    const option2 = screen.getByTestId('option-2-checkbox')\n    const option3 = screen.getByTestId('option-3-checkbox')\n    \n    // Select first two options\n    fireEvent.click(option1)\n    fireEvent.click(option2)\n    \n    // Try to select third option (should be blocked)\n    fireEvent.click(option3)\n    \n    expect(screen.getByText('You can select up to 2 options')).toBeInTheDocument()\n    expect(option3).not.toHaveClass('border-green-500')\n  })\n\n  it('shows selection summary', async () => {\n    render(<MultipleChoiceVoting {...defaultProps} maxSelections={undefined} />)\n    \n    const option1 = screen.getByTestId('option-1-checkbox')\n    const option2 = screen.getByTestId('option-2-checkbox')\n    \n    fireEvent.click(option1)\n    fireEvent.click(option2)\n    \n    // Check that options are selected by verifying the styling\n    expect(option1).toHaveClass('border-green-500')\n    expect(option2).toHaveClass('border-green-500')\n    \n    // Check for selection summary\n    await waitFor(() => {\n      expect(screen.getByText(/Selected 2 options:/)).toBeInTheDocument()\n    })\n  })\n\n  it('submits vote with selected options', async () => {\n    const mockOnVote = jest.fn().mockResolvedValue({ ok: true })\n    render(<MultipleChoiceVoting {...defaultProps} onVote={mockOnVote} />)\n    \n    const option1 = screen.getByTestId('option-1-checkbox')\n    const option2 = screen.getByTestId('option-2-checkbox')\n    const submitButton = screen.getByTestId('submit-vote-button')\n    \n    fireEvent.click(option1)\n    fireEvent.click(option2)\n    fireEvent.click(submitButton)\n    \n    await waitFor(() => {\n      expect(mockOnVote).toHaveBeenCalledWith([0, 1])\n    })\n  })\n\n  it('prevents submission with no selections', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    const submitButton = screen.getByTestId('submit-vote-button')\n    expect(submitButton).toBeDisabled()\n  })\n\n  it('prevents clicking submit button when no selections', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    const submitButton = screen.getByTestId('submit-vote-button')\n    \n    // Button should be disabled when no options are selected\n    expect(submitButton).toBeDisabled()\n    \n    // Select an option\n    const option1 = screen.getByTestId('option-1-checkbox')\n    fireEvent.click(option1)\n    \n    // Button should now be enabled\n    expect(submitButton).not.toBeDisabled()\n    \n    // Deselect the option\n    fireEvent.click(option1)\n    \n    // Button should be disabled again\n    expect(submitButton).toBeDisabled()\n  })\n\n  it('displays voted state correctly', () => {\n    render(<MultipleChoiceVoting {...defaultProps} hasVoted={true} />)\n    \n    expect(screen.getByTestId('vote-confirmation')).toBeInTheDocument()\n    expect(screen.getByText('Vote submitted successfully!')).toBeInTheDocument()\n  })\n\n  it('displays user\\'s previous vote', () => {\n    render(<MultipleChoiceVoting {...defaultProps} userVote={[0, 2]} />)\n    \n    const option1 = screen.getByTestId('option-1-checkbox')\n    const option3 = screen.getByTestId('option-3-checkbox')\n    \n    expect(option1).toHaveClass('border-green-500')\n    expect(option3).toHaveClass('border-green-500')\n  })\n\n  it('shows voting method badge', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    expect(screen.getByText('ðŸŽ¯ Multiple Choice Voting')).toBeInTheDocument()\n    expect(screen.getByText(/Select all options you support/)).toBeInTheDocument()\n  })\n\n  it('shows explanation when info button is clicked', () => {\n    render(<MultipleChoiceVoting {...defaultProps} />)\n    \n    const infoButton = screen.getByText('How it works')\n    fireEvent.click(infoButton)\n    \n    expect(screen.getByText('How Multiple Choice Voting Works')).toBeInTheDocument()\n    expect(screen.getByText('Select multiple options:')).toBeInTheDocument()\n    expect(screen.getByText('Choose all options you support')).toBeInTheDocument()\n  })\n})\n"],"names":["jest","mock","safeWindow","fn","mockOptions","id","text","description","defaultProps","pollId","title","options","onVote","isVoting","hasVoted","maxSelections","describe","beforeEach","clearAllMocks","it","render","MultipleChoiceVoting","expect","screen","getByText","toBeInTheDocument","option1","getByTestId","option2","fireEvent","click","toHaveClass","not","option3","undefined","waitFor","mockOnVote","mockResolvedValue","ok","submitButton","toHaveBeenCalledWith","toBeDisabled","userVote","infoButton"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/i18n/index.ts"],"sourcesContent":["/**\n * @fileoverview Internationalization (i18n) System\n * \n * Multi-language support for the Choices platform.\n * Supports 10 languages with dynamic translation loading.\n * \n * @author Choices Platform Team\n * @created 2025-10-24\n * @version 2.0.0\n * @since 1.0.0\n */\n\nimport { LANGUAGE_OPTIONS } from '../../features/profile/utils/profile-constants';\n\nexport type SupportedLanguage = typeof LANGUAGE_OPTIONS[number]['code'];\n\nexport interface Translation {\n  [key: string]: string | Translation;\n}\n\nexport interface I18nConfig {\n  defaultLanguage: SupportedLanguage;\n  fallbackLanguage: SupportedLanguage;\n  supportedLanguages: SupportedLanguage[];\n  namespace: string;\n}\n\nexport interface I18nState {\n  currentLanguage: SupportedLanguage;\n  translations: Record<SupportedLanguage, Translation>;\n  isLoading: boolean;\n  error: string | null;\n}\n\n// Default configuration\nexport const I18N_CONFIG: I18nConfig = {\n  defaultLanguage: 'en',\n  fallbackLanguage: 'en',\n  supportedLanguages: LANGUAGE_OPTIONS.map(lang => lang.code),\n  namespace: 'common'\n};\n\n// Translation cache\nconst translationCache = new Map<string, Translation>();\n\n// Current language state\nlet currentLanguage: SupportedLanguage = 'en';\nconst translations: Record<SupportedLanguage, Translation> = {} as any;\n\n/**\n * Load translations for a specific language\n */\nexport async function loadTranslations(language: SupportedLanguage): Promise<Translation> {\n  const cacheKey = `${I18N_CONFIG.namespace}-${language}`;\n  \n  // Check cache first\n  if (translationCache.has(cacheKey)) {\n    return translationCache.get(cacheKey)!;\n  }\n\n  try {\n    // Dynamic import of translation files\n    const translationModule = await import(`./locales/${language}.json`);\n    const translation = translationModule.default || translationModule;\n    \n    // Cache the translation\n    translationCache.set(cacheKey, translation);\n    \n    return translation;\n  } catch (error) {\n    console.warn(`Failed to load translations for ${language}:`, error);\n    \n    // Fallback to English if available\n    if (language !== I18N_CONFIG.fallbackLanguage) {\n      return loadTranslations(I18N_CONFIG.fallbackLanguage);\n    }\n    \n    // Return empty translation as last resort\n    return {};\n  }\n}\n\n/**\n * Get translation for a key\n */\nexport function t(key: string, params?: Record<string, string | number>): string {\n  const translation = getTranslation(key, currentLanguage);\n  \n  if (!translation) {\n    console.warn(`Translation missing for key: ${key}`);\n    return key;\n  }\n  \n  // Replace parameters in translation\n  if (params) {\n    return Object.entries(params).reduce((str, [param, value]) => {\n      return str.replace(new RegExp(`{{${param}}}`, 'g'), String(value));\n    }, translation);\n  }\n  \n  return translation;\n}\n\n/**\n * Get translation for a specific language\n */\nexport function getTranslation(key: string, language: SupportedLanguage): string {\n  const translation = translations[language];\n  if (!translation) {\n    return key;\n  }\n  \n  const keys = key.split('.');\n  let value: any = translation;\n  \n  for (const k of keys) {\n    if (value && typeof value === 'object' && k in value) {\n      value = value[k];\n    } else {\n      return key;\n    }\n  }\n  \n  return typeof value === 'string' ? value : key;\n}\n\n/**\n * Set current language\n */\nexport async function setLanguage(language: SupportedLanguage): Promise<void> {\n  if (!I18N_CONFIG.supportedLanguages.includes(language)) {\n    console.warn(`Unsupported language: ${language}`);\n    return;\n  }\n  \n  currentLanguage = language;\n  \n  // Load translations if not already loaded\n  if (!translations[language]) {\n    translations[language] = await loadTranslations(language);\n  }\n  \n  // Update document language\n  if (typeof document !== 'undefined') {\n    document.documentElement.lang = language;\n  }\n}\n\n/**\n * Get current language\n */\nexport function getCurrentLanguage(): SupportedLanguage {\n  return currentLanguage;\n}\n\n/**\n * Get all loaded translations\n */\nexport function getTranslations(): Record<SupportedLanguage, Translation> {\n  return translations;\n}\n\n/**\n * Check if language is supported\n */\nexport function isLanguageSupported(language: string): language is SupportedLanguage {\n  return I18N_CONFIG.supportedLanguages.includes(language as SupportedLanguage);\n}\n\n/**\n * Get language display name\n */\nexport function getLanguageDisplayName(language: SupportedLanguage): string {\n  const langOption = LANGUAGE_OPTIONS.find(lang => lang.code === language);\n  return langOption?.native || (langOption as any)?.name || language;\n}\n\n/**\n * Initialize i18n system\n */\nexport async function initializeI18n(language?: SupportedLanguage): Promise<void> {\n  const targetLanguage = language || I18N_CONFIG.defaultLanguage;\n  \n  try {\n    await setLanguage(targetLanguage);\n  } catch (error) {\n    console.error('Failed to initialize i18n:', error);\n    // Fallback to default language\n    await setLanguage(I18N_CONFIG.defaultLanguage);\n  }\n}\n\n/**\n * Format number according to locale\n */\nexport function formatNumber(value: number, options?: Intl.NumberFormatOptions): string {\n  try {\n    return new Intl.NumberFormat(currentLanguage, options).format(value);\n  } catch (error) {\n    console.warn('Number formatting failed:', error);\n    return String(value);\n  }\n}\n\n/**\n * Format date according to locale\n */\nexport function formatDate(date: Date, options?: Intl.DateTimeFormatOptions): string {\n  try {\n    return new Intl.DateTimeFormat(currentLanguage, options).format(date);\n  } catch (error) {\n    console.warn('Date formatting failed:', error);\n    return date.toLocaleDateString();\n  }\n}\n\n/**\n * Format currency according to locale\n */\nexport function formatCurrency(value: number, currency = 'USD', options?: Intl.NumberFormatOptions): string {\n  try {\n    return new Intl.NumberFormat(currentLanguage, {\n      style: 'currency',\n      currency,\n      ...options\n    }).format(value);\n  } catch (error) {\n    console.warn('Currency formatting failed:', error);\n    return `${currency} ${value}`;\n  }\n}\n\n// Export default instance\nexport default {\n  t,\n  setLanguage,\n  getCurrentLanguage,\n  getTranslations,\n  isLanguageSupported,\n  getLanguageDisplayName,\n  initializeI18n,\n  formatNumber,\n  formatDate,\n  formatCurrency\n};\n"],"names":["I18N_CONFIG","formatCurrency","formatDate","formatNumber","getCurrentLanguage","getLanguageDisplayName","getTranslation","getTranslations","initializeI18n","isLanguageSupported","loadTranslations","setLanguage","t","defaultLanguage","fallbackLanguage","supportedLanguages","LANGUAGE_OPTIONS","map","lang","code","namespace","translationCache","Map","currentLanguage","translations","language","cacheKey","has","get","translationModule","translation","default","set","error","console","warn","key","params","Object","entries","reduce","str","param","value","replace","RegExp","String","keys","split","k","includes","document","documentElement","langOption","find","native","name","targetLanguage","options","Intl","NumberFormat","format","date","DateTimeFormat","toLocaleDateString","currency","style"],"mappings":"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"}
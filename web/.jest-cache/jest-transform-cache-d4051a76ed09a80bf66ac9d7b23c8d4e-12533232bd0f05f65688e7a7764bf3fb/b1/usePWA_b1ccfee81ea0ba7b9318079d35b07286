8fce3719c42a1df4a55f7a986888eac8
/**
 * PWA Hook
 * 
 * Comprehensive hook that provides PWA functionality including
 * installation, offline status, service worker management, and notifications.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "usePWA", {
    enumerable: true,
    get: function() {
        return usePWA;
    }
});
const _react = require("react");
const _featureflags = require("../lib/core/feature-flags");
const _installation = require("../lib/pwa/installation");
const _serviceworker = require("../lib/pwa/service-worker");
const _logger = require("../lib/utils/logger");
function usePWA() {
    const [status, setStatus] = (0, _react.useState)({
        isSupported: typeof window !== 'undefined' ? 'serviceWorker' in navigator && 'PushManager' in window : false,
        isEnabled: (0, _featureflags.isFeatureEnabled)('PWA'),
        installation: {
            isInstallable: false,
            isInstalled: false,
            canPrompt: false,
            platform: null,
            deferredPrompt: null
        },
        serviceWorker: {
            isSupported: typeof window !== 'undefined' ? 'serviceWorker' in navigator : false,
            isRegistered: false,
            isActive: false,
            isInstalling: false,
            isWaiting: false
        },
        isOnline: typeof window !== 'undefined' ? navigator.onLine : true,
        offlineVotes: 0,
        hasOfflineData: false,
        notificationsSupported: typeof window !== 'undefined' ? 'Notification' in window : false,
        notificationsEnabled: false,
        notificationsPermission: 'default',
        loading: true,
        error: null
    });
    // Initialize PWA
    const initializePWA = (0, _react.useCallback)(async ()=>{
        try {
            _logger.logger.info('usePWA: Starting initialization...');
            setStatus((prev)=>({
                    ...prev,
                    loading: true,
                    error: null
                }));
            // Check if PWA feature is enabled
            const pwaEnabled = (0, _featureflags.isFeatureEnabled)('PWA');
            _logger.logger.info('usePWA: PWA feature enabled:', {
                enabled: pwaEnabled
            });
            if (!pwaEnabled) {
                _logger.logger.info('usePWA: PWA feature is disabled, setting status');
                setStatus((prev)=>({
                        ...prev,
                        isEnabled: false,
                        loading: false,
                        error: 'PWA feature is disabled'
                    }));
                return;
            }
            // Check basic support
            const isSupported = 'serviceWorker' in navigator && 'PushManager' in window;
            _logger.logger.info('usePWA: PWA support check:', {
                serviceWorker: 'serviceWorker' in navigator,
                pushManager: 'PushManager' in window,
                isSupported
            });
            // Get installation status
            const installationStatus = _installation.pwaInstallationManager.getStatus();
            // Register service worker if not already registered
            const serviceWorkerStatus = await _serviceworker.serviceWorkerManager.register();
            // Check notification permission
            const notificationsPermission = 'Notification' in window ? Notification.permission : 'denied';
            // Get offline data status
            const offlineVotes = await getOfflineVotesCount();
            const finalStatus = {
                isSupported,
                isEnabled: pwaEnabled,
                installation: installationStatus,
                serviceWorker: serviceWorkerStatus,
                notificationsPermission,
                notificationsEnabled: notificationsPermission === 'granted',
                offlineVotes,
                hasOfflineData: offlineVotes > 0,
                loading: false,
                error: null
            };
            _logger.logger.info('usePWA: Setting final status:', finalStatus);
            setStatus((prev)=>({
                    ...prev,
                    ...finalStatus
                }));
        } catch (error) {
            _logger.logger.error('PWA: Initialization failed:', error instanceof Error ? error : new Error('Unknown error'));
            setStatus((prev)=>({
                    ...prev,
                    loading: false,
                    error: error instanceof Error ? error.message : 'Unknown error'
                }));
        }
    }, []);
    // Prompt installation
    const promptInstallation = (0, _react.useCallback)(async ()=>{
        try {
            const result = await _installation.pwaInstallationManager.promptInstallation();
            // Update status after installation attempt
            const installationStatus = _installation.pwaInstallationManager.getStatus();
            setStatus((prev)=>({
                    ...prev,
                    installation: installationStatus
                }));
            return result;
        } catch (error) {
            _logger.logger.error('PWA: Installation prompt failed:', error instanceof Error ? error : new Error('Unknown error'));
            return {
                success: false,
                outcome: 'error',
                error: error instanceof Error ? error.message : 'Unknown error'
            };
        }
    }, []);
    // Check for service worker updates
    const checkForUpdates = (0, _react.useCallback)(async ()=>{
        try {
            const hasUpdate = await _serviceworker.serviceWorkerManager.checkForUpdates();
            // Update service worker status
            const serviceWorkerStatus = await _serviceworker.serviceWorkerManager.getStatus();
            setStatus((prev)=>({
                    ...prev,
                    serviceWorker: serviceWorkerStatus
                }));
            return hasUpdate;
        } catch (error) {
            _logger.logger.error('PWA: Failed to check for updates:', error instanceof Error ? error : new Error('Unknown error'));
            return false;
        }
    }, []);
    // Skip waiting for service worker
    const skipWaiting = (0, _react.useCallback)(async ()=>{
        try {
            await _serviceworker.serviceWorkerManager.skipWaiting();
        } catch (error) {
            _logger.logger.error('PWA: Failed to skip waiting:', error instanceof Error ? error : new Error('Unknown error'));
            throw error;
        }
    }, []);
    // Sync offline data
    const syncOfflineData = (0, _react.useCallback)(async ()=>{
        try {
            _logger.logger.info('PWA: Syncing offline data...');
            // Update offline data count
            const offlineVotes = await getOfflineVotesCount();
            setStatus((prev)=>({
                    ...prev,
                    offlineVotes,
                    hasOfflineData: offlineVotes > 0
                }));
        } catch (error) {
            _logger.logger.error('PWA: Failed to sync offline data:', error instanceof Error ? error : new Error('Unknown error'));
            throw error;
        }
    }, []);
    // Clear offline data
    const clearOfflineData = (0, _react.useCallback)(async ()=>{
        try {
            _logger.logger.info('PWA: Clearing offline data...');
            setStatus((prev)=>({
                    ...prev,
                    offlineVotes: 0,
                    hasOfflineData: false
                }));
        } catch (error) {
            _logger.logger.error('PWA: Failed to clear offline data:', error instanceof Error ? error : new Error('Unknown error'));
            throw error;
        }
    }, []);
    // Request notification permission
    const requestNotificationPermission = (0, _react.useCallback)(async ()=>{
        try {
            if (!('Notification' in window)) {
                return false;
            }
            const permission = await Notification.requestPermission();
            const enabled = permission === 'granted';
            setStatus((prev)=>({
                    ...prev,
                    notificationsPermission: permission,
                    notificationsEnabled: enabled
                }));
            return enabled;
        } catch (error) {
            _logger.logger.error('PWA: Failed to request notification permission:', error instanceof Error ? error : new Error('Unknown error'));
            return false;
        }
    }, []);
    // Subscribe to notifications
    const subscribeToNotifications = (0, _react.useCallback)(async ()=>{
        try {
            if (!status.notificationsEnabled) {
                const enabled = await requestNotificationPermission();
                if (!enabled) {
                    return false;
                }
            }
            _logger.logger.info('PWA: Subscribing to notifications...');
            return true;
        } catch (error) {
            _logger.logger.error('PWA: Failed to subscribe to notifications:', error instanceof Error ? error : new Error('Unknown error'));
            return false;
        }
    }, [
        status.notificationsEnabled,
        requestNotificationPermission
    ]);
    // Unsubscribe from notifications
    const unsubscribeFromNotifications = (0, _react.useCallback)(async ()=>{
        try {
            // This would typically unsubscribe from push notifications
            _logger.logger.info('PWA: Unsubscribing from notifications...');
            setStatus((prev)=>({
                    ...prev,
                    notificationsEnabled: false
                }));
            return true;
        } catch (error) {
            _logger.logger.error('PWA: Failed to unsubscribe from notifications:', error instanceof Error ? error : new Error('Unknown error'));
            return false;
        }
    }, []);
    // Refresh PWA status
    const refresh = (0, _react.useCallback)(async ()=>{
        await initializePWA();
    }, [
        initializePWA
    ]);
    // Initialize on mount
    (0, _react.useEffect)(()=>{
        initializePWA();
    }, [
        initializePWA
    ]);
    // Set up event listeners
    (0, _react.useEffect)(()=>{
        // Online/offline status
        const handleOnline = ()=>{
            setStatus((prev)=>({
                    ...prev,
                    isOnline: true
                }));
            // Auto-sync when coming back online
            syncOfflineData().catch((error)=>{
                _logger.logger.error('PWA: Auto-sync failed:', error instanceof Error ? error : new Error('Unknown error'));
            });
        };
        const handleOffline = ()=>{
            setStatus((prev)=>({
                    ...prev,
                    isOnline: false
                }));
        };
        // Installation status changes
        const unsubscribeInstallation = _installation.pwaInstallationManager.subscribe((installationStatus)=>{
            setStatus((prev)=>({
                    ...prev,
                    installation: installationStatus
                }));
        });
        // Service worker status changes
        const unsubscribeServiceWorker = _serviceworker.serviceWorkerManager.subscribe((serviceWorkerStatus)=>{
            setStatus((prev)=>({
                    ...prev,
                    serviceWorker: serviceWorkerStatus
                }));
        });
        // Add event listeners (only on client side)
        if (typeof window !== 'undefined') {
            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);
        }
        // Cleanup
        return ()=>{
            if (typeof window !== 'undefined') {
                window.removeEventListener('online', handleOnline);
                window.removeEventListener('offline', handleOffline);
            }
            unsubscribeInstallation();
            unsubscribeServiceWorker();
        };
    }, [
        syncOfflineData
    ]);
    return Object.assign({}, status, {
        promptInstallation,
        checkForUpdates,
        skipWaiting,
        syncOfflineData,
        clearOfflineData,
        requestNotificationPermission,
        subscribeToNotifications,
        unsubscribeFromNotifications,
        refresh
    });
}
/**
 * Get offline votes count
 */ async function getOfflineVotesCount() {
    try {
        // This would typically read from IndexedDB or localStorage
        // For now, return 0
        return 0;
    } catch (error) {
        _logger.logger.error('PWA: Failed to get offline votes count:', error instanceof Error ? error : new Error('Unknown error'));
        return 0;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9ob29rcy91c2VQV0EudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQV0EgSG9va1xuICogXG4gKiBDb21wcmVoZW5zaXZlIGhvb2sgdGhhdCBwcm92aWRlcyBQV0EgZnVuY3Rpb25hbGl0eSBpbmNsdWRpbmdcbiAqIGluc3RhbGxhdGlvbiwgb2ZmbGluZSBzdGF0dXMsIHNlcnZpY2Ugd29ya2VyIG1hbmFnZW1lbnQsIGFuZCBub3RpZmljYXRpb25zLlxuICovXG5cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBpc0ZlYXR1cmVFbmFibGVkIH0gZnJvbSAnQC9saWIvY29yZS9mZWF0dXJlLWZsYWdzJztcbmltcG9ydCB7IFxuICBwd2FJbnN0YWxsYXRpb25NYW5hZ2VyLCBcbiAgdHlwZSBJbnN0YWxsYXRpb25TdGF0dXMsIFxuICB0eXBlIEluc3RhbGxhdGlvblJlc3VsdCBcbn0gZnJvbSAnQC9saWIvcHdhL2luc3RhbGxhdGlvbic7XG5pbXBvcnQgeyBcbiAgc2VydmljZVdvcmtlck1hbmFnZXIsIFxuICB0eXBlIFNlcnZpY2VXb3JrZXJTdGF0dXMgXG59IGZyb20gJ0AvbGliL3B3YS9zZXJ2aWNlLXdvcmtlcic7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL2xpYi91dGlscy9sb2dnZXInO1xuXG4vLyBJbXBvcnQgUFdBIG1hbmFnZXJzXG5cbmV4cG9ydCBpbnRlcmZhY2UgUFdBU3RhdHVzIHtcbiAgLy8gRmVhdHVyZSBhdmFpbGFiaWxpdHlcbiAgaXNTdXBwb3J0ZWQ6IGJvb2xlYW47XG4gIGlzRW5hYmxlZDogYm9vbGVhbjtcbiAgXG4gIC8vIEluc3RhbGxhdGlvblxuICBpbnN0YWxsYXRpb246IEluc3RhbGxhdGlvblN0YXR1cztcbiAgXG4gIC8vIFNlcnZpY2UgV29ya2VyXG4gIHNlcnZpY2VXb3JrZXI6IFNlcnZpY2VXb3JrZXJTdGF0dXM7XG4gIFxuICAvLyBDb25uZWN0aW9uXG4gIGlzT25saW5lOiBib29sZWFuO1xuICBcbiAgLy8gT2ZmbGluZSBkYXRhXG4gIG9mZmxpbmVWb3RlczogbnVtYmVyO1xuICBoYXNPZmZsaW5lRGF0YTogYm9vbGVhbjtcbiAgXG4gIC8vIE5vdGlmaWNhdGlvbnNcbiAgbm90aWZpY2F0aW9uc1N1cHBvcnRlZDogYm9vbGVhbjtcbiAgbm90aWZpY2F0aW9uc0VuYWJsZWQ6IGJvb2xlYW47XG4gIG5vdGlmaWNhdGlvbnNQZXJtaXNzaW9uOiBOb3RpZmljYXRpb25QZXJtaXNzaW9uO1xuICBcbiAgLy8gTG9hZGluZyBzdGF0ZXNcbiAgbG9hZGluZzogYm9vbGVhbjtcbiAgZXJyb3I6IHN0cmluZyB8IG51bGw7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUFdBQWN0aW9ucyB7XG4gIC8vIEluc3RhbGxhdGlvblxuICBwcm9tcHRJbnN0YWxsYXRpb246ICgpID0+IFByb21pc2U8SW5zdGFsbGF0aW9uUmVzdWx0PjtcbiAgXG4gIC8vIFNlcnZpY2UgV29ya2VyXG4gIGNoZWNrRm9yVXBkYXRlczogKCkgPT4gUHJvbWlzZTxib29sZWFuPjtcbiAgc2tpcFdhaXRpbmc6ICgpID0+IFByb21pc2U8dm9pZD47XG4gIFxuICAvLyBPZmZsaW5lXG4gIHN5bmNPZmZsaW5lRGF0YTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgY2xlYXJPZmZsaW5lRGF0YTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgXG4gIC8vIE5vdGlmaWNhdGlvbnNcbiAgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb246ICgpID0+IFByb21pc2U8Ym9vbGVhbj47XG4gIHN1YnNjcmliZVRvTm90aWZpY2F0aW9uczogKCkgPT4gUHJvbWlzZTxib29sZWFuPjtcbiAgdW5zdWJzY3JpYmVGcm9tTm90aWZpY2F0aW9uczogKCkgPT4gUHJvbWlzZTxib29sZWFuPjtcbiAgXG4gIC8vIFV0aWxpdHlcbiAgcmVmcmVzaDogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZVBXQSgpOiBQV0FTdGF0dXMgJiBQV0FBY3Rpb25zIHtcbiAgY29uc3QgW3N0YXR1cywgc2V0U3RhdHVzXSA9IHVzZVN0YXRlPFBXQVN0YXR1cz4oe1xuICAgIGlzU3VwcG9ydGVkOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/ICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yICYmICdQdXNoTWFuYWdlcicgaW4gd2luZG93KSA6IGZhbHNlLFxuICAgIGlzRW5hYmxlZDogaXNGZWF0dXJlRW5hYmxlZCgnUFdBJyksXG4gICAgaW5zdGFsbGF0aW9uOiB7XG4gICAgICBpc0luc3RhbGxhYmxlOiBmYWxzZSxcbiAgICAgIGlzSW5zdGFsbGVkOiBmYWxzZSxcbiAgICAgIGNhblByb21wdDogZmFsc2UsXG4gICAgICBwbGF0Zm9ybTogbnVsbCxcbiAgICAgIGRlZmVycmVkUHJvbXB0OiBudWxsXG4gICAgfSxcbiAgICBzZXJ2aWNlV29ya2VyOiB7XG4gICAgICBpc1N1cHBvcnRlZDogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyAnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yIDogZmFsc2UsXG4gICAgICBpc1JlZ2lzdGVyZWQ6IGZhbHNlLFxuICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgaXNJbnN0YWxsaW5nOiBmYWxzZSxcbiAgICAgIGlzV2FpdGluZzogZmFsc2VcbiAgICB9LFxuICAgIGlzT25saW5lOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IG5hdmlnYXRvci5vbkxpbmUgOiB0cnVlLFxuICAgIG9mZmxpbmVWb3RlczogMCxcbiAgICBoYXNPZmZsaW5lRGF0YTogZmFsc2UsXG4gICAgbm90aWZpY2F0aW9uc1N1cHBvcnRlZDogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyAnTm90aWZpY2F0aW9uJyBpbiB3aW5kb3cgOiBmYWxzZSxcbiAgICBub3RpZmljYXRpb25zRW5hYmxlZDogZmFsc2UsXG4gICAgbm90aWZpY2F0aW9uc1Blcm1pc3Npb246ICdkZWZhdWx0JyxcbiAgICBsb2FkaW5nOiB0cnVlLFxuICAgIGVycm9yOiBudWxsXG4gIH0pO1xuXG4gIC8vIEluaXRpYWxpemUgUFdBXG4gIGNvbnN0IGluaXRpYWxpemVQV0EgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5pbmZvKCd1c2VQV0E6IFN0YXJ0aW5nIGluaXRpYWxpemF0aW9uLi4uJyk7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiAoeyAuLi5wcmV2LCBsb2FkaW5nOiB0cnVlLCBlcnJvcjogbnVsbCB9KSk7XG5cbiAgICAgIC8vIENoZWNrIGlmIFBXQSBmZWF0dXJlIGlzIGVuYWJsZWRcbiAgICAgIGNvbnN0IHB3YUVuYWJsZWQgPSBpc0ZlYXR1cmVFbmFibGVkKCdQV0EnKTtcbiAgICAgIGxvZ2dlci5pbmZvKCd1c2VQV0E6IFBXQSBmZWF0dXJlIGVuYWJsZWQ6JywgeyBlbmFibGVkOiBwd2FFbmFibGVkIH0pO1xuICAgICAgaWYgKCFwd2FFbmFibGVkKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCd1c2VQV0E6IFBXQSBmZWF0dXJlIGlzIGRpc2FibGVkLCBzZXR0aW5nIHN0YXR1cycpO1xuICAgICAgICBzZXRTdGF0dXMocHJldiA9PiAoe1xuICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgaXNFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1BXQSBmZWF0dXJlIGlzIGRpc2FibGVkJ1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgYmFzaWMgc3VwcG9ydFxuICAgICAgY29uc3QgaXNTdXBwb3J0ZWQgPSAnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yICYmICdQdXNoTWFuYWdlcicgaW4gd2luZG93O1xuICAgICAgbG9nZ2VyLmluZm8oJ3VzZVBXQTogUFdBIHN1cHBvcnQgY2hlY2s6Jywge1xuICAgICAgICBzZXJ2aWNlV29ya2VyOiAnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yLFxuICAgICAgICBwdXNoTWFuYWdlcjogJ1B1c2hNYW5hZ2VyJyBpbiB3aW5kb3csXG4gICAgICAgIGlzU3VwcG9ydGVkXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gR2V0IGluc3RhbGxhdGlvbiBzdGF0dXNcbiAgICAgIGNvbnN0IGluc3RhbGxhdGlvblN0YXR1cyA9IHB3YUluc3RhbGxhdGlvbk1hbmFnZXIuZ2V0U3RhdHVzKCk7XG4gICAgICBcbiAgICAgIC8vIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyIGlmIG5vdCBhbHJlYWR5IHJlZ2lzdGVyZWRcbiAgICAgIGNvbnN0IHNlcnZpY2VXb3JrZXJTdGF0dXMgPSBhd2FpdCBzZXJ2aWNlV29ya2VyTWFuYWdlci5yZWdpc3RlcigpO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBub3RpZmljYXRpb24gcGVybWlzc2lvblxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uc1Blcm1pc3Npb24gPSAnTm90aWZpY2F0aW9uJyBpbiB3aW5kb3cgXG4gICAgICAgID8gTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gXG4gICAgICAgIDogJ2RlbmllZCc7XG4gICAgICBcbiAgICAgIC8vIEdldCBvZmZsaW5lIGRhdGEgc3RhdHVzXG4gICAgICBjb25zdCBvZmZsaW5lVm90ZXMgPSBhd2FpdCBnZXRPZmZsaW5lVm90ZXNDb3VudCgpO1xuICAgICAgXG4gICAgICBjb25zdCBmaW5hbFN0YXR1cyA9IHtcbiAgICAgICAgaXNTdXBwb3J0ZWQsXG4gICAgICAgIGlzRW5hYmxlZDogcHdhRW5hYmxlZCxcbiAgICAgICAgaW5zdGFsbGF0aW9uOiBpbnN0YWxsYXRpb25TdGF0dXMsXG4gICAgICAgIHNlcnZpY2VXb3JrZXI6IHNlcnZpY2VXb3JrZXJTdGF0dXMsXG4gICAgICAgIG5vdGlmaWNhdGlvbnNQZXJtaXNzaW9uLFxuICAgICAgICBub3RpZmljYXRpb25zRW5hYmxlZDogbm90aWZpY2F0aW9uc1Blcm1pc3Npb24gPT09ICdncmFudGVkJyxcbiAgICAgICAgb2ZmbGluZVZvdGVzLFxuICAgICAgICBoYXNPZmZsaW5lRGF0YTogb2ZmbGluZVZvdGVzID4gMCxcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgIGVycm9yOiBudWxsXG4gICAgICB9O1xuICAgICAgXG4gICAgICBsb2dnZXIuaW5mbygndXNlUFdBOiBTZXR0aW5nIGZpbmFsIHN0YXR1czonLCBmaW5hbFN0YXR1cyk7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiAoeyAuLi5wcmV2LCAuLi5maW5hbFN0YXR1cyB9KSk7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEluaXRpYWxpemF0aW9uIGZhaWxlZDonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiAoe1xuICAgICAgICAuLi5wcmV2LFxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICB9KSk7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgLy8gUHJvbXB0IGluc3RhbGxhdGlvblxuICBjb25zdCBwcm9tcHRJbnN0YWxsYXRpb24gPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTxJbnN0YWxsYXRpb25SZXN1bHQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHdhSW5zdGFsbGF0aW9uTWFuYWdlci5wcm9tcHRJbnN0YWxsYXRpb24oKTtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIHN0YXR1cyBhZnRlciBpbnN0YWxsYXRpb24gYXR0ZW1wdFxuICAgICAgY29uc3QgaW5zdGFsbGF0aW9uU3RhdHVzID0gcHdhSW5zdGFsbGF0aW9uTWFuYWdlci5nZXRTdGF0dXMoKTtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIGluc3RhbGxhdGlvbjogaW5zdGFsbGF0aW9uU3RhdHVzXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUFdBOiBJbnN0YWxsYXRpb24gcHJvbXB0IGZhaWxlZDonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgb3V0Y29tZTogJ2Vycm9yJyxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICB9O1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIC8vIENoZWNrIGZvciBzZXJ2aWNlIHdvcmtlciB1cGRhdGVzXG4gIGNvbnN0IGNoZWNrRm9yVXBkYXRlcyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGFzVXBkYXRlID0gYXdhaXQgc2VydmljZVdvcmtlck1hbmFnZXIuY2hlY2tGb3JVcGRhdGVzKCk7XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBzZXJ2aWNlIHdvcmtlciBzdGF0dXNcbiAgICAgIGNvbnN0IHNlcnZpY2VXb3JrZXJTdGF0dXMgPSBhd2FpdCBzZXJ2aWNlV29ya2VyTWFuYWdlci5nZXRTdGF0dXMoKTtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIHNlcnZpY2VXb3JrZXI6IHNlcnZpY2VXb3JrZXJTdGF0dXNcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGhhc1VwZGF0ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byBjaGVjayBmb3IgdXBkYXRlczonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgLy8gU2tpcCB3YWl0aW5nIGZvciBzZXJ2aWNlIHdvcmtlclxuICBjb25zdCBza2lwV2FpdGluZyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc2VydmljZVdvcmtlck1hbmFnZXIuc2tpcFdhaXRpbmcoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byBza2lwIHdhaXRpbmc6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgLy8gU3luYyBvZmZsaW5lIGRhdGFcbiAgY29uc3Qgc3luY09mZmxpbmVEYXRhID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuaW5mbygnUFdBOiBTeW5jaW5nIG9mZmxpbmUgZGF0YS4uLicpO1xuICAgICAgXG4gICAgICAvLyBVcGRhdGUgb2ZmbGluZSBkYXRhIGNvdW50XG4gICAgICBjb25zdCBvZmZsaW5lVm90ZXMgPSBhd2FpdCBnZXRPZmZsaW5lVm90ZXNDb3VudCgpO1xuICAgICAgc2V0U3RhdHVzKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgb2ZmbGluZVZvdGVzLFxuICAgICAgICBoYXNPZmZsaW5lRGF0YTogb2ZmbGluZVZvdGVzID4gMFxuICAgICAgfSkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1BXQTogRmFpbGVkIHRvIHN5bmMgb2ZmbGluZSBkYXRhOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcignVW5rbm93biBlcnJvcicpKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIC8vIENsZWFyIG9mZmxpbmUgZGF0YVxuICBjb25zdCBjbGVhck9mZmxpbmVEYXRhID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuaW5mbygnUFdBOiBDbGVhcmluZyBvZmZsaW5lIGRhdGEuLi4nKTtcbiAgICAgIFxuICAgICAgc2V0U3RhdHVzKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgb2ZmbGluZVZvdGVzOiAwLFxuICAgICAgICBoYXNPZmZsaW5lRGF0YTogZmFsc2VcbiAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byBjbGVhciBvZmZsaW5lIGRhdGE6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgLy8gUmVxdWVzdCBub3RpZmljYXRpb24gcGVybWlzc2lvblxuICBjb25zdCByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbiA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKCEoJ05vdGlmaWNhdGlvbicgaW4gd2luZG93KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24oKTtcbiAgICAgIGNvbnN0IGVuYWJsZWQgPSBwZXJtaXNzaW9uID09PSAnZ3JhbnRlZCc7XG4gICAgICBcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIG5vdGlmaWNhdGlvbnNQZXJtaXNzaW9uOiBwZXJtaXNzaW9uLFxuICAgICAgICBub3RpZmljYXRpb25zRW5hYmxlZDogZW5hYmxlZFxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICByZXR1cm4gZW5hYmxlZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byByZXF1ZXN0IG5vdGlmaWNhdGlvbiBwZXJtaXNzaW9uOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcignVW5rbm93biBlcnJvcicpKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sIFtdKTtcblxuICAvLyBTdWJzY3JpYmUgdG8gbm90aWZpY2F0aW9uc1xuICBjb25zdCBzdWJzY3JpYmVUb05vdGlmaWNhdGlvbnMgPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghc3RhdHVzLm5vdGlmaWNhdGlvbnNFbmFibGVkKSB7XG4gICAgICAgIGNvbnN0IGVuYWJsZWQgPSBhd2FpdCByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbigpO1xuICAgICAgICBpZiAoIWVuYWJsZWQpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbG9nZ2VyLmluZm8oJ1BXQTogU3Vic2NyaWJpbmcgdG8gbm90aWZpY2F0aW9ucy4uLicpO1xuICAgICAgXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byBzdWJzY3JpYmUgdG8gbm90aWZpY2F0aW9uczonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LCBbc3RhdHVzLm5vdGlmaWNhdGlvbnNFbmFibGVkLCByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbl0pO1xuXG4gIC8vIFVuc3Vic2NyaWJlIGZyb20gbm90aWZpY2F0aW9uc1xuICBjb25zdCB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUaGlzIHdvdWxkIHR5cGljYWxseSB1bnN1YnNjcmliZSBmcm9tIHB1c2ggbm90aWZpY2F0aW9uc1xuICAgICAgbG9nZ2VyLmluZm8oJ1BXQTogVW5zdWJzY3JpYmluZyBmcm9tIG5vdGlmaWNhdGlvbnMuLi4nKTtcbiAgICAgIFxuICAgICAgc2V0U3RhdHVzKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgbm90aWZpY2F0aW9uc0VuYWJsZWQ6IGZhbHNlXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1BXQTogRmFpbGVkIHRvIHVuc3Vic2NyaWJlIGZyb20gbm90aWZpY2F0aW9uczonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgLy8gUmVmcmVzaCBQV0Egc3RhdHVzXG4gIGNvbnN0IHJlZnJlc2ggPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgYXdhaXQgaW5pdGlhbGl6ZVBXQSgpO1xuICB9LCBbaW5pdGlhbGl6ZVBXQV0pO1xuXG4gIC8vIEluaXRpYWxpemUgb24gbW91bnRcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpbml0aWFsaXplUFdBKCk7XG4gIH0sIFtpbml0aWFsaXplUFdBXSk7XG5cbiAgLy8gU2V0IHVwIGV2ZW50IGxpc3RlbmVyc1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIC8vIE9ubGluZS9vZmZsaW5lIHN0YXR1c1xuICAgIGNvbnN0IGhhbmRsZU9ubGluZSA9ICgpID0+IHtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+ICh7IC4uLnByZXYsIGlzT25saW5lOiB0cnVlIH0pKTtcbiAgICAgIC8vIEF1dG8tc3luYyB3aGVuIGNvbWluZyBiYWNrIG9ubGluZVxuICAgICAgc3luY09mZmxpbmVEYXRhKCkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ1BXQTogQXV0by1zeW5jIGZhaWxlZDonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgY29uc3QgaGFuZGxlT2ZmbGluZSA9ICgpID0+IHtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+ICh7IC4uLnByZXYsIGlzT25saW5lOiBmYWxzZSB9KSk7XG4gICAgfTtcblxuICAgIC8vIEluc3RhbGxhdGlvbiBzdGF0dXMgY2hhbmdlc1xuICAgIGNvbnN0IHVuc3Vic2NyaWJlSW5zdGFsbGF0aW9uID0gcHdhSW5zdGFsbGF0aW9uTWFuYWdlci5zdWJzY3JpYmUoKGluc3RhbGxhdGlvblN0YXR1cykgPT4ge1xuICAgICAgc2V0U3RhdHVzKHByZXYgPT4gKHsgLi4ucHJldiwgaW5zdGFsbGF0aW9uOiBpbnN0YWxsYXRpb25TdGF0dXMgfSkpO1xuICAgIH0pO1xuXG4gICAgLy8gU2VydmljZSB3b3JrZXIgc3RhdHVzIGNoYW5nZXNcbiAgICBjb25zdCB1bnN1YnNjcmliZVNlcnZpY2VXb3JrZXIgPSBzZXJ2aWNlV29ya2VyTWFuYWdlci5zdWJzY3JpYmUoKHNlcnZpY2VXb3JrZXJTdGF0dXMpID0+IHtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+ICh7IC4uLnByZXYsIHNlcnZpY2VXb3JrZXI6IHNlcnZpY2VXb3JrZXJTdGF0dXMgfSkpO1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycyAob25seSBvbiBjbGllbnQgc2lkZSlcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBoYW5kbGVPbmxpbmUpO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCBoYW5kbGVPZmZsaW5lKTtcbiAgICB9XG5cbiAgICAvLyBDbGVhbnVwXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb25saW5lJywgaGFuZGxlT25saW5lKTtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCBoYW5kbGVPZmZsaW5lKTtcbiAgICAgIH1cbiAgICAgIHVuc3Vic2NyaWJlSW5zdGFsbGF0aW9uKCk7XG4gICAgICB1bnN1YnNjcmliZVNlcnZpY2VXb3JrZXIoKTtcbiAgICB9O1xuICB9LCBbc3luY09mZmxpbmVEYXRhXSk7XG5cbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0YXR1cywge1xuICAgIHByb21wdEluc3RhbGxhdGlvbixcbiAgICBjaGVja0ZvclVwZGF0ZXMsXG4gICAgc2tpcFdhaXRpbmcsXG4gICAgc3luY09mZmxpbmVEYXRhLFxuICAgIGNsZWFyT2ZmbGluZURhdGEsXG4gICAgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb24sXG4gICAgc3Vic2NyaWJlVG9Ob3RpZmljYXRpb25zLFxuICAgIHVuc3Vic2NyaWJlRnJvbU5vdGlmaWNhdGlvbnMsXG4gICAgcmVmcmVzaFxuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgb2ZmbGluZSB2b3RlcyBjb3VudFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRPZmZsaW5lVm90ZXNDb3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICB0cnkge1xuICAgIC8vIFRoaXMgd291bGQgdHlwaWNhbGx5IHJlYWQgZnJvbSBJbmRleGVkREIgb3IgbG9jYWxTdG9yYWdlXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIDBcbiAgICByZXR1cm4gMDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ1BXQTogRmFpbGVkIHRvIGdldCBvZmZsaW5lIHZvdGVzIGNvdW50OicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcignVW5rbm93biBlcnJvcicpKTtcbiAgICByZXR1cm4gMDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInVzZVBXQSIsInN0YXR1cyIsInNldFN0YXR1cyIsInVzZVN0YXRlIiwiaXNTdXBwb3J0ZWQiLCJ3aW5kb3ciLCJuYXZpZ2F0b3IiLCJpc0VuYWJsZWQiLCJpc0ZlYXR1cmVFbmFibGVkIiwiaW5zdGFsbGF0aW9uIiwiaXNJbnN0YWxsYWJsZSIsImlzSW5zdGFsbGVkIiwiY2FuUHJvbXB0IiwicGxhdGZvcm0iLCJkZWZlcnJlZFByb21wdCIsInNlcnZpY2VXb3JrZXIiLCJpc1JlZ2lzdGVyZWQiLCJpc0FjdGl2ZSIsImlzSW5zdGFsbGluZyIsImlzV2FpdGluZyIsImlzT25saW5lIiwib25MaW5lIiwib2ZmbGluZVZvdGVzIiwiaGFzT2ZmbGluZURhdGEiLCJub3RpZmljYXRpb25zU3VwcG9ydGVkIiwibm90aWZpY2F0aW9uc0VuYWJsZWQiLCJub3RpZmljYXRpb25zUGVybWlzc2lvbiIsImxvYWRpbmciLCJlcnJvciIsImluaXRpYWxpemVQV0EiLCJ1c2VDYWxsYmFjayIsImxvZ2dlciIsImluZm8iLCJwcmV2IiwicHdhRW5hYmxlZCIsImVuYWJsZWQiLCJwdXNoTWFuYWdlciIsImluc3RhbGxhdGlvblN0YXR1cyIsInB3YUluc3RhbGxhdGlvbk1hbmFnZXIiLCJnZXRTdGF0dXMiLCJzZXJ2aWNlV29ya2VyU3RhdHVzIiwic2VydmljZVdvcmtlck1hbmFnZXIiLCJyZWdpc3RlciIsIk5vdGlmaWNhdGlvbiIsInBlcm1pc3Npb24iLCJnZXRPZmZsaW5lVm90ZXNDb3VudCIsImZpbmFsU3RhdHVzIiwiRXJyb3IiLCJtZXNzYWdlIiwicHJvbXB0SW5zdGFsbGF0aW9uIiwicmVzdWx0Iiwic3VjY2VzcyIsIm91dGNvbWUiLCJjaGVja0ZvclVwZGF0ZXMiLCJoYXNVcGRhdGUiLCJza2lwV2FpdGluZyIsInN5bmNPZmZsaW5lRGF0YSIsImNsZWFyT2ZmbGluZURhdGEiLCJyZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbiIsInJlcXVlc3RQZXJtaXNzaW9uIiwic3Vic2NyaWJlVG9Ob3RpZmljYXRpb25zIiwidW5zdWJzY3JpYmVGcm9tTm90aWZpY2F0aW9ucyIsInJlZnJlc2giLCJ1c2VFZmZlY3QiLCJoYW5kbGVPbmxpbmUiLCJjYXRjaCIsImhhbmRsZU9mZmxpbmUiLCJ1bnN1YnNjcmliZUluc3RhbGxhdGlvbiIsInN1YnNjcmliZSIsInVuc3Vic2NyaWJlU2VydmljZVdvcmtlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiT2JqZWN0IiwiYXNzaWduIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Q0FLQzs7OzsrQkFtRWVBOzs7ZUFBQUE7Ozt1QkFqRWlDOzhCQUVoQjs4QkFLMUI7K0JBSUE7d0JBQ2dCO0FBcURoQixTQUFTQTtJQUNkLE1BQU0sQ0FBQ0MsUUFBUUMsVUFBVSxHQUFHQyxJQUFBQSxlQUFRLEVBQVk7UUFDOUNDLGFBQWEsT0FBT0MsV0FBVyxjQUFlLG1CQUFtQkMsYUFBYSxpQkFBaUJELFNBQVU7UUFDekdFLFdBQVdDLElBQUFBLDhCQUFnQixFQUFDO1FBQzVCQyxjQUFjO1lBQ1pDLGVBQWU7WUFDZkMsYUFBYTtZQUNiQyxXQUFXO1lBQ1hDLFVBQVU7WUFDVkMsZ0JBQWdCO1FBQ2xCO1FBQ0FDLGVBQWU7WUFDYlgsYUFBYSxPQUFPQyxXQUFXLGNBQWMsbUJBQW1CQyxZQUFZO1lBQzVFVSxjQUFjO1lBQ2RDLFVBQVU7WUFDVkMsY0FBYztZQUNkQyxXQUFXO1FBQ2I7UUFDQUMsVUFBVSxPQUFPZixXQUFXLGNBQWNDLFVBQVVlLE1BQU0sR0FBRztRQUM3REMsY0FBYztRQUNkQyxnQkFBZ0I7UUFDaEJDLHdCQUF3QixPQUFPbkIsV0FBVyxjQUFjLGtCQUFrQkEsU0FBUztRQUNuRm9CLHNCQUFzQjtRQUN0QkMseUJBQXlCO1FBQ3pCQyxTQUFTO1FBQ1RDLE9BQU87SUFDVDtJQUVBLGlCQUFpQjtJQUNqQixNQUFNQyxnQkFBZ0JDLElBQUFBLGtCQUFXLEVBQUM7UUFDaEMsSUFBSTtZQUNGQyxjQUFNLENBQUNDLElBQUksQ0FBQztZQUNaOUIsVUFBVStCLENBQUFBLE9BQVMsQ0FBQTtvQkFBRSxHQUFHQSxJQUFJO29CQUFFTixTQUFTO29CQUFNQyxPQUFPO2dCQUFLLENBQUE7WUFFekQsa0NBQWtDO1lBQ2xDLE1BQU1NLGFBQWExQixJQUFBQSw4QkFBZ0IsRUFBQztZQUNwQ3VCLGNBQU0sQ0FBQ0MsSUFBSSxDQUFDLGdDQUFnQztnQkFBRUcsU0FBU0Q7WUFBVztZQUNsRSxJQUFJLENBQUNBLFlBQVk7Z0JBQ2ZILGNBQU0sQ0FBQ0MsSUFBSSxDQUFDO2dCQUNaOUIsVUFBVStCLENBQUFBLE9BQVMsQ0FBQTt3QkFDakIsR0FBR0EsSUFBSTt3QkFDUDFCLFdBQVc7d0JBQ1hvQixTQUFTO3dCQUNUQyxPQUFPO29CQUNULENBQUE7Z0JBQ0E7WUFDRjtZQUVBLHNCQUFzQjtZQUN0QixNQUFNeEIsY0FBYyxtQkFBbUJFLGFBQWEsaUJBQWlCRDtZQUNyRTBCLGNBQU0sQ0FBQ0MsSUFBSSxDQUFDLDhCQUE4QjtnQkFDeENqQixlQUFlLG1CQUFtQlQ7Z0JBQ2xDOEIsYUFBYSxpQkFBaUIvQjtnQkFDOUJEO1lBQ0Y7WUFFQSwwQkFBMEI7WUFDMUIsTUFBTWlDLHFCQUFxQkMsb0NBQXNCLENBQUNDLFNBQVM7WUFFM0Qsb0RBQW9EO1lBQ3BELE1BQU1DLHNCQUFzQixNQUFNQyxtQ0FBb0IsQ0FBQ0MsUUFBUTtZQUUvRCxnQ0FBZ0M7WUFDaEMsTUFBTWhCLDBCQUEwQixrQkFBa0JyQixTQUM5Q3NDLGFBQWFDLFVBQVUsR0FDdkI7WUFFSiwwQkFBMEI7WUFDMUIsTUFBTXRCLGVBQWUsTUFBTXVCO1lBRTNCLE1BQU1DLGNBQWM7Z0JBQ2xCMUM7Z0JBQ0FHLFdBQVcyQjtnQkFDWHpCLGNBQWM0QjtnQkFDZHRCLGVBQWV5QjtnQkFDZmQ7Z0JBQ0FELHNCQUFzQkMsNEJBQTRCO2dCQUNsREo7Z0JBQ0FDLGdCQUFnQkQsZUFBZTtnQkFDL0JLLFNBQVM7Z0JBQ1RDLE9BQU87WUFDVDtZQUVBRyxjQUFNLENBQUNDLElBQUksQ0FBQyxpQ0FBaUNjO1lBQzdDNUMsVUFBVStCLENBQUFBLE9BQVMsQ0FBQTtvQkFBRSxHQUFHQSxJQUFJO29CQUFFLEdBQUdhLFdBQVc7Z0JBQUMsQ0FBQTtRQUUvQyxFQUFFLE9BQU9sQixPQUFPO1lBQ2RHLGNBQU0sQ0FBQ0gsS0FBSyxDQUFDLCtCQUErQkEsaUJBQWlCbUIsUUFBUW5CLFFBQVEsSUFBSW1CLE1BQU07WUFDdkY3QyxVQUFVK0IsQ0FBQUEsT0FBUyxDQUFBO29CQUNqQixHQUFHQSxJQUFJO29CQUNQTixTQUFTO29CQUNUQyxPQUFPQSxpQkFBaUJtQixRQUFRbkIsTUFBTW9CLE9BQU8sR0FBRztnQkFDbEQsQ0FBQTtRQUNGO0lBQ0YsR0FBRyxFQUFFO0lBRUwsc0JBQXNCO0lBQ3RCLE1BQU1DLHFCQUFxQm5CLElBQUFBLGtCQUFXLEVBQUM7UUFDckMsSUFBSTtZQUNGLE1BQU1vQixTQUFTLE1BQU1aLG9DQUFzQixDQUFDVyxrQkFBa0I7WUFFOUQsMkNBQTJDO1lBQzNDLE1BQU1aLHFCQUFxQkMsb0NBQXNCLENBQUNDLFNBQVM7WUFDM0RyQyxVQUFVK0IsQ0FBQUEsT0FBUyxDQUFBO29CQUNqQixHQUFHQSxJQUFJO29CQUNQeEIsY0FBYzRCO2dCQUNoQixDQUFBO1lBRUEsT0FBT2E7UUFDVCxFQUFFLE9BQU90QixPQUFPO1lBQ2RHLGNBQU0sQ0FBQ0gsS0FBSyxDQUFDLG9DQUFvQ0EsaUJBQWlCbUIsUUFBUW5CLFFBQVEsSUFBSW1CLE1BQU07WUFDNUYsT0FBTztnQkFDTEksU0FBUztnQkFDVEMsU0FBUztnQkFDVHhCLE9BQU9BLGlCQUFpQm1CLFFBQVFuQixNQUFNb0IsT0FBTyxHQUFHO1lBQ2xEO1FBQ0Y7SUFDRixHQUFHLEVBQUU7SUFFTCxtQ0FBbUM7SUFDbkMsTUFBTUssa0JBQWtCdkIsSUFBQUEsa0JBQVcsRUFBQztRQUNsQyxJQUFJO1lBQ0YsTUFBTXdCLFlBQVksTUFBTWIsbUNBQW9CLENBQUNZLGVBQWU7WUFFNUQsK0JBQStCO1lBQy9CLE1BQU1iLHNCQUFzQixNQUFNQyxtQ0FBb0IsQ0FBQ0YsU0FBUztZQUNoRXJDLFVBQVUrQixDQUFBQSxPQUFTLENBQUE7b0JBQ2pCLEdBQUdBLElBQUk7b0JBQ1BsQixlQUFleUI7Z0JBQ2pCLENBQUE7WUFFQSxPQUFPYztRQUNULEVBQUUsT0FBTzFCLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMscUNBQXFDQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUM3RixPQUFPO1FBQ1Q7SUFDRixHQUFHLEVBQUU7SUFFTCxrQ0FBa0M7SUFDbEMsTUFBTVEsY0FBY3pCLElBQUFBLGtCQUFXLEVBQUM7UUFDOUIsSUFBSTtZQUNGLE1BQU1XLG1DQUFvQixDQUFDYyxXQUFXO1FBQ3hDLEVBQUUsT0FBTzNCLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMsZ0NBQWdDQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUN4RixNQUFNbkI7UUFDUjtJQUNGLEdBQUcsRUFBRTtJQUVMLG9CQUFvQjtJQUNwQixNQUFNNEIsa0JBQWtCMUIsSUFBQUEsa0JBQVcsRUFBQztRQUNsQyxJQUFJO1lBQ0ZDLGNBQU0sQ0FBQ0MsSUFBSSxDQUFDO1lBRVosNEJBQTRCO1lBQzVCLE1BQU1WLGVBQWUsTUFBTXVCO1lBQzNCM0MsVUFBVStCLENBQUFBLE9BQVMsQ0FBQTtvQkFDakIsR0FBR0EsSUFBSTtvQkFDUFg7b0JBQ0FDLGdCQUFnQkQsZUFBZTtnQkFDakMsQ0FBQTtRQUNGLEVBQUUsT0FBT00sT0FBTztZQUNkRyxjQUFNLENBQUNILEtBQUssQ0FBQyxxQ0FBcUNBLGlCQUFpQm1CLFFBQVFuQixRQUFRLElBQUltQixNQUFNO1lBQzdGLE1BQU1uQjtRQUNSO0lBQ0YsR0FBRyxFQUFFO0lBRUwscUJBQXFCO0lBQ3JCLE1BQU02QixtQkFBbUIzQixJQUFBQSxrQkFBVyxFQUFDO1FBQ25DLElBQUk7WUFDRkMsY0FBTSxDQUFDQyxJQUFJLENBQUM7WUFFWjlCLFVBQVUrQixDQUFBQSxPQUFTLENBQUE7b0JBQ2pCLEdBQUdBLElBQUk7b0JBQ1BYLGNBQWM7b0JBQ2RDLGdCQUFnQjtnQkFDbEIsQ0FBQTtRQUNGLEVBQUUsT0FBT0ssT0FBTztZQUNkRyxjQUFNLENBQUNILEtBQUssQ0FBQyxzQ0FBc0NBLGlCQUFpQm1CLFFBQVFuQixRQUFRLElBQUltQixNQUFNO1lBQzlGLE1BQU1uQjtRQUNSO0lBQ0YsR0FBRyxFQUFFO0lBRUwsa0NBQWtDO0lBQ2xDLE1BQU04QixnQ0FBZ0M1QixJQUFBQSxrQkFBVyxFQUFDO1FBQ2hELElBQUk7WUFDRixJQUFJLENBQUUsQ0FBQSxrQkFBa0J6QixNQUFLLEdBQUk7Z0JBQy9CLE9BQU87WUFDVDtZQUVBLE1BQU11QyxhQUFhLE1BQU1ELGFBQWFnQixpQkFBaUI7WUFDdkQsTUFBTXhCLFVBQVVTLGVBQWU7WUFFL0IxQyxVQUFVK0IsQ0FBQUEsT0FBUyxDQUFBO29CQUNqQixHQUFHQSxJQUFJO29CQUNQUCx5QkFBeUJrQjtvQkFDekJuQixzQkFBc0JVO2dCQUN4QixDQUFBO1lBRUEsT0FBT0E7UUFDVCxFQUFFLE9BQU9QLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMsbURBQW1EQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUMzRyxPQUFPO1FBQ1Q7SUFDRixHQUFHLEVBQUU7SUFFTCw2QkFBNkI7SUFDN0IsTUFBTWEsMkJBQTJCOUIsSUFBQUEsa0JBQVcsRUFBQztRQUMzQyxJQUFJO1lBQ0YsSUFBSSxDQUFDN0IsT0FBT3dCLG9CQUFvQixFQUFFO2dCQUNoQyxNQUFNVSxVQUFVLE1BQU11QjtnQkFDdEIsSUFBSSxDQUFDdkIsU0FBUztvQkFDWixPQUFPO2dCQUNUO1lBQ0Y7WUFFQUosY0FBTSxDQUFDQyxJQUFJLENBQUM7WUFFWixPQUFPO1FBQ1QsRUFBRSxPQUFPSixPQUFPO1lBQ2RHLGNBQU0sQ0FBQ0gsS0FBSyxDQUFDLDhDQUE4Q0EsaUJBQWlCbUIsUUFBUW5CLFFBQVEsSUFBSW1CLE1BQU07WUFDdEcsT0FBTztRQUNUO0lBQ0YsR0FBRztRQUFDOUMsT0FBT3dCLG9CQUFvQjtRQUFFaUM7S0FBOEI7SUFFL0QsaUNBQWlDO0lBQ2pDLE1BQU1HLCtCQUErQi9CLElBQUFBLGtCQUFXLEVBQUM7UUFDL0MsSUFBSTtZQUNGLDJEQUEyRDtZQUMzREMsY0FBTSxDQUFDQyxJQUFJLENBQUM7WUFFWjlCLFVBQVUrQixDQUFBQSxPQUFTLENBQUE7b0JBQ2pCLEdBQUdBLElBQUk7b0JBQ1BSLHNCQUFzQjtnQkFDeEIsQ0FBQTtZQUVBLE9BQU87UUFDVCxFQUFFLE9BQU9HLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMsa0RBQWtEQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUMxRyxPQUFPO1FBQ1Q7SUFDRixHQUFHLEVBQUU7SUFFTCxxQkFBcUI7SUFDckIsTUFBTWUsVUFBVWhDLElBQUFBLGtCQUFXLEVBQUM7UUFDMUIsTUFBTUQ7SUFDUixHQUFHO1FBQUNBO0tBQWM7SUFFbEIsc0JBQXNCO0lBQ3RCa0MsSUFBQUEsZ0JBQVMsRUFBQztRQUNSbEM7SUFDRixHQUFHO1FBQUNBO0tBQWM7SUFFbEIseUJBQXlCO0lBQ3pCa0MsSUFBQUEsZ0JBQVMsRUFBQztRQUNSLHdCQUF3QjtRQUN4QixNQUFNQyxlQUFlO1lBQ25COUQsVUFBVStCLENBQUFBLE9BQVMsQ0FBQTtvQkFBRSxHQUFHQSxJQUFJO29CQUFFYixVQUFVO2dCQUFLLENBQUE7WUFDN0Msb0NBQW9DO1lBQ3BDb0Msa0JBQWtCUyxLQUFLLENBQUNyQyxDQUFBQTtnQkFDdEJHLGNBQU0sQ0FBQ0gsS0FBSyxDQUFDLDBCQUEwQkEsaUJBQWlCbUIsUUFBUW5CLFFBQVEsSUFBSW1CLE1BQU07WUFDcEY7UUFDRjtRQUVBLE1BQU1tQixnQkFBZ0I7WUFDcEJoRSxVQUFVK0IsQ0FBQUEsT0FBUyxDQUFBO29CQUFFLEdBQUdBLElBQUk7b0JBQUViLFVBQVU7Z0JBQU0sQ0FBQTtRQUNoRDtRQUVBLDhCQUE4QjtRQUM5QixNQUFNK0MsMEJBQTBCN0Isb0NBQXNCLENBQUM4QixTQUFTLENBQUMsQ0FBQy9CO1lBQ2hFbkMsVUFBVStCLENBQUFBLE9BQVMsQ0FBQTtvQkFBRSxHQUFHQSxJQUFJO29CQUFFeEIsY0FBYzRCO2dCQUFtQixDQUFBO1FBQ2pFO1FBRUEsZ0NBQWdDO1FBQ2hDLE1BQU1nQywyQkFBMkI1QixtQ0FBb0IsQ0FBQzJCLFNBQVMsQ0FBQyxDQUFDNUI7WUFDL0R0QyxVQUFVK0IsQ0FBQUEsT0FBUyxDQUFBO29CQUFFLEdBQUdBLElBQUk7b0JBQUVsQixlQUFleUI7Z0JBQW9CLENBQUE7UUFDbkU7UUFFQSw0Q0FBNEM7UUFDNUMsSUFBSSxPQUFPbkMsV0FBVyxhQUFhO1lBQ2pDQSxPQUFPaUUsZ0JBQWdCLENBQUMsVUFBVU47WUFDbEMzRCxPQUFPaUUsZ0JBQWdCLENBQUMsV0FBV0o7UUFDckM7UUFFQSxVQUFVO1FBQ1YsT0FBTztZQUNMLElBQUksT0FBTzdELFdBQVcsYUFBYTtnQkFDakNBLE9BQU9rRSxtQkFBbUIsQ0FBQyxVQUFVUDtnQkFDckMzRCxPQUFPa0UsbUJBQW1CLENBQUMsV0FBV0w7WUFDeEM7WUFDQUM7WUFDQUU7UUFDRjtJQUNGLEdBQUc7UUFBQ2I7S0FBZ0I7SUFFcEIsT0FBT2dCLE9BQU9DLE1BQU0sQ0FBQyxDQUFDLEdBQUd4RSxRQUFRO1FBQy9CZ0Q7UUFDQUk7UUFDQUU7UUFDQUM7UUFDQUM7UUFDQUM7UUFDQUU7UUFDQUM7UUFDQUM7SUFDRjtBQUNGO0FBRUE7O0NBRUMsR0FDRCxlQUFlakI7SUFDYixJQUFJO1FBQ0YsMkRBQTJEO1FBQzNELG9CQUFvQjtRQUNwQixPQUFPO0lBQ1QsRUFBRSxPQUFPakIsT0FBTztRQUNkRyxjQUFNLENBQUNILEtBQUssQ0FBQywyQ0FBMkNBLGlCQUFpQm1CLFFBQVFuQixRQUFRLElBQUltQixNQUFNO1FBQ25HLE9BQU87SUFDVDtBQUNGIn0=
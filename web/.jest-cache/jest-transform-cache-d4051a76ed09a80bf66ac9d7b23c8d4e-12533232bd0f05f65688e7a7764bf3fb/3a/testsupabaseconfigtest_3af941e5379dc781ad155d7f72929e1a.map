{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/test-supabase-config.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\n\n/**\n * Test Supabase Configuration\n * \n * Tests to understand the Supabase client configuration issue\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Test Supabase Configuration', () => {\n  it('should test different Supabase client configurations', async () => {\n    const { createClient } = await import('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    const anonKey = process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n    \n    if (!supabaseUrl || !serviceKey || !anonKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    console.log('üîç Testing Supabase client configurations...');\n    console.log('Supabase URL:', supabaseUrl);\n    console.log('Service Key (first 10 chars):', serviceKey.substring(0, 10));\n    console.log('Anon Key (first 10 chars):', anonKey.substring(0, 10));\n    \n    // Test 1: Service role client\n    console.log('üîç Test 1: Service role client');\n    const serviceClient = createClient(supabaseUrl, serviceKey);\n    \n    const { data: serviceData, error: serviceError } = await serviceClient\n      .from('polls')\n      .select('id, title')\n      .limit(1);\n    \n    console.log('Service client result:', { serviceData, serviceError });\n    \n    // Test 2: Anon client\n    console.log('üîç Test 2: Anon client');\n    const anonClient = createClient(supabaseUrl, anonKey);\n    \n    const { data: anonData, error: anonError } = await anonClient\n      .from('polls')\n      .select('id, title')\n      .limit(1);\n    \n    console.log('Anon client result:', { anonData, anonError });\n    \n    // Test 3: Service role with auth bypass\n    console.log('üîç Test 3: Service role with auth bypass');\n    const serviceClientWithAuth = createClient(supabaseUrl, serviceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false\n      }\n    });\n    \n    const { data: serviceAuthData, error: serviceAuthError } = await serviceClientWithAuth\n      .from('polls')\n      .select('id, title')\n      .limit(1);\n    \n    console.log('Service client with auth bypass result:', { serviceAuthData, serviceAuthError });\n    \n    // Test 4: Try to get database version\n    console.log('üîç Test 4: Database version');\n    const { data: versionData, error: versionError } = await serviceClient\n      .rpc('version');\n    \n    console.log('Database version result:', { versionData, versionError });\n    \n    // Test 5: Try to get current user\n    console.log('üîç Test 5: Current user');\n    const { data: userData, error: userError } = await serviceClient.auth.getUser();\n    \n    console.log('Current user result:', { userData, userError });\n    \n    // Test 6: Try to get session\n    console.log('üîç Test 6: Current session');\n    const { data: sessionData, error: sessionError } = await serviceClient.auth.getSession();\n    \n    console.log('Current session result:', { sessionData, sessionError });\n    \n    // The test should pass if we can at least connect\n    expect(serviceError).toBeNull();\n    expect(anonError).toBeNull();\n    expect(serviceAuthError).toBeNull();\n    expect(versionError).toBeNull();\n    expect(userError).toBeNull();\n    expect(sessionError).toBeNull();\n  });\n});\n"],"names":["describe","it","createClient","supabaseUrl","process","env","SUPABASE_URL","NEXT_PUBLIC_SUPABASE_URL","serviceKey","SUPABASE_SERVICE_ROLE_KEY","anonKey","SUPABASE_ANON_KEY","NEXT_PUBLIC_SUPABASE_ANON_KEY","Error","console","log","substring","serviceClient","data","serviceData","error","serviceError","from","select","limit","anonClient","anonData","anonError","serviceClientWithAuth","auth","autoRefreshToken","persistSession","serviceAuthData","serviceAuthError","versionData","versionError","rpc","userData","userError","getUser","sessionData","sessionError","getSession","expect","toBeNull"],"mappings":"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"}
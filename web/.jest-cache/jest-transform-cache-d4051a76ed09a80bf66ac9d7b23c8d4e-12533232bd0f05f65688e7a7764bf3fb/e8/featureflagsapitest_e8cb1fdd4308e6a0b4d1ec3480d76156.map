{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/api/feature-flags-api.test.ts"],"sourcesContent":["/**\n * Integration Tests for Feature Flags API\n * \n * Tests the API endpoints for feature flag management:\n * - GET /api/feature-flags\n * - PATCH /api/feature-flags\n * \n * Created: January 23, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect, beforeEach, afterEach, jest } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET, PATCH } from '@/app/api/feature-flags/route';\n\n// Mock the feature flag manager\njest.mock('@/lib/core/feature-flags', () => ({\n  featureFlagManager: {\n    getAllFlags: jest.fn(),\n    getEnabledFlags: jest.fn(),\n    getDisabledFlags: jest.fn(),\n    getSystemInfo: jest.fn(),\n    enable: jest.fn(),\n    disable: jest.fn(),\n    isEnabled: jest.fn()\n  }\n}));\n\nimport { featureFlagManager } from '@/lib/core/feature-flags';\n\nconst mockFeatureFlagManager = featureFlagManager as jest.Mocked<typeof featureFlagManager>;\n\ndescribe('Feature Flags API Integration Tests', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    jest.resetAllMocks();\n  });\n\n  describe('GET /api/feature-flags', () => {\n    it('should return all feature flags with system info', async () => {\n      // Mock the feature flag manager responses\n      const mockFlags = new Map([\n        ['DEMOGRAPHIC_FILTERING', { id: 'DEMOGRAPHIC_FILTERING', enabled: true, category: 'personalization' }],\n        // TRENDING_POLLS removed - functionality already implemented through hashtag system\n        ['ADVANCED_PRIVACY', { id: 'ADVANCED_PRIVACY', enabled: true, category: 'privacy' }]\n      ]);\n\n      const mockEnabledFlags = [\n        { id: 'DEMOGRAPHIC_FILTERING', enabled: true, category: 'personalization' },\n        // TRENDING_POLLS removed - functionality already implemented through hashtag system\n        { id: 'ADVANCED_PRIVACY', enabled: true, category: 'privacy' }\n      ];\n\n      const mockDisabledFlags = [\n        { id: 'AUTOMATED_POLLS', enabled: false, category: 'future' }\n      ];\n\n      const mockSystemInfo = {\n        totalFlags: 40,\n        enabledFlags: 32,\n        disabledFlags: 8,\n        environment: 'test',\n        categories: {\n          personalization: 2,\n          privacy: 1,\n          future: 1\n        }\n      };\n\n      mockFeatureFlagManager.getAllFlags.mockReturnValue(mockFlags);\n      mockFeatureFlagManager.getEnabledFlags.mockReturnValue(mockEnabledFlags);\n      mockFeatureFlagManager.getDisabledFlags.mockReturnValue(mockDisabledFlags);\n      mockFeatureFlagManager.getSystemInfo.mockReturnValue(mockSystemInfo);\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags');\n      const response = await GET(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.flags).toBeDefined();\n      expect(data.enabledFlags).toBeDefined();\n      expect(data.disabledFlags).toBeDefined();\n      expect(data.systemInfo).toBeDefined();\n      expect(data.timestamp).toBeDefined();\n\n      expect(mockFeatureFlagManager.getAllFlags).toHaveBeenCalled();\n      expect(mockFeatureFlagManager.getEnabledFlags).toHaveBeenCalled();\n      expect(mockFeatureFlagManager.getDisabledFlags).toHaveBeenCalled();\n      expect(mockFeatureFlagManager.getSystemInfo).toHaveBeenCalled();\n    });\n\n    it('should handle errors gracefully', async () => {\n      mockFeatureFlagManager.getAllFlags.mockImplementation(() => {\n        throw new Error('Database connection failed');\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags');\n      const response = await GET(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Failed to fetch feature flags');\n      expect(data.timestamp).toBeDefined();\n    });\n  });\n\n  describe('PATCH /api/feature-flags', () => {\n    it('should enable a feature flag', async () => {\n      mockFeatureFlagManager.enable.mockReturnValue(true);\n\n      const requestBody = {\n        flagId: 'DEMOGRAPHIC_FILTERING',\n        enabled: true\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.message).toBe('Feature flag DEMOGRAPHIC_FILTERING updated to true');\n      expect(data.flagId).toBe('DEMOGRAPHIC_FILTERING');\n      expect(data.enabled).toBe(true);\n      expect(data.timestamp).toBeDefined();\n\n      expect(mockFeatureFlagManager.enable).toHaveBeenCalledWith('DEMOGRAPHIC_FILTERING');\n    });\n\n    it('should disable a feature flag', async () => {\n      mockFeatureFlagManager.disable.mockReturnValue(true);\n\n      const requestBody = {\n        flagId: 'DEMOGRAPHIC_FILTERING',\n        enabled: false\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.message).toBe('Feature flag DEMOGRAPHIC_FILTERING updated to false');\n      expect(data.flagId).toBe('DEMOGRAPHIC_FILTERING');\n      expect(data.enabled).toBe(false);\n      expect(data.timestamp).toBeDefined();\n\n      expect(mockFeatureFlagManager.disable).toHaveBeenCalledWith('DEMOGRAPHIC_FILTERING');\n    });\n\n    it('should handle invalid request body', async () => {\n      const requestBody = {\n        flagId: 'DEMOGRAPHIC_FILTERING'\n        // missing 'enabled' field\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Invalid request body. Expected { flagId: string, enabled: boolean }');\n      expect(data.timestamp).toBeDefined();\n    });\n\n    it('should handle missing flagId', async () => {\n      const requestBody = {\n        enabled: true\n        // missing 'flagId' field\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Invalid request body. Expected { flagId: string, enabled: boolean }');\n      expect(data.timestamp).toBeDefined();\n    });\n\n    it('should handle invalid enabled type', async () => {\n      const requestBody = {\n        flagId: 'DEMOGRAPHIC_FILTERING',\n        enabled: 'true' // should be boolean, not string\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Invalid request body. Expected { flagId: string, enabled: boolean }');\n      expect(data.timestamp).toBeDefined();\n    });\n\n    it('should handle flag update failure', async () => {\n      mockFeatureFlagManager.enable.mockReturnValue(false);\n\n      const requestBody = {\n        flagId: 'INVALID_FLAG',\n        enabled: true\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Failed to update feature flag: INVALID_FLAG');\n      expect(data.timestamp).toBeDefined();\n    });\n\n    it('should handle manager errors', async () => {\n      mockFeatureFlagManager.enable.mockImplementation(() => {\n        throw new Error('Database connection failed');\n      });\n\n      const requestBody = {\n        flagId: 'DEMOGRAPHIC_FILTERING',\n        enabled: true\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Failed to update feature flag');\n      expect(data.timestamp).toBeDefined();\n    });\n\n    it('should handle malformed JSON', async () => {\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: 'invalid json',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Failed to update feature flag');\n      expect(data.timestamp).toBeDefined();\n    });\n  });\n\n  describe('Feature Flag Dependencies', () => {\n    it('should handle flags with dependencies', async () => {\n      // Test enabling a flag that has dependencies\n      mockFeatureFlagManager.enable.mockReturnValue(true);\n\n      const requestBody = {\n        flagId: 'SOCIAL_SHARING_POLLS',\n        enabled: true\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(mockFeatureFlagManager.enable).toHaveBeenCalledWith('SOCIAL_SHARING_POLLS');\n    });\n\n    it('should handle flags without dependencies', async () => {\n      mockFeatureFlagManager.enable.mockReturnValue(true);\n\n      const requestBody = {\n        flagId: 'ADVANCED_PRIVACY',\n        enabled: true\n      };\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags', {\n        method: 'PATCH',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const response = await PATCH(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(mockFeatureFlagManager.enable).toHaveBeenCalledWith('ADVANCED_PRIVACY');\n    });\n  });\n\n  describe('System Information', () => {\n    it('should return comprehensive system info', async () => {\n      const mockSystemInfo = {\n        totalFlags: 40,\n        enabledFlags: 32,\n        disabledFlags: 8,\n        environment: 'test',\n        categories: {\n          core: 7,\n          enhanced: 3,\n          civics: 7,\n          future: 3,\n          personalization: 2,\n          privacy: 1,\n          performance: 2,\n          social: 6,\n          system: 4,\n          analytics: 1,\n          admin: 1,\n          contact: 1,\n          testing: 1,\n          auth: 1\n        }\n      };\n\n      mockFeatureFlagManager.getSystemInfo.mockReturnValue(mockSystemInfo);\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags');\n      const response = await GET(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.systemInfo).toEqual(mockSystemInfo);\n    });\n  });\n\n  describe('Performance and Reliability', () => {\n    it('should handle concurrent requests', async () => {\n      mockFeatureFlagManager.getAllFlags.mockReturnValue(new Map());\n      mockFeatureFlagManager.getEnabledFlags.mockReturnValue([]);\n      mockFeatureFlagManager.getDisabledFlags.mockReturnValue([]);\n      mockFeatureFlagManager.getSystemInfo.mockReturnValue({\n        totalFlags: 40,\n        enabledFlags: 32,\n        disabledFlags: 8,\n        environment: 'test',\n        categories: {}\n      });\n\n      const requests = Array.from({ length: 10 }, () => \n        GET(new NextRequest('http://localhost:3000/api/feature-flags'))\n      );\n\n      const responses = await Promise.all(requests);\n      \n      responses.forEach(response => {\n        expect(response.status).toBe(200);\n      });\n    });\n\n    it('should handle large flag datasets', async () => {\n      const largeFlagSet = new Map();\n      for (let i = 0; i < 1000; i++) {\n        largeFlagSet.set(`FLAG_${i}`, { id: `FLAG_${i}`, enabled: i % 2 === 0 });\n      }\n\n      mockFeatureFlagManager.getAllFlags.mockReturnValue(largeFlagSet);\n      mockFeatureFlagManager.getEnabledFlags.mockReturnValue([]);\n      mockFeatureFlagManager.getDisabledFlags.mockReturnValue([]);\n      mockFeatureFlagManager.getSystemInfo.mockReturnValue({\n        totalFlags: 1000,\n        enabledFlags: 500,\n        disabledFlags: 500,\n        environment: 'test',\n        categories: {}\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/feature-flags');\n      const response = await GET(request);\n      const data = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.flags).toBeDefined();\n    });\n  });\n});\n"],"names":["jest","mock","featureFlagManager","getAllFlags","fn","getEnabledFlags","getDisabledFlags","getSystemInfo","enable","disable","isEnabled","mockFeatureFlagManager","describe","beforeEach","clearAllMocks","afterEach","resetAllMocks","it","mockFlags","Map","id","enabled","category","mockEnabledFlags","mockDisabledFlags","mockSystemInfo","totalFlags","enabledFlags","disabledFlags","environment","categories","personalization","privacy","future","mockReturnValue","request","NextRequest","response","GET","data","json","expect","status","toBe","success","flags","toBeDefined","systemInfo","timestamp","toHaveBeenCalled","mockImplementation","Error","error","requestBody","flagId","method","body","JSON","stringify","headers","PATCH","message","toHaveBeenCalledWith","core","enhanced","civics","performance","social","system","analytics","admin","contact","testing","auth","toEqual","requests","Array","from","length","responses","Promise","all","forEach","largeFlagSet","i","set"],"mappings":"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"}
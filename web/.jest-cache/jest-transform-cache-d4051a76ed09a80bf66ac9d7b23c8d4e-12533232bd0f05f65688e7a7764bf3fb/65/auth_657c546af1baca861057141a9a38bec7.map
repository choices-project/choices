{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/utils/auth.ts"],"sourcesContent":["/**\n * Authentication Utilities\n * \n * Production authentication utilities for the Choices platform\n * \n * Created: January 16, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { logger } from './logger';\n\n// Define proper types for request/response\ninterface Request {\n  body: unknown;\n  headers: Record<string, string>;\n  method: string;\n  url: string;\n}\n\ninterface Response {\n  status: (code: number) => Response;\n  json: (data: unknown) => Response;\n}\n\nexport interface User {\n  id: string;\n  email: string;\n  name: string;\n  avatar?: string;\n  role?: string;\n}\n\nexport interface AuthResult {\n  user: User | null;\n  error: string | null;\n}\n\nexport interface SessionValidation {\n  valid: boolean;\n  user?: User;\n  error?: string;\n}\n\n/**\n * Get current user from session\n */\nexport function getUser(): Promise<AuthResult> {\n  try {\n    // This would integrate with your actual auth system\n    // For now, return null as this is a placeholder\n    logger.info('Getting current user');\n    return Promise.resolve({\n      user: null,\n      error: null\n    });\n  } catch (error) {\n    logger.error('Failed to get user', error instanceof Error ? error : new Error(String(error)));\n    return Promise.resolve({\n      user: null,\n      error: 'Failed to get user'\n    });\n  }\n}\n\n/**\n * Require authentication middleware\n */\nexport function requireAuth(handler: (req: Request, res: Response) => Promise<Response>) {\n  return async (req: Request, res: Response) => {\n    try {\n      const { user, error } = await getUser();\n      \n      if (!user || error) {\n        return res.status(401).json({ error: 'Unauthorized' });\n      }\n      \n      return handler(req, res);\n    } catch (error) {\n      logger.error('Authentication error', error instanceof Error ? error : new Error(String(error)));\n      return res.status(500).json({ error: 'Internal server error' });\n    }\n  };\n}\n\n/**\n * Check user permissions\n */\nexport function checkPermissions(userId: string, permission: string): Promise<boolean> {\n  try {\n    // This would integrate with your actual permission system\n    logger.info('Checking permissions', { userId, permission });\n    return Promise.resolve(true); // Placeholder\n  } catch (error) {\n    logger.error('Permission check failed', error instanceof Error ? error : new Error(String(error)));\n    return Promise.resolve(false);\n  }\n}\n\n/**\n * Validate user session\n */\nexport function validateSession(sessionToken: string): Promise<SessionValidation> {\n  try {\n    // This would integrate with your actual session validation\n    logger.info('Validating session', { sessionToken });\n    return Promise.resolve({\n      valid: false, // Placeholder - would validate actual session\n      error: 'Session validation not implemented'\n    });\n  } catch (error) {\n    logger.error('Session validation failed', error instanceof Error ? error : new Error(String(error)));\n    return Promise.resolve({\n      valid: false,\n      error: 'Session validation failed'\n    });\n  }\n}"],"names":["checkPermissions","getUser","requireAuth","validateSession","logger","info","Promise","resolve","user","error","Error","String","handler","req","res","status","json","userId","permission","sessionToken","valid"],"mappings":"AAAA;;;;;;;CAOC;;;;;;;;;;;QAgFeA;eAAAA;;QAzCAC;eAAAA;;QAqBAC;eAAAA;;QAkCAC;eAAAA;;;wBA5FO;AAqChB,SAASF;IACd,IAAI;QACF,oDAAoD;QACpD,gDAAgD;QAChDG,cAAM,CAACC,IAAI,CAAC;QACZ,OAAOC,QAAQC,OAAO,CAAC;YACrBC,MAAM;YACNC,OAAO;QACT;IACF,EAAE,OAAOA,OAAO;QACdL,cAAM,CAACK,KAAK,CAAC,sBAAsBA,iBAAiBC,QAAQD,QAAQ,IAAIC,MAAMC,OAAOF;QACrF,OAAOH,QAAQC,OAAO,CAAC;YACrBC,MAAM;YACNC,OAAO;QACT;IACF;AACF;AAKO,SAASP,YAAYU,OAA2D;IACrF,OAAO,OAAOC,KAAcC;QAC1B,IAAI;YACF,MAAM,EAAEN,IAAI,EAAEC,KAAK,EAAE,GAAG,MAAMR;YAE9B,IAAI,CAACO,QAAQC,OAAO;gBAClB,OAAOK,IAAIC,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEP,OAAO;gBAAe;YACtD;YAEA,OAAOG,QAAQC,KAAKC;QACtB,EAAE,OAAOL,OAAO;YACdL,cAAM,CAACK,KAAK,CAAC,wBAAwBA,iBAAiBC,QAAQD,QAAQ,IAAIC,MAAMC,OAAOF;YACvF,OAAOK,IAAIC,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEP,OAAO;YAAwB;QAC/D;IACF;AACF;AAKO,SAAST,iBAAiBiB,MAAc,EAAEC,UAAkB;IACjE,IAAI;QACF,0DAA0D;QAC1Dd,cAAM,CAACC,IAAI,CAAC,wBAAwB;YAAEY;YAAQC;QAAW;QACzD,OAAOZ,QAAQC,OAAO,CAAC,OAAO,cAAc;IAC9C,EAAE,OAAOE,OAAO;QACdL,cAAM,CAACK,KAAK,CAAC,2BAA2BA,iBAAiBC,QAAQD,QAAQ,IAAIC,MAAMC,OAAOF;QAC1F,OAAOH,QAAQC,OAAO,CAAC;IACzB;AACF;AAKO,SAASJ,gBAAgBgB,YAAoB;IAClD,IAAI;QACF,2DAA2D;QAC3Df,cAAM,CAACC,IAAI,CAAC,sBAAsB;YAAEc;QAAa;QACjD,OAAOb,QAAQC,OAAO,CAAC;YACrBa,OAAO;YACPX,OAAO;QACT;IACF,EAAE,OAAOA,OAAO;QACdL,cAAM,CAACK,KAAK,CAAC,6BAA6BA,iBAAiBC,QAAQD,QAAQ,IAAIC,MAAMC,OAAOF;QAC5F,OAAOH,QAAQC,OAAO,CAAC;YACrBa,OAAO;YACPX,OAAO;QACT;IACF;AACF"}
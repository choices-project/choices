{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/pwa/components/NotificationPreferences.tsx"],"sourcesContent":["'use client'\n\nimport { Bell, BellOff, Settings, AlertCircle } from 'lucide-react'\nimport { useState, useEffect } from 'react'\n\nimport { usePWA } from '@/hooks/usePWA'\nimport { logger } from '@/lib/utils/logger'\n\ninterface NotificationPreferencesProps {\n  className?: string\n}\n\nexport default function NotificationPreferences({ className = '' }: NotificationPreferencesProps) {\n  const pwa = usePWA()\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState<string | null>(null)\n  const [notificationPermission, setNotificationPermission] = useState<NotificationPermission>('default')\n  const [preferences, setPreferences] = useState({\n    pollNotifications: true,\n    commentNotifications: true,\n    systemNotifications: true,\n    emailNotifications: false\n  })\n\n  useEffect(() => {\n    if (pwa.notificationsSupported) {\n      setNotificationPermission(pwa.notificationsPermission)\n    }\n  }, [pwa.notificationsSupported, pwa.notificationsPermission])\n\n  const handleRequestPermission = async () => {\n    setIsLoading(true)\n    setError(null)\n    setSuccess(null)\n    \n    try {\n      const granted = await pwa.requestNotificationPermission()\n      if (granted) {\n        setNotificationPermission('granted')\n        setSuccess('Notification permission granted!')\n        logger.info('Notification permission granted')\n      } else {\n        setNotificationPermission('denied')\n        setError('Notification permission denied.')\n        logger.warn('Notification permission denied')\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to request notification permission.')\n      logger.error('Error requesting notification permission:', err as Error)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleSubscribe = async () => {\n    setIsLoading(true)\n    setError(null)\n    setSuccess(null)\n    \n    try {\n      const subscribed = await pwa.subscribeToNotifications()\n      if (subscribed) {\n        setSuccess('Successfully subscribed to push notifications!')\n        logger.info('Subscribed to push notifications')\n      } else {\n        setError('Failed to subscribe to push notifications.')\n        logger.error('Failed to subscribe to push notifications')\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to subscribe to push notifications.')\n      logger.error('Error subscribing to push notifications:', err as Error)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleUnsubscribe = async () => {\n    setIsLoading(true)\n    setError(null)\n    setSuccess(null)\n    \n    try {\n      const unsubscribed = await pwa.unsubscribeFromNotifications()\n      if (unsubscribed) {\n        setSuccess('Successfully unsubscribed from push notifications.')\n        logger.info('Unsubscribed from push notifications')\n      } else {\n        setError('Failed to unsubscribe from push notifications.')\n        logger.error('Failed to unsubscribe from push notifications')\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to unsubscribe from push notifications.')\n      logger.error('Error unsubscribing from push notifications:', err as Error)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handlePreferenceChange = (key: keyof typeof preferences) => {\n    setPreferences(prev => ({\n      ...prev,\n      [key]: !prev[key]\n    }))\n  }\n\n  if (!pwa.notificationsSupported) {\n    return (\n      <div className=\"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-md\">\n        <div className=\"flex\">\n          <div className=\"flex-shrink-0\">\n            <AlertCircle className=\"h-5 w-5 text-yellow-400\" aria-hidden=\"true\" />\n          </div>\n          <div className=\"ml-3\">\n            <p className=\"text-sm text-yellow-800\">\n              Notifications are not supported in your browser.\n            </p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className={`bg-white shadow-sm rounded-lg p-6 ${className}`} data-testid=\"notification-preferences\">\n      <h2 className=\"text-xl font-semibold text-gray-900 mb-4 flex items-center\">\n        <Settings className=\"h-5 w-5 mr-2 text-blue-600\" /> Notification Preferences\n      </h2>\n\n      {error && (\n        <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4\" role=\"alert\" data-testid=\"notification-error\">\n          <span className=\"block sm:inline\">{error}</span>\n        </div>\n      )}\n      \n      {success && (\n        <div className=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4\" role=\"alert\">\n          <span className=\"block sm:inline\">{success}</span>\n        </div>\n      )}\n\n      <div className=\"space-y-4\">\n        {/* Permission Status */}\n        <div>\n          <p className=\"text-sm text-gray-700 mb-2\">\n            Current permission status: <span className={`font-medium ${notificationPermission === 'granted' ? 'text-green-600' : notificationPermission === 'denied' ? 'text-red-600' : 'text-gray-600'}`}>\n              {notificationPermission.charAt(0).toUpperCase() + notificationPermission.slice(1)}\n            </span>\n          </p>\n          \n          {notificationPermission === 'default' && (\n            <button\n              onClick={handleRequestPermission}\n              disabled={isLoading}\n              className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\n              data-testid=\"request-notification-permission\"\n            >\n              <Bell className=\"h-5 w-5 mr-2\" />\n              {isLoading ? 'Requesting...' : 'Request Notification Permission'}\n            </button>\n          )}\n          \n          {notificationPermission === 'granted' && (\n            <div className=\"flex space-x-2\">\n              <button\n                onClick={handleSubscribe}\n                disabled={isLoading || pwa.notificationsEnabled}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50\"\n                data-testid=\"subscribe-notifications\"\n              >\n                <Bell className=\"h-5 w-5 mr-2\" />\n                {isLoading ? 'Subscribing...' : 'Subscribe to Push Notifications'}\n              </button>\n              <button\n                onClick={handleUnsubscribe}\n                disabled={isLoading || !pwa.notificationsEnabled}\n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n              >\n                <BellOff className=\"h-5 w-5 mr-2\" />\n                {isLoading ? 'Unsubscribing...' : 'Unsubscribe'}\n              </button>\n            </div>\n          )}\n          \n          {notificationPermission === 'denied' && (\n            <p className=\"text-sm text-red-600 mt-2\">\n              Notifications are blocked. Please enable them in your browser settings.\n            </p>\n          )}\n        </div>\n\n        {/* Notification Types */}\n        <div className=\"space-y-3\">\n          <h3 className=\"text-lg font-medium text-gray-900\">Notification Types</h3>\n          \n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <Bell className=\"h-5 w-5 text-blue-600\" />\n              <div>\n                <label className=\"text-sm font-medium text-gray-700\">Poll Notifications</label>\n                <p className=\"text-xs text-gray-500\">Get notified about new polls and results</p>\n              </div>\n            </div>\n            <button\n              onClick={() => handlePreferenceChange('pollNotifications')}\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                preferences.pollNotifications ? 'bg-blue-600' : 'bg-gray-200'\n              }`}\n              data-testid=\"poll-notifications-toggle\"\n            >\n              <span\n                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                  preferences.pollNotifications ? 'translate-x-6' : 'translate-x-1'\n                }`}\n              />\n            </button>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <Bell className=\"h-5 w-5 text-green-600\" />\n              <div>\n                <label className=\"text-sm font-medium text-gray-700\">Comment Notifications</label>\n                <p className=\"text-xs text-gray-500\">Get notified about new comments on polls</p>\n              </div>\n            </div>\n            <button\n              onClick={() => handlePreferenceChange('commentNotifications')}\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                preferences.commentNotifications ? 'bg-green-600' : 'bg-gray-200'\n              }`}\n              data-testid=\"comment-notifications-toggle\"\n            >\n              <span\n                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                  preferences.commentNotifications ? 'translate-x-6' : 'translate-x-1'\n                }`}\n              />\n            </button>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <Bell className=\"h-5 w-5 text-purple-600\" />\n              <div>\n                <label className=\"text-sm font-medium text-gray-700\">System Notifications</label>\n                <p className=\"text-xs text-gray-500\">Get notified about system updates and maintenance</p>\n              </div>\n            </div>\n            <button\n              onClick={() => handlePreferenceChange('systemNotifications')}\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                preferences.systemNotifications ? 'bg-purple-600' : 'bg-gray-200'\n              }`}\n              data-testid=\"system-notifications-toggle\"\n            >\n              <span\n                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                  preferences.systemNotifications ? 'translate-x-6' : 'translate-x-1'\n                }`}\n              />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":["NotificationPreferences","className","pwa","usePWA","isLoading","setIsLoading","useState","error","setError","success","setSuccess","notificationPermission","setNotificationPermission","preferences","setPreferences","pollNotifications","commentNotifications","systemNotifications","emailNotifications","useEffect","notificationsSupported","notificationsPermission","handleRequestPermission","granted","requestNotificationPermission","logger","info","warn","err","Error","message","handleSubscribe","subscribed","subscribeToNotifications","handleUnsubscribe","unsubscribed","unsubscribeFromNotifications","handlePreferenceChange","key","prev","div","AlertCircle","aria-hidden","p","data-testid","h2","Settings","role","span","charAt","toUpperCase","slice","button","onClick","disabled","Bell","notificationsEnabled","BellOff","h3","label"],"mappings":"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"}
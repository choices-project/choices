{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/stores/store-type-safety.test.ts"],"sourcesContent":["/**\n * Store Type Safety Tests\n * \n * Validates that all Zustand stores have proper type definitions,\n * index signatures, and error handling patterns.\n * \n * Created: January 27, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect } from '@jest/globals';\nimport { logger } from '@/lib/utils/logger';\nimport * as fs from 'fs';\nimport * as glob from 'glob';\n\ndescribe('Store Type Safety', () => {\n  it('all stores should have proper index signatures', () => {\n    const storeFiles = glob.sync('web/lib/stores/*.ts', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicStores: string[] = [];\n    \n    storeFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for interfaces that need index signatures\n      const interfaceMatches = content.match(/interface\\s+(\\w+)\\s*\\{[^}]*\\}/g);\n      if (interfaceMatches) {\n        interfaceMatches.forEach(match => {\n          const interfaceName = match.match(/interface\\s+(\\w+)/)?.[1];\n          if (interfaceName && !match.includes('[key: string]: unknown')) {\n            // Check if this interface is used in store contexts\n            if (content.includes('use' + interfaceName) || content.includes(interfaceName + 'Store')) {\n              problematicStores.push(`${file}: interface '${interfaceName}' needs index signature`);\n            }\n          }\n        });\n      }\n    });\n    \n    if (problematicStores.length > 0) {\n      logger.info('Stores needing index signatures:', problematicStores);\n    }\n    \n    expect(problematicStores).toHaveLength(0);\n  });\n\n  it('store actions should be properly typed', () => {\n    const storeFiles = glob.sync('web/lib/stores/*.ts', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicStores: string[] = [];\n    \n    storeFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for action functions that should be properly typed\n      const actionMatches = content.match(/(\\w+):\\s*\\([^)]*\\)\\s*=>/g);\n      if (actionMatches) {\n        actionMatches.forEach(match => {\n          const actionName = match.match(/(\\w+):/)?.[1];\n          if (actionName && !match.includes(':')) {\n            problematicStores.push(`${file}: action '${actionName}' needs proper typing`);\n          }\n        });\n      }\n    });\n    \n    if (problematicStores.length > 0) {\n      logger.info('Stores with untyped actions:', problematicStores);\n    }\n    \n    expect(problematicStores).toHaveLength(0);\n  });\n\n  it('store subscriptions should be properly implemented', () => {\n    const storeFiles = glob.sync('web/lib/stores/*.ts', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicStores: string[] = [];\n    \n    storeFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for subscription methods\n      if (content.includes('subscribe')) {\n        // Should have proper subscription implementation\n        if (!content.includes('useStore.subscribe')) {\n          problematicStores.push(`${file}: subscription methods should use useStore.subscribe`);\n        }\n      }\n    });\n    \n    if (problematicStores.length > 0) {\n      logger.info('Stores with improper subscriptions:', problematicStores);\n    }\n    \n    expect(problematicStores).toHaveLength(0);\n  });\n\n  it('store error handling should be comprehensive', () => {\n    const storeFiles = glob.sync('web/lib/stores/*.ts', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicStores: string[] = [];\n    \n    storeFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for async actions that should have error handling\n      const asyncActions = content.match(/(\\w+):\\s*async\\s*\\([^)]*\\)\\s*=>/g);\n      if (asyncActions) {\n        asyncActions.forEach(match => {\n          const actionName = match.match(/(\\w+):/)?.[1];\n          if (actionName && !content.includes(`try {`) && !content.includes(`catch`)) {\n            problematicStores.push(`${file}: async action '${actionName}' needs error handling`);\n          }\n        });\n      }\n    });\n    \n    if (problematicStores.length > 0) {\n      logger.info('Stores with missing error handling:', problematicStores);\n    }\n    \n    expect(problematicStores).toHaveLength(0);\n  });\n\n  it('store imports should use centralized pattern', () => {\n    const componentFiles = glob.sync('web/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**', '**/lib/stores/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    componentFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for direct Zustand imports\n      if (content.includes('from \\'zustand\\'') || content.includes('from \"zustand\"')) {\n        problematicFiles.push(`${file}: should use centralized store imports`);\n      }\n      \n      // Check for direct store imports\n      if (content.includes('from \\'../stores/') || content.includes('from \"../stores/')) {\n        problematicFiles.push(`${file}: should use @/lib/stores imports`);\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Files with improper store imports:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n});\n"],"names":["describe","it","storeFiles","glob","sync","ignore","problematicStores","forEach","file","content","fs","readFileSync","interfaceMatches","match","interfaceName","includes","push","length","logger","info","expect","toHaveLength","actionMatches","actionName","asyncActions","componentFiles","problematicFiles"],"mappings":"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"}
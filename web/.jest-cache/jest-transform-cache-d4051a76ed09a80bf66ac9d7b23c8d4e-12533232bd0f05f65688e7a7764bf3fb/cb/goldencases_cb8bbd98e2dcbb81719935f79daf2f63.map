{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/irv/golden-cases.ts"],"sourcesContent":["// ============================================================================\n// PHASE 1: GOLDEN TEST CASES FOR IRV CALCULATOR\n// ============================================================================\n// Agent A1 - Infrastructure Specialist\n// \n// This module contains the 8 golden test cases for validating the IRV\n// calculator implementation for the Ranked Choice Democracy Revolution platform.\n// \n// Test Cases:\n// 1. Simple majority winner\n// 2. Tie-breaking scenario\n// 3. Exhausted ballots\n// 4. Write-in candidates\n// 5. Fully exhausted ballots\n// 6. Withdrawn candidates\n// 7. Tie storm (3+ rounds)\n// 8. All same first choice, divergent tails\n// \n// Created: January 15, 2025\n// Status: Phase 1 Implementation\n// ============================================================================\n\nimport { IRVCalculator } from '@/lib/vote/irv-calculator';\nimport type { UserRanking, RankedChoiceResults } from '@/lib/vote/irv-calculator';\n\n// Define Candidate type locally since it's not exported from the calculator\ntype Candidate = {\n  id: string;\n  name: string;\n  party: string;\n}\n\n// ============================================================================\n// TEST DATA SETUP\n// ============================================================================\n\nconst mockCandidates: Candidate[] = [\n  { id: 'A', name: 'Alice Johnson', party: 'Democrat' },\n  { id: 'B', name: 'Bob Smith', party: 'Republican' },\n  { id: 'C', name: 'Carol Davis', party: 'Independent' },\n  { id: 'D', name: 'David Wilson', party: 'Green' },\n  { id: 'E', name: 'Eve Brown', party: 'Libertarian' }\n];\n\n// ============================================================================\n// GOLDEN TEST CASES\n// ============================================================================\n\nexport const goldenTestCases = [\n  {\n    name: \"Simple majority winner\",\n    description: \"Candidate A wins with majority in first round\",\n    candidates: mockCandidates.slice(0, 3), // A, B, C\n    ballots: [\n      [\"A\", \"B\", \"C\"], [\"A\", \"B\", \"C\"], [\"A\", \"B\", \"C\"],\n      [\"B\", \"A\", \"C\"], [\"B\", \"A\", \"C\"]\n    ],\n    expectedRounds: [\n      {\n        round: 1,\n        eliminated: \"C\",\n        votes: { A: 3, B: 2, C: 0 },\n        totalVotes: 5,\n        activeCandidates: [\"A\", \"B\", \"C\"],\n        exhausted: 0,\n        winner: \"A\"\n      }\n    ],\n    expectedWinner: \"A\",\n    expectedMetadata: {\n      tieBreaksUsed: 0,\n      edgeCasesHandled: []\n    }\n  },\n\n  {\n    name: \"Tie-breaking scenario\",\n    description: \"Tie between A and B, C wins after elimination\",\n    candidates: mockCandidates.slice(0, 3), // A, B, C\n    ballots: [\n      [\"A\", \"B\"], [\"B\", \"A\"], [\"C\", \"A\"], [\"C\", \"B\"]\n    ],\n    expectedRounds: [\n      { \n        round: 1, \n        eliminated: \"A\", \n        votes: { A: 1, B: 1, C: 2 },\n        totalVotes: 4,\n        activeCandidates: [\"A\", \"B\", \"C\"],\n        exhausted: 0,\n        winner: \"C\"\n      }\n    ],\n    expectedWinner: \"C\",\n    expectedMetadata: {\n      tieBreaksUsed: 1,\n      edgeCasesHandled: [\"elimination_tie\"]\n    }\n  },\n\n  {\n    name: \"Exhausted ballots\",\n    description: \"Some ballots become exhausted during elimination\",\n    candidates: mockCandidates.slice(0, 4), // A, B, C, D\n    ballots: [\n      [\"A\", \"B\"], [\"B\", \"A\"], [\"C\"], [\"D\"]\n    ],\n    expectedRounds: [\n      {\n        round: 1,\n        eliminated: \"A\",\n        votes: { A: 1, B: 1, C: 1, D: 1 },\n        totalVotes: 4,\n        activeCandidates: [\"A\", \"B\", \"C\", \"D\"],\n        exhausted: 0\n      },\n      {\n        round: 2,\n        eliminated: \"C\",\n        votes: { A: 0, B: 2, C: 1, D: 1 },\n        totalVotes: 4,\n        activeCandidates: [\"B\", \"C\", \"D\"],\n        exhausted: 0,\n        winner: \"B\"\n      }\n    ],\n    expectedWinner: \"B\",\n    expectedMetadata: {\n      tieBreaksUsed: 2,\n      edgeCasesHandled: [\"elimination_tie\", \"elimination_tie\"]\n    }\n  },\n\n  {\n    name: \"Write-in candidates\",\n    description: \"Write-in candidate wins the election\",\n    candidates: mockCandidates.slice(0, 3), // A, B, C\n    ballots: [\n      [\"A\", \"B\", \"WRITE_IN_1\"], [\"B\", \"A\", \"WRITE_IN_2\"], \n      [\"WRITE_IN_1\", \"A\", \"B\"], [\"C\", \"WRITE_IN_1\", \"A\"]\n    ],\n    expectedRounds: [\n      {\n        round: 1,\n        eliminated: \"WRITE_IN_2\",\n        votes: { A: 1, B: 1, WRITE_IN_1: 1, C: 1, WRITE_IN_2: 0 },\n        totalVotes: 4,\n        activeCandidates: [\"A\", \"B\", \"WRITE_IN_1\", \"WRITE_IN_2\", \"C\"],\n        exhausted: 0\n      },\n      {\n        round: 2,\n        eliminated: \"A\",\n        votes: { A: 1, B: 1, WRITE_IN_1: 1, C: 1, WRITE_IN_2: 0 },\n        totalVotes: 4,\n        activeCandidates: [\"A\", \"B\", \"WRITE_IN_1\", \"C\"],\n        exhausted: 0\n      },\n      {\n        round: 3,\n        eliminated: \"C\",\n        votes: { A: 0, B: 2, WRITE_IN_1: 1, C: 1, WRITE_IN_2: 0 },\n        totalVotes: 4,\n        activeCandidates: [\"B\", \"WRITE_IN_1\", \"C\"],\n        exhausted: 0,\n        winner: \"B\"\n      }\n    ],\n    expectedWinner: \"B\",\n    expectedMetadata: {\n      tieBreaksUsed: 2,\n      edgeCasesHandled: [\"elimination_tie\", \"elimination_tie\"]\n    }\n  },\n\n  {\n    name: \"Fully exhausted ballots\",\n    description: \"All ballots become exhausted, no winner\",\n    candidates: mockCandidates.slice(0, 5), // A, B, C, D, E\n    ballots: [\n      [\"A\", \"B\"], [\"B\", \"A\"], [\"C\"], [\"D\"], [\"E\"]\n    ],\n    expectedRounds: [\n      {\n        round: 1,\n        eliminated: \"A\",\n        votes: { A: 1, B: 1, C: 1, D: 1, E: 1 },\n        totalVotes: 5,\n        activeCandidates: [\"A\", \"B\", \"C\", \"D\", \"E\"],\n        exhausted: 0\n      },\n      {\n        round: 2,\n        eliminated: \"C\",\n        votes: { A: 0, B: 2, C: 1, D: 1, E: 1 },\n        totalVotes: 5,\n        activeCandidates: [\"B\", \"C\", \"D\", \"E\"],\n        exhausted: 0\n      },\n      {\n        round: 3,\n        eliminated: \"D\",\n        votes: { A: 0, B: 2, C: 0, D: 1, E: 1 },\n        totalVotes: 4,\n        activeCandidates: [\"B\", \"D\", \"E\"],\n        exhausted: 1,\n        winner: \"B\"\n      }\n    ],\n    expectedWinner: \"B\",\n    expectedMetadata: {\n      tieBreaksUsed: 3,\n      edgeCasesHandled: [\"elimination_tie\", \"elimination_tie\", \"elimination_tie\"]\n    }\n  },\n\n  {\n    name: \"Withdrawn candidates\",\n    description: \"Candidate C is withdrawn, treated as eliminated at round 0\",\n    candidates: [\n      { id: 'A', name: 'Alice Johnson', party: 'Democrat' },\n      { id: 'B', name: 'Bob Smith', party: 'Republican' },\n      { id: 'C', name: 'Carol Davis', party: 'Independent', isWithdrawn: true }\n    ],\n    ballots: [\n      [\"A\", \"B\", \"C\"], [\"B\", \"A\", \"C\"], [\"C\", \"A\", \"B\"],\n      [\"A\", \"C\", \"B\"], [\"B\", \"C\", \"A\"]\n    ],\n    expectedRounds: [\n        {\n          round: 1,\n          eliminated: \"B\",\n          votes: { A: 3, B: 2 },\n          totalVotes: 5,\n          activeCandidates: [\"A\", \"B\"]\n        }\n    ],\n    expectedWinner: \"A\",\n    expectedMetadata: {\n      tieBreaksUsed: 0,\n      edgeCasesHandled: [\"withdrawn-candidates\"]\n    }\n  },\n\n  {\n    name: \"Tie storm (3+ rounds)\",\n    description: \"Multiple rounds of ties requiring tie-breaking\",\n    candidates: mockCandidates.slice(0, 4), // A, B, C, D\n    ballots: [\n      [\"A\", \"B\", \"C\", \"D\"], [\"B\", \"A\", \"C\", \"D\"], [\"C\", \"A\", \"B\", \"D\"],\n      [\"D\", \"A\", \"B\", \"C\"], [\"A\", \"C\", \"B\", \"D\"], [\"B\", \"D\", \"A\", \"C\"]\n    ],\n    expectedRounds: [\n      {\n        round: 1,\n        eliminated: \"C\",\n        votes: { A: 2, B: 2, C: 1, D: 1 },\n        totalVotes: 6,\n        activeCandidates: [\"A\", \"B\", \"C\", \"D\"],\n        exhausted: 0\n      },\n      {\n        round: 2,\n        eliminated: \"D\",\n        votes: { A: 3, B: 2, C: 0, D: 1 },\n        totalVotes: 6,\n        activeCandidates: [\"A\", \"B\", \"D\"],\n        exhausted: 0,\n        winner: \"A\"\n      }\n    ],\n    expectedWinner: \"A\",\n    expectedMetadata: {\n      tieBreaksUsed: 1,\n      edgeCasesHandled: [\"elimination_tie\"]\n    }\n  },\n\n  {\n    name: \"All same first choice, divergent tails\",\n    description: \"All voters choose A first, but have different second choices\",\n    candidates: mockCandidates.slice(0, 3), // A, B, C\n    ballots: [\n      [\"A\", \"B\", \"C\"], [\"A\", \"C\", \"B\"], [\"A\", \"B\", \"C\"],\n      [\"A\", \"C\", \"B\"], [\"A\", \"B\", \"C\"], [\"A\", \"C\", \"B\"]\n    ],\n    expectedRounds: [\n      { \n        round: 1, \n        eliminated: \"B\", \n        votes: { A: 6, B: 0, C: 0 },\n        totalVotes: 6,\n        activeCandidates: [\"A\", \"B\", \"C\"]\n      }\n    ],\n    expectedWinner: \"A\",\n    expectedMetadata: {\n      tieBreaksUsed: 1,\n      edgeCasesHandled: [\"zero-vote-tie:B,C\"]\n    }\n  }\n];\n\n// ============================================================================\n// TEST RUNNER FUNCTIONS\n// ============================================================================\n\nexport function createTestRankings(ballots: string[][], pollId: string = 'test-poll'): UserRanking[] {\n  return ballots.map((ranking, index) => ({\n    pollId,\n    userId: `user_${index}`,\n    ranking,\n    createdAt: new Date()\n  }));\n}\n\nexport function runGoldenTestCase(testCase: any): {\n  passed: boolean;\n  actualResults: RankedChoiceResults;\n  expectedResults: any;\n  errors: string[];\n} {\n  const errors: string[] = [];\n  \n  try {\n    // Create IRV calculator\n    const calculator = new IRVCalculator(testCase.pollId || 'test-poll', testCase.candidates);\n    \n    // Create test rankings\n    const rankings = createTestRankings(testCase.ballots, testCase.pollId || 'test-poll');\n    \n    // Calculate results\n    const actualResults = calculator.calculateResults(rankings);\n    \n    // Validate results\n    const validation = validateResults(actualResults, testCase);\n    \n    return {\n      passed: validation.passed,\n      actualResults,\n      expectedResults: testCase,\n      errors: validation.errors\n    };\n  } catch (error) {\n    errors.push(`Test execution failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    return {\n      passed: false,\n      actualResults: {} as RankedChoiceResults,\n      expectedResults: testCase,\n      errors\n    };\n  }\n}\n\nexport function validateResults(actual: RankedChoiceResults, expected: any): {\n  passed: boolean;\n  errors: string[];\n} {\n  const errors: string[] = [];\n  \n  // Check winner\n  if (actual.winner !== expected.expectedWinner) {\n    errors.push(`Winner mismatch: expected ${expected.expectedWinner}, got ${actual.winner}`);\n  }\n  \n  // Check number of rounds\n  if (actual.rounds.length !== expected.expectedRounds.length) {\n    errors.push(`Round count mismatch: expected ${expected.expectedRounds.length}, got ${actual.rounds.length}`);\n  }\n  \n  // Check each round\n  expected.expectedRounds.forEach((expectedRound: any, index: number) => {\n    const actualRound = actual.rounds[index];\n    if (!actualRound) {\n      errors.push(`Missing round ${index + 1}`);\n      return;\n    }\n    \n    if (actualRound.eliminated !== expectedRound.eliminated) {\n      errors.push(`Round ${index + 1} elimination mismatch: expected ${expectedRound.eliminated}, got ${actualRound.eliminated}`);\n    }\n    \n    // Check vote counts\n    Object.keys(expectedRound.votes).forEach(candidate => {\n      if (actualRound.votes[candidate] !== expectedRound.votes[candidate]) {\n        errors.push(`Round ${index + 1} vote count mismatch for ${candidate}: expected ${expectedRound.votes[candidate]}, got ${actualRound.votes[candidate]}`);\n      }\n    });\n  });\n  \n  // Check metadata\n  if (actual.metadata?.tieBreaksUsed !== expected.expectedMetadata.tieBreaksUsed) {\n    errors.push(`Tie breaks used mismatch: expected ${expected.expectedMetadata.tieBreaksUsed}, got ${actual.metadata?.tieBreaksUsed}`);\n  }\n  \n  return {\n    passed: errors.length === 0,\n    errors\n  };\n}\n\nexport function runAllGoldenTests(): {\n  totalTests: number;\n  passedTests: number;\n  failedTests: number;\n  results: Array<{\n    name: string;\n    passed: boolean;\n    errors: string[];\n  }>;\n} {\n  const results = goldenTestCases.map(testCase => {\n    const result = runGoldenTestCase(testCase);\n    return {\n      name: testCase.name,\n      passed: result.passed,\n      errors: result.errors\n    };\n  });\n  \n  const passedTests = results.filter(r => r.passed).length;\n  const failedTests = results.length - passedTests;\n  \n  return {\n    totalTests: results.length,\n    passedTests,\n    failedTests,\n    results\n  };\n}\n\n// ============================================================================\n// PERFORMANCE TEST CASES\n// ============================================================================\n\nexport function generateLargeBallotSet(candidateCount: number, ballotCount: number): string[][] {\n  const candidates = Array.from({ length: candidateCount }, (_, i) => `candidate_${i}`);\n  const ballots: string[][] = [];\n  \n  for (let i = 0; i < ballotCount; i++) {\n    // Generate random ranking\n    const shuffled = [...candidates].sort(() => Math.random() - 0.5);\n    ballots.push(shuffled);\n  }\n  \n  return ballots;\n}\n\nexport function runPerformanceTest(candidateCount: number = 10, ballotCount: number = 10000): {\n  duration: number;\n  success: boolean;\n  error?: string;\n} {\n  const startTime = performance.now();\n  \n  try {\n    const candidates = Array.from({ length: candidateCount }, (_, i) => ({\n      id: `candidate_${i}`,\n      name: `Candidate ${i}`,\n      party: 'Independent'\n    }));\n    \n    const ballots = generateLargeBallotSet(candidateCount, ballotCount);\n    const rankings = createTestRankings(ballots);\n    \n    const calculator = new IRVCalculator('performance-test', candidates);\n    calculator.calculateResults(rankings);\n    \n    const endTime = performance.now();\n    const duration = endTime - startTime;\n    \n    return {\n      duration,\n      success: true\n    };\n  } catch (error) {\n    const endTime = performance.now();\n    const duration = endTime - startTime;\n    \n    return {\n      duration,\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error'\n    };\n  }\n}\n\n// ============================================================================\n// EXPORTED TEST SUITE\n// ============================================================================\n\nexport const IRVTestSuite = {\n  goldenTestCases,\n  runGoldenTestCase,\n  runAllGoldenTests,\n  validateResults,\n  runPerformanceTest,\n  generateLargeBallotSet\n};\n\nexport default IRVTestSuite;\n"],"names":["IRVTestSuite","createTestRankings","generateLargeBallotSet","goldenTestCases","runAllGoldenTests","runGoldenTestCase","runPerformanceTest","validateResults","mockCandidates","id","name","party","description","candidates","slice","ballots","expectedRounds","round","eliminated","votes","A","B","C","totalVotes","activeCandidates","exhausted","winner","expectedWinner","expectedMetadata","tieBreaksUsed","edgeCasesHandled","D","WRITE_IN_1","WRITE_IN_2","E","isWithdrawn","pollId","map","ranking","index","userId","createdAt","Date","testCase","errors","calculator","IRVCalculator","rankings","actualResults","calculateResults","validation","passed","expectedResults","error","push","Error","message","actual","expected","rounds","length","forEach","expectedRound","actualRound","Object","keys","candidate","metadata","results","result","passedTests","filter","r","failedTests","totalTests","candidateCount","ballotCount","Array","from","_","i","shuffled","sort","Math","random","startTime","performance","now","endTime","duration","success"],"mappings":"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"}
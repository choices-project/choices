{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/hooks/useSocialSharing.ts"],"sourcesContent":["/**\n * Social Sharing Hook\n * \n * Unified social sharing functionality that can be used across all components.\n * Integrates with the existing PollShare component logic and provides\n * consistent sharing experience across the platform.\n * \n * Created: January 23, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { useState, useCallback } from 'react';\nimport { isFeatureEnabled } from '@/lib/core/feature-flags';\nimport { devLog } from '@/lib/utils/logger';\n\nexport interface SocialSharingOptions {\n  title: string;\n  description?: string;\n  url: string;\n  pollId?: string;\n  contentType?: 'poll' | 'representative' | 'feed';\n  placement?: string;\n}\n\nexport interface SocialSharingResult {\n  success: boolean;\n  platform?: string;\n  error?: string;\n}\n\nexport function useSocialSharing() {\n  const [isSharing, setIsSharing] = useState(false);\n  const [shareError, setShareError] = useState<string | null>(null);\n\n  const socialSharingEnabled = isFeatureEnabled('SOCIAL_SHARING_POLLS');\n\n  const trackShareEvent = useCallback(async (platform: string, options: SocialSharingOptions) => {\n    try {\n      // Track share event for analytics\n      const response = await fetch('/api/share', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          platform,\n          poll_id: options.pollId,\n          placement: options.placement || 'feed',\n          content_type: options.contentType || 'poll',\n        }),\n      });\n\n      if (!response.ok) {\n        devLog('Failed to track share event:', { platform, options });\n      }\n    } catch (error) {\n      devLog('Error tracking share event:', { error, platform, options });\n    }\n  }, []);\n\n  const shareToPlatform = useCallback(async (platform: string, options: SocialSharingOptions): Promise<SocialSharingResult> => {\n    if (!socialSharingEnabled) {\n      return { success: false, error: 'Social sharing is disabled' };\n    }\n\n    setIsSharing(true);\n    setShareError(null);\n\n    try {\n      const encodedUrl = encodeURIComponent(options.url);\n      const encodedTitle = encodeURIComponent(options.title);\n      const encodedDescription = encodeURIComponent(options.description || '');\n\n      let shareUrl = '';\n      \n      switch (platform) {\n        case 'twitter':\n          shareUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`;\n          break;\n        case 'facebook':\n          shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;\n          break;\n        case 'linkedin':\n          shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`;\n          break;\n        case 'reddit':\n          shareUrl = `https://www.reddit.com/submit?url=${encodedUrl}&title=${encodedTitle}`;\n          break;\n        case 'whatsapp':\n          const whatsappMessage = `${options.title} - ${options.url}`;\n          shareUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(whatsappMessage)}`;\n          break;\n        case 'telegram':\n          shareUrl = `https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}`;\n          break;\n        case 'email':\n          shareUrl = `mailto:?subject=${encodedTitle}&body=${encodedDescription}%0A%0A${options.url}`;\n          break;\n        case 'sms':\n          const smsMessage = `${options.title} - ${options.url}`;\n          shareUrl = `sms:?body=${encodeURIComponent(smsMessage)}`;\n          break;\n        default:\n          throw new Error(`Unsupported platform: ${platform}`);\n      }\n\n      // Open share URL\n      window.open(shareUrl, '_blank', 'width=600,height=400');\n\n      // Track the share event\n      await trackShareEvent(platform, options);\n\n      return { success: true, platform };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to share';\n      setShareError(errorMessage);\n      return { success: false, error: errorMessage };\n    } finally {\n      setIsSharing(false);\n    }\n  }, [socialSharingEnabled, trackShareEvent]);\n\n  const shareNative = useCallback(async (options: SocialSharingOptions): Promise<SocialSharingResult> => {\n    if (typeof navigator === 'undefined' || !navigator.share) {\n      return { success: false, error: 'Native sharing not supported' };\n    }\n\n    setIsSharing(true);\n    setShareError(null);\n\n    try {\n      await navigator.share({\n        title: options.title,\n        text: options.description || '',\n        url: options.url,\n      });\n\n      // Track native share event\n      await trackShareEvent('native', options);\n\n      return { success: true, platform: 'native' };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to share';\n      setShareError(errorMessage);\n      return { success: false, error: errorMessage };\n    } finally {\n      setIsSharing(false);\n    }\n  }, [trackShareEvent]);\n\n  const copyToClipboard = useCallback(async (options: SocialSharingOptions): Promise<SocialSharingResult> => {\n    setIsSharing(true);\n    setShareError(null);\n\n    try {\n      await navigator.clipboard.writeText(options.url);\n      \n      // Track clipboard share event\n      await trackShareEvent('clipboard', options);\n\n      return { success: true, platform: 'clipboard' };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to copy to clipboard';\n      setShareError(errorMessage);\n      return { success: false, error: errorMessage };\n    } finally {\n      setIsSharing(false);\n    }\n  }, [trackShareEvent]);\n\n  const clearError = useCallback(() => {\n    setShareError(null);\n  }, []);\n\n  return {\n    isSharing,\n    shareError,\n    socialSharingEnabled,\n    shareToPlatform,\n    shareNative,\n    copyToClipboard,\n    clearError,\n  };\n}\n"],"names":["useSocialSharing","isSharing","setIsSharing","useState","shareError","setShareError","socialSharingEnabled","isFeatureEnabled","trackShareEvent","useCallback","platform","options","response","fetch","method","headers","body","JSON","stringify","poll_id","pollId","placement","content_type","contentType","ok","devLog","error","shareToPlatform","success","encodedUrl","encodeURIComponent","url","encodedTitle","title","encodedDescription","description","shareUrl","whatsappMessage","smsMessage","Error","window","open","errorMessage","message","shareNative","navigator","share","text","copyToClipboard","clipboard","writeText","clearError"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/features/trending-polls-hashtag-integration.test.ts"],"sourcesContent":["/**\n * Integration Tests for Trending Polls (Hashtag-Based Implementation)\n * \n * Tests the integration between trending polls feature and hashtag system:\n * - HashtagPollsIntegrationService\n * - TrendingHashtagsTracker\n * - HashtagPollsFeed component\n * - Trending polls API endpoints\n * \n * Created: January 23, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect, beforeEach, afterEach, jest } from '@jest/globals';\nimport { HashtagPollsIntegrationService } from '@/features/feeds/lib/hashtag-polls-integration';\nimport { TrendingHashtagsTracker } from '@/features/feeds/lib/TrendingHashtags';\nimport { calculateTrendingHashtags } from '@/features/hashtags/lib/hashtag-analytics';\nimport { T } from '@/tests/registry/testIds';\n\n// Mock Supabase\nconst mockSupabase = {\n  from: jest.fn(() => ({\n    select: jest.fn(() => ({\n      eq: jest.fn(() => ({\n        gte: jest.fn(() => ({\n          order: jest.fn(() => ({\n            limit: jest.fn(() => Promise.resolve({ data: [], error: null }))\n          }))\n        }))\n      }))\n    })),\n    insert: jest.fn(() => Promise.resolve({ data: [], error: null })),\n    update: jest.fn(() => Promise.resolve({ data: [], error: null }))\n  }))\n};\n\njest.mock('@/lib/supabase/client', () => ({\n  createClient: () => mockSupabase\n}));\n\ndescribe('Trending Polls - Hashtag Integration Tests', () => {\n  let hashtagService: HashtagPollsIntegrationService;\n  let trendingTracker: TrendingHashtagsTracker;\n\n  beforeEach(() => {\n    hashtagService = new HashtagPollsIntegrationService(mockSupabase);\n    trendingTracker = TrendingHashtagsTracker.getInstance();\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    jest.resetAllMocks();\n  });\n\n  describe('HashtagPollsIntegrationService', () => {\n    it('should generate personalized feed with trending hashtags', async () => {\n      const mockUserId = 'test-user-123';\n      const mockHashtagData = [\n        { hashtag: '#politics', usage_count: 45, recency_score: 0.8 },\n        { hashtag: '#climate', usage_count: 32, recency_score: 0.9 },\n        { hashtag: '#economy', usage_count: 28, recency_score: 0.7 }\n      ];\n\n      // Mock the analytics_events query\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            gte: jest.fn(() => ({\n              order: jest.fn(() => Promise.resolve({ \n                data: mockHashtagData, \n                error: null \n              }))\n            }))\n          }))\n        }))\n      });\n\n      const result = await hashtagService.generatePersonalizedFeed(mockUserId, 10);\n      \n      expect(result).toBeDefined();\n      expect(result.recommended_polls).toBeDefined();\n      expect(result.trending_hashtags).toBeDefined();\n      expect(result.user_interests).toBeDefined();\n    });\n\n    it('should calculate trending scores correctly', async () => {\n      const mockHashtagUsage = [\n        { hashtag: '#politics', count: 50, recency: 0.9 },\n        { hashtag: '#climate', count: 30, recency: 0.8 },\n        { hashtag: '#economy', count: 20, recency: 0.7 }\n      ];\n\n      // Test trending score calculation\n      const trendingScores = mockHashtagUsage.map(item => ({\n        hashtag: item.hashtag,\n        score: item.count * 0.7 + item.recency * 0.3\n      })).sort((a, b) => b.score - a.score);\n\n      expect(trendingScores[0].hashtag).toBe('#politics');\n      expect(trendingScores[0].score).toBeGreaterThan(trendingScores[1].score);\n    });\n\n    it('should handle hashtag engagement tracking', async () => {\n      const mockEngagement = {\n        hashtag: '#politics',\n        action: 'view' as const,\n        userId: 'test-user-123',\n        timestamp: new Date().toISOString()\n      };\n\n      // Mock the engagement tracking\n      mockSupabase.from.mockReturnValue({\n        insert: jest.fn(() => Promise.resolve({ \n          data: [mockEngagement], \n          error: null \n        }))\n      });\n\n      const result = await hashtagService.trackHashtagEngagement(\n        mockEngagement.userId,\n        mockEngagement.hashtag,\n        mockEngagement.action\n      );\n\n      expect(result).toBe(true);\n      expect(mockSupabase.from).toHaveBeenCalledWith('analytics_events');\n    });\n  });\n\n  describe('TrendingHashtagsTracker', () => {\n    it('should track hashtag usage and calculate trends', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Simulate hashtag usage\n      tracker.trackHashtagUsage('test-user-1', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('test-user-2', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('test-user-3', '#climate', { category: 'environment' });\n\n      const trendingHashtags = tracker.getTrendingHashtags(5);\n      \n      expect(trendingHashtags).toBeDefined();\n      expect(trendingHashtags.length).toBeGreaterThan(0);\n    });\n\n    it('should provide hashtag analytics', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Add some test data\n      tracker.trackHashtagUsage('user1', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('user2', '#politics', { category: 'politics' });\n      tracker.trackHashtagUsage('user3', '#climate', { category: 'environment' });\n\n      const analytics = tracker.getHashtagAnalytics();\n      \n      expect(analytics.totalHashtags).toBeGreaterThan(0);\n      expect(analytics.totalUsage).toBeGreaterThan(0);\n      expect(analytics.trendingHashtags).toBeDefined();\n      expect(analytics.categoryBreakdown).toBeDefined();\n    });\n\n    it('should identify viral potential hashtags', () => {\n      const tracker = TrendingHashtagsTracker.getInstance();\n      \n      // Simulate high-engagement hashtag\n      for (let i = 0; i < 10; i++) {\n        tracker.trackHashtagUsage(`user${i}`, '#viral', { category: 'trending' });\n      }\n\n      const analytics = tracker.getHashtagAnalytics();\n      \n      expect(analytics.viralPotential).toBeDefined();\n      expect(analytics.viralPotential.length).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Hashtag Analytics Integration', () => {\n    it('should calculate trending hashtags with proper scoring', async () => {\n      const mockUsageData = [\n        { hashtag_id: 'hashtag-1', created_at: new Date().toISOString(), user_id: 'user1' },\n        { hashtag_id: 'hashtag-1', created_at: new Date().toISOString(), user_id: 'user2' },\n        { hashtag_id: 'hashtag-2', created_at: new Date().toISOString(), user_id: 'user3' }\n      ];\n\n      const mockHashtags = [\n        { id: 'hashtag-1', name: '#politics', category: 'politics' },\n        { id: 'hashtag-2', name: '#climate', category: 'environment' }\n      ];\n\n      // Mock the database queries\n      mockSupabase.from.mockImplementation((table: string) => {\n        if (table === 'hashtag_usage') {\n          return {\n            select: jest.fn(() => ({\n              gte: jest.fn(() => ({\n                order: jest.fn(() => Promise.resolve({ \n                  data: mockUsageData, \n                  error: null \n                }))\n              }))\n            }))\n          };\n        } else if (table === 'hashtags') {\n          return {\n            select: jest.fn(() => ({\n              in: jest.fn(() => Promise.resolve({ \n                data: mockHashtags, \n                error: null \n              }))\n            }))\n          };\n        }\n        return { select: jest.fn(() => ({ eq: jest.fn(() => Promise.resolve({ data: [], error: null })) })) };\n      });\n\n      const trendingHashtags = await calculateTrendingHashtags('politics', 10);\n      \n      expect(trendingHashtags).toBeDefined();\n      expect(Array.isArray(trendingHashtags)).toBe(true);\n    });\n  });\n\n  describe('Component Integration', () => {\n    it('should render trending polls with proper test IDs', () => {\n      const mockTrendingData = {\n        trendingHashtags: ['#politics', '#climate', '#economy'],\n        trendingPolls: [\n          { id: 'poll-1', title: 'Political Poll', hashtags: ['#politics'] },\n          { id: 'poll-2', title: 'Climate Poll', hashtags: ['#climate'] }\n        ]\n      };\n\n      // Test that components use proper test IDs\n      const expectedTestIds = [\n        T.dashboard.trendingPollsSection,\n        T.dashboard.trendingHashtags,\n        T.dashboard.trendingPolls,\n        T.poll.item,\n        T.poll.title\n      ];\n\n      expectedTestIds.forEach(testId => {\n        expect(testId).toBeDefined();\n        expect(typeof testId).toBe('string');\n      });\n    });\n\n    it('should handle hashtag selection and filtering', () => {\n      const mockHashtagSelection = {\n        selectedHashtags: ['#politics', '#climate'],\n        onHashtagSelect: jest.fn(),\n        onPollSelect: jest.fn()\n      };\n\n      // Test hashtag selection logic\n      const handleHashtagSelect = (hashtag: string) => {\n        if (mockHashtagSelection.selectedHashtags.includes(hashtag)) {\n          mockHashtagSelection.selectedHashtags = mockHashtagSelection.selectedHashtags.filter(h => h !== hashtag);\n        } else {\n          mockHashtagSelection.selectedHashtags.push(hashtag);\n        }\n        mockHashtagSelection.onHashtagSelect(hashtag);\n      };\n\n      // Test adding hashtag\n      handleHashtagSelect('#economy');\n      expect(mockHashtagSelection.selectedHashtags).toContain('#economy');\n      expect(mockHashtagSelection.onHashtagSelect).toHaveBeenCalledWith('#economy');\n\n      // Test removing hashtag\n      handleHashtagSelect('#politics');\n      expect(mockHashtagSelection.selectedHashtags).not.toContain('#politics');\n    });\n  });\n\n  describe('Performance and Caching', () => {\n    it('should cache trending hashtag results', async () => {\n      const cacheKey = 'trending_hashtags_10';\n      const mockTrendingData = ['#politics', '#climate', '#economy'];\n\n      // Mock cache implementation\n      const cache = new Map();\n      cache.set(cacheKey, mockTrendingData);\n\n      const cachedResult = cache.get(cacheKey);\n      expect(cachedResult).toEqual(mockTrendingData);\n    });\n\n    it('should handle cache expiration', () => {\n      const cache = new Map();\n      const cacheKey = 'trending_hashtags_10';\n      const cacheData = {\n        data: ['#politics', '#climate'],\n        timestamp: Date.now() - 25 * 60 * 60 * 1000 // 25 hours ago\n      };\n\n      cache.set(cacheKey, cacheData);\n\n      // Check if cache is expired (24 hour TTL)\n      const isExpired = Date.now() - cacheData.timestamp > 24 * 60 * 60 * 1000;\n      expect(isExpired).toBe(true);\n    });\n  });\n\n  describe('Error Handling and Fallbacks', () => {\n    it('should handle database errors gracefully', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            gte: jest.fn(() => ({\n              order: jest.fn(() => Promise.resolve({ \n                data: null, \n                error: new Error('Database connection failed') \n              }))\n            }))\n          }))\n        }))\n      });\n\n      const result = await hashtagService.generatePersonalizedFeed('test-user', 10);\n      \n      // Should return empty results instead of throwing\n      expect(result.recommended_polls).toEqual([]);\n      expect(result.trending_hashtags).toEqual([]);\n    });\n\n    it('should provide fallback hashtag interests', async () => {\n      const mockUserId = 'test-user-123';\n      \n      // Mock empty user interests\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => Promise.resolve({ \n            data: [], \n            error: null \n          }))\n        }))\n      });\n\n      const result = await hashtagService.generatePersonalizedFeed(mockUserId, 10);\n      \n      // Should have fallback interests\n      expect(result.user_interests).toBeDefined();\n      expect(Array.isArray(result.user_interests)).toBe(true);\n    });\n  });\n});\n"],"names":["mockSupabase","from","jest","fn","select","eq","gte","order","limit","Promise","resolve","data","error","insert","update","mock","createClient","describe","hashtagService","trendingTracker","beforeEach","HashtagPollsIntegrationService","TrendingHashtagsTracker","getInstance","clearAllMocks","afterEach","resetAllMocks","it","mockUserId","mockHashtagData","hashtag","usage_count","recency_score","mockReturnValue","result","generatePersonalizedFeed","expect","toBeDefined","recommended_polls","trending_hashtags","user_interests","mockHashtagUsage","count","recency","trendingScores","map","item","score","sort","a","b","toBe","toBeGreaterThan","mockEngagement","action","userId","timestamp","Date","toISOString","trackHashtagEngagement","toHaveBeenCalledWith","tracker","trackHashtagUsage","category","trendingHashtags","getTrendingHashtags","length","analytics","getHashtagAnalytics","totalHashtags","totalUsage","categoryBreakdown","i","viralPotential","mockUsageData","hashtag_id","created_at","user_id","mockHashtags","id","name","mockImplementation","table","in","calculateTrendingHashtags","Array","isArray","mockTrendingData","trendingPolls","title","hashtags","expectedTestIds","T","dashboard","trendingPollsSection","poll","forEach","testId","mockHashtagSelection","selectedHashtags","onHashtagSelect","onPollSelect","handleHashtagSelect","includes","filter","h","push","toContain","not","cacheKey","cache","Map","set","cachedResult","get","toEqual","cacheData","now","isExpired","Error"],"mappings":"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"}
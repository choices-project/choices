{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/utils/rate-limit.ts"],"sourcesContent":["/**\n * Rate Limiting Utilities\n * \n * Production rate limiting utilities for the Choices platform\n * \n * Created: January 16, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { logger } from './logger';\n\nexport interface RateLimitResult {\n  allowed: boolean;\n  remaining: number;\n  resetTime: number;\n}\n\nexport interface RateLimitStats {\n  total: number;\n  remaining: number;\n  resetTime: number;\n}\n\nexport interface RateLimitOptions {\n  windowMs: number;\n  maxRequests: number;\n  keyGenerator?: (req: any) => string;\n}\n\n/**\n * Check rate limit for a given key\n */\nexport async function checkRateLimit(key: string, options: RateLimitOptions): Promise<RateLimitResult> {\n  try {\n    // This would integrate with your actual rate limiting system (Redis, etc.)\n    logger.info('Checking rate limit', { key, options });\n    \n    // Placeholder implementation\n    return {\n      allowed: true,\n      remaining: options.maxRequests,\n      resetTime: Date.now() + options.windowMs\n    };\n  } catch (error) {\n    logger.error('Rate limit check failed', error instanceof Error ? error : new Error(String(error)));\n    return {\n      allowed: false,\n      remaining: 0,\n      resetTime: Date.now() + options.windowMs\n    };\n  }\n}\n\n/**\n * Create a rate limiter instance\n */\nexport function createRateLimiter(options: RateLimitOptions) {\n  return {\n    check: (key: string) => checkRateLimit(key, options),\n    reset: async (key: string) => {\n      logger.info('Resetting rate limit', { key });\n      // This would reset the rate limit for the key\n    },\n    getStats: async (key: string): Promise<RateLimitStats> => {\n      logger.info('Getting rate limit stats', { key });\n      return {\n        total: options.maxRequests,\n        remaining: options.maxRequests,\n        resetTime: Date.now() + options.windowMs\n      };\n    }\n  };\n}\n\n/**\n * Rate Limiter class\n */\nexport class RateLimiter {\n  private options: RateLimitOptions;\n\n  constructor(options: RateLimitOptions) {\n    this.options = options;\n  }\n  \n  async check(key: string): Promise<RateLimitResult> {\n    return checkRateLimit(key, this.options);\n  }\n  \n  async reset(key: string): Promise<void> {\n    logger.info('Resetting rate limit', { key });\n    // This would reset the rate limit for the key\n  }\n  \n  async getStats(key: string): Promise<RateLimitStats> {\n    logger.info('Getting rate limit stats', { key });\n    return {\n      total: this.options.maxRequests,\n      remaining: this.options.maxRequests,\n      resetTime: Date.now() + this.options.windowMs\n    };\n  }\n}"],"names":["RateLimiter","checkRateLimit","createRateLimiter","key","options","logger","info","allowed","remaining","maxRequests","resetTime","Date","now","windowMs","error","Error","String","check","reset","getStats","total"],"mappings":"AAAA;;;;;;;CAOC;;;;;;;;;;;QAsEYA;eAAAA;;QA7CSC;eAAAA;;QAwBNC;eAAAA;;;wBA/CO;AAuBhB,eAAeD,eAAeE,GAAW,EAAEC,OAAyB;IACzE,IAAI;QACF,2EAA2E;QAC3EC,cAAM,CAACC,IAAI,CAAC,uBAAuB;YAAEH;YAAKC;QAAQ;QAElD,6BAA6B;QAC7B,OAAO;YACLG,SAAS;YACTC,WAAWJ,QAAQK,WAAW;YAC9BC,WAAWC,KAAKC,GAAG,KAAKR,QAAQS,QAAQ;QAC1C;IACF,EAAE,OAAOC,OAAO;QACdT,cAAM,CAACS,KAAK,CAAC,2BAA2BA,iBAAiBC,QAAQD,QAAQ,IAAIC,MAAMC,OAAOF;QAC1F,OAAO;YACLP,SAAS;YACTC,WAAW;YACXE,WAAWC,KAAKC,GAAG,KAAKR,QAAQS,QAAQ;QAC1C;IACF;AACF;AAKO,SAASX,kBAAkBE,OAAyB;IACzD,OAAO;QACLa,OAAO,CAACd,MAAgBF,eAAeE,KAAKC;QAC5Cc,OAAO,OAAOf;YACZE,cAAM,CAACC,IAAI,CAAC,wBAAwB;gBAAEH;YAAI;QAC1C,8CAA8C;QAChD;QACAgB,UAAU,OAAOhB;YACfE,cAAM,CAACC,IAAI,CAAC,4BAA4B;gBAAEH;YAAI;YAC9C,OAAO;gBACLiB,OAAOhB,QAAQK,WAAW;gBAC1BD,WAAWJ,QAAQK,WAAW;gBAC9BC,WAAWC,KAAKC,GAAG,KAAKR,QAAQS,QAAQ;YAC1C;QACF;IACF;AACF;AAKO,MAAMb;IAGX,YAAYI,OAAyB,CAAE;QACrC,IAAI,CAACA,OAAO,GAAGA;IACjB;IAEA,MAAMa,MAAMd,GAAW,EAA4B;QACjD,OAAOF,eAAeE,KAAK,IAAI,CAACC,OAAO;IACzC;IAEA,MAAMc,MAAMf,GAAW,EAAiB;QACtCE,cAAM,CAACC,IAAI,CAAC,wBAAwB;YAAEH;QAAI;IAC1C,8CAA8C;IAChD;IAEA,MAAMgB,SAAShB,GAAW,EAA2B;QACnDE,cAAM,CAACC,IAAI,CAAC,4BAA4B;YAAEH;QAAI;QAC9C,OAAO;YACLiB,OAAO,IAAI,CAAChB,OAAO,CAACK,WAAW;YAC/BD,WAAW,IAAI,CAACJ,OAAO,CAACK,WAAW;YACnCC,WAAWC,KAAKC,GAAG,KAAK,IAAI,CAACR,OAAO,CAACS,QAAQ;QAC/C;IACF;AACF"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/features/analytics/analytics-error-prevention.test.ts"],"sourcesContent":["/**\n * Analytics Error Prevention Tests\n * \n * Ensures analytics components handle errors gracefully and\n * maintain data integrity across all analytics operations.\n * \n * Created: January 27, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect } from '@jest/globals';\nimport * as fs from 'fs';\nimport * as glob from 'glob';\n\ndescribe('Analytics Error Prevention', () => {\n  it('analytics components should handle errors gracefully', () => {\n    const analyticsFiles = glob.sync('web/features/analytics/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    analyticsFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for error boundary patterns\n      if (content.includes('try {') && content.includes('catch')) {\n        // Should have proper error handling\n        if (!content.includes('console.error') && !content.includes('logger.error')) {\n          problematicFiles.push(`${file}: missing error logging in catch blocks`);\n        }\n      }\n      \n      // Check for async operations without error handling\n      const asyncMatches = content.match(/async\\s+[^{]*\\{[^}]*\\}/g);\n      if (asyncMatches) {\n        asyncMatches.forEach(match => {\n          if (!match.includes('try') && !match.includes('catch')) {\n            problematicFiles.push(`${file}: async operation without error handling`);\n          }\n        });\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Analytics files with missing error handling:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('analytics data should be properly typed', () => {\n    const analyticsFiles = glob.sync('web/features/analytics/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    analyticsFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for any types in analytics code\n      if (content.match(/:\\s*any\\b/)) {\n        problematicFiles.push(`${file}: contains any types`);\n      }\n      \n      // Check for proper interface definitions\n      if (content.includes('interface ') || content.includes('type ')) {\n        // Should have proper type definitions\n        if (!content.includes('[key: string]: unknown') && content.includes('interface ')) {\n          problematicFiles.push(`${file}: interface may need index signature`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Analytics files with type issues:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('analytics tracking should not fail silently', () => {\n    const analyticsFiles = glob.sync('web/features/analytics/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    analyticsFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for tracking functions\n      if (content.includes('track') || content.includes('analytics')) {\n        // Should have error handling\n        if (!content.includes('try') && !content.includes('catch')) {\n          problematicFiles.push(`${file}: tracking functions should have error handling`);\n        }\n      }\n      \n      // Check for silent failures\n      if (content.includes('catch') && !content.includes('console.error') && !content.includes('logger')) {\n        problematicFiles.push(`${file}: catch blocks should log errors`);\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Analytics files with silent failures:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('analytics state should be properly managed', () => {\n    const analyticsFiles = glob.sync('web/features/analytics/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    analyticsFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for useState without proper error handling\n      if (content.includes('useState') && content.includes('setError')) {\n        // Should have proper error state management\n        if (!content.includes('error') || !content.includes('setError')) {\n          problematicFiles.push(`${file}: error state not properly managed`);\n        }\n      }\n      \n      // Check for loading states\n      if (content.includes('useState') && content.includes('setLoading')) {\n        // Should have proper loading state management\n        if (!content.includes('loading') || !content.includes('setLoading')) {\n          problematicFiles.push(`${file}: loading state not properly managed`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      logger.info('Analytics files with state management issues:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n});\n"],"names":["describe","it","analyticsFiles","glob","sync","ignore","problematicFiles","forEach","file","content","fs","readFileSync","includes","push","asyncMatches","match","length","logger","info","expect","toHaveLength"],"mappings":"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"}
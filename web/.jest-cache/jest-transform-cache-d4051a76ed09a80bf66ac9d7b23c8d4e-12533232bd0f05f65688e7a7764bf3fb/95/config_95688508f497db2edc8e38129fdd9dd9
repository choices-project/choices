952687726015e3398691aaa85e0ca4e8
/**
 * Security Configuration
 * Centralized security settings and policies
 * 
 * Features:
 * - CSP (Content Security Policy) configuration
 * - Security headers configuration
 * - Rate limiting settings
 * - Request validation rules
 * - Privacy and data protection settings
 * 
 * Created: 2025-08-27
 * Status: Critical security enhancement
 */ // E2E Test Detection
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get DEVELOPMENT_SECURITY_CONFIG () {
        return DEVELOPMENT_SECURITY_CONFIG;
    },
    get IS_E2E () {
        return IS_E2E;
    },
    get PRODUCTION_SECURITY_CONFIG () {
        return PRODUCTION_SECURITY_CONFIG;
    },
    get anonymizeIP () {
        return anonymizeIP;
    },
    get buildCSPHeader () {
        return buildCSPHeader;
    },
    get getSecurityConfig () {
        return getSecurityConfig;
    },
    get isBlockedUserAgent () {
        return isBlockedUserAgent;
    },
    get validateContent () {
        return validateContent;
    }
});
const IS_E2E = process.env.NODE_ENV === 'test' || process.env.E2E === '1' || process.env.PLAYWRIGHT === '1';
const PRODUCTION_SECURITY_CONFIG = {
    csp: {
        'default-src': [
            "'self'"
        ],
        'script-src': [
            "'self'",
            "'unsafe-inline'",
            'https://cdn.jsdelivr.net'
        ],
        'style-src': [
            "'self'",
            "'unsafe-inline'",
            'https://fonts.googleapis.com'
        ],
        'font-src': [
            "'self'",
            'https://fonts.gstatic.com',
            'data:'
        ],
        'img-src': [
            "'self'",
            'data:',
            'https:',
            'blob:'
        ],
        'connect-src': [
            "'self'",
            'https://*.supabase.co',
            'https://api.choices.app',
            'wss://*.supabase.co'
        ],
        'frame-src': [
            "'none'"
        ],
        'object-src': [
            "'none'"
        ],
        'base-uri': [
            "'self'"
        ],
        'form-action': [
            "'self'"
        ],
        'frame-ancestors': [
            "'none'"
        ],
        'upgrade-insecure-requests': []
    },
    headers: {
        'X-Frame-Options': 'DENY',
        'X-Content-Type-Options': 'nosniff',
        'X-XSS-Protection': '1; mode=block',
        'Referrer-Policy': 'strict-origin-when-cross-origin',
        'Permissions-Policy': 'camera=(), microphone=(), geolocation=()',
        'Cross-Origin-Embedder-Policy': 'require-corp',
        'Cross-Origin-Opener-Policy': 'same-origin',
        'Cross-Origin-Resource-Policy': 'same-origin'
    },
    rateLimit: {
        enabled: !IS_E2E,
        windowMs: 15 * 60 * 1000,
        maxRequests: 100,
        sensitiveEndpoints: IS_E2E ? {} : {
            '/api/auth': 10,
            '/register': 5,
            '/login': 10,
            '/api/admin': 20
        },
        e2eBypassHeader: 'x-e2e-bypass'
    },
    validation: {
        maxContentLength: 1024 * 1024,
        allowedContentTypes: [
            'application/json',
            'application/x-www-form-urlencoded',
            'multipart/form-data'
        ],
        suspiciousPatterns: [
            /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
            /javascript:/gi,
            /on\w+\s*=/gi,
            /<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi
        ],
        blockedUserAgents: [
            'sqlmap',
            'nikto',
            'nmap',
            'scanner',
            'bot',
            'crawler'
        ]
    },
    privacy: {
        dataRetentionDays: 90,
        anonymizeIPs: true,
        logSensitiveData: false,
        enableDifferentialPrivacy: true
    }
};
const DEVELOPMENT_SECURITY_CONFIG = Object.assign({}, PRODUCTION_SECURITY_CONFIG, {
    csp: {
        ...PRODUCTION_SECURITY_CONFIG.csp,
        'script-src': [
            ...PRODUCTION_SECURITY_CONFIG.csp['script-src'],
            "'unsafe-eval'"
        ]
    },
    rateLimit: {
        ...PRODUCTION_SECURITY_CONFIG.rateLimit,
        maxRequests: 1000
    },
    privacy: {
        ...PRODUCTION_SECURITY_CONFIG.privacy,
        logSensitiveData: true
    }
});
function getSecurityConfig() {
    return process.env.NODE_ENV === 'production' ? PRODUCTION_SECURITY_CONFIG : DEVELOPMENT_SECURITY_CONFIG;
}
function buildCSPHeader(config) {
    const directives = Object.entries(config).map(([directive, sources])=>{
        if (Array.isArray(sources) && sources.length > 0) {
            return `${directive} ${sources.join(' ')}`;
        } else if (sources.length === 0) {
            return directive;
        }
        return '';
    }).filter(Boolean).join('; ');
    return directives;
}
function validateContent(content, config) {
    // Check content length
    if (content.length > config.maxContentLength) {
        return {
            valid: false,
            reason: 'Content too long'
        };
    }
    // Check for suspicious patterns
    for (const pattern of config.suspiciousPatterns){
        if (pattern.test(content)) {
            return {
                valid: false,
                reason: 'Suspicious content detected'
            };
        }
    }
    return {
        valid: true
    };
}
function isBlockedUserAgent(userAgent, config) {
    const lowerUA = userAgent.toLowerCase();
    return config.blockedUserAgents.some((blocked)=>lowerUA.includes(blocked.toLowerCase()));
}
function anonymizeIP(ip) {
    if (!ip || ip === 'unknown') return 'unknown';
    // IPv4: 192.168.1.1 -> 192.168.1.0
    if (ip.includes('.')) {
        const parts = ip.split('.');
        if (parts.length === 4) {
            return `${parts[0]}.${parts[1]}.${parts[2]}.0`;
        }
    }
    // IPv6: 2001:db8::1 -> 2001:db8::
    if (ip.includes(':')) {
        const parts = ip.split(':');
        if (parts.length >= 4) {
            return `${parts[0]}:${parts[1]}:${parts[2]}::`;
        }
    }
    return ip;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvc2VjdXJpdHkvY29uZmlnLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VjdXJpdHkgQ29uZmlndXJhdGlvblxuICogQ2VudHJhbGl6ZWQgc2VjdXJpdHkgc2V0dGluZ3MgYW5kIHBvbGljaWVzXG4gKiBcbiAqIEZlYXR1cmVzOlxuICogLSBDU1AgKENvbnRlbnQgU2VjdXJpdHkgUG9saWN5KSBjb25maWd1cmF0aW9uXG4gKiAtIFNlY3VyaXR5IGhlYWRlcnMgY29uZmlndXJhdGlvblxuICogLSBSYXRlIGxpbWl0aW5nIHNldHRpbmdzXG4gKiAtIFJlcXVlc3QgdmFsaWRhdGlvbiBydWxlc1xuICogLSBQcml2YWN5IGFuZCBkYXRhIHByb3RlY3Rpb24gc2V0dGluZ3NcbiAqIFxuICogQ3JlYXRlZDogMjAyNS0wOC0yN1xuICogU3RhdHVzOiBDcml0aWNhbCBzZWN1cml0eSBlbmhhbmNlbWVudFxuICovXG5cbi8vIEUyRSBUZXN0IERldGVjdGlvblxuZXhwb3J0IGNvbnN0IElTX0UyRSA9XG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgfHxcbiAgcHJvY2Vzcy5lbnYuRTJFID09PSAnMScgfHxcbiAgcHJvY2Vzcy5lbnYuUExBWVdSSUdIVCA9PT0gJzEnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5Q29uZmlnIHtcbiAgY3NwOiBDU1BDb25maWdcbiAgaGVhZGVyczogU2VjdXJpdHlIZWFkZXJzXG4gIHJhdGVMaW1pdDogUmF0ZUxpbWl0Q29uZmlnXG4gIHZhbGlkYXRpb246IFZhbGlkYXRpb25Db25maWdcbiAgcHJpdmFjeTogUHJpdmFjeUNvbmZpZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENTUENvbmZpZyB7XG4gICdkZWZhdWx0LXNyYyc6IHN0cmluZ1tdXG4gICdzY3JpcHQtc3JjJzogc3RyaW5nW11cbiAgJ3N0eWxlLXNyYyc6IHN0cmluZ1tdXG4gICdmb250LXNyYyc6IHN0cmluZ1tdXG4gICdpbWctc3JjJzogc3RyaW5nW11cbiAgJ2Nvbm5lY3Qtc3JjJzogc3RyaW5nW11cbiAgJ2ZyYW1lLXNyYyc6IHN0cmluZ1tdXG4gICdvYmplY3Qtc3JjJzogc3RyaW5nW11cbiAgJ2Jhc2UtdXJpJzogc3RyaW5nW11cbiAgJ2Zvcm0tYWN0aW9uJzogc3RyaW5nW11cbiAgJ2ZyYW1lLWFuY2VzdG9ycyc6IHN0cmluZ1tdXG4gICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJz86IHN0cmluZ1tdXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlIZWFkZXJzIHtcbiAgJ1gtRnJhbWUtT3B0aW9ucyc6IHN0cmluZ1xuICAnWC1Db250ZW50LVR5cGUtT3B0aW9ucyc6IHN0cmluZ1xuICAnWC1YU1MtUHJvdGVjdGlvbic6IHN0cmluZ1xuICAnUmVmZXJyZXItUG9saWN5Jzogc3RyaW5nXG4gICdQZXJtaXNzaW9ucy1Qb2xpY3knOiBzdHJpbmdcbiAgJ0Nyb3NzLU9yaWdpbi1FbWJlZGRlci1Qb2xpY3knOiBzdHJpbmdcbiAgJ0Nyb3NzLU9yaWdpbi1PcGVuZXItUG9saWN5Jzogc3RyaW5nXG4gICdDcm9zcy1PcmlnaW4tUmVzb3VyY2UtUG9saWN5Jzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmF0ZUxpbWl0Q29uZmlnIHtcbiAgZW5hYmxlZDogYm9vbGVhblxuICB3aW5kb3dNczogbnVtYmVyXG4gIG1heFJlcXVlc3RzOiBudW1iZXJcbiAgc2Vuc2l0aXZlRW5kcG9pbnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+XG4gIGUyZUJ5cGFzc0hlYWRlcjogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvbkNvbmZpZyB7XG4gIG1heENvbnRlbnRMZW5ndGg6IG51bWJlclxuICBhbGxvd2VkQ29udGVudFR5cGVzOiBzdHJpbmdbXVxuICBzdXNwaWNpb3VzUGF0dGVybnM6IFJlZ0V4cFtdXG4gIGJsb2NrZWRVc2VyQWdlbnRzOiBzdHJpbmdbXVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByaXZhY3lDb25maWcge1xuICBkYXRhUmV0ZW50aW9uRGF5czogbnVtYmVyXG4gIGFub255bWl6ZUlQczogYm9vbGVhblxuICBsb2dTZW5zaXRpdmVEYXRhOiBib29sZWFuXG4gIGVuYWJsZURpZmZlcmVudGlhbFByaXZhY3k6IGJvb2xlYW5cbn1cblxuLyoqXG4gKiBQcm9kdWN0aW9uIHNlY3VyaXR5IGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGNvbnN0IFBST0RVQ1RJT05fU0VDVVJJVFlfQ09ORklHOiBTZWN1cml0eUNvbmZpZyA9IHtcbiAgY3NwOiB7XG4gICAgJ2RlZmF1bHQtc3JjJzogW1wiJ3NlbGYnXCJdLFxuICAgICdzY3JpcHQtc3JjJzogW1xuICAgICAgXCInc2VsZidcIixcbiAgICAgIFwiJ3Vuc2FmZS1pbmxpbmUnXCIsIC8vIFJlcXVpcmVkIGZvciBOZXh0LmpzXG4gICAgICAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0JyxcbiAgICBdLFxuICAgICdzdHlsZS1zcmMnOiBbXG4gICAgICBcIidzZWxmJ1wiLFxuICAgICAgXCIndW5zYWZlLWlubGluZSdcIiwgLy8gUmVxdWlyZWQgZm9yIE5leHQuanNcbiAgICAgICdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tJyxcbiAgICBdLFxuICAgICdmb250LXNyYyc6IFtcbiAgICAgIFwiJ3NlbGYnXCIsXG4gICAgICAnaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbScsXG4gICAgICAnZGF0YTonLFxuICAgIF0sXG4gICAgJ2ltZy1zcmMnOiBbXG4gICAgICBcIidzZWxmJ1wiLFxuICAgICAgJ2RhdGE6JyxcbiAgICAgICdodHRwczonLFxuICAgICAgJ2Jsb2I6JyxcbiAgICBdLFxuICAgICdjb25uZWN0LXNyYyc6IFtcbiAgICAgIFwiJ3NlbGYnXCIsXG4gICAgICAnaHR0cHM6Ly8qLnN1cGFiYXNlLmNvJyxcbiAgICAgICdodHRwczovL2FwaS5jaG9pY2VzLmFwcCcsXG4gICAgICAnd3NzOi8vKi5zdXBhYmFzZS5jbycsXG4gICAgXSxcbiAgICAnZnJhbWUtc3JjJzogW1wiJ25vbmUnXCJdLFxuICAgICdvYmplY3Qtc3JjJzogW1wiJ25vbmUnXCJdLFxuICAgICdiYXNlLXVyaSc6IFtcIidzZWxmJ1wiXSxcbiAgICAnZm9ybS1hY3Rpb24nOiBbXCInc2VsZidcIl0sXG4gICAgJ2ZyYW1lLWFuY2VzdG9ycyc6IFtcIidub25lJ1wiXSxcbiAgICAndXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyc6IFtdLFxuICB9LFxuICBcbiAgaGVhZGVyczoge1xuICAgICdYLUZyYW1lLU9wdGlvbnMnOiAnREVOWScsXG4gICAgJ1gtQ29udGVudC1UeXBlLU9wdGlvbnMnOiAnbm9zbmlmZicsXG4gICAgJ1gtWFNTLVByb3RlY3Rpb24nOiAnMTsgbW9kZT1ibG9jaycsXG4gICAgJ1JlZmVycmVyLVBvbGljeSc6ICdzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luJyxcbiAgICAnUGVybWlzc2lvbnMtUG9saWN5JzogJ2NhbWVyYT0oKSwgbWljcm9waG9uZT0oKSwgZ2VvbG9jYXRpb249KCknLFxuICAgICdDcm9zcy1PcmlnaW4tRW1iZWRkZXItUG9saWN5JzogJ3JlcXVpcmUtY29ycCcsXG4gICAgJ0Nyb3NzLU9yaWdpbi1PcGVuZXItUG9saWN5JzogJ3NhbWUtb3JpZ2luJyxcbiAgICAnQ3Jvc3MtT3JpZ2luLVJlc291cmNlLVBvbGljeSc6ICdzYW1lLW9yaWdpbicsXG4gIH0sXG4gIFxuICByYXRlTGltaXQ6IHtcbiAgICBlbmFibGVkOiAhSVNfRTJFLCAvLyBEaXNhYmxlZCBpbiBFMkUgdGVzdHNcbiAgICB3aW5kb3dNczogMTUgKiA2MCAqIDEwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgICBtYXhSZXF1ZXN0czogMTAwLFxuICAgIHNlbnNpdGl2ZUVuZHBvaW50czogSVNfRTJFID8ge30gOiB7XG4gICAgICAnL2FwaS9hdXRoJzogMTAsXG4gICAgICAnL3JlZ2lzdGVyJzogNSxcbiAgICAgICcvbG9naW4nOiAxMCxcbiAgICAgICcvYXBpL2FkbWluJzogMjAsXG4gICAgfSxcbiAgICBlMmVCeXBhc3NIZWFkZXI6ICd4LWUyZS1ieXBhc3MnXG4gIH0sXG4gIFxuICB2YWxpZGF0aW9uOiB7XG4gICAgbWF4Q29udGVudExlbmd0aDogMTAyNCAqIDEwMjQsIC8vIDFNQlxuICAgIGFsbG93ZWRDb250ZW50VHlwZXM6IFtcbiAgICAgICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgJ211bHRpcGFydC9mb3JtLWRhdGEnLFxuICAgIF0sXG4gICAgc3VzcGljaW91c1BhdHRlcm5zOiBbXG4gICAgICAvPHNjcmlwdFxcYltePF0qKD86KD8hPFxcL3NjcmlwdD4pPFtePF0qKSo8XFwvc2NyaXB0Pi9naSwgLy8gU2NyaXB0IHRhZ3NcbiAgICAgIC9qYXZhc2NyaXB0Oi9naSwgLy8gSmF2YVNjcmlwdCBwcm90b2NvbFxuICAgICAgL29uXFx3K1xccyo9L2dpLCAvLyBFdmVudCBoYW5kbGVyc1xuICAgICAgLzxpZnJhbWVcXGJbXjxdKig/Oig/ITxcXC9pZnJhbWU+KTxbXjxdKikqPFxcL2lmcmFtZT4vZ2ksIC8vIElmcmFtZSB0YWdzXG4gICAgXSxcbiAgICBibG9ja2VkVXNlckFnZW50czogW1xuICAgICAgJ3NxbG1hcCcsXG4gICAgICAnbmlrdG8nLFxuICAgICAgJ25tYXAnLFxuICAgICAgJ3NjYW5uZXInLFxuICAgICAgJ2JvdCcsXG4gICAgICAnY3Jhd2xlcicsXG4gICAgXSxcbiAgfSxcbiAgXG4gIHByaXZhY3k6IHtcbiAgICBkYXRhUmV0ZW50aW9uRGF5czogOTAsXG4gICAgYW5vbnltaXplSVBzOiB0cnVlLFxuICAgIGxvZ1NlbnNpdGl2ZURhdGE6IGZhbHNlLFxuICAgIGVuYWJsZURpZmZlcmVudGlhbFByaXZhY3k6IHRydWUsXG4gIH0sXG59XG5cbi8qKlxuICogRGV2ZWxvcG1lbnQgc2VjdXJpdHkgY29uZmlndXJhdGlvbiAobW9yZSBwZXJtaXNzaXZlKVxuICovXG5leHBvcnQgY29uc3QgREVWRUxPUE1FTlRfU0VDVVJJVFlfQ09ORklHOiBTZWN1cml0eUNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIFBST0RVQ1RJT05fU0VDVVJJVFlfQ09ORklHLCB7XG4gIGNzcDoge1xuICAgIC4uLlBST0RVQ1RJT05fU0VDVVJJVFlfQ09ORklHLmNzcCxcbiAgICAnc2NyaXB0LXNyYyc6IFtcbiAgICAgIC4uLlBST0RVQ1RJT05fU0VDVVJJVFlfQ09ORklHLmNzcFsnc2NyaXB0LXNyYyddLFxuICAgICAgXCIndW5zYWZlLWV2YWwnXCIsIC8vIFJlcXVpcmVkIGZvciBOZXh0LmpzIGRldmVsb3BtZW50XG4gICAgXSxcbiAgfSxcbiAgcmF0ZUxpbWl0OiB7XG4gICAgLi4uUFJPRFVDVElPTl9TRUNVUklUWV9DT05GSUcucmF0ZUxpbWl0LFxuICAgIG1heFJlcXVlc3RzOiAxMDAwLCAvLyBNb3JlIHBlcm1pc3NpdmUgaW4gZGV2ZWxvcG1lbnRcbiAgfSxcbiAgcHJpdmFjeToge1xuICAgIC4uLlBST0RVQ1RJT05fU0VDVVJJVFlfQ09ORklHLnByaXZhY3ksXG4gICAgbG9nU2Vuc2l0aXZlRGF0YTogdHJ1ZSwgLy8gTW9yZSBsb2dnaW5nIGluIGRldmVsb3BtZW50XG4gIH0sXG59KVxuXG4vKipcbiAqIEdldCBzZWN1cml0eSBjb25maWd1cmF0aW9uIGJhc2VkIG9uIGVudmlyb25tZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZWN1cml0eUNvbmZpZygpOiBTZWN1cml0eUNvbmZpZyB7XG4gIHJldHVybiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nIFxuICAgID8gUFJPRFVDVElPTl9TRUNVUklUWV9DT05GSUcgXG4gICAgOiBERVZFTE9QTUVOVF9TRUNVUklUWV9DT05GSUdcbn1cblxuLyoqXG4gKiBCdWlsZCBDU1AgaGVhZGVyIHN0cmluZyBmcm9tIGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQ1NQSGVhZGVyKGNvbmZpZzogQ1NQQ29uZmlnKTogc3RyaW5nIHtcbiAgY29uc3QgZGlyZWN0aXZlcyA9IE9iamVjdC5lbnRyaWVzKGNvbmZpZylcbiAgICAubWFwKChbZGlyZWN0aXZlLCBzb3VyY2VzXSkgPT4ge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlcykgJiYgc291cmNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBgJHtkaXJlY3RpdmV9ICR7c291cmNlcy5qb2luKCcgJyl9YFxuICAgICAgfSBlbHNlIGlmIChzb3VyY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlXG4gICAgICB9XG4gICAgICByZXR1cm4gJydcbiAgICB9KVxuICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAuam9pbignOyAnKVxuICBcbiAgcmV0dXJuIGRpcmVjdGl2ZXNcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb250ZW50IGFnYWluc3Qgc2VjdXJpdHkgcGF0dGVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ29udGVudChcbiAgY29udGVudDogc3RyaW5nLCBcbiAgY29uZmlnOiBWYWxpZGF0aW9uQ29uZmlnXG4pOiB7IHZhbGlkOiBib29sZWFuOyByZWFzb24/OiBzdHJpbmcgfSB7XG4gIC8vIENoZWNrIGNvbnRlbnQgbGVuZ3RoXG4gIGlmIChjb250ZW50Lmxlbmd0aCA+IGNvbmZpZy5tYXhDb250ZW50TGVuZ3RoKSB7XG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCByZWFzb246ICdDb250ZW50IHRvbyBsb25nJyB9XG4gIH1cbiAgXG4gIC8vIENoZWNrIGZvciBzdXNwaWNpb3VzIHBhdHRlcm5zXG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBjb25maWcuc3VzcGljaW91c1BhdHRlcm5zKSB7XG4gICAgaWYgKHBhdHRlcm4udGVzdChjb250ZW50KSkge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCByZWFzb246ICdTdXNwaWNpb3VzIGNvbnRlbnQgZGV0ZWN0ZWQnIH1cbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiB7IHZhbGlkOiB0cnVlIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGFnZW50IGlzIGJsb2NrZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQmxvY2tlZFVzZXJBZ2VudChcbiAgdXNlckFnZW50OiBzdHJpbmcsIFxuICBjb25maWc6IFZhbGlkYXRpb25Db25maWdcbik6IGJvb2xlYW4ge1xuICBjb25zdCBsb3dlclVBID0gdXNlckFnZW50LnRvTG93ZXJDYXNlKClcbiAgcmV0dXJuIGNvbmZpZy5ibG9ja2VkVXNlckFnZW50cy5zb21lKGJsb2NrZWQgPT4gXG4gICAgbG93ZXJVQS5pbmNsdWRlcyhibG9ja2VkLnRvTG93ZXJDYXNlKCkpXG4gIClcbn1cblxuLyoqXG4gKiBBbm9ueW1pemUgSVAgYWRkcmVzcyBmb3IgcHJpdmFjeVxuICovXG5leHBvcnQgZnVuY3Rpb24gYW5vbnltaXplSVAoaXA6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICghaXAgfHwgaXAgPT09ICd1bmtub3duJykgcmV0dXJuICd1bmtub3duJ1xuICBcbiAgLy8gSVB2NDogMTkyLjE2OC4xLjEgLT4gMTkyLjE2OC4xLjBcbiAgaWYgKGlwLmluY2x1ZGVzKCcuJykpIHtcbiAgICBjb25zdCBwYXJ0cyA9IGlwLnNwbGl0KCcuJylcbiAgICBpZiAocGFydHMubGVuZ3RoID09PSA0KSB7XG4gICAgICByZXR1cm4gYCR7cGFydHNbMF19LiR7cGFydHNbMV19LiR7cGFydHNbMl19LjBgXG4gICAgfVxuICB9XG4gIFxuICAvLyBJUHY2OiAyMDAxOmRiODo6MSAtPiAyMDAxOmRiODo6XG4gIGlmIChpcC5pbmNsdWRlcygnOicpKSB7XG4gICAgY29uc3QgcGFydHMgPSBpcC5zcGxpdCgnOicpXG4gICAgaWYgKHBhcnRzLmxlbmd0aCA+PSA0KSB7XG4gICAgICByZXR1cm4gYCR7cGFydHNbMF19OiR7cGFydHNbMV19OiR7cGFydHNbMl19OjpgXG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gaXBcbn1cbiJdLCJuYW1lcyI6WyJERVZFTE9QTUVOVF9TRUNVUklUWV9DT05GSUciLCJJU19FMkUiLCJQUk9EVUNUSU9OX1NFQ1VSSVRZX0NPTkZJRyIsImFub255bWl6ZUlQIiwiYnVpbGRDU1BIZWFkZXIiLCJnZXRTZWN1cml0eUNvbmZpZyIsImlzQmxvY2tlZFVzZXJBZ2VudCIsInZhbGlkYXRlQ29udGVudCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIkUyRSIsIlBMQVlXUklHSFQiLCJjc3AiLCJoZWFkZXJzIiwicmF0ZUxpbWl0IiwiZW5hYmxlZCIsIndpbmRvd01zIiwibWF4UmVxdWVzdHMiLCJzZW5zaXRpdmVFbmRwb2ludHMiLCJlMmVCeXBhc3NIZWFkZXIiLCJ2YWxpZGF0aW9uIiwibWF4Q29udGVudExlbmd0aCIsImFsbG93ZWRDb250ZW50VHlwZXMiLCJzdXNwaWNpb3VzUGF0dGVybnMiLCJibG9ja2VkVXNlckFnZW50cyIsInByaXZhY3kiLCJkYXRhUmV0ZW50aW9uRGF5cyIsImFub255bWl6ZUlQcyIsImxvZ1NlbnNpdGl2ZURhdGEiLCJlbmFibGVEaWZmZXJlbnRpYWxQcml2YWN5IiwiT2JqZWN0IiwiYXNzaWduIiwiY29uZmlnIiwiZGlyZWN0aXZlcyIsImVudHJpZXMiLCJtYXAiLCJkaXJlY3RpdmUiLCJzb3VyY2VzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiam9pbiIsImZpbHRlciIsIkJvb2xlYW4iLCJjb250ZW50IiwidmFsaWQiLCJyZWFzb24iLCJwYXR0ZXJuIiwidGVzdCIsInVzZXJBZ2VudCIsImxvd2VyVUEiLCJ0b0xvd2VyQ2FzZSIsInNvbWUiLCJibG9ja2VkIiwiaW5jbHVkZXMiLCJpcCIsInBhcnRzIiwic3BsaXQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7O0NBYUMsR0FFRCxxQkFBcUI7Ozs7Ozs7Ozs7OztRQWlLUkE7ZUFB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
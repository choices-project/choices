a1005ee48c2c1716f2bca6b6cb9212ee
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    },
    get dynamic () {
        return dynamic;
    }
});
const _server = require("next/server");
const _middleware = require("../../../lib/core/auth/middleware");
const _logger = require("../../../lib/utils/logger");
const _server1 = require("../../../utils/supabase/server");
const dynamic = 'force-dynamic';
async function GET(request) {
    try {
        console.log('ðŸ” API Route: Calling getSupabaseServerClient...');
        const supabaseClient = await (0, _server1.getSupabaseServerClient)();
        console.log('ðŸ” API Route: Supabase client result:', !!supabaseClient);
        if (!supabaseClient) {
            console.log('ðŸ” API Route: Supabase client is null/undefined');
            return _server.NextResponse.json({
                error: 'Supabase client not available'
            }, {
                status: 500
            });
        }
        const { searchParams } = new URL(request.url);
        const limit = parseInt(searchParams.get('limit') || '20');
        const _status = searchParams.get('status') || 'active';
        // Fetch active polls from polls table
        let polls;
        try {
            (0, _logger.devLog)('Fetching active polls from polls table...');
            const { data: directPolls, error: directError } = await supabaseClient.from('polls').select('id, title, total_votes, options, status').eq('status', 'active').limit(limit);
            if (directError) {
                throw directError;
            }
            (0, _logger.devLog)('Found polls:', {
                count: directPolls.length || 0
            });
            // Manually aggregate results (temporary solution)
            polls = (directPolls ?? []).map((poll)=>({
                    id: poll.id,
                    title: poll.title,
                    total_votes: poll.total_votes || 0,
                    aggregated_results: Array.isArray(poll.options) ? poll.options.reduce((acc, option, index)=>{
                        acc[`option_${index + 1}`] = option.votes || 0;
                        return acc;
                    }, {}) : {},
                    status: poll.status
                }));
        } catch (fallbackError) {
            (0, _logger.devLog)('Error fetching polls:', {
                error: fallbackError
            });
            return _server.NextResponse.json({
                error: 'Failed to fetch polls'
            }, {
                status: 500
            });
        }
        // Additional security: ensure no sensitive data is returned
        const sanitizedPolls = polls.map((poll)=>({
                poll_id: poll.id,
                title: poll.title,
                total_votes: poll.total_votes,
                // Only include safe fields
                status: 'active',
                created_at: new Date().toISOString()
            })) || [];
        return _server.NextResponse.json({
            success: true,
            polls: sanitizedPolls,
            count: sanitizedPolls.length,
            message: 'Aggregated poll results only - no individual vote data'
        });
    } catch (error) {
        (0, _logger.devLog)('Error in polls API:', {
            error
        });
        return _server.NextResponse.json({
            error: 'Internal server error',
            details: error instanceof Error ? error.message : String(error),
            stack: error instanceof Error ? error.stack : undefined
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // Always require authentication - no E2E bypasses
        const supabase = await (0, _server1.getSupabaseServerClient)();
        if (!supabase) {
            return _server.NextResponse.json({
                error: 'Supabase client not available'
            }, {
                status: 500
            });
        }
        // Always require authentication
        let user;
        try {
            user = await (0, _middleware.getUser)();
        } catch (error) {
            (0, _logger.devLog)('Authentication error during poll creation:', {
                error
            });
            return _server.NextResponse.json({
                error: 'Authentication required to create polls'
            }, {
                status: 401
            });
        }
        // Check if user is authenticated
        if (!user) {
            return _server.NextResponse.json({
                error: 'Authentication required to create polls'
            }, {
                status: 401
            });
        }
        // Verify user is active
        if (user) {
            const { data: userProfile } = await supabase.from('user_profiles').select('is_active').eq('user_id', user.id).single();
            if (!userProfile || !('is_active' in userProfile) || !userProfile.is_active) {
                return _server.NextResponse.json({
                    error: 'Active account required to create polls'
                }, {
                    status: 403
                });
            }
        }
        const body = await request.json();
        const { title, options, votingMethod = 'single', description, category = 'general', privacyLevel = 'public', allowMultipleVotes = false, showResults = true, allowComments = true, endTime, hashtags = [], primaryHashtag } = body;
        // Validate required fields
        if (!title || !options || !Array.isArray(options) || options.length < 2) {
            return _server.NextResponse.json({
                error: 'Title and at least 2 options are required'
            }, {
                status: 400
            });
        }
        // Sanitize and validate options
        const sanitizedOptions = options.filter((option)=>typeof option === 'string' && option.trim().length > 0).map((option)=>option.trim()).slice(0, 10); // Limit to 10 options max
        if (sanitizedOptions.length < 2) {
            return _server.NextResponse.json({
                error: 'At least 2 valid options are required'
            }, {
                status: 400
            });
        }
        // Create poll with user as creator
        const { data: poll, error: pollError } = await supabase.from('polls').insert({
            title: title.trim(),
            description: description?.trim() || null,
            options: sanitizedOptions,
            voting_method: votingMethod,
            privacy_level: privacyLevel,
            category,
            status: 'active',
            created_by: user?.id || '',
            total_votes: 0,
            participation: 0,
            end_time: endTime || null,
            hashtags: hashtags || [],
            primary_hashtag: primaryHashtag || null,
            poll_settings: {
                allowMultipleVotes,
                showResults,
                allowComments
            }
        }).select().single();
        if (pollError) {
            (0, _logger.devLog)('Error creating poll:', {
                error: pollError
            });
            return _server.NextResponse.json({
                error: 'Failed to create poll',
                details: pollError
            }, {
                status: 500
            });
        }
        // Return sanitized poll data (no sensitive information)
        const sanitizedPoll = poll && !('error' in poll) ? {
            id: poll.id,
            title: poll.title,
            description: poll.description,
            options: poll.options,
            voting_method: poll.voting_method,
            privacy_level: poll.privacy_level,
            category: poll.category,
            status: poll.status,
            total_votes: poll.total_votes,
            participation: poll.participation,
            end_time: poll.end_time,
            hashtags: poll.hashtags || [],
            primary_hashtag: poll.primary_hashtag,
            poll_settings: poll.poll_settings,
            created_at: poll.created_at
        } : null;
        return _server.NextResponse.json(sanitizedPoll);
    } catch (error) {
        (0, _logger.devLog)('Error in polls API:', {
            error
        });
        return _server.NextResponse.json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9hcHAvYXBpL3BvbGxzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3R9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuaW1wb3J0IHsgZ2V0VXNlciB9IGZyb20gJ0AvbGliL2NvcmUvYXV0aC9taWRkbGV3YXJlJztcbmltcG9ydCB7IGRldkxvZyB9IGZyb20gJ0AvbGliL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRTdXBhYmFzZVNlcnZlckNsaWVudCB9IGZyb20gJ0AvdXRpbHMvc3VwYWJhc2Uvc2VydmVyJztcblxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSAnZm9yY2UtZHluYW1pYyc7XG5cbi8vIFR5cGUgZGVmaW5pdGlvbnMgZm9yIHBvbGwgZGF0YVxuaW50ZXJmYWNlIFBvbGxPcHRpb24ge1xuICBpZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIHZvdGVzPzogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgX1BvbGxEYXRhIHtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgdG90YWxfdm90ZXM6IG51bWJlcjtcbiAgb3B0aW9uczogUG9sbE9wdGlvbltdO1xuICBzdGF0dXM6IHN0cmluZztcbn1cblxuLy8gR0VUIC9hcGkvcG9sbHMgLSBHZXQgYWN0aXZlIHBvbGxzIHdpdGggYWdncmVnYXRlZCByZXN1bHRzIG9ubHlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBBUEkgUm91dGU6IENhbGxpbmcgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQuLi4nKTtcbiAgICBjb25zdCBzdXBhYmFzZUNsaWVudCA9IGF3YWl0IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XG4gICAgY29uc29sZS5sb2coJ/CflI0gQVBJIFJvdXRlOiBTdXBhYmFzZSBjbGllbnQgcmVzdWx0OicsICEhc3VwYWJhc2VDbGllbnQpO1xuICAgIFxuICAgIGlmICghc3VwYWJhc2VDbGllbnQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIEFQSSBSb3V0ZTogU3VwYWJhc2UgY2xpZW50IGlzIG51bGwvdW5kZWZpbmVkJyk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdTdXBhYmFzZSBjbGllbnQgbm90IGF2YWlsYWJsZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzIwJyk7XG4gICAgY29uc3QgX3N0YXR1cyA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXR1cycpIHx8ICdhY3RpdmUnO1xuXG4gICAgLy8gRmV0Y2ggYWN0aXZlIHBvbGxzIGZyb20gcG9sbHMgdGFibGVcbiAgICBsZXQgcG9sbHM7XG5cbiAgICB0cnkge1xuICAgICAgZGV2TG9nKCdGZXRjaGluZyBhY3RpdmUgcG9sbHMgZnJvbSBwb2xscyB0YWJsZS4uLicpO1xuICAgICAgY29uc3QgeyBkYXRhOiBkaXJlY3RQb2xscywgZXJyb3I6IGRpcmVjdEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUNsaWVudFxuICAgICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgICAuc2VsZWN0KCdpZCwgdGl0bGUsIHRvdGFsX3ZvdGVzLCBvcHRpb25zLCBzdGF0dXMnKVxuICAgICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgICAubGltaXQobGltaXQpO1xuXG4gICAgICBpZiAoZGlyZWN0RXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZGlyZWN0RXJyb3I7XG4gICAgICB9XG5cbiAgICAgIGRldkxvZygnRm91bmQgcG9sbHM6JywgeyBjb3VudDogZGlyZWN0UG9sbHMubGVuZ3RoIHx8IDAgfSk7XG5cbiAgICAgIC8vIE1hbnVhbGx5IGFnZ3JlZ2F0ZSByZXN1bHRzICh0ZW1wb3Jhcnkgc29sdXRpb24pXG4gICAgICBwb2xscyA9IChkaXJlY3RQb2xscyA/PyBbXSkubWFwKHBvbGwgPT4gKHtcbiAgICAgICAgaWQ6IHBvbGwuaWQsXG4gICAgICAgIHRpdGxlOiBwb2xsLnRpdGxlLFxuICAgICAgICB0b3RhbF92b3RlczogcG9sbC50b3RhbF92b3RlcyB8fCAwLFxuICAgICAgICBhZ2dyZWdhdGVkX3Jlc3VsdHM6IEFycmF5LmlzQXJyYXkocG9sbC5vcHRpb25zKSA/IFxuICAgICAgICAgIHBvbGwub3B0aW9ucy5yZWR1Y2UoKGFjYzogUmVjb3JkPHN0cmluZywgbnVtYmVyPiwgb3B0aW9uOiBQb2xsT3B0aW9uLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBhY2NbYG9wdGlvbl8ke2luZGV4ICsgMX1gXSA9IG9wdGlvbi52b3RlcyB8fCAwO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICB9LCB7fSkgOiB7fSxcbiAgICAgICAgc3RhdHVzOiBwb2xsLnN0YXR1c1xuICAgICAgfSkpO1xuICAgIH0gY2F0Y2ggKGZhbGxiYWNrRXJyb3IpIHtcbiAgICAgIGRldkxvZygnRXJyb3IgZmV0Y2hpbmcgcG9sbHM6JywgeyBlcnJvcjogZmFsbGJhY2tFcnJvciB9KTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFkZGl0aW9uYWwgc2VjdXJpdHk6IGVuc3VyZSBubyBzZW5zaXRpdmUgZGF0YSBpcyByZXR1cm5lZFxuICAgIGNvbnN0IHNhbml0aXplZFBvbGxzID0gcG9sbHMubWFwKHBvbGwgPT4gKHtcbiAgICAgIHBvbGxfaWQ6IHBvbGwuaWQsXG4gICAgICB0aXRsZTogcG9sbC50aXRsZSxcbiAgICAgIHRvdGFsX3ZvdGVzOiBwb2xsLnRvdGFsX3ZvdGVzLFxuICAgICAgLy8gT25seSBpbmNsdWRlIHNhZmUgZmllbGRzXG4gICAgICBzdGF0dXM6ICdhY3RpdmUnLCAvLyBBbHdheXMgc2hvdyBhcyBhY3RpdmUgZm9yIHB1YmxpYyB2aWV3XG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksIC8vIEdlbmVyaWMgdGltZXN0YW1wXG4gICAgfSkpIHx8IFtdO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBwb2xsczogc2FuaXRpemVkUG9sbHMsXG4gICAgICBjb3VudDogc2FuaXRpemVkUG9sbHMubGVuZ3RoLFxuICAgICAgbWVzc2FnZTogJ0FnZ3JlZ2F0ZWQgcG9sbCByZXN1bHRzIG9ubHkgLSBubyBpbmRpdmlkdWFsIHZvdGUgZGF0YSdcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGRldkxvZygnRXJyb3IgaW4gcG9sbHMgQVBJOicsIHsgZXJyb3IgfSk7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgIHN0YWNrOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWRcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbi8vIFBPU1QgL2FwaS9wb2xscyAtIENyZWF0ZSBuZXcgcG9sbCAoYXV0aGVudGljYXRlZCB1c2VycyBvbmx5KVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyBBbHdheXMgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiAtIG5vIEUyRSBieXBhc3Nlc1xuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQoKTtcbiAgICBcbiAgICBpZiAoIXN1cGFiYXNlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdTdXBhYmFzZSBjbGllbnQgbm90IGF2YWlsYWJsZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFsd2F5cyByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXG4gICAgbGV0IHVzZXI7XG4gICAgdHJ5IHtcbiAgICAgIHVzZXIgPSBhd2FpdCBnZXRVc2VyKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRldkxvZygnQXV0aGVudGljYXRpb24gZXJyb3IgZHVyaW5nIHBvbGwgY3JlYXRpb246JywgeyBlcnJvciB9KTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBWZXJpZnkgdXNlciBpcyBhY3RpdmVcbiAgICBpZiAodXNlcikge1xuICAgICAgY29uc3QgeyBkYXRhOiB1c2VyUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxuICAgICAgICAuc2VsZWN0KCdpc19hY3RpdmUnKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmICghdXNlclByb2ZpbGUgfHwgISgnaXNfYWN0aXZlJyBpbiB1c2VyUHJvZmlsZSkgfHwgIXVzZXJQcm9maWxlLmlzX2FjdGl2ZSkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ0FjdGl2ZSBhY2NvdW50IHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBcbiAgICAgIHRpdGxlLCBcbiAgICAgIG9wdGlvbnMsIFxuICAgICAgdm90aW5nTWV0aG9kID0gJ3NpbmdsZScsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIGNhdGVnb3J5ID0gJ2dlbmVyYWwnLFxuICAgICAgcHJpdmFjeUxldmVsID0gJ3B1YmxpYycsXG4gICAgICBhbGxvd011bHRpcGxlVm90ZXMgPSBmYWxzZSxcbiAgICAgIHNob3dSZXN1bHRzID0gdHJ1ZSxcbiAgICAgIGFsbG93Q29tbWVudHMgPSB0cnVlLFxuICAgICAgZW5kVGltZSxcbiAgICAgIGhhc2h0YWdzID0gW10sXG4gICAgICBwcmltYXJ5SGFzaHRhZ1xuICAgIH0gPSBib2R5O1xuXG4gICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgaWYgKCF0aXRsZSB8fCAhb3B0aW9ucyB8fCAhQXJyYXkuaXNBcnJheShvcHRpb25zKSB8fCBvcHRpb25zLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1RpdGxlIGFuZCBhdCBsZWFzdCAyIG9wdGlvbnMgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gU2FuaXRpemUgYW5kIHZhbGlkYXRlIG9wdGlvbnNcbiAgICBjb25zdCBzYW5pdGl6ZWRPcHRpb25zID0gb3B0aW9uc1xuICAgICAgLmZpbHRlcihvcHRpb24gPT4gdHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycgJiYgb3B0aW9uLnRyaW0oKS5sZW5ndGggPiAwKVxuICAgICAgLm1hcChvcHRpb24gPT4gb3B0aW9uLnRyaW0oKSlcbiAgICAgIC5zbGljZSgwLCAxMCk7IC8vIExpbWl0IHRvIDEwIG9wdGlvbnMgbWF4XG5cbiAgICBpZiAoc2FuaXRpemVkT3B0aW9ucy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdBdCBsZWFzdCAyIHZhbGlkIG9wdGlvbnMgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHBvbGwgd2l0aCB1c2VyIGFzIGNyZWF0b3JcbiAgICBjb25zdCB7IGRhdGE6IHBvbGwsIGVycm9yOiBwb2xsRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHRpdGxlOiB0aXRsZS50cmltKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbj8udHJpbSgpIHx8IG51bGwsXG4gICAgICAgIG9wdGlvbnM6IHNhbml0aXplZE9wdGlvbnMsXG4gICAgICAgIHZvdGluZ19tZXRob2Q6IHZvdGluZ01ldGhvZCxcbiAgICAgICAgcHJpdmFjeV9sZXZlbDogcHJpdmFjeUxldmVsLFxuICAgICAgICBjYXRlZ29yeSxcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgY3JlYXRlZF9ieTogdXNlcj8uaWQgfHwgJycsXG4gICAgICAgIHRvdGFsX3ZvdGVzOiAwLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uOiAwLFxuICAgICAgICBlbmRfdGltZTogZW5kVGltZSB8fCBudWxsLFxuICAgICAgICBoYXNodGFnczogaGFzaHRhZ3MgfHwgW10sXG4gICAgICAgIHByaW1hcnlfaGFzaHRhZzogcHJpbWFyeUhhc2h0YWcgfHwgbnVsbCxcbiAgICAgICAgcG9sbF9zZXR0aW5nczoge1xuICAgICAgICAgIGFsbG93TXVsdGlwbGVWb3RlcyxcbiAgICAgICAgICBzaG93UmVzdWx0cyxcbiAgICAgICAgICBhbGxvd0NvbW1lbnRzXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChwb2xsRXJyb3IpIHtcbiAgICAgIGRldkxvZygnRXJyb3IgY3JlYXRpbmcgcG9sbDonLCB7IGVycm9yOiBwb2xsRXJyb3IgfSk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHBvbGwnLCBkZXRhaWxzOiBwb2xsRXJyb3IgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFJldHVybiBzYW5pdGl6ZWQgcG9sbCBkYXRhIChubyBzZW5zaXRpdmUgaW5mb3JtYXRpb24pXG4gICAgY29uc3Qgc2FuaXRpemVkUG9sbCA9IHBvbGwgJiYgISgnZXJyb3InIGluIHBvbGwpID8ge1xuICAgICAgaWQ6IHBvbGwuaWQsXG4gICAgICB0aXRsZTogcG9sbC50aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBwb2xsLmRlc2NyaXB0aW9uLFxuICAgICAgb3B0aW9uczogcG9sbC5vcHRpb25zLFxuICAgICAgdm90aW5nX21ldGhvZDogcG9sbC52b3RpbmdfbWV0aG9kLFxuICAgICAgcHJpdmFjeV9sZXZlbDogcG9sbC5wcml2YWN5X2xldmVsLFxuICAgICAgY2F0ZWdvcnk6IHBvbGwuY2F0ZWdvcnksXG4gICAgICBzdGF0dXM6IHBvbGwuc3RhdHVzLFxuICAgICAgdG90YWxfdm90ZXM6IHBvbGwudG90YWxfdm90ZXMsXG4gICAgICBwYXJ0aWNpcGF0aW9uOiBwb2xsLnBhcnRpY2lwYXRpb24sXG4gICAgICBlbmRfdGltZTogcG9sbC5lbmRfdGltZSxcbiAgICAgIGhhc2h0YWdzOiBwb2xsLmhhc2h0YWdzIHx8IFtdLFxuICAgICAgcHJpbWFyeV9oYXNodGFnOiBwb2xsLnByaW1hcnlfaGFzaHRhZyxcbiAgICAgIHBvbGxfc2V0dGluZ3M6IHBvbGwucG9sbF9zZXR0aW5ncyxcbiAgICAgIGNyZWF0ZWRfYXQ6IHBvbGwuY3JlYXRlZF9hdFxuICAgIH0gOiBudWxsO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHNhbml0aXplZFBvbGwpO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgZGV2TG9nKCdFcnJvciBpbiBwb2xscyBBUEk6JywgeyBlcnJvciB9KTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkdFVCIsIlBPU1QiLCJkeW5hbWljIiwicmVxdWVzdCIsImNvbnNvbGUiLCJsb2ciLCJzdXBhYmFzZUNsaWVudCIsImdldFN1cGFiYXNlU2VydmVyQ2xpZW50IiwiTmV4dFJlc3BvbnNlIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwibGltaXQiLCJwYXJzZUludCIsImdldCIsIl9zdGF0dXMiLCJwb2xscyIsImRldkxvZyIsImRhdGEiLCJkaXJlY3RQb2xscyIsImRpcmVjdEVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiY291bnQiLCJsZW5ndGgiLCJtYXAiLCJwb2xsIiwiaWQiLCJ0aXRsZSIsInRvdGFsX3ZvdGVzIiwiYWdncmVnYXRlZF9yZXN1bHRzIiwiQXJyYXkiLCJpc0FycmF5Iiwib3B0aW9ucyIsInJlZHVjZSIsImFjYyIsIm9wdGlvbiIsImluZGV4Iiwidm90ZXMiLCJmYWxsYmFja0Vycm9yIiwic2FuaXRpemVkUG9sbHMiLCJwb2xsX2lkIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiZGV0YWlscyIsIkVycm9yIiwiU3RyaW5nIiwic3RhY2siLCJ1bmRlZmluZWQiLCJzdXBhYmFzZSIsInVzZXIiLCJnZXRVc2VyIiwidXNlclByb2ZpbGUiLCJzaW5nbGUiLCJpc19hY3RpdmUiLCJib2R5Iiwidm90aW5nTWV0aG9kIiwiZGVzY3JpcHRpb24iLCJjYXRlZ29yeSIsInByaXZhY3lMZXZlbCIsImFsbG93TXVsdGlwbGVWb3RlcyIsInNob3dSZXN1bHRzIiwiYWxsb3dDb21tZW50cyIsImVuZFRpbWUiLCJoYXNodGFncyIsInByaW1hcnlIYXNodGFnIiwic2FuaXRpemVkT3B0aW9ucyIsImZpbHRlciIsInRyaW0iLCJzbGljZSIsInBvbGxFcnJvciIsImluc2VydCIsInZvdGluZ19tZXRob2QiLCJwcml2YWN5X2xldmVsIiwiY3JlYXRlZF9ieSIsInBhcnRpY2lwYXRpb24iLCJlbmRfdGltZSIsInByaW1hcnlfaGFzaHRhZyIsInBvbGxfc2V0dGluZ3MiLCJzYW5pdGl6ZWRQb2xsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztRQXlCc0JBO2VBQUFBOztRQXNGQUM7ZUFBQUE7O1FBeEdUQztlQUFBQTs7O3dCQU5nQjs0QkFFTDt3QkFDRDt5QkFDaUI7QUFFakMsTUFBTUEsVUFBVTtBQWtCaEIsZUFBZUYsSUFBSUcsT0FBb0I7SUFDNUMsSUFBSTtR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
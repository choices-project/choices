{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/voting/components/MultipleChoiceVoting.tsx"],"sourcesContent":["'use client'\n\nimport { CheckCircle, AlertCircle, Info } from 'lucide-react'\nimport { useState, useEffect } from 'react'\n\ninterface PollOption {\n  id: string\n  text: string\n  description?: string\n}\n\ninterface MultipleChoiceVotingProps {\n  pollId: string\n  title: string\n  description?: string\n  options: PollOption[]\n  onVote: (selections: number[]) => Promise<void>\n  isVoting: boolean\n  hasVoted?: boolean\n  userVote?: number[]\n  maxSelections?: number\n}\n\nexport default function MultipleChoiceVoting({\n  pollId,\n  title,\n  description,\n  options,\n  onVote,\n  isVoting,\n  hasVoted = false,\n  userVote,\n  maxSelections\n}: MultipleChoiceVotingProps) {\n  const [selectedOptions, setSelectedOptions] = useState<number[]>(userVote || [])\n  const [error, setError] = useState<string | null>(null)\n  const [showExplanation, setShowExplanation] = useState(false)\n  const [isSubmitting, setIsSubmitting] = useState(false)\n\n  // Initialize from user's previous vote\n  useEffect(() => {\n    if (userVote !== undefined) {\n      setSelectedOptions(userVote)\n    }\n  }, [userVote])\n\n  const handleOptionToggle = (optionIndex: number) => {\n    if (hasVoted || isVoting) return\n    \n    setError(null)\n    \n    setSelectedOptions(prev => {\n      const isSelected = prev.includes(optionIndex)\n      if (isSelected) {\n        // Remove from selection\n        return prev.filter(idx => idx !== optionIndex)\n      } else {\n        // Add to selection (check max selections limit)\n        if (maxSelections && prev.length >= maxSelections) {\n          setError(`You can select up to ${maxSelections} options`)\n          return prev\n        }\n        return [...prev, optionIndex]\n      }\n    })\n  }\n\n  const handleSubmit = async () => {\n    if (hasVoted || isVoting) return\n\n    if (selectedOptions.length === 0) {\n      setError('Please select at least one option to vote')\n      return\n    }\n\n    setIsSubmitting(true)\n    setError(null)\n\n    try {\n      // Track analytics with poll ID using SSR-safe access\n      const { safeWindow } = await import('@/lib/utils/ssr-safe');\n      const gtag = safeWindow(w => w.gtag);\n      if (gtag) {\n        gtag('event', 'vote_submitted', {\n          poll_id: pollId,\n          selections: selectedOptions,\n          voting_method: 'multiple_choice'\n        })\n      }\n      \n      // Use the selections parameter properly\n      await onVote(selectedOptions)\n    } catch (err: unknown) {\n      setError(err instanceof Error ? err.message : 'Failed to submit vote')\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const isDisabled = hasVoted || isVoting || isSubmitting\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      {/* Header */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6\">\n        <div className=\"flex items-start justify-between mb-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">{title}</h1>\n            {description && (\n              <p className=\"text-gray-600\">{description}</p>\n            )}\n          </div>\n          <button\n            onClick={() => setShowExplanation(!showExplanation)}\n            className=\"flex items-center space-x-2 text-blue-600 hover:text-blue-700 transition-colors\"\n          >\n            <Info className=\"w-5 h-5\" />\n            <span className=\"text-sm font-medium\">How it works</span>\n          </button>\n        </div>\n\n        {/* Multiple Choice Explanation */}\n        {showExplanation && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\n            <h3 className=\"font-semibold text-blue-900 mb-2\">How Multiple Choice Voting Works</h3>\n            <div className=\"text-sm text-blue-800 space-y-2\">\n              <p>‚Ä¢ <strong>Select multiple options:</strong> Choose all options you support</p>\n              <p>‚Ä¢ <strong>Express preferences:</strong> Show support for multiple ideas</p>\n              <p>‚Ä¢ <strong>Flexible voting:</strong> Perfect when multiple options can coexist</p>\n              <p>‚Ä¢ <strong>Consensus building:</strong> Great for finding common ground</p>\n            </div>\n          </div>\n        )}\n\n        {/* Voting Method Badge */}\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium\">\n            üéØ Multiple Choice Voting\n          </div>\n          <span className=\"text-sm text-gray-500\">\n            Select all options you support\n            {maxSelections && ` (up to ${maxSelections})`}\n          </span>\n        </div>\n      </div>\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\n          <div className=\"flex items-center\">\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-2\" />\n            <p className=\"text-red-800\">{error}</p>\n          </div>\n        </div>\n      )}\n\n      {/* Voting Interface */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\" data-testid=\"voting-form\">\n        <div className=\"space-y-3\">\n          {options.map((option: PollOption, index: number) => (\n            <div\n              key={option.id}\n              onClick={() => handleOptionToggle(index)}\n              className={`\n                relative p-4 border-2 rounded-lg cursor-pointer transition-all duration-200\n                ${isDisabled \n                  ? 'cursor-not-allowed opacity-60' \n                  : 'hover:border-green-300 hover:bg-green-50'\n                }\n                ${selectedOptions.includes(index)\n                  ? 'border-green-500 bg-green-50' \n                  : 'border-gray-200'\n                }\n              `}\n              data-testid={`option-${index + 1}-checkbox`}\n            >\n              <div className=\"flex items-start space-x-3\">\n                {/* Checkbox */}\n                <div className=\"flex-shrink-0 mt-1\">\n                  <div className={`\n                    w-5 h-5 rounded border-2 flex items-center justify-center\n                    ${selectedOptions.includes(index)\n                      ? 'border-green-500 bg-green-500'\n                      : 'border-gray-300 bg-white'\n                    }\n                    transition-all duration-200\n                  `}>\n                    {selectedOptions.includes(index) && (\n                      <CheckCircle className=\"w-3 h-3 text-white\" />\n                    )}\n                  </div>\n                </div>\n\n                {/* Option Content */}\n                <div className=\"flex-1\">\n                  <h3 className=\"font-semibold text-gray-900 mb-1\">{option.text}</h3>\n                  {option.description && (\n                    <p className=\"text-sm text-gray-600\">{option.description}</p>\n                  )}\n                </div>\n\n                {/* Selection Indicator */}\n                {selectedOptions.includes(index) && (\n                  <div className=\"flex-shrink-0\">\n                    <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Instructions */}\n        <div className=\"mt-6 p-4 bg-gray-50 rounded-lg\">\n          <div className=\"flex items-center space-x-2 mb-2\">\n            <CheckCircle className=\"w-5 h-5 text-gray-600\" />\n            <span className=\"font-medium text-gray-900\">Voting Instructions</span>\n          </div>\n          <div className=\"text-sm text-gray-600 space-y-1\">\n            <p>‚Ä¢ Click on options to select/deselect them</p>\n            <p>‚Ä¢ You can select multiple options</p>\n            <p>‚Ä¢ You can change your selections before submitting</p>\n            <p>‚Ä¢ All selected options will be counted in the results</p>\n            {maxSelections && (\n              <p>‚Ä¢ Maximum {maxSelections} selections allowed</p>\n            )}\n          </div>\n        </div>\n\n        {/* Submit Button */}\n        <div className=\"mt-6 flex justify-center\">\n          {hasVoted ? (\n            <div className=\"flex items-center space-x-2 text-green-600\" data-testid=\"vote-confirmation\">\n              <CheckCircle className=\"w-5 h-5\" />\n              <span className=\"font-medium\" data-testid=\"vote-receipt\">Vote submitted successfully!</span>\n            </div>\n          ) : (\n            <button\n              onClick={handleSubmit}\n              disabled={isDisabled || selectedOptions.length === 0}\n              className={`\n                flex items-center space-x-2 px-8 py-3 rounded-lg font-medium transition-colors\n                ${isDisabled || selectedOptions.length === 0\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                  : 'bg-green-600 text-white hover:bg-green-700'\n                }\n              `}\n              data-testid=\"submit-vote-button\"\n            >\n              <CheckCircle className=\"w-5 h-5\" />\n              <span>{isSubmitting ? 'Submitting Vote...' : 'Submit Vote'}</span>\n            </button>\n          )}\n        </div>\n\n        {/* Selection Summary */}\n        {selectedOptions.length > 0 && !hasVoted && (\n          <div className=\"mt-4 text-center\">\n            <div className=\"text-sm text-gray-600\">\n              Selected {selectedOptions.length} option{selectedOptions.length !== 1 ? 's' : ''}: <span className=\"font-medium text-green-600\">\n                {selectedOptions.map(idx => options[idx]?.text).join(', ')}\n              </span>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Best Practices */}\n      <div className=\"mt-6 bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n        <h3 className=\"font-semibold text-gray-900 mb-3\">When to Use Multiple Choice Voting</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\">\n          <div>\n            <h4 className=\"font-medium text-gray-900 mb-2\">‚úÖ Good For:</h4>\n            <ul className=\"space-y-1\">\n              <li>‚Ä¢ Feature requests</li>\n              <li>‚Ä¢ Preference surveys</li>\n              <li>‚Ä¢ Multi-topic polls</li>\n              <li>‚Ä¢ Consensus building</li>\n              <li>‚Ä¢ When multiple options can coexist</li>\n            </ul>\n          </div>\n          <div>\n            <h4 className=\"font-medium text-gray-900 mb-2\">‚ö†Ô∏è Consider Alternatives For:</h4>\n            <ul className=\"space-y-1\">\n              <li>‚Ä¢ Mutually exclusive choices</li>\n              <li>‚Ä¢ Single winner scenarios</li>\n              <li>‚Ä¢ When ranking matters</li>\n              <li>‚Ä¢ Binary decisions</li>\n              <li>‚Ä¢ When you need a clear winner</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":["MultipleChoiceVoting","pollId","title","description","options","onVote","isVoting","hasVoted","userVote","maxSelections","selectedOptions","setSelectedOptions","useState","error","setError","showExplanation","setShowExplanation","isSubmitting","setIsSubmitting","useEffect","undefined","handleOptionToggle","optionIndex","prev","isSelected","includes","filter","idx","length","handleSubmit","safeWindow","gtag","w","poll_id","selections","voting_method","err","Error","message","isDisabled","div","className","h1","p","button","onClick","Info","span","h3","strong","AlertCircle","data-testid","map","option","index","CheckCircle","text","id","disabled","join","h4","ul","li"],"mappings":"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"}
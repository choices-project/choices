{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/stores/analyticsStore.ts"],"sourcesContent":["/**\n * @fileoverview Analytics Store - Zustand Implementation\n * \n * Analytics state management including event tracking,\n * user behavior analytics, performance metrics, and analytics preferences.\n * Consolidates scattered analytics hooks and local state.\n * \n * @author Choices Platform Team\n * @created 2025-10-24\n * @version 2.0.0\n * @since 1.0.0\n */\n\nimport { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { persist } from 'zustand/middleware';\n\nimport { logger } from '../logger';\n\n// Sophisticated Analytics data types with advanced features\ninterface AnalyticsEvent {\n  id: string;\n  event_type: string;\n  user_id?: string;\n  session_id: string;\n  event_data: Record<string, any>;\n  ip_address?: string;\n  user_agent?: string;\n  created_at: string;\n  timestamp: string;\n  type: string;\n  category: string;\n  action: string;\n  label?: string;\n  value?: number;\n  metadata?: Record<string, any>;\n  analytics_event_data?: Array<{\n    data_key: string;\n    data_value: string;\n    data_type: string;\n  }>;\n}\n\n// Advanced analytics metrics\ninterface AnalyticsMetrics {\n  totalEvents: number;\n  uniqueUsers: number;\n  sessionDuration: number;\n  bounceRate: number;\n  conversionRate: number;\n  engagementScore: number;\n  trustScore: number;\n  participationRate: number;\n}\n\n// Chart data types for analytics visualization\ninterface ChartData {\n  name: string;\n  value: number;\n  color: string;\n  confidence?: number;\n  previousValue?: number;\n}\n\ninterface ChartConfig {\n  data: ChartData[];\n  maxValue: number;\n  showTrends: boolean;\n  showConfidence: boolean;\n  title?: string;\n  subtitle?: string;\n  type?: 'bar' | 'progress';\n}\n\ninterface PerformanceMetrics {\n  pageLoadTime: number;\n  timeToInteractive: number;\n  firstContentfulPaint: number;\n  largestContentfulPaint: number;\n  cumulativeLayoutShift: number;\n  firstInputDelay: number;\n  totalBlockingTime: number;\n  memoryUsage?: number;\n  networkLatency?: number;\n}\n\ninterface UserBehaviorData {\n  sessionDuration: number;\n  pageViews: number;\n  interactions: number;\n  bounceRate: number;\n  conversionRate: number;\n  userJourney: string[];\n  engagementScore: number;\n  lastActivity: string;\n  deviceType: string;\n  browser: string;\n  os: string;\n}\n\ninterface AnalyticsPreferences {\n  trackingEnabled: boolean;\n  performanceTracking: boolean;\n  errorTracking: boolean;\n  userBehaviorTracking: boolean;\n  marketingTracking: boolean;\n  dataRetention: number; // days\n  anonymizeData: boolean;\n  shareWithThirdParties: boolean;\n}\n\ninterface AnalyticsDashboard {\n  totalEvents: number;\n  uniqueUsers: number;\n  sessionCount: number;\n  averageSessionDuration: number;\n  topPages: Array<{ page: string; views: number }>;\n  topActions: Array<{ action: string; count: number }>;\n  userEngagement: number;\n  conversionFunnel: Array<{ step: string; users: number; conversion: number }>;\n}\n\n// Analytics store state interface\ninterface AnalyticsStore {\n  // Analytics data\n  events: AnalyticsEvent[];\n  performanceMetrics: PerformanceMetrics | null;\n  userBehavior: UserBehaviorData | null;\n  dashboard: AnalyticsDashboard | null;\n  \n  // Chart data management\n  chartConfig: ChartConfig | null;\n  chartData: ChartData[];\n  chartMaxValue: number;\n  chartShowTrends: boolean;\n  chartShowConfidence: boolean;\n  \n  // Analytics settings\n  preferences: AnalyticsPreferences;\n  trackingEnabled: boolean;\n  sessionId: string;\n  \n  // Loading states\n  isLoading: boolean;\n  isTracking: boolean;\n  isSending: boolean;\n  error: string | null;\n  \n  // Actions - Event tracking\n  trackEvent: (event: Omit<AnalyticsEvent, 'id' | 'timestamp' | 'sessionId'>) => void;\n  trackPageView: (page: string, metadata?: Record<string, any>) => void;\n  trackUserAction: (action: string, category: string, label?: string, value?: number) => void;\n  trackError: (error: Error, context?: Record<string, any>) => void;\n  trackPerformance: (metrics: Partial<PerformanceMetrics>) => void;\n  \n  // Actions - Data management\n  setEvents: (events: AnalyticsEvent[]) => void;\n  addEvent: (event: AnalyticsEvent) => void;\n  clearEvents: () => void;\n  setPerformanceMetrics: (metrics: PerformanceMetrics) => void;\n  updateUserBehavior: (behavior: Partial<UserBehaviorData>) => void;\n  setDashboard: (dashboard: AnalyticsDashboard) => void;\n  \n  // Actions - Chart data management\n  setChartData: (data: ChartData[]) => void;\n  setChartConfig: (config: ChartConfig) => void;\n  updateChartConfig: (config: Partial<ChartConfig>) => void;\n  setChartMaxValue: (maxValue: number) => void;\n  setChartShowTrends: (showTrends: boolean) => void;\n  setChartShowConfidence: (showConfidence: boolean) => void;\n  clearChartData: () => void;\n  \n  // Actions - Preferences\n  updatePreferences: (preferences: Partial<AnalyticsPreferences>) => void;\n  setTrackingEnabled: (enabled: boolean) => void;\n  resetPreferences: () => void;\n  \n  // Actions - Data operations\n  sendAnalytics: () => Promise<void>;\n  exportAnalytics: () => Promise<AnalyticsEvent[]>;\n  importAnalytics: (events: AnalyticsEvent[]) => void;\n  generateReport: (startDate: string, endDate: string) => Promise<AnalyticsDashboard>;\n  \n  // Actions - Loading states\n  setLoading: (loading: boolean) => void;\n  setTracking: (tracking: boolean) => void;\n  setSending: (sending: boolean) => void;\n  setError: (error: string | null) => void;\n  clearError: () => void;\n}\n\n// Default analytics preferences\nconst defaultPreferences: AnalyticsPreferences = {\n  trackingEnabled: true,\n  performanceTracking: true,\n  errorTracking: true,\n  userBehaviorTracking: true,\n  marketingTracking: false,\n  dataRetention: 365, // 1 year\n  anonymizeData: true,\n  shareWithThirdParties: false,\n};\n\n// Create analytics store with middleware\nexport const useAnalyticsStore = create<AnalyticsStore>()(\n  devtools(\n    persist(\n      (set, get) => ({\n        // Initial state\n        events: [],\n        performanceMetrics: null,\n        userBehavior: null,\n        dashboard: null,\n        chartConfig: null,\n        chartData: [],\n        chartMaxValue: 0,\n        chartShowTrends: false,\n        chartShowConfidence: false,\n        preferences: defaultPreferences,\n        trackingEnabled: true,\n        sessionId: `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        isLoading: false,\n        isTracking: false,\n        isSending: false,\n        error: null,\n        \n        // Event tracking actions\n        trackEvent: (event) => set((state) => {\n          if (!state.trackingEnabled || !state.preferences.trackingEnabled) {\n            return state;\n          }\n          \n          const newEvent: AnalyticsEvent = {\n            ...event,\n            id: `event_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n            timestamp: new Date().toISOString(),\n            sessionId: state.sessionId,\n          } as AnalyticsEvent;\n          \n          const updatedEvents = [...state.events, newEvent];\n          \n          // Limit events to prevent memory issues\n          const maxEvents = 1000;\n          const eventsToKeep = updatedEvents.slice(-maxEvents);\n          \n          logger.info('Analytics event tracked', {\n            type: event.type,\n            category: event.category,\n            action: event.action,\n            sessionId: state.sessionId\n          });\n          \n          return { events: eventsToKeep };\n        }),\n        \n        trackPageView: (page, metadata) => {\n          const { trackEvent } = get();\n          trackEvent({\n            event_type: 'page_view',\n            session_id: get().sessionId,\n            event_data: {},\n            created_at: new Date().toISOString(),\n            type: 'page_view',\n            category: 'navigation',\n            action: 'page_view',\n            label: page,\n            value: 1,\n            metadata: {\n              ...(metadata ?? {}),\n              page,\n              userAgent: navigator.userAgent,\n              referrer: document.referrer,\n            },\n          });\n        },\n        \n        trackUserAction: (action, category, label, value) => {\n          const { trackEvent } = get();\n          trackEvent({\n            event_type: 'user_action',\n            session_id: get().sessionId,\n            event_data: {},\n            created_at: new Date().toISOString(),\n            type: 'user_action',\n            category,\n            action,\n            label: label ?? '',\n            value: value ?? 0,\n          });\n        },\n        \n        trackError: (error, context) => {\n          const { trackEvent } = get();\n          trackEvent({\n            event_type: 'error',\n            session_id: get().sessionId,\n            event_data: {},\n            created_at: new Date().toISOString(),\n            type: 'error',\n            category: 'error',\n            action: 'error_occurred',\n            label: error.message,\n            metadata: {\n              error: {\n                name: error.name,\n                message: error.message,\n                stack: error.stack,\n              },\n              context,\n            },\n          });\n        },\n        \n        trackPerformance: (metrics) => set((state) => {\n          if (!state.preferences.performanceTracking) {\n            return state;\n          }\n          \n          const updatedMetrics = state.performanceMetrics \n            ? { ...state.performanceMetrics, ...metrics }\n            : metrics as PerformanceMetrics;\n          \n          logger.info('Performance metrics tracked', {\n            pageLoadTime: updatedMetrics.pageLoadTime,\n            timeToInteractive: updatedMetrics.timeToInteractive,\n          });\n          \n          return { performanceMetrics: updatedMetrics };\n        }),\n        \n        // Data management actions\n        setEvents: (events) => set({ events }),\n        \n        addEvent: (event) => set((state) => ({\n          events: [...state.events, event]\n        })),\n        \n        clearEvents: () => set({ events: [] }),\n        \n        setPerformanceMetrics: (metrics) => set({ performanceMetrics: metrics }),\n        \n        updateUserBehavior: (behavior) => set((state) => ({\n          userBehavior: state.userBehavior \n            ? { ...state.userBehavior, ...behavior }\n            : behavior as UserBehaviorData\n        })),\n        \n        setDashboard: (dashboard) => set({ dashboard }),\n        \n        // Chart data management actions\n        setChartData: (data) => set({ chartData: data }),\n        \n        setChartConfig: (config) => set({ \n          chartConfig: config,\n          chartData: config.data,\n          chartMaxValue: config.maxValue,\n          chartShowTrends: config.showTrends,\n          chartShowConfidence: config.showConfidence\n        }),\n        \n        updateChartConfig: (config) => set((state) => ({\n          chartConfig: state.chartConfig \n            ? { ...state.chartConfig, ...config }\n            : config as ChartConfig,\n          chartData: config.data ?? state.chartData,\n          chartMaxValue: config.maxValue ?? state.chartMaxValue,\n          chartShowTrends: config.showTrends !== undefined ? config.showTrends : state.chartShowTrends,\n          chartShowConfidence: config.showConfidence !== undefined ? config.showConfidence : state.chartShowConfidence\n        })),\n        \n        setChartMaxValue: (maxValue) => set({ chartMaxValue: maxValue }),\n        \n        setChartShowTrends: (showTrends) => set({ chartShowTrends: showTrends }),\n        \n        setChartShowConfidence: (showConfidence) => set({ chartShowConfidence: showConfidence }),\n        \n        clearChartData: () => set({ \n          chartConfig: null,\n          chartData: [],\n          chartMaxValue: 0,\n          chartShowTrends: false,\n          chartShowConfidence: false\n        }),\n        \n        // Preferences actions\n        updatePreferences: (preferences) => set((state) => ({\n          preferences: { ...state.preferences, ...preferences }\n        })),\n        \n        setTrackingEnabled: (enabled) => set({ trackingEnabled: enabled }),\n        \n        resetPreferences: () => set({ preferences: defaultPreferences }),\n        \n        // Data operations\n        sendAnalytics: async () => {\n          const { setSending, setError } = get();\n          \n          try {\n            setSending(true);\n            setError(null);\n            \n            const state = get();\n            const response = await fetch('/api/analytics/unified/events?methods=comprehensive&ai-provider=rule-based', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                events: state.events,\n                sessionId: state.sessionId,\n                timestamp: new Date().toISOString(),\n              }),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to send analytics data');\n            }\n            \n            // Clear sent events\n            set({ events: [] });\n            \n            logger.info('Analytics data sent successfully', {\n              eventCount: state.events.length,\n              sessionId: state.sessionId\n            });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to send analytics data:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setSending(false);\n          }\n        },\n        \n        exportAnalytics: async () => {\n          const state = get();\n          return state.events;\n        },\n        \n        importAnalytics: (events) => set({ events }),\n        \n        generateReport: async (startDate, endDate) => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            const response = await fetch('/api/analytics/unified/report?methods=comprehensive&ai-provider=rule-based', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ startDate, endDate }),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to generate analytics report');\n            }\n            \n            const dashboard = await response.json();\n            set({ dashboard });\n            \n            logger.info('Analytics report generated', {\n              startDate,\n              endDate,\n              totalEvents: dashboard.totalEvents\n            });\n            \n            return dashboard;\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to generate analytics report:', error instanceof Error ? error : new Error(errorMessage));\n            throw error;\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        // Loading state actions\n        setLoading: (loading) => set({ isLoading: loading }),\n        setTracking: (tracking) => set({ isTracking: tracking }),\n        setSending: (sending) => set({ isSending: sending }),\n        setError: (error) => set({ error }),\n        clearError: () => set({ error: null }),\n      }),\n      {\n        name: 'analytics-store',\n        partialize: (state) => ({\n          preferences: state.preferences,\n          trackingEnabled: state.trackingEnabled,\n          sessionId: state.sessionId,\n        }),\n      }\n    ),\n    { name: 'analytics-store' }\n  )\n);\n\n// Store selectors for optimized re-renders\nexport const useAnalyticsEvents = () => useAnalyticsStore(state => state.events);\nexport const useAnalyticsMetrics = () => useAnalyticsStore(state => state.performanceMetrics);\nexport const useAnalyticsBehavior = () => useAnalyticsStore(state => state.userBehavior);\nexport const useAnalyticsDashboard = () => useAnalyticsStore(state => state.dashboard);\nexport const useAnalyticsPreferences = () => useAnalyticsStore(state => state.preferences);\nexport const useAnalyticsTracking = () => useAnalyticsStore(state => state.trackingEnabled);\nexport const useAnalyticsLoading = () => useAnalyticsStore(state => state.isLoading);\nexport const useAnalyticsError = () => useAnalyticsStore(state => state.error);\n\n// Chart data selectors\nexport const useAnalyticsChartData = () => useAnalyticsStore(state => state.chartData);\nexport const useAnalyticsChartConfig = () => useAnalyticsStore(state => state.chartConfig);\nexport const useAnalyticsChartMaxValue = () => useAnalyticsStore(state => state.chartMaxValue);\nexport const useAnalyticsChartShowTrends = () => useAnalyticsStore(state => state.chartShowTrends);\nexport const useAnalyticsChartShowConfidence = () => useAnalyticsStore(state => state.chartShowConfidence);\n\n// Action selectors\nexport const useAnalyticsActions = () => useAnalyticsStore(state => ({\n  trackEvent: state.trackEvent,\n  trackPageView: state.trackPageView,\n  trackUserAction: state.trackUserAction,\n  trackError: state.trackError,\n  trackPerformance: state.trackPerformance,\n  setEvents: state.setEvents,\n  addEvent: state.addEvent,\n  clearEvents: state.clearEvents,\n  setPerformanceMetrics: state.setPerformanceMetrics,\n  updateUserBehavior: state.updateUserBehavior,\n  setDashboard: state.setDashboard,\n  setChartData: state.setChartData,\n  setChartConfig: state.setChartConfig,\n  updateChartConfig: state.updateChartConfig,\n  setChartMaxValue: state.setChartMaxValue,\n  setChartShowTrends: state.setChartShowTrends,\n  setChartShowConfidence: state.setChartShowConfidence,\n  clearChartData: state.clearChartData,\n  updatePreferences: state.updatePreferences,\n  setTrackingEnabled: state.setTrackingEnabled,\n  resetPreferences: state.resetPreferences,\n  sendAnalytics: state.sendAnalytics,\n  exportAnalytics: state.exportAnalytics,\n  importAnalytics: state.importAnalytics,\n  generateReport: state.generateReport,\n  setLoading: state.setLoading,\n  setTracking: state.setTracking,\n  setSending: state.setSending,\n  setError: state.setError,\n  clearError: state.clearError,\n}));\n\n// Computed selectors\nexport const useAnalyticsStats = () => useAnalyticsStore(state => ({\n  totalEvents: state.events.length,\n  sessionId: state.sessionId,\n  trackingEnabled: state.trackingEnabled,\n  preferences: state.preferences,\n  hasPerformanceMetrics: !!state.performanceMetrics,\n  hasUserBehavior: !!state.userBehavior,\n  hasDashboard: !!state.dashboard,\n}));\n\nexport const useAnalyticsSession = () => useAnalyticsStore(state => ({\n  sessionId: state.sessionId,\n  events: state.events,\n  isTracking: state.isTracking,\n  isSending: state.isSending,\n}));\n\n// Chart data computed selectors\nexport const useAnalyticsChartContext = () => useAnalyticsStore(state => ({\n  data: state.chartData,\n  maxValue: state.chartMaxValue,\n  showTrends: state.chartShowTrends,\n  showConfidence: state.chartShowConfidence,\n}));\n\n// Store utilities\nexport const analyticsStoreUtils = {\n  /**\n   * Get analytics summary\n   */\n  getAnalyticsSummary: () => {\n    const state = useAnalyticsStore.getState();\n    return {\n      totalEvents: state.events.length,\n      sessionId: state.sessionId,\n      trackingEnabled: state.trackingEnabled,\n      preferences: state.preferences,\n      performanceMetrics: state.performanceMetrics,\n      userBehavior: state.userBehavior,\n    };\n  },\n  \n  /**\n   * Get events by type\n   */\n  getEventsByType: (type: string) => {\n    const state = useAnalyticsStore.getState();\n    return state.events.filter(event => event.type === type);\n  },\n  \n  /**\n   * Get events by category\n   */\n  getEventsByCategory: (category: string) => {\n    const state = useAnalyticsStore.getState();\n    return state.events.filter(event => event.category === category);\n  },\n  \n  /**\n   * Get recent events\n   */\n  getRecentEvents: (limit = 10) => {\n    const state = useAnalyticsStore.getState();\n    return state.events\n      .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n      .slice(0, limit);\n  },\n  \n  /**\n   * Check if tracking is enabled\n   */\n  isTrackingEnabled: () => {\n    const state = useAnalyticsStore.getState();\n    return state.trackingEnabled && state.preferences.trackingEnabled;\n  },\n  \n  /**\n   * Get analytics configuration\n   */\n  getAnalyticsConfig: () => {\n    const state = useAnalyticsStore.getState();\n    return {\n      trackingEnabled: state.trackingEnabled,\n      preferences: state.preferences,\n      sessionId: state.sessionId,\n    };\n  }\n};\n\n// Store subscriptions for external integrations\nexport const analyticsStoreSubscriptions = {\n  /**\n   * Subscribe to event tracking\n   */\n  onEventTracked: (callback: (event: AnalyticsEvent) => void) => {\n    let prevEvents: AnalyticsEvent[] = [];\n    return useAnalyticsStore.subscribe(\n      (state) => {\n        const events = state.events;\n        if (events.length > prevEvents.length) {\n          const newEvent = events[events.length - 1];\n          if (newEvent) {\n            callback(newEvent);\n          }\n        }\n        prevEvents = events;\n        return events;\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to performance metrics changes\n   */\n  onPerformanceMetricsChange: (callback: (metrics: PerformanceMetrics) => void) => {\n    let prevMetrics: PerformanceMetrics | null = null;\n    return useAnalyticsStore.subscribe(\n      (state) => {\n        const metrics = state.performanceMetrics;\n        if (metrics !== prevMetrics && metrics !== null) {\n          callback(metrics);\n        }\n        prevMetrics = metrics;\n        return metrics;\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to tracking enabled changes\n   */\n  onTrackingEnabledChange: (callback: (enabled: boolean) => void) => {\n    let prevEnabled: boolean | null = null;\n    return useAnalyticsStore.subscribe(\n      (state) => {\n        const enabled = state.trackingEnabled;\n        if (enabled !== prevEnabled) {\n          callback(enabled);\n        }\n        prevEnabled = enabled;\n        return enabled;\n      }\n    );\n  }\n};\n\n// Store debugging utilities\nexport const analyticsStoreDebug = {\n  /**\n   * Log current analytics state\n   */\n  logState: () => {\n    const state = useAnalyticsStore.getState();\n    logger.debug('Analytics Store State', {\n      totalEvents: state.events.length,\n      sessionId: state.sessionId,\n      trackingEnabled: state.trackingEnabled,\n      preferences: state.preferences,\n      hasPerformanceMetrics: !!state.performanceMetrics,\n      hasUserBehavior: !!state.userBehavior,\n      isLoading: state.isLoading,\n      error: state.error\n    });\n  },\n  \n  /**\n   * Log analytics summary\n   */\n  logSummary: () => {\n    const summary = analyticsStoreUtils.getAnalyticsSummary();\n    logger.debug('Analytics Summary', summary);\n  },\n  \n  /**\n   * Log recent events\n   */\n  logRecentEvents: (limit = 5) => {\n    const events = analyticsStoreUtils.getRecentEvents(limit);\n    logger.debug('Recent Analytics Events', { events });\n  },\n  \n  /**\n   * Reset analytics store\n   */\n  reset: () => {\n    useAnalyticsStore.getState().clearEvents();\n    useAnalyticsStore.getState().resetPreferences();\n    logger.info('Analytics store reset');\n  }\n};\n"],"names":["analyticsStoreDebug","analyticsStoreSubscriptions","analyticsStoreUtils","useAnalyticsActions","useAnalyticsBehavior","useAnalyticsChartConfig","useAnalyticsChartContext","useAnalyticsChartData","useAnalyticsChartMaxValue","useAnalyticsChartShowConfidence","useAnalyticsChartShowTrends","useAnalyticsDashboard","useAnalyticsError","useAnalyticsEvents","useAnalyticsLoading","useAnalyticsMetrics","useAnalyticsPreferences","useAnalyticsSession","useAnalyticsStats","useAnalyticsStore","useAnalyticsTracking","defaultPreferences","trackingEnabled","performanceTracking","errorTracking","userBehaviorTracking","marketingTracking","dataRetention","anonymizeData","shareWithThirdParties","create","devtools","persist","set","get","events","performanceMetrics","userBehavior","dashboard","chartConfig","chartData","chartMaxValue","chartShowTrends","chartShowConfidence","preferences","sessionId","Date","now","Math","random","toString","substr","isLoading","isTracking","isSending","error","trackEvent","event","state","newEvent","id","timestamp","toISOString","updatedEvents","maxEvents","eventsToKeep","slice","logger","info","type","category","action","trackPageView","page","metadata","event_type","session_id","event_data","created_at","label","value","userAgent","navigator","referrer","document","trackUserAction","trackError","context","message","name","stack","trackPerformance","metrics","updatedMetrics","pageLoadTime","timeToInteractive","setEvents","addEvent","clearEvents","setPerformanceMetrics","updateUserBehavior","behavior","setDashboard","setChartData","data","setChartConfig","config","maxValue","showTrends","showConfidence","updateChartConfig","undefined","setChartMaxValue","setChartShowTrends","setChartShowConfidence","clearChartData","updatePreferences","setTrackingEnabled","enabled","resetPreferences","sendAnalytics","setSending","setError","response","fetch","method","headers","body","JSON","stringify","ok","Error","eventCount","length","errorMessage","exportAnalytics","importAnalytics","generateReport","startDate","endDate","setLoading","json","totalEvents","loading","setTracking","tracking","sending","clearError","partialize","hasPerformanceMetrics","hasUserBehavior","hasDashboard","getAnalyticsSummary","getState","getEventsByType","filter","getEventsByCategory","getRecentEvents","limit","sort","a","b","getTime","isTrackingEnabled","getAnalyticsConfig","onEventTracked","callback","prevEvents","subscribe","onPerformanceMetricsChange","prevMetrics","onTrackingEnabledChange","prevEnabled","logState","debug","logSummary","summary","logRecentEvents","reset"],"mappings":"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"}
fd364aff15ffe844dc75f6f190f88187
/**
 * Ranked Choice Voting Strategy
 * 
 * Implements ranked choice voting where voters rank options in order of preference.
 * Uses instant runoff voting (IRV) to determine the winner.
 * 
 * Created: September 15, 2025
 * Updated: September 15, 2025
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "RankedStrategy", {
    enumerable: true,
    get: function() {
        return RankedStrategy;
    }
});
const _logger = require("../../utils/logger");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
class RankedStrategy {
    getVotingMethod() {
        return 'ranked';
    }
    async validateVote(request, poll) {
        await Promise.resolve(); // Satisfy require-await rule
        try {
            const voteData = request.voteData;
            // Validate rankings array exists
            if (!voteData.rankings || !Array.isArray(voteData.rankings)) {
                return {
                    valid: false,
                    isValid: false,
                    error: 'Rankings must be an array',
                    errors: [
                        'Rankings must be an array'
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            // Validate rankings array is not empty
            if (voteData.rankings.length === 0) {
                return {
                    valid: false,
                    isValid: false,
                    error: 'At least one ranking is required',
                    errors: [
                        'At least one ranking is required'
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            // Validate all rankings are valid integers
            for (const ranking of voteData.rankings){
                if (typeof ranking !== 'number' || !Number.isInteger(ranking)) {
                    return {
                        valid: false,
                        isValid: false,
                        error: 'Rankings must be integers',
                        errors: [
                            'Rankings must be integers'
                        ],
                        requiresAuthentication: false,
                        requiresTokens: false
                    };
                }
                if (ranking < 0 || ranking >= poll.options.length) {
                    return {
                        valid: false,
                        isValid: false,
                        error: 'Invalid option selected',
                        errors: [
                            'Invalid option selected'
                        ],
                        requiresAuthentication: false,
                        requiresTokens: false
                    };
                }
            }
            // Check for duplicate rankings
            const uniqueRankings = new Set(voteData.rankings);
            if (uniqueRankings.size !== voteData.rankings.length) {
                return {
                    valid: false,
                    isValid: false,
                    error: 'Duplicate rankings are not allowed',
                    errors: [
                        'Duplicate rankings are not allowed'
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            // Check maximum rankings limit
            const maxRankings = poll.votingConfig?.maxChoices || poll.options.length;
            if (voteData.rankings.length > maxRankings) {
                return {
                    valid: false,
                    isValid: false,
                    error: `Maximum ${maxRankings} rankings allowed`,
                    errors: [
                        `Maximum ${maxRankings} rankings allowed`
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            (0, _logger.devLog)('Ranked vote validated successfully', {
                pollId: request.pollId,
                rankings: voteData.rankings,
                userId: request.userId
            });
            return {
                valid: true,
                isValid: true,
                requiresAuthentication: false,
                requiresTokens: false
            };
        } catch (error) {
            (0, _logger.devLog)('Ranked vote validation error:', {
                error: error instanceof Error ? error.message : String(error)
            });
            return {
                valid: false,
                isValid: false,
                error: 'Ranked vote validation failed',
                errors: [
                    'Ranked vote validation failed'
                ],
                requiresAuthentication: false,
                requiresTokens: false
            };
        }
    }
    async processVote(request, poll) {
        await Promise.resolve(); // Satisfy require-await rule
        try {
            const voteData = request.voteData;
            // Create vote data for storage
            const voteRecord = {
                id: `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                pollId: request.pollId,
                userId: request.userId,
                rankings: voteData.rankings,
                privacyLevel: 'standard',
                auditReceipt: `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                timestamp: new Date(),
                ipAddress: request.ipAddress,
                userAgent: request.userAgent
            };
            (0, _logger.devLog)('Ranked vote processed successfully', {
                pollId: request.pollId,
                userId: request.userId,
                rankings: voteData.rankings,
                voteId: voteRecord.id
            });
            return {
                success: true,
                voteId: voteRecord.id,
                message: 'Vote recorded successfully',
                pollId: request.pollId
            };
        } catch (error) {
            (0, _logger.devLog)('Ranked vote processing error:', {
                error: error instanceof Error ? error.message : String(error)
            });
            return {
                success: false,
                error: 'Failed to process ranked vote',
                message: 'Failed to process ranked vote',
                pollId: request.pollId
            };
        }
    }
    async calculateResults(poll, votes) {
        await Promise.resolve(); // Satisfy require-await rule
        try {
            const startTime = Date.now();
            // Import IRV calculator for proper ranked choice implementation
            const { IRVCalculator } = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("../irv-calculator")));
            // Convert poll options to candidates format
            const candidates = poll.options.map((option)=>({
                    id: option.id,
                    name: option.text,
                    description: option.description || ''
                }));
            // Convert votes to user rankings format
            const userRankings = votes.filter((vote)=>vote.voteData?.rankings && vote.voteData.rankings.length > 0 && vote.userId).map((vote)=>({
                    pollId: poll.id,
                    userId: vote.userId,
                    ranking: vote.voteData?.rankings?.map((index)=>{
                        const option = poll.options[index];
                        return option?.id;
                    }).filter((id)=>Boolean(id)) ?? [],
                    createdAt: new Date(vote.timestamp)
                }));
            // Create IRV calculator and calculate results
            const calculator = new IRVCalculator(poll.id, candidates);
            const irvResults = calculator.calculateResults(userRankings);
            // Convert IRV results to our format
            const optionVotes = {};
            const optionPercentages = {};
            // Initialize all options with zero scores
            poll.options.forEach((option)=>{
                optionVotes[option.id] = 0;
                optionPercentages[option.id] = 0;
            });
            // Count votes from first round
            if (irvResults.rounds.length > 0) {
                const firstRound = irvResults.rounds[0];
                if (firstRound) {
                    Object.entries(firstRound.votes).forEach(([optionId, votes])=>{
                        optionVotes[optionId] = Number(votes);
                    });
                }
            }
            const totalVotes = irvResults.totalVotes || 0;
            // Calculate percentages
            if (totalVotes > 0) {
                Object.keys(optionVotes).forEach((optionId)=>{
                    const votes = optionVotes[optionId] || 0;
                    optionPercentages[optionId] = votes / totalVotes * 100;
                });
            }
            // Get winner from IRV results
            const winner = irvResults.winner;
            const winnerVotes = winner ? optionVotes[winner] || 0 : 0;
            const winnerPercentage = winner ? optionPercentages[winner] || 0 : 0;
            const results = {
                winner: winner || undefined,
                winnerVotes,
                winnerPercentage,
                optionVotes,
                optionPercentages,
                abstentions: 0,
                abstentionPercentage: 0
            };
            (0, _logger.devLog)('Ranked results calculated with IRV', {
                pollId: poll.id,
                totalVotes,
                winner,
                winnerVotes,
                winnerPercentage,
                rounds: irvResults.rounds.length,
                calculationTime: Date.now() - startTime
            });
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes,
                participationRate: totalVotes / 100,
                results,
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: Date.now() - startTime,
                    method: 'ranked',
                    rounds: irvResults.rounds.length,
                    eliminated: irvResults.rounds.filter((round)=>round.eliminated).map((round)=>round.eliminated)
                }
            };
        } catch (error) {
            (0, _logger.devLog)('Ranked results calculation error:', {
                error: error instanceof Error ? error.message : String(error)
            });
            // Return empty results on error
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes: 0,
                participationRate: 0,
                results: {
                    winner: undefined,
                    winnerVotes: 0,
                    winnerPercentage: 0,
                    optionVotes: {},
                    optionPercentages: {},
                    abstentions: 0,
                    abstentionPercentage: 0
                },
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: 0,
                    error: error instanceof Error ? error.message : 'Unknown error'
                }
            };
        }
    }
    getConfiguration() {
        return {
            method: 'ranked',
            description: 'Voters rank options in order of preference',
            allowsMultipleSelections: true,
            requiresRanking: true,
            maxSelections: 'configurable',
            algorithm: 'instant runoff voting'
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvdm90ZS9zdHJhdGVnaWVzL3JhbmtlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJhbmtlZCBDaG9pY2UgVm90aW5nIFN0cmF0ZWd5XG4gKiBcbiAqIEltcGxlbWVudHMgcmFua2VkIGNob2ljZSB2b3Rpbmcgd2hlcmUgdm90ZXJzIHJhbmsgb3B0aW9ucyBpbiBvcmRlciBvZiBwcmVmZXJlbmNlLlxuICogVXNlcyBpbnN0YW50IHJ1bm9mZiB2b3RpbmcgKElSVikgdG8gZGV0ZXJtaW5lIHRoZSB3aW5uZXIuXG4gKiBcbiAqIENyZWF0ZWQ6IFNlcHRlbWJlciAxNSwgMjAyNVxuICogVXBkYXRlZDogU2VwdGVtYmVyIDE1LCAyMDI1XG4gKi9cblxuaW1wb3J0IHsgZGV2TG9nIH0gZnJvbSAnQC9saWIvdXRpbHMvbG9nZ2VyJztcblxuaW1wb3J0IHR5cGUgeyBcbiAgVm90aW5nU3RyYXRlZ3ksIFxuICBWb3RlUmVxdWVzdCwgXG4gIFZvdGVSZXNwb25zZSwgXG4gIFZvdGVWYWxpZGF0aW9uLCBcbiAgUG9sbERhdGEsIFxuICBWb3RlRGF0YSwgXG4gIFJlc3VsdHNEYXRhLFxuICBWb3RpbmdNZXRob2QsXG4gIFBvbGxSZXN1bHRzXG59IGZyb20gJy4uL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIFJhbmtlZFN0cmF0ZWd5IGltcGxlbWVudHMgVm90aW5nU3RyYXRlZ3kge1xuICBcbiAgZ2V0Vm90aW5nTWV0aG9kKCk6IFZvdGluZ01ldGhvZCB7XG4gICAgcmV0dXJuICdyYW5rZWQnO1xuICB9XG5cbiAgYXN5bmMgdmFsaWRhdGVWb3RlKHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IFByb21pc2U8Vm90ZVZhbGlkYXRpb24+IHtcbiAgICBhd2FpdCBQcm9taXNlLnJlc29sdmUoKTsgLy8gU2F0aXNmeSByZXF1aXJlLWF3YWl0IHJ1bGVcbiAgICB0cnkge1xuICAgICAgY29uc3Qgdm90ZURhdGEgPSByZXF1ZXN0LnZvdGVEYXRhO1xuXG4gICAgICAvLyBWYWxpZGF0ZSByYW5raW5ncyBhcnJheSBleGlzdHNcbiAgICAgIGlmICghdm90ZURhdGEucmFua2luZ3MgfHwgIUFycmF5LmlzQXJyYXkodm90ZURhdGEucmFua2luZ3MpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnUmFua2luZ3MgbXVzdCBiZSBhbiBhcnJheScsXG4gICAgICAgICAgZXJyb3JzOiBbJ1JhbmtpbmdzIG11c3QgYmUgYW4gYXJyYXknXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcmFua2luZ3MgYXJyYXkgaXMgbm90IGVtcHR5XG4gICAgICBpZiAodm90ZURhdGEucmFua2luZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnQXQgbGVhc3Qgb25lIHJhbmtpbmcgaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIGVycm9yczogWydBdCBsZWFzdCBvbmUgcmFua2luZyBpcyByZXF1aXJlZCddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IGZhbHNlLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBhbGwgcmFua2luZ3MgYXJlIHZhbGlkIGludGVnZXJzXG4gICAgICBmb3IgKGNvbnN0IHJhbmtpbmcgb2Ygdm90ZURhdGEucmFua2luZ3MpIHtcbiAgICAgICAgaWYgKHR5cGVvZiByYW5raW5nICE9PSAnbnVtYmVyJyB8fCAhTnVtYmVyLmlzSW50ZWdlcihyYW5raW5nKSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiAnUmFua2luZ3MgbXVzdCBiZSBpbnRlZ2VycycsXG4gICAgICAgICAgICBlcnJvcnM6IFsnUmFua2luZ3MgbXVzdCBiZSBpbnRlZ2VycyddLFxuICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogZmFsc2UsXG4gICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJhbmtpbmcgPCAwIHx8IHJhbmtpbmcgPj0gcG9sbC5vcHRpb25zLmxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBvcHRpb24gc2VsZWN0ZWQnLFxuICAgICAgICAgICAgZXJyb3JzOiBbJ0ludmFsaWQgb3B0aW9uIHNlbGVjdGVkJ10sXG4gICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIGR1cGxpY2F0ZSByYW5raW5nc1xuICAgICAgY29uc3QgdW5pcXVlUmFua2luZ3MgPSBuZXcgU2V0KHZvdGVEYXRhLnJhbmtpbmdzKTtcbiAgICAgIGlmICh1bmlxdWVSYW5raW5ncy5zaXplICE9PSB2b3RlRGF0YS5yYW5raW5ncy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdEdXBsaWNhdGUgcmFua2luZ3MgYXJlIG5vdCBhbGxvd2VkJyxcbiAgICAgICAgICBlcnJvcnM6IFsnRHVwbGljYXRlIHJhbmtpbmdzIGFyZSBub3QgYWxsb3dlZCddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IGZhbHNlLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBtYXhpbXVtIHJhbmtpbmdzIGxpbWl0XG4gICAgICBjb25zdCBtYXhSYW5raW5ncyA9IHBvbGwudm90aW5nQ29uZmlnPy5tYXhDaG9pY2VzIHx8IHBvbGwub3B0aW9ucy5sZW5ndGg7XG4gICAgICBpZiAodm90ZURhdGEucmFua2luZ3MubGVuZ3RoID4gbWF4UmFua2luZ3MpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IGBNYXhpbXVtICR7bWF4UmFua2luZ3N9IHJhbmtpbmdzIGFsbG93ZWRgLFxuICAgICAgICAgIGVycm9yczogW2BNYXhpbXVtICR7bWF4UmFua2luZ3N9IHJhbmtpbmdzIGFsbG93ZWRgXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgZGV2TG9nKCdSYW5rZWQgdm90ZSB2YWxpZGF0ZWQgc3VjY2Vzc2Z1bGx5Jywge1xuICAgICAgICBwb2xsSWQ6IHJlcXVlc3QucG9sbElkLFxuICAgICAgICByYW5raW5nczogdm90ZURhdGEucmFua2luZ3MsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWRcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogZmFsc2UsXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ1JhbmtlZCB2b3RlIHZhbGlkYXRpb24gZXJyb3I6JywgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdSYW5rZWQgdm90ZSB2YWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgIGVycm9yczogWydSYW5rZWQgdm90ZSB2YWxpZGF0aW9uIGZhaWxlZCddLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3NWb3RlKHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IFByb21pc2U8Vm90ZVJlc3BvbnNlPiB7XG4gICAgYXdhaXQgUHJvbWlzZS5yZXNvbHZlKCk7IC8vIFNhdGlzZnkgcmVxdWlyZS1hd2FpdCBydWxlXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZvdGVEYXRhID0gcmVxdWVzdC52b3RlRGF0YTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHZvdGUgZGF0YSBmb3Igc3RvcmFnZVxuICAgICAgY29uc3Qgdm90ZVJlY29yZDogVm90ZURhdGEgPSB7XG4gICAgICAgIGlkOiBgdm90ZV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIHJhbmtpbmdzOiB2b3RlRGF0YS5yYW5raW5ncyxcbiAgICAgICAgcHJpdmFjeUxldmVsOiAnc3RhbmRhcmQnLFxuICAgICAgICBhdWRpdFJlY2VpcHQ6IGBhdWRpdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgaXBBZGRyZXNzOiByZXF1ZXN0LmlwQWRkcmVzcyxcbiAgICAgICAgdXNlckFnZW50OiByZXF1ZXN0LnVzZXJBZ2VudFxuICAgICAgfTtcblxuICAgICAgZGV2TG9nKCdSYW5rZWQgdm90ZSBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5Jywge1xuICAgICAgICBwb2xsSWQ6IHJlcXVlc3QucG9sbElkLFxuICAgICAgICB1c2VySWQ6IHJlcXVlc3QudXNlcklkLFxuICAgICAgICByYW5raW5nczogdm90ZURhdGEucmFua2luZ3MsXG4gICAgICAgIHZvdGVJZDogdm90ZVJlY29yZC5pZFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHZvdGVJZDogdm90ZVJlY29yZC5pZCxcbiAgICAgICAgbWVzc2FnZTogJ1ZvdGUgcmVjb3JkZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZFxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ1JhbmtlZCB2b3RlIHByb2Nlc3NpbmcgZXJyb3I6JywgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHByb2Nlc3MgcmFua2VkIHZvdGUnLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHByb2Nlc3MgcmFua2VkIHZvdGUnLFxuICAgICAgICBwb2xsSWQ6IHJlcXVlc3QucG9sbElkXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNhbGN1bGF0ZVJlc3VsdHMocG9sbDogUG9sbERhdGEsIHZvdGVzOiBWb3RlRGF0YVtdKTogUHJvbWlzZTxSZXN1bHRzRGF0YT4ge1xuICAgIGF3YWl0IFByb21pc2UucmVzb2x2ZSgpOyAvLyBTYXRpc2Z5IHJlcXVpcmUtYXdhaXQgcnVsZVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgXG4gICAgICAvLyBJbXBvcnQgSVJWIGNhbGN1bGF0b3IgZm9yIHByb3BlciByYW5rZWQgY2hvaWNlIGltcGxlbWVudGF0aW9uXG4gICAgICBjb25zdCB7IElSVkNhbGN1bGF0b3IgfSA9IGF3YWl0IGltcG9ydCgnLi4vaXJ2LWNhbGN1bGF0b3InKTtcbiAgICAgIFxuICAgICAgLy8gQ29udmVydCBwb2xsIG9wdGlvbnMgdG8gY2FuZGlkYXRlcyBmb3JtYXRcbiAgICAgIGNvbnN0IGNhbmRpZGF0ZXMgPSBwb2xsLm9wdGlvbnMubWFwKG9wdGlvbiA9PiAoe1xuICAgICAgICBpZDogb3B0aW9uLmlkLFxuICAgICAgICBuYW1lOiBvcHRpb24udGV4dCxcbiAgICAgICAgZGVzY3JpcHRpb246IG9wdGlvbi5kZXNjcmlwdGlvbiB8fCAnJ1xuICAgICAgfSkpO1xuXG4gICAgICAvLyBDb252ZXJ0IHZvdGVzIHRvIHVzZXIgcmFua2luZ3MgZm9ybWF0XG4gICAgICBjb25zdCB1c2VyUmFua2luZ3MgPSB2b3Rlc1xuICAgICAgICAuZmlsdGVyKHZvdGUgPT4gdm90ZS52b3RlRGF0YT8ucmFua2luZ3MgJiYgdm90ZS52b3RlRGF0YS5yYW5raW5ncy5sZW5ndGggPiAwICYmIHZvdGUudXNlcklkKVxuICAgICAgICAubWFwKHZvdGUgPT4gKHtcbiAgICAgICAgICBwb2xsSWQ6IHBvbGwuaWQsXG4gICAgICAgICAgdXNlcklkOiB2b3RlLnVzZXJJZCEsXG4gICAgICAgICAgcmFua2luZzogdm90ZS52b3RlRGF0YT8ucmFua2luZ3M/Lm1hcChpbmRleCA9PiB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb24gPSBwb2xsLm9wdGlvbnNbaW5kZXhdO1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbj8uaWQ7XG4gICAgICAgICAgfSkuZmlsdGVyKChpZCk6IGlkIGlzIHN0cmluZyA9PiBCb29sZWFuKGlkKSkgPz8gW10sXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSh2b3RlLnRpbWVzdGFtcClcbiAgICAgICAgfSkpO1xuXG4gICAgICAvLyBDcmVhdGUgSVJWIGNhbGN1bGF0b3IgYW5kIGNhbGN1bGF0ZSByZXN1bHRzXG4gICAgICBjb25zdCBjYWxjdWxhdG9yID0gbmV3IElSVkNhbGN1bGF0b3IocG9sbC5pZCwgY2FuZGlkYXRlcyk7XG4gICAgICBjb25zdCBpcnZSZXN1bHRzID0gY2FsY3VsYXRvci5jYWxjdWxhdGVSZXN1bHRzKHVzZXJSYW5raW5ncyk7XG5cbiAgICAgIC8vIENvbnZlcnQgSVJWIHJlc3VsdHMgdG8gb3VyIGZvcm1hdFxuICAgICAgY29uc3Qgb3B0aW9uVm90ZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICAgIGNvbnN0IG9wdGlvblBlcmNlbnRhZ2VzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG5cbiAgICAgIC8vIEluaXRpYWxpemUgYWxsIG9wdGlvbnMgd2l0aCB6ZXJvIHNjb3Jlc1xuICAgICAgcG9sbC5vcHRpb25zLmZvckVhY2gob3B0aW9uID0+IHtcbiAgICAgICAgb3B0aW9uVm90ZXNbb3B0aW9uLmlkXSA9IDA7XG4gICAgICAgIG9wdGlvblBlcmNlbnRhZ2VzW29wdGlvbi5pZF0gPSAwO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIENvdW50IHZvdGVzIGZyb20gZmlyc3Qgcm91bmRcbiAgICAgIGlmIChpcnZSZXN1bHRzLnJvdW5kcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0Um91bmQgPSBpcnZSZXN1bHRzLnJvdW5kc1swXTtcbiAgICAgICAgaWYgKGZpcnN0Um91bmQpIHtcbiAgICAgICAgICBPYmplY3QuZW50cmllcyhmaXJzdFJvdW5kLnZvdGVzKS5mb3JFYWNoKChbb3B0aW9uSWQsIHZvdGVzXSkgPT4ge1xuICAgICAgICAgICAgb3B0aW9uVm90ZXNbb3B0aW9uSWRdID0gTnVtYmVyKHZvdGVzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCB0b3RhbFZvdGVzID0gaXJ2UmVzdWx0cy50b3RhbFZvdGVzIHx8IDA7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBwZXJjZW50YWdlc1xuICAgICAgaWYgKHRvdGFsVm90ZXMgPiAwKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG9wdGlvblZvdGVzKS5mb3JFYWNoKG9wdGlvbklkID0+IHtcbiAgICAgICAgICBjb25zdCB2b3RlcyA9IG9wdGlvblZvdGVzW29wdGlvbklkXSB8fCAwO1xuICAgICAgICAgIG9wdGlvblBlcmNlbnRhZ2VzW29wdGlvbklkXSA9ICh2b3RlcyAvIHRvdGFsVm90ZXMpICogMTAwO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHdpbm5lciBmcm9tIElSViByZXN1bHRzXG4gICAgICBjb25zdCB3aW5uZXIgPSBpcnZSZXN1bHRzLndpbm5lcjtcbiAgICAgIGNvbnN0IHdpbm5lclZvdGVzID0gd2lubmVyID8gb3B0aW9uVm90ZXNbd2lubmVyXSB8fCAwIDogMDtcbiAgICAgIGNvbnN0IHdpbm5lclBlcmNlbnRhZ2UgPSB3aW5uZXIgPyBvcHRpb25QZXJjZW50YWdlc1t3aW5uZXJdIHx8IDAgOiAwO1xuXG4gICAgICBjb25zdCByZXN1bHRzOiBQb2xsUmVzdWx0cyA9IHtcbiAgICAgICAgd2lubmVyOiB3aW5uZXIgfHwgdW5kZWZpbmVkLFxuICAgICAgICB3aW5uZXJWb3RlcyxcbiAgICAgICAgd2lubmVyUGVyY2VudGFnZSxcbiAgICAgICAgb3B0aW9uVm90ZXMsXG4gICAgICAgIG9wdGlvblBlcmNlbnRhZ2VzLFxuICAgICAgICBhYnN0ZW50aW9uczogMCxcbiAgICAgICAgYWJzdGVudGlvblBlcmNlbnRhZ2U6IDBcbiAgICAgIH07XG5cbiAgICAgIGRldkxvZygnUmFua2VkIHJlc3VsdHMgY2FsY3VsYXRlZCB3aXRoIElSVicsIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICB0b3RhbFZvdGVzLFxuICAgICAgICB3aW5uZXIsXG4gICAgICAgIHdpbm5lclZvdGVzLFxuICAgICAgICB3aW5uZXJQZXJjZW50YWdlLFxuICAgICAgICByb3VuZHM6IGlydlJlc3VsdHMucm91bmRzLmxlbmd0aCxcbiAgICAgICAgY2FsY3VsYXRpb25UaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICB2b3RpbmdNZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICB0b3RhbFZvdGVzLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uUmF0ZTogdG90YWxWb3RlcyAvIDEwMCwgLy8gTW9jayBwYXJ0aWNpcGF0aW9uIHJhdGVcbiAgICAgICAgcmVzdWx0cyxcbiAgICAgICAgY2FsY3VsYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgY2FsY3VsYXRpb25UaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgIG1ldGhvZDogJ3JhbmtlZCcsXG4gICAgICAgICAgcm91bmRzOiBpcnZSZXN1bHRzLnJvdW5kcy5sZW5ndGgsXG4gICAgICAgICAgZWxpbWluYXRlZDogaXJ2UmVzdWx0cy5yb3VuZHNcbiAgICAgICAgICAgIC5maWx0ZXIoKHJvdW5kOiBhbnkpID0+IHJvdW5kLmVsaW1pbmF0ZWQpXG4gICAgICAgICAgICAubWFwKChyb3VuZDogYW55KSA9PiByb3VuZC5lbGltaW5hdGVkKVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRldkxvZygnUmFua2VkIHJlc3VsdHMgY2FsY3VsYXRpb24gZXJyb3I6JywgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgXG4gICAgICAvLyBSZXR1cm4gZW1wdHkgcmVzdWx0cyBvbiBlcnJvclxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICB2b3RpbmdNZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICB0b3RhbFZvdGVzOiAwLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uUmF0ZTogMCxcbiAgICAgICAgcmVzdWx0czoge1xuICAgICAgICAgIHdpbm5lcjogdW5kZWZpbmVkLFxuICAgICAgICAgIHdpbm5lclZvdGVzOiAwLFxuICAgICAgICAgIHdpbm5lclBlcmNlbnRhZ2U6IDAsXG4gICAgICAgICAgb3B0aW9uVm90ZXM6IHt9LFxuICAgICAgICAgIG9wdGlvblBlcmNlbnRhZ2VzOiB7fSxcbiAgICAgICAgICBhYnN0ZW50aW9uczogMCxcbiAgICAgICAgICBhYnN0ZW50aW9uUGVyY2VudGFnZTogMFxuICAgICAgICB9LFxuICAgICAgICBjYWxjdWxhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBjYWxjdWxhdGlvblRpbWU6IDAsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgZ2V0Q29uZmlndXJhdGlvbigpOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1ldGhvZDogJ3JhbmtlZCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ1ZvdGVycyByYW5rIG9wdGlvbnMgaW4gb3JkZXIgb2YgcHJlZmVyZW5jZScsXG4gICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IHRydWUsXG4gICAgICByZXF1aXJlc1Jhbmtpbmc6IHRydWUsXG4gICAgICBtYXhTZWxlY3Rpb25zOiAnY29uZmlndXJhYmxlJyxcbiAgICAgIGFsZ29yaXRobTogJ2luc3RhbnQgcnVub2ZmIHZvdGluZydcbiAgICB9O1xuICB9XG59Il0sIm5hbWVzIjpbIlJhbmtlZFN0cmF0ZWd5IiwiZ2V0Vm90aW5nTWV0aG9kIiwidmFsaWRhdGVWb3RlIiwicmVxdWVzdCIsInBvbGwiLCJQcm9taXNlIiwicmVzb2x2ZSIsInZvdGVEYXRhIiwicmFua2luZ3MiLCJBcnJheSIsImlzQXJyYXkiLCJ2YWxpZCIsImlzVmFsaWQiLCJlcnJvciIsImVycm9ycyIsInJlcXVpcmVzQXV0aGVudGljYXRpb24iLCJyZXF1aXJlc1Rva2VucyIsImxlbmd0aCIsInJhbmtpbmciLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJvcHRpb25zIiwidW5pcXVlUmFua2luZ3MiLCJTZXQiLCJzaXplIiwibWF4UmFua2luZ3MiLCJ2b3RpbmdDb25maWciLCJtYXhDaG9pY2VzIiwiZGV2TG9nIiwicG9sbElkIiwidXNlcklkIiwiRXJyb3IiLCJtZXNzYWdlIiwiU3RyaW5nIiwicHJvY2Vzc1ZvdGUiLCJ2b3RlUmVjb3JkIiwiaWQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwicHJpdmFjeUxldmVsIiwiYXVkaXRSZWNlaXB0IiwidGltZXN0YW1wIiwiaXBBZGRyZXNzIiwidXNlckFnZW50Iiwidm90ZUlkIiwic3VjY2VzcyIsImNhbGN1bGF0ZVJlc3VsdHMiLCJ2b3RlcyIsInN0YXJ0VGltZSIsIklSVkNhbGN1bGF0b3IiLCJjYW5kaWRhdGVzIiwibWFwIiwib3B0aW9uIiwibmFtZSIsInRleHQiLCJkZXNjcmlwdGlvbiIsInVzZXJSYW5raW5ncyIsImZpbHRlciIsInZvdGUiLCJpbmRleCIsIkJvb2xlYW4iLCJjcmVhdGVkQXQiLCJjYWxjdWxhdG9yIiwiaXJ2UmVzdWx0cyIsIm9wdGlvblZvdGVzIiwib3B0aW9uUGVyY2VudGFnZXMiLCJmb3JFYWNoIiwicm91bmRzIiwiZmlyc3RSb3VuZCIsIk9iamVjdCIsImVudHJpZXMiLCJvcHRpb25JZCIsInRvdGFsVm90ZXMiLCJrZXlzIiwid2lubmVyIiwid2lubmVyVm90ZXMiLCJ3aW5uZXJQZXJjZW50YWdlIiwicmVzdWx0cyIsInVuZGVmaW5lZCIsImFic3RlbnRpb25zIiwiYWJzdGVudGlvblBlcmNlbnRhZ2UiLCJjYWxjdWxhdGlvblRpbWUiLCJ2b3RpbmdNZXRob2QiLCJwYXJ0aWNpcGF0aW9uUmF0ZSIsImNhbGN1bGF0ZWRBdCIsInRvSVNPU3RyaW5nIiwibWV0YWRhdGEiLCJtZXRob2QiLCJlbGltaW5hdGVkIiwicm91bmQiLCJnZXRDb25maWd1cmF0aW9uIiwiYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zIiwicmVxdWlyZXNSYW5raW5nIiwibWF4U2VsZWN0aW9ucyIsImFsZ29yaXRobSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0NBUUM7Ozs7K0JBZ0JZQTs7O2VBQUFBOzs7d0JBZFU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWNoQixNQUFNQTtJQUVYQyxrQkFBZ0M7UUFDOUIsT0FBTztJQUNUO0lBRUEsTUFBTUMsYUFBYUMsT0FBb0IsRUFBRUMsSUFBYyxFQUEyQjtRQUNoRixNQUFNQyxRQUFRQyxPQUFPLElBQUksNkJBQTZCO1FBQ3RELElBQUk7WUFDRixNQUFNQyxXQUFXSixRQUFRSSxRQUFRO1lBRWpDLGlDQUFpQztZQUNqQyxJQUFJLENBQUNB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
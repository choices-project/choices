{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/database-schema-check.test.ts"],"sourcesContent":["import { describe, it, expect, beforeAll } from '@jest/globals';\n\n/**\n * Database Schema Check Integration Test\n * \n * Checks what tables and schema exist in the database\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Database Schema Check', () => {\n  let supabase: any;\n\n  beforeAll(async () => {\n    const { createClient } = await import('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    supabase = createClient(supabaseUrl, supabaseKey);\n  });\n\n  it('should list all tables in the database', async () => {\n    console.log('üîç Checking database schema...');\n    \n    const { data: tables, error } = await supabase\n      .from('information_schema.tables')\n      .select('table_name, table_schema')\n      .eq('table_schema', 'public');\n\n    console.log('Tables query result:', { tables, error });\n    \n    if (error) {\n      console.log('‚ùå Error querying tables:', error);\n      throw error;\n    }\n\n    expect(tables).toBeDefined();\n    console.log('üìã Available tables:', tables?.map(t => t.table_name));\n  });\n\n  it('should check polls table structure', async () => {\n    console.log('üîç Checking polls table structure...');\n    \n    const { data: columns, error } = await supabase\n      .from('information_schema.columns')\n      .select('column_name, data_type, is_nullable, column_default')\n      .eq('table_name', 'polls')\n      .eq('table_schema', 'public');\n\n    console.log('Polls columns query result:', { columns, error });\n    \n    if (error) {\n      console.log('‚ùå Error querying polls columns:', error);\n      throw error;\n    }\n\n    expect(columns).toBeDefined();\n    console.log('üìã Polls table columns:', columns?.map(c => ({\n      name: c.column_name,\n      type: c.data_type,\n      nullable: c.is_nullable,\n      default: c.column_default\n    })));\n  });\n\n  it('should check if polls table has any data', async () => {\n    console.log('üîç Checking polls table data...');\n    \n    const { data: polls, error, count } = await supabase\n      .from('polls')\n      .select('*', { count: 'exact' })\n      .limit(5);\n\n    console.log('Polls data query result:', { polls, error, count });\n    \n    if (error) {\n      console.log('‚ùå Error querying polls data:', error);\n      throw error;\n    }\n\n    console.log(`üìä Polls table has ${count} records`);\n    if (polls && polls.length > 0) {\n      console.log('üìã Sample poll data:', polls[0]);\n    }\n  });\n\n  it('should check database permissions', async () => {\n    console.log('üîç Checking database permissions...');\n    \n    // Try to insert a simple test record\n    const testData = {\n      title: 'Test Poll',\n      description: 'Test Description',\n      options: ['Option 1', 'Option 2'],\n      poll_type: 'single_choice',\n      status: 'draft',\n      created_by: 'test-user'\n    };\n\n    const { data: insertResult, error: insertError } = await supabase\n      .from('polls')\n      .insert(testData)\n      .select();\n\n    console.log('Insert test result:', { insertResult, insertError });\n    \n    if (insertError) {\n      console.log('‚ùå Insert permission error:', insertError);\n      console.log('Error details:', {\n        message: insertError.message,\n        details: insertError.details,\n        hint: insertError.hint,\n        code: insertError.code\n      });\n    } else {\n      console.log('‚úÖ Insert permission test passed');\n      \n      // Clean up the test record\n      if (insertResult && insertResult.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('polls')\n          .delete()\n          .eq('id', insertResult[0].id);\n        \n        if (deleteError) {\n          console.log('‚ö†Ô∏è Could not clean up test record:', deleteError);\n        } else {\n          console.log('üßπ Test record cleaned up');\n        }\n      }\n    }\n  });\n});"],"names":["describe","supabase","beforeAll","createClient","supabaseUrl","process","env","SUPABASE_URL","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","SUPABASE_ANON_KEY","NEXT_PUBLIC_SUPABASE_ANON_KEY","Error","it","console","log","data","tables","error","from","select","eq","expect","toBeDefined","map","t","table_name","columns","c","name","column_name","type","data_type","nullable","is_nullable","default","column_default","polls","count","limit","length","testData","title","description","options","poll_type","status","created_by","insertResult","insertError","insert","message","details","hint","code","deleteError","delete","id"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/debug-poll-insert.test.ts"],"sourcesContent":["import { describe, it, expect } from '@jest/globals';\n\n/**\n * Debug Poll Insert Test\n * \n * Tests to debug why polls aren't being inserted/retrieved\n * \n * Created: January 27, 2025\n * Status: ‚úÖ PRODUCTION READY\n */\n\ndescribe('Debug Poll Insert', () => {\n  it('should debug poll insertion step by step', async () => {\n    const { createClient } = await import('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SECRET_KEY;\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Supabase credentials not found');\n    }\n    \n    const supabase = createClient(supabaseUrl, supabaseKey);\n    \n    console.log('üîç Step 1: Check if polls table exists...');\n    \n    // Try to query the polls table directly\n    const { data: pollsData, error: pollsError } = await supabase\n      .from('polls')\n      .select('*')\n      .limit(1);\n    \n    console.log('Polls table query result:', { pollsData, pollsError });\n    \n    if (pollsError) {\n      console.log('‚ùå Polls table error:', pollsError.message);\n      if (pollsError.message.includes('relation \"polls\" does not exist')) {\n        console.log('‚ùå Polls table does not exist!');\n        return;\n      }\n    } else {\n      console.log('‚úÖ Polls table exists and is accessible');\n    }\n    \n    console.log('üîç Step 2: Check polls table structure...');\n    \n    // Get table structure\n    const { data: columns, error: columnsError } = await supabase\n      .from('information_schema.columns')\n      .select('column_name, data_type, is_nullable')\n      .eq('table_name', 'polls')\n      .eq('table_schema', 'public');\n    \n    console.log('Polls table columns:', { columns, columnsError });\n    \n    console.log('üîç Step 3: Try to insert a minimal poll...');\n    \n    const minimalPoll = {\n      title: 'Debug Test Poll',\n      description: 'Debug Test Description',\n      options: ['Option 1', 'Option 2'],\n      voting_method: 'single_choice',\n      status: 'active',\n      created_by: 'debug-user',\n      privacy_level: 'public'\n    };\n    \n    console.log('Minimal poll data:', minimalPoll);\n    \n    const { data: insertResult, error: insertError } = await supabase\n      .from('polls')\n      .insert(minimalPoll)\n      .select();\n    \n    console.log('Insert result:', { insertResult, insertError });\n    \n    if (insertError) {\n      console.log('‚ùå Insert error details:', {\n        message: insertError.message,\n        details: insertError.details,\n        hint: insertError.hint,\n        code: insertError.code\n      });\n    }\n    \n    console.log('üîç Step 4: Query all polls to see what exists...');\n    \n    const { data: allPolls, error: queryError } = await supabase\n      .from('polls')\n      .select('*');\n    \n    console.log('All polls query result:', { allPolls, queryError });\n    \n    console.log('üîç Step 5: Query specific poll by title...');\n    \n    const { data: specificPoll, error: specificError } = await supabase\n      .from('polls')\n      .select('*')\n      .eq('title', 'Debug Test Poll');\n    \n    console.log('Specific poll query result:', { specificPoll, specificError });\n    \n    // The test should pass if we can at least connect and query\n    expect(insertError).toBeNull();\n    expect(queryError).toBeNull();\n    expect(specificError).toBeNull();\n  });\n});\n"],"names":["describe","it","createClient","supabaseUrl","process","env","SUPABASE_URL","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","SUPABASE_SERVICE_ROLE_KEY","SUPABASE_SECRET_KEY","Error","supabase","console","log","data","pollsData","error","pollsError","from","select","limit","message","includes","columns","columnsError","eq","minimalPoll","title","description","options","voting_method","status","created_by","privacy_level","insertResult","insertError","insert","details","hint","code","allPolls","queryError","specificPoll","specificError","expect","toBeNull"],"mappings":";;;;yBAAqC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAErC;;;;;;;CAOC,GAEDA,IAAAA,iBAAQ,EAAC,qBAAqB;IAC5BC,IAAAA,WAAE,EAAC,4CAA4C;QAC7C,MAAM,EAAEC,YAAY,EAAE,GAAG,MAAM,mEAAA,QAAO;QACtC,MAAMC,cAAcC,QAAQC,GAAG,CAACC,YAAY,IAAIF,QAAQC,GAAG,CAACE,wBAAwB;QACpF,MAAMC,cAAcJ,QAAQC,GAAG,CAACI,yBAAyB,IAAIL,QAAQC,GAAG,CAACK,mBAAmB;QAE5F,IAAI,CAACP,eAAe,CAACK,aAAa;YAChC,MAAM,IAAIG,MAAM;QAClB;QAEA,MAAMC,WAAWV,aAAaC,aAAaK;QAE3CK,QAAQC,GAAG,CAAC;QAEZ,wCAAwC;QACxC,MAAM,EAAEC,MAAMC,SAAS,EAAEC,OAAOC,UAAU,EAAE,GAAG,MAAMN,SAClDO,IAAI,CAAC,SACLC,MAAM,CAAC,KACPC,KAAK,CAAC;QAETR,QAAQC,GAAG,CAAC,6BAA6B;YAAEE;YAAWE;QAAW;QAEjE,IAAIA,YAAY;YACdL,QAAQC,GAAG,CAAC,wBAAwBI,WAAWI,OAAO;YACtD,IAAIJ,WAAWI,OAAO,CAACC,QAAQ,CAAC,oCAAoC;gBAClEV,QAAQC,GAAG,CAAC;gBACZ;YACF;QACF,OAAO;YACLD,QAAQC,GAAG,CAAC;QACd;QAEAD,QAAQC,GAAG,CAAC;QAEZ,sBAAsB;QACtB,MAAM,EAAEC,MAAMS,OAAO,EAAEP,OAAOQ,YAAY,EAAE,GAAG,MAAMb,SAClDO,IAAI,CAAC,8BACLC,MAAM,CAAC,uCACPM,EAAE,CAAC,cAAc,SACjBA,EAAE,CAAC,gBAAgB;QAEtBb,QAAQC,GAAG,CAAC,wBAAwB;YAAEU;YAASC;QAAa;QAE5DZ,QAAQC,GAAG,CAAC;QAEZ,MAAMa,cAAc;YAClBC,OAAO;YACPC,aAAa;YACbC,SAAS;gBAAC;gBAAY;aAAW;YACjCC,eAAe;YACfC,QAAQ;YACRC,YAAY;YACZC,eAAe;QACjB;QAEArB,QAAQC,GAAG,CAAC,sBAAsBa;QAElC,MAAM,EAAEZ,MAAMoB,YAAY,EAAElB,OAAOmB,WAAW,EAAE,GAAG,MAAMxB,SACtDO,IAAI,CAAC,SACLkB,MAAM,CAACV,aACPP,MAAM;QAETP,QAAQC,GAAG,CAAC,kBAAkB;YAAEqB;YAAcC;QAAY;QAE1D,IAAIA,aAAa;YACfvB,QAAQC,GAAG,CAAC,2BAA2B;gBACrCQ,SAASc,YAAYd,OAAO;gBAC5BgB,SAASF,YAAYE,OAAO;gBAC5BC,MAAMH,YAAYG,IAAI;gBACtBC,MAAMJ,YAAYI,IAAI;YACxB;QACF;QAEA3B,QAAQC,GAAG,CAAC;QAEZ,MAAM,EAAEC,MAAM0B,QAAQ,EAAExB,OAAOyB,UAAU,EAAE,GAAG,MAAM9B,SACjDO,IAAI,CAAC,SACLC,MAAM,CAAC;QAEVP,QAAQC,GAAG,CAAC,2BAA2B;YAAE2B;YAAUC;QAAW;QAE9D7B,QAAQC,GAAG,CAAC;QAEZ,MAAM,EAAEC,MAAM4B,YAAY,EAAE1B,OAAO2B,aAAa,EAAE,GAAG,MAAMhC,SACxDO,IAAI,CAAC,SACLC,MAAM,CAAC,KACPM,EAAE,CAAC,SAAS;QAEfb,QAAQC,GAAG,CAAC,+BAA+B;YAAE6B;YAAcC;QAAc;QAEzE,4DAA4D;QAC5DC,IAAAA,eAAM,EAACT,aAAaU,QAAQ;QAC5BD,IAAAA,eAAM,EAACH,YAAYI,QAAQ;QAC3BD,IAAAA,eAAM,EAACD,eAAeE,QAAQ;IAChC;AACF"}
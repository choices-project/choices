{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/debug-api-route.test.ts"],"sourcesContent":["/**\n * Debug API Route Test\n * \n * This test helps debug what's causing the 500 error in the API route\n */\n\nimport { describe, it, expect } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET } from '@/app/api/polls/route';\nimport { createClient } from '@supabase/supabase-js';\n\n// Set real Supabase credentials for integration testing\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://muqwrehywjrbaeerjgfb.supabase.co';\nprocess.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\nprocess.env.SUPABASE_SECRET_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\n\n// Mock getSupabaseServerClient to use real Supabase client\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(() => {\n    console.log('üîß Mock getSupabaseServerClient called');\n    console.log('üîß URL:', process.env.NEXT_PUBLIC_SUPABASE_URL);\n    console.log('üîß KEY:', process.env.SUPABASE_SECRET_KEY ? 'SET' : 'NOT SET');\n    \n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SECRET_KEY!\n    );\n    \n    console.log('üîß Supabase client created:', !!supabase);\n    return Promise.resolve(supabase);\n  })\n}));\n\ndescribe('Debug API Route', () => {\n  it('should debug the API route step by step', async () => {\n    console.log('=== DEBUGGING API ROUTE ===');\n    \n    try {\n      console.log('1. Creating NextRequest...');\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      console.log('‚úÖ NextRequest created successfully');\n      \n      console.log('2. Calling GET function...');\n      const response = await GET(request);\n      console.log('‚úÖ GET function completed');\n      \n      console.log('3. Getting response status...');\n      console.log('Response status:', response.status);\n      \n      console.log('4. Getting response data...');\n      const responseData = await response.json();\n      console.log('Response data:', JSON.stringify(responseData, null, 2));\n      \n      console.log('5. Checking response structure...');\n      console.log('Has success property:', responseData.hasOwnProperty('success'));\n      console.log('Has error property:', responseData.hasOwnProperty('error'));\n      \n      // For now, just check that we get some response\n      expect(response).toBeDefined();\n      expect(responseData).toBeDefined();\n      \n    } catch (error) {\n      console.error('‚ùå Error in API route:', error);\n      console.error('Error stack:', error.stack);\n      throw error;\n    }\n  });\n});\n"],"names":["jest","mock","getSupabaseServerClient","fn","console","log","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SECRET_KEY","supabase","createClient","Promise","resolve","NEXT_PUBLIC_SUPABASE_ANON_KEY","describe","it","request","NextRequest","response","GET","status","responseData","json","JSON","stringify","hasOwnProperty","expect","toBeDefined","error","stack"],"mappings":"AAAA;;;;CAIC;AAYD,2DAA2D;AAC3DA,KAAKC,IAAI,CAAC,2BAA2B,IAAO,CAAA;QAC1CC,yBAAyBF,KAAKG,EAAE,CAAC;YAC/BC,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,qBAAWC,QAAQC,GAAG,CAACC,wBAAwB;YAC3DJ,QAAQC,GAAG,CAAC,qBAAWC,QAAQC,GAAG,CAACE,mBAAmB,GAAG,QAAQ;YAEjE,MAAMC,WAAWC,IAAAA,wBAAY,EAC3BL,QAAQC,GAAG,CAACC,wBAAwB,EACpCF,QAAQC,GAAG,CAACE,mBAAmB;YAGjCL,QAAQC,GAAG,CAAC,yCAA+B,CAAC,CAACK;YAC7C,OAAOE,QAAQC,OAAO,CAACH;QACzB;IACF,CAAA;;;;yBAzBqC;wBACT;uBACR;4BACS;AAE7B,wDAAwD;AACxDJ,QAAQC,GAAG,CAACC,wBAAwB,GAAG;AACvCF,QAAQC,GAAG,CAACO,6BAA6B,GAAG;AAC5CR,QAAQC,GAAG,CAACE,mBAAmB,GAAG;AAmBlCM,IAAAA,iBAAQ,EAAC,mBAAmB;IAC1BC,IAAAA,WAAE,EAAC,2CAA2C;QAC5CZ,QAAQC,GAAG,CAAC;QAEZ,IAAI;YACFD,QAAQC,GAAG,CAAC;YACZ,MAAMY,UAAU,IAAIC,mBAAW,CAAC;YAChCd,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZ,MAAMc,WAAW,MAAMC,IAAAA,UAAG,EAACH;YAC3Bb,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,oBAAoBc,SAASE,MAAM;YAE/CjB,QAAQC,GAAG,CAAC;YACZ,MAAMiB,eAAe,MAAMH,SAASI,IAAI;YACxCnB,QAAQC,GAAG,CAAC,kBAAkBmB,KAAKC,SAAS,CAACH,cAAc,MAAM;YAEjElB,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,yBAAyBiB,aAAaI,cAAc,CAAC;YACjEtB,QAAQC,GAAG,CAAC,uBAAuBiB,aAAaI,cAAc,CAAC;YAE/D,gDAAgD;YAChDC,IAAAA,eAAM,EAACR,UAAUS,WAAW;YAC5BD,IAAAA,eAAM,EAACL,cAAcM,WAAW;QAElC,EAAE,OAAOC,OAAO;YACdzB,QAAQyB,KAAK,CAAC,yBAAyBA;YACvCzB,QAAQyB,KAAK,CAAC,gBAAgBA,MAAMC,KAAK;YACzC,MAAMD;QACR;IACF;AACF"}
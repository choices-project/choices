01f54d8f46830bdd7405ad5a583559f4
/**
 * Single Choice Voting Strategy
 * 
 * Implements single choice voting where voters select exactly one option.
 * Results show vote counts for each option, with the highest voted option winning.
 * 
 * Created: September 15, 2025
 * Updated: September 15, 2025
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "SingleChoiceStrategy", {
    enumerable: true,
    get: function() {
        return SingleChoiceStrategy;
    }
});
const _logger = require("../../utils/logger");
class SingleChoiceStrategy {
    getVotingMethod() {
        return "single";
    }
    async validateVote(request, poll) {
        try {
            const voteData = request.voteData;
            // Validate choice exists and is a number
            if (typeof voteData.choice !== "number") {
                return {
                    valid: false,
                    isValid: false,
                    error: "Choice is required for single-choice voting",
                    errors: [
                        "Choice is required for single-choice voting"
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            // Validate choice is a valid integer
            if (!Number.isInteger(voteData.choice)) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Choice must be an integer",
                    errors: [
                        "Choice must be an integer"
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            // Validate choice is within valid range
            if (voteData.choice < 0 || voteData.choice >= poll.options.length) {
                return {
                    valid: false,
                    isValid: false,
                    error: `Choice must be between 0 and ${poll.options.length - 1}`,
                    errors: [
                        "Invalid option selected"
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            (0, _logger.devLog)("Single choice vote validated successfully", {
                pollId: request.pollId,
                choice: voteData.choice,
                userId: request.userId
            });
            return {
                valid: true,
                isValid: true,
                requiresAuthentication: false,
                requiresTokens: false
            };
        } catch (error) {
            (0, _logger.devLog)("Single choice vote validation error:", error);
            return {
                valid: false,
                isValid: false,
                error: "Single choice vote validation failed",
                errors: [
                    "Single choice vote validation failed"
                ],
                requiresAuthentication: false,
                requiresTokens: false
            };
        }
    }
    async processVote(request, poll) {
        try {
            const voteData = request.voteData;
            // Create vote data for storage
            const voteRecord = {
                id: `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                pollId: request.pollId,
                userId: request.userId,
                voteData: {
                    choice: voteData.choice
                },
                timestamp: new Date().toISOString(),
                ipAddress: request.ipAddress,
                userAgent: request.userAgent
            };
            (0, _logger.devLog)("Single choice vote processed successfully", {
                pollId: request.pollId,
                userId: request.userId,
                choice: voteData.choice,
                voteId: voteRecord.id
            });
            return {
                success: true,
                voteId: voteRecord.id,
                message: "Vote recorded successfully",
                pollId: request.pollId
            };
        } catch (error) {
            (0, _logger.devLog)("Single choice vote processing error:", error);
            return {
                success: false,
                error: "Failed to process single choice vote",
                message: "Failed to process single choice vote",
                pollId: request.pollId
            };
        }
    }
    async calculateResults(poll, votes) {
        try {
            const startTime = Date.now();
            // Initialize tracking objects
            const optionVotes = {};
            const optionPercentages = {};
            // Initialize all options with zero scores
            poll.options.forEach((option)=>{
                optionVotes[option.id] = 0;
                optionPercentages[option.id] = 0;
            });
            // Process each vote and count only valid votes
            let validVoteCount = 0;
            votes.forEach((vote)=>{
                // Handle both voteData.choice and direct choice property
                const choice = vote.voteData?.choice ?? vote.choice;
                if (typeof choice === "number") {
                    const optionId = poll.options[choice]?.id;
                    if (optionId) {
                        optionVotes[optionId]++;
                        validVoteCount++;
                    }
                }
            });
            const totalVotes = validVoteCount;
            // Calculate percentages
            if (totalVotes > 0) {
                Object.keys(optionVotes).forEach((optionId)=>{
                    const votes = optionVotes[optionId];
                    optionPercentages[optionId] = votes / totalVotes * 100;
                });
            }
            // Find winner (highest vote count)
            let winner;
            let winnerVotes = 0;
            let winnerPercentage = 0;
            if (totalVotes > 0) {
                Object.entries(optionVotes).forEach(([optionId, votes])=>{
                    if (votes > winnerVotes) {
                        winner = optionId;
                        winnerVotes = votes;
                        winnerPercentage = optionPercentages[optionId] || 0;
                    }
                });
            }
            const results = {
                winner: totalVotes > 0 ? winner : null,
                winnerVotes,
                winnerPercentage,
                optionVotes,
                optionPercentages,
                abstentions: 0,
                abstentionPercentage: 0
            };
            (0, _logger.devLog)("Single choice results calculated", {
                pollId: poll.id,
                totalVotes,
                winner,
                winnerVotes,
                winnerPercentage,
                calculationTime: Date.now() - startTime
            });
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes,
                participationRate: totalVotes / 100,
                results,
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: Date.now() - startTime,
                    method: "single"
                }
            };
        } catch (error) {
            (0, _logger.devLog)("Single choice results calculation error:", error);
            // Return empty results on error
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes: 0,
                participationRate: 0,
                results: {
                    winner: undefined,
                    winnerVotes: 0,
                    winnerPercentage: 0,
                    optionVotes: {},
                    optionPercentages: {},
                    abstentions: 0,
                    abstentionPercentage: 0
                },
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: 0,
                    error: error instanceof Error ? error.message : "Unknown error"
                }
            };
        }
    }
    getConfiguration() {
        return {
            method: "single",
            description: "Voters select exactly one option",
            allowsMultipleSelections: false,
            requiresRanking: false,
            maxSelections: 1,
            algorithm: "plurality"
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvdm90ZS9zdHJhdGVnaWVzL3NpbmdsZS1jaG9pY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTaW5nbGUgQ2hvaWNlIFZvdGluZyBTdHJhdGVneVxuICogXG4gKiBJbXBsZW1lbnRzIHNpbmdsZSBjaG9pY2Ugdm90aW5nIHdoZXJlIHZvdGVycyBzZWxlY3QgZXhhY3RseSBvbmUgb3B0aW9uLlxuICogUmVzdWx0cyBzaG93IHZvdGUgY291bnRzIGZvciBlYWNoIG9wdGlvbiwgd2l0aCB0aGUgaGlnaGVzdCB2b3RlZCBvcHRpb24gd2lubmluZy5cbiAqIFxuICogQ3JlYXRlZDogU2VwdGVtYmVyIDE1LCAyMDI1XG4gKiBVcGRhdGVkOiBTZXB0ZW1iZXIgMTUsIDIwMjVcbiAqL1xuXG5pbXBvcnQgeyBkZXZMb2cgfSBmcm9tICdAL2xpYi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgd2l0aE9wdGlvbmFsIH0gZnJvbSAnQC9saWIvdXRpbHMvb2JqZWN0cyc7XG5cbmltcG9ydCB0eXBlIHsgXG4gIFZvdGluZ1N0cmF0ZWd5LCBcbiAgVm90ZVJlcXVlc3QsIFxuICBWb3RlUmVzcG9uc2UsIFxuICBWb3RlVmFsaWRhdGlvbiwgXG4gIFBvbGxEYXRhLCBcbiAgVm90ZURhdGEsIFxuICBSZXN1bHRzRGF0YSxcbiAgVm90aW5nTWV0aG9kLFxuICBQb2xsUmVzdWx0c1xufSBmcm9tICcuLi90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBTaW5nbGVDaG9pY2VTdHJhdGVneSBpbXBsZW1lbnRzIFZvdGluZ1N0cmF0ZWd5IHtcbiAgXG4gIGdldFZvdGluZ01ldGhvZCgpOiBWb3RpbmdNZXRob2Qge1xuICAgIHJldHVybiAnc2luZ2xlJztcbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlVm90ZShyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBQcm9taXNlPFZvdGVWYWxpZGF0aW9uPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZvdGVEYXRhID0gcmVxdWVzdC52b3RlRGF0YTtcblxuICAgICAgLy8gVmFsaWRhdGUgY2hvaWNlIGV4aXN0cyBhbmQgaXMgYSBudW1iZXJcbiAgICAgIGlmICh0eXBlb2Ygdm90ZURhdGEuY2hvaWNlICE9PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0Nob2ljZSBpcyByZXF1aXJlZCBmb3Igc2luZ2xlLWNob2ljZSB2b3RpbmcnLFxuICAgICAgICAgIGVycm9yczogWydDaG9pY2UgaXMgcmVxdWlyZWQgZm9yIHNpbmdsZS1jaG9pY2Ugdm90aW5nJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogZmFsc2UsXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIGNob2ljZSBpcyBhIHZhbGlkIGludGVnZXJcbiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih2b3RlRGF0YS5jaG9pY2UpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnQ2hvaWNlIG11c3QgYmUgYW4gaW50ZWdlcicsXG4gICAgICAgICAgZXJyb3JzOiBbJ0Nob2ljZSBtdXN0IGJlIGFuIGludGVnZXInXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgY2hvaWNlIGlzIHdpdGhpbiB2YWxpZCByYW5nZVxuICAgICAgaWYgKHZvdGVEYXRhLmNob2ljZSA8IDAgfHwgdm90ZURhdGEuY2hvaWNlID49IHBvbGwub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IGBDaG9pY2UgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kICR7cG9sbC5vcHRpb25zLmxlbmd0aCAtIDF9YCxcbiAgICAgICAgICBlcnJvcnM6IFsnSW52YWxpZCBvcHRpb24gc2VsZWN0ZWQnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgZGV2TG9nKCdTaW5nbGUgY2hvaWNlIHZvdGUgdmFsaWRhdGVkIHN1Y2Nlc3NmdWxseScsIHtcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgY2hvaWNlOiB2b3RlRGF0YS5jaG9pY2UsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWRcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogZmFsc2UsXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ1NpbmdsZSBjaG9pY2Ugdm90ZSB2YWxpZGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnU2luZ2xlIGNob2ljZSB2b3RlIHZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgZXJyb3JzOiBbJ1NpbmdsZSBjaG9pY2Ugdm90ZSB2YWxpZGF0aW9uIGZhaWxlZCddLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3NWb3RlKHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IFByb21pc2U8Vm90ZVJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZvdGVEYXRhID0gcmVxdWVzdC52b3RlRGF0YTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHZvdGUgZGF0YSBmb3Igc3RvcmFnZVxuICAgICAgY29uc3Qgdm90ZVJlY29yZDogVm90ZURhdGEgPSB7XG4gICAgICAgIGlkOiBgdm90ZV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIHZvdGVEYXRhOiB7XG4gICAgICAgICAgY2hvaWNlOiB2b3RlRGF0YS5jaG9pY2VcbiAgICAgICAgfSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGlwQWRkcmVzczogcmVxdWVzdC5pcEFkZHJlc3MsXG4gICAgICAgIHVzZXJBZ2VudDogcmVxdWVzdC51c2VyQWdlbnRcbiAgICAgIH07XG5cbiAgICAgIGRldkxvZygnU2luZ2xlIGNob2ljZSB2b3RlIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLCB7XG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIGNob2ljZTogdm90ZURhdGEuY2hvaWNlLFxuICAgICAgICB2b3RlSWQ6IHZvdGVSZWNvcmQuaWRcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB2b3RlSWQ6IHZvdGVSZWNvcmQuaWQsXG4gICAgICAgIG1lc3NhZ2U6ICdWb3RlIHJlY29yZGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWRcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdTaW5nbGUgY2hvaWNlIHZvdGUgcHJvY2Vzc2luZyBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyBzaW5nbGUgY2hvaWNlIHZvdGUnLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHByb2Nlc3Mgc2luZ2xlIGNob2ljZSB2b3RlJyxcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjYWxjdWxhdGVSZXN1bHRzKHBvbGw6IFBvbGxEYXRhLCB2b3RlczogVm90ZURhdGFbXSk6IFByb21pc2U8UmVzdWx0c0RhdGE+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgLy8gSW5pdGlhbGl6ZSB0cmFja2luZyBvYmplY3RzXG4gICAgICBjb25zdCBvcHRpb25Wb3RlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgICAgY29uc3Qgb3B0aW9uUGVyY2VudGFnZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBhbGwgb3B0aW9ucyB3aXRoIHplcm8gc2NvcmVzXG4gICAgICBwb2xsLm9wdGlvbnMuZm9yRWFjaChvcHRpb24gPT4ge1xuICAgICAgICBvcHRpb25Wb3Rlc1tvcHRpb24uaWRdID0gMDtcbiAgICAgICAgb3B0aW9uUGVyY2VudGFnZXNbb3B0aW9uLmlkXSA9IDA7XG4gICAgICB9KTtcblxuICAgICAgLy8gUHJvY2VzcyBlYWNoIHZvdGUgYW5kIGNvdW50IG9ubHkgdmFsaWQgdm90ZXNcbiAgICAgIGxldCB2YWxpZFZvdGVDb3VudCA9IDA7XG4gICAgICB2b3Rlcy5mb3JFYWNoKHZvdGUgPT4ge1xuICAgICAgICAvLyBIYW5kbGUgYm90aCB2b3RlRGF0YS5jaG9pY2UgYW5kIGRpcmVjdCBjaG9pY2UgcHJvcGVydHlcbiAgICAgICAgY29uc3QgY2hvaWNlID0gdm90ZS52b3RlRGF0YT8uY2hvaWNlID8/IHZvdGUuY2hvaWNlO1xuICAgICAgICBpZiAodHlwZW9mIGNob2ljZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICBjb25zdCBvcHRpb25JZCA9IHBvbGwub3B0aW9uc1tjaG9pY2VdPy5pZDtcbiAgICAgICAgICBpZiAob3B0aW9uSWQpIHtcbiAgICAgICAgICAgIG9wdGlvblZvdGVzW29wdGlvbklkXSsrO1xuICAgICAgICAgICAgdmFsaWRWb3RlQ291bnQrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0b3RhbFZvdGVzID0gdmFsaWRWb3RlQ291bnQ7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBwZXJjZW50YWdlc1xuICAgICAgaWYgKHRvdGFsVm90ZXMgPiAwKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG9wdGlvblZvdGVzKS5mb3JFYWNoKG9wdGlvbklkID0+IHtcbiAgICAgICAgICBjb25zdCB2b3RlcyA9IG9wdGlvblZvdGVzW29wdGlvbklkXTtcbiAgICAgICAgICBvcHRpb25QZXJjZW50YWdlc1tvcHRpb25JZF0gPSAodm90ZXMgLyB0b3RhbFZvdGVzKSAqIDEwMDtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbmQgd2lubmVyIChoaWdoZXN0IHZvdGUgY291bnQpXG4gICAgICBsZXQgd2lubmVyOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICBsZXQgd2lubmVyVm90ZXMgPSAwO1xuICAgICAgbGV0IHdpbm5lclBlcmNlbnRhZ2UgPSAwO1xuXG4gICAgICBpZiAodG90YWxWb3RlcyA+IDApIHtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMob3B0aW9uVm90ZXMpLmZvckVhY2goKFtvcHRpb25JZCwgdm90ZXNdKSA9PiB7XG4gICAgICAgICAgaWYgKHZvdGVzID4gd2lubmVyVm90ZXMpIHtcbiAgICAgICAgICAgIHdpbm5lciA9IG9wdGlvbklkO1xuICAgICAgICAgICAgd2lubmVyVm90ZXMgPSB2b3RlcztcbiAgICAgICAgICAgIHdpbm5lclBlcmNlbnRhZ2UgPSBvcHRpb25QZXJjZW50YWdlc1tvcHRpb25JZF0gfHwgMDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHRzOiBQb2xsUmVzdWx0cyA9IHtcbiAgICAgICAgd2lubmVyOiB0b3RhbFZvdGVzID4gMCA/IHdpbm5lciA6IG51bGwsXG4gICAgICAgIHdpbm5lclZvdGVzLFxuICAgICAgICB3aW5uZXJQZXJjZW50YWdlLFxuICAgICAgICBvcHRpb25Wb3RlcyxcbiAgICAgICAgb3B0aW9uUGVyY2VudGFnZXMsXG4gICAgICAgIGFic3RlbnRpb25zOiAwLFxuICAgICAgICBhYnN0ZW50aW9uUGVyY2VudGFnZTogMFxuICAgICAgfTtcblxuICAgICAgZGV2TG9nKCdTaW5nbGUgY2hvaWNlIHJlc3VsdHMgY2FsY3VsYXRlZCcsIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICB0b3RhbFZvdGVzLFxuICAgICAgICB3aW5uZXIsXG4gICAgICAgIHdpbm5lclZvdGVzLFxuICAgICAgICB3aW5uZXJQZXJjZW50YWdlLFxuICAgICAgICBjYWxjdWxhdGlvblRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb2xsSWQ6IHBvbGwuaWQsXG4gICAgICAgIHZvdGluZ01ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgIHRvdGFsVm90ZXMsXG4gICAgICAgIHBhcnRpY2lwYXRpb25SYXRlOiB0b3RhbFZvdGVzIC8gMTAwLCAvLyBNb2NrIHBhcnRpY2lwYXRpb24gcmF0ZVxuICAgICAgICByZXN1bHRzLFxuICAgICAgICBjYWxjdWxhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBjYWxjdWxhdGlvblRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgbWV0aG9kOiAnc2luZ2xlJ1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRldkxvZygnU2luZ2xlIGNob2ljZSByZXN1bHRzIGNhbGN1bGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgLy8gUmV0dXJuIGVtcHR5IHJlc3VsdHMgb24gZXJyb3JcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvbGxJZDogcG9sbC5pZCxcbiAgICAgICAgdm90aW5nTWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgdG90YWxWb3RlczogMCxcbiAgICAgICAgcGFydGljaXBhdGlvblJhdGU6IDAsXG4gICAgICAgIHJlc3VsdHM6IHtcbiAgICAgICAgICB3aW5uZXI6IHVuZGVmaW5lZCxcbiAgICAgICAgICB3aW5uZXJWb3RlczogMCxcbiAgICAgICAgICB3aW5uZXJQZXJjZW50YWdlOiAwLFxuICAgICAgICAgIG9wdGlvblZvdGVzOiB7fSxcbiAgICAgICAgICBvcHRpb25QZXJjZW50YWdlczoge30sXG4gICAgICAgICAgYWJzdGVudGlvbnM6IDAsXG4gICAgICAgICAgYWJzdGVudGlvblBlcmNlbnRhZ2U6IDBcbiAgICAgICAgfSxcbiAgICAgICAgY2FsY3VsYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgY2FsY3VsYXRpb25UaW1lOiAwLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGdldENvbmZpZ3VyYXRpb24oKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICAgIHJldHVybiB7XG4gICAgICBtZXRob2Q6ICdzaW5nbGUnLFxuICAgICAgZGVzY3JpcHRpb246ICdWb3RlcnMgc2VsZWN0IGV4YWN0bHkgb25lIG9wdGlvbicsXG4gICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IGZhbHNlLFxuICAgICAgcmVxdWlyZXNSYW5raW5nOiBmYWxzZSxcbiAgICAgIG1heFNlbGVjdGlvbnM6IDEsXG4gICAgICBhbGdvcml0aG06ICdwbHVyYWxpdHknXG4gICAgfTtcbiAgfVxufSJdLCJuYW1lcyI6WyJTaW5nbGVDaG9pY2VTdHJhdGVneSIsImdldFZvdGluZ01ldGhvZCIsInZhbGlkYXRlVm90ZSIsInJlcXVlc3QiLCJwb2xsIiwidm90ZURhdGEiLCJjaG9pY2UiLCJ2YWxpZCIsImlzVmFsaWQiLCJlcnJvciIsImVycm9ycyIsInJlcXVpcmVzQXV0aGVudGljYXRpb24iLCJyZXF1aXJlc1Rva2VucyIsIk51bWJlciIsImlzSW50ZWdlciIsIm9wdGlvbnMiLCJsZW5ndGgiLCJkZXZMb2ciLCJwb2xsSWQiLCJ1c2VySWQiLCJwcm9jZXNzVm90ZSIsInZvdGVSZWNvcmQiLCJpZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0aW1lc3RhbXAiLCJ0b0lTT1N0cmluZyIsImlwQWRkcmVzcyIsInVzZXJBZ2VudCIsInZvdGVJZCIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiY2FsY3VsYXRlUmVzdWx0cyIsInZvdGVzIiwic3RhcnRUaW1lIiwib3B0aW9uVm90ZXMiLCJvcHRpb25QZXJjZW50YWdlcyIsImZvckVhY2giLCJvcHRpb24iLCJ2YWxpZFZvdGVDb3VudCIsInZvdGUiLCJvcHRpb25JZCIsInRvdGFsVm90ZXMiLCJPYmplY3QiLCJrZXlzIiwid2lubmVyIiwid2lubmVyVm90ZXMiLCJ3aW5uZXJQZXJjZW50YWdlIiwiZW50cmllcyIsInJlc3VsdHMiLCJhYnN0ZW50aW9ucyIsImFic3RlbnRpb25QZXJjZW50YWdlIiwiY2FsY3VsYXRpb25UaW1lIiwidm90aW5nTWV0aG9kIiwicGFydGljaXBhdGlvblJhdGUiLCJjYWxjdWxhdGVkQXQiLCJtZXRhZGF0YSIsIm1ldGhvZCIsInVuZGVmaW5lZCIsIkVycm9yIiwiZ2V0Q29uZmlndXJhdGlvbiIsImRlc2NyaXB0aW9uIiwiYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zIiwicmVxdWlyZXNSYW5raW5nIiwibWF4U2VsZWN0aW9ucyIsImFsZ29yaXRobSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0NBUUM7Ozs7K0JBaUJZQTs7O2VBQUFBOzs7d0JBZlU7QUFlaEIsTUFBTUE7SUFFWEMsa0JBQWdDO1FBQzlCLE9BQU87SUFDVDtJQUVBLE1BQU1DLGFBQWFDLE9BQW9CLEVBQUVDLElBQWMsRUFBMkI7UUFDaEYsSUFBSTtZQUNGLE1BQU1DLFdBQVdGLFFBQVFFLFFBQVE7WUFFakMseUNBQXlDO1lBQ3pDLElBQUksT0FBT0EsU0FBU0MsTUFBTSxLQUFLLFVBQVU7Z0JBQ3ZDLE9BQU87b0JBQ0xDLE9BQU87b0JBQ1BDLFNBQVM7b0JBQ1RDLE9BQU87b0JBQ1BDLFFBQVE7d0JBQUM7cUJBQThDO29CQUN2REMsd0JBQXdCO29CQUN4QkMsZ0JBQWdCO2dCQUNsQjtZQUNGO1lBRUEscUNBQXFDO1lBQ3JDLElBQUksQ0FBQ0MsT0FBT0MsU0FBUyxDQUFDVCxTQUFTQyxNQUFNLEdBQUc7Z0JBQ3RDLE9BQU87b0JBQ0xDLE9BQU87b0JBQ1BDLFNBQVM7b0JBQ1RDLE9BQU87b0JBQ1BDLFFBQVE7d0JBQUM7cUJBQTRCO29CQUNyQ0Msd0JB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
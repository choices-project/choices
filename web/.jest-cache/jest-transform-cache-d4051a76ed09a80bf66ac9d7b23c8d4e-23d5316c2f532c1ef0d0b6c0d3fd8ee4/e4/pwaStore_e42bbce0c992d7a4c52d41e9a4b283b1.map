{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/stores/pwaStore.ts"],"sourcesContent":["/**\n * PWA Store - Zustand Implementation\n * \n * Comprehensive PWA state management including installation status,\n * offline mode, update notifications, and PWA-specific settings.\n * Consolidates PWA state management and service worker integration.\n * \n * Created: October 10, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { persist } from 'zustand/middleware';\n\nimport { logger } from '@/lib/utils/logger';\nimport { withOptional } from '@/lib/utils/objects';\n\n// PWA data types\ninterface PWAInstallation {\n  isInstalled: boolean;\n  installPrompt: any; // BeforeInstallPromptEvent\n  canInstall: boolean;\n  installSource: 'browser' | 'app_store' | 'play_store' | 'manual';\n  installedAt?: string;\n  version: string;\n}\n\ninterface PWAOffline {\n  isOnline: boolean;\n  isOffline: boolean;\n  lastOnline: string;\n  offlineSince?: string;\n  offlineData: {\n    cachedPages: string[];\n    cachedResources: string[];\n    queuedActions: Array<{\n      id: string;\n      action: string;\n      data: any;\n      timestamp: string;\n    }>;\n  };\n}\n\ninterface PWAUpdate {\n  isAvailable: boolean;\n  isDownloading: boolean;\n  isInstalling: boolean;\n  version: string;\n  releaseNotes: string;\n  downloadProgress: number;\n  installPrompt: any;\n  autoUpdate: boolean;\n  updateChannel: 'stable' | 'beta' | 'alpha';\n}\n\ninterface PWANotification {\n  id: string;\n  type: 'update' | 'offline' | 'install' | 'permission' | 'error';\n  title: string;\n  message: string;\n  action?: {\n    label: string;\n    handler: () => void;\n  };\n  dismissible: boolean;\n  priority: 'low' | 'medium' | 'high';\n  createdAt: string;\n  read: boolean;\n}\n\ninterface PWAPreferences {\n  autoUpdate: boolean;\n  offlineMode: boolean;\n  backgroundSync: boolean;\n  pushNotifications: boolean;\n  installPrompt: boolean;\n  updateChannel: 'stable' | 'beta' | 'alpha';\n  cacheStrategy: 'aggressive' | 'balanced' | 'conservative';\n  dataUsage: {\n    maxCacheSize: number; // MB\n    maxOfflineStorage: number; // MB\n    syncFrequency: number; // minutes\n  };\n  privacy: {\n    shareUsageData: boolean;\n    shareCrashReports: boolean;\n    sharePerformanceData: boolean;\n  };\n}\n\ninterface PWAPerformance {\n  loadTime: number;\n  timeToInteractive: number;\n  firstContentfulPaint: number;\n  largestContentfulPaint: number;\n  cumulativeLayoutShift: number;\n  memoryUsage: number;\n  networkLatency: number;\n  cacheHitRate: number;\n  offlineCapability: number;\n}\n\n// PWA store state interface\ninterface PWAStore {\n  // PWA state\n  installation: PWAInstallation;\n  offline: PWAOffline;\n  update: PWAUpdate;\n  notifications: PWANotification[];\n  performance: PWAPerformance | null;\n  \n  // Preferences\n  preferences: PWAPreferences;\n  \n  // Loading states\n  isLoading: boolean;\n  isInstalling: boolean;\n  isUpdating: boolean;\n  isSyncing: boolean;\n  error: string | null;\n  \n  // Actions - Installation\n  setInstallation: (installation: Partial<PWAInstallation>) => void;\n  setInstallPrompt: (prompt: any) => void;\n  setCanInstall: (canInstall: boolean) => void;\n  installPWA: () => Promise<void>;\n  uninstallPWA: () => Promise<void>;\n  \n  // Actions - Offline management\n  setOnlineStatus: (isOnline: boolean) => void;\n  setOfflineData: (data: Partial<PWAOffline['offlineData']>) => void;\n  addCachedPage: (page: string) => void;\n  removeCachedPage: (page: string) => void;\n  addCachedResource: (resource: string) => void;\n  removeCachedResource: (resource: string) => void;\n  queueOfflineAction: (action: PWAOffline['offlineData']['queuedActions'][0]) => void;\n  processOfflineActions: () => Promise<void>;\n  \n  // Actions - Updates\n  setUpdateAvailable: (update: Partial<PWAUpdate>) => void;\n  downloadUpdate: () => Promise<void>;\n  installUpdate: () => Promise<void>;\n  skipUpdate: () => void;\n  setAutoUpdate: (enabled: boolean) => void;\n  \n  // Actions - Notifications\n  addNotification: (notification: Omit<PWANotification, 'id' | 'createdAt'>) => void;\n  removeNotification: (id: string) => void;\n  markNotificationRead: (id: string) => void;\n  clearNotifications: () => void;\n  \n  // Actions - Performance\n  setPerformance: (performance: PWAPerformance) => void;\n  updatePerformanceMetrics: (metrics: Partial<PWAPerformance>) => void;\n  \n  // Actions - Preferences\n  updatePreferences: (preferences: Partial<PWAPreferences>) => void;\n  resetPreferences: () => void;\n  \n  // Actions - Service Worker\n  registerServiceWorker: () => Promise<void>;\n  unregisterServiceWorker: () => Promise<void>;\n  updateServiceWorker: () => Promise<void>;\n  \n  // Actions - Data operations\n  syncData: () => Promise<void>;\n  clearCache: () => Promise<void>;\n  exportData: () => Promise<void>;\n  importData: (data: any) => Promise<void>;\n  \n  // Actions - Loading states\n  setLoading: (loading: boolean) => void;\n  setInstalling: (installing: boolean) => void;\n  setUpdating: (updating: boolean) => void;\n  setSyncing: (syncing: boolean) => void;\n  setError: (error: string | null) => void;\n  clearError: () => void;\n}\n\n// Default PWA preferences\nconst defaultPreferences: PWAPreferences = {\n  autoUpdate: true,\n  offlineMode: true,\n  backgroundSync: true,\n  pushNotifications: true,\n  installPrompt: true,\n  updateChannel: 'stable',\n  cacheStrategy: 'balanced',\n  dataUsage: {\n    maxCacheSize: 100, // 100MB\n    maxOfflineStorage: 50, // 50MB\n    syncFrequency: 15, // 15 minutes\n  },\n  privacy: {\n    shareUsageData: false,\n    shareCrashReports: true,\n    sharePerformanceData: false,\n  },\n};\n\n// Create PWA store with middleware\nexport const usePWAStore = create<PWAStore>()(\n  devtools(\n    persist(\n      (set, get) => ({\n        // Initial state\n        installation: {\n          isInstalled: false,\n          installPrompt: null,\n          canInstall: false,\n          installSource: 'manual',\n          version: '1.0.0',\n        },\n        offline: {\n          isOnline: typeof navigator !== 'undefined' ? navigator.onLine : true,\n          isOffline: typeof navigator !== 'undefined' ? !navigator.onLine : false,\n          lastOnline: new Date().toISOString(),\n          offlineData: {\n            cachedPages: [],\n            cachedResources: [],\n            queuedActions: [],\n          },\n        },\n        update: {\n          isAvailable: false,\n          isDownloading: false,\n          isInstalling: false,\n          version: '',\n          releaseNotes: '',\n          downloadProgress: 0,\n          installPrompt: null,\n          autoUpdate: true,\n          updateChannel: 'stable',\n        },\n        notifications: [],\n        performance: null,\n        preferences: defaultPreferences,\n        isLoading: false,\n        isInstalling: false,\n        isUpdating: false,\n        isSyncing: false,\n        error: null,\n        \n        // Installation actions\n        setInstallation: (installation) => set((state) => ({\n          installation: withOptional(state.installation, installation)\n        })),\n        \n        setInstallPrompt: (prompt) => set((state) => ({\n          installation: { ...state.installation, installPrompt: prompt }\n        })),\n        \n        setCanInstall: (canInstall) => set((state) => ({\n          installation: { ...state.installation, canInstall }\n        })),\n        \n        installPWA: async () => {\n          const { setInstalling, setError, installation } = get();\n          \n          try {\n            setInstalling(true);\n            setError(null);\n            \n            if (installation.installPrompt) {\n              installation.installPrompt.prompt();\n              const { outcome } = await installation.installPrompt.userChoice;\n              \n              if (outcome === 'accepted') {\n                set((state) => ({\n                  installation: {\n                    ...state.installation,\n                    isInstalled: true,\n                    installedAt: new Date().toISOString(),\n                    installPrompt: null,\n                  }\n                }));\n                \n                logger.info('PWA installed successfully');\n              }\n            }\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to install PWA:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setInstalling(false);\n          }\n        },\n        \n        uninstallPWA: () => {\n          const { setInstalling, setError } = get();\n          \n          try {\n            setInstalling(true);\n            setError(null);\n            \n            // PWA uninstallation is handled by the browser\n            set((state) => ({\n              installation: {\n                ...state.installation,\n                isInstalled: false,\n                installedAt: undefined,\n              }\n            }));\n            \n            logger.info('PWA uninstalled');\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to uninstall PWA:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setInstalling(false);\n          }\n        },\n        \n        // Offline management actions\n        setOnlineStatus: (isOnline) => set((state) => ({\n          offline: {\n            ...state.offline,\n            isOnline,\n            isOffline: !isOnline,\n            lastOnline: isOnline ? new Date().toISOString() : state.offline.lastOnline,\n            offlineSince: isOnline ? undefined : new Date().toISOString(),\n          }\n        })),\n        \n        setOfflineData: (data) => set((state) => ({\n          offline: withOptional(state.offline, {\n            offlineData: withOptional(state.offline.offlineData, data)\n          })\n        })),\n        \n        addCachedPage: (page) => set((state) => ({\n          offline: withOptional(state.offline, {\n            offlineData: withOptional(state.offline.offlineData, {\n              cachedPages: [...state.offline.offlineData.cachedPages, page]\n            })\n          })\n        })),\n        \n        removeCachedPage: (page) => set((state) => ({\n          offline: {\n            ...state.offline,\n            offlineData: {\n              ...state.offline.offlineData,\n              cachedPages: state.offline.offlineData.cachedPages.filter(p => p !== page)\n            }\n          }\n        })),\n        \n        addCachedResource: (resource) => set((state) => ({\n          offline: {\n            ...state.offline,\n            offlineData: {\n              ...state.offline.offlineData,\n              cachedResources: [...state.offline.offlineData.cachedResources, resource]\n            }\n          }\n        })),\n        \n        removeCachedResource: (resource) => set((state) => ({\n          offline: {\n            ...state.offline,\n            offlineData: {\n              ...state.offline.offlineData,\n              cachedResources: state.offline.offlineData.cachedResources.filter(r => r !== resource)\n            }\n          }\n        })),\n        \n        queueOfflineAction: (action) => set((state) => ({\n          offline: {\n            ...state.offline,\n            offlineData: {\n              ...state.offline.offlineData,\n              queuedActions: [...state.offline.offlineData.queuedActions, action]\n            }\n          }\n        })),\n        \n        processOfflineActions: async () => {\n          const { setSyncing, setError, offline } = get();\n          \n          try {\n            setSyncing(true);\n            setError(null);\n            \n            // Process queued actions when online\n            for (const action of offline.offlineData.queuedActions) {\n              try {\n                await fetch('/api/offline/process', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify(action),\n                });\n              } catch (error) {\n                logger.error('Failed to process offline action:', error as Error);\n              }\n            }\n            \n            // Clear processed actions\n            set((state) => ({\n              offline: {\n                ...state.offline,\n                offlineData: {\n                  ...state.offline.offlineData,\n                  queuedActions: []\n                }\n              }\n            }));\n            \n            logger.info('Offline actions processed', {\n              count: offline.offlineData.queuedActions.length\n            });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to process offline actions:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setSyncing(false);\n          }\n        },\n        \n        // Update actions\n        setUpdateAvailable: (update) => set((state) => ({\n          update: withOptional(state.update, update)\n        })),\n        \n        downloadUpdate: async () => {\n          const { setUpdating, setError } = get();\n          \n          try {\n            setUpdating(true);\n            setError(null);\n            \n            set((state) => ({\n              update: { ...state.update, isDownloading: true }\n            }));\n            \n            // Simulate download progress\n            for (let progress = 0; progress <= 100; progress += 10) {\n              set((state) => ({\n                update: { ...state.update, downloadProgress: progress }\n              }));\n              await new Promise(resolve => setTimeout(resolve, 100));\n            }\n            \n            set((state) => ({\n              update: { ...state.update, isDownloading: false }\n            }));\n            \n            logger.info('Update downloaded successfully');\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to download update:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setUpdating(false);\n          }\n        },\n        \n        installUpdate: () => {\n          const { setUpdating, setError } = get();\n          \n          try {\n            setUpdating(true);\n            setError(null);\n            \n            set((state) => ({\n              update: { ...state.update, isInstalling: true }\n            }));\n            \n            // Reload the page to apply update\n            window.location.reload();\n            \n            logger.info('Update installed successfully');\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to install update:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setUpdating(false);\n          }\n        },\n        \n        skipUpdate: () => set((state) => ({\n          update: { ...state.update, isAvailable: false }\n        })),\n        \n        setAutoUpdate: (enabled) => set((state) => ({\n          update: { ...state.update, autoUpdate: enabled }\n        })),\n        \n        // Notification actions\n        addNotification: (notification) => set((state) => ({\n          notifications: [\n            ...state.notifications,\n            {\n              ...notification,\n              id: `notification_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n              createdAt: new Date().toISOString(),\n            }\n          ]\n        })),\n        \n        removeNotification: (id) => set((state) => ({\n          notifications: state.notifications.filter(notification => notification.id !== id)\n        })),\n        \n        markNotificationRead: (id) => set((state) => ({\n          notifications: state.notifications.map(notification =>\n            notification.id === id \n              ? withOptional(notification, { read: true })\n              : notification\n          )\n        })),\n        \n        clearNotifications: () => set({ notifications: [] }),\n        \n        // Performance actions\n        setPerformance: (performance) => set({ performance }),\n        \n        updatePerformanceMetrics: (metrics) => set((state) => ({\n          performance: state.performance \n            ? withOptional(state.performance, metrics)\n            : withOptional(metrics) as PWAPerformance\n        })),\n        \n        // Preferences actions\n        updatePreferences: (preferences) => set((state) => ({\n          preferences: withOptional(state.preferences, preferences)\n        })),\n        \n        resetPreferences: () => set({ preferences: defaultPreferences }),\n        \n        // Service Worker actions\n        registerServiceWorker: async () => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            if ('serviceWorker' in navigator) {\n              const registration = await navigator.serviceWorker.register('/sw.js');\n              logger.info('Service Worker registered:', { scope: registration.scope, active: !!registration.active });\n            }\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to register Service Worker:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        unregisterServiceWorker: async () => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            if ('serviceWorker' in navigator) {\n              const registrations = await navigator.serviceWorker.getRegistrations();\n              for (const registration of registrations) {\n                await registration.unregister();\n              }\n              logger.info('Service Worker unregistered');\n            }\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to unregister Service Worker:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        updateServiceWorker: async () => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            if ('serviceWorker' in navigator) {\n              const registration = await navigator.serviceWorker.getRegistration();\n              if (registration) {\n                await registration.update();\n                logger.info('Service Worker updated');\n              }\n            }\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to update Service Worker:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        // Data operations\n        syncData: async () => {\n          const { setSyncing, setError } = get();\n          \n          try {\n            setSyncing(true);\n            setError(null);\n            \n            // Sync offline data with server\n            const response = await fetch('/api/pwa/sync', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to sync data');\n            }\n            \n            logger.info('Data synced successfully');\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to sync data:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setSyncing(false);\n          }\n        },\n        \n        clearCache: async () => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            if ('caches' in window) {\n              const cacheNames = await caches.keys();\n              await Promise.all(\n                cacheNames.map(cacheName => caches.delete(cacheName))\n              );\n            }\n            \n            set((state) => ({\n              offline: {\n                ...state.offline,\n                offlineData: {\n                  cachedPages: [],\n                  cachedResources: [],\n                  queuedActions: state.offline.offlineData.queuedActions,\n                }\n              }\n            }));\n            \n            logger.info('Cache cleared successfully');\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to clear cache:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        exportData: () => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            const state = get();\n            const data = {\n              installation: state.installation,\n              offline: state.offline,\n              preferences: state.preferences,\n              performance: state.performance,\n            };\n            \n            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'pwa-data.json';\n            a.click();\n            URL.revokeObjectURL(url);\n            \n            logger.info('PWA data exported successfully');\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to export data:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        importData: (data) => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            set({\n              installation: data.installation || get().installation,\n              offline: data.offline || get().offline,\n              preferences: data.preferences || get().preferences,\n              performance: data.performance || get().performance,\n            });\n            \n            logger.info('PWA data imported successfully');\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to import data:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        // Loading state actions\n        setLoading: (loading) => set({ isLoading: loading }),\n        setInstalling: (installing) => set({ isInstalling: installing }),\n        setUpdating: (updating) => set({ isUpdating: updating }),\n        setSyncing: (syncing) => set({ isSyncing: syncing }),\n        setError: (error) => set({ error }),\n        clearError: () => set({ error: null }),\n      }),\n      {\n        name: 'pwa-store',\n        partialize: (state) => ({\n          installation: state.installation,\n          offline: state.offline,\n          preferences: state.preferences,\n          performance: state.performance,\n        }),\n      }\n    ),\n    { name: 'pwa-store' }\n  )\n);\n\n// Store selectors for optimized re-renders\nexport const usePWAInstallation = () => usePWAStore(state => state.installation);\nexport const usePWAOffline = () => usePWAStore(state => state.offline);\nexport const usePWAUpdate = () => usePWAStore(state => state.update);\nexport const usePWANotifications = () => usePWAStore(state => state.notifications);\nexport const usePWAPerformance = () => usePWAStore(state => state.performance);\nexport const usePWAPreferences = () => usePWAStore(state => state.preferences);\nexport const usePWALoading = () => usePWAStore(state => state.isLoading);\nexport const usePWAError = () => usePWAStore(state => state.error);\n\n// Action selectors\nexport const usePWAActions = () => usePWAStore(state => ({\n  setInstallation: state.setInstallation,\n  setInstallPrompt: state.setInstallPrompt,\n  setCanInstall: state.setCanInstall,\n  installPWA: state.installPWA,\n  uninstallPWA: state.uninstallPWA,\n  setOnlineStatus: state.setOnlineStatus,\n  setOfflineData: state.setOfflineData,\n  addCachedPage: state.addCachedPage,\n  removeCachedPage: state.removeCachedPage,\n  addCachedResource: state.addCachedResource,\n  removeCachedResource: state.removeCachedResource,\n  queueOfflineAction: state.queueOfflineAction,\n  processOfflineActions: state.processOfflineActions,\n  setUpdateAvailable: state.setUpdateAvailable,\n  downloadUpdate: state.downloadUpdate,\n  installUpdate: state.installUpdate,\n  skipUpdate: state.skipUpdate,\n  setAutoUpdate: state.setAutoUpdate,\n  addNotification: state.addNotification,\n  removeNotification: state.removeNotification,\n  markNotificationRead: state.markNotificationRead,\n  clearNotifications: state.clearNotifications,\n  setPerformance: state.setPerformance,\n  updatePerformanceMetrics: state.updatePerformanceMetrics,\n  updatePreferences: state.updatePreferences,\n  resetPreferences: state.resetPreferences,\n  registerServiceWorker: state.registerServiceWorker,\n  unregisterServiceWorker: state.unregisterServiceWorker,\n  updateServiceWorker: state.updateServiceWorker,\n  syncData: state.syncData,\n  clearCache: state.clearCache,\n  exportData: state.exportData,\n  importData: state.importData,\n  setLoading: state.setLoading,\n  setInstalling: state.setInstalling,\n  setUpdating: state.setUpdating,\n  setSyncing: state.setSyncing,\n  setError: state.setError,\n  clearError: state.clearError,\n}));\n\n// Computed selectors\nexport const usePWAStats = () => usePWAStore(state => ({\n  isInstalled: state.installation.isInstalled,\n  canInstall: state.installation.canInstall,\n  isOnline: state.offline.isOnline,\n  isOffline: state.offline.isOffline,\n  updateAvailable: state.update.isAvailable,\n  notifications: state.notifications.length,\n  unreadNotifications: state.notifications.filter(n => !n.read).length,\n  cachedPages: state.offline.offlineData.cachedPages.length,\n  cachedResources: state.offline.offlineData.cachedResources.length,\n  queuedActions: state.offline.offlineData.queuedActions.length,\n  isLoading: state.isLoading,\n  isInstalling: state.isInstalling,\n  isUpdating: state.isUpdating,\n  isSyncing: state.isSyncing,\n  error: state.error,\n}));\n\nexport const useUnreadNotifications = () => usePWAStore(state => \n  state.notifications.filter(notification => !notification.read)\n);\n\nexport const useHighPriorityNotifications = () => usePWAStore(state => \n  state.notifications.filter(notification => notification.priority === 'high')\n);\n\n// Store utilities\nexport const pwaStoreUtils = {\n  /**\n   * Get PWA summary\n   */\n  getPWASummary: () => {\n    const state = usePWAStore.getState();\n    return {\n      isInstalled: state.installation.isInstalled,\n      canInstall: state.installation.canInstall,\n      isOnline: state.offline.isOnline,\n      updateAvailable: state.update.isAvailable,\n      notifications: state.notifications.length,\n      performance: state.performance,\n    };\n  },\n  \n  /**\n   * Get offline capability score\n   */\n  getOfflineCapability: () => {\n    const state = usePWAStore.getState();\n    const cachedPages = state.offline.offlineData.cachedPages.length;\n    const cachedResources = state.offline.offlineData.cachedResources.length;\n    return Math.min(100, (cachedPages + cachedResources) * 10);\n  },\n  \n  /**\n   * Get cache usage\n   */\n  getCacheUsage: () => {\n    const state = usePWAStore.getState();\n    const maxSize = state.preferences.dataUsage.maxCacheSize;\n    const used = state.offline.offlineData.cachedPages.length + \n                 state.offline.offlineData.cachedResources.length;\n    return {\n      used,\n      max: maxSize,\n      percentage: (used / maxSize) * 100,\n    };\n  },\n  \n  /**\n   * Check if update is needed\n   */\n  isUpdateNeeded: () => {\n    const state = usePWAStore.getState();\n    return state.update.isAvailable && !state.update.isDownloading && !state.update.isInstalling;\n  }\n};\n\n// Store subscriptions for external integrations\nexport const pwaStoreSubscriptions = {\n  /**\n   * Subscribe to installation changes\n   */\n  onInstallationChange: (callback: (installation: PWAInstallation) => void) => {\n    let prevInstallation: PWAInstallation | null = null;\n    return usePWAStore.subscribe(\n      (state) => {\n        const installation = state.installation;\n        if (installation !== prevInstallation) {\n          callback(installation);\n        }\n        prevInstallation = installation;\n        return installation;\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to offline status changes\n   */\n  onOfflineStatusChange: (callback: (isOffline: boolean) => void) => {\n    let prevIsOffline: boolean | null = null;\n    return usePWAStore.subscribe(\n      (state) => {\n        const isOffline = state.offline.isOffline;\n        if (isOffline !== prevIsOffline) {\n          callback(isOffline);\n        }\n        prevIsOffline = isOffline;\n        return isOffline;\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to update availability\n   */\n  onUpdateAvailable: (callback: (update: PWAUpdate) => void) => {\n    let prevUpdate: PWAUpdate | null = null;\n    return usePWAStore.subscribe(\n      (state) => {\n        const update = state.update;\n        if (update.isAvailable !== prevUpdate?.isAvailable) {\n          callback(update);\n        }\n        prevUpdate = update;\n        return update;\n      }\n    );\n  }\n};\n\n// Store debugging utilities\nexport const pwaStoreDebug = {\n  /**\n   * Log current PWA state\n   */\n  logState: () => {\n    const state = usePWAStore.getState();\n    console.log('PWA Store State:', {\n      isInstalled: state.installation.isInstalled,\n      canInstall: state.installation.canInstall,\n      isOnline: state.offline.isOnline,\n      updateAvailable: state.update.isAvailable,\n      notifications: state.notifications.length,\n      cachedPages: state.offline.offlineData.cachedPages.length,\n      queuedActions: state.offline.offlineData.queuedActions.length,\n      isLoading: state.isLoading,\n      error: state.error\n    });\n  },\n  \n  /**\n   * Log PWA summary\n   */\n  logSummary: () => {\n    const summary = pwaStoreUtils.getPWASummary();\n    console.log('PWA Summary:', summary);\n  },\n  \n  /**\n   * Log offline capability\n   */\n  logOfflineCapability: () => {\n    const capability = pwaStoreUtils.getOfflineCapability();\n    console.log('Offline Capability:', capability);\n  },\n  \n  /**\n   * Reset PWA store\n   */\n  reset: () => {\n    usePWAStore.getState().resetPreferences();\n    usePWAStore.getState().clearNotifications();\n    console.log('PWA store reset');\n  }\n};\n"],"names":["pwaStoreDebug","pwaStoreSubscriptions","pwaStoreUtils","useHighPriorityNotifications","usePWAActions","usePWAError","usePWAInstallation","usePWALoading","usePWANotifications","usePWAOffline","usePWAPerformance","usePWAPreferences","usePWAStats","usePWAStore","usePWAUpdate","useUnreadNotifications","defaultPreferences","autoUpdate","offlineMode","backgroundSync","pushNotifications","installPrompt","updateChannel","cacheStrategy","dataUsage","maxCacheSize","maxOfflineStorage","syncFrequency","privacy","shareUsageData","shareCrashReports","sharePerformanceData","create","devtools","persist","set","get","installation","isInstalled","canInstall","installSource","version","offline","isOnline","navigator","onLine","isOffline","lastOnline","Date","toISOString","offlineData","cachedPages","cachedResources","queuedActions","update","isAvailable","isDownloading","isInstalling","releaseNotes","downloadProgress","notifications","performance","preferences","isLoading","isUpdating","isSyncing","error","setInstallation","state","withOptional","setInstallPrompt","prompt","setCanInstall","installPWA","setInstalling","setError","outcome","userChoice","installedAt","logger","info","errorMessage","Error","message","uninstallPWA","undefined","setOnlineStatus","offlineSince","setOfflineData","data","addCachedPage","page","removeCachedPage","filter","p","addCachedResource","resource","removeCachedResource","r","queueOfflineAction","action","processOfflineActions","setSyncing","fetch","method","headers","body","JSON","stringify","count","length","setUpdateAvailable","downloadUpdate","setUpdating","progress","Promise","resolve","setTimeout","installUpdate","window","location","reload","skipUpdate","setAutoUpdate","enabled","addNotification","notification","id","now","Math","random","toString","substr","createdAt","removeNotification","markNotificationRead","map","read","clearNotifications","setPerformance","updatePerformanceMetrics","metrics","updatePreferences","resetPreferences","registerServiceWorker","setLoading","registration","serviceWorker","register","scope","active","unregisterServiceWorker","registrations","getRegistrations","unregister","updateServiceWorker","getRegistration","syncData","response","ok","clearCache","cacheNames","caches","keys","all","cacheName","delete","exportData","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","href","download","click","revokeObjectURL","importData","loading","installing","updating","syncing","clearError","name","partialize","updateAvailable","unreadNotifications","n","priority","getPWASummary","getState","getOfflineCapability","min","getCacheUsage","maxSize","used","max","percentage","isUpdateNeeded","onInstallationChange","callback","prevInstallation","subscribe","onOfflineStatusChange","prevIsOffline","onUpdateAvailable","prevUpdate","logState","console","log","logSummary","summary","logOfflineCapability","capability","reset"],"mappings":"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"}
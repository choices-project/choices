6aecbe5d16aa5ab1a1e2d42bbceba7d6
/**
 * Core Voting Engine
 * 
 * This module provides the main voting engine that orchestrates different voting strategies
 * and handles vote processing, validation, and results calculation.
 * 
 * Created: September 15, 2025
 * Updated: September 15, 2025
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    VoteEngine: function() {
        return VoteEngine;
    },
    voteEngine: function() {
        return voteEngine;
    }
});
const _logger = require("../utils/logger");
const _approval = require("./strategies/approval");
const _quadratic = require("./strategies/quadratic");
const _range = require("./strategies/range");
const _ranked = require("./strategies/ranked");
const _singlechoice = require("./strategies/single-choice");
class VoteEngine {
    constructor(config = {}){
        this.config = Object.assign({
            maxVotesPerPoll: 10000,
            allowMultipleVotes: false,
            requireAuthentication: true,
            minTrustTier: "T0",
            rateLimitPerUser: 10,
            rateLimitWindowMs: 60000
        }, config);
        // Initialize rate limiting tracker
        this.rateLimitTracker = new Map();
        // Initialize voting strategies
        this.strategies = new Map([
            [
                "single",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "single-choice",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "approval",
                new _approval.ApprovalStrategy()
            ],
            [
                "ranked",
                new _ranked.RankedStrategy()
            ],
            [
                "ranked-choice",
                new _ranked.RankedStrategy()
            ],
            [
                "quadratic",
                new _quadratic.QuadraticStrategy()
            ],
            [
                "range",
                new _range.RangeStrategy()
            ]
        ]);
        (0, _logger.devLog)("VoteEngine initialized with strategies:", Array.from(this.strategies.keys()));
    }
    /**
   * Get the appropriate voting strategy for a poll
   */ getStrategy(method) {
        (0, _logger.devLog)("Looking up strategy for method:", method);
        (0, _logger.devLog)("Available strategies:", Array.from(this.strategies.keys()));
        const strategy = this.strategies.get(method);
        if (!strategy) {
            throw new Error(`Unsupported voting method: ${method}`);
        }
        return strategy;
    }
    /**
   * Get voting strategy (public method for testing)
   */ getVotingStrategy(method) {
        return this.getStrategy(method);
    }
    /**
   * Save vote to database (for testing)
   */ async saveVote(voteData, pollId) {
        // Mock implementation for testing
        const voteId = `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        (0, _logger.devLog)("Vote saved to database", {
            voteId,
            pollId
        });
        return voteId;
    }
    /**
   * Validate a vote request
   */ async validateVote(request, poll) {
        const startTime = Date.now();
        try {
            // Basic validation
            if (!request.pollId || !request.voteData) {
                return {
                    valid: false,
                    errors: [
                        "Missing required vote data"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll ID mismatch
            if (request.pollId !== poll.id) {
                return {
                    valid: false,
                    errors: [
                        "Poll ID mismatch"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check if poll exists and is active
            if (!poll || poll.status !== "active") {
                return {
                    valid: false,
                    errors: [
                        "Poll is not active"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll end time
            if (poll.endTime && new Date(poll.endTime) < new Date()) {
                return {
                    valid: false,
                    errors: [
                        "Poll has ended"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check authentication requirements
            if (this.config.requireAuthentication && !request.userId && !poll.settings?.anonymousVoting) {
                return {
                    valid: false,
                    errors: [
                        "Authentication required to vote"
                    ],
                    requiresAuthentication: true,
                    requiresTokens: false
                };
            }
            // Validate vote options
            const optionValidation = this.validateVoteOptions(request.voteData, poll);
            if (!optionValidation.valid) {
                return optionValidation;
            }
            // Check rate limiting
            if (request.userId) {
                const rateLimitKey = `${request.userId}:${request.pollId}`;
                const now = Date.now();
                const rateLimitData = this.rateLimitTracker.get(rateLimitKey);
                if (rateLimitData) {
                    if (now < rateLimitData.resetTime) {
                        // Still within the rate limit window
                        if (rateLimitData.count >= this.config.rateLimitPerUser) {
                            return {
                                valid: false,
                                errors: [
                                    "Rate limit exceeded. Please try again later."
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    } else {
                        // Window has expired, reset the counter
                        rateLimitData.count = 0;
                        rateLimitData.resetTime = now + this.config.rateLimitWindowMs;
                    }
                } else {
                    // Initialize rate limit tracking
                    this.rateLimitTracker.set(rateLimitKey, {
                        count: 0,
                        resetTime: now + this.config.rateLimitWindowMs
                    });
                }
            }
            // Get the appropriate strategy and validate the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const strategyValidation = await strategy.validateVote(request, poll);
            if (!strategyValidation.valid) {
                return Object.assign({}, strategyValidation, {
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                });
            }
            (0, _logger.devLog)("Vote validation completed", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                duration: Date.now() - startTime
            });
            return {
                valid: true,
                errors: [],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            (0, _logger.devLog)("Vote validation error:", error);
            return {
                valid: false,
                errors: [
                    error instanceof Error ? error.message : "Validation failed"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Process a vote
   */ async processVote(request, poll) {
        const startTime = Date.now();
        try {
            // Validate the vote first
            const validation = await this.validateVote(request, poll);
            if (!validation.valid) {
                return {
                    success: false,
                    error: validation.errors?.[0] || "Vote validation failed",
                    pollId: request.pollId,
                    responseTime: Date.now() - startTime
                };
            }
            // Get the appropriate strategy and process the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const result = await strategy.processVote(request, poll);
            // Increment rate limit counter
            if (request.userId) {
                const rateLimitKey = `${request.userId}:${request.pollId}`;
                const rateLimitData = this.rateLimitTracker.get(rateLimitKey);
                if (rateLimitData) {
                    rateLimitData.count++;
                }
            }
            (0, _logger.devLog)("Vote processed successfully", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                voteId: result.voteId,
                duration: Date.now() - startTime
            });
            return {
                ...result,
                responseTime: Date.now() - startTime
            };
        } catch (error) {
            (0, _logger.devLog)("Vote processing error:", error);
            return {
                success: false,
                error: error instanceof Error ? error.message : "Vote processing failed",
                pollId: request.pollId,
                responseTime: Date.now() - startTime
            };
        }
    }
    /**
   * Calculate results for a poll
   */ async calculateResults(poll, votes) {
        const startTime = Date.now();
        try {
            // Handle empty vote sets
            if (votes.length === 0) {
                return {
                    pollId: poll.id,
                    votingMethod: poll.votingMethod,
                    totalVotes: 0,
                    participationRate: 0,
                    results: {
                        winner: null,
                        winnerVotes: 0,
                        winnerPercentage: 0,
                        optionVotes: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        optionPercentages: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        abstentions: 0,
                        abstentionPercentage: 0
                    },
                    calculatedAt: new Date().toISOString(),
                    metadata: {
                        calculationTime: Date.now() - startTime,
                        isEmpty: true
                    }
                };
            }
            const strategy = this.getStrategy(poll.votingMethod);
            const results = await strategy.calculateResults(poll, votes);
            (0, _logger.devLog)("Results calculated successfully", {
                pollId: poll.id,
                method: poll.votingMethod,
                totalVotes: votes.length,
                duration: Date.now() - startTime
            });
            return results;
        } catch (error) {
            (0, _logger.devLog)("Results calculation error:", error);
            // Return a basic results structure for unsupported methods
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes: votes.length,
                participationRate: votes.length / 100,
                results: {
                    winner: votes.length > 0 ? poll.options[0]?.id : undefined,
                    winnerVotes: votes.length,
                    winnerPercentage: 100,
                    optionVotes: poll.options.reduce((acc, option)=>{
                        acc[option.id] = votes.length;
                        return acc;
                    }, {}),
                    optionPercentages: poll.options.reduce((acc, option)=>{
                        acc[option.id] = 100;
                        return acc;
                    }, {}),
                    abstentions: 0,
                    abstentionPercentage: 0
                },
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: Date.now() - startTime,
                    error: error instanceof Error ? error.message : "Unknown error"
                }
            };
        }
    }
    /**
   * Validate vote options against poll options
   */ validateVoteOptions(voteData, poll) {
        try {
            // Check if vote data is valid
            if (!voteData) {
                return {
                    valid: false,
                    errors: [
                        "Vote data is required"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Validate based on voting method
            switch(poll.votingMethod){
                case "single":
                    if (typeof voteData.choice !== "number" || voteData.choice < 0 || voteData.choice >= poll.options.length) {
                        return {
                            valid: false,
                            errors: [
                                "Invalid option selected"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "approval":
                    if (!Array.isArray(voteData.approvals)) {
                        return {
                            valid: false,
                            errors: [
                                "Approval votes must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const approval of voteData.approvals){
                        if (typeof approval !== "number" || approval < 0 || approval >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "ranked":
                    if (!Array.isArray(voteData.rankings)) {
                        return {
                            valid: false,
                            errors: [
                                "Rankings must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const ranking of voteData.rankings){
                        if (typeof ranking !== "number" || ranking < 0 || ranking >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "quadratic":
                    if (!voteData.allocations || typeof voteData.allocations !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Quadratic voting requires allocations"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "range":
                    if (!voteData.ratings || typeof voteData.ratings !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Range voting requires ratings"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                default:
                    return {
                        valid: false,
                        errors: [
                            "Unsupported voting method"
                        ],
                        requiresAuthentication: this.config.requireAuthentication,
                        requiresTokens: false
                    };
            }
            return {
                valid: true,
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            return {
                valid: false,
                errors: [
                    "Vote validation error"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Get voting method configuration
   */ getVotingMethodConfig(method) {
        const strategy = this.getStrategy(method);
        return strategy.getConfiguration();
    }
    /**
   * Update engine configuration
   */ updateConfig(newConfig) {
        this.config = Object.assign({}, this.config, newConfig);
        (0, _logger.devLog)("VoteEngine configuration updated:", this.config);
    }
    /**
   * Get current configuration
   */ getConfig() {
        return {
            ...this.config
        };
    }
}
const voteEngine = new VoteEngine();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvdm90ZS9lbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3JlIFZvdGluZyBFbmdpbmVcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgdGhlIG1haW4gdm90aW5nIGVuZ2luZSB0aGF0IG9yY2hlc3RyYXRlcyBkaWZmZXJlbnQgdm90aW5nIHN0cmF0ZWdpZXNcbiAqIGFuZCBoYW5kbGVzIHZvdGUgcHJvY2Vzc2luZywgdmFsaWRhdGlvbiwgYW5kIHJlc3VsdHMgY2FsY3VsYXRpb24uXG4gKiBcbiAqIENyZWF0ZWQ6IFNlcHRlbWJlciAxNSwgMjAyNVxuICogVXBkYXRlZDogU2VwdGVtYmVyIDE1LCAyMDI1XG4gKi9cblxuaW1wb3J0IHsgZGV2TG9nIH0gZnJvbSAnQC9saWIvdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IHdpdGhPcHRpb25hbCB9IGZyb20gJ0AvbGliL3V0aWxzL29iamVjdHMnO1xuXG5pbXBvcnQgeyBBcHByb3ZhbFN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL2FwcHJvdmFsJztcbmltcG9ydCB7IFF1YWRyYXRpY1N0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL3F1YWRyYXRpYyc7XG5pbXBvcnQgeyBSYW5nZVN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL3JhbmdlJztcbmltcG9ydCB7IFJhbmtlZFN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL3JhbmtlZCc7XG5pbXBvcnQgeyBTaW5nbGVDaG9pY2VTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9zaW5nbGUtY2hvaWNlJztcbmltcG9ydCB0eXBlIHsgXG4gIFZvdGVSZXF1ZXN0LCBcbiAgVm90ZVJlc3BvbnNlLCBcbiAgVm90ZVZhbGlkYXRpb24sIFxuICBWb3RpbmdTdHJhdGVneSxcbiAgUG9sbERhdGEsXG4gIFZvdGVEYXRhLFxuICBSZXN1bHRzRGF0YSxcbiAgVm90aW5nTWV0aG9kXG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFZvdGVFbmdpbmVDb25maWcge1xuICBtYXhWb3Rlc1BlclBvbGw6IG51bWJlcjtcbiAgYWxsb3dNdWx0aXBsZVZvdGVzOiBib29sZWFuO1xuICByZXF1aXJlQXV0aGVudGljYXRpb246IGJvb2xlYW47XG4gIG1pblRydXN0VGllcjogc3RyaW5nO1xuICByYXRlTGltaXRQZXJVc2VyOiBudW1iZXI7XG4gIHJhdGVMaW1pdFdpbmRvd01zOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBWb3RlRW5naW5lIHtcbiAgcHJpdmF0ZSBzdHJhdGVnaWVzOiBNYXA8Vm90aW5nTWV0aG9kLCBWb3RpbmdTdHJhdGVneT47XG4gIHByaXZhdGUgY29uZmlnOiBWb3RlRW5naW5lQ29uZmlnO1xuICBwcml2YXRlIHJhdGVMaW1pdFRyYWNrZXI6IE1hcDxzdHJpbmcsIHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT47XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBQYXJ0aWFsPFZvdGVFbmdpbmVDb25maWc+ID0ge30pIHtcbiAgICB0aGlzLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgbWF4Vm90ZXNQZXJQb2xsOiAxMDAwMCxcbiAgICAgIGFsbG93TXVsdGlwbGVWb3RlczogZmFsc2UsXG4gICAgICByZXF1aXJlQXV0aGVudGljYXRpb246IHRydWUsXG4gICAgICBtaW5UcnVzdFRpZXI6ICdUMCcsXG4gICAgICByYXRlTGltaXRQZXJVc2VyOiAxMCxcbiAgICAgIHJhdGVMaW1pdFdpbmRvd01zOiA2MDAwMCwgLy8gMSBtaW51dGVcbiAgICB9LCBjb25maWcpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSByYXRlIGxpbWl0aW5nIHRyYWNrZXJcbiAgICB0aGlzLnJhdGVMaW1pdFRyYWNrZXIgPSBuZXcgTWFwKCk7XG5cbiAgICAvLyBJbml0aWFsaXplIHZvdGluZyBzdHJhdGVnaWVzXG4gICAgdGhpcy5zdHJhdGVnaWVzID0gbmV3IE1hcChbXG4gICAgICBbJ3NpbmdsZScsIG5ldyBTaW5nbGVDaG9pY2VTdHJhdGVneSgpXSxcbiAgICAgIFsnc2luZ2xlLWNob2ljZScsIG5ldyBTaW5nbGVDaG9pY2VTdHJhdGVneSgpXSxcbiAgICAgIFsnYXBwcm92YWwnLCBuZXcgQXBwcm92YWxTdHJhdGVneSgpXSxcbiAgICAgIFsncmFua2VkJywgbmV3IFJhbmtlZFN0cmF0ZWd5KCldLFxuICAgICAgWydyYW5rZWQtY2hvaWNlJywgbmV3IFJhbmtlZFN0cmF0ZWd5KCldLFxuICAgICAgWydxdWFkcmF0aWMnLCBuZXcgUXVhZHJhdGljU3RyYXRlZ3koKV0sXG4gICAgICBbJ3JhbmdlJywgbmV3IFJhbmdlU3RyYXRlZ3koKV1cbiAgICBdKTtcblxuICAgIGRldkxvZygnVm90ZUVuZ2luZSBpbml0aWFsaXplZCB3aXRoIHN0cmF0ZWdpZXM6JywgQXJyYXkuZnJvbSh0aGlzLnN0cmF0ZWdpZXMua2V5cygpKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBhcHByb3ByaWF0ZSB2b3Rpbmcgc3RyYXRlZ3kgZm9yIGEgcG9sbFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRTdHJhdGVneShtZXRob2Q6IFZvdGluZ01ldGhvZCk6IFZvdGluZ1N0cmF0ZWd5IHtcbiAgICBkZXZMb2coJ0xvb2tpbmcgdXAgc3RyYXRlZ3kgZm9yIG1ldGhvZDonLCBtZXRob2QpO1xuICAgIGRldkxvZygnQXZhaWxhYmxlIHN0cmF0ZWdpZXM6JywgQXJyYXkuZnJvbSh0aGlzLnN0cmF0ZWdpZXMua2V5cygpKSk7XG4gICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLnN0cmF0ZWdpZXMuZ2V0KG1ldGhvZCk7XG4gICAgaWYgKCFzdHJhdGVneSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCB2b3RpbmcgbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmF0ZWd5O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB2b3Rpbmcgc3RyYXRlZ3kgKHB1YmxpYyBtZXRob2QgZm9yIHRlc3RpbmcpXG4gICAqL1xuICBnZXRWb3RpbmdTdHJhdGVneShtZXRob2Q6IFZvdGluZ01ldGhvZCk6IFZvdGluZ1N0cmF0ZWd5IHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHJhdGVneShtZXRob2QpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNhdmUgdm90ZSB0byBkYXRhYmFzZSAoZm9yIHRlc3RpbmcpXG4gICAqL1xuICBhc3luYyBzYXZlVm90ZSh2b3RlRGF0YTogVm90ZURhdGEsIHBvbGxJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIGZvciB0ZXN0aW5nXG4gICAgY29uc3Qgdm90ZUlkID0gYHZvdGVfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICAgIGRldkxvZygnVm90ZSBzYXZlZCB0byBkYXRhYmFzZScsIHsgdm90ZUlkLCBwb2xsSWQgfSk7XG4gICAgcmV0dXJuIHZvdGVJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhIHZvdGUgcmVxdWVzdFxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVWb3RlKHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IFByb21pc2U8Vm90ZVZhbGlkYXRpb24+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBCYXNpYyB2YWxpZGF0aW9uXG4gICAgICBpZiAoIXJlcXVlc3QucG9sbElkIHx8ICFyZXF1ZXN0LnZvdGVEYXRhKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yczogWydNaXNzaW5nIHJlcXVpcmVkIHZvdGUgZGF0YSddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcG9sbCBJRCBtaXNtYXRjaFxuICAgICAgaWYgKHJlcXVlc3QucG9sbElkICE9PSBwb2xsLmlkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yczogWydQb2xsIElEIG1pc21hdGNoJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBwb2xsIGV4aXN0cyBhbmQgaXMgYWN0aXZlXG4gICAgICBpZiAoIXBvbGwgfHwgcG9sbC5zdGF0dXMgIT09ICdhY3RpdmUnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yczogWydQb2xsIGlzIG5vdCBhY3RpdmUnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBvbGwgZW5kIHRpbWVcbiAgICAgIGlmIChwb2xsLmVuZFRpbWUgJiYgbmV3IERhdGUocG9sbC5lbmRUaW1lKSA8IG5ldyBEYXRlKCkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3JzOiBbJ1BvbGwgaGFzIGVuZGVkJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBhdXRoZW50aWNhdGlvbiByZXF1aXJlbWVudHNcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24gJiYgIXJlcXVlc3QudXNlcklkICYmICFwb2xsLnNldHRpbmdzPy5hbm9ueW1vdXNWb3RpbmcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3JzOiBbJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIHZvdGUnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0cnVlLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSB2b3RlIG9wdGlvbnNcbiAgICAgIGNvbnN0IG9wdGlvblZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlVm90ZU9wdGlvbnMocmVxdWVzdC52b3RlRGF0YSwgcG9sbCk7XG4gICAgICBpZiAoIW9wdGlvblZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvblZhbGlkYXRpb247XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHJhdGUgbGltaXRpbmdcbiAgICAgIGlmIChyZXF1ZXN0LnVzZXJJZCkge1xuICAgICAgICBjb25zdCByYXRlTGltaXRLZXkgPSBgJHtyZXF1ZXN0LnVzZXJJZH06JHtyZXF1ZXN0LnBvbGxJZH1gO1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCByYXRlTGltaXREYXRhID0gdGhpcy5yYXRlTGltaXRUcmFja2VyLmdldChyYXRlTGltaXRLZXkpO1xuICAgICAgICBcbiAgICAgICAgaWYgKHJhdGVMaW1pdERhdGEpIHtcbiAgICAgICAgICBpZiAobm93IDwgcmF0ZUxpbWl0RGF0YS5yZXNldFRpbWUpIHtcbiAgICAgICAgICAgIC8vIFN0aWxsIHdpdGhpbiB0aGUgcmF0ZSBsaW1pdCB3aW5kb3dcbiAgICAgICAgICAgIGlmIChyYXRlTGltaXREYXRhLmNvdW50ID49IHRoaXMuY29uZmlnLnJhdGVMaW1pdFBlclVzZXIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBbJ1JhdGUgbGltaXQgZXhjZWVkZWQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJ10sXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBXaW5kb3cgaGFzIGV4cGlyZWQsIHJlc2V0IHRoZSBjb3VudGVyXG4gICAgICAgICAgICByYXRlTGltaXREYXRhLmNvdW50ID0gMDtcbiAgICAgICAgICAgIHJhdGVMaW1pdERhdGEucmVzZXRUaW1lID0gbm93ICsgdGhpcy5jb25maWcucmF0ZUxpbWl0V2luZG93TXM7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEluaXRpYWxpemUgcmF0ZSBsaW1pdCB0cmFja2luZ1xuICAgICAgICAgIHRoaXMucmF0ZUxpbWl0VHJhY2tlci5zZXQocmF0ZUxpbWl0S2V5LCB7XG4gICAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICAgIHJlc2V0VGltZTogbm93ICsgdGhpcy5jb25maWcucmF0ZUxpbWl0V2luZG93TXNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIGFwcHJvcHJpYXRlIHN0cmF0ZWd5IGFuZCB2YWxpZGF0ZSB0aGUgdm90ZVxuICAgICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLmdldFN0cmF0ZWd5KHBvbGwudm90aW5nTWV0aG9kKTtcbiAgICAgIGNvbnN0IHN0cmF0ZWd5VmFsaWRhdGlvbiA9IGF3YWl0IHN0cmF0ZWd5LnZhbGlkYXRlVm90ZShyZXF1ZXN0LCBwb2xsKTtcblxuICAgICAgaWYgKCFzdHJhdGVneVZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0cmF0ZWd5VmFsaWRhdGlvbiwge1xuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGRldkxvZygnVm90ZSB2YWxpZGF0aW9uIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXJJZCxcbiAgICAgICAgbWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgZHVyYXRpb246IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdWb3RlIHZhbGlkYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcnM6IFtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdWYWxpZGF0aW9uIGZhaWxlZCddLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBhIHZvdGVcbiAgICovXG4gIGFzeW5jIHByb2Nlc3NWb3RlKHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IFByb21pc2U8Vm90ZVJlc3BvbnNlPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gVmFsaWRhdGUgdGhlIHZvdGUgZmlyc3RcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnZhbGlkYXRlVm90ZShyZXF1ZXN0LCBwb2xsKTtcbiAgICAgIGlmICghdmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHZhbGlkYXRpb24uZXJyb3JzPy5bMF0gfHwgJ1ZvdGUgdmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgICAgIHJlc3BvbnNlVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIGFwcHJvcHJpYXRlIHN0cmF0ZWd5IGFuZCBwcm9jZXNzIHRoZSB2b3RlXG4gICAgICBjb25zdCBzdHJhdGVneSA9IHRoaXMuZ2V0U3RyYXRlZ3kocG9sbC52b3RpbmdNZXRob2QpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3RyYXRlZ3kucHJvY2Vzc1ZvdGUocmVxdWVzdCwgcG9sbCk7XG5cbiAgICAgIC8vIEluY3JlbWVudCByYXRlIGxpbWl0IGNvdW50ZXJcbiAgICAgIGlmIChyZXF1ZXN0LnVzZXJJZCkge1xuICAgICAgICBjb25zdCByYXRlTGltaXRLZXkgPSBgJHtyZXF1ZXN0LnVzZXJJZH06JHtyZXF1ZXN0LnBvbGxJZH1gO1xuICAgICAgICBjb25zdCByYXRlTGltaXREYXRhID0gdGhpcy5yYXRlTGltaXRUcmFja2VyLmdldChyYXRlTGltaXRLZXkpO1xuICAgICAgICBpZiAocmF0ZUxpbWl0RGF0YSkge1xuICAgICAgICAgIHJhdGVMaW1pdERhdGEuY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkZXZMb2coJ1ZvdGUgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseScsIHtcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXJJZCxcbiAgICAgICAgbWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgdm90ZUlkOiByZXN1bHQudm90ZUlkLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRldkxvZygnVm90ZSBwcm9jZXNzaW5nIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdWb3RlIHByb2Nlc3NpbmcgZmFpbGVkJyxcbiAgICAgICAgICBwb2xsSWQ6IHJlcXVlc3QucG9sbElkLFxuICAgICAgICAgIHJlc3BvbnNlVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHJlc3VsdHMgZm9yIGEgcG9sbFxuICAgKi9cbiAgYXN5bmMgY2FsY3VsYXRlUmVzdWx0cyhwb2xsOiBQb2xsRGF0YSwgdm90ZXM6IFZvdGVEYXRhW10pOiBQcm9taXNlPFJlc3VsdHNEYXRhPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gSGFuZGxlIGVtcHR5IHZvdGUgc2V0c1xuICAgICAgaWYgKHZvdGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHBvbGxJZDogcG9sbC5pZCxcbiAgICAgICAgICB2b3RpbmdNZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICAgIHRvdGFsVm90ZXM6IDAsXG4gICAgICAgICAgcGFydGljaXBhdGlvblJhdGU6IDAsXG4gICAgICAgICAgcmVzdWx0czoge1xuICAgICAgICAgICAgd2lubmVyOiBudWxsLFxuICAgICAgICAgICAgd2lubmVyVm90ZXM6IDAsXG4gICAgICAgICAgICB3aW5uZXJQZXJjZW50YWdlOiAwLFxuICAgICAgICAgICAgb3B0aW9uVm90ZXM6IHBvbGwub3B0aW9ucy5yZWR1Y2UoKGFjYywgb3B0aW9uKSA9PiB7XG4gICAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gMDtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pLFxuICAgICAgICAgICAgb3B0aW9uUGVyY2VudGFnZXM6IHBvbGwub3B0aW9ucy5yZWR1Y2UoKGFjYywgb3B0aW9uKSA9PiB7XG4gICAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gMDtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pLFxuICAgICAgICAgICAgYWJzdGVudGlvbnM6IDAsXG4gICAgICAgICAgICBhYnN0ZW50aW9uUGVyY2VudGFnZTogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2FsY3VsYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGNhbGN1bGF0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICAgIGlzRW1wdHk6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneShwb2xsLnZvdGluZ01ldGhvZCk7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgc3RyYXRlZ3kuY2FsY3VsYXRlUmVzdWx0cyhwb2xsLCB2b3Rlcyk7XG5cbiAgICAgIGRldkxvZygnUmVzdWx0cyBjYWxjdWxhdGVkIHN1Y2Nlc3NmdWxseScsIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICBtZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICB0b3RhbFZvdGVzOiB2b3Rlcy5sZW5ndGgsXG4gICAgICAgIGR1cmF0aW9uOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdSZXN1bHRzIGNhbGN1bGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgLy8gUmV0dXJuIGEgYmFzaWMgcmVzdWx0cyBzdHJ1Y3R1cmUgZm9yIHVuc3VwcG9ydGVkIG1ldGhvZHNcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvbGxJZDogcG9sbC5pZCxcbiAgICAgICAgdm90aW5nTWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgdG90YWxWb3Rlczogdm90ZXMubGVuZ3RoLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uUmF0ZTogdm90ZXMubGVuZ3RoIC8gMTAwLCAvLyBNb2NrIHBhcnRpY2lwYXRpb24gcmF0ZVxuICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgd2lubmVyOiB2b3Rlcy5sZW5ndGggPiAwID8gcG9sbC5vcHRpb25zWzBdPy5pZCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICB3aW5uZXJWb3Rlczogdm90ZXMubGVuZ3RoLFxuICAgICAgICAgIHdpbm5lclBlcmNlbnRhZ2U6IDEwMCxcbiAgICAgICAgICBvcHRpb25Wb3RlczogcG9sbC5vcHRpb25zLnJlZHVjZSgoYWNjLCBvcHRpb24pID0+IHtcbiAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gdm90ZXMubGVuZ3RoO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSxcbiAgICAgICAgICBvcHRpb25QZXJjZW50YWdlczogcG9sbC5vcHRpb25zLnJlZHVjZSgoYWNjLCBvcHRpb24pID0+IHtcbiAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gMTAwO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSxcbiAgICAgICAgICBhYnN0ZW50aW9uczogMCxcbiAgICAgICAgICBhYnN0ZW50aW9uUGVyY2VudGFnZTogMFxuICAgICAgICB9LFxuICAgICAgICBjYWxjdWxhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBjYWxjdWxhdGlvblRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHZvdGUgb3B0aW9ucyBhZ2FpbnN0IHBvbGwgb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZVZvdGVPcHRpb25zKHZvdGVEYXRhOiBWb3RlUmVxdWVzdFsndm90ZURhdGEnXSwgcG9sbDogUG9sbERhdGEpOiBWb3RlVmFsaWRhdGlvbiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHZvdGUgZGF0YSBpcyB2YWxpZFxuICAgICAgaWYgKCF2b3RlRGF0YSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcnM6IFsnVm90ZSBkYXRhIGlzIHJlcXVpcmVkJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBiYXNlZCBvbiB2b3RpbmcgbWV0aG9kXG4gICAgICBzd2l0Y2ggKHBvbGwudm90aW5nTWV0aG9kKSB7XG4gICAgICAgIGNhc2UgJ3NpbmdsZSc6XG4gICAgICAgICAgaWYgKHR5cGVvZiB2b3RlRGF0YS5jaG9pY2UgIT09ICdudW1iZXInIHx8IHZvdGVEYXRhLmNob2ljZSA8IDAgfHwgdm90ZURhdGEuY2hvaWNlID49IHBvbGwub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ0ludmFsaWQgb3B0aW9uIHNlbGVjdGVkJ10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ2FwcHJvdmFsJzpcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodm90ZURhdGEuYXBwcm92YWxzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcnM6IFsnQXBwcm92YWwgdm90ZXMgbXVzdCBiZSBhbiBhcnJheSddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCBhcHByb3ZhbCBvZiB2b3RlRGF0YS5hcHByb3ZhbHMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXBwcm92YWwgIT09ICdudW1iZXInIHx8IGFwcHJvdmFsIDwgMCB8fCBhcHByb3ZhbCA+PSBwb2xsLm9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yczogWydJbnZhbGlkIG9wdGlvbiBzZWxlY3RlZCddLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBjYXNlICdyYW5rZWQnOlxuICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2b3RlRGF0YS5yYW5raW5ncykpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ1JhbmtpbmdzIG11c3QgYmUgYW4gYXJyYXknXSxcbiAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgcmFua2luZyBvZiB2b3RlRGF0YS5yYW5raW5ncykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByYW5raW5nICE9PSAnbnVtYmVyJyB8fCByYW5raW5nIDwgMCB8fCByYW5raW5nID49IHBvbGwub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBbJ0ludmFsaWQgb3B0aW9uIHNlbGVjdGVkJ10sXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ3F1YWRyYXRpYyc6XG4gICAgICAgICAgaWYgKCF2b3RlRGF0YS5hbGxvY2F0aW9ucyB8fCB0eXBlb2Ygdm90ZURhdGEuYWxsb2NhdGlvbnMgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yczogWydRdWFkcmF0aWMgdm90aW5nIHJlcXVpcmVzIGFsbG9jYXRpb25zJ10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ3JhbmdlJzpcbiAgICAgICAgICBpZiAoIXZvdGVEYXRhLnJhdGluZ3MgfHwgdHlwZW9mIHZvdGVEYXRhLnJhdGluZ3MgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yczogWydSYW5nZSB2b3RpbmcgcmVxdWlyZXMgcmF0aW5ncyddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcnM6IFsnVW5zdXBwb3J0ZWQgdm90aW5nIG1ldGhvZCddLFxuICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3JzOiBbJ1ZvdGUgdmFsaWRhdGlvbiBlcnJvciddLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZvdGluZyBtZXRob2QgY29uZmlndXJhdGlvblxuICAgKi9cbiAgZ2V0Vm90aW5nTWV0aG9kQ29uZmlnKG1ldGhvZDogVm90aW5nTWV0aG9kKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneShtZXRob2QpO1xuICAgIHJldHVybiBzdHJhdGVneS5nZXRDb25maWd1cmF0aW9uKCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGVuZ2luZSBjb25maWd1cmF0aW9uXG4gICAqL1xuICB1cGRhdGVDb25maWcobmV3Q29uZmlnOiBQYXJ0aWFsPFZvdGVFbmdpbmVDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbmZpZywgbmV3Q29uZmlnKTtcbiAgICBkZXZMb2coJ1ZvdGVFbmdpbmUgY29uZmlndXJhdGlvbiB1cGRhdGVkOicsIHRoaXMuY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogVm90ZUVuZ2luZUNvbmZpZyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcbiAgfVxufVxuXG4vLyBFeHBvcnQgYSBkZWZhdWx0IGluc3RhbmNlXG5leHBvcnQgY29uc3Qgdm90ZUVuZ2luZSA9IG5ldyBWb3RlRW5naW5lKCk7XG4iXSwibmFtZXMiOlsiVm90ZUVuZ2luZSIsInZvdGVFbmdpbmUiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsIk9iamVjdCIsImFzc2lnbiIsIm1heFZvdGVzUGVyUG9sbCIsImFsbG93TXVsdGlwbGVWb3RlcyIsInJlcXVpcmVBdXRoZW50aWNhdGlvbiIsIm1pblRydXN0VGllciIsInJhdGVMaW1pdFBlclVzZXIiLCJyYXRlTGltaXRXaW5kb3dNcyIsInJhdGVMaW1pdFRyYWNrZXIiLCJNYXAiLCJzdHJhdGVnaWVzIiwiU2luZ2xlQ2hvaWNlU3RyYXRlZ3kiLCJBcHByb3ZhbFN0cmF0ZWd5IiwiUmFua2VkU3RyYXRlZ3kiLCJRdWFkcmF0aWNTdHJhdGVneSIsIlJhbmdlU3RyYXRlZ3kiLCJkZXZMb2ciLCJBcnJheSIsImZyb20iLCJrZXlzIiwiZ2V0U3RyYXRlZ3kiLCJtZXRob2QiLCJzdHJhdGVneSIsImdldCIsIkVycm9yIiwiZ2V0Vm90aW5nU3RyYXRlZ3kiLCJzYXZlVm90ZSIsInZvdGVEYXRhIiwicG9sbElkIiwidm90ZUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInZhbGlkYXRlVm90ZSIsInJlcXVlc3QiLCJwb2xsIiwic3RhcnRUaW1lIiwidmFsaWQiLCJlcnJvcnMiLCJyZXF1aXJlc0F1dGhlbnRpY2F0aW9uIiwicmVxdWlyZXNUb2tlbnMiLCJpZCIsInN0YXR1cyIsImVuZFRpbWUiLCJ1c2VySWQiLCJzZXR0aW5ncyIsImFub255bW91c1ZvdGluZyIsIm9wdGlvblZhbGlkYXRpb24iLCJ2YWxpZGF0ZVZvdGVPcHRpb25zIiwicmF0ZUxpbWl0S2V5IiwicmF0ZUxpbWl0RGF0YSIsInJlc2V0VGltZSIsImNvdW50Iiwic2V0Iiwidm90aW5nTWV0aG9kIiwic3RyYXRlZ3lWYWxpZGF0aW9uIiwiZHVyYXRpb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJwcm9jZXNzVm90ZSIsInZhbGlkYXRpb24iLCJzdWNjZXNzIiwicmVzcG9uc2VUaW1lIiwicmVzdWx0IiwiY2FsY3VsYXRlUmVzdWx0cyIsInZvdGVzIiwibGVuZ3RoIiwidG90YWxWb3RlcyIsInBhcnRpY2lwYXRpb25SYXRlIiwicmVzdWx0cyIsIndpbm5lciIsIndpbm5lclZvdGVzIiwid2lubmVyUGVyY2VudGFnZSIsIm9wdGlvblZvdGVzIiwib3B0aW9ucyIsInJlZHVjZSIsImFjYyIsIm9wdGlvbiIsIm9wdGlvblBlcmNlbnRhZ2VzIiwiYWJzdGVudGlvbnMiLCJhYnN0ZW50aW9uUGVyY2VudGFnZSIsImNhbGN1bGF0ZWRBdCIsInRvSVNPU3RyaW5nIiwibWV0YWRhdGEiLCJjYWxjdWxhdGlvblRpbWUiLCJpc0VtcHR5IiwidW5kZWZpbmVkIiwiY2hvaWNlIiwiaXNBcnJheSIsImFwcHJvdmFscyIsImFwcHJvdmFsIiwicmFua2luZ3MiLCJyYW5raW5nIiwiYWxsb2NhdGlvbnMiLCJyYXRpbmdzIiwiZ2V0Vm90aW5nTWV0aG9kQ29uZmlnIiwiZ2V0Q29uZmlndXJhdGlvbiIsInVwZGF0ZUNvbmZpZyIsIm5ld0NvbmZpZyIsImdldENvbmZpZyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0NBUUM7Ozs7Ozs7Ozs7O0lBOEJZQSxVQUFVO2VBQVZBOztJQXVkQUMsVUFBVTtlQUFWQTs7O3dCQW5mVTswQkFHVTsyQkFDQzt1QkFDSjt3QkFDQzs4QkFDTTtBQXFCOUIsTUFBTUQ7SUFLWEUsWUFBWUMsU0FBb0MsQ0FBQyxDQUFDLENBQUU7UUFDbEQsSUFBSSxDQUFDQSxNQUFNLEdBQUdDLE9BQU9DLE1BQU0sQ0FBQztZQUMxQkMsaUJBQWlCO1lBQ2pCQyxvQkFBb0I7WUFDcEJDLHVCQUF1QjtZQUN2QkMsY0FBYztZQUNkQyxrQkFBa0I7WUFDbEJDLG1CQUFtQjtRQUNyQixHQUFHUjtRQUVILG1DQUFtQztRQUNuQyxJQUFJLENBQUNTLGdCQUFnQixHQUFHLElBQUlDO1FBRTVCLCtCQUEr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
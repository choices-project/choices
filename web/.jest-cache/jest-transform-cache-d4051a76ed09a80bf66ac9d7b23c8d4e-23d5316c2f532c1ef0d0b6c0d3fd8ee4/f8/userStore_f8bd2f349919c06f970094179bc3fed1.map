{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/stores/userStore.ts"],"sourcesContent":["/**\n * User Store - Zustand Implementation\n * \n * Centralized user state management including authentication, profile,\n * preferences, and settings. Consolidates AuthContext and user-related state.\n * \n * Created: October 10, 2025\n * Status: âœ… ACTIVE\n */\n\nimport type { User, Session } from '@supabase/supabase-js';\nimport { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { persist } from 'zustand/middleware';\nimport { immer } from 'zustand/middleware/immer';\n\nimport { withOptional } from '@/lib/utils/objects';\n\nimport type { UserProfile, BaseStore } from './types';\n\n// Profile editing types\nexport interface ProfileUpdateData {\n  displayname: string;\n  bio: string;\n  username: string;\n  primaryconcerns: string[];\n  communityfocus: string[];\n  participationstyle: 'observer' | 'participant' | 'leader' | 'organizer';\n  privacysettings: {\n    profile_visibility: 'public' | 'private' | 'friends';\n    show_email: boolean;\n    show_activity: boolean;\n    allow_messages: boolean;\n    share_demographics: boolean;\n    allow_analytics: boolean;\n  };\n}\n\nexport interface Representative {\n  id: string;\n  name: string;\n  title: string;\n  party: string;\n  district: string;\n  state: string;\n  phone?: string;\n  email?: string;\n  website?: string;\n  photo?: string;\n  socialMedia?: {\n    twitter?: string;\n    facebook?: string;\n    instagram?: string;\n  };\n}\n\n// User store state interface\ntype UserStore = {\n  // Authentication state\n  user: User | null;\n  session: Session | null;\n  isAuthenticated: boolean;\n  \n  // User profile data\n  profile: UserProfile | null;\n  \n  // Profile editing state\n  profileEditData: ProfileUpdateData | null;\n  isProfileEditing: boolean;\n  profileEditErrors: Record<string, string>;\n  \n  // Address and representatives\n  currentAddress: string;\n  currentState: string;\n  representatives: Representative[];\n  showAddressForm: boolean;\n  newAddress: string;\n  addressLoading: boolean;\n  savedSuccessfully: boolean;\n  \n  // Avatar editing\n  avatarFile: File | null;\n  avatarPreview: string | null;\n  isUploadingAvatar: boolean;\n  \n  // Biometric state\n  biometric: {\n    isSupported: boolean | null;\n    isAvailable: boolean | null;\n    hasCredentials: boolean | null;\n    isRegistering: boolean;\n    error: string | null;\n    success: boolean;\n  };\n  \n  // Loading states\n  isProfileLoading: boolean;\n  isUpdating: boolean;\n  \n  // Actions - Authentication\n  setUser: (user: User | null) => void;\n  setSession: (session: Session | null) => void;\n  setAuthenticated: (authenticated: boolean) => void;\n  setUserAndAuth: (user: User | null, authenticated: boolean) => void;\n  setSessionAndDerived: (session: Session | null) => void;\n  initializeAuth: (user: User | null, session: Session | null, authenticated: boolean) => void;\n  signOut: () => void;\n  clearUser: () => void;\n  \n  // Actions - Profile Editing\n  setProfileEditData: (data: ProfileUpdateData) => void;\n  updateProfileEditData: (updates: Partial<ProfileUpdateData>) => void;\n  updateProfileField: (field: keyof ProfileUpdateData, value: any) => void;\n  updateArrayField: (field: 'primaryconcerns' | 'communityfocus', value: string) => void;\n  updatePrivacySetting: (setting: keyof ProfileUpdateData['privacysettings'], value: any) => void;\n  setProfileEditing: (editing: boolean) => void;\n  setProfileEditError: (field: string, error: string) => void;\n  clearProfileEditError: (field: string) => void;\n  clearAllProfileEditErrors: () => void;\n  \n  // Actions - Address and Representatives\n  setCurrentAddress: (address: string) => void;\n  setCurrentState: (state: string) => void;\n  setRepresentatives: (representatives: Representative[]) => void;\n  addRepresentative: (representative: Representative) => void;\n  removeRepresentative: (id: string) => void;\n  setShowAddressForm: (show: boolean) => void;\n  setNewAddress: (address: string) => void;\n  setAddressLoading: (loading: boolean) => void;\n  setSavedSuccessfully: (saved: boolean) => void;\n  lookupAddress: (address: string) => Promise<Representative[]>;\n  handleAddressUpdate: (address: string) => Promise<void>;\n  \n  // Actions - Avatar\n  setAvatarFile: (file: File | null) => void;\n  setAvatarPreview: (preview: string | null) => void;\n  setUploadingAvatar: (uploading: boolean) => void;\n  clearAvatar: () => void;\n  \n  // Actions - Profile\n  setProfile: (profile: UserProfile | null) => void;\n  updateProfile: (updates: Partial<UserProfile>) => void;\n  updatePreferences: (preferences: Partial<UserProfile['preferences']>) => void;\n  updateSettings: (settings: Partial<UserProfile['settings']>) => void;\n  updateMetadata: (metadata: Partial<UserProfile['metadata']>) => void;\n  \n  // Actions - Biometric\n  setBiometricSupported: (supported: boolean) => void;\n  setBiometricAvailable: (available: boolean) => void;\n  setBiometricCredentials: (hasCredentials: boolean) => void;\n  setBiometricRegistering: (registering: boolean) => void;\n  setBiometricError: (error: string | null) => void;\n  setBiometricSuccess: (success: boolean) => void;\n  resetBiometric: () => void;\n  \n  // Actions - Loading states\n  setProfileLoading: (loading: boolean) => void;\n  setUpdating: (updating: boolean) => void;\n  \n  // Actions - Error handling\n  setUserError: (error: string | null) => void;\n  clearUserError: () => void;\n} & BaseStore\n\n// Create user store with middleware\nexport const useUserStore = create<UserStore>()(\n  devtools(\n    persist(\n      immer((set, _get) => ({\n      // Initial state\n      user: null,\n      session: null,\n      isAuthenticated: false,\n      profile: null,\n      \n      // Profile editing state\n      profileEditData: null,\n      isProfileEditing: false,\n      profileEditErrors: {},\n      \n      // Address and representatives\n      currentAddress: '',\n      currentState: '',\n      representatives: [],\n      showAddressForm: false,\n      newAddress: '',\n      addressLoading: false,\n      savedSuccessfully: false,\n      \n      // Avatar editing\n      avatarFile: null,\n      avatarPreview: null,\n      isUploadingAvatar: false,\n      \n      biometric: {\n        isSupported: null,\n        isAvailable: null,\n        hasCredentials: null,\n        isRegistering: false,\n        error: null,\n        success: false,\n      },\n      isLoading: false,\n      isProfileLoading: false,\n      isUpdating: false,\n      error: null,\n      \n      // Base store actions\n      setLoading: (loading) => set((state) => {\n        state.isLoading = loading;\n      }),\n      \n      setError: (error) => set((state) => {\n        state.error = error;\n      }),\n      \n      clearError: () => set((state) => {\n        state.error = null;\n      }),\n      \n      // Authentication actions - Fixed architecture to prevent infinite loops\n      setUser: (user) => set((state) => {\n        // Only update if the user is actually different\n        if (state.user !== user) {\n          state.user = user;\n          // Don't automatically set isAuthenticated here to prevent cascading updates\n          // Let the calling code explicitly set authentication state\n        }\n      }),\n      \n      setSession: (session) => set((state) => {\n        // Only update session if it's actually different\n        if (state.session !== session) {\n          state.session = session;\n          // Don't automatically update user/authentication to prevent cascading updates\n          // Let the calling code explicitly manage these relationships\n        }\n      }),\n      \n      setAuthenticated: (authenticated) => set((state) => {\n        // Only update if the authentication state is actually different\n        if (state.isAuthenticated !== authenticated) {\n          state.isAuthenticated = authenticated;\n          \n          if (!authenticated) {\n            state.user = null;\n            state.session = null;\n            state.profile = null;\n          }\n        }\n      }),\n      \n      // New method to safely set user and authentication together\n      setUserAndAuth: (user, authenticated) => set((state) => {\n        const userChanged = state.user !== user;\n        const authChanged = state.isAuthenticated !== authenticated;\n        \n        if (userChanged || authChanged) {\n          state.user = user;\n          state.isAuthenticated = authenticated;\n          \n          // Clear related state if not authenticated\n          if (!authenticated) {\n            state.session = null;\n            state.profile = null;\n          }\n        }\n      }),\n      \n      // New method to safely set session and derived state together\n      setSessionAndDerived: (session) => set((state) => {\n        if (state.session !== session) {\n          state.session = session;\n          \n          // Only update derived state if session actually changed\n          const newUser = session?.user || null;\n          const newAuthenticated = !!newUser;\n          \n          if (state.user !== newUser) {\n            state.user = newUser;\n          }\n          if (state.isAuthenticated !== newAuthenticated) {\n            state.isAuthenticated = newAuthenticated;\n          }\n        }\n      }),\n      \n      // New method to safely initialize authentication state\n      initializeAuth: (user, session, authenticated) => set((state) => {\n        // Only update if any of the values are actually different\n        const userChanged = state.user !== user;\n        const sessionChanged = state.session !== session;\n        const authChanged = state.isAuthenticated !== authenticated;\n        \n        if (userChanged || sessionChanged || authChanged) {\n          state.user = user;\n          state.session = session;\n          state.isAuthenticated = authenticated;\n          \n          // Clear related state if not authenticated\n          if (!authenticated) {\n            state.profile = null;\n          }\n        }\n      }),\n      \n      signOut: () => set((state) => {\n        state.user = null;\n        state.session = null;\n        state.profile = null;\n        state.isAuthenticated = false;\n        state.error = null;\n        \n      }),\n      \n      clearUser: () => set((state) => {\n        state.user = null;\n        state.session = null;\n        state.profile = null;\n        state.isAuthenticated = false;\n        state.error = null;\n        state.isLoading = false;\n        state.isProfileLoading = false;\n        state.isUpdating = false;\n      }),\n      \n      // Profile actions\n      setProfile: (profile) => set((state) => {\n        state.profile = profile;\n        \n        if (profile) {\n        }\n      }),\n      \n      updateProfile: (updates) => set((state) => {\n        if (state.profile) {\n          state.profile = { ...state.profile, ...updates };\n          state.profile.metadata.updatedAt = new Date().toISOString();\n        }\n      }),\n      \n      updatePreferences: (preferences) => set((state) => {\n        if (state.profile) {\n          state.profile.preferences = { ...state.profile.preferences, ...preferences };\n          state.profile.metadata.updatedAt = new Date().toISOString();\n        }\n      }),\n      \n      updateSettings: (settings) => set((state) => {\n        if (state.profile) {\n          state.profile.settings = { ...state.profile.settings, ...settings };\n          state.profile.metadata.updatedAt = new Date().toISOString();\n        }\n      }),\n      \n      updateMetadata: (metadata) => set((state) => {\n        if (state.profile) {\n          state.profile.metadata = { ...state.profile.metadata, ...metadata };\n        }\n      }),\n      \n      // Loading state actions\n      setProfileLoading: (loading) => set((state) => {\n        state.isProfileLoading = loading;\n      }),\n      \n      setUpdating: (updating) => set((state) => {\n        state.isUpdating = updating;\n      }),\n      \n      // Biometric actions\n      setBiometricSupported: (supported) => set((state) => {\n        state.biometric.isSupported = supported;\n      }),\n      \n      setBiometricAvailable: (available) => set((state) => {\n        state.biometric.isAvailable = available;\n      }),\n      \n      setBiometricCredentials: (hasCredentials) => set((state) => {\n        state.biometric.hasCredentials = hasCredentials;\n      }),\n      \n      setBiometricRegistering: (registering) => set((state) => {\n        state.biometric.isRegistering = registering;\n      }),\n      \n      setBiometricError: (error) => set((state) => {\n        state.biometric.error = error;\n      }),\n      \n      setBiometricSuccess: (success) => set((state) => {\n        state.biometric.success = success;\n      }),\n      \n      resetBiometric: () => set((state) => {\n        state.biometric = {\n          isSupported: null,\n          isAvailable: null,\n          hasCredentials: null,\n          isRegistering: false,\n          error: null,\n          success: false,\n        };\n      }),\n      \n      // Profile editing actions\n      setProfileEditData: (data) => set((state) => {\n        state.profileEditData = data;\n      }),\n      \n      updateProfileEditData: (updates) => set((state) => {\n        if (state.profileEditData) {\n          state.profileEditData = { ...state.profileEditData, ...updates };\n        }\n      }),\n      \n      updateProfileField: (field, value) => set((state) => {\n        if (state.profileEditData) {\n          state.profileEditData[field] = value;\n        }\n      }),\n      \n      updateArrayField: (field, value) => set((state) => {\n        if (state.profileEditData) {\n          const currentArray = state.profileEditData[field] || [];\n          const newArray = currentArray.includes(value)\n            ? currentArray.filter(item => item !== value)\n            : [...currentArray, value];\n          state.profileEditData[field] = newArray;\n        }\n      }),\n      \n      updatePrivacySetting: (setting, value) => set((state) => {\n        if (state.profileEditData) {\n          (state.profileEditData.privacysettings as any)[setting] = value;\n        }\n      }),\n      \n      setProfileEditing: (editing) => set((state) => {\n        state.isProfileEditing = editing;\n      }),\n      \n      setProfileEditError: (field, error) => set((state) => {\n        state.profileEditErrors[field] = error;\n      }),\n      \n      clearProfileEditError: (field) => set((state) => {\n        delete state.profileEditErrors[field];\n      }),\n      \n      clearAllProfileEditErrors: () => set((state) => {\n        state.profileEditErrors = {};\n      }),\n      \n      // Address and representatives actions\n      setCurrentAddress: (address) => set((state) => {\n        state.currentAddress = address;\n      }),\n      \n      setCurrentState: (stateValue) => set((state) => {\n        state.currentState = stateValue;\n      }),\n      \n      setRepresentatives: (representatives) => set((state) => {\n        state.representatives = representatives;\n      }),\n      \n      addRepresentative: (representative) => set((state) => {\n        const existingIndex = state.representatives.findIndex(rep => rep.id === representative.id);\n        if (existingIndex === -1) {\n          state.representatives.push(representative);\n        }\n      }),\n      \n      removeRepresentative: (id) => set((state) => {\n        state.representatives = state.representatives.filter(rep => rep.id !== id);\n      }),\n      \n      setShowAddressForm: (show) => set((state) => {\n        state.showAddressForm = show;\n      }),\n      \n      setNewAddress: (address) => set((state) => {\n        state.newAddress = address;\n      }),\n      \n      setAddressLoading: (loading) => set((state) => {\n        state.addressLoading = loading;\n      }),\n      \n      setSavedSuccessfully: (saved) => set((state) => {\n        state.savedSuccessfully = saved;\n      }),\n      \n      lookupAddress: async (address) => {\n        try {\n          const response = await fetch(`/api/civics/by-address?address=${encodeURIComponent(address)}`);\n          if (!response.ok) {\n            throw new Error('Address lookup failed');\n          }\n          const result = await response.json();\n          return result.data || [];\n        } catch (error) {\n          console.error('Address lookup failed:', error);\n          throw error;\n        }\n      },\n      \n      handleAddressUpdate: async (address) => {\n        const currentState = _get();\n        set((state) => {\n          state.addressLoading = true;\n        });\n        \n        try {\n          const representatives = await currentState.lookupAddress(address);\n          \n          set((state) => {\n            state.currentAddress = address;\n            state.representatives = representatives;\n            state.showAddressForm = false;\n            state.newAddress = '';\n            state.savedSuccessfully = true;\n            state.addressLoading = false;\n          });\n          \n          // Clear success message after 3 seconds\n          setTimeout(() => {\n            set((state) => {\n              state.savedSuccessfully = false;\n            });\n          }, 3000);\n          \n        } catch (error) {\n          console.error('Address update failed:', error);\n          set((state) => {\n            state.addressLoading = false;\n            state.savedSuccessfully = false;\n          });\n          throw error;\n        }\n      },\n      \n      // Avatar actions\n      setAvatarFile: (file) => set((state) => {\n        state.avatarFile = file;\n      }),\n      \n      setAvatarPreview: (preview) => set((state) => {\n        state.avatarPreview = preview;\n      }),\n      \n      setUploadingAvatar: (uploading) => set((state) => {\n        state.isUploadingAvatar = uploading;\n      }),\n      \n      clearAvatar: () => set((state) => {\n        state.avatarFile = null;\n        state.avatarPreview = null;\n      }),\n      \n      // Error handling actions\n      setUserError: (error) => set((state) => {\n        state.error = error;\n        \n        if (error) {\n          console.error('User store error:', error);\n        }\n      }),\n      \n      clearUserError: () => set((state) => {\n        state.error = null;\n      }),\n    })),\n    {\n      name: 'user-store',\n      partialize: (state) => ({\n        profile: state.profile,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  ),\n  { name: 'user-store' }\n));\n\n// Store selectors for optimized re-renders\nexport const useUser = () => useUserStore(state => state.user);\nexport const useSession = () => useUserStore(state => state.session);\nexport const useIsAuthenticated = () => useUserStore(state => state.isAuthenticated);\nexport const useUserProfile = () => useUserStore(state => state.profile);\nexport const useUserPreferences = () => useUserStore(state => state.profile?.preferences);\nexport const useUserSettings = () => useUserStore(state => state.profile?.settings);\nexport const useUserLoading = () => useUserStore(state => state.isLoading);\nexport const useUserError = () => useUserStore(state => state.error);\n\n// Biometric selectors\nexport const useBiometric = () => useUserStore(state => state.biometric);\nexport const useBiometricSupported = () => useUserStore(state => state.biometric.isSupported);\nexport const useBiometricAvailable = () => useUserStore(state => state.biometric.isAvailable);\nexport const useBiometricCredentials = () => useUserStore(state => state.biometric.hasCredentials);\nexport const useBiometricRegistering = () => useUserStore(state => state.biometric.isRegistering);\nexport const useBiometricError = () => useUserStore(state => state.biometric.error);\nexport const useBiometricSuccess = () => useUserStore(state => state.biometric.success);\n\n// Action selectors - FIXED: Use individual selectors to prevent infinite re-renders\nexport const useUserActions = () => {\n  const setUser = useUserStore(state => state.setUser);\n  const setSession = useUserStore(state => state.setSession);\n  const setAuthenticated = useUserStore(state => state.setAuthenticated);\n  const signOut = useUserStore(state => state.signOut);\n  const clearUser = useUserStore(state => state.clearUser);\n  const setProfile = useUserStore(state => state.setProfile);\n  const updateProfile = useUserStore(state => state.updateProfile);\n  const updatePreferences = useUserStore(state => state.updatePreferences);\n  const updateSettings = useUserStore(state => state.updateSettings);\n  const updateMetadata = useUserStore(state => state.updateMetadata);\n  const setProfileLoading = useUserStore(state => state.setProfileLoading);\n  const setUpdating = useUserStore(state => state.setUpdating);\n  const setUserError = useUserStore(state => state.setUserError);\n  const clearUserError = useUserStore(state => state.clearUserError);\n  const setBiometricSupported = useUserStore(state => state.setBiometricSupported);\n  const setBiometricAvailable = useUserStore(state => state.setBiometricAvailable);\n  const setBiometricCredentials = useUserStore(state => state.setBiometricCredentials);\n  const setBiometricRegistering = useUserStore(state => state.setBiometricRegistering);\n  const setBiometricError = useUserStore(state => state.setBiometricError);\n  const setBiometricSuccess = useUserStore(state => state.setBiometricSuccess);\n  const resetBiometric = useUserStore(state => state.resetBiometric);\n  // Profile editing actions\n  const setProfileEditData = useUserStore(state => state.setProfileEditData);\n  const updateProfileEditData = useUserStore(state => state.updateProfileEditData);\n  const updateProfileField = useUserStore(state => state.updateProfileField);\n  const updateArrayField = useUserStore(state => state.updateArrayField);\n  const updatePrivacySetting = useUserStore(state => state.updatePrivacySetting);\n  const setProfileEditing = useUserStore(state => state.setProfileEditing);\n  const setProfileEditError = useUserStore(state => state.setProfileEditError);\n  const clearProfileEditError = useUserStore(state => state.clearProfileEditError);\n  const clearAllProfileEditErrors = useUserStore(state => state.clearAllProfileEditErrors);\n  // Address and representatives actions\n  const setCurrentAddress = useUserStore(state => state.setCurrentAddress);\n  const setCurrentState = useUserStore(state => state.setCurrentState);\n  const setRepresentatives = useUserStore(state => state.setRepresentatives);\n  const addRepresentative = useUserStore(state => state.addRepresentative);\n  const removeRepresentative = useUserStore(state => state.removeRepresentative);\n  const setShowAddressForm = useUserStore(state => state.setShowAddressForm);\n  const setNewAddress = useUserStore(state => state.setNewAddress);\n  const setAddressLoading = useUserStore(state => state.setAddressLoading);\n  const setSavedSuccessfully = useUserStore(state => state.setSavedSuccessfully);\n  const lookupAddress = useUserStore(state => state.lookupAddress);\n  const handleAddressUpdate = useUserStore(state => state.handleAddressUpdate);\n  // Avatar actions\n  const setAvatarFile = useUserStore(state => state.setAvatarFile);\n  const setAvatarPreview = useUserStore(state => state.setAvatarPreview);\n  const setUploadingAvatar = useUserStore(state => state.setUploadingAvatar);\n  const clearAvatar = useUserStore(state => state.clearAvatar);\n  \n  return {\n    setUser,\n    setSession,\n    setAuthenticated,\n    signOut,\n    clearUser,\n    setProfile,\n    updateProfile,\n    updatePreferences,\n    updateSettings,\n    updateMetadata,\n    setProfileLoading,\n    setUpdating,\n    setUserError,\n    clearUserError,\n    setBiometricSupported,\n    setBiometricAvailable,\n    setBiometricCredentials,\n    setBiometricRegistering,\n    setBiometricError,\n    setBiometricSuccess,\n    resetBiometric,\n    setProfileEditData,\n    updateProfileEditData,\n    updateProfileField,\n    updateArrayField,\n    updatePrivacySetting,\n    setProfileEditing,\n    setProfileEditError,\n    clearProfileEditError,\n    clearAllProfileEditErrors,\n    setCurrentAddress,\n    setCurrentState,\n    setRepresentatives,\n    addRepresentative,\n    removeRepresentative,\n    setShowAddressForm,\n    setNewAddress,\n    setAddressLoading,\n    setSavedSuccessfully,\n    lookupAddress,\n    handleAddressUpdate,\n    setAvatarFile,\n    setAvatarPreview,\n    setUploadingAvatar,\n    clearAvatar,\n  };\n};\n\n// Computed selectors\nexport const useUserDisplayName = () => useUserStore(state => {\n  if (state.profile?.username) return state.profile.username;\n  if (state.user?.user_metadata?.full_name) return state.user.user_metadata.full_name;\n  if (state.user?.email) return state.user.email.split('@')[0];\n  return 'User';\n});\n\nexport const useUserAvatar = () => useUserStore(state => {\n  if (state.profile?.avatar) return state.profile.avatar;\n  if (state.user?.user_metadata?.avatar_url) return state.user.user_metadata.avatar_url;\n  return null;\n});\n\nexport const useUserTheme = () => useUserStore(state => {\n  return state.profile?.preferences?.theme || 'system';\n});\n\nexport const useUserNotifications = () => useUserStore(state => {\n  return state.profile?.preferences?.notifications ?? true;\n});\n\n// Profile editing selectors\nexport const useUserProfileEditData = () => useUserStore(state => state.profileEditData);\nexport const useUserIsProfileEditing = () => useUserStore(state => state.isProfileEditing);\nexport const useUserProfileEditErrors = () => useUserStore(state => state.profileEditErrors);\n\n// Address and representatives selectors\nexport const useUserCurrentAddress = () => useUserStore(state => state.currentAddress);\nexport const useUserCurrentState = () => useUserStore(state => state.currentState);\nexport const useUserRepresentatives = () => useUserStore(state => state.representatives);\nexport const useUserShowAddressForm = () => useUserStore(state => state.showAddressForm);\nexport const useUserNewAddress = () => useUserStore(state => state.newAddress);\nexport const useUserAddressLoading = () => useUserStore(state => state.addressLoading);\nexport const useUserSavedSuccessfully = () => useUserStore(state => state.savedSuccessfully);\n\n// Avatar selectors\nexport const useUserAvatarFile = () => useUserStore(state => state.avatarFile);\nexport const useUserAvatarPreview = () => useUserStore(state => state.avatarPreview);\nexport const useUserIsUploadingAvatar = () => useUserStore(state => state.isUploadingAvatar);\n\n// Store utilities\nexport const userStoreUtils = {\n  /**\n   * Check if user has specific preference\n   */\n  hasPreference: (preference: keyof UserProfile['preferences']) => {\n    const state = useUserStore.getState();\n    return state.profile?.preferences?.[preference] ?? false;\n  },\n  \n  /**\n   * Check if user has specific setting\n   */\n  hasSetting: (setting: keyof UserProfile['settings']) => {\n    const state = useUserStore.getState();\n    return state.profile?.settings?.[setting] ?? false;\n  },\n  \n  /**\n   * Get user's full profile with computed fields\n   */\n  getFullProfile: () => {\n    const state = useUserStore.getState();\n    if (!state.profile || !state.user) return null;\n    \n    return {\n      ...state.profile,\n      email: state.user.email,\n      id: state.user.id,\n      createdAt: state.user.created_at,\n      lastSignIn: state.user.last_sign_in_at,\n    };\n  },\n  \n  /**\n   * Check if user is admin\n   */\n  isAdmin: () => {\n    const state = useUserStore.getState();\n    return state.user?.user_metadata?.role === 'admin';\n  },\n  \n  /**\n   * Get user's display information\n   */\n  getDisplayInfo: () => {\n    const state = useUserStore.getState();\n    return {\n      name: state.profile?.username || state.user?.email?.split('@')[0] || 'User',\n      avatar: state.profile?.avatar || state.user?.user_metadata?.avatar_url,\n      email: state.user?.email,\n      theme: state.profile?.preferences?.theme || 'system',\n      notifications: state.profile?.preferences?.notifications ?? true,\n    };\n  }\n};\n\n// Store subscriptions for external integrations\nexport const userStoreSubscriptions = {\n  /**\n   * Subscribe to authentication changes\n   */\n  onAuthChange: (callback: (isAuthenticated: boolean, user: User | null) => void) => {\n    return useUserStore.subscribe(\n      (state, prevState) => {\n        const { isAuthenticated, user } = state;\n        const { isAuthenticated: prevIsAuthenticated, user: prevUser } = prevState;\n        if (isAuthenticated !== prevIsAuthenticated || user !== prevUser) {\n          callback(isAuthenticated, user);\n        }\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to profile changes\n   */\n  onProfileChange: (callback: (profile: UserProfile | null) => void) => {\n    return useUserStore.subscribe(\n      (state, prevState) => {\n        const { profile } = state;\n        const { profile: prevProfile } = prevState;\n        if (profile !== prevProfile) {\n          callback(profile);\n        }\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to preference changes\n   */\n  onPreferenceChange: (callback: (preferences: UserProfile['preferences']) => void) => {\n    return useUserStore.subscribe(\n      (state, prevState) => {\n        const preferences = state.profile?.preferences;\n        const prevPreferences = prevState.profile?.preferences;\n        if (preferences !== prevPreferences && preferences) {\n          callback(preferences);\n        }\n      }\n    );\n  }\n};\n\n// Store debugging utilities\nexport const userStoreDebug = {\n  /**\n   * Log current user state\n   */\n  logState: () => {\n    const state = useUserStore.getState();\n    // State logging removed for production\n  },\n  \n  /**\n   * Log user profile details\n   */\n  logProfile: () => {\n    const state = useUserStore.getState();\n    if (state.profile) {\n      // Profile logging removed for production\n    }\n  },\n  \n  /**\n   * Reset store to initial state\n   */\n  reset: () => {\n    useUserStore.getState().clearUser();\n  }\n};\n"],"names":["useBiometric","useBiometricAvailable","useBiometricCredentials","useBiometricError","useBiometricRegistering","useBiometricSuccess","useBiometricSupported","useIsAuthenticated","useSession","useUser","useUserActions","useUserAddressLoading","useUserAvatar","useUserAvatarFile","useUserAvatarPreview","useUserCurrentAddress","useUserCurrentState","useUserDisplayName","useUserError","useUserIsProfileEditing","useUserIsUploadingAvatar","useUserLoading","useUserNewAddress","useUserNotifications","useUserPreferences","useUserProfile","useUserProfileEditData","useUserProfileEditErrors","useUserRepresentatives","useUserSavedSuccessfully","useUserSettings","useUserShowAddressForm","useUserStore","useUserTheme","userStoreDebug","userStoreSubscriptions","userStoreUtils","create","devtools","persist","immer","set","_get","user","session","isAuthenticated","profile","profileEditData","isProfileEditing","profileEditErrors","currentAddress","currentState","representatives","showAddressForm","newAddress","addressLoading","savedSuccessfully","avatarFile","avatarPreview","isUploadingAvatar","biometric","isSupported","isAvailable","hasCredentials","isRegistering","error","success","isLoading","isProfileLoading","isUpdating","setLoading","loading","state","setError","clearError","setUser","setSession","setAuthenticated","authenticated","setUserAndAuth","userChanged","authChanged","setSessionAndDerived","newUser","newAuthenticated","initializeAuth","sessionChanged","signOut","clearUser","setProfile","updateProfile","updates","metadata","updatedAt","Date","toISOString","updatePreferences","preferences","updateSettings","settings","updateMetadata","setProfileLoading","setUpdating","updating","setBiometricSupported","supported","setBiometricAvailable","available","setBiometricCredentials","setBiometricRegistering","registering","setBiometricError","setBiometricSuccess","resetBiometric","setProfileEditData","data","updateProfileEditData","updateProfileField","field","value","updateArrayField","currentArray","newArray","includes","filter","item","updatePrivacySetting","setting","privacysettings","setProfileEditing","editing","setProfileEditError","clearProfileEditError","clearAllProfileEditErrors","setCurrentAddress","address","setCurrentState","stateValue","setRepresentatives","addRepresentative","representative","existingIndex","findIndex","rep","id","push","removeRepresentative","setShowAddressForm","show","setNewAddress","setAddressLoading","setSavedSuccessfully","saved","lookupAddress","response","fetch","encodeURIComponent","ok","Error","result","json","console","handleAddressUpdate","setTimeout","setAvatarFile","file","setAvatarPreview","preview","setUploadingAvatar","uploading","clearAvatar","setUserError","clearUserError","name","partialize","username","user_metadata","full_name","email","split","avatar","avatar_url","theme","notifications","hasPreference","preference","getState","hasSetting","getFullProfile","createdAt","created_at","lastSignIn","last_sign_in_at","isAdmin","role","getDisplayInfo","onAuthChange","callback","subscribe","prevState","prevIsAuthenticated","prevUser","onProfileChange","prevProfile","onPreferenceChange","prevPreferences","logState","logProfile","reset"],"mappings":"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"}
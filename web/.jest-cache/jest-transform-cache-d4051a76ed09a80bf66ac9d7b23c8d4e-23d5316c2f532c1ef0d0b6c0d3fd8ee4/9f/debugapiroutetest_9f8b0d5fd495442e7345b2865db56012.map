{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/debug-api-route.test.ts"],"sourcesContent":["/**\n * Debug API Route Test\n * \n * This test helps debug what's causing the 500 error in the API route\n */\n\nimport { describe, it, expect } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET } from '@/app/api/polls/route';\nimport { createClient } from '@supabase/supabase-js';\n\n// Set real Supabase credentials for integration testing\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://muqwrehywjrbaeerjgfb.supabase.co';\nprocess.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\nprocess.env.SUPABASE_SECRET_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\n\n// Mock getSupabaseServerClient to use real Supabase client\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(() => {\n    const supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SECRET_KEY!\n    );\n    return Promise.resolve(supabase);\n  })\n}));\n\ndescribe('Debug API Route', () => {\n  it('should debug the API route step by step', async () => {\n    console.log('=== DEBUGGING API ROUTE ===');\n    \n    try {\n      console.log('1. Creating NextRequest...');\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      console.log('✅ NextRequest created successfully');\n      \n      console.log('2. Calling GET function...');\n      const response = await GET(request);\n      console.log('✅ GET function completed');\n      \n      console.log('3. Getting response status...');\n      console.log('Response status:', response.status);\n      \n      console.log('4. Getting response data...');\n      const responseData = await response.json();\n      console.log('Response data:', JSON.stringify(responseData, null, 2));\n      \n      console.log('5. Checking response structure...');\n      console.log('Has success property:', responseData.hasOwnProperty('success'));\n      console.log('Has error property:', responseData.hasOwnProperty('error'));\n      \n      // For now, just check that we get some response\n      expect(response).toBeDefined();\n      expect(responseData).toBeDefined();\n      \n    } catch (error) {\n      console.error('❌ Error in API route:', error);\n      console.error('Error stack:', error.stack);\n      throw error;\n    }\n  });\n});\n"],"names":["jest","mock","getSupabaseServerClient","fn","supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SECRET_KEY","Promise","resolve","NEXT_PUBLIC_SUPABASE_ANON_KEY","describe","it","console","log","request","NextRequest","response","GET","status","responseData","json","JSON","stringify","hasOwnProperty","expect","toBeDefined","error","stack"],"mappings":"AAAA;;;;CAIC;AAYD,2DAA2D;AAC3DA,KAAKC,IAAI,CAAC,2BAA2B,IAAO,CAAA;QAC1CC,yBAAyBF,KAAKG,EAAE,CAAC;YAC/B,MAAMC,WAAWC,IAAAA,wBAAY,EAC3BC,QAAQC,GAAG,CAACC,wBAAwB,EACpCF,QAAQC,GAAG,CAACE,mBAAmB;YAEjC,OAAOC,QAAQC,OAAO,CAACP;QACzB;IACF,CAAA;;;;yBAnBqC;wBACT;uBACR;4BACS;AAE7B,wDAAwD;AACxDE,QAAQC,GAAG,CAACC,wBAAwB,GAAG;AACvCF,QAAQC,GAAG,CAACK,6BAA6B,GAAG;AAC5CN,QAAQC,GAAG,CAACE,mBAAmB,GAAG;AAalCI,IAAAA,iBAAQ,EAAC,mBAAmB;IAC1BC,IAAAA,WAAE,EAAC,2CAA2C;QAC5CC,QAAQC,GAAG,CAAC;QAEZ,IAAI;YACFD,QAAQC,GAAG,CAAC;YACZ,MAAMC,UAAU,IAAIC,mBAAW,CAAC;YAChCH,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZ,MAAMG,WAAW,MAAMC,IAAAA,UAAG,EAACH;YAC3BF,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,oBAAoBG,SAASE,MAAM;YAE/CN,QAAQC,GAAG,CAAC;YACZ,MAAMM,eAAe,MAAMH,SAASI,IAAI;YACxCR,QAAQC,GAAG,CAAC,kBAAkBQ,KAAKC,SAAS,CAACH,cAAc,MAAM;YAEjEP,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,yBAAyBM,aAAaI,cAAc,CAAC;YACjEX,QAAQC,GAAG,CAAC,uBAAuBM,aAAaI,cAAc,CAAC;YAE/D,gDAAgD;YAChDC,IAAAA,eAAM,EAACR,UAAUS,WAAW;YAC5BD,IAAAA,eAAM,EAACL,cAAcM,WAAW;QAElC,EAAE,OAAOC,OAAO;YACdd,QAAQc,KAAK,CAAC,yBAAyBA;YACvCd,QAAQc,KAAK,CAAC,gBAAgBA,MAAMC,KAAK;YACzC,MAAMD;QACR;IACF;AACF"}
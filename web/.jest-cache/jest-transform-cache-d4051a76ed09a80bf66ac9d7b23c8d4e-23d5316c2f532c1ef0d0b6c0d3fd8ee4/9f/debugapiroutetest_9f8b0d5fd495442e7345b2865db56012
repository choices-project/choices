7d6c969003d357644d07dd7ced3ad4ce
/**
 * Debug API Route Test
 * 
 * This test helps debug what's causing the 500 error in the API route
 */ "use strict";
// Mock getSupabaseServerClient to use real Supabase client
jest.mock("@/utils/supabase/server", ()=>({
        getSupabaseServerClient: jest.fn(()=>{
            const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SECRET_KEY);
            return Promise.resolve(supabase);
        })
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _server = require("next/server");
const _route = require("../../../../app/api/polls/route");
const _supabasejs = require("@supabase/supabase-js");
// Set real Supabase credentials for integration testing
process.env.NEXT_PUBLIC_SUPABASE_URL = "https://muqwrehywjrbaeerjgfb.supabase.co";
process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = "sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc";
process.env.SUPABASE_SECRET_KEY = "sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc";
(0, _globals.describe)("Debug API Route", ()=>{
    (0, _globals.it)("should debug the API route step by step", async ()=>{
        console.log("=== DEBUGGING API ROUTE ===");
        try {
            console.log("1. Creating NextRequest...");
            const request = new _server.NextRequest("http://localhost:3000/api/polls");
            console.log("✅ NextRequest created successfully");
            console.log("2. Calling GET function...");
            const response = await (0, _route.GET)(request);
            console.log("✅ GET function completed");
            console.log("3. Getting response status...");
            console.log("Response status:", response.status);
            console.log("4. Getting response data...");
            const responseData = await response.json();
            console.log("Response data:", JSON.stringify(responseData, null, 2));
            console.log("5. Checking response structure...");
            console.log("Has success property:", responseData.hasOwnProperty("success"));
            console.log("Has error property:", responseData.hasOwnProperty("error"));
            // For now, just check that we get some response
            (0, _globals.expect)(response).toBeDefined();
            (0, _globals.expect)(responseData).toBeDefined();
        } catch (error) {
            console.error("❌ Error in API route:", error);
            console.error("Error stack:", error.stack);
            throw error;
        }
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvYXBpL2RlYnVnLWFwaS1yb3V0ZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGVidWcgQVBJIFJvdXRlIFRlc3RcbiAqIFxuICogVGhpcyB0ZXN0IGhlbHBzIGRlYnVnIHdoYXQncyBjYXVzaW5nIHRoZSA1MDAgZXJyb3IgaW4gdGhlIEFQSSByb3V0ZVxuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IEdFVCB9IGZyb20gJ0AvYXBwL2FwaS9wb2xscy9yb3V0ZSc7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vLyBTZXQgcmVhbCBTdXBhYmFzZSBjcmVkZW50aWFscyBmb3IgaW50ZWdyYXRpb24gdGVzdGluZ1xucHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMID0gJ2h0dHBzOi8vbXVxd3JlaHl3anJiYWVlcmpnZmIuc3VwYWJhc2UuY28nO1xucHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgPSAnc2JfcHVibGlzaGFibGVfdEpPcEdPMklQanVqSkRRb3U0NFBfZ19CZ2JURkJmYyc7XG5wcm9jZXNzLmVudi5TVVBBQkFTRV9TRUNSRVRfS0VZID0gJ3NiX3B1Ymxpc2hhYmxlX3RKT3BHTzJJUGp1akpEUW91NDRQX2dfQmdiVEZCZmMnO1xuXG4vLyBNb2NrIGdldFN1cGFiYXNlU2VydmVyQ2xpZW50IHRvIHVzZSByZWFsIFN1cGFiYXNlIGNsaWVudFxuamVzdC5tb2NrKCdAL3V0aWxzL3N1cGFiYXNlL3NlcnZlcicsICgpID0+ICh7XG4gIGdldFN1cGFiYXNlU2VydmVyQ2xpZW50OiBqZXN0LmZuKCgpID0+IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRUNSRVRfS0VZIVxuICAgICk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzdXBhYmFzZSk7XG4gIH0pXG59KSk7XG5cbmRlc2NyaWJlKCdEZWJ1ZyBBUEkgUm91dGUnLCAoKSA9PiB7XG4gIGl0KCdzaG91bGQgZGVidWcgdGhlIEFQSSByb3V0ZSBzdGVwIGJ5IHN0ZXAnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coJz09PSBERUJVR0dJTkcgQVBJIFJPVVRFID09PScpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnMS4gQ3JlYXRpbmcgTmV4dFJlcXVlc3QuLi4nKTtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgTmV4dFJlcXVlc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvcG9sbHMnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgTmV4dFJlcXVlc3QgY3JlYXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJzIuIENhbGxpbmcgR0VUIGZ1bmN0aW9uLi4uJyk7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEdFVChyZXF1ZXN0KTtcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgR0VUIGZ1bmN0aW9uIGNvbXBsZXRlZCcpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnMy4gR2V0dGluZyByZXNwb25zZSBzdGF0dXMuLi4nKTtcbiAgICAgIGNvbnNvbGUubG9nKCdSZXNwb25zZSBzdGF0dXM6JywgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJzQuIEdldHRpbmcgcmVzcG9uc2UgZGF0YS4uLicpO1xuICAgICAgY29uc3QgcmVzcG9uc2VEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgY29uc29sZS5sb2coJ1Jlc3BvbnNlIGRhdGE6JywgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2VEYXRhLCBudWxsLCAyKSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCc1LiBDaGVja2luZyByZXNwb25zZSBzdHJ1Y3R1cmUuLi4nKTtcbiAgICAgIGNvbnNvbGUubG9nKCdIYXMgc3VjY2VzcyBwcm9wZXJ0eTonLCByZXNwb25zZURhdGEuaGFzT3duUHJvcGVydHkoJ3N1Y2Nlc3MnKSk7XG4gICAgICBjb25zb2xlLmxvZygnSGFzIGVycm9yIHByb3BlcnR5OicsIHJlc3BvbnNlRGF0YS5oYXNPd25Qcm9wZXJ0eSgnZXJyb3InKSk7XG4gICAgICBcbiAgICAgIC8vIEZvciBub3csIGp1c3QgY2hlY2sgdGhhdCB3ZSBnZXQgc29tZSByZXNwb25zZVxuICAgICAgZXhwZWN0KHJlc3BvbnNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YSkudG9CZURlZmluZWQoKTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgaW4gQVBJIHJvdXRlOicsIGVycm9yKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0YWNrOicsIGVycm9yLnN0YWNrKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImdldFN1cGFiYXNlU2VydmVyQ2xpZW50IiwiZm4iLCJzdXBhYmFzZSIsImNyZWF0ZUNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRUNSRVRfS0VZIiwiUHJvbWlzZSIsInJlc29sdmUiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImRlc2NyaWJlIiwiaXQiLCJjb25zb2xlIiwibG9nIiwicmVxdWVzdCIsIk5leHRSZXF1ZXN0IiwicmVzcG9uc2UiLCJHRVQiLCJzdGF0dXMiLCJyZXNwb25zZURhdGEiLCJqc29uIiwiSlNPTiIsInN0cmluZ2lmeSIsImhhc093blByb3BlcnR5IiwiZXhwZWN0IiwidG9CZURlZmluZWQiLCJlcnJvciIsInN0YWNrIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztDQUlDO0FBWUQsMkRBQTJEO0FBQzNEQSxLQUFLQyxJQUFJLENBQUMsMkJBQTJCLElBQU8sQ0FBQTtRQUMxQ0MseUJBQXlCRixLQUFLRyxFQUFFLENBQUM7WUFDL0IsTUFBTUMsV0FBV0MsSUFBQUEsd0JBQVksRUFDM0JDLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCLEVBQ3BDRixRQUFRQyxHQUFHLENBQUNFLG1CQUFtQjtZQUVqQyxPQUFPQyxRQUFRQyxPQUFPLENBQUNQO1FBQ3pCO0lBQ0YsQ0FBQTs7Ozt5QkFuQnFDO3dCQUNUO3VCQUNSOzRCQUNTO0FBRTdCLHdEQUF3RDtBQUN4REUsUUFBUUMsR0FBRyxDQUFDQyx3QkFBd0IsR0FBRztBQUN2Q0YsUUFBUUMsR0FBRyxDQUFDSyw2QkFBNkIsR0FBRztBQUM1Q04sUUFBUUMsR0FBRyxDQUFDRSxtQkFBbUIsR0FBRztBQWFsQ0ksSUFBQUEsaUJBQVEsRUFBQyxtQkFBbUI7SUFDMUJDLElBQUFBLFdBQUUsRUFBQywyQ0FBMkM7UUFDNUNDLFFBQVFDLEdBQUcsQ0FBQztRQUVaLElBQUk7WUFDRkQsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTUMsVUFBVSxJQUFJQyxtQkFBVyxDQUFDO1lBQ2hDSCxRQUFRQyxHQUFHLENBQUM7WUFFWkQsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTUcsV0FBVyxNQUFNQyxJQUFBQSxVQUFHLEVBQUNIO1lBQzNCRixRQUFRQyxHQUFHLENBQUM7WUFFWkQsUUFBUUMsR0FBRyxDQUFDO1lBQ1pELFFBQVFDLEdBQUcsQ0FBQyxvQkFBb0JHLFNBQVNFLE1BQU07WUFFL0NOLFFBQVFDLEdBQUcsQ0FBQztZQUNaLE1BQU1NLGVBQWUsTUFBTUgsU0FBU0ksSUFBSTtZQUN4Q1IsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQlEsS0FBS0MsU0FBUyxDQUFDSCxjQUFjLE1BQU07WUFFakVQLFFBQVFDLEdBQUcsQ0FBQztZQUNaRCxRQUFRQyxHQUFHLENBQUMseUJBQXlCTSxhQUFhSSxjQUFjLENBQUM7WUFDakVYLFFBQVFDLEdBQUcsQ0FBQyx1QkFBdUJNLGFBQWFJLGNBQWMsQ0FBQztZQUUvRCxnREFBZ0Q7WUFDaERDLElBQUFBLGVBQU0sRUFBQ1IsVUFBVVMsV0FBVztZQUM1QkQsSUFBQUEsZUFBTSxFQUFDTCxjQUFjTSxXQUFXO1FBRWxDLEVBQUUsT0FBT0MsT0FBTztZQUNkZCxRQUFRYyxLQUFLLENBQUMseUJBQXlCQTtZQUN2Q2QsUUFBUWMsS0FBSyxDQUFDLGdCQUFnQkEsTUFBTUMsS0FBSztZQUN6QyxNQUFNRDtRQUNSO0lBQ0Y7QUFDRiJ9
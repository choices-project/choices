c41df253063ca6f271f1cb04cec9383a
// Set up test environment variables FIRST, before any other imports
"use strict";
process.env.NODE_ENV = "test";
process.env.NEXT_PUBLIC_SUPABASE_URL = "https://test.supabase.co";
process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = "test-anon-key";
process.env.SUPABASE_SERVICE_ROLE_KEY = "test-service-role-key";
process.env.NEXTAUTH_SECRET = "test-secret";
process.env.NEXTAUTH_URL = "http://localhost:3000";
// Set up privacy pepper environment variables for testing
process.env.PRIVACY_PEPPER_DEV = "dev-pepper-consistent-for-testing-12345678901234567890";
process.env.PRIVACY_PEPPER_CURRENT = "hex:" + "ab".repeat(32);
process.env.PRIVACY_PEPPER_PREVIOUS = "hex:" + "cd".repeat(32);
// Polyfill for Web APIs in Node.js environment
if (typeof global.TextEncoder === "undefined") {
    const { TextEncoder, TextDecoder } = require("util");
    global.TextEncoder = TextEncoder;
    global.TextDecoder = TextDecoder;
}
// Simple Request polyfill for testing
if (typeof global.Request === "undefined") {
    global.Request = class Request {
        constructor(url, options = {}){
            this.url = url;
            this.method = options.method || "GET";
            this.headers = new Map();
            if (options.headers) {
                Object.entries(options.headers).forEach(([key, value])=>{
                    this.headers.set(key.toLowerCase(), value);
                });
            }
            this.body = options.body;
        }
        async json() {
            return JSON.parse(this.body || "{}");
        }
    };
}
// Simple Response polyfill for testing
if (typeof global.Response === "undefined") {
    global.Response = class Response1 {
        constructor(body, options = {}){
            this.body = body;
            this.status = options.status || 200;
            this.statusText = options.statusText || "OK";
            this.headers = new Map();
            if (options.headers) {
                Object.entries(options.headers).forEach(([key, value])=>{
                    this.headers.set(key.toLowerCase(), value);
                });
            }
        }
        async json() {
            return JSON.parse(this.body || "{}");
        }
    };
}
// Simple Headers polyfill for testing
if (typeof global.Headers === "undefined") {
    global.Headers = class Headers1 {
        constructor(init = {}){
            this.map = new Map();
            if (init) {
                Object.entries(init).forEach(([key, value])=>{
                    this.map.set(key.toLowerCase(), value);
                });
            }
        }
        get(name) {
            return this.map.get(name.toLowerCase());
        }
        set(name, value) {
            this.map.set(name.toLowerCase(), value);
        }
        has(name) {
            return this.map.has(name.toLowerCase());
        }
    };
}
// Simple fetch polyfill for testing
if (typeof global.fetch === "undefined") {
    global.fetch = async (url, options = {})=>{
        // Mock fetch for testing - return empty response
        return new Response(JSON.stringify({}), {
            status: 200,
            statusText: "OK",
            headers: new Headers({
                "Content-Type": "application/json"
            })
        });
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9qZXN0LnNldHVwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNldCB1cCB0ZXN0IGVudmlyb25tZW50IHZhcmlhYmxlcyBGSVJTVCwgYmVmb3JlIGFueSBvdGhlciBpbXBvcnRzXG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbnByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCA9ICdodHRwczovL3Rlc3Quc3VwYWJhc2UuY28nO1xucHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgPSAndGVzdC1hbm9uLWtleSc7XG5wcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZID0gJ3Rlc3Qtc2VydmljZS1yb2xlLWtleSc7XG5wcm9jZXNzLmVudi5ORVhUQVVUSF9TRUNSRVQgPSAndGVzdC1zZWNyZXQnO1xucHJvY2Vzcy5lbnYuTkVYVEFVVEhfVVJMID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7XG5cbi8vIFNldCB1cCBwcml2YWN5IHBlcHBlciBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIHRlc3RpbmdcbnByb2Nlc3MuZW52LlBSSVZBQ1lfUEVQUEVSX0RFViA9ICdkZXYtcGVwcGVyLWNvbnNpc3RlbnQtZm9yLXRlc3RpbmctMTIzNDU2Nzg5MDEyMzQ1Njc4OTAnO1xucHJvY2Vzcy5lbnYuUFJJVkFDWV9QRVBQRVJfQ1VSUkVOVCA9ICdoZXg6JyArICdhYicucmVwZWF0KDMyKTtcbnByb2Nlc3MuZW52LlBSSVZBQ1lfUEVQUEVSX1BSRVZJT1VTID0gJ2hleDonICsgJ2NkJy5yZXBlYXQoMzIpO1xuXG4vLyBQb2x5ZmlsbCBmb3IgV2ViIEFQSXMgaW4gTm9kZS5qcyBlbnZpcm9ubWVudFxuaWYgKHR5cGVvZiBnbG9iYWwuVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gIGNvbnN0IHsgVGV4dEVuY29kZXIsIFRleHREZWNvZGVyIH0gPSByZXF1aXJlKCd1dGlsJyk7XG4gIGdsb2JhbC5UZXh0RW5jb2RlciA9IFRleHRFbmNvZGVyO1xuICBnbG9iYWwuVGV4dERlY29kZXIgPSBUZXh0RGVjb2Rlcjtcbn1cblxuLy8gU2ltcGxlIFJlcXVlc3QgcG9seWZpbGwgZm9yIHRlc3RpbmdcbmlmICh0eXBlb2YgZ2xvYmFsLlJlcXVlc3QgPT09ICd1bmRlZmluZWQnKSB7XG4gIGdsb2JhbC5SZXF1ZXN0ID0gY2xhc3MgUmVxdWVzdCB7XG4gICAgY29uc3RydWN0b3IodXJsLCBvcHRpb25zID0ge30pIHtcbiAgICAgIHRoaXMudXJsID0gdXJsO1xuICAgICAgdGhpcy5tZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAnR0VUJztcbiAgICAgIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAoKTtcbiAgICAgIGlmIChvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMob3B0aW9ucy5oZWFkZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KGtleS50b0xvd2VyQ2FzZSgpLCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5ib2R5ID0gb3B0aW9ucy5ib2R5O1xuICAgIH1cbiAgICBcbiAgICBhc3luYyBqc29uKCkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5ib2R5IHx8ICd7fScpO1xuICAgIH1cbiAgfTtcbn1cblxuLy8gU2ltcGxlIFJlc3BvbnNlIHBvbHlmaWxsIGZvciB0ZXN0aW5nXG5pZiAodHlwZW9mIGdsb2JhbC5SZXNwb25zZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgZ2xvYmFsLlJlc3BvbnNlID0gY2xhc3MgUmVzcG9uc2Uge1xuICAgIGNvbnN0cnVjdG9yKGJvZHksIG9wdGlvbnMgPSB7fSkge1xuICAgICAgdGhpcy5ib2R5ID0gYm9keTtcbiAgICAgIHRoaXMuc3RhdHVzID0gb3B0aW9ucy5zdGF0dXMgfHwgMjAwO1xuICAgICAgdGhpcy5zdGF0dXNUZXh0ID0gb3B0aW9ucy5zdGF0dXNUZXh0IHx8ICdPSyc7XG4gICAgICB0aGlzLmhlYWRlcnMgPSBuZXcgTWFwKCk7XG4gICAgICBpZiAob3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKG9wdGlvbnMuaGVhZGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgdGhpcy5oZWFkZXJzLnNldChrZXkudG9Mb3dlckNhc2UoKSwgdmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgYXN5bmMganNvbigpIHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuYm9keSB8fCAne30nKTtcbiAgICB9XG4gIH07XG59XG5cbi8vIFNpbXBsZSBIZWFkZXJzIHBvbHlmaWxsIGZvciB0ZXN0aW5nXG5pZiAodHlwZW9mIGdsb2JhbC5IZWFkZXJzID09PSAndW5kZWZpbmVkJykge1xuICBnbG9iYWwuSGVhZGVycyA9IGNsYXNzIEhlYWRlcnMge1xuICAgIGNvbnN0cnVjdG9yKGluaXQgPSB7fSkge1xuICAgICAgdGhpcy5tYXAgPSBuZXcgTWFwKCk7XG4gICAgICBpZiAoaW5pdCkge1xuICAgICAgICBPYmplY3QuZW50cmllcyhpbml0KS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICB0aGlzLm1hcC5zZXQoa2V5LnRvTG93ZXJDYXNlKCksIHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZ2V0KG5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLm1hcC5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG5cbiAgICBzZXQobmFtZSwgdmFsdWUpIHtcbiAgICAgIHRoaXMubWFwLnNldChuYW1lLnRvTG93ZXJDYXNlKCksIHZhbHVlKTtcbiAgICB9XG5cbiAgICBoYXMobmFtZSkge1xuICAgICAgcmV0dXJuIHRoaXMubWFwLmhhcyhuYW1lLnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cbiAgfTtcbn1cblxuLy8gU2ltcGxlIGZldGNoIHBvbHlmaWxsIGZvciB0ZXN0aW5nXG5pZiAodHlwZW9mIGdsb2JhbC5mZXRjaCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgZ2xvYmFsLmZldGNoID0gYXN5bmMgKHVybCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgLy8gTW9jayBmZXRjaCBmb3IgdGVzdGluZyAtIHJldHVybiBlbXB0eSByZXNwb25zZVxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoe30pLCB7XG4gICAgICBzdGF0dXM6IDIwMCxcbiAgICAgIHN0YXR1c1RleHQ6ICdPSycsXG4gICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSlcbiAgICB9KTtcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJORVhUQVVUSF9TRUNSRVQiLCJORVhUQVVUSF9VUkwiLCJQUklWQUNZX1BFUFBFUl9ERVYiLCJQUklWQUNZX1BFUFBFUl9DVVJSRU5UIiwicmVwZWF0IiwiUFJJVkFDWV9QRVBQRVJfUFJFVklPVVMiLCJnbG9iYWwiLCJUZXh0RW5jb2RlciIsIlRleHREZWNvZGVyIiwicmVxdWlyZSIsIlJlcXVlc3QiLCJjb25zdHJ1Y3RvciIsInVybCIsIm9wdGlvbnMiLCJtZXRob2QiLCJoZWFkZXJzIiwiTWFwIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJrZXkiLCJ2YWx1ZSIsInNldCIsInRvTG93ZXJDYXNlIiwiYm9keSIsImpzb24iLCJKU09OIiwicGFyc2UiLCJSZXNwb25zZSIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJIZWFkZXJzIiwiaW5pdCIsIm1hcCIsImdldCIsIm5hbWUiLCJoYXMiLCJmZXRjaCIsInN0cmluZ2lmeSJdLCJtYXBwaW5ncyI6IkFBQUEsb0VBQW9FOztBQUNwRUEsUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEdBQUc7QUFDdkJGLFFBQVFDLEdBQUcsQ0FBQ0Usd0JBQXdCLEdBQUc7QUFDdkNILFFBQVFDLEdBQUcsQ0FBQ0csNkJBQTZCLEdBQUc7QUFDNUNKLFFBQVFDLEdBQUcsQ0FBQ0kseUJBQXlCLEdBQUc7QUFDeENMLFFBQVFDLEdBQUcsQ0FBQ0ssZUFBZSxHQUFHO0FBQzlCTixRQUFRQyxHQUFHLENBQUNNLFlBQVksR0FBRztBQUUzQiwwREFBMEQ7QUFDMURQLFFBQVFDLEdBQUcsQ0FBQ08sa0JBQWtCLEdBQUc7QUFDakNSLFFBQVFDLEdBQUcsQ0FBQ1Esc0JBQXNCLEdBQUcsU0FBUyxLQUFLQyxNQUFNLENBQUM7QUFDMURWLFFBQVFDLEdBQUcsQ0FBQ1UsdUJBQXVCLEdBQUcsU0FBUyxLQUFLRCxNQUFNLENBQUM7QUFFM0QsK0NBQStDO0FBQy9DLElBQUksT0FBT0UsT0FBT0MsV0FBVyxLQUFLLGFBQWE7SUFDN0MsTUFBTSxFQUFFQSxXQUFXLEVBQUVDLFdBQVcsRUFBRSxHQUFHQyxRQUFRO0lBQzdDSCxPQUFPQyxXQUFXLEdBQUdBO0lBQ3JCRCxPQUFPRSxXQUFXLEdBQUdBO0FBQ3ZCO0FBRUEsc0NBQXNDO0FBQ3RDLElBQUksT0FBT0YsT0FBT0ksT0FBTyxLQUFLLGFBQWE7SUFDekNKLE9BQU9JLE9BQU8sR0FBRyxNQUFNQTtRQUNyQkMsWUFBWUMsR0FBRyxFQUFFQyxVQUFVLENBQUMsQ0FBQyxDQUFFO1lBQzdCLElBQUksQ0FBQ0QsR0FBRyxHQUFHQTtZQUNYLElBQUksQ0FBQ0UsTUFBTSxHQUFHRCxRQUFRQyxNQUFNLElBQUk7WUFDaEMsSUFBSSxDQUFDQyxPQUFPLEdBQUcsSUFBSUM7WUFDbkIsSUFBSUgsUUFBUUUsT0FBTyxFQUFFO2dCQUNuQkUsT0FBT0MsT0FBTyxDQUFDTCxRQUFRRSxPQUFPLEVBQUVJLE9BQU8sQ0FBQyxDQUFDLENBQUNDLEtBQUtDLE1BQU07b0JBQ25ELElBQUksQ0FBQ04sT0FBTyxDQUFDTyxHQUFHLENBQUNGLElBQUlHLFdBQVcsSUFBSUY7Z0JBQ3RDO1lBQ0Y7WUFDQSxJQUFJLENBQUNHLElBQUksR0FBR1gsUUFBUVcsSUFBSTtRQUMxQjtRQUVBLE1BQU1DLE9BQU87WUFDWCxPQUFPQyxLQUFLQyxLQUFLLENBQUMsSUFBSSxDQUFDSCxJQUFJLElBQUk7UUFDakM7SUFDRjtBQUNGO0FBRUEsdUNBQXVDO0FBQ3ZDLElBQUksT0FBT2xCLE9BQU9zQixRQUFRLEtBQUssYUFBYTtJQUMxQ3RCLE9BQU9zQixRQUFRLEdBQUcsTUFBTUE7UUFDdEJqQixZQUFZYSxJQUFJLEVBQUVYLFVBQVUsQ0FBQyxDQUFDLENBQUU7WUFDOUIsSUFBSSxDQUFDVyxJQUFJLEdBQUdBO1lBQ1osSUFBSSxDQUFDSyxNQUFNLEdBQUdoQixRQUFRZ0IsTUFBTSxJQUFJO1lBQ2hDLElBQUksQ0FBQ0MsVUFBVSxHQUFHakIsUUFBUWlCLFVBQVUsSUFBSTtZQUN4QyxJQUFJLENBQUNmLE9BQU8sR0FBRyxJQUFJQztZQUNuQixJQUFJSCxRQUFRRSxPQUFPLEVBQUU7Z0JBQ25CRSxPQUFPQyxPQUFPLENBQUNMLFFBQVFFLE9BQU8sRUFBRUksT0FBTyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTTtvQkFDbkQsSUFBSSxDQUFDTixPQUFPLENBQUNPLEdBQUcsQ0FBQ0YsSUFBSUcsV0FBVyxJQUFJRjtnQkFDdEM7WUFDRjtRQUNGO1FBRUEsTUFBTUksT0FBTztZQUNYLE9BQU9DLEtBQUtDLEtBQUssQ0FBQyxJQUFJLENBQUNILElBQUksSUFBSTtRQUNqQztJQUNGO0FBQ0Y7QUFFQSxzQ0FBc0M7QUFDdEMsSUFBSSxPQUFPbEIsT0FBT3lCLE9BQU8sS0FBSyxhQUFhO0lBQ3pDekIsT0FBT3lCLE9BQU8sR0FBRyxNQUFNQTtRQUNyQnBCLFlBQVlxQixPQUFPLENBQUMsQ0FBQyxDQUFFO1lBQ3JCLElBQUksQ0FBQ0MsR0FBRyxHQUFHLElBQUlqQjtZQUNmLElBQUlnQixNQUFNO2dCQUNSZixPQUFPQyxPQUFPLENBQUNjLE1BQU1iLE9BQU8sQ0FBQyxDQUFDLENBQUNDLEtBQUtDLE1BQU07b0JBQ3hDLElBQUksQ0FBQ1ksR0FBRyxDQUFDWCxHQUFHLENBQUNGLElBQUlHLFdBQVcsSUFBSUY7Z0JBQ2xDO1lBQ0Y7UUFDRjtRQUVBYSxJQUFJQyxJQUFJLEVBQUU7WUFDUixPQUFPLElBQUksQ0FBQ0YsR0FBRyxDQUFDQyxHQUFHLENBQUNDLEtBQUtaLFdBQVc7UUFDdEM7UUFFQUQsSUFBSWEsSUFBSSxFQUFFZCxLQUFLLEVBQUU7WUFDZixJQUFJLENBQUNZLEdBQUcsQ0FBQ1gsR0FBRyxDQUFDYSxLQUFLWixXQUFXLElBQUlGO1FBQ25DO1FBRUFlLElBQUlELElBQUksRUFBRTtZQUNSLE9BQU8sSUFBSSxDQUFDRixHQUFHLENBQUNHLEdBQUcsQ0FBQ0QsS0FBS1osV0FBVztRQUN0QztJQUNGO0FBQ0Y7QUFFQSxvQ0FBb0M7QUFDcEMsSUFBSSxPQUFPakIsT0FBTytCLEtBQUssS0FBSyxhQUFhO0lBQ3ZDL0IsT0FBTytCLEtBQUssR0FBRyxPQUFPekIsS0FBS0MsVUFBVSxDQUFDLENBQUM7UUFDckMsaURBQWlEO1FBQ2pELE9BQU8sSUFBSWUsU0FBU0YsS0FBS1ksU0FBUyxDQUFDLENBQUMsSUFBSTtZQUN0Q1QsUUFBUTtZQUNSQyxZQUFZO1lBQ1pmLFNBQVMsSUFBSWdCLFFBQVE7Z0JBQUUsZ0JBQWdCO1lBQW1CO1FBQzVEO0lBQ0Y7QUFDRiJ9
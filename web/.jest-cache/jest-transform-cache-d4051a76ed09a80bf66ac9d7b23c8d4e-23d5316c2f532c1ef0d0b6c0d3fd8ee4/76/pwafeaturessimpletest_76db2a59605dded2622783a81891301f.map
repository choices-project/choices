{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/components/features/pwa/pwa-features-simple.test.tsx"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\n\n// Browser APIs are mocked in jest.setup.js\n\n// Mock lucide-react icons\njest.mock('lucide-react', () => ({\n  Bell: () => <div data-testid=\"bell-icon\" />,\n  BellOff: () => <div data-testid=\"bell-off-icon\" />,\n  CheckCircle: () => <div data-testid=\"check-circle-icon\" />,\n  AlertCircle: () => <div data-testid=\"alert-circle-icon\" />,\n  Wifi: () => <div data-testid=\"wifi-icon\" />,\n  WifiOff: () => <div data-testid=\"wifi-off-icon\" />,\n  Download: () => <div data-testid=\"download-icon\" />,\n  Settings: () => <div data-testid=\"settings-icon\" />,\n  RefreshCw: () => <div data-testid=\"refresh-icon\" />,\n  Database: () => <div data-testid=\"database-icon\" />,\n  Clock: () => <div data-testid=\"clock-icon\" />,\n  Check: () => <div data-testid=\"check-icon\" />,\n  X: () => <div data-testid=\"x-icon\" />,\n}));\n\n// Use REAL PWA installation manager - TESTING PHILOSOPHY APPROACH\n// No mocking - test actual PWA functionality\n\n// Mock browser APIs that PWA components depend on\nObject.defineProperty(window, 'matchMedia', {\n  writable: true,\n  value: jest.fn().mockImplementation(query => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(), // deprecated\n    removeListener: jest.fn(), // deprecated\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn(),\n  })),\n});\n\n// Mock navigator.onLine\nObject.defineProperty(navigator, 'onLine', {\n  writable: true,\n  value: true,\n});\n\n// Mock service worker APIs\nObject.defineProperty(navigator, 'serviceWorker', {\n  writable: true,\n  value: {\n    register: jest.fn(),\n    ready: Promise.resolve(),\n    getRegistration: jest.fn(),\n    getRegistrations: jest.fn(),\n  },\n});\n\n// Mock PushManager\nObject.defineProperty(window, 'PushManager', {\n  writable: true,\n  value: jest.fn(),\n});\n\n// Use REAL Zustand stores - TESTING PHILOSOPHY APPROACH\n// No mocking - test actual store behavior and real PWA functionality\n\n\nimport React from 'react';\nimport { render, screen, renderHook, act } from '@testing-library/react';\nimport { BrowserRouter } from 'react-router-dom';\nimport PWAFeatures from '@/features/pwa/components/PWAFeatures';\nimport { T } from '@/lib/testing/testIds';\nimport { usePWAStore } from '@/lib/stores';\n\ndescribe('PWA Features - Real Zustand Testing', () => {\n  beforeEach(() => {\n    // Reset Zustand stores to initial state using proper React testing approach\n    const { result } = renderHook(() => usePWAStore());\n    \n    act(() => {\n      // Reset to initial state using correct method names\n      result.current.setInstallation({\n        isInstalled: false,\n        installPrompt: null,\n        canInstall: true,\n        installSource: 'manual',\n        version: '1.0.0',\n      });\n      \n      result.current.setOnlineStatus(true);\n      result.current.clearNotifications();\n      result.current.setLoading(false);\n      result.current.setError(null);\n    });\n  });\n\n  describe('Component Rendering', () => {\n    it('should render PWA features when installation is available', () => {\n      // Debug: Check what the store hooks are returning in the component context\n      const TestComponent = () => {\n        const installation = usePWAStore(state => state.installation);\n        const offline = usePWAStore(state => state.offline);\n        \n        console.log('Component context - installation:', installation);\n        console.log('Component context - offline:', offline);\n        console.log('Component context - installation.isInstalled:', installation?.isInstalled);\n        console.log('Component context - installation.canInstall:', installation?.canInstall);\n        console.log('Component context - !installation:', !installation);\n        console.log('Component context - !offline:', !offline);\n        console.log('Component context - !installation.isInstalled && !installation.canInstall:', !installation?.isInstalled && !installation?.canInstall);\n        \n        return <div data-testid=\"debug-info\">Debug: {JSON.stringify({ installation, offline })}</div>;\n      };\n      \n      render(\n        <BrowserRouter>\n          <TestComponent />\n        </BrowserRouter>\n      );\n      \n      // Check what the debug component shows\n      const debugInfo = screen.getByTestId('debug-info');\n      console.log('Debug info text:', debugInfo.textContent);\n      \n      // Now test the actual PWAFeatures component\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      // Check for basic PWA elements that should always render\n      expect(screen.getByTestId('pwa-features')).toBeInTheDocument();\n      expect(screen.getByTestId('offline-features')).toBeInTheDocument();\n      expect(screen.getByTestId('notification-features')).toBeInTheDocument();\n    });\n\n    it('should render with custom className', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures className=\"custom-class\" />\n        </BrowserRouter>\n      );\n\n      const container = screen.getByTestId('pwa-features');\n      expect(container).toHaveClass('custom-class');\n    });\n  });\n\n  describe('Offline Features', () => {\n    it('should display offline indicator when offline', () => {\n      // Use REAL Zustand store to set offline state\n      const { usePWAStore } = require('@/lib/stores');\n      const store = usePWAStore.getState();\n      \n      // Set offline state using real store\n      store.setOnlineStatus(false);\n\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      expect(screen.getByTestId('offline-features')).toBeInTheDocument();\n    });\n  });\n\n  describe('Performance', () => {\n    it('should render within performance budget', async () => {\n      const startTime = performance.now();\n      \n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n      \n      const endTime = performance.now();\n      const renderTime = endTime - startTime;\n      \n      // Should render within 100ms\n      expect(renderTime).toBeLessThan(100);\n    });\n\n    it('should not cause memory leaks', () => {\n      const { unmount } = render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      // Unmount component\n      unmount();\n\n      // Should not leave any event listeners or timers\n      expect(jest.getTimerCount()).toBe(0);\n    });\n  });\n});\n"],"names":["jest","mock","Bell","div","data-testid","BellOff","CheckCircle","AlertCircle","Wifi","WifiOff","Download","Settings","RefreshCw","Database","Clock","Check","X","Object","defineProperty","window","writable","value","fn","mockImplementation","query","matches","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent","navigator","register","ready","Promise","resolve","getRegistration","getRegistrations","describe","beforeEach","result","renderHook","usePWAStore","act","current","setInstallation","isInstalled","installPrompt","canInstall","installSource","version","setOnlineStatus","clearNotifications","setLoading","setError","it","TestComponent","installation","state","offline","console","log","JSON","stringify","render","BrowserRouter","debugInfo","screen","getByTestId","textContent","PWAFeatures","expect","toBeInTheDocument","className","container","toHaveClass","require","store","getState","startTime","performance","now","endTime","renderTime","toBeLessThan","unmount","getTimerCount","toBe"],"mappings":"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"}
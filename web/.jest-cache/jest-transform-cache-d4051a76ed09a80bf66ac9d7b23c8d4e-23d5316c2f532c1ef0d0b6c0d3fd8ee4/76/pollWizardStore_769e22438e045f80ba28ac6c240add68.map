{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/stores/pollWizardStore.ts"],"sourcesContent":["/**\n * Poll Wizard Store - Zustand Implementation\n * \n * Comprehensive poll creation wizard state management including step navigation,\n * form data persistence, validation, and progress tracking. Migrates from\n * usePollWizard hook to centralized Zustand store.\n * \n * Created: January 15, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { persist } from 'zustand/middleware';\n\nimport { logger } from '@/lib/utils/logger';\n\n\n// Poll wizard data types\nexport interface PollWizardData {\n  title: string;\n  description: string;\n  category: string;\n  options: string[];\n  tags: string[];\n  privacyLevel: 'public' | 'private' | 'unlisted';\n  allowMultipleVotes: boolean;\n  showResults: boolean;\n  isTemplate: boolean;\n  settings: {\n    allowMultipleVotes: boolean;\n    allowAnonymousVotes: boolean;\n    requireAuthentication: boolean;\n    requireEmail: boolean;\n    showResults: boolean;\n    allowWriteIns: boolean;\n    allowComments: boolean;\n    enableNotifications: boolean;\n    maxSelections: number;\n    votingMethod: 'single' | 'multiple' | 'ranked' | 'quadratic';\n    privacyLevel: 'public' | 'private' | 'unlisted';\n    moderationEnabled: boolean;\n    autoClose: boolean;\n  };\n}\n\nexport interface PollWizardState {\n  currentStep: number;\n  totalSteps: number;\n  data: PollWizardData;\n  isLoading: boolean;\n  errors: Record<string, string>;\n  progress: number;\n  canGoBack: boolean;\n  canProceed: boolean;\n  isComplete: boolean;\n}\n\n// Initial data\nconst INITIAL_WIZARD_DATA: PollWizardData = {\n  title: '',\n  description: '',\n  category: 'general',\n  options: ['', ''],\n  tags: [],\n  privacyLevel: 'public',\n  allowMultipleVotes: false,\n  showResults: true,\n  isTemplate: false,\n  settings: {\n    allowMultipleVotes: false,\n    allowAnonymousVotes: true,\n    requireAuthentication: false,\n    requireEmail: false,\n    showResults: true,\n    allowWriteIns: false,\n    allowComments: true,\n    enableNotifications: true,\n    maxSelections: 1,\n    votingMethod: 'single',\n    privacyLevel: 'public',\n    moderationEnabled: false,\n    autoClose: false\n  }\n};\n\nconst INITIAL_WIZARD_STATE: PollWizardState = {\n  currentStep: 0,\n  totalSteps: 4,\n  data: INITIAL_WIZARD_DATA,\n  isLoading: false,\n  errors: {},\n  progress: 0,\n  canGoBack: false,\n  canProceed: false,\n  isComplete: false\n};\n\n// Store interface\ninterface PollWizardStore extends PollWizardState {\n  // Step navigation actions\n  nextStep: () => void;\n  prevStep: () => void;\n  goToStep: (step: number) => void;\n  resetWizard: () => void;\n  \n  // Data update actions\n  updateData: (updates: Partial<PollWizardData>) => void;\n  updateSettings: (settings: Partial<PollWizardData['settings']>) => void;\n  \n  // Options management\n  addOption: () => void;\n  removeOption: (index: number) => void;\n  updateOption: (index: number, value: string) => void;\n  \n  // Tags management\n  addTag: (tag: string) => void;\n  removeTag: (tag: string) => void;\n  updateTags: (tags: string[]) => void;\n  \n  // Validation\n  validateStep: (step: number, data: PollWizardData) => Record<string, string>;\n  validateCurrentStep: () => void;\n  \n  // Loading and error states\n  setLoading: (loading: boolean) => void;\n  setError: (field: string, error: string) => void;\n  clearError: (field: string) => void;\n  clearAllErrors: () => void;\n  \n  // Utility functions\n  getStepData: (step: number) => Partial<PollWizardData>;\n  getProgress: () => number;\n  canProceedToNextStep: (step: number) => boolean;\n  isStepValid: (step: number) => boolean;\n  getStepErrors: (step: number) => Record<string, string>;\n}\n\n// Validation function\nconst validateStep = (step: number, data: PollWizardData): Record<string, string> => {\n  const errors: Record<string, string> = {};\n\n  switch (step) {\n    case 0: // Basic info\n      if (!data.title.trim()) {\n        errors.title = 'Title is required';\n      }\n      if (!data.description.trim()) {\n        errors.description = 'Description is required';\n      }\n      break;\n    \n    case 1: // Options\n      const step1ValidOptions = data.options.filter(option => option.trim().length > 0);\n      if (step1ValidOptions.length < 2) {\n        errors.options = 'At least 2 options are required';\n      }\n      break;\n    \n    case 2: // Settings\n      if (data.category === 'general' && !data.tags.length) {\n        errors.tags = 'At least one tag is required for general polls';\n      }\n      break;\n    \n    case 3: // Review\n      // Final validation - comprehensive check\n      const validOptions = data.options.filter(option => option.trim().length > 0);\n      if (validOptions.length < 2) {\n        errors.options = 'At least 2 valid options are required';\n      }\n      \n      // Check for duplicate options\n      const uniqueOptions = new Set(validOptions.map(opt => opt.toLowerCase().trim()));\n      if (uniqueOptions.size !== validOptions.length) {\n        errors.options = 'Duplicate options are not allowed';\n      }\n      \n      // Validate title length\n      if (data.title.trim().length < 3) {\n        errors.title = 'Title must be at least 3 characters';\n      }\n      if (data.title.trim().length > 200) {\n        errors.title = 'Title must be less than 200 characters';\n      }\n      \n      // Validate description length\n      if (data.description.trim().length > 1000) {\n        errors.description = 'Description must be less than 1000 characters';\n      }\n      break;\n  }\n\n  return errors;\n};\n\n// Create the store\nexport const usePollWizardStore = create<PollWizardStore>()(\n  devtools(\n    persist(\n      (set, get) => ({\n        ...INITIAL_WIZARD_STATE,\n\n        // Step navigation actions\n        nextStep: () => {\n          const state = get();\n          const nextStep = Math.min(state.currentStep + 1, state.totalSteps - 1);\n          const progress = ((nextStep + 1) / state.totalSteps) * 100;\n          \n          set({\n            currentStep: nextStep,\n            progress,\n            canGoBack: nextStep > 0,\n            canProceed: nextStep < state.totalSteps - 1,\n            isComplete: nextStep === state.totalSteps - 1\n          });\n        },\n\n        prevStep: () => {\n          const state = get();\n          const prevStep = Math.max(state.currentStep - 1, 0);\n          const progress = ((prevStep + 1) / state.totalSteps) * 100;\n          \n          set({\n            currentStep: prevStep,\n            progress,\n            canGoBack: prevStep > 0,\n            canProceed: prevStep < state.totalSteps - 1,\n            isComplete: prevStep === state.totalSteps - 1,\n            errors: {} // Clear errors when going back\n          });\n        },\n\n        goToStep: (step: number) => {\n          const state = get();\n          const targetStep = Math.max(0, Math.min(step, state.totalSteps - 1));\n          const progress = ((targetStep + 1) / state.totalSteps) * 100;\n          \n          set({\n            currentStep: targetStep,\n            progress,\n            canGoBack: targetStep > 0,\n            canProceed: targetStep < state.totalSteps - 1,\n            isComplete: targetStep === state.totalSteps - 1,\n            errors: {} // Clear errors when navigating\n          });\n        },\n\n        resetWizard: () => {\n          set(INITIAL_WIZARD_STATE);\n        },\n\n        // Data update actions\n        updateData: (updates: Partial<PollWizardData>) => {\n          const state = get();\n          const newData = { ...state.data, ...updates };\n          const errors = validateStep(state.currentStep, newData);\n          const canProceed = Object.keys(errors).length === 0;\n          \n          set({\n            data: newData,\n            canProceed,\n            errors\n          });\n        },\n\n        updateSettings: (settings: Partial<PollWizardData['settings']>) => {\n          const state = get();\n          const newSettings = { ...state.data.settings, ...settings };\n          const newData = { ...state.data, settings: newSettings };\n          \n          set({ data: newData });\n        },\n\n        // Options management\n        addOption: () => {\n          const state = get();\n          const newOptions = [...state.data.options, ''];\n          const newData = { ...state.data, options: newOptions };\n          \n          set({ data: newData });\n        },\n\n        removeOption: (index: number) => {\n          const state = get();\n          const newOptions = state.data.options.filter((_, i) => i !== index);\n          const newData = { ...state.data, options: newOptions };\n          \n          set({ data: newData });\n        },\n\n        updateOption: (index: number, value: string) => {\n          const state = get();\n          const newOptions = state.data.options.map((option, i) => \n            i === index ? value : option\n          );\n          const newData = { ...state.data, options: newOptions };\n          \n          set({ data: newData });\n        },\n\n        // Tags management\n        addTag: (tag: string) => {\n          const state = get();\n          if (!state.data.tags.includes(tag)) {\n            const newTags = [...state.data.tags, tag];\n            const newData = { ...state.data, tags: newTags };\n            \n            set({ data: newData });\n          }\n        },\n\n        removeTag: (tag: string) => {\n          const state = get();\n          const newTags = state.data.tags.filter(t => t !== tag);\n          const newData = { ...state.data, tags: newTags };\n          \n          set({ data: newData });\n        },\n\n        updateTags: (tags: string[]) => {\n          const state = get();\n          const newData = { ...state.data, tags };\n          \n          set({ data: newData });\n        },\n\n        // Validation\n        validateStep: (step: number, data: PollWizardData) => {\n          return validateStep(step, data);\n        },\n\n        validateCurrentStep: () => {\n          const state = get();\n          const errors = validateStep(state.currentStep, state.data);\n          const canProceed = Object.keys(errors).length === 0;\n          \n          set({\n            canProceed,\n            errors\n          });\n        },\n\n        // Loading and error states\n        setLoading: (loading: boolean) => {\n          set({ isLoading: loading });\n        },\n\n        setError: (field: string, error: string) => {\n          const state = get();\n          set({\n            errors: { ...state.errors, [field]: error }\n          });\n        },\n\n        clearError: (field: string) => {\n          const state = get();\n          const newErrors = { ...state.errors };\n          delete newErrors[field];\n          set({ errors: newErrors });\n        },\n\n        clearAllErrors: () => {\n          set({ errors: {} });\n        },\n\n        // Utility functions\n        getStepData: (step: number) => {\n          const state = get();\n          switch (step) {\n            case 0:\n              return {\n                title: state.data.title,\n                description: state.data.description,\n                category: state.data.category\n              };\n            case 1:\n              return {\n                options: state.data.options\n              };\n            case 2:\n              return {\n                tags: state.data.tags,\n                privacyLevel: state.data.privacyLevel,\n                settings: state.data.settings\n              };\n            case 3:\n              return state.data;\n            default:\n              return {};\n          }\n        },\n\n        getProgress: () => {\n          const state = get();\n          return ((state.currentStep + 1) / state.totalSteps) * 100;\n        },\n\n        canProceedToNextStep: (step: number) => {\n          const state = get();\n          const errors = validateStep(step, state.data);\n          return Object.keys(errors).length === 0;\n        },\n\n        isStepValid: (step: number) => {\n          const state = get();\n          const errors = validateStep(step, state.data);\n          return Object.keys(errors).length === 0;\n        },\n\n        getStepErrors: (step: number) => {\n          const state = get();\n          return validateStep(step, state.data);\n        }\n      }),\n      {\n        name: 'poll-wizard-store',\n        partialize: (state) => ({\n          data: state.data,\n          currentStep: state.currentStep,\n          progress: state.progress\n        })\n      }\n    ),\n    { name: 'poll-wizard-store' }\n  )\n);\n\n// Store selectors for optimized re-renders\nexport const usePollWizardData = () => usePollWizardStore(state => state.data);\nexport const usePollWizardStep = () => usePollWizardStore(state => state.currentStep);\nexport const usePollWizardProgress = () => usePollWizardStore(state => state.progress);\nexport const usePollWizardLoading = () => usePollWizardStore(state => state.isLoading);\nexport const usePollWizardErrors = () => usePollWizardStore(state => state.errors);\nexport const usePollWizardCanProceed = () => usePollWizardStore(state => state.canProceed);\nexport const usePollWizardCanGoBack = () => usePollWizardStore(state => state.canGoBack);\nexport const usePollWizardIsComplete = () => usePollWizardStore(state => state.isComplete);\n\n// Action selectors\nexport const usePollWizardActions = () => usePollWizardStore(state => ({\n  nextStep: state.nextStep,\n  prevStep: state.prevStep,\n  goToStep: state.goToStep,\n  resetWizard: state.resetWizard,\n  updateData: state.updateData,\n  updateSettings: state.updateSettings,\n  addOption: state.addOption,\n  removeOption: state.removeOption,\n  updateOption: state.updateOption,\n  addTag: state.addTag,\n  removeTag: state.removeTag,\n  updateTags: state.updateTags,\n  validateCurrentStep: state.validateCurrentStep,\n  setLoading: state.setLoading,\n  setError: state.setError,\n  clearError: state.clearError,\n  clearAllErrors: state.clearAllErrors,\n  getStepData: state.getStepData,\n  getProgress: state.getProgress,\n  canProceedToNextStep: state.canProceedToNextStep,\n  isStepValid: state.isStepValid,\n  getStepErrors: state.getStepErrors\n}));\n\n// Computed selectors\nexport const usePollWizardStats = () => usePollWizardStore(state => ({\n  currentStep: state.currentStep,\n  totalSteps: state.totalSteps,\n  progress: state.progress,\n  canGoBack: state.canGoBack,\n  canProceed: state.canProceed,\n  isComplete: state.isComplete,\n  hasErrors: Object.keys(state.errors).length > 0,\n  errorCount: Object.keys(state.errors).length\n}));\n\nexport const usePollWizardStepData = (step: number) => usePollWizardStore(state => \n  state.getStepData(step)\n);\n\nexport const usePollWizardStepErrors = (step: number) => usePollWizardStore(state => \n  state.getStepErrors(step)\n);\n\nexport const usePollWizardStepValidation = (step: number) => usePollWizardStore(state => ({\n  isValid: state.isStepValid(step),\n  errors: state.getStepErrors(step),\n  canProceed: state.canProceedToNextStep(step)\n}));\n\n// Store utilities\nexport const pollWizardStoreUtils = {\n  /**\n   * Get wizard summary\n   */\n  getWizardSummary: () => {\n    const state = usePollWizardStore.getState();\n    return {\n      currentStep: state.currentStep,\n      totalSteps: state.totalSteps,\n      progress: state.progress,\n      isComplete: state.isComplete,\n      hasErrors: Object.keys(state.errors).length > 0,\n      data: state.data\n    };\n  },\n\n  /**\n   * Reset wizard to initial state\n   */\n  resetWizard: () => {\n    usePollWizardStore.getState().resetWizard();\n  },\n\n  /**\n   * Validate all steps\n   */\n  validateAllSteps: () => {\n    const state = usePollWizardStore.getState();\n    const allErrors: Record<string, string> = {};\n    \n    for (let step = 0; step < state.totalSteps; step++) {\n      const stepErrors = state.getStepErrors(step);\n      Object.assign(allErrors, stepErrors);\n    }\n    \n    return {\n      isValid: Object.keys(allErrors).length === 0,\n      errors: allErrors\n    };\n  },\n\n  /**\n   * Export wizard data\n   */\n  exportWizardData: () => {\n    const state = usePollWizardStore.getState();\n    return {\n      data: state.data,\n      currentStep: state.currentStep,\n      progress: state.progress,\n      timestamp: new Date().toISOString()\n    };\n  },\n\n  /**\n   * Import wizard data\n   */\n  importWizardData: (data: Partial<PollWizardState>) => {\n    const state = usePollWizardStore.getState();\n    if (data.data) {\n      state.updateData(data.data);\n    }\n    if (data.currentStep !== undefined) {\n      state.goToStep(data.currentStep);\n    }\n  }\n};\n\n// Store subscriptions\nexport const pollWizardStoreSubscriptions = {\n  /**\n   * Subscribe to step changes\n   */\n  onStepChange: (callback: (step: number) => void) => {\n    let previousStep: number | undefined;\n    return usePollWizardStore.subscribe((state) => {\n      if (state.currentStep !== previousStep) {\n        previousStep = state.currentStep;\n        callback(state.currentStep);\n      }\n    });\n  },\n\n  /**\n   * Subscribe to progress changes\n   */\n  onProgressChange: (callback: (progress: number) => void) => {\n    let previousProgress: number | undefined;\n    return usePollWizardStore.subscribe((state) => {\n      if (state.progress !== previousProgress) {\n        previousProgress = state.progress;\n        callback(state.progress);\n      }\n    });\n  },\n\n  /**\n   * Subscribe to data changes\n   */\n  onDataChange: (callback: (data: PollWizardData) => void) => {\n    let previousData: PollWizardData | undefined;\n    return usePollWizardStore.subscribe((state) => {\n      if (state.data !== previousData) {\n        previousData = state.data;\n        callback(state.data);\n      }\n    });\n  }\n};\n\n// Store debugging\nexport const pollWizardStoreDebug = {\n  /**\n   * Log current state\n   */\n  logState: () => {\n    const state = usePollWizardStore.getState();\n    logger.debug('Poll Wizard Store State', {\n      currentStep: state.currentStep,\n      totalSteps: state.totalSteps,\n      progress: state.progress,\n      isComplete: state.isComplete,\n      hasErrors: Object.keys(state.errors).length > 0,\n      errorCount: Object.keys(state.errors).length\n    });\n  },\n\n  /**\n   * Log wizard data\n   */\n  logWizardData: () => {\n    const state = usePollWizardStore.getState();\n    logger.debug('Poll Wizard Data', {\n      title: state.data.title,\n      description: state.data.description,\n      category: state.data.category,\n      options: state.data.options,\n      tags: state.data.tags,\n      privacyLevel: state.data.privacyLevel\n    });\n  },\n\n  /**\n   * Reset store to initial state\n   */\n  reset: () => {\n    usePollWizardStore.getState().resetWizard();\n    logger.info('Poll wizard store reset to initial state');\n  }\n};\n"],"names":["pollWizardStoreDebug","pollWizardStoreSubscriptions","pollWizardStoreUtils","usePollWizardActions","usePollWizardCanGoBack","usePollWizardCanProceed","usePollWizardData","usePollWizardErrors","usePollWizardIsComplete","usePollWizardLoading","usePollWizardProgress","usePollWizardStats","usePollWizardStep","usePollWizardStepData","usePollWizardStepErrors","usePollWizardStepValidation","usePollWizardStore","INITIAL_WIZARD_DATA","title","description","category","options","tags","privacyLevel","allowMultipleVotes","showResults","isTemplate","settings","allowAnonymousVotes","requireAuthentication","requireEmail","allowWriteIns","allowComments","enableNotifications","maxSelections","votingMethod","moderationEnabled","autoClose","INITIAL_WIZARD_STATE","currentStep","totalSteps","data","isLoading","errors","progress","canGoBack","canProceed","isComplete","validateStep","step","trim","step1ValidOptions","filter","option","length","validOptions","uniqueOptions","Set","map","opt","toLowerCase","size","create","devtools","persist","set","get","nextStep","state","Math","min","prevStep","max","goToStep","targetStep","resetWizard","updateData","updates","newData","Object","keys","updateSettings","newSettings","addOption","newOptions","removeOption","index","_","i","updateOption","value","addTag","tag","includes","newTags","removeTag","t","updateTags","validateCurrentStep","setLoading","loading","setError","field","error","clearError","newErrors","clearAllErrors","getStepData","getProgress","canProceedToNextStep","isStepValid","getStepErrors","name","partialize","hasErrors","errorCount","isValid","getWizardSummary","getState","validateAllSteps","allErrors","stepErrors","assign","exportWizardData","timestamp","Date","toISOString","importWizardData","undefined","onStepChange","callback","previousStep","subscribe","onProgressChange","previousProgress","onDataChange","previousData","logState","logger","debug","logWizardData","reset","info"],"mappings":"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"}
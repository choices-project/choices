{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/auth/debug-login.test.ts"],"sourcesContent":["/**\n * Debug Login Route Test\n */\n\nimport { NextRequest } from 'next/server';\nimport { POST } from '@/app/api/auth/login/route';\n\n// Mock all dependencies\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(),\n}));\n\njest.mock('@/lib/utils/logger', () => ({\n  logger: {\n    info: jest.fn(),\n    error: jest.fn(),\n    warn: jest.fn(),\n  },\n}));\n\njest.mock('@/lib/core/security/rate-limit', () => ({\n  rateLimiters: {\n    auth: {\n      check: jest.fn().mockResolvedValue({ allowed: true, success: true })\n    }\n  }\n}));\n\njest.mock('@/app/api/auth/_shared', () => ({\n  validateCsrfProtection: jest.fn().mockReturnValue(true),\n  createCsrfErrorResponse: jest.fn().mockReturnValue(\n    new Response(JSON.stringify({ error: 'CSRF token validation failed' }), { status: 403 })\n  )\n}));\n\ndescribe('Debug Login Route', () => {\n  it('should debug the login route', async () => {\n    const mockSupabaseClient = {\n      auth: {\n        signInWithPassword: jest.fn().mockResolvedValue({\n          data: {\n            user: { id: 'user-123', email: 'test@example.com' },\n            session: { access_token: 'token' }\n          },\n          error: null,\n        }),\n      },\n      from: jest.fn(() => ({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: { id: 'user-123', is_active: true },\n              error: null,\n            }),\n          })),\n        })),\n      })),\n    };\n\n    const { getSupabaseServerClient } = require('@/utils/supabase/server');\n    getSupabaseServerClient.mockResolvedValue(mockSupabaseClient);\n\n    const request = new NextRequest('http://localhost:3000/api/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({\n        email: 'test@example.com',\n        password: 'password123',\n      }),\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    try {\n      const response = await POST(request);\n      console.log('Response:', response);\n      console.log('Response status:', response?.status);\n      console.log('Response type:', typeof response);\n      \n      if (response) {\n        const data = await response.json();\n        console.log('Response data:', data);\n      }\n    } catch (error) {\n      console.error('Error in POST:', error);\n      throw error;\n    }\n  });\n});\n"],"names":["jest","mock","getSupabaseServerClient","fn","logger","info","error","warn","rateLimiters","auth","check","mockResolvedValue","allowed","success","validateCsrfProtection","mockReturnValue","createCsrfErrorResponse","Response","JSON","stringify","status","describe","it","mockSupabaseClient","signInWithPassword","data","user","id","email","session","access_token","from","select","eq","single","is_active","require","request","NextRequest","method","body","password","headers","response","POST","console","log","json"],"mappings":"AAAA;;CAEC;AAKD,wBAAwB;AACxBA,KAAKC,IAAI,CAAC,2BAA2B,IAAO,CAAA;QAC1CC,yBAAyBF,KAAKG,EAAE;IAClC,CAAA;AAEAH,KAAKC,IAAI,CAAC,sBAAsB,IAAO,CAAA;QACrCG,QAAQ;YACNC,MAAML,KAAKG,EAAE;YACbG,OAAON,KAAKG,EAAE;YACdI,MAAMP,KAAKG,EAAE;QACf;IACF,CAAA;AAEAH,KAAKC,IAAI,CAAC,kCAAkC,IAAO,CAAA;QACjDO,cAAc;YACZC,MAAM;gBACJC,OAAOV,KAAKG,EAAE,GAAGQ,iBAAiB,CAAC;oBAAEC,SAAS;oBAAMC,SAAS;gBAAK;YACpE;QACF;IACF,CAAA;AAEAb,KAAKC,IAAI,CAAC,0BAA0B,IAAO,CAAA;QACzCa,wBAAwBd,KAAKG,EAAE,GAAGY,eAAe,CAAC;QAClDC,yBAAyBhB,KAAKG,EAAE,GAAGY,eAAe,CAChD,IAAIE,SAASC,KAAKC,SAAS,CAAC;YAAEb,OAAO;QAA+B,IAAI;YAAEc,QAAQ;QAAI;IAE1F,CAAA;;;;wBA7B4B;uBACP;AA8BrBC,SAAS,qBAAqB;IAC5BC,GAAG,gCAAgC;QACjC,MAAMC,qBAAqB;YACzBd,MAAM;gBACJe,oBAAoBxB,KAAKG,EAAE,GAAGQ,iBAAiB,CAAC;oBAC9Cc,MAAM;wBACJC,MAAM;4BAAEC,IAAI;4BAAYC,OAAO;wBAAmB;wBAClDC,SAAS;4BAAEC,cAAc;wBAAQ;oBACnC;oBACAxB,OAAO;gBACT;YACF;YACAyB,MAAM/B,KAAKG,EAAE,CAAC,IAAO,CAAA;oBACnB6B,QAAQhC,KAAKG,EAAE,CAAC,IAAO,CAAA;4BACrB8B,IAAIjC,KAAKG,EAAE,CAAC,IAAO,CAAA;oCACjB+B,QAAQlC,KAAKG,EAAE,GAAGQ,iBAAiB,CAAC;wCAClCc,MAAM;4CAAEE,IAAI;4CAAYQ,WAAW;wCAAK;wCACxC7B,OAAO;oCACT;gCACF,CAAA;wBACF,CAAA;gBACF,CAAA;QACF;QAEA,MAAM,EAAEJ,uBAAuB,EAAE,GAAGkC,QAAQ;QAC5ClC,wBAAwBS,iBAAiB,CAACY;QAE1C,MAAMc,UAAU,IAAIC,mBAAW,CAAC,wCAAwC;YACtEC,QAAQ;YACRC,MAAMtB,KAAKC,SAAS,CAAC;gBACnBS,OAAO;gBACPa,UAAU;YACZ;YACAC,SAAS;gBACP,gBAAgB;YAClB;QACF;QAEA,IAAI;YACF,MAAMC,WAAW,MAAMC,IAAAA,WAAI,EAACP;YAC5BQ,QAAQC,GAAG,CAAC,aAAaH;YACzBE,QAAQC,GAAG,CAAC,oBAAoBH,UAAUvB;YAC1CyB,QAAQC,GAAG,CAAC,kBAAkB,OAAOH;YAErC,IAAIA,UAAU;gBACZ,MAAMlB,OAAO,MAAMkB,SAASI,IAAI;gBAChCF,QAAQC,GAAG,CAAC,kBAAkBrB;YAChC;QACF,EAAE,OAAOnB,OAAO;YACduC,QAAQvC,KAAK,CAAC,kBAAkBA;YAChC,MAAMA;QACR;IACF;AACF"}
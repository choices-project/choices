{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/security/authentication-security-real.test.tsx"],"sourcesContent":["/**\n * Authentication Security Tests - REAL FUNCTIONALITY\n * \n * Tests security aspects of the authentication system using real functionality:\n * - Session management\n * - CSRF protection\n * - Rate limiting\n * - Input validation\n * - Password security\n * - WebAuthn security\n * - Data protection\n */\n\nimport { describe, it, expect, beforeEach } from '@jest/globals';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { BrowserRouter } from 'react-router-dom';\nimport SuperiorMobileFeed from '@/features/feeds/components/SuperiorMobileFeed';\n\n// Use real functionality - minimal mocking only for test environment setup\n\n// Mock localStorage for component functionality\nObject.defineProperty(window, 'localStorage', {\n  value: {\n    getItem: jest.fn(),\n    setItem: jest.fn(),\n    removeItem: jest.fn(),\n    clear: jest.fn(),\n  },\n  writable: true,\n});\n\n// Mock navigator for online status\nObject.defineProperty(navigator, 'onLine', {\n  value: true,\n  writable: true,\n});\n\n// Mock Notification API\nObject.defineProperty(window, 'Notification', {\n  value: {\n    permission: 'granted',\n    requestPermission: jest.fn().mockResolvedValue('granted'),\n  },\n  writable: true,\n});\n\n// Mock Service Worker\nObject.defineProperty(navigator, 'serviceWorker', {\n  value: {\n    register: jest.fn().mockResolvedValue({\n      installing: null,\n      waiting: null,\n      active: null,\n      addEventListener: jest.fn(),\n      removeEventListener: jest.fn(),\n    }),\n  },\n  writable: true,\n});\n\ndescribe('Authentication Security Tests - Real Functionality', () => {\n  beforeEach(() => {\n    // Clear any previous state\n    jest.clearAllMocks();\n  });\n\n  describe('Session Management', () => {\n    it('should handle session state properly', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check that component renders without authentication errors\n      expect(screen.getByRole('main')).toBeInTheDocument();\n    });\n\n    it('should handle offline state securely', async () => {\n      // Simulate offline state\n      Object.defineProperty(navigator, 'onLine', {\n        value: false,\n        writable: true,\n      });\n\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check that component handles offline state\n      expect(screen.getByRole('main')).toBeInTheDocument();\n    });\n  });\n\n  describe('Input Validation', () => {\n    it('should validate user input properly', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check for input elements\n      const searchInput = screen.getByRole('searchbox');\n      expect(searchInput).toBeInTheDocument();\n      \n      // Test input validation\n      fireEvent.change(searchInput, { target: { value: 'test input' } });\n      expect(searchInput).toHaveValue('test input');\n    });\n\n    it('should sanitize user input', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      const searchInput = screen.getByRole('searchbox');\n      \n      // Test with potentially malicious input\n      const maliciousInput = '<script>alert(\"xss\")</script>';\n      fireEvent.change(searchInput, { target: { value: maliciousInput } });\n      \n      // Input should be handled safely\n      expect(searchInput).toHaveValue(maliciousInput);\n    });\n  });\n\n  describe('Rate Limiting', () => {\n    it('should handle rapid interactions gracefully', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Test rapid button clicks\n      const buttons = screen.getAllByRole('button');\n      const firstButton = buttons[0];\n      \n      // Rapid clicks should not cause errors\n      for (let i = 0; i < 10; i++) {\n        fireEvent.click(firstButton);\n      }\n      \n      // Component should still be functional\n      expect(screen.getByRole('main')).toBeInTheDocument();\n    });\n\n    it('should handle API rate limiting', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Component should handle API calls gracefully\n      await waitFor(() => {\n        expect(screen.getByRole('main')).toBeInTheDocument();\n      });\n    });\n  });\n\n  describe('Data Protection', () => {\n    it('should handle sensitive data securely', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check that component doesn't expose sensitive data in DOM\n      const mainContent = screen.getByRole('main');\n      expect(mainContent).toBeInTheDocument();\n      \n      // No sensitive data should be visible in text content\n      const textContent = mainContent.textContent || '';\n      expect(textContent).not.toMatch(/password|secret|token/i);\n    });\n\n    it('should handle localStorage securely', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check that localStorage is used appropriately\n      expect(window.localStorage.getItem).toHaveBeenCalled();\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle errors securely', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Component should handle errors without exposing sensitive information\n      expect(screen.getByRole('main')).toBeInTheDocument();\n    });\n\n    it('should not expose stack traces to users', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check that error messages are user-friendly\n      const mainContent = screen.getByRole('main');\n      const textContent = mainContent.textContent || '';\n      \n      // Should not contain technical error details\n      expect(textContent).not.toMatch(/at\\s+\\w+\\.\\w+/);\n      expect(textContent).not.toMatch(/Error:\\s+/);\n    });\n  });\n\n  describe('Network Security', () => {\n    it('should handle network errors securely', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Component should handle network issues gracefully\n      await waitFor(() => {\n        expect(screen.getByRole('main')).toBeInTheDocument();\n      });\n    });\n\n    it('should validate API responses', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Component should validate API responses\n      await waitFor(() => {\n        expect(screen.getByRole('main')).toBeInTheDocument();\n      });\n    });\n  });\n\n  describe('Accessibility Security', () => {\n    it('should maintain accessibility during security operations', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check that security measures don't break accessibility\n      const mainContent = screen.getByRole('main');\n      expect(mainContent).toBeInTheDocument();\n      \n      // Check for proper ARIA attributes\n      const buttons = screen.getAllByRole('button');\n      buttons.forEach(button => {\n        expect(button).toHaveAttribute('aria-label');\n      });\n    });\n\n    it('should handle screen reader security announcements', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Check for live regions for security announcements\n      const liveRegions = screen.getAllByRole('status');\n      expect(liveRegions.length).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Performance Security', () => {\n    it('should handle performance under security constraints', async () => {\n      const startTime = performance.now();\n      \n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n      \n      const endTime = performance.now();\n      const renderTime = endTime - startTime;\n      \n      // Security measures should not significantly impact performance\n      expect(renderTime).toBeLessThan(500);\n    });\n\n    it('should handle memory usage securely', async () => {\n      render(\n        <BrowserRouter>\n          <SuperiorMobileFeed />\n        </BrowserRouter>\n      );\n\n      // Component should handle memory usage appropriately\n      expect(screen.getByRole('main')).toBeInTheDocument();\n    });\n  });\n});\n"],"names":["Object","defineProperty","window","value","getItem","jest","fn","setItem","removeItem","clear","writable","navigator","permission","requestPermission","mockResolvedValue","register","installing","waiting","active","addEventListener","removeEventListener","describe","beforeEach","clearAllMocks","it","render","BrowserRouter","SuperiorMobileFeed","expect","screen","getByRole","toBeInTheDocument","searchInput","fireEvent","change","target","toHaveValue","maliciousInput","buttons","getAllByRole","firstButton","i","click","waitFor","mainContent","textContent","not","toMatch","localStorage","toHaveBeenCalled","forEach","button","toHaveAttribute","liveRegions","length","toBeGreaterThan","startTime","performance","now","endTime","renderTime","toBeLessThan"],"mappings":"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"}
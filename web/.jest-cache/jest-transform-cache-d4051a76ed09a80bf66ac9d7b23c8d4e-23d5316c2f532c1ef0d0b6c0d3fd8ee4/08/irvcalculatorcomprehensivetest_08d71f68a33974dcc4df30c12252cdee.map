{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/lib/vote/irv-calculator-comprehensive.test.ts"],"sourcesContent":["/**\n * Comprehensive IRV Calculator Tests\n * \n * Tests the Instant Runoff Voting calculator with various scenarios\n * including edge cases, tie-breaking, and complex voting patterns\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { IRVCalculator } from '@/lib/vote/irv-calculator'\nimport type { Candidate, UserRanking, RankedChoiceResults } from '@/lib/vote/types'\n\n// Mock the logger\njest.mock('@/lib/utils/logger', () => ({\n  devLog: jest.fn()\n}))\n\ndescribe('IRVCalculator', () => {\n  let calculator: IRVCalculator\n  let candidates: Candidate[]\n  let userRankings: UserRanking[]\n\n  beforeEach(() => {\n    candidates = [\n      { id: 'candidate-1', name: 'Alice', description: 'Alice for Mayor' },\n      { id: 'candidate-2', name: 'Bob', description: 'Bob for Mayor' },\n      { id: 'candidate-3', name: 'Charlie', description: 'Charlie for Mayor' },\n      { id: 'candidate-4', name: 'Diana', description: 'Diana for Mayor' }\n    ]\n\n    userRankings = []\n  })\n\n  describe('Basic IRV Scenarios', () => {\n    it('should elect clear winner in first round', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2', 'candidate-3'] },\n        { userId: 'user-2', ranking: ['candidate-1', 'candidate-2', 'candidate-3'] },\n        { userId: 'user-3', ranking: ['candidate-1', 'candidate-2', 'candidate-3'] },\n        { userId: 'user-4', ranking: ['candidate-2', 'candidate-1', 'candidate-3'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.winner).toBe('candidate-1')\n      expect(results.totalVotes).toBe(4)\n      expect(results.rounds).toHaveLength(1)\n      expect(results.rounds[0].candidateVotes['candidate-1']).toBe(3)\n    })\n\n    it('should eliminate last place candidate and redistribute votes', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2', 'candidate-3'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1', 'candidate-3'] },\n        { userId: 'user-3', ranking: ['candidate-3', 'candidate-1', 'candidate-2'] },\n        { userId: 'user-4', ranking: ['candidate-3', 'candidate-2', 'candidate-1'] },\n        { userId: 'user-5', ranking: ['candidate-1', 'candidate-3', 'candidate-2'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(5)\n      expect(results.rounds.length).toBeGreaterThan(1)\n      \n      // First round should eliminate the candidate with least votes\n      const firstRound = results.rounds[0]\n      const voteCounts = Object.values(firstRound.candidateVotes)\n      const minVotes = Math.min(...voteCounts)\n      const eliminatedCandidates = Object.entries(firstRound.candidateVotes)\n        .filter(([_, votes]) => votes === minVotes)\n        .map(([candidate]) => candidate)\n      \n      expect(eliminatedCandidates.length).toBeGreaterThan(0)\n    })\n\n    it('should handle three-way tie correctly', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2', 'candidate-3'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1', 'candidate-3'] },\n        { userId: 'user-3', ranking: ['candidate-3', 'candidate-1', 'candidate-2'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(3)\n      expect(results.rounds.length).toBeGreaterThan(1)\n      \n      // All candidates should have 1 vote each in first round\n      const firstRound = results.rounds[0]\n      expect(firstRound.candidateVotes['candidate-1']).toBe(1)\n      expect(firstRound.candidateVotes['candidate-2']).toBe(1)\n      expect(firstRound.candidateVotes['candidate-3']).toBe(1)\n    })\n  })\n\n  describe('Edge Cases', () => {\n    it('should handle empty rankings', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      const results = calculator.calculateResults([])\n      \n      expect(results.winner).toBeNull()\n      expect(results.totalVotes).toBe(0)\n      expect(results.rounds).toHaveLength(0)\n    })\n\n    it('should handle single candidate', () => {\n      const singleCandidate = [candidates[0]]\n      calculator = new IRVCalculator('test-poll', singleCandidate)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1'] },\n        { userId: 'user-2', ranking: ['candidate-1'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.winner).toBe('candidate-1')\n      expect(results.totalVotes).toBe(2)\n    })\n\n    it('should handle invalid rankings gracefully', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2'] },\n        { userId: 'user-2', ranking: ['invalid-candidate'] }, // Invalid candidate\n        { userId: 'user-3', ranking: [] }, // Empty ranking\n        { userId: 'user-4', ranking: ['candidate-1', 'candidate-1'] } // Duplicate\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      // Should only count valid rankings\n      expect(results.totalVotes).toBe(2) // Only user-1 and user-4 have valid rankings\n    })\n\n    it('should handle withdrawn candidates', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      // Mark a candidate as withdrawn\n      calculator.candidates.set('candidate-3', {\n        ...candidates[2],\n        isWithdrawn: true\n      })\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2', 'candidate-3'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1', 'candidate-3'] },\n        { userId: 'user-3', ranking: ['candidate-3', 'candidate-1', 'candidate-2'] } // Should be ignored\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(2) // Only valid votes counted\n      expect(results.metadata.edgeCasesHandled).toContain('withdrawn_candidates')\n    })\n\n    it('should handle all candidates withdrawn', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      // Mark all candidates as withdrawn\n      candidates.forEach(candidate => {\n        calculator.candidates.set(candidate.id, {\n          ...candidate,\n          isWithdrawn: true\n        })\n      })\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.winner).toBeNull()\n      expect(results.totalVotes).toBe(0)\n      expect(results.metadata.edgeCasesHandled).toContain('no-candidates')\n    })\n  })\n\n  describe('Tie Breaking', () => {\n    it('should use deterministic tie breaking with seed', () => {\n      const seed = 'test-seed-123'\n      calculator = new IRVCalculator('test-poll', candidates, seed)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1'] }\n      ]\n\n      const results1 = calculator.calculateResults(userRankings)\n      \n      // Create new calculator with same seed\n      const calculator2 = new IRVCalculator('test-poll', candidates, seed)\n      const results2 = calculator2.calculateResults(userRankings)\n      \n      // Results should be identical with same seed\n      expect(results1.winner).toBe(results2.winner)\n      expect(results1.rounds.length).toBe(results2.rounds.length)\n    })\n\n    it('should handle multiple ties in same round', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2', 'candidate-3', 'candidate-4'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1', 'candidate-3', 'candidate-4'] },\n        { userId: 'user-3', ranking: ['candidate-3', 'candidate-1', 'candidate-2', 'candidate-4'] },\n        { userId: 'user-4', ranking: ['candidate-4', 'candidate-1', 'candidate-2', 'candidate-3'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(4)\n      expect(results.rounds.length).toBeGreaterThan(1)\n      \n      // First round should have all candidates tied\n      const firstRound = results.rounds[0]\n      const voteCounts = Object.values(firstRound.candidateVotes)\n      expect(voteCounts.every(count => count === 1)).toBe(true)\n    })\n  })\n\n  describe('Performance and Metadata', () => {\n    it('should track calculation time', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2', 'candidate-3'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1', 'candidate-3'] },\n        { userId: 'user-3', ranking: ['candidate-3', 'candidate-1', 'candidate-2'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.metadata.calculationTime).toBeGreaterThan(0)\n      expect(typeof results.metadata.calculationTime).toBe('number')\n    })\n\n    it('should track tie breaks used', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.metadata.tieBreaksUsed).toBeGreaterThanOrEqual(0)\n      expect(typeof results.metadata.tieBreaksUsed).toBe('number')\n    })\n\n    it('should handle large number of votes efficiently', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      // Generate 1000 votes\n      userRankings = Array.from({ length: 1000 }, (_, i) => ({\n        userId: `user-${i}`,\n        ranking: ['candidate-1', 'candidate-2', 'candidate-3', 'candidate-4']\n      }))\n\n      const startTime = performance.now()\n      const results = calculator.calculateResults(userRankings)\n      const endTime = performance.now()\n      \n      expect(results.totalVotes).toBe(1000)\n      expect(endTime - startTime).toBeLessThan(1000) // Should complete within 1 second\n    })\n  })\n\n  describe('Write-in Candidates', () => {\n    it('should handle write-in candidates', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'write-in-eve', 'candidate-2'] },\n        { userId: 'user-2', ranking: ['write-in-eve', 'candidate-1', 'candidate-2'] },\n        { userId: 'user-3', ranking: ['candidate-2', 'candidate-1', 'write-in-eve'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(3)\n      expect(results.rounds.length).toBeGreaterThan(0)\n      \n      // Write-in candidate should be included in results\n      const firstRound = results.rounds[0]\n      expect(firstRound.candidateVotes['write-in-eve']).toBeDefined()\n    })\n\n    it('should handle multiple write-in candidates', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['write-in-eve', 'write-in-frank', 'candidate-1'] },\n        { userId: 'user-2', ranking: ['write-in-frank', 'write-in-eve', 'candidate-1'] },\n        { userId: 'user-3', ranking: ['candidate-1', 'write-in-eve', 'write-in-frank'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(3)\n      \n      const firstRound = results.rounds[0]\n      expect(firstRound.candidateVotes['write-in-eve']).toBeDefined()\n      expect(firstRound.candidateVotes['write-in-frank']).toBeDefined()\n    })\n  })\n\n  describe('Complex Scenarios', () => {\n    it('should handle exhausted ballots', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1'] }, // Only one preference\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-1'] },\n        { userId: 'user-3', ranking: ['candidate-3', 'candidate-2'] },\n        { userId: 'user-4', ranking: ['candidate-4', 'candidate-3'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(4)\n      expect(results.rounds.length).toBeGreaterThan(1)\n      \n      // Should handle exhausted ballots correctly\n      const lastRound = results.rounds[results.rounds.length - 1]\n      expect(lastRound.exhaustedBallots).toBeGreaterThanOrEqual(0)\n    })\n\n    it('should handle circular preferences', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2', 'candidate-3', 'candidate-4'] },\n        { userId: 'user-2', ranking: ['candidate-2', 'candidate-3', 'candidate-4', 'candidate-1'] },\n        { userId: 'user-3', ranking: ['candidate-3', 'candidate-4', 'candidate-1', 'candidate-2'] },\n        { userId: 'user-4', ranking: ['candidate-4', 'candidate-1', 'candidate-2', 'candidate-3'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      expect(results.totalVotes).toBe(4)\n      expect(results.rounds.length).toBeGreaterThan(1)\n      \n      // Should eventually determine a winner\n      expect(results.winner).toBeDefined()\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('should handle malformed rankings gracefully', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2'] },\n        { userId: 'user-2', ranking: null as any }, // Malformed\n        { userId: 'user-3', ranking: undefined as any }, // Malformed\n        { userId: 'user-4', ranking: ['candidate-1'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      // Should only count valid rankings\n      expect(results.totalVotes).toBe(2)\n    })\n\n    it('should handle missing user IDs', () => {\n      calculator = new IRVCalculator('test-poll', candidates)\n      \n      userRankings = [\n        { userId: '', ranking: ['candidate-1', 'candidate-2'] }, // Empty user ID\n        { userId: null as any, ranking: ['candidate-1', 'candidate-2'] }, // Null user ID\n        { userId: 'user-1', ranking: ['candidate-1', 'candidate-2'] }\n      ]\n\n      const results = calculator.calculateResults(userRankings)\n      \n      // Should handle missing user IDs gracefully\n      expect(results.totalVotes).toBeGreaterThanOrEqual(1)\n    })\n  })\n})\n"],"names":["jest","mock","devLog","fn","describe","calculator","candidates","userRankings","beforeEach","id","name","description","it","IRVCalculator","userId","ranking","results","calculateResults","expect","winner","toBe","totalVotes","rounds","toHaveLength","candidateVotes","length","toBeGreaterThan","firstRound","voteCounts","Object","values","minVotes","Math","min","eliminatedCandidates","entries","filter","_","votes","map","candidate","toBeNull","singleCandidate","set","isWithdrawn","metadata","edgeCasesHandled","toContain","forEach","seed","results1","calculator2","results2","every","count","calculationTime","tieBreaksUsed","toBeGreaterThanOrEqual","Array","from","i","startTime","performance","now","endTime","toBeLessThan","toBeDefined","lastRound","exhaustedBallots","undefined"],"mappings":"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"}
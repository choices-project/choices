{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/lib/core/auth-comprehensive.test.ts"],"sourcesContent":["/**\n * Comprehensive Authentication System Tests\n * \n * Tests the authentication system including WebAuthn, \n * session management, and security features\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { createSecureServerAction } from '@/lib/core/auth/server-actions'\nimport type { ServerActionContext, ServerActionOptions } from '@/lib/core/auth/server-actions'\n\n// Mock external dependencies\njest.mock('@/lib/utils/logger', () => ({\n  devLog: jest.fn(),\n  logger: {\n    info: jest.fn(),\n    error: jest.fn(),\n    warn: jest.fn()\n  }\n}))\n\njest.mock('@/lib/utils/rate-limit', () => ({\n  checkRateLimit: jest.fn().mockResolvedValue({ allowed: true, remaining: 10 })\n}))\n\njest.mock('@/lib/utils/csrf', () => ({\n  validateCSRFToken: jest.fn().mockResolvedValue(true)\n}))\n\ndescribe('Authentication System', () => {\n  let mockContext: ServerActionContext\n  let mockOptions: ServerActionOptions\n\n  beforeEach(() => {\n    mockContext = {\n      userId: 'test-user-id',\n      sessionId: 'test-session-id',\n      ipAddress: '192.168.1.1',\n      userAgent: 'Mozilla/5.0',\n      timestamp: new Date()\n    }\n\n    mockOptions = {\n      requireAuth: true,\n      rateLimit: {\n        maxRequests: 10,\n        windowMs: 60000\n      },\n      csrfProtection: true\n    }\n  })\n\n  describe('Secure Server Actions', () => {\n    it('should create secure server action with authentication', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      const result = await secureAction({ test: 'data' }, mockContext)\n      \n      expect(result.success).toBe(true)\n      expect(mockAction).toHaveBeenCalledWith({ test: 'data' }, mockContext)\n    })\n\n    it('should handle authentication failures', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Authentication failed'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Authentication failed')\n    })\n\n    it('should enforce rate limiting', async () => {\n      const { checkRateLimit } = require('@/lib/utils/rate-limit')\n      checkRateLimit.mockResolvedValueOnce({ allowed: false, remaining: 0 })\n      \n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Rate limit exceeded')\n    })\n\n    it('should enforce CSRF protection', async () => {\n      const { validateCSRFToken } = require('@/lib/utils/csrf')\n      validateCSRFToken.mockResolvedValueOnce(false)\n      \n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('CSRF token validation failed')\n    })\n\n    it('should handle missing context gracefully', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, null as any))\n        .rejects.toThrow('Server action context is required')\n    })\n\n    it('should validate input data', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, {\n        ...mockOptions,\n        inputValidation: (input) => {\n          if (!input || typeof input !== 'object') {\n            throw new Error('Invalid input')\n          }\n          return true\n        }\n      })\n      \n      await expect(secureAction(null, mockContext))\n        .rejects.toThrow('Invalid input')\n    })\n\n    it('should handle server action errors gracefully', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Database connection failed'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Database connection failed')\n    })\n  })\n\n  describe('WebAuthn Integration', () => {\n    it('should handle WebAuthn registration', async () => {\n      const mockWebAuthnAction = jest.fn().mockResolvedValue({\n        credentialId: 'test-credential-id',\n        publicKey: 'test-public-key'\n      })\n      \n      const secureAction = createSecureServerAction(mockWebAuthnAction, mockOptions)\n      \n      const result = await secureAction({\n        credential: {\n          id: 'test-credential-id',\n          response: {\n            clientDataJSON: 'test-data',\n            attestationObject: 'test-attestation'\n          }\n        }\n      }, mockContext)\n      \n      expect(result.credentialId).toBe('test-credential-id')\n      expect(mockWebAuthnAction).toHaveBeenCalled()\n    })\n\n    it('should handle WebAuthn authentication', async () => {\n      const mockWebAuthnAction = jest.fn().mockResolvedValue({\n        verified: true,\n        userId: 'test-user-id'\n      })\n      \n      const secureAction = createSecureServerAction(mockWebAuthnAction, mockOptions)\n      \n      const result = await secureAction({\n        credential: {\n          id: 'test-credential-id',\n          response: {\n            clientDataJSON: 'test-data',\n            authenticatorData: 'test-auth-data',\n            signature: 'test-signature'\n          }\n        }\n      }, mockContext)\n      \n      expect(result.verified).toBe(true)\n      expect(result.userId).toBe('test-user-id')\n    })\n\n    it('should handle WebAuthn errors', async () => {\n      const mockWebAuthnAction = jest.fn().mockRejectedValue(new Error('WebAuthn verification failed'))\n      \n      const secureAction = createSecureServerAction(mockWebAuthnAction, mockOptions)\n      \n      await expect(secureAction({\n        credential: {\n          id: 'test-credential-id',\n          response: {}\n        }\n      }, mockContext)).rejects.toThrow('WebAuthn verification failed')\n    })\n  })\n\n  describe('Session Management', () => {\n    it('should handle session creation', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        sessionId: 'new-session-id',\n        expiresAt: new Date(Date.now() + 86400000)\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        userId: 'test-user-id',\n        deviceInfo: {\n          userAgent: 'Mozilla/5.0',\n          ipAddress: '192.168.1.1'\n        }\n      }, mockContext)\n      \n      expect(result.sessionId).toBe('new-session-id')\n      expect(result.expiresAt).toBeDefined()\n    })\n\n    it('should handle session validation', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        valid: true,\n        userId: 'test-user-id',\n        expiresAt: new Date(Date.now() + 86400000)\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        sessionId: 'test-session-id'\n      }, mockContext)\n      \n      expect(result.valid).toBe(true)\n      expect(result.userId).toBe('test-user-id')\n    })\n\n    it('should handle session expiration', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        valid: false,\n        reason: 'Session expired'\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        sessionId: 'expired-session-id'\n      }, mockContext)\n      \n      expect(result.valid).toBe(false)\n      expect(result.reason).toBe('Session expired')\n    })\n\n    it('should handle session revocation', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        revoked: true,\n        reason: 'User requested logout'\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        sessionId: 'test-session-id',\n        action: 'revoke'\n      }, mockContext)\n      \n      expect(result.revoked).toBe(true)\n      expect(result.reason).toBe('User requested logout')\n    })\n  })\n\n  describe('Security Features', () => {\n    it('should validate IP addresses', async () => {\n      const mockSecurityAction = jest.fn().mockResolvedValue({\n        allowed: true,\n        riskScore: 0.1\n      })\n      \n      const secureAction = createSecureServerAction(mockSecurityAction, {\n        ...mockOptions,\n        ipValidation: true\n      })\n      \n      const result = await secureAction({\n        ipAddress: '192.168.1.1'\n      }, mockContext)\n      \n      expect(result.allowed).toBe(true)\n      expect(result.riskScore).toBeLessThan(0.5)\n    })\n\n    it('should detect suspicious activity', async () => {\n      const mockSecurityAction = jest.fn().mockResolvedValue({\n        allowed: false,\n        reason: 'Suspicious activity detected',\n        riskScore: 0.9\n      })\n      \n      const secureAction = createSecureServerAction(mockSecurityAction, mockOptions)\n      \n      const result = await secureAction({\n        ipAddress: '192.168.1.1',\n        userAgent: 'Suspicious Bot'\n      }, mockContext)\n      \n      expect(result.allowed).toBe(false)\n      expect(result.riskScore).toBeGreaterThan(0.8)\n    })\n\n    it('should handle brute force protection', async () => {\n      const mockSecurityAction = jest.fn().mockResolvedValue({\n        allowed: false,\n        reason: 'Too many failed attempts',\n        lockoutDuration: 300000 // 5 minutes\n      })\n      \n      const secureAction = createSecureServerAction(mockSecurityAction, mockOptions)\n      \n      const result = await secureAction({\n        username: 'test-user',\n        password: 'wrong-password'\n      }, mockContext)\n      \n      expect(result.allowed).toBe(false)\n      expect(result.lockoutDuration).toBeGreaterThan(0)\n    })\n\n    it('should validate user permissions', async () => {\n      const mockPermissionAction = jest.fn().mockResolvedValue({\n        authorized: true,\n        permissions: ['read', 'write']\n      })\n      \n      const secureAction = createSecureServerAction(mockPermissionAction, {\n        ...mockOptions,\n        requiredPermissions: ['read']\n      })\n      \n      const result = await secureAction({\n        resource: 'user-data',\n        action: 'read'\n      }, mockContext)\n      \n      expect(result.authorized).toBe(true)\n      expect(result.permissions).toContain('read')\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('should handle network errors gracefully', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Network timeout'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Network timeout')\n    })\n\n    it('should handle database errors gracefully', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Database connection lost'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Database connection lost')\n    })\n\n    it('should handle validation errors', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Invalid email format'))\n      \n      const secureAction = createSecureServerAction(mockAction, {\n        ...mockOptions,\n        inputValidation: (input) => {\n          if (!input.email || !input.email.includes('@')) {\n            throw new Error('Invalid email format')\n          }\n          return true\n        }\n      })\n      \n      await expect(secureAction({ email: 'invalid-email' }, mockContext))\n        .rejects.toThrow('Invalid email format')\n    })\n\n    it('should handle concurrent request conflicts', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Concurrent modification detected'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Concurrent modification detected')\n    })\n  })\n\n  describe('Performance', () => {\n    it('should handle high load efficiently', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      const startTime = performance.now()\n      \n      // Simulate multiple concurrent requests\n      const promises = Array.from({ length: 100 }, (_, i) => \n        secureAction({ test: `data-${i}` }, { ...mockContext, userId: `user-${i}` })\n      )\n      \n      const results = await Promise.all(promises)\n      const endTime = performance.now()\n      \n      expect(results).toHaveLength(100)\n      expect(endTime - startTime).toBeLessThan(5000) // Should complete within 5 seconds\n    })\n\n    it('should handle memory efficiently', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      const initialMemory = process.memoryUsage().heapUsed\n      \n      // Process many requests\n      for (let i = 0; i < 1000; i++) {\n        await secureAction({ test: `data-${i}` }, { ...mockContext, userId: `user-${i}` })\n      }\n      \n      const finalMemory = process.memoryUsage().heapUsed\n      const memoryIncrease = finalMemory - initialMemory\n      \n      // Memory increase should be reasonable (less than 100MB)\n      expect(memoryIncrease).toBeLessThan(100 * 1024 * 1024)\n    })\n  })\n})\n\n\n\n\n"],"names":["jest","mock","devLog","fn","logger","info","error","warn","checkRateLimit","mockResolvedValue","allowed","remaining","validateCSRFToken","describe","mockContext","mockOptions","beforeEach","userId","sessionId","ipAddress","userAgent","timestamp","Date","requireAuth","rateLimit","maxRequests","windowMs","csrfProtection","it","mockAction","success","secureAction","createSecureServerAction","result","test","expect","toBe","toHaveBeenCalledWith","mockRejectedValue","Error","rejects","toThrow","require","mockResolvedValueOnce","inputValidation","input","mockWebAuthnAction","credentialId","publicKey","credential","id","response","clientDataJSON","attestationObject","toHaveBeenCalled","verified","authenticatorData","signature","mockSessionAction","expiresAt","now","deviceInfo","toBeDefined","valid","reason","revoked","action","mockSecurityAction","riskScore","ipValidation","toBeLessThan","toBeGreaterThan","lockoutDuration","username","password","mockPermissionAction","authorized","permissions","requiredPermissions","resource","toContain","email","includes","startTime","performance","promises","Array","from","length","_","i","results","Promise","all","endTime","toHaveLength","initialMemory","process","memoryUsage","heapUsed","finalMemory","memoryIncrease"],"mappings":"AAAA;;;;;CAKC;;;;yBAEsD;+BACd;AAGzC,6BAA6B;AAC7BA,aAAI,CAACC,IAAI,CAAC,sBAAsB,IAAO,CAAA;QACrCC,QAAQF,aAAI,CAACG,EAAE;QACfC,QAAQ;YACNC,MAAML,aAAI,CAACG,EAAE;YACbG,OAAON,aAAI,CAACG,EAAE;YACdI,MAAMP,aAAI,CAACG,EAAE;QACf;IACF,CAAA;AAEAH,aAAI,CAACC,IAAI,CAAC,0BAA0B,IAAO,CAAA;QACzCO,gBAAgBR,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;YAAEC,SAAS;YAAMC,WAAW;QAAG;IAC7E,CAAA;AAEAX,aAAI,CAACC,IAAI,CAAC,oBAAoB,IAAO,CAAA;QACnCW,mBAAmBZ,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;IACjD,CAAA;AAEAI,IAAAA,iBAAQ,EAAC,yBAAyB;IAChC,IAAIC;IACJ,IAAIC;IAEJC,IAAAA,mBAAU,EAAC;QACTF,cAAc;YACZG,QAAQ;YACRC,WAAW;YACXC,WAAW;YACXC,WAAW;YACXC,WAAW,IAAIC;QACjB;QAEAP,cAAc;YACZQ,aAAa;YACbC,WAAW;gBACTC,aAAa;gBACbC,UAAU;YACZ;YACAC,gBAAgB;QAClB;IACF;IAEAd,IAAAA,iBAAQ,EAAC,yBAAyB;QAChCe,IAAAA,WAAE,EAAC,0DAA0D;YAC3D,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBAAEqB,SAAS;YAAK;YAE/D,MAAMC,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMkB,SAAS,MAAMF,aAAa;gBAAEG,MAAM;YAAO,GAAGpB;YAEpDqB,IAAAA,eAAM,EAACF,OAAOH,OAAO,EAAEM,IAAI,CAAC;YAC5BD,IAAAA,eAAM,EAACN,YAAYQ,oBAAoB,CAAC;gBAAEH,MAAM;YAAO,GAAGpB;QAC5D;QAEAc,IAAAA,WAAE,EAAC,yCAAyC;YAC1C,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGmC,iBAAiB,CAAC,IAAIC,MAAM;YAEzD,MAAMR,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAGpB,cACzC0B,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,gCAAgC;YACjC,MAAM,EAAEpB,cAAc,EAAE,GAAGkC,QAAQ;YACnClC,eAAemC,qBAAqB,CAAC;gBAAEjC,SAAS;gBAAOC,WAAW;YAAE;YAEpE,MAAMkB,aAAa7B,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBAAEqB,SAAS;YAAK;YAC/D,MAAMC,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAGpB,cACzC0B,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,kCAAkC;YACnC,MAAM,EAAEhB,iBAAiB,EAAE,GAAG8B,QAAQ;YACtC9B,kBAAkB+B,qBAAqB,CAAC;YAExC,MAAMd,aAAa7B,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBAAEqB,SAAS;YAAK;YAC/D,MAAMC,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAGpB,cACzC0B,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,4CAA4C;YAC7C,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBAAEqB,SAAS;YAAK;YAC/D,MAAMC,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAG,OACzCM,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,8BAA8B;YAC/B,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBAAEqB,SAAS;YAAK;YAC/D,MAAMC,eAAeC,IAAAA,uCAAwB,EAACH,YAAY;gBACxD,GAAGd,WAAW;gBACd6B,iBAAiB,CAACC;oBAChB,IAAI,CAACA,SAAS,OAAOA,UAAU,UAAU;wBACvC,MAAM,IAAIN,MAAM;oBAClB;oBACA,OAAO;gBACT;YACF;YAEA,MAAMJ,IAAAA,eAAM,EAACJ,aAAa,MAAMjB,cAC7B0B,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,iDAAiD;YAClD,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGmC,iBAAiB,CAAC,IAAIC,MAAM;YAEzD,MAAMR,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAGpB,cACzC0B,OAAO,CAACC,OAAO,CAAC;QACrB;IACF;IAEA5B,IAAAA,iBAAQ,EAAC,wBAAwB;QAC/Be,IAAAA,WAAE,EAAC,uCAAuC;YACxC,MAAMkB,qBAAqB9C,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACrDsC,cAAc;gBACdC,WAAW;YACb;YAEA,MAAMjB,eAAeC,IAAAA,uCAAwB,EAACc,oBAAoB/B;YAElE,MAAMkB,SAAS,MAAMF,aAAa;gBAChCkB,YAAY;oBACVC,IAAI;oBACJC,UAAU;wBACRC,gBAAgB;wBAChBC,mBAAmB;oBACrB;gBACF;YACF,GAAGvC;YAEHqB,IAAAA,eAAM,EAACF,OAAOc,YAAY,EAAEX,IAAI,CAAC;YACjCD,IAAAA,eAAM,EAACW,oBAAoBQ,gBAAgB;QAC7C;QAEA1B,IAAAA,WAAE,EAAC,yCAAyC;YAC1C,MAAMkB,qBAAqB9C,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACrD8C,UAAU;gBACVtC,QAAQ;YACV;YAEA,MAAMc,eAAeC,IAAAA,uCAAwB,EAACc,oBAAoB/B;YAElE,MAAMkB,SAAS,MAAMF,aAAa;gBAChCkB,YAAY;oBACVC,IAAI;oBACJC,UAAU;wBACRC,gBAAgB;wBAChBI,mBAAmB;wBACnBC,WAAW;oBACb;gBACF;YACF,GAAG3C;YAEHqB,IAAAA,eAAM,EAACF,OAAOsB,QAAQ,EAAEnB,IAAI,CAAC;YAC7BD,IAAAA,eAAM,EAACF,OAAOhB,MAAM,EAAEmB,IAAI,CAAC;QAC7B;QAEAR,IAAAA,WAAE,EAAC,iCAAiC;YAClC,MAAMkB,qBAAqB9C,aAAI,CAACG,EAAE,GAAGmC,iBAAiB,CAAC,IAAIC,MAAM;YAEjE,MAAMR,eAAeC,IAAAA,uCAAwB,EAACc,oBAAoB/B;YAElE,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBACxBkB,YAAY;oBACVC,IAAI;oBACJC,UAAU,CAAC;gBACb;YACF,GAAGrC,cAAc0B,OAAO,CAACC,OAAO,CAAC;QACnC;IACF;IAEA5B,IAAAA,iBAAQ,EAAC,sBAAsB;QAC7Be,IAAAA,WAAE,EAAC,kCAAkC;YACnC,MAAM8B,oBAAoB1D,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACpDS,WAAW;gBACXyC,WAAW,IAAIrC,KAAKA,KAAKsC,GAAG,KAAK;YACnC;YAEA,MAAM7B,eAAeC,IAAAA,uCAAwB,EAAC0B,mBAAmB3C;YAEjE,MAAMkB,SAAS,MAAMF,aAAa;gBAChCd,QAAQ;gBACR4C,YAAY;oBACVzC,WAAW;oBACXD,WAAW;gBACb;YACF,GAAGL;YAEHqB,IAAAA,eAAM,EAACF,OAAOf,SAAS,EAAEkB,IAAI,CAAC;YAC9BD,IAAAA,eAAM,EAACF,OAAO0B,SAAS,EAAEG,WAAW;QACtC;QAEAlC,IAAAA,WAAE,EAAC,oCAAoC;YACrC,MAAM8B,oBAAoB1D,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACpDsD,OAAO;gBACP9C,QAAQ;gBACR0C,WAAW,IAAIrC,KAAKA,KAAKsC,GAAG,KAAK;YACnC;YAEA,MAAM7B,eAAeC,IAAAA,uCAAwB,EAAC0B,mBAAmB3C;YAEjE,MAAMkB,SAAS,MAAMF,aAAa;gBAChCb,WAAW;YACb,GAAGJ;YAEHqB,IAAAA,eAAM,EAACF,OAAO8B,KAAK,EAAE3B,IAAI,CAAC;YAC1BD,IAAAA,eAAM,EAACF,OAAOhB,MAAM,EAAEmB,IAAI,CAAC;QAC7B;QAEAR,IAAAA,WAAE,EAAC,oCAAoC;YACrC,MAAM8B,oBAAoB1D,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACpDsD,OAAO;gBACPC,QAAQ;YACV;YAEA,MAAMjC,eAAeC,IAAAA,uCAAwB,EAAC0B,mBAAmB3C;YAEjE,MAAMkB,SAAS,MAAMF,aAAa;gBAChCb,WAAW;YACb,GAAGJ;YAEHqB,IAAAA,eAAM,EAACF,OAAO8B,KAAK,EAAE3B,IAAI,CAAC;YAC1BD,IAAAA,eAAM,EAACF,OAAO+B,MAAM,EAAE5B,IAAI,CAAC;QAC7B;QAEAR,IAAAA,WAAE,EAAC,oCAAoC;YACrC,MAAM8B,oBAAoB1D,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACpDwD,SAAS;gBACTD,QAAQ;YACV;YAEA,MAAMjC,eAAeC,IAAAA,uCAAwB,EAAC0B,mBAAmB3C;YAEjE,MAAMkB,SAAS,MAAMF,aAAa;gBAChCb,WAAW;gBACXgD,QAAQ;YACV,GAAGpD;YAEHqB,IAAAA,eAAM,EAACF,OAAOgC,OAAO,EAAE7B,IAAI,CAAC;YAC5BD,IAAAA,eAAM,EAACF,OAAO+B,MAAM,EAAE5B,IAAI,CAAC;QAC7B;IACF;IAEAvB,IAAAA,iBAAQ,EAAC,qBAAqB;QAC5Be,IAAAA,WAAE,EAAC,gCAAgC;YACjC,MAAMuC,qBAAqBnE,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACrDC,SAAS;gBACT0D,WAAW;YACb;YAEA,MAAMrC,eAAeC,IAAAA,uCAAwB,EAACmC,oBAAoB;gBAChE,GAAGpD,WAAW;gBACdsD,cAAc;YAChB;YAEA,MAAMpC,SAAS,MAAMF,aAAa;gBAChCZ,WAAW;YACb,GAAGL;YAEHqB,IAAAA,eAAM,EAACF,OAAOvB,OAAO,EAAE0B,IAAI,CAAC;YAC5BD,IAAAA,eAAM,EAACF,OAAOmC,SAAS,EAAEE,YAAY,CAAC;QACxC;QAEA1C,IAAAA,WAAE,EAAC,qCAAqC;YACtC,MAAMuC,qBAAqBnE,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACrDC,SAAS;gBACTsD,QAAQ;gBACRI,WAAW;YACb;YAEA,MAAMrC,eAAeC,IAAAA,uCAAwB,EAACmC,oBAAoBpD;YAElE,MAAMkB,SAAS,MAAMF,aAAa;gBAChCZ,WAAW;gBACXC,WAAW;YACb,GAAGN;YAEHqB,IAAAA,eAAM,EAACF,OAAOvB,OAAO,EAAE0B,IAAI,CAAC;YAC5BD,IAAAA,eAAM,EAACF,OAAOmC,SAAS,EAAEG,eAAe,CAAC;QAC3C;QAEA3C,IAAAA,WAAE,EAAC,wCAAwC;YACzC,MAAMuC,qBAAqBnE,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACrDC,SAAS;gBACTsD,QAAQ;gBACRQ,iBAAiB,OAAO,YAAY;YACtC;YAEA,MAAMzC,eAAeC,IAAAA,uCAAwB,EAACmC,oBAAoBpD;YAElE,MAAMkB,SAAS,MAAMF,aAAa;gBAChC0C,UAAU;gBACVC,UAAU;YACZ,GAAG5D;YAEHqB,IAAAA,eAAM,EAACF,OAAOvB,OAAO,EAAE0B,IAAI,CAAC;YAC5BD,IAAAA,eAAM,EAACF,OAAOuC,eAAe,EAAED,eAAe,CAAC;QACjD;QAEA3C,IAAAA,WAAE,EAAC,oCAAoC;YACrC,MAAM+C,uBAAuB3E,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBACvDmE,YAAY;gBACZC,aAAa;oBAAC;oBAAQ;iBAAQ;YAChC;YAEA,MAAM9C,eAAeC,IAAAA,uCAAwB,EAAC2C,sBAAsB;gBAClE,GAAG5D,WAAW;gBACd+D,qBAAqB;oBAAC;iBAAO;YAC/B;YAEA,MAAM7C,SAAS,MAAMF,aAAa;gBAChCgD,UAAU;gBACVb,QAAQ;YACV,GAAGpD;YAEHqB,IAAAA,eAAM,EAACF,OAAO2C,UAAU,EAAExC,IAAI,CAAC;YAC/BD,IAAAA,eAAM,EAACF,OAAO4C,WAAW,EAAEG,SAAS,CAAC;QACvC;IACF;IAEAnE,IAAAA,iBAAQ,EAAC,kBAAkB;QACzBe,IAAAA,WAAE,EAAC,2CAA2C;YAC5C,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGmC,iBAAiB,CAAC,IAAIC,MAAM;YAEzD,MAAMR,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAGpB,cACzC0B,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,4CAA4C;YAC7C,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGmC,iBAAiB,CAAC,IAAIC,MAAM;YAEzD,MAAMR,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAGpB,cACzC0B,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,mCAAmC;YACpC,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGmC,iBAAiB,CAAC,IAAIC,MAAM;YAEzD,MAAMR,eAAeC,IAAAA,uCAAwB,EAACH,YAAY;gBACxD,GAAGd,WAAW;gBACd6B,iBAAiB,CAACC;oBAChB,IAAI,CAACA,MAAMoC,KAAK,IAAI,CAACpC,MAAMoC,KAAK,CAACC,QAAQ,CAAC,MAAM;wBAC9C,MAAM,IAAI3C,MAAM;oBAClB;oBACA,OAAO;gBACT;YACF;YAEA,MAAMJ,IAAAA,eAAM,EAACJ,aAAa;gBAAEkD,OAAO;YAAgB,GAAGnE,cACnD0B,OAAO,CAACC,OAAO,CAAC;QACrB;QAEAb,IAAAA,WAAE,EAAC,8CAA8C;YAC/C,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGmC,iBAAiB,CAAC,IAAIC,MAAM;YAEzD,MAAMR,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoB,IAAAA,eAAM,EAACJ,aAAa;gBAAEG,MAAM;YAAO,GAAGpB,cACzC0B,OAAO,CAACC,OAAO,CAAC;QACrB;IACF;IAEA5B,IAAAA,iBAAQ,EAAC,eAAe;QACtBe,IAAAA,WAAE,EAAC,uCAAuC;YACxC,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBAAEqB,SAAS;YAAK;YAC/D,MAAMC,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMoE,YAAYC,YAAYxB,GAAG;YAEjC,wCAAwC;YACxC,MAAMyB,WAAWC,MAAMC,IAAI,CAAC;gBAAEC,QAAQ;YAAI,GAAG,CAACC,GAAGC,IAC/C3D,aAAa;oBAAEG,MAAM,CAAC,KAAK,EAAEwD,EAAE,CAAC;gBAAC,GAAG;oBAAE,GAAG5E,WAAW;oBAAEG,QAAQ,CAAC,KAAK,EAAEyE,EAAE,CAAC;gBAAC;YAG5E,MAAMC,UAAU,MAAMC,QAAQC,GAAG,CAACR;YAClC,MAAMS,UAAUV,YAAYxB,GAAG;YAE/BzB,IAAAA,eAAM,EAACwD,SAASI,YAAY,CAAC;YAC7B5D,IAAAA,eAAM,EAAC2D,UAAUX,WAAWb,YAAY,CAAC,MAAM,mCAAmC;;QACpF;QAEA1C,IAAAA,WAAE,EAAC,oCAAoC;YACrC,MAAMC,aAAa7B,aAAI,CAACG,EAAE,GAAGM,iBAAiB,CAAC;gBAAEqB,SAAS;YAAK;YAC/D,MAAMC,eAAeC,IAAAA,uCAAwB,EAACH,YAAYd;YAE1D,MAAMiF,gBAAgBC,QAAQC,WAAW,GAAGC,QAAQ;YAEpD,wBAAwB;YACxB,IAAK,IAAIT,IAAI,GAAGA,IAAI,MAAMA,IAAK;gBAC7B,MAAM3D,aAAa;oBAAEG,MAAM,CAAC,KAAK,EAAEwD,EAAE,CAAC;gBAAC,GAAG;oBAAE,GAAG5E,WAAW;oBAAEG,QAAQ,CAAC,KAAK,EAAEyE,EAAE,CAAC;gBAAC;YAClF;YAEA,MAAMU,cAAcH,QAAQC,WAAW,GAAGC,QAAQ;YAClD,MAAME,iBAAiBD,cAAcJ;YAErC,yDAAyD;YACzD7D,IAAAA,eAAM,EAACkE,gBAAgB/B,YAAY,CAAC,MAAM,OAAO;QACnD;IACF;AACF"}
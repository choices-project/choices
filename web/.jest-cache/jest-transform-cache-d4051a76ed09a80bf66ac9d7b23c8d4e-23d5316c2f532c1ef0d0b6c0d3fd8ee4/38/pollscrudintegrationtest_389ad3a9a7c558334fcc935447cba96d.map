{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/core/polls-crud-integration.test.ts"],"sourcesContent":["/**\n * Polls CRUD API Tests - INTEGRATION VERSION\n * \n * This is an integration test that uses real database connections.\n * No mocks - tests actual API endpoints with real Supabase database.\n */\n\nimport { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET, POST } from '@/app/api/polls/route';\n\n// This is an integration test - use real database connections\n// No mocks needed - let the API connect to real Supabase database\n\n// Set real Supabase credentials for integration testing\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://muqwrehywjrbaeerjgfb.supabase.co';\nprocess.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\n\ndescribe('Polls CRUD API - INTEGRATION', () => {\n  beforeEach(() => {\n    // No mocks to clear - using real database\n  });\n\n  afterEach(() => {\n    // No mocks to restore - using real database\n  });\n\n  describe('GET /api/polls - List Polls', () => {\n    it('should return list of polls', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      \n      const response = await GET(request);\n      const responseData = await response.json();\n\n      // Debug: Let's see what we actually get\n      console.log('Response status:', response.status);\n      console.log('Response data:', responseData);\n\n      // For now, just check that we get a response\n      // We'll evolve this to check the exact structure later\n      expect(response.status).toBe(200);\n      expect(responseData).toHaveProperty('success');\n      expect(responseData).toHaveProperty('polls');\n    });\n\n    it('should handle errors gracefully', async () => {\n      // Test with invalid request to trigger error handling\n      const request = new NextRequest('http://localhost:3000/api/polls?invalid=param');\n      const response = await GET(request);\n      const responseData = await response.json();\n\n      // Should still return 200 but with error handling\n      expect(response.status).toBe(200);\n      expect(responseData).toHaveProperty('success');\n    });\n  });\n\n  describe('POST /api/polls - Create Poll', () => {\n    it('should create a new poll with valid data', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'New Option 1' },\n            { text: 'New Option 2' }\n          ]\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      console.log('POST Response status:', response.status);\n      console.log('POST Response data:', responseData);\n\n      // For now, just check that we get a response\n      expect(response.status).toBe(201);\n      expect(responseData).toHaveProperty('success');\n      expect(responseData).toHaveProperty('poll');\n    });\n\n    it('should reject poll creation without authentication', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'Unauthorized Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' }\n          ]\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      console.log('Unauthorized Response status:', response.status);\n      console.log('Unauthorized Response data:', responseData);\n\n      // Should reject without authentication\n      expect(response.status).toBe(401);\n      expect(responseData).toHaveProperty('error');\n    });\n  });\n});\n"],"names":["process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","describe","beforeEach","afterEach","it","request","NextRequest","response","GET","responseData","json","console","log","status","expect","toBe","toHaveProperty","method","headers","body","JSON","stringify","title","options","text","POST"],"mappings":"AAAA;;;;;CAKC;;;;yBAE2D;wBAChC;uBACF;AAE1B,8DAA8D;AAC9D,kEAAkE;AAElE,wDAAwD;AACxDA,QAAQC,GAAG,CAACC,wBAAwB,GAAG;AACvCF,QAAQC,GAAG,CAACE,6BAA6B,GAAG;AAE5CC,IAAAA,iBAAQ,EAAC,gCAAgC;IACvCC,IAAAA,mBAAU,EAAC;IACT,0CAA0C;IAC5C;IAEAC,IAAAA,kBAAS,EAAC;IACR,4CAA4C;IAC9C;IAEAF,IAAAA,iBAAQ,EAAC,+BAA+B;QACtCG,IAAAA,WAAE,EAAC,+BAA+B;YAChC,MAAMC,UAAU,IAAIC,mBAAW,CAAC;YAEhC,MAAMC,WAAW,MAAMC,IAAAA,UAAG,EAACH;YAC3B,MAAMI,eAAe,MAAMF,SAASG,IAAI;YAExC,wCAAwC;YACxCC,QAAQC,GAAG,CAAC,oBAAoBL,SAASM,MAAM;YAC/CF,QAAQC,GAAG,CAAC,kBAAkBH;YAE9B,6CAA6C;YAC7C,uDAAuD;YACvDK,IAAAA,eAAM,EAACP,SAASM,MAAM,EAAEE,IAAI,CAAC;YAC7BD,IAAAA,eAAM,EAACL,cAAcO,cAAc,CAAC;YACpCF,IAAAA,eAAM,EAACL,cAAcO,cAAc,CAAC;QACtC;QAEAZ,IAAAA,WAAE,EAAC,mCAAmC;YACpC,sDAAsD;YACtD,MAAMC,UAAU,IAAIC,mBAAW,CAAC;YAChC,MAAMC,WAAW,MAAMC,IAAAA,UAAG,EAACH;YAC3B,MAAMI,eAAe,MAAMF,SAASG,IAAI;YAExC,kDAAkD;YAClDI,IAAAA,eAAM,EAACP,SAASM,MAAM,EAAEE,IAAI,CAAC;YAC7BD,IAAAA,eAAM,EAACL,cAAcO,cAAc,CAAC;QACtC;IACF;IAEAf,IAAAA,iBAAQ,EAAC,iCAAiC;QACxCG,IAAAA,WAAE,EAAC,4CAA4C;YAC7C,MAAMC,UAAU,IAAIC,mBAAW,CAAC,mCAAmC;gBACjEW,QAAQ;gBACRC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,MAAMC,KAAKC,SAAS,CAAC;oBACnBC,OAAO;oBACPC,SAAS;wBACP;4BAAEC,MAAM;wBAAe;wBACvB;4BAAEA,MAAM;wBAAe;qBACxB;gBACH;YACF;YAEA,MAAMjB,WAAW,MAAMkB,IAAAA,WAAI,EAACpB;YAC5B,MAAMI,eAAe,MAAMF,SAASG,IAAI;YAExCC,QAAQC,GAAG,CAAC,yBAAyBL,SAASM,MAAM;YACpDF,QAAQC,GAAG,CAAC,uBAAuBH;YAEnC,6CAA6C;YAC7CK,IAAAA,eAAM,EAACP,SAASM,MAAM,EAAEE,IAAI,CAAC;YAC7BD,IAAAA,eAAM,EAACL,cAAcO,cAAc,CAAC;YACpCF,IAAAA,eAAM,EAACL,cAAcO,cAAc,CAAC;QACtC;QAEAZ,IAAAA,WAAE,EAAC,sDAAsD;YACvD,MAAMC,UAAU,IAAIC,mBAAW,CAAC,mCAAmC;gBACjEW,QAAQ;gBACRC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,MAAMC,KAAKC,SAAS,CAAC;oBACnBC,OAAO;oBACPC,SAAS;wBACP;4BAAEC,MAAM;wBAAW;wBACnB;4BAAEA,MAAM;wBAAW;qBACpB;gBACH;YACF;YAEA,MAAMjB,WAAW,MAAMkB,IAAAA,WAAI,EAACpB;YAC5B,MAAMI,eAAe,MAAMF,SAASG,IAAI;YAExCC,QAAQC,GAAG,CAAC,iCAAiCL,SAASM,MAAM;YAC5DF,QAAQC,GAAG,CAAC,+BAA+BH;YAE3C,uCAAuC;YACvCK,IAAAA,eAAM,EAACP,SAASM,MAAM,EAAEE,IAAI,CAAC;YAC7BD,IAAAA,eAAM,EAACL,cAAcO,cAAc,CAAC;QACtC;IACF;AACF"}
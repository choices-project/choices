{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/hooks/usePWA.ts"],"sourcesContent":["/**\n * PWA Hook\n * \n * Comprehensive hook that provides PWA functionality including\n * installation, offline status, service worker management, and notifications.\n */\n\nimport { useState, useEffect, useCallback } from 'react';\n\nimport { isFeatureEnabled } from '@/lib/core/feature-flags';\nimport { \n  pwaInstallationManager, \n  type InstallationStatus, \n  type InstallationResult \n} from '@/lib/pwa/installation';\nimport { \n  serviceWorkerManager, \n  type ServiceWorkerStatus \n} from '@/lib/pwa/service-worker';\nimport { logger } from '@/lib/utils/logger';\nimport { withOptional } from '@/lib/utils/objects';\n\n// Import PWA managers\n\nexport interface PWAStatus {\n  // Feature availability\n  isSupported: boolean;\n  isEnabled: boolean;\n  \n  // Installation\n  installation: InstallationStatus;\n  \n  // Service Worker\n  serviceWorker: ServiceWorkerStatus;\n  \n  // Connection\n  isOnline: boolean;\n  \n  // Offline data\n  offlineVotes: number;\n  hasOfflineData: boolean;\n  \n  // Notifications\n  notificationsSupported: boolean;\n  notificationsEnabled: boolean;\n  notificationsPermission: NotificationPermission;\n  \n  // Loading states\n  loading: boolean;\n  error: string | null;\n}\n\nexport interface PWAActions {\n  // Installation\n  promptInstallation: () => Promise<InstallationResult>;\n  \n  // Service Worker\n  checkForUpdates: () => Promise<boolean>;\n  skipWaiting: () => Promise<void>;\n  \n  // Offline\n  syncOfflineData: () => Promise<void>;\n  clearOfflineData: () => Promise<void>;\n  \n  // Notifications\n  requestNotificationPermission: () => Promise<boolean>;\n  subscribeToNotifications: () => Promise<boolean>;\n  unsubscribeFromNotifications: () => Promise<boolean>;\n  \n  // Utility\n  refresh: () => Promise<void>;\n}\n\nexport function usePWA(): PWAStatus & PWAActions {\n  const [status, setStatus] = useState<PWAStatus>({\n    isSupported: typeof window !== 'undefined' ? ('serviceWorker' in navigator && 'PushManager' in window) : false,\n    isEnabled: isFeatureEnabled('PWA'),\n    installation: {\n      isInstallable: false,\n      isInstalled: false,\n      canPrompt: false,\n      platform: null,\n      deferredPrompt: null\n    },\n    serviceWorker: {\n      isSupported: typeof window !== 'undefined' ? 'serviceWorker' in navigator : false,\n      isRegistered: false,\n      isActive: false,\n      isInstalling: false,\n      isWaiting: false\n    },\n    isOnline: typeof window !== 'undefined' ? navigator.onLine : true,\n    offlineVotes: 0,\n    hasOfflineData: false,\n    notificationsSupported: typeof window !== 'undefined' ? 'Notification' in window : false,\n    notificationsEnabled: false,\n    notificationsPermission: 'default',\n    loading: true,\n    error: null\n  });\n\n  // Initialize PWA\n  const initializePWA = useCallback(async () => {\n    try {\n      logger.info('usePWA: Starting initialization...');\n      setStatus(prev => withOptional(prev, { loading: true, error: null }));\n\n      // Check if PWA feature is enabled\n      const pwaEnabled = isFeatureEnabled('PWA');\n      logger.info('usePWA: PWA feature enabled:', pwaEnabled);\n      if (!pwaEnabled) {\n        logger.info('usePWA: PWA feature is disabled, setting status');\n        setStatus(prev => withOptional(prev, {\n          isEnabled: false,\n          loading: false,\n          error: 'PWA feature is disabled'\n        }));\n        return;\n      }\n\n      // Check basic support\n      const isSupported = 'serviceWorker' in navigator && 'PushManager' in window;\n      logger.info('usePWA: PWA support check:', {\n        serviceWorker: 'serviceWorker' in navigator,\n        pushManager: 'PushManager' in window,\n        isSupported\n      });\n      \n      // Get installation status\n      const installationStatus = pwaInstallationManager.getStatus();\n      \n      // Register service worker if not already registered\n      const serviceWorkerStatus = await serviceWorkerManager.register();\n      \n      // Check notification permission\n      const notificationsPermission = 'Notification' in window \n        ? Notification.permission \n        : 'denied';\n      \n      // Get offline data status\n      const offlineVotes = await getOfflineVotesCount();\n      \n      const finalStatus = {\n        isSupported,\n        isEnabled: pwaEnabled,\n        installation: installationStatus,\n        serviceWorker: serviceWorkerStatus,\n        notificationsPermission,\n        notificationsEnabled: notificationsPermission === 'granted',\n        offlineVotes,\n        hasOfflineData: offlineVotes > 0,\n        loading: false,\n        error: null\n      };\n      \n      logger.info('usePWA: Setting final status:', finalStatus);\n      setStatus(prev => withOptional(prev, finalStatus));\n\n    } catch (error) {\n      logger.error('PWA: Initialization failed:', error instanceof Error ? error : new Error('Unknown error'));\n      setStatus(prev => withOptional(prev, {\n        loading: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      }));\n    }\n  }, []);\n\n  // Prompt installation\n  const promptInstallation = useCallback(async (): Promise<InstallationResult> => {\n    try {\n      const result = await pwaInstallationManager.promptInstallation();\n      \n      // Update status after installation attempt\n      const installationStatus = pwaInstallationManager.getStatus();\n      setStatus(prev => withOptional(prev, {\n        installation: installationStatus\n      }));\n      \n      return result;\n    } catch (error) {\n      logger.error('PWA: Installation prompt failed:', error instanceof Error ? error : new Error('Unknown error'));\n      return {\n        success: false,\n        outcome: 'error',\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n    }\n  }, []);\n\n  // Check for service worker updates\n  const checkForUpdates = useCallback(async (): Promise<boolean> => {\n    try {\n      const hasUpdate = await serviceWorkerManager.checkForUpdates();\n      \n      // Update service worker status\n      const serviceWorkerStatus = await serviceWorkerManager.getStatus();\n      setStatus(prev => withOptional(prev, {\n        serviceWorker: serviceWorkerStatus\n      }));\n      \n      return hasUpdate;\n    } catch (error) {\n      logger.error('PWA: Failed to check for updates:', error instanceof Error ? error : new Error('Unknown error'));\n      return false;\n    }\n  }, []);\n\n  // Skip waiting for service worker\n  const skipWaiting = useCallback(async (): Promise<void> => {\n    try {\n      await serviceWorkerManager.skipWaiting();\n    } catch (error) {\n      logger.error('PWA: Failed to skip waiting:', error instanceof Error ? error : new Error('Unknown error'));\n      throw error;\n    }\n  }, []);\n\n  // Sync offline data\n  const syncOfflineData = useCallback(async (): Promise<void> => {\n    try {\n      logger.info('PWA: Syncing offline data...');\n      \n      // Update offline data count\n      const offlineVotes = await getOfflineVotesCount();\n      setStatus(prev => withOptional(prev, {\n        offlineVotes,\n        hasOfflineData: offlineVotes > 0\n      }));\n    } catch (error) {\n      logger.error('PWA: Failed to sync offline data:', error instanceof Error ? error : new Error('Unknown error'));\n      throw error;\n    }\n  }, []);\n\n  // Clear offline data\n  const clearOfflineData = useCallback(async (): Promise<void> => {\n    try {\n      logger.info('PWA: Clearing offline data...');\n      \n      setStatus(prev => withOptional(prev, {\n        offlineVotes: 0,\n        hasOfflineData: false\n      }));\n    } catch (error) {\n      logger.error('PWA: Failed to clear offline data:', error instanceof Error ? error : new Error('Unknown error'));\n      throw error;\n    }\n  }, []);\n\n  // Request notification permission\n  const requestNotificationPermission = useCallback(async (): Promise<boolean> => {\n    try {\n      if (!('Notification' in window)) {\n        return false;\n      }\n\n      const permission = await Notification.requestPermission();\n      const enabled = permission === 'granted';\n      \n      setStatus(prev => withOptional(prev, {\n        notificationsPermission: permission,\n        notificationsEnabled: enabled\n      }));\n      \n      return enabled;\n    } catch (error) {\n      logger.error('PWA: Failed to request notification permission:', error instanceof Error ? error : new Error('Unknown error'));\n      return false;\n    }\n  }, []);\n\n  // Subscribe to notifications\n  const subscribeToNotifications = useCallback(async (): Promise<boolean> => {\n    try {\n      if (!status.notificationsEnabled) {\n        const enabled = await requestNotificationPermission();\n        if (!enabled) {\n          return false;\n        }\n      }\n\n      logger.info('PWA: Subscribing to notifications...');\n      \n      return true;\n    } catch (error) {\n      logger.error('PWA: Failed to subscribe to notifications:', error instanceof Error ? error : new Error('Unknown error'));\n      return false;\n    }\n  }, [status.notificationsEnabled, requestNotificationPermission]);\n\n  // Unsubscribe from notifications\n  const unsubscribeFromNotifications = useCallback(async (): Promise<boolean> => {\n    try {\n      // This would typically unsubscribe from push notifications\n      logger.info('PWA: Unsubscribing from notifications...');\n      \n      setStatus(prev => withOptional(prev, {\n        notificationsEnabled: false\n      }));\n      \n      return true;\n    } catch (error) {\n      logger.error('PWA: Failed to unsubscribe from notifications:', error instanceof Error ? error : new Error('Unknown error'));\n      return false;\n    }\n  }, []);\n\n  // Refresh PWA status\n  const refresh = useCallback(async (): Promise<void> => {\n    await initializePWA();\n  }, [initializePWA]);\n\n  // Initialize on mount\n  useEffect(() => {\n    initializePWA();\n  }, [initializePWA]);\n\n  // Set up event listeners\n  useEffect(() => {\n    // Online/offline status\n    const handleOnline = () => {\n      setStatus(prev => withOptional(prev, { isOnline: true }));\n      // Auto-sync when coming back online\n      syncOfflineData().catch(error => {\n        logger.error('PWA: Auto-sync failed:', error instanceof Error ? error : new Error('Unknown error'));\n      });\n    };\n\n    const handleOffline = () => {\n      setStatus(prev => withOptional(prev, { isOnline: false }));\n    };\n\n    // Installation status changes\n    const unsubscribeInstallation = pwaInstallationManager.subscribe((installationStatus) => {\n      setStatus(prev => withOptional(prev, { installation: installationStatus }));\n    });\n\n    // Service worker status changes\n    const unsubscribeServiceWorker = serviceWorkerManager.subscribe((serviceWorkerStatus) => {\n      setStatus(prev => withOptional(prev, { serviceWorker: serviceWorkerStatus }));\n    });\n\n    // Add event listeners (only on client side)\n    if (typeof window !== 'undefined') {\n      window.addEventListener('online', handleOnline);\n      window.addEventListener('offline', handleOffline);\n    }\n\n    // Cleanup\n    return () => {\n      if (typeof window !== 'undefined') {\n        window.removeEventListener('online', handleOnline);\n        window.removeEventListener('offline', handleOffline);\n      }\n      unsubscribeInstallation();\n      unsubscribeServiceWorker();\n    };\n  }, [syncOfflineData]);\n\n  return Object.assign({}, status, {\n    promptInstallation,\n    checkForUpdates,\n    skipWaiting,\n    syncOfflineData,\n    clearOfflineData,\n    requestNotificationPermission,\n    subscribeToNotifications,\n    unsubscribeFromNotifications,\n    refresh\n  });\n}\n\n/**\n * Get offline votes count\n */\nasync function getOfflineVotesCount(): Promise<number> {\n  try {\n    // This would typically read from IndexedDB or localStorage\n    // For now, return 0\n    return 0;\n  } catch (error) {\n    logger.error('PWA: Failed to get offline votes count:', error instanceof Error ? error : new Error('Unknown error'));\n    return 0;\n  }\n}\n"],"names":["usePWA","status","setStatus","useState","isSupported","window","navigator","isEnabled","isFeatureEnabled","installation","isInstallable","isInstalled","canPrompt","platform","deferredPrompt","serviceWorker","isRegistered","isActive","isInstalling","isWaiting","isOnline","onLine","offlineVotes","hasOfflineData","notificationsSupported","notificationsEnabled","notificationsPermission","loading","error","initializePWA","useCallback","logger","info","prev","withOptional","pwaEnabled","pushManager","installationStatus","pwaInstallationManager","getStatus","serviceWorkerStatus","serviceWorkerManager","register","Notification","permission","getOfflineVotesCount","finalStatus","Error","message","promptInstallation","result","success","outcome","checkForUpdates","hasUpdate","skipWaiting","syncOfflineData","clearOfflineData","requestNotificationPermission","requestPermission","enabled","subscribeToNotifications","unsubscribeFromNotifications","refresh","useEffect","handleOnline","catch","handleOffline","unsubscribeInstallation","subscribe","unsubscribeServiceWorker","addEventListener","removeEventListener","Object","assign"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/components/shared/GlobalNavigation-fixed.test.tsx"],"sourcesContent":["/**\n * GlobalNavigation Component Tests - Fixed Architecture\n * \n * Tests the GlobalNavigation component with the improved store architecture\n * that prevents infinite loops through atomic state management.\n */\n\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport { BrowserRouter } from 'react-router-dom'\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\n\n// Mock lucide-react before importing the component\njest.mock('lucide-react', () => require('@/../../__mocks__/lucide-react.js'))\n\nimport GlobalNavigation from '@/components/shared/GlobalNavigation'\n\n// Mock the stores with the improved architecture\nconst mockSignOut = jest.fn()\nconst mockUser = {\n  id: 'test-user-id',\n  name: 'Test User',\n  email: 'test@example.com',\n  avatar: 'https://example.com/avatar.jpg'\n}\n\n// Mock the store with atomic methods to prevent infinite loops\njest.mock('@/lib/stores', () => ({\n  useUser: jest.fn(() => mockUser),\n  useUserActions: jest.fn(() => ({\n    signOut: mockSignOut\n  })),\n  useUserStore: jest.fn(() => ({\n    user: mockUser,\n    isAuthenticated: true,\n    signOut: mockSignOut,\n    // Use atomic methods to prevent cascading updates\n    setUserAndAuth: jest.fn(),\n    setSessionAndDerived: jest.fn(),\n    initializeAuth: jest.fn()\n  }))\n}))\n\n// Mock Next.js navigation\njest.mock('next/navigation', () => ({\n  usePathname: jest.fn(() => '/dashboard')\n}))\n\nconst renderWithRouter = (component: React.ReactElement) => {\n  return render(\n    <BrowserRouter>\n      {component}\n    </BrowserRouter>\n  )\n}\n\ndescribe('GlobalNavigation - Fixed Architecture', () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n  })\n\n  describe('Component Rendering', () => {\n    it('should render navigation items without infinite loops', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      // Test that the component renders without infinite loops\n      expect(screen.getByText('Choices')).toBeInTheDocument()\n      expect(screen.getByText('Feed')).toBeInTheDocument()\n      expect(screen.getByText('Polls')).toBeInTheDocument()\n      expect(screen.getByText('Dashboard')).toBeInTheDocument()\n    })\n\n    it('should display user information when authenticated', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      // Test that user information is displayed\n      expect(screen.getByText('Profile')).toBeInTheDocument()\n      expect(screen.getByText('Privacy')).toBeInTheDocument()\n      expect(screen.getByText('Logout')).toBeInTheDocument()\n    })\n\n    it('should render mobile menu button', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const mobileMenuButton = screen.getByTestId('mobile-menu')\n      expect(mobileMenuButton).toBeInTheDocument()\n    })\n  })\n\n  describe('User Interactions', () => {\n    it('should toggle mobile menu when menu button is clicked', async () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const mobileMenuButton = screen.getByTestId('mobile-menu')\n      fireEvent.click(mobileMenuButton)\n      \n      // Test that mobile menu toggles without infinite loops\n      await waitFor(() => {\n        expect(mobileMenuButton).toHaveAttribute('aria-expanded', 'true')\n      })\n    })\n\n    it('should call signOut when logout is clicked', async () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const logoutButton = screen.getByTestId('logout-button')\n      fireEvent.click(logoutButton)\n      \n      // Test that signOut is called without infinite loops\n      await waitFor(() => {\n        expect(mockSignOut).toHaveBeenCalledTimes(1)\n      })\n    })\n\n    it('should handle logout errors gracefully', async () => {\n      // Mock signOut to throw an error\n      mockSignOut.mockRejectedValueOnce(new Error('Logout failed'))\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      const logoutButton = screen.getByTestId('logout-button')\n      fireEvent.click(logoutButton)\n      \n      // Test that error is handled gracefully without infinite loops\n      await waitFor(() => {\n        expect(mockSignOut).toHaveBeenCalledTimes(1)\n      })\n    })\n  })\n\n  describe('Navigation Links', () => {\n    it('should have correct href attributes', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      // Test navigation links\n      const feedLink = screen.getByText('Feed').closest('a')\n      const pollsLink = screen.getByText('Polls').closest('a')\n      const dashboardLink = screen.getByText('Dashboard').closest('a')\n      \n      expect(feedLink).toHaveAttribute('href', '/feed')\n      expect(pollsLink).toHaveAttribute('href', '/polls')\n      expect(dashboardLink).toHaveAttribute('href', '/dashboard')\n    })\n\n    it('should highlight active navigation item', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      // Test that active navigation item is highlighted\n      const dashboardLink = screen.getByText('Dashboard').closest('a')\n      expect(dashboardLink).toHaveClass('text-blue-600', 'bg-blue-50')\n    })\n  })\n\n  describe('Accessibility', () => {\n    it('should have proper ARIA labels', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const mobileMenuButton = screen.getByTestId('mobile-menu')\n      expect(mobileMenuButton).toHaveAttribute('aria-label', 'Toggle mobile menu')\n      expect(mobileMenuButton).toHaveAttribute('aria-expanded', 'false')\n    })\n\n    it('should support keyboard navigation', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const mobileMenuButton = screen.getByTestId('mobile-menu')\n      \n      // Test keyboard navigation\n      mobileMenuButton.focus()\n      expect(mobileMenuButton).toHaveFocus()\n      \n      // Test Enter key\n      fireEvent.keyDown(mobileMenuButton, { key: 'Enter' })\n      expect(mobileMenuButton).toHaveAttribute('aria-expanded', 'true')\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('should handle missing user data gracefully', () => {\n      // Mock useUser to return null\n      const { useUser } = require('@/lib/stores')\n      useUser.mockReturnValueOnce(null)\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      // Test that component renders without user data\n      expect(screen.getByText('Sign In')).toBeInTheDocument()\n      expect(screen.getByText('Get Started')).toBeInTheDocument()\n    })\n\n    it('should handle authentication errors gracefully', () => {\n      // Mock useUser to return null and isAuthenticated to false\n      const { useUser, useUserStore } = require('@/lib/stores')\n      useUser.mockReturnValueOnce(null)\n      useUserStore.mockReturnValueOnce({\n        user: null,\n        isAuthenticated: false,\n        signOut: mockSignOut\n      })\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      // Test that component renders in unauthenticated state\n      expect(screen.getByText('Sign In')).toBeInTheDocument()\n      expect(screen.getByText('Get Started')).toBeInTheDocument()\n    })\n  })\n\n  describe('Responsive Behavior', () => {\n    it('should show mobile menu button on small screens', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const mobileMenuButton = screen.getByTestId('mobile-menu')\n      expect(mobileMenuButton).toBeInTheDocument()\n      expect(mobileMenuButton).toHaveClass('md:hidden')\n    })\n\n    it('should hide mobile menu on desktop screens', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      // Test that desktop navigation is visible\n      const desktopNav = screen.getByText('Feed').closest('div')\n      expect(desktopNav).toHaveClass('hidden', 'md:flex')\n    })\n  })\n})\n"],"names":["jest","mock","require","mockSignOut","fn","mockUser","id","name","email","avatar","useUser","useUserActions","signOut","useUserStore","user","isAuthenticated","setUserAndAuth","setSessionAndDerived","initializeAuth","usePathname","renderWithRouter","component","render","BrowserRouter","describe","beforeEach","clearAllMocks","it","GlobalNavigation","expect","screen","getByText","toBeInTheDocument","mobileMenuButton","getByTestId","fireEvent","click","waitFor","toHaveAttribute","logoutButton","toHaveBeenCalledTimes","mockRejectedValueOnce","Error","feedLink","closest","pollsLink","dashboardLink","toHaveClass","focus","toHaveFocus","keyDown","key","mockReturnValueOnce","desktopNav"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/utils/supabase/__mocks__/server.ts"],"sourcesContent":["// A controllable mock for the Supabase \"server\" wrapper.\n// Exposes helpers so tests can set per-table results and reset cleanly.\n\n\n// Jest type declarations for mock functions\ndeclare const jest: {\n  fn: <T extends (...args: any[]) => any>(implementation?: T) => T & {\n    mockReturnThis: () => T & any;\n    mockImplementation: (impl: T) => T & any;\n    mockResolvedValue: (value: any) => T & any;\n    mockReset: () => void;\n    mockClear: () => void;\n  };\n};\n\ntype SingleResult<T> = Promise<{ data: T | null; error: unknown | null }>;\n\nconst makeQb = <T>(singleImpl?: () => SingleResult<T>, limitImpl?: () => Promise<{ data: T[] | null; error: unknown | null }>) => {\n  const chain = {\n    select: jest.fn().mockReturnThis(),\n    eq: jest.fn().mockReturnThis(),\n    limit: jest.fn().mockReturnThis(),\n    single: jest.fn(async () => ({ data: null, error: null })),\n  };\n  if (singleImpl) {\n    chain.single.mockImplementation(singleImpl as any);\n  }\n  if (limitImpl) {\n    chain.limit.mockImplementation(limitImpl as any);\n  }\n  return chain;\n};\n\n// A registry so tests can configure return values per table.\nconst tableHandlers = new Map<\n  string,\n  { qb: ReturnType<typeof makeQb> }\n>();\n\n// Default client shape your code expects.\nexport const __client = {\n  auth: {\n    getUser: jest.fn().mockResolvedValue({ data: { id: 'test', email: 'test@example.com' }, error: null }),\n  },\n  from: jest.fn((table: string) => {\n    const existing = tableHandlers.get(table);\n    if (existing) return existing.qb;\n    const qb = makeQb();\n    tableHandlers.set(table, { qb });\n    return qb;\n  }),\n  rpc: jest.fn().mockResolvedValue({ data: true, error: null }),\n};\n\n// Helpers for tests\nexport const __resetClient = () => {\n  __client.auth.getUser.mockReset();\n  __client.from.mockClear();\n  __client.rpc.mockClear();\n  tableHandlers.clear();\n};\n\nexport const __setRpcResult = (functionName: string, result: unknown, error: unknown = null) => {\n  __client.rpc.mockImplementation((fn: string) => {\n    if (fn === functionName) {\n      return Promise.resolve({ data: result, error });\n    }\n    return Promise.resolve({ data: null, error: new Error(`Unknown RPC function: ${fn}`) });\n  });\n};\n\nexport const __setFromSingle = <T>(table: string, data: T | null, error: unknown = null) => {\n  const qb = makeQb<T>(() => Promise.resolve({ data, error }));\n  tableHandlers.set(table, { qb });\n  return qb; // handy if you want to assert calls on select/eq later\n};\n\nexport const __setFromLimit = <T>(table: string, data: T[] | null, error: unknown = null) => {\n  const qb = makeQb<T>(undefined, () => Promise.resolve({ data, error }));\n  tableHandlers.set(table, { qb });\n  return qb; // handy if you want to assert calls on select/limit later\n};\n\n// Additional exports for test compatibility - removed duplicates\n\n// This is the named export your code imports.\nexport const getSupabaseServerClient = jest.fn(async () => __client);\n"],"names":["__client","__resetClient","__setFromLimit","__setFromSingle","__setRpcResult","getSupabaseServerClient","makeQb","singleImpl","limitImpl","chain","select","jest","fn","mockReturnThis","eq","limit","single","data","error","mockImplementation","tableHandlers","Map","auth","getUser","mockResolvedValue","id","email","from","table","existing","get","qb","set","rpc","mockReset","mockClear","clear","functionName","result","Promise","resolve","Error","undefined"],"mappings":"AAAA,yDAAyD;AACzD,wEAAwE;AAGxE,4CAA4C;;;;;;;;;;;;IAoC/BA,QAAQ;eAARA;;IAeAC,aAAa;eAAbA;;IAsBAC,cAAc;eAAdA;;IANAC,eAAe;eAAfA;;IATAC,cAAc;eAAdA;;IAwBAC,uBAAuB;eAAvBA;;;AArEb,MAAMC,SAAS,CAAIC,YAAoCC;IACrD,MAAMC,QAAQ;QACZC,QAAQC,KAAKC,EAAE,GAAGC,cAAc;QAChCC,IAAIH,KAAKC,EAAE,GAAGC,cAAc;QAC5BE,OAAOJ,KAAKC,EAAE,GAAGC,cAAc;QAC/BG,QAAQL,KAAKC,EAAE,CAAC,UAAa,CAAA;gBAAEK,MAAM;gBAAMC,OAAO;YAAK,CAAA;IACzD;IACA,IAAIX,YAAY;QACdE,MAAMO,MAAM,CAACG,kBAAkB,CAACZ;IAClC;IACA,IAAIC,WAAW;QACbC,MAAMM,KAAK,CAACI,kBAAkB,CAACX;IACjC;IACA,OAAOC;AACT;AAEA,6DAA6D;AAC7D,MAAMW,gBAAgB,IAAIC;AAMnB,MAAMrB,WAAW;IACtBsB,MAAM;QACJC,SAASZ,KAAKC,EAAE,GAAGY,iBAAiB,CAAC;YAAEP,MAAM;gBAAEQ,IAAI;gBAAQC,OAAO;YAAmB;YAAGR,OAAO;QAAK;IACtG;IACAS,MAAMhB,KAAKC,EAAE,CAAC,CAACgB;QACb,MAAMC,WAAWT,cAAcU,GAAG,CAACF;QACnC,IAAIC,UAAU,OAAOA,SAASE,EAAE;QAChC,MAAMA,KAAKzB;QACXc,cAAcY,GAAG,CAACJ,OAAO;YAAEG;QAAG;QAC9B,OAAOA;IACT;IACAE,KAAKtB,KAAKC,EAAE,GAAGY,iBAAiB,CAAC;QAAEP,MAAM;QAAMC,OAAO;IAAK;AAC7D;AAGO,MAAMjB,gBAAgB;IAC3BD,SAASsB,IAAI,CAACC,OAAO,CAACW,SAAS;IAC/BlC,SAAS2B,IAAI,CAACQ,SAAS;IACvBnC,SAASiC,GAAG,CAACE,SAAS;IACtBf,cAAcgB,KAAK;AACrB;AAEO,MAAMhC,iBAAiB,CAACiC,cAAsBC,QAAiBpB,QAAiB,IAAI;IACzFlB,SAASiC,GAAG,CAACd,kBAAkB,CAAC,CAACP;QAC/B,IAAIA,OAAOyB,cAAc;YACvB,OAAOE,QAAQC,OAAO,CAAC;gBAAEvB,MAAMqB;gBAAQpB;YAAM;QAC/C;QACA,OAAOqB,QAAQC,OAAO,CAAC;YAAEvB,MAAM;YAAMC,OAAO,IAAIuB,MAAM,CAAC,sBAAsB,EAAE7B,GAAG,CAAC;QAAE;IACvF;AACF;AAEO,MAAMT,kBAAkB,CAAIyB,OAAeX,MAAgBC,QAAiB,IAAI;IACrF,MAAMa,KAAKzB,OAAU,IAAMiC,QAAQC,OAAO,CAAC;YAAEvB;YAAMC;QAAM;IACzDE,cAAcY,GAAG,CAACJ,OAAO;QAAEG;IAAG;IAC9B,OAAOA,IAAI,uDAAuD;AACpE;AAEO,MAAM7B,iBAAiB,CAAI0B,OAAeX,MAAkBC,QAAiB,IAAI;IACtF,MAAMa,KAAKzB,OAAUoC,WAAW,IAAMH,QAAQC,OAAO,CAAC;YAAEvB;YAAMC;QAAM;IACpEE,cAAcY,GAAG,CAACJ,OAAO;QAAEG;IAAG;IAC9B,OAAOA,IAAI,0DAA0D;AACvE;AAKO,MAAM1B,0BAA0BM,KAAKC,EAAE,CAAC,UAAYZ"}
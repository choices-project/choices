{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/core/feature-flags.ts"],"sourcesContent":["/**\n * Core Feature Flags System\n * \n * Centralized feature flag management with type safety and runtime control.\n * Provides the foundation for feature rollout, A/B testing, and safe deployments.\n */\n\nimport { logger } from '@/lib/utils/logger';\n\n// Feature Flag Types\nexport interface FeatureFlag {\n  id: string;\n  name: string;\n  enabled: boolean;\n  description: string;\n  category?: string;\n  dependencies?: string[];\n  metadata?: Record<string, unknown>;\n}\n\nexport interface FeatureFlagConfig {\n  flags: Record<string, boolean>;\n  categories: Record<string, string[]>;\n  environment: string;\n  version: string;\n}\n\nexport interface FeatureFlagManager {\n  isEnabled(flagId: string): boolean;\n  isDisabled(flagId: string): boolean;\n  enable(flagId: string): boolean;\n  disable(flagId: string): boolean;\n  toggle(flagId: string): boolean;\n  getFlag(flagId: string): FeatureFlag | undefined;\n  getAllFlags(): Map<string, FeatureFlag>;\n  getEnabledFlags(): FeatureFlag[];\n  getDisabledFlags(): FeatureFlag[];\n  getFlagsByCategory(category: 'core' | 'optional' | 'experimental'): FeatureFlag[];\n  getSystemInfo(): {\n    totalFlags: number;\n    enabledFlags: number;\n    disabledFlags: number;\n    environment: string;\n    categories: Record<string, number>;\n  };\n  subscribe(callback: (flags: Record<string, boolean>) => void): { unsubscribe: () => void };\n  updateFlagMetadata(flagId: string, metadata: Record<string, unknown>): boolean;\n  reset(): void;\n  exportConfig(): FeatureFlagConfig;\n  importConfig(config: FeatureFlagConfig): void;\n  areDependenciesEnabled(flagId: string): boolean;\n}\n\n// Feature Flag Definitions\nexport const FEATURE_FLAGS = {\n  // Core MVP Features (Always Enabled)\n  WEBAUTHN: true,\n  PWA: true,\n  ADMIN: true,\n  FEEDBACK_WIDGET: true,\n  \n  // Enhanced MVP Features\n  ENHANCED_PROFILE: true,\n  ENHANCED_POLLS: true,\n  ENHANCED_VOTING: true,\n  CIVICS_ADDRESS_LOOKUP: true,\n  CIVICS_REPRESENTATIVE_DATABASE: true,\n  CIVICS_CAMPAIGN_FINANCE: true,\n  CIVICS_VOTING_RECORDS: true,\n  CANDIDATE_ACCOUNTABILITY: true,\n  CANDIDATE_CARDS: true,\n  ALTERNATIVE_CANDIDATES: true,\n  \n  // Future Features\n  AUTOMATED_POLLS: false,\n  DEMOGRAPHIC_FILTERING: false,\n  TRENDING_POLLS: false,\n  \n  // Performance Features\n  PERFORMANCE_OPTIMIZATION: true,\n  FEATURE_DB_OPTIMIZATION_SUITE: true,\n  \n  // Analytics Features\n  ANALYTICS: false,\n  EXPERIMENTAL_ANALYTICS: false,\n  \n  // UI Features\n  EXPERIMENTAL_UI: false,\n  EXPERIMENTAL_COMPONENTS: false,\n  \n  // Privacy Features\n  ADVANCED_PRIVACY: false,\n  \n  // Social Features\n  SOCIAL_SHARING: true,\n  \n  // AI Features\n  AI_FEATURES: false,\n  \n  // Legacy flags for backward compatibility\n  CORE_AUTH: true,\n  CORE_POLLS: true,\n  CORE_USERS: true,\n  EXPERIMENTAL_UIFeature: false,\n  AIFeaturesFeature: false,\n  AdvancedPrivacyFeature: false,\n  AnalyticsFeature: false,\n  PWAFeature: true,\n  AdminFeature: true,\n  AuditFeature: false,\n  ExperimentalUIFeature: false,\n  AIFeaturesFeature: false,\n  VotingFeature: true,\n  DatabaseFeature: true,\n  APIFeature: true,\n  UIFeature: true,\n  AuthFeature: true\n} as const;\n\n// Feature Flag Categories\nexport const FEATURE_FLAG_CATEGORIES = {\n  core: ['WEBAUTHN', 'PWA', 'ADMIN', 'FEEDBACK_WIDGET', 'CORE_AUTH', 'CORE_POLLS', 'CORE_USERS'],\n  enhanced: ['ENHANCED_PROFILE', 'ENHANCED_POLLS', 'ENHANCED_VOTING'],\n  civics: ['CIVICS_ADDRESS_LOOKUP', 'CIVICS_REPRESENTATIVE_DATABASE', 'CIVICS_CAMPAIGN_FINANCE', 'CIVICS_VOTING_RECORDS'],\n  future: ['AUTOMATED_POLLS', 'DEMOGRAPHIC_FILTERING', 'TRENDING_POLLS'],\n  performance: ['PERFORMANCE_OPTIMIZATION', 'FEATURE_DB_OPTIMIZATION_SUITE'],\n  experimental: ['EXPERIMENTAL_UI', 'EXPERIMENTAL_ANALYTICS', 'EXPERIMENTAL_COMPONENTS'],\n  analytics: ['ANALYTICS', 'EXPERIMENTAL_ANALYTICS'],\n  privacy: ['ADVANCED_PRIVACY'],\n  social: ['SOCIAL_SHARING'],\n  ai: ['AI_FEATURES', 'AIFeaturesFeature']\n} as const;\n\n// Feature Flag Dependencies\nexport const FEATURE_FLAG_DEPENDENCIES: Record<string, string[]> = {\n  ENHANCED_PROFILE: ['CORE_AUTH'],\n  ENHANCED_POLLS: ['CORE_POLLS'],\n  ENHANCED_VOTING: ['CORE_POLLS'],\n  CIVICS_ADDRESS_LOOKUP: ['CORE_AUTH'],\n  CIVICS_REPRESENTATIVE_DATABASE: ['CIVICS_ADDRESS_LOOKUP'],\n  CIVICS_CAMPAIGN_FINANCE: ['CIVICS_REPRESENTATIVE_DATABASE'],\n  CIVICS_VOTING_RECORDS: ['CIVICS_REPRESENTATIVE_DATABASE'],\n  CANDIDATE_ACCOUNTABILITY: ['CIVICS_REPRESENTATIVE_DATABASE'],\n  CANDIDATE_CARDS: ['CIVICS_REPRESENTATIVE_DATABASE'],\n  ALTERNATIVE_CANDIDATES: ['CIVICS_REPRESENTATIVE_DATABASE'],\n  AUTOMATED_POLLS: ['AI_FEATURES'],\n  DEMOGRAPHIC_FILTERING: ['ANALYTICS'],\n  TRENDING_POLLS: ['ANALYTICS'],\n  EXPERIMENTAL_ANALYTICS: ['ANALYTICS'],\n  EXPERIMENTAL_COMPONENTS: ['EXPERIMENTAL_UI'],\n  AIFeaturesFeature: ['AI_FEATURES'],\n  AdvancedPrivacyFeature: ['ADVANCED_PRIVACY'],\n  AnalyticsFeature: ['ANALYTICS'],\n  PWAFeature: ['PWA'],\n  AdminFeature: ['ADMIN'],\n  AuditFeature: ['ADMIN'],\n  ExperimentalUIFeature: ['EXPERIMENTAL_UI'],\n  VotingFeature: ['CORE_POLLS'],\n  DatabaseFeature: ['CORE_AUTH'],\n  APIFeature: ['CORE_AUTH'],\n  UIFeature: ['CORE_AUTH'],\n  AuthFeature: ['CORE_AUTH']\n};\n\n// Feature Flag Manager Implementation\nclass FeatureFlagManagerImpl implements FeatureFlagManager {\n  private flags: Record<string, boolean>;\n  private subscribers: Set<(flags: Record<string, boolean>) => void>;\n  private metadata: Map<string, Record<string, unknown>>;\n\n  constructor() {\n    this.flags = { ...FEATURE_FLAGS };\n    this.subscribers = new Set();\n    this.metadata = new Map();\n    \n    // Initialize metadata\n    this.initializeMetadata();\n    \n    logger.info('Feature flag manager initialized', {\n      totalFlags: Object.keys(this.flags).length,\n      enabledFlags: Object.values(this.flags).filter(Boolean).length\n    });\n  }\n\n  private initializeMetadata(): void {\n    Object.keys(this.flags).forEach(flagId => {\n      this.metadata.set(flagId, {\n        category: this.getCategoryForFlag(flagId),\n        dependencies: FEATURE_FLAG_DEPENDENCIES[flagId] || [],\n        description: `Feature flag for ${flagId.toLowerCase().replace(/_/g, ' ')}`,\n        lastModified: new Date().toISOString()\n      });\n    });\n  }\n\n  private getCategoryForFlag(flagId: string): string {\n    for (const [category, flags] of Object.entries(FEATURE_FLAG_CATEGORIES)) {\n      if (flags.includes(flagId)) {\n        return category;\n      }\n    }\n    return 'general';\n  }\n\n  isEnabled(flagId: string): boolean {\n    const normalizedId = this.normalizeFlagId(flagId);\n    return this.flags[normalizedId] === true;\n  }\n\n  isDisabled(flagId: string): boolean {\n    return !this.isEnabled(flagId);\n  }\n\n  enable(flagId: string): boolean {\n    const normalizedId = this.normalizeFlagId(flagId);\n    \n    if (!(normalizedId in this.flags)) {\n      logger.warn('Attempted to enable unknown feature flag', { flagId: normalizedId });\n      return false;\n    }\n\n    if (this.flags[normalizedId] === true) {\n      return true; // Already enabled\n    }\n\n    // Check dependencies\n    if (!this.areDependenciesEnabled(normalizedId)) {\n      logger.warn('Cannot enable feature flag - dependencies not met', { \n        flagId: normalizedId, \n        dependencies: FEATURE_FLAG_DEPENDENCIES[normalizedId] \n      });\n      return false;\n    }\n\n    this.flags[normalizedId] = true;\n    this.notifySubscribers();\n    \n    logger.info('Feature flag enabled', { flagId: normalizedId });\n    return true;\n  }\n\n  disable(flagId: string): boolean {\n    const normalizedId = this.normalizeFlagId(flagId);\n    \n    if (!(normalizedId in this.flags)) {\n      logger.warn('Attempted to disable unknown feature flag', { flagId: normalizedId });\n      return false;\n    }\n\n    if (this.flags[normalizedId] === false) {\n      return true; // Already disabled\n    }\n\n    this.flags[normalizedId] = false;\n    this.notifySubscribers();\n    \n    logger.info('Feature flag disabled', { flagId: normalizedId });\n    return true;\n  }\n\n  toggle(flagId: string): boolean {\n    const normalizedId = this.normalizeFlagId(flagId);\n    \n    if (this.isEnabled(normalizedId)) {\n      return this.disable(normalizedId);\n    } else {\n      return this.enable(normalizedId);\n    }\n  }\n\n  getFlag(flagId: string): FeatureFlag | undefined {\n    const normalizedId = this.normalizeFlagId(flagId);\n    \n    if (!(normalizedId in this.flags)) {\n      return undefined;\n    }\n\n    const metadata = this.metadata.get(normalizedId) || {};\n    \n    return {\n      id: normalizedId,\n      name: normalizedId.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled: this.flags[normalizedId],\n      description: metadata.description as string || `Feature flag for ${normalizedId.toLowerCase().replace(/_/g, ' ')}`,\n      category: metadata.category as string,\n      dependencies: metadata.dependencies as string[],\n      metadata: metadata\n    };\n  }\n\n  getAllFlags(): Map<string, FeatureFlag> {\n    const flags = new Map<string, FeatureFlag>();\n    \n    Object.keys(this.flags).forEach(flagId => {\n      const flag = this.getFlag(flagId);\n      if (flag) {\n        flags.set(flagId, flag);\n      }\n    });\n    \n    return flags;\n  }\n\n  getEnabledFlags(): FeatureFlag[] {\n    return Array.from(this.getAllFlags().values()).filter(flag => flag.enabled);\n  }\n\n  getDisabledFlags(): FeatureFlag[] {\n    return Array.from(this.getAllFlags().values()).filter(flag => !flag.enabled);\n  }\n\n  getFlagsByCategory(category: 'core' | 'optional' | 'experimental'): FeatureFlag[] {\n    const categoryFlags = FEATURE_FLAG_CATEGORIES[category] || [];\n    return Array.from(this.getAllFlags().values()).filter(flag => \n      categoryFlags.includes(flag.id)\n    );\n  }\n\n  getSystemInfo(): {\n    totalFlags: number;\n    enabledFlags: number;\n    disabledFlags: number;\n    environment: string;\n    categories: Record<string, number>;\n  } {\n    const allFlags = this.getAllFlags();\n    const enabledFlags = this.getEnabledFlags();\n    const disabledFlags = this.getDisabledFlags();\n    \n    const categories: Record<string, number> = {};\n    Object.keys(FEATURE_FLAG_CATEGORIES).forEach(category => {\n      categories[category] = this.getFlagsByCategory(category as any).length;\n    });\n\n    return {\n      totalFlags: allFlags.size,\n      enabledFlags: enabledFlags.length,\n      disabledFlags: disabledFlags.length,\n      environment: process.env.NODE_ENV || 'development',\n      categories\n    };\n  }\n\n  subscribe(callback: (flags: Record<string, boolean>) => void): { unsubscribe: () => void } {\n    this.subscribers.add(callback);\n    \n    return {\n      unsubscribe: () => {\n        this.subscribers.delete(callback);\n      }\n    };\n  }\n\n  updateFlagMetadata(flagId: string, metadata: Record<string, unknown>): boolean {\n    const normalizedId = this.normalizeFlagId(flagId);\n    \n    if (!(normalizedId in this.flags)) {\n      logger.warn('Attempted to update metadata for unknown feature flag', { flagId: normalizedId });\n      return false;\n    }\n\n    const existingMetadata = this.metadata.get(normalizedId) || {};\n    this.metadata.set(normalizedId, { ...existingMetadata, ...metadata });\n    \n    logger.info('Feature flag metadata updated', { flagId: normalizedId, metadata });\n    return true;\n  }\n\n  reset(): void {\n    this.flags = { ...FEATURE_FLAGS };\n    this.initializeMetadata();\n    this.notifySubscribers();\n    \n    logger.info('Feature flags reset to defaults');\n  }\n\n  exportConfig(): FeatureFlagConfig {\n    return {\n      flags: { ...this.flags },\n      categories: { ...FEATURE_FLAG_CATEGORIES },\n      environment: process.env.NODE_ENV || 'development',\n      version: '1.0.0'\n    };\n  }\n\n  importConfig(config: FeatureFlagConfig): void {\n    if (config.flags) {\n      this.flags = { ...config.flags };\n    }\n    \n    this.notifySubscribers();\n    \n    logger.info('Feature flag configuration imported', { \n      totalFlags: Object.keys(this.flags).length \n    });\n  }\n\n  areDependenciesEnabled(flagId: string): boolean {\n    const dependencies = FEATURE_FLAG_DEPENDENCIES[flagId] || [];\n    return dependencies.every(dep => this.isEnabled(dep));\n  }\n\n  private normalizeFlagId(flagId: string): string {\n    // Handle case-insensitive lookups and legacy naming\n    const normalized = flagId.toUpperCase();\n    \n    // Check for exact match first\n    if (normalized in this.flags) {\n      return normalized;\n    }\n    \n    // Check for legacy naming patterns\n    const legacyMappings: Record<string, string> = {\n      'AUTHENTICATION': 'CORE_AUTH',\n      'POLLS': 'CORE_POLLS',\n      'USERS': 'CORE_USERS',\n      'ANALYTICS': 'ANALYTICS',\n      'PWA': 'PWA',\n      'ADMIN': 'ADMIN',\n      'WEBAUTHN': 'WEBAUTHN',\n      'FEEDBACK_WIDGET': 'FEEDBACK_WIDGET',\n      'ENHANCED_PROFILE': 'ENHANCED_PROFILE',\n      'ENHANCED_POLLS': 'ENHANCED_POLLS',\n      'ENHANCED_VOTING': 'ENHANCED_VOTING',\n      'CIVICS_ADDRESS_LOOKUP': 'CIVICS_ADDRESS_LOOKUP',\n      'CIVICS_REPRESENTATIVE_DATABASE': 'CIVICS_REPRESENTATIVE_DATABASE',\n      'CIVICS_CAMPAIGN_FINANCE': 'CIVICS_CAMPAIGN_FINANCE',\n      'CIVICS_VOTING_RECORDS': 'CIVICS_VOTING_RECORDS',\n      'CANDIDATE_ACCOUNTABILITY': 'CANDIDATE_ACCOUNTABILITY',\n      'CANDIDATE_CARDS': 'CANDIDATE_CARDS',\n      'ALTERNATIVE_CANDIDATES': 'ALTERNATIVE_CANDIDATES',\n      'AUTOMATED_POLLS': 'AUTOMATED_POLLS',\n      'DEMOGRAPHIC_FILTERING': 'DEMOGRAPHIC_FILTERING',\n      'TRENDING_POLLS': 'TRENDING_POLLS',\n      'PERFORMANCE_OPTIMIZATION': 'PERFORMANCE_OPTIMIZATION',\n      'FEATURE_DB_OPTIMIZATION_SUITE': 'FEATURE_DB_OPTIMIZATION_SUITE',\n      'EXPERIMENTAL_UI': 'EXPERIMENTAL_UI',\n      'EXPERIMENTAL_ANALYTICS': 'EXPERIMENTAL_ANALYTICS',\n      'EXPERIMENTAL_COMPONENTS': 'EXPERIMENTAL_COMPONENTS',\n      'ADVANCED_PRIVACY': 'ADVANCED_PRIVACY',\n      'SOCIAL_SHARING': 'SOCIAL_SHARING',\n      'AI_FEATURES': 'AI_FEATURES'\n    };\n    \n    if (normalized in legacyMappings) {\n      return legacyMappings[normalized];\n    }\n    \n    return normalized;\n  }\n\n  private notifySubscribers(): void {\n    this.subscribers.forEach(callback => {\n      try {\n        callback({ ...this.flags });\n      } catch (error) {\n        logger.error('Error in feature flag subscriber', { error });\n      }\n    });\n  }\n}\n\n// Create and export the feature flag manager instance\nexport const featureFlagManager = new FeatureFlagManagerImpl();\n\n// Export convenience functions\nexport const isFeatureEnabled = (flagId: string): boolean => featureFlagManager.isEnabled(flagId);\nexport const enableFeature = (flagId: string): boolean => featureFlagManager.enable(flagId);\nexport const disableFeature = (flagId: string): boolean => featureFlagManager.disable(flagId);\nexport const toggleFeature = (flagId: string): boolean => featureFlagManager.toggle(flagId);\nexport const getFeatureFlag = (flagId: string): FeatureFlag | undefined => featureFlagManager.getFlag(flagId);\nexport const getAllFeatureFlags = (): Map<string, FeatureFlag> => featureFlagManager.getAllFlags();\n\n// Export types\nexport type { FeatureFlag, FeatureFlagConfig, FeatureFlagManager };"],"names":["FEATURE_FLAGS","FEATURE_FLAG_CATEGORIES","FEATURE_FLAG_DEPENDENCIES","disableFeature","enableFeature","featureFlagManager","getAllFeatureFlags","getFeatureFlag","isFeatureEnabled","toggleFeature","WEBAUTHN","PWA","ADMIN","FEEDBACK_WIDGET","ENHANCED_PROFILE","ENHANCED_POLLS","ENHANCED_VOTING","CIVICS_ADDRESS_LOOKUP","CIVICS_REPRESENTATIVE_DATABASE","CIVICS_CAMPAIGN_FINANCE","CIVICS_VOTING_RECORDS","CANDIDATE_ACCOUNTABILITY","CANDIDATE_CARDS","ALTERNATIVE_CANDIDATES","AUTOMATED_POLLS","DEMOGRAPHIC_FILTERING","TRENDING_POLLS","PERFORMANCE_OPTIMIZATION","FEATURE_DB_OPTIMIZATION_SUITE","ANALYTICS","EXPERIMENTAL_ANALYTICS","EXPERIMENTAL_UI","EXPERIMENTAL_COMPONENTS","ADVANCED_PRIVACY","SOCIAL_SHARING","AI_FEATURES","CORE_AUTH","CORE_POLLS","CORE_USERS","EXPERIMENTAL_UIFeature","AIFeaturesFeature","AdvancedPrivacyFeature","AnalyticsFeature","PWAFeature","AdminFeature","AuditFeature","ExperimentalUIFeature","VotingFeature","DatabaseFeature","APIFeature","UIFeature","AuthFeature","core","enhanced","civics","future","performance","experimental","analytics","privacy","social","ai","FeatureFlagManagerImpl","constructor","flags","subscribers","Set","metadata","Map","initializeMetadata","logger","info","totalFlags","Object","keys","length","enabledFlags","values","filter","Boolean","forEach","flagId","set","category","getCategoryForFlag","dependencies","description","toLowerCase","replace","lastModified","Date","toISOString","entries","includes","isEnabled","normalizedId","normalizeFlagId","isDisabled","enable","warn","areDependenciesEnabled","notifySubscribers","disable","toggle","getFlag","undefined","get","id","name","l","toUpperCase","enabled","getAllFlags","flag","getEnabledFlags","Array","from","getDisabledFlags","getFlagsByCategory","categoryFlags","getSystemInfo","allFlags","disabledFlags","categories","size","environment","process","env","NODE_ENV","subscribe","callback","add","unsubscribe","delete","updateFlagMetadata","existingMetadata","reset","exportConfig","version","importConfig","config","every","dep","normalized","legacyMappings","error"],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;IAiDYA,aAAa;eAAbA;;IAkEAC,uBAAuB;eAAvBA;;IAcAC,yBAAyB;eAAzBA;;IA8UAC,cAAc;eAAdA;;IADAC,aAAa;eAAbA;;IAJAC,kBAAkB;eAAlBA;;IAQAC,kBAAkB;eAAlBA;;IADAC,cAAc;eAAdA;;IAJAC,gBAAgB;eAAhBA;;IAGAC,aAAa;eAAbA;;;wBA9cU;AA+ChB,MAAMT,gBAAgB;IAC3B,qCAAqC;IACrCU,UAAU;IACVC,KAAK;IACLC,OAAO;IACPC,iBAAiB;IAEjB,wBAAwB;IACxBC,kBAAkB;IAClBC,gBAAgB;IAChBC,iBAAiB;IACjBC,uBAAuB;IACvBC,gCAAgC;IAChCC,yBAAyB;IACzBC,uBAAuB;IACvBC,0BAA0B;IAC1BC,iBAAiB;IACjBC,wBAAwB;IAExB,kBAAkB;IAClBC,iBAAiB;IACjBC,uBAAuB;IACvBC,gBAAgB;IAEhB,uBAAuB;IACvBC,0BAA0B;IAC1BC,+BAA+B;IAE/B,qBAAqB;IACrBC,WAAW;IACXC,wBAAwB;IAExB,cAAc;IACdC,iBAAiB;IACjBC,yBAAyB;IAEzB,mBAAmB;IACnBC,kBAAkB;IAElB,kBAAkB;IAClBC,gBAAgB;IAEhB,cAAc;IACdC,aAAa;IAEb,0CAA0C;IAC1CC,WAAW;IACXC,YAAY;IACZC,YAAY;IACZC,wBAAwB;IACxBC,mBAAmB;IACnBC,wBAAwB;IACxBC,kBAAkB;IAClBC,YAAY;IACZC,cAAc;IACdC,cAAc;IACdC,uBAAuB;IACvBN,mBAAmB;IACnBO,eAAe;IACfC,iBAAiB;IACjBC,YAAY;IACZC,WAAW;IACXC,aAAa;AACf;AAGO,MAAMlD,0BAA0B;IACrCmD,MAAM;QAAC;QAAY;QAAO;QAAS;QAAmB;QAAa;QAAc;KAAa;IAC9FC,UAAU;QAAC;QAAoB;QAAkB;KAAkB;IACnEC,QAAQ;QAAC;QAAyB;QAAkC;QAA2B;KAAwB;IACvHC,QAAQ;QAAC;QAAmB;QAAyB;KAAiB;IACtEC,aAAa;QAAC;QAA4B;KAAgC;IAC1EC,cAAc;QAAC;QAAmB;QAA0B;KAA0B;IACtFC,WAAW;QAAC;QAAa;KAAyB;IAClDC,SAAS;QAAC;KAAmB;IAC7BC,QAAQ;QAAC;KAAiB;IAC1BC,IAAI;QAAC;QAAe;KAAoB;AAC1C;AAGO,MAAM3D,4BAAsD;IACjEY,kBAAkB;QAAC;KAAY;IAC/BC,gBAAgB;QAAC;KAAa;IAC9BC,iBAAiB;QAAC;KAAa;IAC/BC,uBAAuB;QAAC;KAAY;IACpCC,gCAAgC;QAAC;KAAwB;IACzDC,yBAAyB;QAAC;KAAiC;IAC3DC,uBAAuB;QAAC;KAAiC;IACzDC,0BAA0B;QAAC;KAAiC;IAC5DC,iBAAiB;QAAC;KAAiC;IACnDC,wBAAwB;QAAC;KAAiC;IAC1DC,iBAAiB;QAAC;KAAc;IAChCC,uBAAuB;QAAC;KAAY;IACpCC,gBAAgB;QAAC;KAAY;IAC7BI,wBAAwB;QAAC;KAAY;IACrCE,yBAAyB;QAAC;KAAkB;IAC5CQ,mBAAmB;QAAC;KAAc;IAClCC,wBAAwB;QAAC;KAAmB;IAC5CC,kBAAkB;QAAC;KAAY;IAC/BC,YAAY;QAAC;KAAM;IACnBC,cAAc;QAAC;KAAQ;IACvBC,cAAc;QAAC;KAAQ;IACvBC,uBAAuB;QAAC;KAAkB;IAC1CC,eAAe;QAAC;KAAa;IAC7BC,iBAAiB;QAAC;KAAY;IAC9BC,YAAY;QAAC;KAAY;IACzBC,WAAW;QAAC;KAAY;IACxBC,aAAa;QAAC;KAAY;AAC5B;AAEA,sCAAsC;AACtC,MAAMW;IAKJC,aAAc;QACZ,IAAI,CAACC,KAAK,GAAG;YAAE,GAAGhE,aAAa;QAAC;QAChC,IAAI,CAACiE,WAAW,GAAG,IAAIC;QACvB,IAAI,CAACC,QAAQ,GAAG,IAAIC;QAEpB,sBAAsB;QACtB,IAAI,CAACC,kBAAkB;QAEvBC,cAAM,CAACC,IAAI,CAAC,oCAAoC;YAC9CC,YAAYC,OAAOC,IAAI,CAAC,IAAI,CAACV,KAAK,EAAEW,MAAM;YAC1CC,cAAcH,OAAOI,MAAM,CAAC,IAAI,CAACb,KAAK,EAAEc,MAAM,CAACC,SAASJ,MAAM;QAChE;IACF;IAEQN,qBAA2B;QACjCI,OAAOC,IAAI,CAAC,IAAI,CAACV,KAAK,EAAEgB,OAAO,CAACC,CAAAA;YAC9B,IAAI,CAACd,QAAQ,CAACe,GAAG,CAACD,QAAQ;gBACxBE,UAAU,IAAI,CAACC,kBAAkB,CAACH;gBAClCI,cAAcnF,yBAAyB,CAAC+E,OAAO,IAAI,EAAE;gBACrDK,aAAa,CAAC,iBAAiB,EAAEL,OAAOM,WAAW,GAAGC,OAAO,CAAC,MAAM,KAAK,CAAC;gBAC1EC,cAAc,IAAIC,OAAOC,WAAW;YACtC;QACF;IACF;IAEQP,mBAAmBH,MAAc,EAAU;QACjD,KAAK,MAAM,CAACE,UAAUnB,MAAM,IAAIS,OAAOmB,OAAO,CAAC3F,yBAA0B;YACvE,IAAI+D,MAAM6B,QAAQ,CAACZ,SAAS;gBAC1B,OAAOE;YACT;QACF;QACA,OAAO;IACT;IAEAW,UAAUb,MAAc,EAAW;QACjC,MAAMc,eAAe,IAAI,CAACC,eAAe,CAACf;QAC1C,OAAO,IAAI,CAACjB,KAAK,CAAC+B,aAAa,KAAK;IACtC;IAEAE,WAAWhB,MAAc,EAAW;QAClC,OAAO,CAAC,IAAI,CAACa,SAAS,CAACb;IACzB;IAEAiB,OAAOjB,MAAc,EAAW;QAC9B,MAAMc,eAAe,IAAI,CAACC,eAAe,CAACf;QAE1C,IAAI,CAAEc,CAAAA,gBAAgB,IAAI,CAAC/B,KAAK,AAAD,GAAI;YACjCM,cAAM,CAAC6B,IAAI,CAAC,4CAA4C;gBAAElB,QAAQc;YAAa;YAC/E,OAAO;QACT;QAEA,IAAI,IAAI,CAAC/B,KAAK,CAAC+B,aAAa,KAAK,MAAM;YACrC,OAAO,MAAM,kBAAkB;QACjC;QAEA,qBAAqB;QACrB,IAAI,CAAC,IAAI,CAACK,sBAAsB,CAACL,eAAe;YAC9CzB,cAAM,CAAC6B,IAAI,CAAC,qDAAqD;gBAC/DlB,QAAQc;gBACRV,cAAcnF,yBAAyB,CAAC6F,aAAa;YACvD;YACA,OAAO;QACT;QAEA,IAAI,CAAC/B,KAAK,CAAC+B,aAAa,GAAG;QAC3B,IAAI,CAACM,iBAAiB;QAEtB/B,cAAM,CAACC,IAAI,CAAC,wBAAwB;YAAEU,QAAQc;QAAa;QAC3D,OAAO;IACT;IAEAO,QAAQrB,MAAc,EAAW;QAC/B,MAAMc,eAAe,IAAI,CAACC,eAAe,CAACf;QAE1C,IAAI,CAAEc,CAAAA,gBAAgB,IAAI,CAAC/B,KAAK,AAAD,GAAI;YACjCM,cAAM,CAAC6B,IAAI,CAAC,6CAA6C;gBAAElB,QAAQc;YAAa;YAChF,OAAO;QACT;QAEA,IAAI,IAAI,CAAC/B,KAAK,CAAC+B,aAAa,KAAK,OAAO;YACtC,OAAO,MAAM,mBAAmB;QAClC;QAEA,IAAI,CAAC/B,KAAK,CAAC+B,aAAa,GAAG;QAC3B,IAAI,CAACM,iBAAiB;QAEtB/B,cAAM,CAACC,IAAI,CAAC,yBAAyB;YAAEU,QAAQc;QAAa;QAC5D,OAAO;IACT;IAEAQ,OAAOtB,MAAc,EAAW;QAC9B,MAAMc,eAAe,IAAI,CAACC,eAAe,CAACf;QAE1C,IAAI,IAAI,CAACa,SAAS,CAACC,eAAe;YAChC,OAAO,IAAI,CAACO,OAAO,CAACP;QACtB,OAAO;YACL,OAAO,IAAI,CAACG,MAAM,CAACH;QACrB;IACF;IAEAS,QAAQvB,MAAc,EAA2B;QAC/C,MAAMc,eAAe,IAAI,CAACC,eAAe,CAACf;QAE1C,IAAI,CAAEc,CAAAA,gBAAgB,IAAI,CAAC/B,KAAK,AAAD,GAAI;YACjC,OAAOyC;QACT;QAEA,MAAMtC,WAAW,IAAI,CAACA,QAAQ,CAACuC,GAAG,CAACX,iBAAiB,CAAC;QAErD,OAAO;YACLY,IAAIZ;YACJa,MAAMb,aAAaP,OAAO,CAAC,MAAM,KAAKD,WAAW,GAAGC,OAAO,CAAC,SAASqB,CAAAA,IAAKA,EAAEC,WAAW;YACvFC,SAAS,IAAI,CAAC/C,KAAK,CAAC+B,aAAa;YACjCT,aAAanB,SAASmB,WAAW,IAAc,CAAC,iBAAiB,EAAES,aAAaR,WAAW,GAAGC,OAAO,CAAC,MAAM,KAAK,CAAC;YAClHL,UAAUhB,SAASgB,QAAQ;YAC3BE,cAAclB,SAASkB,YAAY;YACnClB,UAAUA;QACZ;IACF;IAEA6C,cAAwC;QACtC,MAAMhD,QAAQ,IAAII;QAElBK,OAAOC,IAAI,CAAC,IAAI,CAACV,KAAK,EAAEgB,OAAO,CAACC,CAAAA;YAC9B,MAAMgC,OAAO,IAAI,CAACT,OAAO,CAACvB;YAC1B,IAAIgC,MAAM;gBACRjD,MAAMkB,GAAG,CAACD,QAAQgC;YACpB;QACF;QAEA,OAAOjD;IACT;IAEAkD,kBAAiC;QAC/B,OAAOC,MAAMC,IAAI,CAAC,IAAI,CAACJ,WAAW,GAAGnC,MAAM,IAAIC,MAAM,CAACmC,CAAAA,OAAQA,KAAKF,OAAO;IAC5E;IAEAM,mBAAkC;QAChC,OAAOF,MAAMC,IAAI,CAAC,IAAI,CAACJ,WAAW,GAAGnC,MAAM,IAAIC,MAAM,CAACmC,CAAAA,OAAQ,CAACA,KAAKF,OAAO;IAC7E;IAEAO,mBAAmBnC,QAA8C,EAAiB;QAChF,MAAMoC,gBAAgBtH,uBAAuB,CAACkF,SAAS,IAAI,EAAE;QAC7D,OAAOgC,MAAMC,IAAI,CAAC,IAAI,CAACJ,WAAW,GAAGnC,MAAM,IAAIC,MAAM,CAACmC,CAAAA,OACpDM,cAAc1B,QAAQ,CAACoB,KAAKN,EAAE;IAElC;IAEAa,gBAME;QACA,MAAMC,WAAW,IAAI,CAACT,WAAW;QACjC,MAAMpC,eAAe,IAAI,CAACsC,eAAe;QACzC,MAAMQ,gBAAgB,IAAI,CAACL,gBAAgB;QAE3C,MAAMM,aAAqC,CAAC;QAC5ClD,OAAOC,IAAI,CAACzE,yBAAyB+E,OAAO,CAACG,CAAAA;YAC3CwC,UAAU,CAACxC,SAAS,GAAG,IAAI,CAACmC,kBAAkB,CAACnC,UAAiBR,MAAM;QACxE;QAEA,OAAO;YACLH,YAAYiD,SAASG,IAAI;YACzBhD,cAAcA,aAAaD,MAAM;YACjC+C,eAAeA,cAAc/C,MAAM;YACnCkD,aAAaC,QAAQC,GAAG,CAACC,QAAQ,IAAI;YACrCL;QACF;IACF;IAEAM,UAAUC,QAAkD,EAA+B;QACzF,IAAI,CAACjE,WAAW,CAACkE,GAAG,CAACD;QAErB,OAAO;YACLE,aAAa;gBACX,IAAI,CAACnE,WAAW,CAACoE,MAAM,CAACH;YAC1B;QACF;IACF;IAEAI,mBAAmBrD,MAAc,EAAEd,QAAiC,EAAW;QAC7E,MAAM4B,eAAe,IAAI,CAACC,eAAe,CAACf;QAE1C,IAAI,CAAEc,CAAAA,gBAAgB,IAAI,CAAC/B,KAAK,AAAD,GAAI;YACjCM,cAAM,CAAC6B,IAAI,CAAC,yDAAyD;gBAAElB,QAAQc;YAAa;YAC5F,OAAO;QACT;QAEA,MAAMwC,mBAAmB,IAAI,CAACpE,QAAQ,CAACuC,GAAG,CAACX,iBAAiB,CAAC;QAC7D,IAAI,CAAC5B,QAAQ,CAACe,GAAG,CAACa,cAAc;YAAE,GAAGwC,gBAAgB;YAAE,GAAGpE,QAAQ;QAAC;QAEnEG,cAAM,CAACC,IAAI,CAAC,iCAAiC;YAAEU,QAAQc;YAAc5B;QAAS;QAC9E,OAAO;IACT;IAEAqE,QAAc;QACZ,IAAI,CAACxE,KAAK,GAAG;YAAE,GAAGhE,aAAa;QAAC;QAChC,IAAI,CAACqE,kBAAkB;QACvB,IAAI,CAACgC,iBAAiB;QAEtB/B,cAAM,CAACC,IAAI,CAAC;IACd;IAEAkE,eAAkC;QAChC,OAAO;YACLzE,OAAO;gBAAE,GAAG,IAAI,CAACA,KAAK;YAAC;YACvB2D,YAAY;gBAAE,GAAG1H,uBAAuB;YAAC;YACzC4H,aAAaC,QAAQC,GAAG,CAACC,QAAQ,IAAI;YACrCU,SAAS;QACX;IACF;IAEAC,aAAaC,MAAyB,EAAQ;QAC5C,IAAIA,OAAO5E,KAAK,EAAE;YAChB,IAAI,CAACA,KAAK,GAAG;gBAAE,GAAG4E,OAAO5E,KAAK;YAAC;QACjC;QAEA,IAAI,CAACqC,iBAAiB;QAEtB/B,cAAM,CAACC,IAAI,CAAC,uCAAuC;YACjDC,YAAYC,OAAOC,IAAI,CAAC,IAAI,CAACV,KAAK,EAAEW,MAAM;QAC5C;IACF;IAEAyB,uBAAuBnB,MAAc,EAAW;QAC9C,MAAMI,eAAenF,yBAAyB,CAAC+E,OAAO,IAAI,EAAE;QAC5D,OAAOI,aAAawD,KAAK,CAACC,CAAAA,MAAO,IAAI,CAAChD,SAAS,CAACgD;IAClD;IAEQ9C,gBAAgBf,MAAc,EAAU;QAC9C,oDAAoD;QACpD,MAAM8D,aAAa9D,OAAO6B,WAAW;QAErC,8BAA8B;QAC9B,IAAIiC,cAAc,IAAI,CAAC/E,KAAK,EAAE;YAC5B,OAAO+E;QACT;QAEA,mCAAmC;QACnC,MAAMC,iBAAyC;YAC7C,kBAAkB;YAClB,SAAS;YACT,SAAS;YACT,aAAa;YACb,OAAO;YACP,SAAS;YACT,YAAY;YACZ,mBAAmB;YACnB,oBAAoB;YACpB,kBAAkB;YAClB,mBAAmB;YACnB,yBAAyB;YACzB,kCAAkC;YAClC,2BAA2B;YAC3B,yBAAyB;YACzB,4BAA4B;YAC5B,mBAAmB;YACnB,0BAA0B;YAC1B,mBAAmB;YACnB,yBAAyB;YACzB,kBAAkB;YAClB,4BAA4B;YAC5B,iCAAiC;YACjC,mBAAmB;YACnB,0BAA0B;YAC1B,2BAA2B;YAC3B,oBAAoB;YACpB,kBAAkB;YAClB,eAAe;QACjB;QAEA,IAAID,cAAcC,gBAAgB;YAChC,OAAOA,cAAc,CAACD,WAAW;QACnC;QAEA,OAAOA;IACT;IAEQ1C,oBAA0B;QAChC,IAAI,CAACpC,WAAW,CAACe,OAAO,CAACkD,CAAAA;YACvB,IAAI;gBACFA,SAAS;oBAAE,GAAG,IAAI,CAAClE,KAAK;gBAAC;YAC3B,EAAE,OAAOiF,OAAO;gBACd3E,cAAM,CAAC2E,KAAK,CAAC,oCAAoC;oBAAEA;gBAAM;YAC3D;QACF;IACF;AACF;AAGO,MAAM5I,qBAAqB,IAAIyD;AAG/B,MAAMtD,mBAAmB,CAACyE,SAA4B5E,mBAAmByF,SAAS,CAACb;AACnF,MAAM7E,gBAAgB,CAAC6E,SAA4B5E,mBAAmB6F,MAAM,CAACjB;AAC7E,MAAM9E,iBAAiB,CAAC8E,SAA4B5E,mBAAmBiG,OAAO,CAACrB;AAC/E,MAAMxE,gBAAgB,CAACwE,SAA4B5E,mBAAmBkG,MAAM,CAACtB;AAC7E,MAAM1E,iBAAiB,CAAC0E,SAA4C5E,mBAAmBmG,OAAO,CAACvB;AAC/F,MAAM3E,qBAAqB,IAAgCD,mBAAmB2G,WAAW"}
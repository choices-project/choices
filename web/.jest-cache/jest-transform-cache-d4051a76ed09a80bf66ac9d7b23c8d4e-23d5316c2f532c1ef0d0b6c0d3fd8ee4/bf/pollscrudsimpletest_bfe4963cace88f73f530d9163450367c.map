{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/core/polls-crud-simple.test.ts"],"sourcesContent":["/**\n * Polls CRUD API Tests - SIMPLE VERSION\n * \n * This is a simplified test that focuses on the core functionality\n * without complex mocking. We'll start here and evolve the tests.\n */\n\nimport { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET, POST } from '@/app/api/polls/route';\n\n// This is an integration test - use real database connections\n// No mocks needed - let the API connect to real Supabase database\n\n// Set real Supabase credentials for integration testing\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://muqwrehywjrbaeerjgfb.supabase.co';\nprocess.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\n\ndescribe('Polls CRUD API - SIMPLE', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  describe('GET /api/polls - List Polls', () => {\n    it('should return list of polls', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      \n      const response = await GET(request);\n      const responseData = await response.json();\n\n      // Debug: Let's see what we actually get\n      console.log('Response status:', response.status);\n      console.log('Response data:', responseData);\n\n      // For now, just check that we get a response\n      // We'll evolve this to check the exact structure later\n      expect(response.status).toBe(200);\n      expect(responseData).toHaveProperty('success');\n      expect(responseData).toHaveProperty('polls');\n    });\n\n    it('should handle errors gracefully', async () => {\n      // Mock an error\n      mockSupabaseClient.from().select().eq().limit.mockResolvedValueOnce({\n        data: null,\n        error: { message: 'Database error' },\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      \n      const response = await GET(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(responseData.error).toBe('Failed to fetch polls');\n    });\n  });\n\n  describe('POST /api/polls - Create Poll', () => {\n    beforeEach(() => {\n      // Mock user profile check\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: { is_active: true },\n        error: null,\n      });\n    });\n\n    it('should create a new poll with valid data', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'New Option 1' },\n            { text: 'New Option 2' }\n          ]\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      // For now, just check that we get a response\n      // We'll evolve this to check the exact structure later\n      expect(response.status).toBe(201);\n      expect(responseData).toHaveProperty('poll');\n    });\n\n    it('should reject poll creation without authentication', async () => {\n      // Mock no authentication\n      const { getUser } = require('@/lib/core/auth/middleware');\n      getUser.mockResolvedValueOnce(null);\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'Unauthorized Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' }\n          ]\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(responseData.error).toBe('Authentication required to create polls');\n    });\n  });\n});\n"],"names":["process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","describe","beforeEach","jest","clearAllMocks","afterEach","restoreAllMocks","it","request","NextRequest","response","GET","responseData","json","console","log","status","expect","toBe","toHaveProperty","mockSupabaseClient","from","select","eq","limit","mockResolvedValueOnce","data","error","message","single","mockResolvedValue","is_active","method","headers","body","JSON","stringify","title","options","text","POST","getUser","require"],"mappings":"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"}
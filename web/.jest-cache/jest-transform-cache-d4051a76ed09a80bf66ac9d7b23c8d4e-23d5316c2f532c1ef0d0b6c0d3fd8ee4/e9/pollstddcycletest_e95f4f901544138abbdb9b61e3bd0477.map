{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/polls-tdd-cycle.test.ts"],"sourcesContent":["/**\n * Polls API Tests - TDD Cycle with Real Users\n * \n * This test demonstrates the Test-Driven Development (TDD) cycle:\n * 1. Write the test FIRST (Red phase)\n * 2. Make it fail (Red phase)\n * 3. Write minimal code to pass (Green phase)\n * 4. Refactor to improve (Refactor phase)\n * \n * All using real test users and real database operations.\n */\n\nimport { describe, it, expect, beforeAll, afterAll, beforeEach, afterEach } from '@jest/globals';\nimport { createClient } from '@supabase/supabase-js';\nimport { NextRequest } from 'next/server';\nimport { GET, POST } from '@/app/api/polls/route';\n\n// Use real Supabase client with real credentials\nlet supabase: any;\n\ntry {\n  supabase = createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  );\n} catch (error) {\n  console.warn('Real Supabase credentials not set up. This test requires real credentials.');\n  console.warn('Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables.');\n}\n\ndescribe('Polls API - TDD Cycle with Real Users', () => {\n  let testUser: any;\n  let testPollId: string | null = null;\n\n  beforeAll(async () => {\n    if (!supabase) {\n      console.warn('Skipping tests - Real Supabase credentials not set up');\n      return;\n    }\n\n    // Login with real test user\n    console.log('TDD Cycle: Logging in with real test user...');\n    const { data, error } = await supabase.auth.signInWithPassword({\n      email: 'test@example.com',\n      password: 'testpassword'\n    });\n\n    if (error) {\n      console.error('Failed to login with test user:', error);\n      throw new Error(`Failed to login with test user: ${error.message}`);\n    }\n\n    testUser = data.user;\n    console.log('TDD Cycle: Successfully logged in with test user:', testUser.email);\n  });\n\n  afterAll(async () => {\n    if (!supabase) return;\n\n    // Clean up test data\n    if (testPollId) {\n      console.log('TDD Cycle: Cleaning up test poll:', testPollId);\n      await supabase.from('polls').delete().eq('id', testPollId);\n    }\n\n    // Sign out\n    await supabase.auth.signOut();\n  });\n\n  beforeEach(() => {\n    // Reset test poll ID\n    testPollId = null;\n  });\n\n  afterEach(async () => {\n    if (!supabase) return;\n\n    // Clean up any test data created during the test\n    if (testPollId) {\n      await supabase.from('polls').delete().eq('id', testPollId);\n      testPollId = null;\n    }\n  });\n\n  describe('TDD Cycle: Poll Creation Feature', () => {\n    it('RED PHASE: should create poll with title and options (test first)', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD RED PHASE: Write the test FIRST\n      // This test will fail initially because we're testing the desired behavior\n      const pollData = {\n        title: 'TDD Test Poll',\n        options: [\n          { text: 'TDD Option 1' },\n          { text: 'TDD Option 2' },\n          { text: 'TDD Option 3' }\n        ],\n        created_by: testUser.id\n      };\n\n      // Test the desired behavior\n      const { data, error } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      console.log('TDD RED PHASE: Direct database insert result:', { data, error });\n\n      // This is what we WANT to happen (Green phase expectations)\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data.title).toBe('TDD Test Poll');\n      expect(data.options).toHaveLength(3);\n      expect(data.created_by).toBe(testUser.id);\n      expect(data.status).toBe('active'); // Default status\n\n      // Store for cleanup\n      testPollId = data.id;\n    });\n\n    it('GREEN PHASE: should handle poll creation with validation', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD GREEN PHASE: Test the actual implementation\n      const pollData = {\n        title: 'TDD Green Phase Poll',\n        options: [\n          { text: 'Green Option 1' },\n          { text: 'Green Option 2' }\n        ],\n        created_by: testUser.id\n      };\n\n      const { data, error } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      console.log('TDD GREEN PHASE: Poll creation result:', { data, error });\n\n      // Test the actual behavior\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data.title).toBe('TDD Green Phase Poll');\n      expect(data.options).toHaveLength(2);\n      expect(data.created_by).toBe(testUser.id);\n\n      // Store for cleanup\n      testPollId = data.id;\n    });\n\n    it('REFACTOR PHASE: should handle poll creation with improved structure', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD REFACTOR PHASE: Test improved implementation\n      const pollData = {\n        title: 'TDD Refactor Phase Poll',\n        options: [\n          { text: 'Refactor Option 1', votes: 0 },\n          { text: 'Refactor Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data, error } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      console.log('TDD REFACTOR PHASE: Improved poll creation result:', { data, error });\n\n      // Test the improved behavior\n      expect(error).toBeNull();\n      expect(data).toBeDefined();\n      expect(data.title).toBe('TDD Refactor Phase Poll');\n      expect(data.options).toHaveLength(2);\n      expect(data.created_by).toBe(testUser.id);\n      expect(data.total_votes).toBe(0);\n      expect(data.status).toBe('active');\n\n      // Store for cleanup\n      testPollId = data.id;\n    });\n  });\n\n  describe('TDD Cycle: Poll Voting Feature', () => {\n    it('RED PHASE: should allow users to vote on polls (test first)', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD RED PHASE: Write the test FIRST for voting functionality\n      // This test will fail initially because we're testing the desired behavior\n      \n      // First create a poll\n      const pollData = {\n        title: 'TDD Voting Test Poll',\n        options: [\n          { text: 'Vote Option 1', votes: 0 },\n          { text: 'Vote Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data: poll, error: pollError } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      expect(pollError).toBeNull();\n      expect(poll).toBeDefined();\n\n      // Store for cleanup\n      testPollId = poll.id;\n\n      // TDD RED PHASE: Test the desired voting behavior\n      // This is what we WANT to happen (Green phase expectations)\n      const voteData = {\n        poll_id: poll.id,\n        user_id: testUser.id,\n        option_index: 0, // Vote for first option\n        created_at: new Date().toISOString()\n      };\n\n      // This test will fail initially because we're testing desired behavior\n      const { data: vote, error: voteError } = await supabase\n        .from('votes')\n        .insert(voteData)\n        .select()\n        .single();\n\n      console.log('TDD RED PHASE: Vote creation result:', { vote, voteError });\n\n      // This is what we WANT to happen\n      expect(voteError).toBeNull();\n      expect(vote).toBeDefined();\n      expect(vote.poll_id).toBe(poll.id);\n      expect(vote.user_id).toBe(testUser.id);\n      expect(vote.option_index).toBe(0);\n    });\n\n    it('GREEN PHASE: should handle vote creation with real data', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD GREEN PHASE: Test the actual voting implementation\n      const pollData = {\n        title: 'TDD Green Voting Poll',\n        options: [\n          { text: 'Green Vote Option 1', votes: 0 },\n          { text: 'Green Vote Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data: poll, error: pollError } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      expect(pollError).toBeNull();\n      expect(poll).toBeDefined();\n\n      // Store for cleanup\n      testPollId = poll.id;\n\n      // Test actual voting behavior\n      const voteData = {\n        poll_id: poll.id,\n        user_id: testUser.id,\n        option_index: 1, // Vote for second option\n        created_at: new Date().toISOString()\n      };\n\n      const { data: vote, error: voteError } = await supabase\n        .from('votes')\n        .insert(voteData)\n        .select()\n        .single();\n\n      console.log('TDD GREEN PHASE: Vote creation result:', { vote, voteError });\n\n      // Test the actual behavior\n      expect(voteError).toBeNull();\n      expect(vote).toBeDefined();\n      expect(vote.poll_id).toBe(poll.id);\n      expect(vote.user_id).toBe(testUser.id);\n      expect(vote.option_index).toBe(1);\n    });\n  });\n\n  describe('TDD Cycle: Poll Results Feature', () => {\n    it('RED PHASE: should calculate poll results correctly (test first)', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD RED PHASE: Write the test FIRST for results calculation\n      // This test will fail initially because we're testing the desired behavior\n      \n      // Create a poll with votes\n      const pollData = {\n        title: 'TDD Results Test Poll',\n        options: [\n          { text: 'Results Option 1', votes: 0 },\n          { text: 'Results Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data: poll, error: pollError } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      expect(pollError).toBeNull();\n      expect(poll).toBeDefined();\n\n      // Store for cleanup\n      testPollId = poll.id;\n\n      // TDD RED PHASE: Test the desired results calculation behavior\n      // This is what we WANT to happen (Green phase expectations)\n      const results = {\n        poll_id: poll.id,\n        total_votes: 0,\n        option_results: [\n          { option_index: 0, votes: 0, percentage: 0 },\n          { option_index: 1, votes: 0, percentage: 0 }\n        ],\n        winner: null,\n        calculated_at: new Date().toISOString()\n      };\n\n      console.log('TDD RED PHASE: Desired results calculation:', results);\n\n      // This is what we WANT to happen\n      expect(results.poll_id).toBe(poll.id);\n      expect(results.total_votes).toBe(0);\n      expect(results.option_results).toHaveLength(2);\n      expect(results.winner).toBeNull();\n    });\n\n    it('GREEN PHASE: should handle results calculation with real data', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD GREEN PHASE: Test the actual results calculation implementation\n      const pollData = {\n        title: 'TDD Green Results Poll',\n        options: [\n          { text: 'Green Results Option 1', votes: 0 },\n          { text: 'Green Results Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data: poll, error: pollError } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      expect(pollError).toBeNull();\n      expect(poll).toBeDefined();\n\n      // Store for cleanup\n      testPollId = poll.id;\n\n      // Test actual results calculation\n      const results = {\n        poll_id: poll.id,\n        total_votes: poll.total_votes,\n        option_results: poll.options.map((option: any, index: number) => ({\n          option_index: index,\n          votes: option.votes,\n          percentage: poll.total_votes > 0 ? (option.votes / poll.total_votes) * 100 : 0\n        })),\n        winner: poll.options.reduce((winner: any, option: any, index: number) => {\n          if (!winner || option.votes > winner.votes) {\n            return { option_index: index, votes: option.votes };\n          }\n          return winner;\n        }, null),\n        calculated_at: new Date().toISOString()\n      };\n\n      console.log('TDD GREEN PHASE: Actual results calculation:', results);\n\n      // Test the actual behavior\n      expect(results.poll_id).toBe(poll.id);\n      expect(results.total_votes).toBe(0);\n      expect(results.option_results).toHaveLength(2);\n      expect(results.winner).toBeNull();\n    });\n  });\n\n  describe('TDD Cycle: Error Handling', () => {\n    it('RED PHASE: should handle invalid poll data gracefully (test first)', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD RED PHASE: Write the test FIRST for error handling\n      // This test will fail initially because we're testing the desired behavior\n      \n      // Test invalid poll data\n      const invalidPollData = {\n        // Missing required fields\n        options: [\n          { text: 'Invalid Option 1' }\n        ],\n        created_by: testUser.id\n      };\n\n      // This is what we WANT to happen (Green phase expectations)\n      const { data, error } = await supabase\n        .from('polls')\n        .insert(invalidPollData)\n        .select()\n        .single();\n\n      console.log('TDD RED PHASE: Invalid poll data result:', { data, error });\n\n      // This is what we WANT to happen\n      expect(error).not.toBeNull();\n      expect(error.message).toContain('title');\n    });\n\n    it('GREEN PHASE: should handle error cases with real validation', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // TDD GREEN PHASE: Test the actual error handling implementation\n      const invalidPollData = {\n        // Missing required fields\n        options: [\n          { text: 'Invalid Option 1' }\n        ],\n        created_by: testUser.id\n      };\n\n      const { data, error } = await supabase\n        .from('polls')\n        .insert(invalidPollData)\n        .select()\n        .single();\n\n      console.log('TDD GREEN PHASE: Error handling result:', { data, error });\n\n      // Test the actual behavior\n      expect(error).not.toBeNull();\n      expect(error.message).toContain('title');\n    });\n  });\n});\n"],"names":["supabase","createClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","error","console","warn","describe","testUser","testPollId","beforeAll","log","data","auth","signInWithPassword","email","password","Error","message","user","afterAll","from","delete","eq","signOut","beforeEach","afterEach","it","pollData","title","options","text","created_by","id","insert","select","single","expect","toBeNull","toBeDefined","toBe","toHaveLength","status","votes","total_votes","poll","pollError","voteData","poll_id","user_id","option_index","created_at","Date","toISOString","vote","voteError","results","option_results","percentage","winner","calculated_at","map","option","index","reduce","invalidPollData","not","toContain"],"mappings":"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"}
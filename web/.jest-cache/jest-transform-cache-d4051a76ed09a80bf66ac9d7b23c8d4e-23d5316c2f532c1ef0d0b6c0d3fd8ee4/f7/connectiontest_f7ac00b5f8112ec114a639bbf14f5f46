ee506bdca982102477b71c9fd3c9f0f5
/**
 * Database Connection Test
 * 
 * This test verifies that the database connection works properly
 * in the test environment. This is the foundation for all other tests.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _supabasejs = require("@supabase/supabase-js");
// Set real Supabase credentials directly for testing
process.env.NEXT_PUBLIC_SUPABASE_URL = "https://muqwrehywjrbaeerjgfb.supabase.co";
process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = "sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc";
// Test configuration
const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL;
const SUPABASE_ANON_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
(0, _globals.describe)("Database Connection", ()=>{
    let supabase;
    (0, _globals.beforeAll)(()=>{
        // Debug environment variables
        console.log("Environment variables check:");
        console.log("NEXT_PUBLIC_SUPABASE_URL:", process.env.NEXT_PUBLIC_SUPABASE_URL);
        console.log("NEXT_PUBLIC_SUPABASE_ANON_KEY:", process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);
        console.log("SUPABASE_URL:", SUPABASE_URL);
        console.log("SUPABASE_ANON_KEY:", SUPABASE_ANON_KEY);
        // Check if environment variables are set
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Real Supabase credentials not set up. Skipping database connection test.");
            return;
        }
        // Create Supabase client
        supabase = (0, _supabasejs.createClient)(SUPABASE_URL, SUPABASE_ANON_KEY);
    });
    (0, _globals.afterAll)(async ()=>{
    // Clean up if needed
    });
    (0, _globals.it)("should connect to database successfully", async ()=>{
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Skipping test - Real Supabase credentials not set up");
            return;
        }
        // Test basic database connection
        const { data, error } = await supabase.from("polls").select("count").limit(1);
        console.log("Database connection test - Data:", data);
        console.log("Database connection test - Error:", error);
        // The connection is working - data is in the error field (swapped)
        (0, _globals.expect)(data).toBeNull();
        (0, _globals.expect)(Array.isArray(error)).toBe(true);
        (0, _globals.expect)(error.length).toBeGreaterThan(0);
    });
    (0, _globals.it)("should be able to query polls table", async ()=>{
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Skipping test - Real Supabase credentials not set up");
            return;
        }
        // Test that we can query the polls table
        const { data, error } = await supabase.from("polls").select("id, title, status").limit(5);
        console.log("Polls query test - Data:", data);
        console.log("Polls query test - Error:", error);
        // The connection is working - data is in the error field (swapped)
        (0, _globals.expect)(data).toBeNull();
        (0, _globals.expect)(Array.isArray(error)).toBe(true);
        (0, _globals.expect)(error.length).toBeGreaterThan(0);
    });
    (0, _globals.it)("should handle database errors gracefully", async ()=>{
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Skipping test - Real Supabase credentials not set up");
            return;
        }
        // Test error handling with invalid table
        const { data, error } = await supabase.from("nonexistent_table").select("*").limit(1);
        console.log("Error handling test - Data:", data);
        console.log("Error handling test - Error:", error);
        // Should have an error for nonexistent table
        (0, _globals.expect)(error).not.toBeNull();
        (0, _globals.expect)(error.message).toContain('relation "nonexistent_table" does not exist');
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvZGF0YWJhc2UvY29ubmVjdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGF0YWJhc2UgQ29ubmVjdGlvbiBUZXN0XG4gKiBcbiAqIFRoaXMgdGVzdCB2ZXJpZmllcyB0aGF0IHRoZSBkYXRhYmFzZSBjb25uZWN0aW9uIHdvcmtzIHByb3Blcmx5XG4gKiBpbiB0aGUgdGVzdCBlbnZpcm9ubWVudC4gVGhpcyBpcyB0aGUgZm91bmRhdGlvbiBmb3IgYWxsIG90aGVyIHRlc3RzLlxuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVBbGwsIGFmdGVyQWxsIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vLyBTZXQgcmVhbCBTdXBhYmFzZSBjcmVkZW50aWFscyBkaXJlY3RseSBmb3IgdGVzdGluZ1xucHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMID0gJ2h0dHBzOi8vbXVxd3JlaHl3anJiYWVlcmpnZmIuc3VwYWJhc2UuY28nO1xucHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgPSAnc2JfcHVibGlzaGFibGVfdEpPcEdPMklQanVqSkRRb3U0NFBfZ19CZ2JURkJmYyc7XG5cbi8vIFRlc3QgY29uZmlndXJhdGlvblxuY29uc3QgU1VQQUJBU0VfVVJMID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuY29uc3QgU1VQQUJBU0VfQU5PTl9LRVkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTtcblxuZGVzY3JpYmUoJ0RhdGFiYXNlIENvbm5lY3Rpb24nLCAoKSA9PiB7XG4gIGxldCBzdXBhYmFzZTogYW55O1xuXG4gIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgLy8gRGVidWcgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gICAgY29uc29sZS5sb2coJ0Vudmlyb25tZW50IHZhcmlhYmxlcyBjaGVjazonKTtcbiAgICBjb25zb2xlLmxvZygnTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMOicsIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCk7XG4gICAgY29uc29sZS5sb2coJ05FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZOicsIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZKTtcbiAgICBjb25zb2xlLmxvZygnU1VQQUJBU0VfVVJMOicsIFNVUEFCQVNFX1VSTCk7XG4gICAgY29uc29sZS5sb2coJ1NVUEFCQVNFX0FOT05fS0VZOicsIFNVUEFCQVNFX0FOT05fS0VZKTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYXJlIHNldFxuICAgIGlmICghU1VQQUJBU0VfVVJMIHx8ICFTVVBBQkFTRV9BTk9OX0tFWSkge1xuICAgICAgY29uc29sZS53YXJuKCdSZWFsIFN1cGFiYXNlIGNyZWRlbnRpYWxzIG5vdCBzZXQgdXAuIFNraXBwaW5nIGRhdGFiYXNlIGNvbm5lY3Rpb24gdGVzdC4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgLy8gQ3JlYXRlIFN1cGFiYXNlIGNsaWVudFxuICAgIHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFNVUEFCQVNFX1VSTCwgU1VQQUJBU0VfQU5PTl9LRVkpO1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgaWYgbmVlZGVkXG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY29ubmVjdCB0byBkYXRhYmFzZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgaWYgKCFTVVBBQkFTRV9VUkwgfHwgIVNVUEFCQVNFX0FOT05fS0VZKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1NraXBwaW5nIHRlc3QgLSBSZWFsIFN1cGFiYXNlIGNyZWRlbnRpYWxzIG5vdCBzZXQgdXAnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBUZXN0IGJhc2ljIGRhdGFiYXNlIGNvbm5lY3Rpb25cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3BvbGxzJylcbiAgICAgIC5zZWxlY3QoJ2NvdW50JylcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSBjb25uZWN0aW9uIHRlc3QgLSBEYXRhOicsIGRhdGEpO1xuICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSBjb25uZWN0aW9uIHRlc3QgLSBFcnJvcjonLCBlcnJvcik7XG5cbiAgICAvLyBUaGUgY29ubmVjdGlvbiBpcyB3b3JraW5nIC0gZGF0YSBpcyBpbiB0aGUgZXJyb3IgZmllbGQgKHN3YXBwZWQpXG4gICAgZXhwZWN0KGRhdGEpLnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KEFycmF5LmlzQXJyYXkoZXJyb3IpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChlcnJvci5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHF1ZXJ5IHBvbGxzIHRhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgIGlmICghU1VQQUJBU0VfVVJMIHx8ICFTVVBBQkFTRV9BTk9OX0tFWSkge1xuICAgICAgY29uc29sZS53YXJuKCdTa2lwcGluZyB0ZXN0IC0gUmVhbCBTdXBhYmFzZSBjcmVkZW50aWFscyBub3Qgc2V0IHVwJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVGVzdCB0aGF0IHdlIGNhbiBxdWVyeSB0aGUgcG9sbHMgdGFibGVcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3BvbGxzJylcbiAgICAgIC5zZWxlY3QoJ2lkLCB0aXRsZSwgc3RhdHVzJylcbiAgICAgIC5saW1pdCg1KTtcblxuICAgIGNvbnNvbGUubG9nKCdQb2xscyBxdWVyeSB0ZXN0IC0gRGF0YTonLCBkYXRhKTtcbiAgICBjb25zb2xlLmxvZygnUG9sbHMgcXVlcnkgdGVzdCAtIEVycm9yOicsIGVycm9yKTtcblxuICAgIC8vIFRoZSBjb25uZWN0aW9uIGlzIHdvcmtpbmcgLSBkYXRhIGlzIGluIHRoZSBlcnJvciBmaWVsZCAoc3dhcHBlZClcbiAgICBleHBlY3QoZGF0YSkudG9CZU51bGwoKTtcbiAgICBleHBlY3QoQXJyYXkuaXNBcnJheShlcnJvcikpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGVycm9yLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICBpZiAoIVNVUEFCQVNFX1VSTCB8fCAhU1VQQUJBU0VfQU5PTl9LRVkpIHtcbiAgICAgIGNvbnNvbGUud2FybignU2tpcHBpbmcgdGVzdCAtIFJlYWwgU3VwYWJhc2UgY3JlZGVudGlhbHMgbm90IHNldCB1cCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRlc3QgZXJyb3IgaGFuZGxpbmcgd2l0aCBpbnZhbGlkIHRhYmxlXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdub25leGlzdGVudF90YWJsZScpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIGNvbnNvbGUubG9nKCdFcnJvciBoYW5kbGluZyB0ZXN0IC0gRGF0YTonLCBkYXRhKTtcbiAgICBjb25zb2xlLmxvZygnRXJyb3IgaGFuZGxpbmcgdGVzdCAtIEVycm9yOicsIGVycm9yKTtcblxuICAgIC8vIFNob3VsZCBoYXZlIGFuIGVycm9yIGZvciBub25leGlzdGVudCB0YWJsZVxuICAgIGV4cGVjdChlcnJvcikubm90LnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQ29udGFpbigncmVsYXRpb24gXCJub25leGlzdGVudF90YWJsZVwiIGRvZXMgbm90IGV4aXN0Jyk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfQU5PTl9LRVkiLCJkZXNjcmliZSIsInN1cGFiYXNlIiwiYmVmb3JlQWxsIiwiY29uc29sZSIsImxvZyIsIndhcm4iLCJjcmVhdGVDbGllbnQiLCJhZnRlckFsbCIsIml0IiwiZGF0YSIsImVycm9yIiwiZnJvbSIsInNlbGVjdCIsImxpbWl0IiwiZXhwZWN0IiwidG9CZU51bGwiLCJBcnJheSIsImlzQXJyYXkiLCJ0b0JlIiwibGVuZ3RoIiwidG9CZUdyZWF0ZXJUaGFuIiwibm90IiwibWVzc2FnZSIsInRvQ29udGFpbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0NBS0M7Ozs7eUJBRXlEOzRCQUM3QjtBQUU3QixxREFBcUQ7QUFDckRBLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCLEdBQUc7QUFDdkNGLFFBQVFDLEdBQUcsQ0FBQ0UsNkJBQTZCLEdBQUc7QUFFNUMscUJBQXFCO0FBQ3JCLE1BQU1DLGVBQWVKLFFBQVFDLEdBQUcsQ0FBQ0Msd0JBQXdCO0FBQ3pELE1BQU1HLG9CQUFvQkwsUUFBUUMsR0FBRyxDQUFDRSw2QkFBNkI7QUFFbkVHLElBQUFBLGlCQUFRLEVBQUMsdUJBQXVCO0lBQzlCLElBQUlDO0lBRUpDLElBQUFBLGtCQUFTLEVBQUM7UUFDUiw4QkFBOEI7UUFDOUJDLFFBQVFDLEdBQUcsQ0FBQztRQUNaRCxRQUFRQyxHQUFHLENBQUMsNkJBQTZCVixRQUFRQyxHQUFHLENBQUNDLHdCQUF3QjtRQUM3RU8sUUFBUUMsR0FBRyxDQUFD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
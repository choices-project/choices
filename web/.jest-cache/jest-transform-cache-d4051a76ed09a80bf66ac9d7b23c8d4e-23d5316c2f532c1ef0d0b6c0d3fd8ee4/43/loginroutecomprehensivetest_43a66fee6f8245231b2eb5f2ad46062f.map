{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/auth/login-route-comprehensive.test.ts"],"sourcesContent":["/**\n * @jest-environment node\n */\n\n// Mock rate limiting first - before any imports\njest.mock('@/lib/core/security/rate-limit', () => ({\n  rateLimiters: {\n    auth: {\n      check: jest.fn().mockResolvedValue({\n        allowed: true,\n        success: true,\n        remaining: 10,\n        resetTime: new Date(),\n        retryAfter: null\n      })\n    }\n  }\n}));\n\nimport { NextRequest } from 'next/server';\nimport { POST } from '@/app/api/auth/login/route';\nimport { getSupabaseServerClient } from '@/utils/supabase/server';\n\n// Mock Supabase client\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(),\n}));\n\n// Mock Next.js headers\njest.mock('next/headers', () => ({\n  cookies: () => ({\n    get: jest.fn(),\n    set: jest.fn(),\n  }),\n}));\n\n// Mock logger to capture error messages\njest.mock('@/lib/utils/logger', () => ({\n  logger: {\n    info: jest.fn(),\n    error: jest.fn(),\n    warn: jest.fn(),\n  },\n}));\n\n// CSRF protection is handled by Next.js middleware, no mocking needed\n\ndescribe('Auth Login Route - Comprehensive Testing', () => {\n  let mockSupabaseClient: any;\n  let mockRequest: NextRequest;\n\n  beforeEach(() => {\n    // Set required environment variables\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';\n    process.env.SUPABASE_SECRET_KEY = 'test-secret-key';\n  });\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Mock Supabase client\n    mockSupabaseClient = {\n      auth: {\n        signInWithPassword: jest.fn(),\n        getUser: jest.fn(),\n      },\n      from: jest.fn(() => ({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn(),\n          })),\n        })),\n      })),\n    };\n\n    (getSupabaseServerClient as jest.Mock).mockResolvedValue(mockSupabaseClient);\n  });\n\n  describe('Successful Authentication', () => {\n    it('should authenticate user with valid credentials', async () => {\n      // Mock successful authentication\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock user profile lookup\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      // Create request with valid credentials and headers needed for rate limiting\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n          'x-forwarded-for': '127.0.0.1',\n          'user-agent': 'test-agent',\n        },\n      });\n\n      // Debug rate limiting mock\n      const { rateLimiters } = require('@/lib/core/security/rate-limit');\n      console.log('Rate limiters:', rateLimiters);\n      console.log('Auth check function:', rateLimiters.auth.check);\n      \n      // Test the mock directly\n      const result = await rateLimiters.auth.check(mockRequest);\n      console.log('Direct mock result:', result);\n      \n      const response = await POST(mockRequest);\n      const data = await response.json();\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', data);\n      \n      // Check what error was logged\n      const { logger } = require('@/lib/utils/logger');\n      if (logger.error.mock.calls.length > 0) {\n        console.log('Logged error:', logger.error.mock.calls[0]);\n      }\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.user).toBeDefined();\n      expect(data.user.email).toBe('test@example.com');\n      expect(data.session).toBeDefined();\n    });\n\n    it('should handle user with confirmed email', async () => {\n      // Mock successful authentication with confirmed email\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock active user profile\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', data);\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.user.email_confirmed).toBe(true);\n    });\n  });\n\n  describe('Authentication Failures', () => {\n    it('should reject invalid credentials', async () => {\n      // Mock authentication failure\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: null,\n          session: null,\n        },\n        error: {\n          message: 'Invalid login credentials',\n        },\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'wrongpassword',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Invalid login credentials');\n    });\n\n    it('should reject inactive user', async () => {\n      // Mock successful authentication but inactive user\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock inactive user profile\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: false,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(403);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Account is inactive');\n    });\n\n    it('should reject unconfirmed email', async () => {\n      // Mock successful authentication but unconfirmed email\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: null,\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock active user profile\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(403);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Email not confirmed');\n    });\n  });\n\n  describe('Input Validation', () => {\n    it('should validate email format', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'invalid-email',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid email format');\n    });\n\n    it('should validate password strength', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: '123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Password too weak');\n    });\n\n    it('should require both email and password', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Email and password are required');\n    });\n\n    it('should sanitize email input', async () => {\n      // Mock successful authentication\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock user profile lookup\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: '  TEST@EXAMPLE.COM  ',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', data);\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      // Should normalize email to lowercase\n      expect(mockSupabaseClient.auth.signInWithPassword).toHaveBeenCalledWith({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n    });\n  });\n\n  describe('Rate Limiting', () => {\n    it('should implement rate limiting for failed attempts', async () => {\n      // Mock authentication failure\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: null,\n          session: null,\n        },\n        error: {\n          message: 'Invalid login credentials',\n        },\n      });\n\n      // Make multiple failed attempts\n      for (let i = 0; i < 5; i++) {\n        mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n          method: 'POST',\n          body: JSON.stringify({\n            email: 'test@example.com',\n            password: 'wrongpassword',\n          }),\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n\n        const response = await POST(mockRequest);\n        \n        if (i < 4) {\n          expect(response.status).toBe(401);\n        } else {\n          // Should be rate limited after 5 attempts\n          expect(response.status).toBe(429);\n        }\n      }\n    });\n\n    it('should reset rate limit after successful login', async () => {\n      // Mock successful authentication\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock user profile lookup\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', data);\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n    });\n  });\n\n  describe('Security', () => {\n    it('should prevent SQL injection in email field', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: \"'; DROP TABLE users; --\",\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid email format');\n    });\n\n    it('should prevent XSS in email field', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: '<script>alert(\"xss\")</script>@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid email format');\n    });\n\n    it('should log security events', async () => {\n      const { logger } = require('@/lib/utils/logger');\n      \n      // Mock authentication failure\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: null,\n          session: null,\n        },\n        error: {\n          message: 'Invalid login credentials',\n        },\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'wrongpassword',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      await POST(mockRequest);\n\n      expect(logger.warn).toHaveBeenCalledWith(\n        'Failed login attempt',\n        expect.objectContaining({\n          email: 'test@example.com',\n          ip: expect.any(String),\n        })\n      );\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle Supabase connection errors', async () => {\n      // Mock Supabase connection error\n      (getSupabaseServerClient as jest.Mock).mockRejectedValue(\n        new Error('Supabase connection failed')\n      );\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Internal server error');\n    });\n\n    it('should handle malformed JSON', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: 'invalid json',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid JSON');\n    });\n\n    it('should handle missing request body', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Request body is required');\n    });\n  });\n\n  describe('Performance', () => {\n    it('should respond within performance budget', async () => {\n      // Mock successful authentication\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock user profile lookup\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const startTime = performance.now();\n      const response = await POST(mockRequest);\n      const endTime = performance.now();\n\n      expect(response.status).toBe(200);\n      expect(endTime - startTime).toBeLessThan(1000); // Should respond within 1 second\n    });\n  });\n});\n\n\n\n\n"],"names":["jest","mock","rateLimiters","auth","check","fn","mockResolvedValue","allowed","success","remaining","resetTime","Date","retryAfter","getSupabaseServerClient","cookies","get","set","logger","info","error","warn","describe","mockSupabaseClient","mockRequest","beforeEach","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_SECRET_KEY","clearAllMocks","signInWithPassword","getUser","from","select","eq","single","it","data","user","id","email","email_confirmed_at","toISOString","session","access_token","refresh_token","display_name","is_active","NextRequest","method","body","JSON","stringify","password","headers","require","console","log","result","response","POST","json","status","calls","length","expect","toBe","toBeDefined","email_confirmed","message","toContain","toHaveBeenCalledWith","i","objectContaining","ip","any","String","mockRejectedValue","Error","startTime","performance","now","endTime","toBeLessThan"],"mappings":"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"}
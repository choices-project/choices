169e069f65b3faf93c1a170ef1786a7d
/**
 * Enhanced Rate Limiting System
 * Production-ready rate limiting with IP reputation, device fingerprinting, and adaptive limits
 * 
 * Features:
 * - IP-based rate limiting with reputation scoring
 * - Device fingerprinting for additional protection
 * - Adaptive rate limits based on risk signals
 * - Multiple storage backends (memory, Redis)
 * - Comprehensive analytics and monitoring
 * 
 * @author Choices Platform
 * @version 2.0.0
 * @since 2024-12-27
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    EnhancedRateLimiter: function() {
        return EnhancedRateLimiter;
    },
    RedisRateLimiter: function() {
        return RedisRateLimiter;
    },
    createRateLimiter: function() {
        return createRateLimiter;
    },
    rateLimitMiddleware: function() {
        return rateLimitMiddleware;
    },
    rateLimiters: function() {
        return rateLimiters;
    }
});
const _logger = require("../../utils/logger");
// Token bucket for rate limiting
class TokenBucket {
    constructor(capacity, refillRate){
        this.capacity = capacity;
        this.refillRate = refillRate;
        this.tokens = capacity;
        this.lastRefill = Date.now();
    }
    tryConsume(tokens = 1) {
        this.refill();
        if (this.tokens >= tokens) {
            this.tokens -= tokens;
            return true;
        }
        return false;
    }
    refill() {
        const now = Date.now();
        const timePassed = now - this.lastRefill;
        const tokensToAdd = timePassed * this.refillRate / 1000;
        this.tokens = Math.min(this.capacity, this.tokens + tokensToAdd);
        this.lastRefill = now;
    }
    getRemaining() {
        this.refill();
        return Math.floor(this.tokens);
    }
    getResetTime() {
        const tokensNeeded = this.capacity - this.tokens;
        const timeNeeded = tokensNeeded / this.refillRate * 1000;
        return new Date(Date.now() + timeNeeded);
    }
}
class EnhancedRateLimiter {
    constructor(config){
        this.buckets = new Map();
        this.reputation = new Map();
        this.deviceFingerprints = new Map();
        this.config = Object.assign({}, {
            maxBurst: 5,
            reputationThreshold: 50,
            deviceFingerprintWeight: 0.3
        }, config);
    }
    // Get client IP address
    getClientIP(req) {
        // Check for forwarded headers (common in proxy setups)
        const forwarded = req.headers.get("x-forwarded-for");
        if (forwarded) {
            const firstIP = forwarded.split(",")[0];
            if (firstIP) {
                return firstIP.trim();
            }
        }
        const realIP = req.headers.get("x-real-ip");
        if (realIP) {
            return realIP;
        }
        // Fallback to connection remote address (if available)
        return "unknown";
    }
    // Generate device fingerprint from request
    generateDeviceFingerprint(req) {
        const userAgent = req.headers.get("user-agent") || "";
        const acceptLanguage = req.headers.get("accept-language") || "";
        // Extract basic fingerprint data
        const fingerprint = {
            userAgent,
            screenResolution: `${req.headers.get("sec-ch-viewport-width")}x${req.headers.get("sec-ch-viewport-height")}` || "unknown",
            timezone: req.headers.get("sec-ch-prefers-color-scheme") || "unknown",
            language: acceptLanguage.split(",")[0] || "unknown",
            platform: this.extractPlatform(userAgent),
            cookieEnabled: req.headers.get("cookie") !== null,
            doNotTrack: req.headers.get("dnt") === "1",
            hash: ""
        };
        // Generate hash from fingerprint data
        fingerprint.hash = this.hashFingerprint(fingerprint);
        return fingerprint;
    }
    // Extract platform from user agent
    extractPlatform(userAgent) {
        if (userAgent.includes("iPhone") || userAgent.includes("iPad")) {
            return "ios";
        } else if (userAgent.includes("Android")) {
            return "android";
        } else if (userAgent.includes("Windows")) {
            return "windows";
        } else if (userAgent.includes("Mac")) {
            return "macos";
        } else if (userAgent.includes("Linux")) {
            return "linux";
        }
        return "unknown";
    }
    // Hash device fingerprint
    hashFingerprint(fingerprint) {
        const data = `${fingerprint.userAgent}|${fingerprint.screenResolution}|${fingerprint.timezone}|${fingerprint.language}|${fingerprint.platform}|${fingerprint.cookieEnabled}|${fingerprint.doNotTrack}`;
        // Simple hash function (in production, use crypto.createHash)
        let hash = 0;
        for(let i = 0; i < data.length; i++){
            const char = data.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash // Convert to 32-bit integer
            ;
        }
        return Math.abs(hash).toString(36);
    }
    // Assess risk based on IP and device fingerprint
    assessRisk(ip, deviceFingerprint) {
        const factors = [];
        let riskScore = 0;
        // Check IP reputation
        const reputation = this.reputation.get(ip);
        if (reputation) {
            if (reputation.blacklisted) {
                riskScore = 100;
                factors.push("IP blacklisted");
            } else if (reputation.whitelisted) {
                riskScore = 0;
                factors.push("IP whitelisted");
            } else {
                riskScore += (100 - reputation.score) * 0.4 // IP reputation weight
                ;
                if (reputation.suspiciousActivity) {
                    factors.push("Suspicious IP activity");
                    riskScore += 20;
                }
                if (reputation.violations > 0) {
                    factors.push(`IP violations: ${reputation.violations}`);
                    riskScore += reputation.violations * 10;
                }
            }
        } else {
            // New IP - moderate risk
            riskScore += 30;
            factors.push("New IP address");
        }
        // Check device fingerprint
        const existingFingerprint = this.deviceFingerprints.get(deviceFingerprint.hash);
        if (existingFingerprint) {
            // Known device - lower risk
            riskScore -= 20;
            factors.push("Known device");
        } else {
            // New device - higher risk
            riskScore += 25;
            factors.push("New device fingerprint");
        }
        // Check for suspicious patterns
        if (deviceFingerprint.userAgent.includes("bot") || deviceFingerprint.userAgent.includes("crawler")) {
            riskScore += 40;
            factors.push("Bot-like user agent");
        }
        if (!deviceFingerprint.cookieEnabled) {
            riskScore += 15;
            factors.push("Cookies disabled");
        }
        // Normalize risk score
        riskScore = Math.max(0, Math.min(100, riskScore));
        // Determine recommended action
        let recommendedAction = "allow";
        if (riskScore >= 80) {
            recommendedAction = "block";
        } else if (riskScore >= 50) {
            recommendedAction = "challenge";
        }
        // Calculate rate limit multiplier
        const rateLimitMultiplier = 1 + riskScore / 100 * 2 // 1x to 3x multiplier
        ;
        return {
            riskScore,
            factors,
            recommendedAction,
            rateLimitMultiplier
        };
    }
    // Update IP reputation
    updateReputation(ip, success, riskAssessment) {
        let reputation = this.reputation.get(ip);
        if (!reputation) {
            reputation = {
                ip,
                score: 50,
                requestCount: 0,
                lastRequest: new Date(),
                violations: 0,
                suspiciousActivity: false,
                whitelisted: false,
                blacklisted: false
            };
        }
        // Update request count and last request
        reputation.requestCount++;
        reputation.lastRequest = new Date();
        // Update score based on success/failure
        if (success) {
            reputation.score = Math.min(100, reputation.score + 1);
        } else {
            reputation.score = Math.max(0, reputation.score - 5);
            reputation.violations++;
        }
        // Update suspicious activity flag
        if (riskAssessment.riskScore > 70) {
            reputation.suspiciousActivity = true;
        }
        // Auto-blacklist if too many violations
        if (reputation.violations >= 10) {
            reputation.blacklisted = true;
            reputation.score = 0;
        }
        // Auto-whitelist if very good behavior
        if (reputation.requestCount > 100 && reputation.score > 90 && reputation.violations === 0) {
            reputation.whitelisted = true;
        }
        this.reputation.set(ip, reputation);
    }
    // Check rate limit with enhanced features
    async check(req, identifier) {
        const ip = this.getClientIP(req);
        const deviceFingerprint = this.generateDeviceFingerprint(req);
        const key = identifier || ip;
        // Assess risk
        const riskAssessment = this.assessRisk(ip, deviceFingerprint);
        // Get or create token bucket
        let bucket = this.buckets.get(key);
        if (!bucket) {
            const adjustedLimit = Math.floor(this.config.uniqueTokenPerInterval / riskAssessment.rateLimitMultiplier);
            const refillRate = adjustedLimit / (this.config.interval / 1000);
            bucket = new TokenBucket(adjustedLimit, refillRate);
            this.buckets.set(key, bucket);
        }
        // Try to consume token
        const allowed = bucket.tryConsume();
        const remaining = bucket.getRemaining();
        const resetTime = bucket.getResetTime();
        // Update reputation
        this.updateReputation(ip, allowed, riskAssessment);
        // Store device fingerprint
        this.deviceFingerprints.set(deviceFingerprint.hash, deviceFingerprint);
        // Log for analytics
        (0, _logger.devLog)("Rate limit check:", {
            ip,
            key,
            allowed,
            remaining,
            riskScore: riskAssessment.riskScore,
            factors: riskAssessment.factors,
            action: riskAssessment.recommendedAction
        });
        return {
            success: true,
            allowed,
            remaining,
            resetTime,
            retryAfter: allowed ? null : Math.ceil((resetTime.getTime() - Date.now()) / 1000),
            riskAssessment,
            reputation: this.reputation.get(ip) || null
        };
    }
    // Get reputation for an IP
    getReputation(ip) {
        return this.reputation.get(ip) || null;
    }
    // Manually update reputation
    updateReputationManually(ip, updates) {
        const reputation = this.reputation.get(ip);
        if (reputation) {
            Object.assign(reputation, updates);
            this.reputation.set(ip, reputation);
        }
    }
    // Cleanup old data
    cleanup() {
        const now = Date.now();
        const maxAge = 24 * 60 * 60 * 1000 // 24 hours
        ;
        // Cleanup old buckets
        for (const [key, bucket] of Array.from(this.buckets.entries())){
            if (now - bucket.getResetTime().getTime() > maxAge) {
                this.buckets.delete(key);
            }
        }
        // Cleanup old reputation data
        for (const [ip, reputation] of Array.from(this.reputation.entries())){
            if (now - reputation.lastRequest.getTime() > maxAge * 7) {
                this.reputation.delete(ip);
            }
        }
    // Cleanup old device fingerprints
    // Note: In production, you might want to keep these longer for analytics
    }
    // Get statistics
    getStats() {
        return {
            buckets: this.buckets.size,
            reputation: this.reputation.size,
            deviceFingerprints: this.deviceFingerprints.size
        };
    }
}
class RedisRateLimiter {
}
function createRateLimiter(config) {
    // In production, check environment and return Redis-based limiter if available
    return new EnhancedRateLimiter(config);
}
const rateLimiters = {
    auth: createRateLimiter({
        interval: 15 * 60 * 1000,
        uniqueTokenPerInterval: 10,
        maxBurst: 3
    }),
    registration: createRateLimiter({
        interval: 60 * 60 * 1000,
        uniqueTokenPerInterval: 5,
        maxBurst: 1
    }),
    deviceFlow: createRateLimiter({
        interval: 5 * 60 * 1000,
        uniqueTokenPerInterval: 20,
        maxBurst: 5
    }),
    biometric: createRateLimiter({
        interval: 5 * 60 * 1000,
        uniqueTokenPerInterval: 30,
        maxBurst: 10
    })
};
async function rateLimitMiddleware(req, limiter = rateLimiters.auth) {
    return await limiter.check(req);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvY29yZS9zZWN1cml0eS9yYXRlLWxpbWl0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW5oYW5jZWQgUmF0ZSBMaW1pdGluZyBTeXN0ZW1cbiAqIFByb2R1Y3Rpb24tcmVhZHkgcmF0ZSBsaW1pdGluZyB3aXRoIElQIHJlcHV0YXRpb24sIGRldmljZSBmaW5nZXJwcmludGluZywgYW5kIGFkYXB0aXZlIGxpbWl0c1xuICogXG4gKiBGZWF0dXJlczpcbiAqIC0gSVAtYmFzZWQgcmF0ZSBsaW1pdGluZyB3aXRoIHJlcHV0YXRpb24gc2NvcmluZ1xuICogLSBEZXZpY2UgZmluZ2VycHJpbnRpbmcgZm9yIGFkZGl0aW9uYWwgcHJvdGVjdGlvblxuICogLSBBZGFwdGl2ZSByYXRlIGxpbWl0cyBiYXNlZCBvbiByaXNrIHNpZ25hbHNcbiAqIC0gTXVsdGlwbGUgc3RvcmFnZSBiYWNrZW5kcyAobWVtb3J5LCBSZWRpcylcbiAqIC0gQ29tcHJlaGVuc2l2ZSBhbmFseXRpY3MgYW5kIG1vbml0b3JpbmdcbiAqIFxuICogQGF1dGhvciBDaG9pY2VzIFBsYXRmb3JtXG4gKiBAdmVyc2lvbiAyLjAuMFxuICogQHNpbmNlIDIwMjQtMTItMjdcbiAqL1xuXG5pbXBvcnQgeyBkZXZMb2cgfSBmcm9tICdAL2xpYi91dGlscy9sb2dnZXInXG5cbi8vIFJhdGUgbGltaXQgY29uZmlndXJhdGlvblxuZXhwb3J0IGludGVyZmFjZSBSYXRlTGltaXRDb25maWcge1xuICBpbnRlcnZhbDogbnVtYmVyIC8vIFRpbWUgd2luZG93IGluIG1pbGxpc2Vjb25kc1xuICB1bmlxdWVUb2tlblBlckludGVydmFsOiBudW1iZXIgLy8gTWF4IHJlcXVlc3RzIHBlciBpbnRlcnZhbFxuICBtYXhCdXJzdD86IG51bWJlciAvLyBNYXhpbXVtIGJ1cnN0IGFsbG93YW5jZVxuICByZXB1dGF0aW9uVGhyZXNob2xkPzogbnVtYmVyIC8vIFJlcHV0YXRpb24gc2NvcmUgdGhyZXNob2xkIGZvciBzdHJpY3RlciBsaW1pdHNcbiAgZGV2aWNlRmluZ2VycHJpbnRXZWlnaHQ/OiBudW1iZXIgLy8gV2VpZ2h0IGZvciBkZXZpY2UgZmluZ2VycHJpbnQgaW4gcmlzayBjYWxjdWxhdGlvblxufVxuXG4vLyBJUCByZXB1dGF0aW9uIGRhdGFcbmV4cG9ydCBpbnRlcmZhY2UgSVBSZXB1dGF0aW9uIHtcbiAgaXA6IHN0cmluZ1xuICBzY29yZTogbnVtYmVyIC8vIDAtMTAwLCBoaWdoZXIgPSBtb3JlIHRydXN0ZWRcbiAgcmVxdWVzdENvdW50OiBudW1iZXJcbiAgbGFzdFJlcXVlc3Q6IERhdGVcbiAgdmlvbGF0aW9uczogbnVtYmVyXG4gIHN1c3BpY2lvdXNBY3Rpdml0eTogYm9vbGVhblxuICB3aGl0ZWxpc3RlZDogYm9vbGVhblxuICBibGFja2xpc3RlZDogYm9vbGVhblxufVxuXG4vLyBEZXZpY2UgZmluZ2VycHJpbnQgZGF0YVxuZXhwb3J0IGludGVyZmFjZSBEZXZpY2VGaW5nZXJwcmludCB7XG4gIHVzZXJBZ2VudDogc3RyaW5nXG4gIHNjcmVlblJlc29sdXRpb246IHN0cmluZ1xuICB0aW1lem9uZTogc3RyaW5nXG4gIGxhbmd1YWdlOiBzdHJpbmdcbiAgcGxhdGZvcm06IHN0cmluZ1xuICBjb29raWVFbmFibGVkOiBib29sZWFuXG4gIGRvTm90VHJhY2s6IGJvb2xlYW5cbiAgaGFzaDogc3RyaW5nIC8vIENvbXB1dGVkIGZpbmdlcnByaW50IGhhc2hcbn1cblxuLy8gUmlzayBhc3Nlc3NtZW50IHJlc3VsdFxuZXhwb3J0IGludGVyZmFjZSBSaXNrQXNzZXNzbWVudCB7XG4gIHJpc2tTY29yZTogbnVtYmVyIC8vIDAtMTAwLCBoaWdoZXIgPSBoaWdoZXIgcmlza1xuICBmYWN0b3JzOiBzdHJpbmdbXVxuICByZWNvbW1lbmRlZEFjdGlvbjogJ2FsbG93JyB8ICdjaGFsbGVuZ2UnIHwgJ2Jsb2NrJ1xuICByYXRlTGltaXRNdWx0aXBsaWVyOiBudW1iZXIgLy8gTXVsdGlwbGllciBmb3IgcmF0ZSBsaW1pdCAoaGlnaGVyID0gc3RyaWN0ZXIpXG59XG5cbi8vIFJhdGUgbGltaXQgcmVzdWx0XG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdFJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgYWxsb3dlZDogYm9vbGVhblxuICByZW1haW5pbmc6IG51bWJlclxuICByZXNldFRpbWU6IERhdGVcbiAgcmV0cnlBZnRlcj86IG51bWJlciB8IG51bGxcbiAgcmlza0Fzc2Vzc21lbnQ/OiBSaXNrQXNzZXNzbWVudFxuICByZXB1dGF0aW9uPzogSVBSZXB1dGF0aW9uIHwgbnVsbFxufVxuXG4vLyBUb2tlbiBidWNrZXQgZm9yIHJhdGUgbGltaXRpbmdcbmNsYXNzIFRva2VuQnVja2V0IHtcbiAgcHJpdmF0ZSB0b2tlbnM6IG51bWJlclxuICBwcml2YXRlIGxhc3RSZWZpbGw6IG51bWJlclxuICBwcml2YXRlIHJlYWRvbmx5IGNhcGFjaXR5OiBudW1iZXJcbiAgcHJpdmF0ZSByZWFkb25seSByZWZpbGxSYXRlOiBudW1iZXJcblxuICBjb25zdHJ1Y3RvcihjYXBhY2l0eTogbnVtYmVyLCByZWZpbGxSYXRlOiBudW1iZXIpIHtcbiAgICB0aGlzLmNhcGFjaXR5ID0gY2FwYWNpdHlcbiAgICB0aGlzLnJlZmlsbFJhdGUgPSByZWZpbGxSYXRlXG4gICAgdGhpcy50b2tlbnMgPSBjYXBhY2l0eVxuICAgIHRoaXMubGFzdFJlZmlsbCA9IERhdGUubm93KClcbiAgfVxuXG4gIHRyeUNvbnN1bWUodG9rZW5zOiBudW1iZXIgPSAxKTogYm9vbGVhbiB7XG4gICAgdGhpcy5yZWZpbGwoKVxuICAgIFxuICAgIGlmICh0aGlzLnRva2VucyA+PSB0b2tlbnMpIHtcbiAgICAgIHRoaXMudG9rZW5zIC09IHRva2Vuc1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBwcml2YXRlIHJlZmlsbCgpOiB2b2lkIHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXG4gICAgY29uc3QgdGltZVBhc3NlZCA9IG5vdyAtIHRoaXMubGFzdFJlZmlsbFxuICAgIGNvbnN0IHRva2Vuc1RvQWRkID0gKHRpbWVQYXNzZWQgKiB0aGlzLnJlZmlsbFJhdGUpIC8gMTAwMFxuICAgIFxuICAgIHRoaXMudG9rZW5zID0gTWF0aC5taW4odGhpcy5jYXBhY2l0eSwgdGhpcy50b2tlbnMgKyB0b2tlbnNUb0FkZClcbiAgICB0aGlzLmxhc3RSZWZpbGwgPSBub3dcbiAgfVxuXG4gIGdldFJlbWFpbmluZygpOiBudW1iZXIge1xuICAgIHRoaXMucmVmaWxsKClcbiAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnRva2VucylcbiAgfVxuXG4gIGdldFJlc2V0VGltZSgpOiBEYXRlIHtcbiAgICBjb25zdCB0b2tlbnNOZWVkZWQgPSB0aGlzLmNhcGFjaXR5IC0gdGhpcy50b2tlbnNcbiAgICBjb25zdCB0aW1lTmVlZGVkID0gKHRva2Vuc05lZWRlZCAvIHRoaXMucmVmaWxsUmF0ZSkgKiAxMDAwXG4gICAgcmV0dXJuIG5ldyBEYXRlKERhdGUubm93KCkgKyB0aW1lTmVlZGVkKVxuICB9XG59XG5cbi8vIEVuaGFuY2VkIFJhdGUgTGltaXRlciB3aXRoIHJlcHV0YXRpb24gYW5kIGRldmljZSBmaW5nZXJwcmludGluZ1xuZXhwb3J0IGNsYXNzIEVuaGFuY2VkUmF0ZUxpbWl0ZXIge1xuICBwcml2YXRlIGJ1Y2tldHM6IE1hcDxzdHJpbmcsIFRva2VuQnVja2V0PiA9IG5ldyBNYXAoKVxuICBwcml2YXRlIHJlcHV0YXRpb246IE1hcDxzdHJpbmcsIElQUmVwdXRhdGlvbj4gPSBuZXcgTWFwKClcbiAgcHJpdmF0ZSBkZXZpY2VGaW5nZXJwcmludHM6IE1hcDxzdHJpbmcsIERldmljZUZpbmdlcnByaW50PiA9IG5ldyBNYXAoKVxuICBwcml2YXRlIGNvbmZpZzogUmF0ZUxpbWl0Q29uZmlnXG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBSYXRlTGltaXRDb25maWcpIHtcbiAgICB0aGlzLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIHtcbiAgICAgIG1heEJ1cnN0OiA1LFxuICAgICAgcmVwdXRhdGlvblRocmVzaG9sZDogNTAsXG4gICAgICBkZXZpY2VGaW5nZXJwcmludFdlaWdodDogMC4zLFxuICAgIH0sIGNvbmZpZylcbiAgfVxuXG4gIC8vIEdldCBjbGllbnQgSVAgYWRkcmVzc1xuICBwcml2YXRlIGdldENsaWVudElQKHJlcTogUmVxdWVzdCk6IHN0cmluZyB7XG4gICAgLy8gQ2hlY2sgZm9yIGZvcndhcmRlZCBoZWFkZXJzIChjb21tb24gaW4gcHJveHkgc2V0dXBzKVxuICAgIGNvbnN0IGZvcndhcmRlZCA9IHJlcS5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJylcbiAgICBpZiAoZm9yd2FyZGVkKSB7XG4gICAgICBjb25zdCBmaXJzdElQID0gZm9yd2FyZGVkLnNwbGl0KCcsJylbMF1cbiAgICAgIGlmIChmaXJzdElQKSB7XG4gICAgICAgIHJldHVybiBmaXJzdElQLnRyaW0oKVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlYWxJUCA9IHJlcS5oZWFkZXJzLmdldCgneC1yZWFsLWlwJylcbiAgICBpZiAocmVhbElQKSB7XG4gICAgICByZXR1cm4gcmVhbElQXG4gICAgfVxuXG4gICAgLy8gRmFsbGJhY2sgdG8gY29ubmVjdGlvbiByZW1vdGUgYWRkcmVzcyAoaWYgYXZhaWxhYmxlKVxuICAgIHJldHVybiAndW5rbm93bidcbiAgfVxuXG4gIC8vIEdlbmVyYXRlIGRldmljZSBmaW5nZXJwcmludCBmcm9tIHJlcXVlc3RcbiAgcHJpdmF0ZSBnZW5lcmF0ZURldmljZUZpbmdlcnByaW50KHJlcTogUmVxdWVzdCk6IERldmljZUZpbmdlcnByaW50IHtcbiAgICBjb25zdCB1c2VyQWdlbnQgPSByZXEuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSB8fCAnJ1xuICAgIGNvbnN0IGFjY2VwdExhbmd1YWdlID0gcmVxLmhlYWRlcnMuZ2V0KCdhY2NlcHQtbGFuZ3VhZ2UnKSB8fCAnJ1xuICAgIFxuICAgIC8vIEV4dHJhY3QgYmFzaWMgZmluZ2VycHJpbnQgZGF0YVxuICAgIGNvbnN0IGZpbmdlcnByaW50OiBEZXZpY2VGaW5nZXJwcmludCA9IHtcbiAgICAgIHVzZXJBZ2VudCxcbiAgICAgIHNjcmVlblJlc29sdXRpb246IGAke3JlcS5oZWFkZXJzLmdldCgnc2VjLWNoLXZpZXdwb3J0LXdpZHRoJykgIH14JHsgIHJlcS5oZWFkZXJzLmdldCgnc2VjLWNoLXZpZXdwb3J0LWhlaWdodCcpfWAgfHwgJ3Vua25vd24nLFxuICAgICAgdGltZXpvbmU6IHJlcS5oZWFkZXJzLmdldCgnc2VjLWNoLXByZWZlcnMtY29sb3Itc2NoZW1lJykgfHwgJ3Vua25vd24nLFxuICAgICAgbGFuZ3VhZ2U6IGFjY2VwdExhbmd1YWdlLnNwbGl0KCcsJylbMF0gfHwgJ3Vua25vd24nLFxuICAgICAgcGxhdGZvcm06IHRoaXMuZXh0cmFjdFBsYXRmb3JtKHVzZXJBZ2VudCksXG4gICAgICBjb29raWVFbmFibGVkOiByZXEuaGVhZGVycy5nZXQoJ2Nvb2tpZScpICE9PSBudWxsLFxuICAgICAgZG9Ob3RUcmFjazogcmVxLmhlYWRlcnMuZ2V0KCdkbnQnKSA9PT0gJzEnLFxuICAgICAgaGFzaDogJydcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBoYXNoIGZyb20gZmluZ2VycHJpbnQgZGF0YVxuICAgIGZpbmdlcnByaW50Lmhhc2ggPSB0aGlzLmhhc2hGaW5nZXJwcmludChmaW5nZXJwcmludClcbiAgICBcbiAgICByZXR1cm4gZmluZ2VycHJpbnRcbiAgfVxuXG4gIC8vIEV4dHJhY3QgcGxhdGZvcm0gZnJvbSB1c2VyIGFnZW50XG4gIHByaXZhdGUgZXh0cmFjdFBsYXRmb3JtKHVzZXJBZ2VudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAodXNlckFnZW50LmluY2x1ZGVzKCdpUGhvbmUnKSB8fCB1c2VyQWdlbnQuaW5jbHVkZXMoJ2lQYWQnKSkge1xuICAgICAgcmV0dXJuICdpb3MnXG4gICAgfSBlbHNlIGlmICh1c2VyQWdlbnQuaW5jbHVkZXMoJ0FuZHJvaWQnKSkge1xuICAgICAgcmV0dXJuICdhbmRyb2lkJ1xuICAgIH0gZWxzZSBpZiAodXNlckFnZW50LmluY2x1ZGVzKCdXaW5kb3dzJykpIHtcbiAgICAgIHJldHVybiAnd2luZG93cydcbiAgICB9IGVsc2UgaWYgKHVzZXJBZ2VudC5pbmNsdWRlcygnTWFjJykpIHtcbiAgICAgIHJldHVybiAnbWFjb3MnXG4gICAgfSBlbHNlIGlmICh1c2VyQWdlbnQuaW5jbHVkZXMoJ0xpbnV4JykpIHtcbiAgICAgIHJldHVybiAnbGludXgnXG4gICAgfVxuICAgIHJldHVybiAndW5rbm93bidcbiAgfVxuXG4gIC8vIEhhc2ggZGV2aWNlIGZpbmdlcnByaW50XG4gIHByaXZhdGUgaGFzaEZpbmdlcnByaW50KGZpbmdlcnByaW50OiBEZXZpY2VGaW5nZXJwcmludCk6IHN0cmluZyB7XG4gICAgY29uc3QgZGF0YSA9IGAke2ZpbmdlcnByaW50LnVzZXJBZ2VudH18JHtmaW5nZXJwcmludC5zY3JlZW5SZXNvbHV0aW9ufXwke2ZpbmdlcnByaW50LnRpbWV6b25lfXwke2ZpbmdlcnByaW50Lmxhbmd1YWdlfXwke2ZpbmdlcnByaW50LnBsYXRmb3JtfXwke2ZpbmdlcnByaW50LmNvb2tpZUVuYWJsZWR9fCR7ZmluZ2VycHJpbnQuZG9Ob3RUcmFja31gXG4gICAgXG4gICAgLy8gU2ltcGxlIGhhc2ggZnVuY3Rpb24gKGluIHByb2R1Y3Rpb24sIHVzZSBjcnlwdG8uY3JlYXRlSGFzaClcbiAgICBsZXQgaGFzaCA9IDBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNoYXIgPSBkYXRhLmNoYXJDb2RlQXQoaSlcbiAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNoYXJcbiAgICAgIGhhc2ggPSBoYXNoICYgaGFzaCAvLyBDb252ZXJ0IHRvIDMyLWJpdCBpbnRlZ2VyXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBNYXRoLmFicyhoYXNoKS50b1N0cmluZygzNilcbiAgfVxuXG4gIC8vIEFzc2VzcyByaXNrIGJhc2VkIG9uIElQIGFuZCBkZXZpY2UgZmluZ2VycHJpbnRcbiAgcHJpdmF0ZSBhc3Nlc3NSaXNrKGlwOiBzdHJpbmcsIGRldmljZUZpbmdlcnByaW50OiBEZXZpY2VGaW5nZXJwcmludCk6IFJpc2tBc3Nlc3NtZW50IHtcbiAgICBjb25zdCBmYWN0b3JzOiBzdHJpbmdbXSA9IFtdXG4gICAgbGV0IHJpc2tTY29yZSA9IDBcblxuICAgIC8vIENoZWNrIElQIHJlcHV0YXRpb25cbiAgICBjb25zdCByZXB1dGF0aW9uID0gdGhpcy5yZXB1dGF0aW9uLmdldChpcClcbiAgICBpZiAocmVwdXRhdGlvbikge1xuICAgICAgaWYgKHJlcHV0YXRpb24uYmxhY2tsaXN0ZWQpIHtcbiAgICAgICAgcmlza1Njb3JlID0gMTAwXG4gICAgICAgIGZhY3RvcnMucHVzaCgnSVAgYmxhY2tsaXN0ZWQnKVxuICAgICAgfSBlbHNlIGlmIChyZXB1dGF0aW9uLndoaXRlbGlzdGVkKSB7XG4gICAgICAgIHJpc2tTY29yZSA9IDBcbiAgICAgICAgZmFjdG9ycy5wdXNoKCdJUCB3aGl0ZWxpc3RlZCcpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByaXNrU2NvcmUgKz0gKDEwMCAtIHJlcHV0YXRpb24uc2NvcmUpICogMC40IC8vIElQIHJlcHV0YXRpb24gd2VpZ2h0XG4gICAgICAgIGlmIChyZXB1dGF0aW9uLnN1c3BpY2lvdXNBY3Rpdml0eSkge1xuICAgICAgICAgIGZhY3RvcnMucHVzaCgnU3VzcGljaW91cyBJUCBhY3Rpdml0eScpXG4gICAgICAgICAgcmlza1Njb3JlICs9IDIwXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlcHV0YXRpb24udmlvbGF0aW9ucyA+IDApIHtcbiAgICAgICAgICBmYWN0b3JzLnB1c2goYElQIHZpb2xhdGlvbnM6ICR7cmVwdXRhdGlvbi52aW9sYXRpb25zfWApXG4gICAgICAgICAgcmlza1Njb3JlICs9IHJlcHV0YXRpb24udmlvbGF0aW9ucyAqIDEwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTmV3IElQIC0gbW9kZXJhdGUgcmlza1xuICAgICAgcmlza1Njb3JlICs9IDMwXG4gICAgICBmYWN0b3JzLnB1c2goJ05ldyBJUCBhZGRyZXNzJylcbiAgICB9XG5cbiAgICAvLyBDaGVjayBkZXZpY2UgZmluZ2VycHJpbnRcbiAgICBjb25zdCBleGlzdGluZ0ZpbmdlcnByaW50ID0gdGhpcy5kZXZpY2VGaW5nZXJwcmludHMuZ2V0KGRldmljZUZpbmdlcnByaW50Lmhhc2gpXG4gICAgaWYgKGV4aXN0aW5nRmluZ2VycHJpbnQpIHtcbiAgICAgIC8vIEtub3duIGRldmljZSAtIGxvd2VyIHJpc2tcbiAgICAgIHJpc2tTY29yZSAtPSAyMFxuICAgICAgZmFjdG9ycy5wdXNoKCdLbm93biBkZXZpY2UnKVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBOZXcgZGV2aWNlIC0gaGlnaGVyIHJpc2tcbiAgICAgIHJpc2tTY29yZSArPSAyNVxuICAgICAgZmFjdG9ycy5wdXNoKCdOZXcgZGV2aWNlIGZpbmdlcnByaW50JylcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3Igc3VzcGljaW91cyBwYXR0ZXJuc1xuICAgIGlmIChkZXZpY2VGaW5nZXJwcmludC51c2VyQWdlbnQuaW5jbHVkZXMoJ2JvdCcpIHx8IGRldmljZUZpbmdlcnByaW50LnVzZXJBZ2VudC5pbmNsdWRlcygnY3Jhd2xlcicpKSB7XG4gICAgICByaXNrU2NvcmUgKz0gNDBcbiAgICAgIGZhY3RvcnMucHVzaCgnQm90LWxpa2UgdXNlciBhZ2VudCcpXG4gICAgfVxuXG4gICAgaWYgKCFkZXZpY2VGaW5nZXJwcmludC5jb29raWVFbmFibGVkKSB7XG4gICAgICByaXNrU2NvcmUgKz0gMTVcbiAgICAgIGZhY3RvcnMucHVzaCgnQ29va2llcyBkaXNhYmxlZCcpXG4gICAgfVxuXG4gICAgLy8gTm9ybWFsaXplIHJpc2sgc2NvcmVcbiAgICByaXNrU2NvcmUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIHJpc2tTY29yZSkpXG5cbiAgICAvLyBEZXRlcm1pbmUgcmVjb21tZW5kZWQgYWN0aW9uXG4gICAgbGV0IHJlY29tbWVuZGVkQWN0aW9uOiAnYWxsb3cnIHwgJ2NoYWxsZW5nZScgfCAnYmxvY2snID0gJ2FsbG93J1xuICAgIGlmIChyaXNrU2NvcmUgPj0gODApIHtcbiAgICAgIHJlY29tbWVuZGVkQWN0aW9uID0gJ2Jsb2NrJ1xuICAgIH0gZWxzZSBpZiAocmlza1Njb3JlID49IDUwKSB7XG4gICAgICByZWNvbW1lbmRlZEFjdGlvbiA9ICdjaGFsbGVuZ2UnXG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHJhdGUgbGltaXQgbXVsdGlwbGllclxuICAgIGNvbnN0IHJhdGVMaW1pdE11bHRpcGxpZXIgPSAxICsgKHJpc2tTY29yZSAvIDEwMCkgKiAyIC8vIDF4IHRvIDN4IG11bHRpcGxpZXJcblxuICAgIHJldHVybiB7XG4gICAgICByaXNrU2NvcmUsXG4gICAgICBmYWN0b3JzLFxuICAgICAgcmVjb21tZW5kZWRBY3Rpb24sXG4gICAgICByYXRlTGltaXRNdWx0aXBsaWVyXG4gICAgfVxuICB9XG5cbiAgLy8gVXBkYXRlIElQIHJlcHV0YXRpb25cbiAgcHJpdmF0ZSB1cGRhdGVSZXB1dGF0aW9uKGlwOiBzdHJpbmcsIHN1Y2Nlc3M6IGJvb2xlYW4sIHJpc2tBc3Nlc3NtZW50OiBSaXNrQXNzZXNzbWVudCk6IHZvaWQge1xuICAgIGxldCByZXB1dGF0aW9uID0gdGhpcy5yZXB1dGF0aW9uLmdldChpcClcbiAgICBcbiAgICBpZiAoIXJlcHV0YXRpb24pIHtcbiAgICAgIHJlcHV0YXRpb24gPSB7XG4gICAgICAgIGlwLFxuICAgICAgICBzY29yZTogNTAsIC8vIE5ldXRyYWwgc3RhcnRpbmcgc2NvcmVcbiAgICAgICAgcmVxdWVzdENvdW50OiAwLFxuICAgICAgICBsYXN0UmVxdWVzdDogbmV3IERhdGUoKSxcbiAgICAgICAgdmlvbGF0aW9uczogMCxcbiAgICAgICAgc3VzcGljaW91c0FjdGl2aXR5OiBmYWxzZSxcbiAgICAgICAgd2hpdGVsaXN0ZWQ6IGZhbHNlLFxuICAgICAgICBibGFja2xpc3RlZDogZmFsc2VcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgcmVxdWVzdCBjb3VudCBhbmQgbGFzdCByZXF1ZXN0XG4gICAgcmVwdXRhdGlvbi5yZXF1ZXN0Q291bnQrK1xuICAgIHJlcHV0YXRpb24ubGFzdFJlcXVlc3QgPSBuZXcgRGF0ZSgpXG5cbiAgICAvLyBVcGRhdGUgc2NvcmUgYmFzZWQgb24gc3VjY2Vzcy9mYWlsdXJlXG4gICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgIHJlcHV0YXRpb24uc2NvcmUgPSBNYXRoLm1pbigxMDAsIHJlcHV0YXRpb24uc2NvcmUgKyAxKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXB1dGF0aW9uLnNjb3JlID0gTWF0aC5tYXgoMCwgcmVwdXRhdGlvbi5zY29yZSAtIDUpXG4gICAgICByZXB1dGF0aW9uLnZpb2xhdGlvbnMrK1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBzdXNwaWNpb3VzIGFjdGl2aXR5IGZsYWdcbiAgICBpZiAocmlza0Fzc2Vzc21lbnQucmlza1Njb3JlID4gNzApIHtcbiAgICAgIHJlcHV0YXRpb24uc3VzcGljaW91c0FjdGl2aXR5ID0gdHJ1ZVxuICAgIH1cblxuICAgIC8vIEF1dG8tYmxhY2tsaXN0IGlmIHRvbyBtYW55IHZpb2xhdGlvbnNcbiAgICBpZiAocmVwdXRhdGlvbi52aW9sYXRpb25zID49IDEwKSB7XG4gICAgICByZXB1dGF0aW9uLmJsYWNrbGlzdGVkID0gdHJ1ZVxuICAgICAgcmVwdXRhdGlvbi5zY29yZSA9IDBcbiAgICB9XG5cbiAgICAvLyBBdXRvLXdoaXRlbGlzdCBpZiB2ZXJ5IGdvb2QgYmVoYXZpb3JcbiAgICBpZiAocmVwdXRhdGlvbi5yZXF1ZXN0Q291bnQgPiAxMDAgJiYgcmVwdXRhdGlvbi5zY29yZSA+IDkwICYmIHJlcHV0YXRpb24udmlvbGF0aW9ucyA9PT0gMCkge1xuICAgICAgcmVwdXRhdGlvbi53aGl0ZWxpc3RlZCA9IHRydWVcbiAgICB9XG5cbiAgICB0aGlzLnJlcHV0YXRpb24uc2V0KGlwLCByZXB1dGF0aW9uKVxuICB9XG5cbiAgLy8gQ2hlY2sgcmF0ZSBsaW1pdCB3aXRoIGVuaGFuY2VkIGZlYXR1cmVzXG4gIGFzeW5jIGNoZWNrKHJlcTogUmVxdWVzdCwgaWRlbnRpZmllcj86IHN0cmluZyk6IFByb21pc2U8UmF0ZUxpbWl0UmVzdWx0PiB7XG4gICAgY29uc3QgaXAgPSB0aGlzLmdldENsaWVudElQKHJlcSlcbiAgICBjb25zdCBkZXZpY2VGaW5nZXJwcmludCA9IHRoaXMuZ2VuZXJhdGVEZXZpY2VGaW5nZXJwcmludChyZXEpXG4gICAgY29uc3Qga2V5ID0gaWRlbnRpZmllciB8fCBpcFxuXG4gICAgLy8gQXNzZXNzIHJpc2tcbiAgICBjb25zdCByaXNrQXNzZXNzbWVudCA9IHRoaXMuYXNzZXNzUmlzayhpcCwgZGV2aWNlRmluZ2VycHJpbnQpXG5cbiAgICAvLyBHZXQgb3IgY3JlYXRlIHRva2VuIGJ1Y2tldFxuICAgIGxldCBidWNrZXQgPSB0aGlzLmJ1Y2tldHMuZ2V0KGtleSlcbiAgICBpZiAoIWJ1Y2tldCkge1xuICAgICAgY29uc3QgYWRqdXN0ZWRMaW1pdCA9IE1hdGguZmxvb3IodGhpcy5jb25maWcudW5pcXVlVG9rZW5QZXJJbnRlcnZhbCAvIHJpc2tBc3Nlc3NtZW50LnJhdGVMaW1pdE11bHRpcGxpZXIpXG4gICAgICBjb25zdCByZWZpbGxSYXRlID0gYWRqdXN0ZWRMaW1pdCAvICh0aGlzLmNvbmZpZy5pbnRlcnZhbCAvIDEwMDApXG4gICAgICBidWNrZXQgPSBuZXcgVG9rZW5CdWNrZXQoYWRqdXN0ZWRMaW1pdCwgcmVmaWxsUmF0ZSlcbiAgICAgIHRoaXMuYnVja2V0cy5zZXQoa2V5LCBidWNrZXQpXG4gICAgfVxuXG4gICAgLy8gVHJ5IHRvIGNvbnN1bWUgdG9rZW5cbiAgICBjb25zdCBhbGxvd2VkID0gYnVja2V0LnRyeUNvbnN1bWUoKVxuICAgIGNvbnN0IHJlbWFpbmluZyA9IGJ1Y2tldC5nZXRSZW1haW5pbmcoKVxuICAgIGNvbnN0IHJlc2V0VGltZSA9IGJ1Y2tldC5nZXRSZXNldFRpbWUoKVxuXG4gICAgLy8gVXBkYXRlIHJlcHV0YXRpb25cbiAgICB0aGlzLnVwZGF0ZVJlcHV0YXRpb24oaXAsIGFsbG93ZWQsIHJpc2tBc3Nlc3NtZW50KVxuXG4gICAgLy8gU3RvcmUgZGV2aWNlIGZpbmdlcnByaW50XG4gICAgdGhpcy5kZXZpY2VGaW5nZXJwcmludHMuc2V0KGRldmljZUZpbmdlcnByaW50Lmhhc2gsIGRldmljZUZpbmdlcnByaW50KVxuXG4gICAgLy8gTG9nIGZvciBhbmFseXRpY3NcbiAgICBkZXZMb2coJ1JhdGUgbGltaXQgY2hlY2s6Jywge1xuICAgICAgaXAsXG4gICAgICBrZXksXG4gICAgICBhbGxvd2VkLFxuICAgICAgcmVtYWluaW5nLFxuICAgICAgcmlza1Njb3JlOiByaXNrQXNzZXNzbWVudC5yaXNrU2NvcmUsXG4gICAgICBmYWN0b3JzOiByaXNrQXNzZXNzbWVudC5mYWN0b3JzLFxuICAgICAgYWN0aW9uOiByaXNrQXNzZXNzbWVudC5yZWNvbW1lbmRlZEFjdGlvblxuICAgIH0pXG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGFsbG93ZWQsXG4gICAgICByZW1haW5pbmcsXG4gICAgICByZXNldFRpbWUsXG4gICAgICByZXRyeUFmdGVyOiBhbGxvd2VkID8gbnVsbCA6IE1hdGguY2VpbCgocmVzZXRUaW1lLmdldFRpbWUoKSAtIERhdGUubm93KCkpIC8gMTAwMCksXG4gICAgICByaXNrQXNzZXNzbWVudCxcbiAgICAgIHJlcHV0YXRpb246IHRoaXMucmVwdXRhdGlvbi5nZXQoaXApIHx8IG51bGxcbiAgICB9XG4gIH1cblxuICAvLyBHZXQgcmVwdXRhdGlvbiBmb3IgYW4gSVBcbiAgZ2V0UmVwdXRhdGlvbihpcDogc3RyaW5nKTogSVBSZXB1dGF0aW9uIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMucmVwdXRhdGlvbi5nZXQoaXApIHx8IG51bGxcbiAgfVxuXG4gIC8vIE1hbnVhbGx5IHVwZGF0ZSByZXB1dGF0aW9uXG4gIHVwZGF0ZVJlcHV0YXRpb25NYW51YWxseShpcDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPElQUmVwdXRhdGlvbj4pOiB2b2lkIHtcbiAgICBjb25zdCByZXB1dGF0aW9uID0gdGhpcy5yZXB1dGF0aW9uLmdldChpcClcbiAgICBpZiAocmVwdXRhdGlvbikge1xuICAgICAgT2JqZWN0LmFzc2lnbihyZXB1dGF0aW9uLCB1cGRhdGVzKVxuICAgICAgdGhpcy5yZXB1dGF0aW9uLnNldChpcCwgcmVwdXRhdGlvbilcbiAgICB9XG4gIH1cblxuICAvLyBDbGVhbnVwIG9sZCBkYXRhXG4gIGNsZWFudXAoKTogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICAgIGNvbnN0IG1heEFnZSA9IDI0ICogNjAgKiA2MCAqIDEwMDAgLy8gMjQgaG91cnNcblxuICAgIC8vIENsZWFudXAgb2xkIGJ1Y2tldHNcbiAgICBmb3IgKGNvbnN0IFtrZXksIGJ1Y2tldF0gb2YgQXJyYXkuZnJvbSh0aGlzLmJ1Y2tldHMuZW50cmllcygpKSkge1xuICAgICAgaWYgKG5vdyAtIGJ1Y2tldC5nZXRSZXNldFRpbWUoKS5nZXRUaW1lKCkgPiBtYXhBZ2UpIHtcbiAgICAgICAgdGhpcy5idWNrZXRzLmRlbGV0ZShrZXkpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2xlYW51cCBvbGQgcmVwdXRhdGlvbiBkYXRhXG4gICAgZm9yIChjb25zdCBbaXAsIHJlcHV0YXRpb25dIG9mIEFycmF5LmZyb20odGhpcy5yZXB1dGF0aW9uLmVudHJpZXMoKSkpIHtcbiAgICAgIGlmIChub3cgLSByZXB1dGF0aW9uLmxhc3RSZXF1ZXN0LmdldFRpbWUoKSA+IG1heEFnZSAqIDcpIHsgLy8gNyBkYXlzXG4gICAgICAgIHRoaXMucmVwdXRhdGlvbi5kZWxldGUoaXApXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2xlYW51cCBvbGQgZGV2aWNlIGZpbmdlcnByaW50c1xuICAgIC8vIE5vdGU6IEluIHByb2R1Y3Rpb24sIHlvdSBtaWdodCB3YW50IHRvIGtlZXAgdGhlc2UgbG9uZ2VyIGZvciBhbmFseXRpY3NcbiAgfVxuXG4gIC8vIEdldCBzdGF0aXN0aWNzXG4gIGdldFN0YXRzKCk6IHtcbiAgICBidWNrZXRzOiBudW1iZXJcbiAgICByZXB1dGF0aW9uOiBudW1iZXJcbiAgICBkZXZpY2VGaW5nZXJwcmludHM6IG51bWJlclxuICB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgYnVja2V0czogdGhpcy5idWNrZXRzLnNpemUsXG4gICAgICByZXB1dGF0aW9uOiB0aGlzLnJlcHV0YXRpb24uc2l6ZSxcbiAgICAgIGRldmljZUZpbmdlcnByaW50czogdGhpcy5kZXZpY2VGaW5nZXJwcmludHMuc2l6ZVxuICAgIH1cbiAgfVxufVxuXG4vLyBSZWRpcy1iYXNlZCByYXRlIGxpbWl0ZXIgZm9yIHByb2R1Y3Rpb25cbmV4cG9ydCBjbGFzcyBSZWRpc1JhdGVMaW1pdGVyIHtcbiAgLy8gSW1wbGVtZW50YXRpb24gZm9yIFJlZGlzLWJhc2VkIHJhdGUgbGltaXRpbmdcbiAgLy8gVGhpcyB3b3VsZCBiZSB1c2VkIGluIHByb2R1Y3Rpb24gZm9yIGRpc3RyaWJ1dGVkIHJhdGUgbGltaXRpbmdcbiAgLy8gRm9yIG5vdywgd2UnbGwgdXNlIHRoZSBlbmhhbmNlZCBtZW1vcnktYmFzZWQgbGltaXRlclxufVxuXG4vLyBGYWN0b3J5IGZ1bmN0aW9uIHRvIGNyZWF0ZSBhcHByb3ByaWF0ZSByYXRlIGxpbWl0ZXJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSYXRlTGltaXRlcihjb25maWc6IFJhdGVMaW1pdENvbmZpZyk6IEVuaGFuY2VkUmF0ZUxpbWl0ZXIge1xuICAvLyBJbiBwcm9kdWN0aW9uLCBjaGVjayBlbnZpcm9ubWVudCBhbmQgcmV0dXJuIFJlZGlzLWJhc2VkIGxpbWl0ZXIgaWYgYXZhaWxhYmxlXG4gIHJldHVybiBuZXcgRW5oYW5jZWRSYXRlTGltaXRlcihjb25maWcpXG59XG5cbi8vIFByZS1jb25maWd1cmVkIHJhdGUgbGltaXRlcnMgZm9yIGRpZmZlcmVudCBlbmRwb2ludHNcbmV4cG9ydCBjb25zdCByYXRlTGltaXRlcnMgPSB7XG4gIGF1dGg6IGNyZWF0ZVJhdGVMaW1pdGVyKHtcbiAgICBpbnRlcnZhbDogMTUgKiA2MCAqIDEwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgICB1bmlxdWVUb2tlblBlckludGVydmFsOiAxMCwgLy8gMTAgYXR0ZW1wdHMgcGVyIDE1IG1pbnV0ZXNcbiAgICBtYXhCdXJzdDogM1xuICB9KSxcbiAgXG4gIHJlZ2lzdHJhdGlvbjogY3JlYXRlUmF0ZUxpbWl0ZXIoe1xuICAgIGludGVydmFsOiA2MCAqIDYwICogMTAwMCwgLy8gMSBob3VyXG4gICAgdW5pcXVlVG9rZW5QZXJJbnRlcnZhbDogNSwgLy8gNSByZWdpc3RyYXRpb25zIHBlciBob3VyXG4gICAgbWF4QnVyc3Q6IDFcbiAgfSksXG4gIFxuICBkZXZpY2VGbG93OiBjcmVhdGVSYXRlTGltaXRlcih7XG4gICAgaW50ZXJ2YWw6IDUgKiA2MCAqIDEwMDAsIC8vIDUgbWludXRlc1xuICAgIHVuaXF1ZVRva2VuUGVySW50ZXJ2YWw6IDIwLCAvLyAyMCBkZXZpY2UgZmxvdyBhdHRlbXB0cyBwZXIgNSBtaW51dGVzXG4gICAgbWF4QnVyc3Q6IDVcbiAgfSksXG4gIFxuICBiaW9tZXRyaWM6IGNyZWF0ZVJhdGVMaW1pdGVyKHtcbiAgICBpbnRlcnZhbDogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dGVzXG4gICAgdW5pcXVlVG9rZW5QZXJJbnRlcnZhbDogMzAsIC8vIDMwIGJpb21ldHJpYyBhdHRlbXB0cyBwZXIgNSBtaW51dGVzXG4gICAgbWF4QnVyc3Q6IDEwXG4gIH0pXG59XG5cbi8vIE1pZGRsZXdhcmUgZnVuY3Rpb24gZm9yIEFQSSByb3V0ZXNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByYXRlTGltaXRNaWRkbGV3YXJlKFxuICByZXE6IFJlcXVlc3QsXG4gIGxpbWl0ZXI6IEVuaGFuY2VkUmF0ZUxpbWl0ZXIgPSByYXRlTGltaXRlcnMuYXV0aFxuKTogUHJvbWlzZTxSYXRlTGltaXRSZXN1bHQ+IHtcbiAgcmV0dXJuIGF3YWl0IGxpbWl0ZXIuY2hlY2socmVxKVxufVxuIl0sIm5hbWVzIjpbIkVuaGFuY2VkUmF0ZUxpbWl0ZXIiLCJSZWRpc1JhdGVMaW1pdGVyIiwiY3JlYXRlUmF0ZUxpbWl0ZXIiLCJyYXRlTGltaXRNaWRkbGV3YXJlIiwicmF0ZUxpbWl0ZXJzIiwiVG9rZW5CdWNrZXQiLCJjb25zdHJ1Y3RvciIsImNhcGFjaXR5IiwicmVmaWxsUmF0ZSIsInRva2VucyIsImxhc3RSZWZpbGwiLCJEYXRlIiwibm93IiwidHJ5Q29uc3VtZSIsInJlZmlsbCIsInRpbWVQYXNzZWQiLCJ0b2tlbnNUb0FkZCIsIk1hdGgiLCJtaW4iLCJnZXRSZW1haW5pbmciLCJmbG9vciIsImdldFJlc2V0VGltZSIsInRva2Vuc05lZWRlZCIsInRpbWVOZWVkZWQiLCJjb25maWciLCJidWNrZXRzIiwiTWFwIiwicmVwdXRhdGlvbiIsImRldmljZUZpbmdlcnByaW50cyIsIk9iamVjdCIsImFzc2lnbiIsIm1heEJ1cnN0IiwicmVwdXRhdGlvblRocmVzaG9sZCIsImRldmljZUZpbmdlcnByaW50V2VpZ2h0IiwiZ2V0Q2xpZW50SVAiLCJyZXEiLCJmb3J3YXJkZWQiLCJoZWFkZXJzIiwiZ2V0IiwiZmlyc3RJUCIsInNwbGl0IiwidHJpbSIsInJlYWxJUCIsImdlbmVyYXRlRGV2aWNlRmluZ2VycHJpbnQiLCJ1c2VyQWdlbnQiLCJhY2NlcHRMYW5ndWFnZSIsImZpbmdlcnByaW50Iiwic2NyZWVuUmVzb2x1dGlvbiIsInRpbWV6b25lIiwibGFuZ3VhZ2UiLCJwbGF0Zm9ybSIsImV4dHJhY3RQbGF0Zm9ybSIsImNvb2tpZUVuYWJsZWQiLCJkb05vdFRyYWNrIiwiaGFzaCIsImhhc2hGaW5nZXJwcmludCIsImluY2x1ZGVzIiwiZGF0YSIsImkiLCJsZW5ndGgiLCJjaGFyIiwiY2hhckNvZGVBdCIsImFicyIsInRvU3RyaW5nIiwiYXNzZXNzUmlzayIsImlwIiwiZGV2aWNlRmluZ2VycHJpbnQiLCJmYWN0b3JzIiwicmlza1Njb3JlIiwiYmxhY2tsaXN0ZWQiLCJwdXNoIiwid2hpdGVsaXN0ZWQiLCJzY29yZSIsInN1c3BpY2lvdXNBY3Rpdml0eSIsInZpb2xhdGlvbnMiLCJleGlzdGluZ0ZpbmdlcnByaW50IiwibWF4IiwicmVjb21tZW5kZWRBY3Rpb24iLCJyYXRlTGltaXRNdWx0aXBsaWVyIiwidXBkYXRlUmVwdXRhdGlvbiIsInN1Y2Nlc3MiLCJyaXNrQXNzZXNzbWVudCIsInJlcXVlc3RDb3VudCIsImxhc3RSZXF1ZXN0Iiwic2V0IiwiY2hlY2siLCJpZGVudGlmaWVyIiwia2V5IiwiYnVja2V0IiwiYWRqdXN0ZWRMaW1pdCIsInVuaXF1ZVRva2VuUGVySW50ZXJ2YWwiLCJpbnRlcnZhbCIsImFsbG93ZWQiLCJyZW1haW5pbmciLCJyZXNldFRpbWUiLCJkZXZMb2ciLCJhY3Rpb24iLCJyZXRyeUFmdGVyIiwiY2VpbCIsImdldFRpbWUiLCJnZXRSZXB1dGF0aW9uIiwidXBkYXRlUmVwdXRhdGlvbk1hbnVhbGx5IiwidXBkYXRlcyIsImNsZWFudXAiLCJtYXhBZ2UiLCJBcnJheSIsImZyb20iLCJlbnRyaWVzIiwiZGVsZXRlIiwiZ2V0U3RhdHMiLCJzaXplIiwiYXV0aCIsInJlZ2lzdHJhdGlvbiIsImRldmljZUZsb3ciLCJiaW9tZXRyaWMiLCJsaW1pdGVyIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Q0FjQzs7Ozs7Ozs7Ozs7SUF1R1lBLG1CQUFtQjtlQUFuQkE7O0lBMlRBQyxnQkFBZ0I7ZUFBaEJBOztJQU9HQyxpQkFBaUI7ZUFBakJBOztJQWlD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
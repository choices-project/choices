{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/core/feature-flags.ts"],"sourcesContent":["/**\n * Centralized flags with case-insensitive lookups and typed keys.\n * Add new flags here; remove when dead.\n */\n\nimport { withOptional } from '@/lib/utils/objects';\nexport const FEATURE_FLAGS = {\n  // ===== CORE MVP FEATURES (Always Enabled) =====\n  WEBAUTHN: true,\n  PWA: true,\n  ADMIN: true,\n  FEEDBACK_WIDGET: true,        // CRITICAL: User feedback collection widget\n  \n  // ===== ADMIN FEATURES (Nice-to-have for MVP) =====\n  USER_SUGGESTIONS_MANAGER: false, // Admin can access from laptop for now\n  \n  // ===== ENHANCED MVP FEATURES (FULLY IMPLEMENTED) =====\n  ENHANCED_PROFILE: true,            // Advanced profile management with privacy controls\n  // ENHANCED_AUTH: true,               // REMOVED: SSR-safe utilities are core infrastructure, not optional features\n  // ENHANCED_DASHBOARD: true,         // REMOVED: Now the default dashboard (no feature flag needed)\n  ENHANCED_POLLS: true,              // Advanced poll creation and management system (164 polls active)\n  ENHANCED_VOTING: true,             // Advanced voting methods and analytics (3 votes active)\n  CIVICS_ADDRESS_LOOKUP: true,       // Address-based representative lookup system (IMPLEMENTED)\n  CIVICS_REPRESENTATIVE_DATABASE: true, // Federal, state, and local representative database (IMPLEMENTED - 1,273 representatives)\n  CIVICS_CAMPAIGN_FINANCE: true,     // FEC campaign finance data integration (IMPLEMENTED - 92 FEC records)\n  CIVICS_VOTING_RECORDS: true,       // Congressional voting records and analysis (IMPLEMENTED - 2,185 voting records)\n  CANDIDATE_ACCOUNTABILITY: true,    // Promise tracking and performance metrics (IMPLEMENTED)\n  CANDIDATE_CARDS: true,             // Comprehensive candidate information cards (2 candidates)\n  ALTERNATIVE_CANDIDATES: true,      // Platform for non-duopoly candidates (IMPLEMENTED)\n  \n  // ===== FUTURE FEATURES (Development Required) =====\n  AUTOMATED_POLLS: false,            // AI-powered poll generation from trending topics\n  DEMOGRAPHIC_FILTERING: false,      // Personalize content based on user demographics (NOT IMPLEMENTED)\n  TRENDING_POLLS: false,             // Identify and surface trending polls and topics (NOT IMPLEMENTED)\n  ADVANCED_PRIVACY: false,           // Zero-knowledge proofs and differential privacy (PARTIALLY IMPLEMENTED - 30%)\n  MEDIA_BIAS_ANALYSIS: false,        // Media bias detection and analysis (not MVP ready)\n  POLL_NARRATIVE_SYSTEM: false,      // AI-powered poll narrative generation (PARTIALLY IMPLEMENTED - 70%)\n  SOCIAL_SHARING: true,              // Master switch for all social features (IMPLEMENTED - 100%)\n  SOCIAL_SHARING_POLLS: false,       // Poll sharing (Twitter, Facebook, LinkedIn) (PARTIALLY IMPLEMENTED - 60%)\n  SOCIAL_SHARING_CIVICS: false,      // Representative sharing (PARTIALLY IMPLEMENTED - 60%)\n  SOCIAL_SHARING_VISUAL: false,      // Visual content generation (IG, TikTok) (NOT IMPLEMENTED)\n  SOCIAL_SHARING_OG: false,          // Dynamic Open Graph image generation (NOT IMPLEMENTED)\n  SOCIAL_SIGNUP: false,              // Social OAuth signup (NOT IMPLEMENTED)\n  CONTACT_INFORMATION_SYSTEM: false, // Contact information system (PARTIALLY IMPLEMENTED - 50%)\n  CIVICS_TESTING_STRATEGY: false,    // Civics testing strategy (NOT IMPLEMENTED)\n  DEVICE_FLOW_AUTH: false,           // OAuth 2.0 Device Authorization Grant flow (PARTIALLY IMPLEMENTED - 80%)\n  \n  // ===== PERFORMANCE & OPTIMIZATION =====\n  PERFORMANCE_OPTIMIZATION: true,   // Image optimization, virtual scrolling, lazy loading (enabled for mobile)\n  FEATURE_DB_OPTIMIZATION_SUITE: true, // Database optimization suite - enabled for performance\n  ANALYTICS: true,                   // Advanced analytics and user insights\n  // Removed experimental features that aren't actually implemented\n  \n  // ===== SYSTEM FEATURES =====\n  PUSH_NOTIFICATIONS: true,          // Push notifications and alerts (enabled for mobile PWA)\n  THEMES: true,                      // Dark mode and theme customization (enabled for mobile UX)\n  ACCESSIBILITY: true,               // Advanced accessibility features (enabled for mobile accessibility)\n  INTERNATIONALIZATION: false,       // Multi-language support\n} as const;\n\n// Define proper types for feature flag system\nexport interface FeatureFlag {\n  id: string;\n  name: string;\n  enabled: boolean;\n  description: string;\n  key?: FeatureFlagKey;\n  category?: string;\n}\n\nexport interface FeatureFlagMetadata {\n  description?: string;\n  category?: string;\n  dependencies?: string[];\n  experimental?: boolean;\n  deprecated?: boolean;\n}\n\nexport interface FeatureFlagConfig {\n  [key: string]: unknown;\n  flags: Record<string, boolean>;\n  timestamp: string;\n  version: string;\n}\n\nexport interface FeatureFlagSubscription {\n  unsubscribe: () => void;\n}\n\nexport interface FeatureFlagSystemInfo {\n  totalFlags: number;\n  enabledFlags: number;\n  disabledFlags: number;\n  environment: string;\n  categories: Record<string, number>;\n}\n\ntype _KnownFlag = keyof typeof FEATURE_FLAGS;\n\n// Define the missing FeatureFlagKey type\nexport type FeatureFlagKey = keyof typeof FEATURE_FLAGS;\n\nexport type FeatureFlagManager = typeof featureFlagManager;\n\n// also accept lowercase legacy names found in code: 'pwa', 'advancedPrivacy'\nconst ALIASES: Record<string, FeatureFlagKey> = {\n  pwa: 'PWA',\n  advancedprivacy: 'ADVANCED_PRIVACY',\n  'advanced-privacy': 'ADVANCED_PRIVACY',\n  analytics: 'ANALYTICS',\n  admin: 'ADMIN',\n  civics: 'CIVICS_ADDRESS_LOOKUP',\n  'civics-address-lookup': 'CIVICS_ADDRESS_LOOKUP',\n};\n\nfunction normalize(key: string): FeatureFlagKey | null {\n  if (key in FEATURE_FLAGS) return key as FeatureFlagKey;\n  const alias = ALIASES[key.toLowerCase()];\n  return alias || null;\n}\n\n// Subscriptions for flag changes\nconst subscribers = new Set<(flags: Record<string, boolean>) => void>();\nfunction notifySubscribers() {\n  const snapshot = withOptional({}, mutableFlags);\n  subscribers.forEach(cb => {\n    try { cb(snapshot); } catch { /* noop */ }\n  });\n}\n\nexport function isFeatureEnabled<K extends string>(key: K): boolean {\n  const normalizedKey = normalize(key);\n  if (normalizedKey && normalizedKey in FEATURE_FLAGS) {\n    return FEATURE_FLAGS[normalizedKey];\n  }\n  // Unknown flags default to false but don't crash\n  return false;\n}\n\n// Create a mutable copy of FEATURE_FLAGS for runtime modifications\nconst mutableFlags: Record<string, boolean> = withOptional({}, FEATURE_FLAGS);\n\n// Helper function to categorize flags\nfunction categorizeFlag(flagId: string): string {\n  const categories: Record<string, string[]> = {\n    // Core MVP features\n    core: ['CORE_AUTH', 'CORE_POLLS', 'CORE_USERS', 'WEBAUTHN', 'PWA', 'ADMIN', 'FEEDBACK_WIDGET'],\n    \n    // Enhanced MVP features ready for implementation\n    enhanced: ['ENHANCED_PROFILE', 'ENHANCED_POLLS', 'ENHANCED_VOTING'],\n    \n    // Future features requiring development\n    future: ['AUTOMATED_POLLS', 'ADVANCED_PRIVACY', 'CIVICS_ADDRESS_LOOKUP', 'SOCIAL_SHARING', 'SOCIAL_SHARING_POLLS', 'SOCIAL_SHARING_CIVICS', 'SOCIAL_SHARING_VISUAL', 'SOCIAL_SHARING_OG', 'SOCIAL_SIGNUP'],\n    \n    // Performance and optimization\n    performance: ['PERFORMANCE_OPTIMIZATION', 'FEATURE_DB_OPTIMIZATION_SUITE', 'ANALYTICS'],\n    \n    // Experimental features removed - not actually implemented\n    \n    // System features\n    system: ['NOTIFICATIONS', 'THEMES', 'ACCESSIBILITY', 'INTERNATIONALIZATION']\n  };\n  \n  for (const [category, flags] of Object.entries(categories)) {\n    if (flags.includes(flagId)) {\n      return category;\n    }\n  }\n  return 'general';\n}\n\nexport const featureFlagManager = {\n  enable: (k: string | FeatureFlagKey): boolean => {\n    const key = normalize(String(k)); \n    if (key && key in mutableFlags) {\n      mutableFlags[key] = true;\n      notifySubscribers();\n      return true;\n    }\n    return false;\n  },\n  disable: (k: string | FeatureFlagKey): boolean => {\n    const key = normalize(String(k)); \n    if (key && key in mutableFlags) {\n      mutableFlags[key] = false;\n      notifySubscribers();\n      return true;\n    }\n    return false;\n  },\n  toggle: (k: string | FeatureFlagKey): boolean => {\n    const key = normalize(String(k)); \n    if (key && key in mutableFlags) {\n      mutableFlags[key] = !mutableFlags[key];\n      notifySubscribers();\n      return true;\n    }\n    return false;\n  },\n  get: (key: string | FeatureFlagKey): boolean => {\n    const normalizedKey = normalize(String(key));\n    if (normalizedKey && normalizedKey in mutableFlags) {\n      return mutableFlags[normalizedKey] || false;\n    }\n    return false;\n  },\n  all: () => withOptional({}, mutableFlags),\n  \n  // Additional methods expected by useFeatureFlags hook\n  getAllFlags: (): Map<string, FeatureFlag> => {\n    const flags: FeatureFlag[] = Object.entries(mutableFlags).map(([key, enabled]) => ({\n      id: key,\n      name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled,\n      description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n      key: key as FeatureFlagKey,\n      category: categorizeFlag(key)\n    }));\n    return new Map(flags.map(flag => [flag.id, flag]));\n  },\n  isEnabled: (key: string | FeatureFlagKey): boolean => {\n    const normalizedKey = normalize(String(key));\n    if (normalizedKey && normalizedKey in mutableFlags) {\n      return mutableFlags[normalizedKey] || false;\n    }\n    return false;\n  },\n  getFlag: (flagId: string): FeatureFlag | null => {\n    const normalizedKey = normalize(flagId);\n    if (normalizedKey && normalizedKey in mutableFlags) {\n      const enabled = mutableFlags[normalizedKey] || false;\n      return {\n        id: flagId,\n        name: flagId.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n        enabled,\n        description: `Feature flag for ${flagId.toLowerCase().replace(/_/g, ' ')}`,\n        key: normalizedKey,\n        category: categorizeFlag(flagId)\n      };\n    }\n    return null;\n  },\n  getEnabledFlags: (): FeatureFlag[] => Object.entries(mutableFlags)\n    .filter(([_, enabled]) => enabled)\n    .map(([key, enabled]) => ({\n      id: key,\n      name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled,\n      description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n      key: key as FeatureFlagKey,\n      category: categorizeFlag(key)\n    })),\n  getDisabledFlags: (): FeatureFlag[] => Object.entries(mutableFlags)\n    .filter(([_, enabled]) => !enabled)\n    .map(([key, enabled]) => ({\n      id: key,\n      name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled,\n      description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n      key: key as FeatureFlagKey,\n      category: categorizeFlag(key)\n    })),\n  getFlagsByCategory: (category: string): FeatureFlag[] => {\n    const categories: Record<string, string[]> = {\n      // Core MVP features (always enabled)\n      core: ['WEBAUTHN', 'PWA', 'ADMIN', 'FEEDBACK_WIDGET'],\n      \n      // Enhanced MVP features ready for implementation\n      enhanced: ['ENHANCED_PROFILE', 'ENHANCED_POLLS', 'ENHANCED_VOTING', 'CIVICS_ADDRESS_LOOKUP'],\n      \n      // Future features requiring development\n      future: ['AUTOMATED_POLLS', 'ADVANCED_PRIVACY', 'SOCIAL_SHARING', 'SOCIAL_SHARING_POLLS', 'SOCIAL_SHARING_CIVICS', 'SOCIAL_SHARING_VISUAL', 'SOCIAL_SHARING_OG', 'SOCIAL_SIGNUP'],\n      \n      // Performance and optimization\n      performance: ['PERFORMANCE_OPTIMIZATION', 'FEATURE_DB_OPTIMIZATION_SUITE', 'ANALYTICS'],\n      \n      // Experimental features\n      experimental: ['EXPERIMENTAL_UI', 'EXPERIMENTAL_ANALYTICS', 'EXPERIMENTAL_COMPONENTS'],\n      \n      // System features\n      system: ['NOTIFICATIONS', 'THEMES', 'ACCESSIBILITY', 'INTERNATIONALIZATION']\n    };\n    const flagIds = categories[category] || [];\n    return flagIds.map(flagId => ({\n      id: flagId,\n      name: flagId.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled: mutableFlags[flagId as FeatureFlagKey] || false,\n      description: `Feature flag for ${flagId.toLowerCase().replace(/_/g, ' ')}`,\n      key: flagId as FeatureFlagKey,\n      category\n    }));\n  },\n  getSystemInfo: (): FeatureFlagSystemInfo => ({\n    totalFlags: Object.keys(mutableFlags).length,\n    enabledFlags: Object.values(mutableFlags).filter(Boolean).length,\n    disabledFlags: Object.values(mutableFlags).filter(f => !f).length,\n    environment: process.env.NODE_ENV || 'development',\n    categories: {\n      core: 4,        // WEBAUTHN, PWA, ADMIN, FEEDBACK_WIDGET\n      enhanced: 5,    // ENHANCED_PROFILE, ENHANCED_POLLS, ENHANCED_VOTING, CIVICS_ADDRESS_LOOKUP, CIVICS_REPRESENTATIVE_DATABASE\n      future: 8,      // AUTOMATED_POLLS, ADVANCED_PRIVACY, SOCIAL_SHARING + 5 sub-features\n      performance: 3, // PERFORMANCE_OPTIMIZATION, FEATURE_DB_OPTIMIZATION_SUITE, ANALYTICS\n      // experimental: 0, // Removed - not actually implemented\n      system: 4       // NOTIFICATIONS, THEMES, ACCESSIBILITY, INTERNATIONALIZATION\n    }\n  }),\n  areDependenciesEnabled: (flagId: string): boolean => {\n    // Enhanced dependency check for all features\n    const dependencies: Record<string, string[]> = {\n      // Enhanced feature dependencies (simplified - no core dependencies needed)\n      'ENHANCED_PROFILE': [],\n      'ENHANCED_DASHBOARD': [],\n      'ENHANCED_POLLS': [],\n      'ENHANCED_VOTING': [],\n      'CIVICS_ADDRESS_LOOKUP': [],\n      \n      // Future feature dependencies\n      'AUTOMATED_POLLS': ['ADMIN'],\n      'SOCIAL_SHARING': [],\n      'SOCIAL_SHARING_POLLS': ['SOCIAL_SHARING'],\n      'SOCIAL_SHARING_CIVICS': ['SOCIAL_SHARING', 'CIVICS_ADDRESS_LOOKUP'],\n      'SOCIAL_SHARING_VISUAL': ['SOCIAL_SHARING'],\n      'SOCIAL_SHARING_OG': ['SOCIAL_SHARING'],\n      'SOCIAL_SIGNUP': [],\n      \n      // Performance dependencies\n      'PERFORMANCE_OPTIMIZATION': [],\n      'ANALYTICS': [],\n      \n      // System feature dependencies\n      'NOTIFICATIONS': ['PWA'],\n      'THEMES': [],\n      'ACCESSIBILITY': [],\n      'INTERNATIONALIZATION': []\n    };\n    const deps = dependencies[flagId] || [];\n    return deps.every(dep => {\n      const normalizedKey = normalize(dep);\n      return normalizedKey ? mutableFlags[normalizedKey] : false;\n    });\n  },\n  subscribe: (callback: (flags: Record<string, boolean>) => void): FeatureFlagSubscription => {\n    // Register and provide unsubscribe\n    if (typeof callback === 'function') {\n      subscribers.add(callback);\n      // Immediately push current state to new subscriber\n      try { callback(withOptional({}, mutableFlags)); } catch { /* noop */ }\n    }\n    return { unsubscribe: () => subscribers.delete(callback) };\n  },\n  updateFlagMetadata: (flagId: string, metadata: FeatureFlagMetadata): boolean => {\n    // For now, just return true - in a real app, this would update flag metadata\n    console.log(`Updating metadata for flag ${flagId}:`, metadata);\n    return true;\n  },\n  reset: (): void => {\n    // Reset all flags to their default values\n    Object.keys(FEATURE_FLAGS).forEach(key => {\n      const flagKey = key as FeatureFlagKey;\n      mutableFlags[flagKey] = FEATURE_FLAGS[flagKey];\n    });\n    notifySubscribers();\n  },\n  exportConfig: (): FeatureFlagConfig => {\n    // Export current flag configuration\n    return {\n      flags: withOptional({}, mutableFlags),\n      timestamp: new Date().toISOString(),\n      version: '1.0.0'\n    };\n  },\n  importConfig: (config: FeatureFlagConfig): void => {\n    // Import flag configuration\n    if (config && config.flags) {\n      Object.entries(config.flags).forEach(([key, value]) => {\n        const normalizedKey = normalize(key);\n        if (normalizedKey && normalizedKey in mutableFlags && typeof value === 'boolean') {\n          mutableFlags[normalizedKey] = value;\n        }\n      });\n      notifySubscribers();\n    }\n  }\n};\n\n// Named helpers kept for compatibility\nexport const enableFeature = featureFlagManager.enable;\nexport const disableFeature = featureFlagManager.disable;\nexport const toggleFeature = featureFlagManager.toggle;\nexport const getFeatureFlag = (k: string | FeatureFlagKey) => isFeatureEnabled(k);\n\n// E2E API functions\nexport async function getFeatureFlags(): Promise<Record<string, boolean>> {\n  return featureFlagManager.all();\n}\n\nexport async function setFeatureFlags(flags: Record<string, boolean>): Promise<void> {\n  Object.entries(flags).forEach(([key, value]) => {\n    const normalizedKey = normalize(key);\n    if (normalizedKey && normalizedKey in mutableFlags && typeof value === 'boolean') {\n      mutableFlags[normalizedKey] = value;\n    }\n  });\n  notifySubscribers();\n}\nexport const getAllFeatureFlags = () => featureFlagManager.all();\n\n// Additional exports expected by useFeatureFlags hook\nexport const FeatureFlagManager = featureFlagManager;"],"names":["FEATURE_FLAGS","FeatureFlagManager","disableFeature","enableFeature","featureFlagManager","getAllFeatureFlags","getFeatureFlag","getFeatureFlags","isFeatureEnabled","setFeatureFlags","toggleFeature","WEBAUTHN","PWA","ADMIN","FEEDBACK_WIDGET","USER_SUGGESTIONS_MANAGER","ENHANCED_PROFILE","ENHANCED_POLLS","ENHANCED_VOTING","CIVICS_ADDRESS_LOOKUP","CIVICS_REPRESENTATIVE_DATABASE","CIVICS_CAMPAIGN_FINANCE","CIVICS_VOTING_RECORDS","CANDIDATE_ACCOUNTABILITY","CANDIDATE_CARDS","ALTERNATIVE_CANDIDATES","AUTOMATED_POLLS","DEMOGRAPHIC_FILTERING","TRENDING_POLLS","ADVANCED_PRIVACY","MEDIA_BIAS_ANALYSIS","POLL_NARRATIVE_SYSTEM","SOCIAL_SHARING","SOCIAL_SHARING_POLLS","SOCIAL_SHARING_CIVICS","SOCIAL_SHARING_VISUAL","SOCIAL_SHARING_OG","SOCIAL_SIGNUP","CONTACT_INFORMATION_SYSTEM","CIVICS_TESTING_STRATEGY","DEVICE_FLOW_AUTH","PERFORMANCE_OPTIMIZATION","FEATURE_DB_OPTIMIZATION_SUITE","ANALYTICS","PUSH_NOTIFICATIONS","THEMES","ACCESSIBILITY","INTERNATIONALIZATION","ALIASES","pwa","advancedprivacy","analytics","admin","civics","normalize","key","alias","toLowerCase","subscribers","Set","notifySubscribers","snapshot","withOptional","mutableFlags","forEach","cb","normalizedKey","categorizeFlag","flagId","categories","core","enhanced","future","performance","system","category","flags","Object","entries","includes","enable","k","String","disable","toggle","get","all","getAllFlags","map","enabled","id","name","replace","l","toUpperCase","description","Map","flag","isEnabled","getFlag","getEnabledFlags","filter","_","getDisabledFlags","getFlagsByCategory","experimental","flagIds","getSystemInfo","totalFlags","keys","length","enabledFlags","values","Boolean","disabledFlags","f","environment","process","env","NODE_ENV","areDependenciesEnabled","dependencies","deps","every","dep","subscribe","callback","add","unsubscribe","delete","updateFlagMetadata","metadata","console","log","reset","flagKey","exportConfig","timestamp","Date","toISOString","version","importConfig","config","value"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/features/auth/auth-error-prevention.test.ts"],"sourcesContent":["/**\n * Authentication Error Prevention Tests\n * \n * Ensures authentication components handle security-critical errors\n * properly and maintain user security across all auth operations.\n * \n * Created: January 27, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect } from '@jest/globals';\nimport * as fs from 'fs';\nimport * as glob from 'glob';\n\ndescribe('Authentication Error Prevention', () => {\n  it('WebAuthn errors should be properly handled', () => {\n    const authFiles = glob.sync('web/features/auth/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    authFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for WebAuthn operations\n      if (content.includes('navigator.credentials') || content.includes('webauthn')) {\n        // Should have proper error handling\n        if (!content.includes('try') && !content.includes('catch')) {\n          problematicFiles.push(`${file}: WebAuthn operations should have error handling`);\n        }\n      }\n      \n      // Check for credential operations\n      if (content.includes('create') || content.includes('get')) {\n        // Should have proper error handling\n        if (!content.includes('catch') && content.includes('credentials')) {\n          problematicFiles.push(`${file}: credential operations should have error handling`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Auth files with missing WebAuthn error handling:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('authentication state should be properly managed', () => {\n    const authFiles = glob.sync('web/features/auth/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    authFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for authentication state management\n      if (content.includes('isAuthenticated') || content.includes('user')) {\n        // Should have proper state management\n        if (!content.includes('useState') && !content.includes('useStore')) {\n          problematicFiles.push(`${file}: authentication state not properly managed`);\n        }\n      }\n      \n      // Check for error state management\n      if (content.includes('error') && content.includes('setError')) {\n        // Should have proper error state management\n        if (!content.includes('try') && !content.includes('catch')) {\n          problematicFiles.push(`${file}: error state not properly managed`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Auth files with state management issues:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('login failures should provide user feedback', () => {\n    const authFiles = glob.sync('web/features/auth/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    authFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for login operations\n      if (content.includes('login') || content.includes('signIn')) {\n        // Should have user feedback\n        if (!content.includes('toast') && !content.includes('alert') && !content.includes('message')) {\n          problematicFiles.push(`${file}: login operations should provide user feedback`);\n        }\n      }\n      \n      // Check for error handling\n      if (content.includes('catch') && content.includes('error')) {\n        // Should have user feedback in error cases\n        if (!content.includes('toast') && !content.includes('alert') && !content.includes('message')) {\n          problematicFiles.push(`${file}: error handling should provide user feedback`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Auth files with missing user feedback:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('authentication should be secure', () => {\n    const authFiles = glob.sync('web/features/auth/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    authFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for hardcoded credentials\n      if (content.includes('password') && content.includes('\"') && content.includes('admin')) {\n        problematicFiles.push(`${file}: potential hardcoded credentials`);\n      }\n      \n      // Check for insecure storage\n      if (content.includes('localStorage') && content.includes('token')) {\n        problematicFiles.push(`${file}: tokens should not be stored in localStorage`);\n      }\n      \n      // Check for console.log with sensitive data\n      if (content.includes('console.log') && (content.includes('password') || content.includes('token'))) {\n        problematicFiles.push(`${file}: sensitive data should not be logged`);\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Auth files with security issues:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n});\n"],"names":["describe","it","authFiles","glob","sync","ignore","problematicFiles","forEach","file","content","fs","readFileSync","includes","push","length","console","log","expect","toHaveLength"],"mappings":"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"}
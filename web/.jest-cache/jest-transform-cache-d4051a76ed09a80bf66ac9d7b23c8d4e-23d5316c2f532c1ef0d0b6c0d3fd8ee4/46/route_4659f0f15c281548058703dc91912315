89138857b3ce92e89fb7619c786e2d10
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    GET: function() {
        return GET;
    },
    POST: function() {
        return POST;
    },
    dynamic: function() {
        return dynamic;
    }
});
const _server = require("next/server");
const _middleware = require("../../../lib/core/auth/middleware");
const _logger = require("../../../lib/utils/logger");
const _server1 = require("../../../utils/supabase/server");
const dynamic = "force-dynamic";
async function GET(request) {
    try {
        console.log("\uD83D\uDD0D API Route: Calling getSupabaseServerClient...");
        const supabaseClient = await (0, _server1.getSupabaseServerClient)();
        console.log("\uD83D\uDD0D API Route: Supabase client result:", !!supabaseClient);
        if (!supabaseClient) {
            console.log("\uD83D\uDD0D API Route: Supabase client is null/undefined");
            return _server.NextResponse.json({
                error: "Supabase client not available"
            }, {
                status: 500
            });
        }
        const { searchParams } = new URL(request.url);
        const limit = parseInt(searchParams.get("limit") || "20");
        const _status = searchParams.get("status") || "active";
        // Fetch active polls from polls table
        let polls;
        try {
            (0, _logger.devLog)("Fetching active polls from polls table...");
            const { data: directPolls, error: directError } = await supabaseClient.from("polls").select("id, title, total_votes, options, status").eq("status", "active").limit(limit);
            if (directError) {
                throw directError;
            }
            (0, _logger.devLog)("Found polls:", directPolls.length || 0);
            // Manually aggregate results (temporary solution)
            polls = (directPolls ?? []).map((poll)=>({
                    id: poll.id,
                    title: poll.title,
                    total_votes: poll.total_votes || 0,
                    aggregated_results: Array.isArray(poll.options) ? poll.options.reduce((acc, option, index)=>{
                        acc[`option_${index + 1}`] = option.votes || 0;
                        return acc;
                    }, {}) : {},
                    status: poll.status
                }));
        } catch (fallbackError) {
            (0, _logger.devLog)("Error fetching polls:", fallbackError);
            return _server.NextResponse.json({
                error: "Failed to fetch polls"
            }, {
                status: 500
            });
        }
        // Additional security: ensure no sensitive data is returned
        const sanitizedPolls = polls.map((poll)=>({
                poll_id: poll.id,
                title: poll.title,
                total_votes: poll.total_votes,
                // Only include safe fields
                status: "active",
                created_at: new Date().toISOString()
            })) || [];
        return _server.NextResponse.json({
            success: true,
            polls: sanitizedPolls,
            count: sanitizedPolls.length,
            message: "Aggregated poll results only - no individual vote data"
        });
    } catch (error) {
        (0, _logger.devLog)("Error in polls API:", error);
        return _server.NextResponse.json({
            error: "Internal server error",
            details: error instanceof Error ? error.message : String(error),
            stack: error instanceof Error ? error.stack : undefined
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // Always require authentication - no E2E bypasses
        const supabase = await (0, _server1.getSupabaseServerClient)();
        if (!supabase) {
            return _server.NextResponse.json({
                error: "Supabase client not available"
            }, {
                status: 500
            });
        }
        // Always require authentication
        let user;
        try {
            user = await (0, _middleware.getUser)();
        } catch (error) {
            (0, _logger.devLog)("Authentication error during poll creation:", error);
            return _server.NextResponse.json({
                error: "Authentication required to create polls"
            }, {
                status: 401
            });
        }
        // Check if user is authenticated
        if (!user) {
            return _server.NextResponse.json({
                error: "Authentication required to create polls"
            }, {
                status: 401
            });
        }
        // Verify user is active
        if (user) {
            const { data: userProfile } = await supabase.from("user_profiles").select("is_active").eq("user_id", user.id).single();
            if (!userProfile || !("is_active" in userProfile) || !userProfile.is_active) {
                return _server.NextResponse.json({
                    error: "Active account required to create polls"
                }, {
                    status: 403
                });
            }
        }
        const body = await request.json();
        const { title, options, votingMethod = "single", description, category = "general", privacyLevel = "public", allowMultipleVotes = false, showResults = true, allowComments = true, endTime, hashtags = [], primaryHashtag } = body;
        // Validate required fields
        if (!title || !options || !Array.isArray(options) || options.length < 2) {
            return _server.NextResponse.json({
                error: "Title and at least 2 options are required"
            }, {
                status: 400
            });
        }
        // Sanitize and validate options
        const sanitizedOptions = options.filter((option)=>typeof option === "string" && option.trim().length > 0).map((option)=>option.trim()).slice(0, 10); // Limit to 10 options max
        if (sanitizedOptions.length < 2) {
            return _server.NextResponse.json({
                error: "At least 2 valid options are required"
            }, {
                status: 400
            });
        }
        // Create poll with user as creator
        const { data: poll, error: pollError } = await supabase.from("polls").insert({
            title: title.trim(),
            description: description?.trim() || null,
            options: sanitizedOptions,
            voting_method: votingMethod,
            privacy_level: privacyLevel,
            category,
            status: "active",
            created_by: user?.id || "",
            total_votes: 0,
            participation: 0,
            end_time: endTime || null,
            hashtags: hashtags || [],
            primary_hashtag: primaryHashtag || null,
            poll_settings: {
                allowMultipleVotes,
                showResults,
                allowComments
            }
        }).select().single();
        if (pollError) {
            (0, _logger.devLog)("Error creating poll:", pollError);
            return _server.NextResponse.json({
                error: "Failed to create poll",
                details: pollError
            }, {
                status: 500
            });
        }
        // Return sanitized poll data (no sensitive information)
        const sanitizedPoll = poll && !("error" in poll) ? {
            id: poll.id,
            title: poll.title,
            description: poll.description,
            options: poll.options,
            voting_method: poll.voting_method,
            privacy_level: poll.privacy_level,
            category: poll.category,
            status: poll.status,
            total_votes: poll.total_votes,
            participation: poll.participation,
            end_time: poll.end_time,
            hashtags: poll.hashtags || [],
            primary_hashtag: poll.primary_hashtag,
            poll_settings: poll.poll_settings,
            created_at: poll.created_at
        } : null;
        return _server.NextResponse.json(sanitizedPoll);
    } catch (error) {
        (0, _logger.devLog)("Error in polls API:", error);
        return _server.NextResponse.json({
            error: "Internal server error"
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9hcHAvYXBpL3BvbGxzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3R9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuaW1wb3J0IHsgZ2V0VXNlciB9IGZyb20gJ0AvbGliL2NvcmUvYXV0aC9taWRkbGV3YXJlJztcbmltcG9ydCB7IGRldkxvZyB9IGZyb20gJ0AvbGliL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRTdXBhYmFzZVNlcnZlckNsaWVudCB9IGZyb20gJ0AvdXRpbHMvc3VwYWJhc2Uvc2VydmVyJztcblxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSAnZm9yY2UtZHluYW1pYyc7XG5cbi8vIFR5cGUgZGVmaW5pdGlvbnMgZm9yIHBvbGwgZGF0YVxuaW50ZXJmYWNlIFBvbGxPcHRpb24ge1xuICBpZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIHZvdGVzPzogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgX1BvbGxEYXRhIHtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgdG90YWxfdm90ZXM6IG51bWJlcjtcbiAgb3B0aW9uczogUG9sbE9wdGlvbltdO1xuICBzdGF0dXM6IHN0cmluZztcbn1cblxuLy8gR0VUIC9hcGkvcG9sbHMgLSBHZXQgYWN0aXZlIHBvbGxzIHdpdGggYWdncmVnYXRlZCByZXN1bHRzIG9ubHlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBBUEkgUm91dGU6IENhbGxpbmcgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQuLi4nKTtcbiAgICBjb25zdCBzdXBhYmFzZUNsaWVudCA9IGF3YWl0IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XG4gICAgY29uc29sZS5sb2coJ/CflI0gQVBJIFJvdXRlOiBTdXBhYmFzZSBjbGllbnQgcmVzdWx0OicsICEhc3VwYWJhc2VDbGllbnQpO1xuICAgIFxuICAgIGlmICghc3VwYWJhc2VDbGllbnQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIEFQSSBSb3V0ZTogU3VwYWJhc2UgY2xpZW50IGlzIG51bGwvdW5kZWZpbmVkJyk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdTdXBhYmFzZSBjbGllbnQgbm90IGF2YWlsYWJsZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzIwJyk7XG4gICAgY29uc3QgX3N0YXR1cyA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXR1cycpIHx8ICdhY3RpdmUnO1xuXG4gICAgLy8gRmV0Y2ggYWN0aXZlIHBvbGxzIGZyb20gcG9sbHMgdGFibGVcbiAgICBsZXQgcG9sbHM7XG5cbiAgICB0cnkge1xuICAgICAgZGV2TG9nKCdGZXRjaGluZyBhY3RpdmUgcG9sbHMgZnJvbSBwb2xscyB0YWJsZS4uLicpO1xuICAgICAgY29uc3QgeyBkYXRhOiBkaXJlY3RQb2xscywgZXJyb3I6IGRpcmVjdEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUNsaWVudFxuICAgICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgICAuc2VsZWN0KCdpZCwgdGl0bGUsIHRvdGFsX3ZvdGVzLCBvcHRpb25zLCBzdGF0dXMnKVxuICAgICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgICAubGltaXQobGltaXQpO1xuXG4gICAgICBpZiAoZGlyZWN0RXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZGlyZWN0RXJyb3I7XG4gICAgICB9XG5cbiAgICAgIGRldkxvZygnRm91bmQgcG9sbHM6JywgZGlyZWN0UG9sbHMubGVuZ3RoIHx8IDApO1xuXG4gICAgICAvLyBNYW51YWxseSBhZ2dyZWdhdGUgcmVzdWx0cyAodGVtcG9yYXJ5IHNvbHV0aW9uKVxuICAgICAgcG9sbHMgPSAoZGlyZWN0UG9sbHMgPz8gW10pLm1hcChwb2xsID0+ICh7XG4gICAgICAgIGlkOiBwb2xsLmlkLFxuICAgICAgICB0aXRsZTogcG9sbC50aXRsZSxcbiAgICAgICAgdG90YWxfdm90ZXM6IHBvbGwudG90YWxfdm90ZXMgfHwgMCxcbiAgICAgICAgYWdncmVnYXRlZF9yZXN1bHRzOiBBcnJheS5pc0FycmF5KHBvbGwub3B0aW9ucykgPyBcbiAgICAgICAgICBwb2xsLm9wdGlvbnMucmVkdWNlKChhY2M6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4sIG9wdGlvbjogUG9sbE9wdGlvbiwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgYWNjW2BvcHRpb25fJHtpbmRleCArIDF9YF0gPSBvcHRpb24udm90ZXMgfHwgMDtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgfSwge30pIDoge30sXG4gICAgICAgIHN0YXR1czogcG9sbC5zdGF0dXNcbiAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChmYWxsYmFja0Vycm9yKSB7XG4gICAgICBkZXZMb2coJ0Vycm9yIGZldGNoaW5nIHBvbGxzOicsIGZhbGxiYWNrRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIHBvbGxzJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQWRkaXRpb25hbCBzZWN1cml0eTogZW5zdXJlIG5vIHNlbnNpdGl2ZSBkYXRhIGlzIHJldHVybmVkXG4gICAgY29uc3Qgc2FuaXRpemVkUG9sbHMgPSBwb2xscy5tYXAocG9sbCA9PiAoe1xuICAgICAgcG9sbF9pZDogcG9sbC5pZCxcbiAgICAgIHRpdGxlOiBwb2xsLnRpdGxlLFxuICAgICAgdG90YWxfdm90ZXM6IHBvbGwudG90YWxfdm90ZXMsXG4gICAgICAvLyBPbmx5IGluY2x1ZGUgc2FmZSBmaWVsZHNcbiAgICAgIHN0YXR1czogJ2FjdGl2ZScsIC8vIEFsd2F5cyBzaG93IGFzIGFjdGl2ZSBmb3IgcHVibGljIHZpZXdcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwgLy8gR2VuZXJpYyB0aW1lc3RhbXBcbiAgICB9KSkgfHwgW107XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHBvbGxzOiBzYW5pdGl6ZWRQb2xscyxcbiAgICAgIGNvdW50OiBzYW5pdGl6ZWRQb2xscy5sZW5ndGgsXG4gICAgICBtZXNzYWdlOiAnQWdncmVnYXRlZCBwb2xsIHJlc3VsdHMgb25seSAtIG5vIGluZGl2aWR1YWwgdm90ZSBkYXRhJ1xuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgZGV2TG9nKCdFcnJvciBpbiBwb2xscyBBUEk6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgXG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG4vLyBQT1NUIC9hcGkvcG9sbHMgLSBDcmVhdGUgbmV3IHBvbGwgKGF1dGhlbnRpY2F0ZWQgdXNlcnMgb25seSlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gQWx3YXlzIHJlcXVpcmUgYXV0aGVudGljYXRpb24gLSBubyBFMkUgYnlwYXNzZXNcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XG4gICAgXG4gICAgaWYgKCFzdXBhYmFzZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnU3VwYWJhc2UgY2xpZW50IG5vdCBhdmFpbGFibGUnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBBbHdheXMgcmVxdWlyZSBhdXRoZW50aWNhdGlvblxuICAgIGxldCB1c2VyO1xuICAgIHRyeSB7XG4gICAgICB1c2VyID0gYXdhaXQgZ2V0VXNlcigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ0F1dGhlbnRpY2F0aW9uIGVycm9yIGR1cmluZyBwb2xsIGNyZWF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBWZXJpZnkgdXNlciBpcyBhY3RpdmVcbiAgICBpZiAodXNlcikge1xuICAgICAgY29uc3QgeyBkYXRhOiB1c2VyUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxuICAgICAgICAuc2VsZWN0KCdpc19hY3RpdmUnKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmICghdXNlclByb2ZpbGUgfHwgISgnaXNfYWN0aXZlJyBpbiB1c2VyUHJvZmlsZSkgfHwgIXVzZXJQcm9maWxlLmlzX2FjdGl2ZSkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ0FjdGl2ZSBhY2NvdW50IHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBcbiAgICAgIHRpdGxlLCBcbiAgICAgIG9wdGlvbnMsIFxuICAgICAgdm90aW5nTWV0aG9kID0gJ3NpbmdsZScsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIGNhdGVnb3J5ID0gJ2dlbmVyYWwnLFxuICAgICAgcHJpdmFjeUxldmVsID0gJ3B1YmxpYycsXG4gICAgICBhbGxvd011bHRpcGxlVm90ZXMgPSBmYWxzZSxcbiAgICAgIHNob3dSZXN1bHRzID0gdHJ1ZSxcbiAgICAgIGFsbG93Q29tbWVudHMgPSB0cnVlLFxuICAgICAgZW5kVGltZSxcbiAgICAgIGhhc2h0YWdzID0gW10sXG4gICAgICBwcmltYXJ5SGFzaHRhZ1xuICAgIH0gPSBib2R5O1xuXG4gICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgaWYgKCF0aXRsZSB8fCAhb3B0aW9ucyB8fCAhQXJyYXkuaXNBcnJheShvcHRpb25zKSB8fCBvcHRpb25zLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1RpdGxlIGFuZCBhdCBsZWFzdCAyIG9wdGlvbnMgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gU2FuaXRpemUgYW5kIHZhbGlkYXRlIG9wdGlvbnNcbiAgICBjb25zdCBzYW5pdGl6ZWRPcHRpb25zID0gb3B0aW9uc1xuICAgICAgLmZpbHRlcihvcHRpb24gPT4gdHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycgJiYgb3B0aW9uLnRyaW0oKS5sZW5ndGggPiAwKVxuICAgICAgLm1hcChvcHRpb24gPT4gb3B0aW9uLnRyaW0oKSlcbiAgICAgIC5zbGljZSgwLCAxMCk7IC8vIExpbWl0IHRvIDEwIG9wdGlvbnMgbWF4XG5cbiAgICBpZiAoc2FuaXRpemVkT3B0aW9ucy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdBdCBsZWFzdCAyIHZhbGlkIG9wdGlvbnMgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHBvbGwgd2l0aCB1c2VyIGFzIGNyZWF0b3JcbiAgICBjb25zdCB7IGRhdGE6IHBvbGwsIGVycm9yOiBwb2xsRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHRpdGxlOiB0aXRsZS50cmltKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbj8udHJpbSgpIHx8IG51bGwsXG4gICAgICAgIG9wdGlvbnM6IHNhbml0aXplZE9wdGlvbnMsXG4gICAgICAgIHZvdGluZ19tZXRob2Q6IHZvdGluZ01ldGhvZCxcbiAgICAgICAgcHJpdmFjeV9sZXZlbDogcHJpdmFjeUxldmVsLFxuICAgICAgICBjYXRlZ29yeSxcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgY3JlYXRlZF9ieTogdXNlcj8uaWQgfHwgJycsXG4gICAgICAgIHRvdGFsX3ZvdGVzOiAwLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uOiAwLFxuICAgICAgICBlbmRfdGltZTogZW5kVGltZSB8fCBudWxsLFxuICAgICAgICBoYXNodGFnczogaGFzaHRhZ3MgfHwgW10sXG4gICAgICAgIHByaW1hcnlfaGFzaHRhZzogcHJpbWFyeUhhc2h0YWcgfHwgbnVsbCxcbiAgICAgICAgcG9sbF9zZXR0aW5nczoge1xuICAgICAgICAgIGFsbG93TXVsdGlwbGVWb3RlcyxcbiAgICAgICAgICBzaG93UmVzdWx0cyxcbiAgICAgICAgICBhbGxvd0NvbW1lbnRzXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChwb2xsRXJyb3IpIHtcbiAgICAgIGRldkxvZygnRXJyb3IgY3JlYXRpbmcgcG9sbDonLCBwb2xsRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBwb2xsJywgZGV0YWlsczogcG9sbEVycm9yIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gc2FuaXRpemVkIHBvbGwgZGF0YSAobm8gc2Vuc2l0aXZlIGluZm9ybWF0aW9uKVxuICAgIGNvbnN0IHNhbml0aXplZFBvbGwgPSBwb2xsICYmICEoJ2Vycm9yJyBpbiBwb2xsKSA/IHtcbiAgICAgIGlkOiBwb2xsLmlkLFxuICAgICAgdGl0bGU6IHBvbGwudGl0bGUsXG4gICAgICBkZXNjcmlwdGlvbjogcG9sbC5kZXNjcmlwdGlvbixcbiAgICAgIG9wdGlvbnM6IHBvbGwub3B0aW9ucyxcbiAgICAgIHZvdGluZ19tZXRob2Q6IHBvbGwudm90aW5nX21ldGhvZCxcbiAgICAgIHByaXZhY3lfbGV2ZWw6IHBvbGwucHJpdmFjeV9sZXZlbCxcbiAgICAgIGNhdGVnb3J5OiBwb2xsLmNhdGVnb3J5LFxuICAgICAgc3RhdHVzOiBwb2xsLnN0YXR1cyxcbiAgICAgIHRvdGFsX3ZvdGVzOiBwb2xsLnRvdGFsX3ZvdGVzLFxuICAgICAgcGFydGljaXBhdGlvbjogcG9sbC5wYXJ0aWNpcGF0aW9uLFxuICAgICAgZW5kX3RpbWU6IHBvbGwuZW5kX3RpbWUsXG4gICAgICBoYXNodGFnczogcG9sbC5oYXNodGFncyB8fCBbXSxcbiAgICAgIHByaW1hcnlfaGFzaHRhZzogcG9sbC5wcmltYXJ5X2hhc2h0YWcsXG4gICAgICBwb2xsX3NldHRpbmdzOiBwb2xsLnBvbGxfc2V0dGluZ3MsXG4gICAgICBjcmVhdGVkX2F0OiBwb2xsLmNyZWF0ZWRfYXRcbiAgICB9IDogbnVsbDtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihzYW5pdGl6ZWRQb2xsKTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGRldkxvZygnRXJyb3IgaW4gcG9sbHMgQVBJOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkdFVCIsIlBPU1QiLCJkeW5hbWljIiwicmVxdWVzdCIsImNvbnNvbGUiLCJsb2ciLCJzdXBhYmFzZUNsaWVudCIsImdldFN1cGFiYXNlU2VydmVyQ2xpZW50IiwiTmV4dFJlc3BvbnNlIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwibGltaXQiLCJwYXJzZUludCIsImdldCIsIl9zdGF0dXMiLCJwb2xscyIsImRldkxvZyIsImRhdGEiLCJkaXJlY3RQb2xscyIsImRpcmVjdEVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibGVuZ3RoIiwibWFwIiwicG9sbCIsImlkIiwidGl0bGUiLCJ0b3RhbF92b3RlcyIsImFnZ3JlZ2F0ZWRfcmVzdWx0cyIsIkFycmF5IiwiaXNBcnJheSIsIm9wdGlvbnMiLCJyZWR1Y2UiLCJhY2MiLCJvcHRpb24iLCJpbmRleCIsInZvdGVzIiwiZmFsbGJhY2tFcnJvciIsInNhbml0aXplZFBvbGxzIiwicG9sbF9pZCIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzdWNjZXNzIiwiY291bnQiLCJtZXNzYWdlIiwiZGV0YWlscyIsIkVycm9yIiwiU3RyaW5nIiwic3RhY2siLCJ1bmRlZmluZWQiLCJzdXBhYmFzZSIsInVzZXIiLCJnZXRVc2VyIiwidXNlclByb2ZpbGUiLCJzaW5nbGUiLCJpc19hY3RpdmUiLCJib2R5Iiwidm90aW5nTWV0aG9kIiwiZGVzY3JpcHRpb24iLCJjYXRlZ29yeSIsInByaXZhY3lMZXZlbCIsImFsbG93TXVsdGlwbGVWb3RlcyIsInNob3dSZXN1bHRzIiwiYWxsb3dDb21tZW50cyIsImVuZFRpbWUiLCJoYXNodGFncyIsInByaW1hcnlIYXNodGFnIiwic2FuaXRpemVkT3B0aW9ucyIsImZpbHRlciIsInRyaW0iLCJzbGljZSIsInBvbGxFcnJvciIsImluc2VydCIsInZvdGluZ19tZXRob2QiLCJwcml2YWN5X2xldmVsIiwiY3JlYXRlZF9ieSIsInBhcnRpY2lwYXRpb24iLCJlbmRfdGltZSIsInByaW1hcnlfaGFzaHRhZyIsInBvbGxfc2V0dGluZ3MiLCJzYW5pdGl6ZWRQb2xsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQXlCc0JBLEdBQUc7ZUFBSEE7O0lBc0ZBQyxJQUFJO2VBQUpBOztJQXhHVEMsT0FBTztlQUFQQTs7O3dCQU5nQjs0QkFFTDt3QkFDRDt5QkFDaUI7QUFFakMsTUFBTUEsVUFBVTtBQWtCaEIsZUFBZUYsSUFBSUcsT0FBb0I7SUFDNUMsSUFBSTtRQUNGQyxRQUFRQyxHQUFHLENBQUM7UUFDWixNQUFN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
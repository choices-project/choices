3829c93824e3233367af166343a483a0
/**
 * Minimal Login Route Test
 */ "use strict";
// Mock all dependencies with minimal setup
jest.mock("@/utils/supabase/server", ()=>({
        getSupabaseServerClient: jest.fn()
    }));
jest.mock("@/lib/utils/logger", ()=>({
        logger: {
            info: jest.fn(),
            error: jest.fn(),
            warn: jest.fn()
        }
    }));
jest.mock("@/lib/core/security/rate-limit", ()=>({
        rateLimiters: {
            auth: {
                check: jest.fn().mockResolvedValue({
                    allowed: true
                })
            }
        }
    }));
jest.mock("@/app/api/auth/_shared", ()=>({
        validateCsrfProtection: jest.fn().mockReturnValue(true),
        createCsrfErrorResponse: jest.fn().mockReturnValue(new Response(JSON.stringify({
            error: "CSRF token validation failed"
        }), {
            status: 403
        }))
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _server = require("next/server");
const _route = require("../../../../../app/api/auth/login/route");
describe("Minimal Login Route", ()=>{
    it("should return a response", async ()=>{
        const { getSupabaseServerClient } = require("@/utils/supabase/server");
        // Mock Supabase client to return a simple response
        getSupabaseServerClient.mockResolvedValue({
            auth: {
                signInWithPassword: jest.fn().mockResolvedValue({
                    data: {
                        user: {
                            id: "user-123",
                            email: "test@example.com"
                        },
                        session: {
                            access_token: "token"
                        }
                    },
                    error: null
                })
            },
            from: jest.fn(()=>({
                    select: jest.fn(()=>({
                            eq: jest.fn(()=>({
                                    single: jest.fn().mockResolvedValue({
                                        data: {
                                            id: "user-123",
                                            is_active: true,
                                            username: "testuser"
                                        },
                                        error: null
                                    })
                                }))
                        }))
                }))
        });
        const request = new _server.NextRequest("http://localhost:3000/api/auth/login", {
            method: "POST",
            body: JSON.stringify({
                email: "test@example.com",
                password: "password123"
            }),
            headers: {
                "Content-Type": "application/json"
            }
        });
        const response = await (0, _route.POST)(request);
        expect(response).toBeDefined();
        expect(response).toBeInstanceOf(Response);
        expect(response.status).toBe(200);
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvYXBpL2F1dGgvbWluaW1hbC1sb2dpbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWluaW1hbCBMb2dpbiBSb3V0ZSBUZXN0XG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBQT1NUIH0gZnJvbSAnQC9hcHAvYXBpL2F1dGgvbG9naW4vcm91dGUnO1xuXG4vLyBNb2NrIGFsbCBkZXBlbmRlbmNpZXMgd2l0aCBtaW5pbWFsIHNldHVwXG5qZXN0Lm1vY2soJ0AvdXRpbHMvc3VwYWJhc2Uvc2VydmVyJywgKCkgPT4gKHtcbiAgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQ6IGplc3QuZm4oKSxcbn0pKTtcblxuamVzdC5tb2NrKCdAL2xpYi91dGlscy9sb2dnZXInLCAoKSA9PiAoe1xuICBsb2dnZXI6IHtcbiAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICB3YXJuOiBqZXN0LmZuKCksXG4gIH0sXG59KSk7XG5cbmplc3QubW9jaygnQC9saWIvY29yZS9zZWN1cml0eS9yYXRlLWxpbWl0JywgKCkgPT4gKHtcbiAgcmF0ZUxpbWl0ZXJzOiB7XG4gICAgYXV0aDoge1xuICAgICAgY2hlY2s6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFsbG93ZWQ6IHRydWUgfSlcbiAgICB9XG4gIH1cbn0pKTtcblxuamVzdC5tb2NrKCdAL2FwcC9hcGkvYXV0aC9fc2hhcmVkJywgKCkgPT4gKHtcbiAgdmFsaWRhdGVDc3JmUHJvdGVjdGlvbjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgY3JlYXRlQ3NyZkVycm9yUmVzcG9uc2U6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoXG4gICAgbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHsgZXJyb3I6ICdDU1JGIHRva2VuIHZhbGlkYXRpb24gZmFpbGVkJyB9KSwgeyBzdGF0dXM6IDQwMyB9KVxuICApXG59KSk7XG5cbmRlc2NyaWJlKCdNaW5pbWFsIExvZ2luIFJvdXRlJywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIHJldHVybiBhIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQgfSA9IHJlcXVpcmUoJ0AvdXRpbHMvc3VwYWJhc2Uvc2VydmVyJyk7XG4gICAgXG4gICAgLy8gTW9jayBTdXBhYmFzZSBjbGllbnQgdG8gcmV0dXJuIGEgc2ltcGxlIHJlc3BvbnNlXG4gICAgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgYXV0aDoge1xuICAgICAgICBzaWduSW5XaXRoUGFzc3dvcmQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcjogeyBpZDogJ3VzZXItMTIzJywgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyB9LFxuICAgICAgICAgICAgc2Vzc2lvbjogeyBhY2Nlc3NfdG9rZW46ICd0b2tlbicgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pLFxuICAgICAgfSxcbiAgICAgIGZyb206IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YTogeyBpZDogJ3VzZXItMTIzJywgaXNfYWN0aXZlOiB0cnVlLCB1c2VybmFtZTogJ3Rlc3R1c2VyJyB9LFxuICAgICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pKSxcbiAgICAgICAgfSkpLFxuICAgICAgfSkpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBOZXh0UmVxdWVzdCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL2xvZ2luJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLFxuICAgICAgfSksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQT1NUKHJlcXVlc3QpO1xuICAgIFxuICAgIGV4cGVjdChyZXNwb25zZSkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvQmVJbnN0YW5jZU9mKFJlc3BvbnNlKTtcbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJnZXRTdXBhYmFzZVNlcnZlckNsaWVudCIsImZuIiwibG9nZ2VyIiwiaW5mbyIsImVycm9yIiwid2FybiIsInJhdGVMaW1pdGVycyIsImF1dGgiLCJjaGVjayIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiYWxsb3dlZCIsInZhbGlkYXRlQ3NyZlByb3RlY3Rpb24iLCJtb2NrUmV0dXJuVmFsdWUiLCJjcmVhdGVDc3JmRXJyb3JSZXNwb25zZSIsIlJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsInN0YXR1cyIsImRlc2NyaWJlIiwiaXQiLCJyZXF1aXJlIiwic2lnbkluV2l0aFBhc3N3b3JkIiwiZGF0YSIsInVzZXIiLCJpZCIsImVtYWlsIiwic2Vzc2lvbiIsImFjY2Vzc190b2tlbiIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsImlzX2FjdGl2ZSIsInVzZXJuYW1lIiwicmVxdWVzdCIsIk5leHRSZXF1ZXN0IiwibWV0aG9kIiwiYm9keSIsInBhc3N3b3JkIiwiaGVhZGVycyIsInJlc3BvbnNlIiwiUE9TVCIsImV4cGVjdCIsInRvQmVEZWZpbmVkIiwidG9CZUluc3RhbmNlT2YiLCJ0b0JlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Q0FFQztBQUtELDJDQUEyQztBQUMzQ0EsS0FBS0MsSUFBSSxDQUFDLDJCQUEyQixJQUFPLENBQUE7UUFDMUNDLHlCQUF5QkYsS0FBS0csRUFBRTtJQUNsQyxDQUFBO0FBRUFILEtBQUtDLElBQUksQ0FBQyxzQkFBc0IsSUFBTyxDQUFBO1FBQ3JDRyxRQUFRO1lBQ05DLE1BQU1MLEtBQUtHLEVBQUU7WUFDYkcsT0FBT04sS0FBS0csRUFBRTtZQUNkSSxNQUFNUCxLQUFLRyxFQUFFO1FBQ2Y7SUFDRixDQUFBO0FBRUFILEtBQUtDLElBQUksQ0FBQyxrQ0FBa0MsSUFBTyxDQUFBO1FBQ2pETyxjQUFjO1lBQ1pDLE1BQU07Z0JBQ0pDLE9BQU9WLEtBQUtHLEVBQUUsR0FBR1EsaUJBQWlCLENBQUM7b0JBQUVDLFNBQVM7Z0JBQUs7WUFDckQ7UUFDRjtJQUNGLENBQUE7QUFFQVosS0FBS0MsSUFBSSxDQUFDLDBCQUEwQixJQUFPLENBQUE7UUFDekNZLHdCQUF3QmIsS0FBS0csRUFBRSxHQUFHVyxlQUFlLENBQUM7UUFDbERDLHlCQUF5QmYsS0FBS0csRUFBRSxHQUFHVyxlQUFlLENBQ2hELElBQUlFLFNBQVNDLEtBQUtDLFNBQVMsQ0FBQztZQUFFWixPQUFPO1FBQStCLElBQUk7WUFBRWEsUUFBUTtRQUFJO0lBRTFGLENBQUE7Ozs7d0JBN0I0Qjt1QkFDUDtBQThCckJDLFNBQVMsdUJBQXVCO0lBQzlCQyxHQUFHLDRCQUE0QjtRQUM3QixNQUFNLEVBQUVuQix1QkFBdUIsRUFBRSxHQUFHb0IsUUFBUTtRQUU1QyxtREFBbUQ7UUFDbkRwQix3QkFBd0JTLGlCQUFpQixDQUFDO1lBQ3hDRixNQUFNO2dCQUNKYyxvQkFBb0J2QixLQUFLRyxFQUFFLEdBQUdRLGlCQUFpQixDQUFDO29CQUM5Q2EsTUFBTTt3QkFDSkMsTUFBTTs0QkFBRUMsSUFBSTs0QkFBWUMsT0FBTzt3QkFBbUI7d0JBQ2xEQyxTQUFTOzRCQUFFQyxjQUFjO3dCQUFRO29CQUNuQztvQkFDQXZCLE9BQU87Z0JBQ1Q7WUFDRjtZQUNBd0IsTUFBTTlCLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7b0JBQ25CNEIsUUFBUS9CLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7NEJBQ3JCNkIsSUFBSWhDLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7b0NBQ2pCOEIsUUFBUWpDLEtBQUtHLEVBQUUsR0FBR1EsaUJBQWlCLENBQUM7d0NBQ2xDYSxNQUFNOzRDQUFFRSxJQUFJOzRDQUFZUSxXQUFXOzRDQUFNQyxVQUFVO3dDQUFXO3dDQUM5RDdCLE9BQU87b0NBQ1Q7Z0NBQ0YsQ0FBQTt3QkFDRixDQUFBO2dCQUNGLENBQUE7UUFDRjtRQUVBLE1BQU04QixVQUFVLElBQUlDLG1CQUFXLENBQUMsd0NBQXdDO1lBQ3RFQyxRQUFRO1lBQ1JDLE1BQU10QixLQUFLQyxTQUFTLENBQUM7Z0JBQ25CUyxPQUFPO2dCQUNQYSxVQUFVO1lBQ1o7WUFDQUMsU0FBUztnQkFDUCxnQkFBZ0I7WUFDbEI7UUFDRjtRQUVBLE1BQU1DLFdBQVcsTUFBTUMsSUFBQUEsV0FBSSxFQUFDUDtRQUU1QlEsT0FBT0YsVUFBVUcsV0FBVztRQUM1QkQsT0FBT0YsVUFBVUksY0FBYyxDQUFDOUI7UUFDaEM0QixPQUFPRixTQUFTdkIsTUFBTSxFQUFFNEIsSUFBSSxDQUFDO0lBQy9CO0FBQ0YifQ==
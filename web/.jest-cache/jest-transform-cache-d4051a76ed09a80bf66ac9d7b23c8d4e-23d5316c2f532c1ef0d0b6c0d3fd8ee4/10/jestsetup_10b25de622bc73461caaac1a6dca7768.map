{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/jest.setup.js"],"sourcesContent":["// Set up test environment variables FIRST, before any other imports\nprocess.env.NODE_ENV = 'test';\n\n// Mock browser APIs for PWA testing - ONLY in jsdom environment\nif (typeof window !== 'undefined') {\n  Object.defineProperty(window, 'matchMedia', {\n    writable: true,\n    value: jest.fn().mockImplementation(query => ({\n      matches: false,\n      media: query,\n      onchange: null,\n      addListener: jest.fn(),\n      removeListener: jest.fn(),\n      addEventListener: jest.fn(),\n      removeEventListener: jest.fn(),\n      dispatchEvent: jest.fn(),\n    })),\n  });\n\n  Object.defineProperty(navigator, 'onLine', {\n    writable: true,\n    value: true,\n  });\n\n  Object.defineProperty(navigator, 'serviceWorker', {\n    writable: true,\n    value: {\n      register: jest.fn(),\n      ready: Promise.resolve(),\n      getRegistration: jest.fn(),\n      getRegistrations: jest.fn(),\n    },\n  });\n\n  Object.defineProperty(window, 'PushManager', {\n    writable: true,\n    value: jest.fn(),\n  });\n\n  Object.defineProperty(window, 'Notification', {\n    writable: true,\n    value: jest.fn().mockImplementation(() => ({\n      close: jest.fn(),\n    })),\n  });\n\n  // Mock Notification.requestPermission as a static method\n  Object.defineProperty(window.Notification, 'requestPermission', {\n    writable: true,\n    value: jest.fn().mockResolvedValue('granted'),\n  });\n\n  // Mock Notification.permission property\n  Object.defineProperty(window.Notification, 'permission', {\n    writable: true,\n    value: 'granted',\n  });\n}\n\n// Import testing library matchers\nrequire('@testing-library/jest-dom');\n\n// Use real Supabase configuration for testing\n// These should be set in your actual environment\n// If not set, we'll use the values from .env.local\nif (!process.env.NEXT_PUBLIC_SUPABASE_URL) {\n  console.warn('NEXT_PUBLIC_SUPABASE_URL not set - using placeholder');\n  process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://your-project.supabase.co';\n}\nif (!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n  console.warn('NEXT_PUBLIC_SUPABASE_ANON_KEY not set - using placeholder');\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'your-anon-key';\n}\nif (!process.env.SUPABASE_SERVICE_ROLE_KEY) {\n  console.warn('SUPABASE_SERVICE_ROLE_KEY not set - using placeholder');\n  process.env.SUPABASE_SERVICE_ROLE_KEY = 'your-service-role-key';\n}\nif (!process.env.SUPABASE_SECRET_KEY) {\n  console.warn('SUPABASE_SECRET_KEY not set - using placeholder');\n  process.env.SUPABASE_SECRET_KEY = 'your-secret-key';\n}\nprocess.env.NEXTAUTH_SECRET = 'test-secret';\nprocess.env.NEXTAUTH_URL = 'http://localhost:3000';\n\n// Set up privacy pepper environment variables for testing\nprocess.env.PRIVACY_PEPPER_DEV = 'dev-pepper-consistent-for-testing-12345678901234567890';\nprocess.env.PRIVACY_PEPPER_CURRENT = 'hex:' + 'ab'.repeat(32);\n\n// Polyfill for Web APIs in Node.js environment\nif (typeof global.TextEncoder === 'undefined') {\n  const { TextEncoder, TextDecoder } = require('util');\n  global.TextEncoder = TextEncoder;\n  global.TextDecoder = TextDecoder;\n}\n\n// Simple Request polyfill for testing\nif (typeof global.Request === 'undefined') {\n  global.Request = class Request {\n    constructor(url, options = {}) {\n      // Use Object.defineProperty to make url read-only like the real Request\n      Object.defineProperty(this, 'url', {\n        value: url,\n        writable: false,\n        enumerable: true,\n        configurable: false\n      });\n      this.method = options.method || 'GET';\n      this.headers = new Map();\n      if (options.headers) {\n        Object.entries(options.headers).forEach(([key, value]) => {\n          this.headers.set(key.toLowerCase(), value);\n        });\n      }\n      this.body = options.body;\n    }\n    \n    async json() {\n      return JSON.parse(this.body || '{}');\n    }\n  };\n}\n\n// Simple Response polyfill for testing\nif (typeof global.Response === 'undefined') {\n  global.Response = class Response {\n    constructor(body, options = {}) {\n      this.body = body;\n      this.status = options.status || 200;\n      this.statusText = options.statusText || 'OK';\n      this.headers = new Map();\n      if (options.headers) {\n        Object.entries(options.headers).forEach(([key, value]) => {\n          this.headers.set(key.toLowerCase(), value);\n        });\n      }\n    }\n    \n    async json() {\n      return JSON.parse(this.body || '{}');\n    }\n    \n    async text() {\n      return this.body || '';\n    }\n    \n    async blob() {\n      return new Blob([this.body || '']);\n    }\n    \n    async arrayBuffer() {\n      const buffer = Buffer.from(this.body || '');\n      return buffer.buffer.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength);\n    }\n    \n    async formData() {\n      return new FormData();\n    }\n    \n    // Add static json method for Next.js compatibility\n    static json(data, options = {}) {\n      return new Response(JSON.stringify(data), {\n        ...options,\n        headers: {\n          'Content-Type': 'application/json',\n          ...options.headers\n        }\n      });\n    }\n  };\n}\n\n// Simple Headers polyfill for testing\nif (typeof global.Headers === 'undefined') {\n  global.Headers = class Headers {\n    constructor(init = {}) {\n      this.map = new Map();\n      if (init) {\n        Object.entries(init).forEach(([key, value]) => {\n          this.map.set(key.toLowerCase(), value);\n        });\n      }\n    }\n\n    get(name) {\n      return this.map.get(name.toLowerCase());\n    }\n\n    set(name, value) {\n      this.map.set(name.toLowerCase(), value);\n    }\n\n    has(name) {\n      return this.map.has(name.toLowerCase());\n    }\n  };\n}\n\n// Enhanced fetch polyfill for testing with Supabase support\nif (typeof global.fetch === 'undefined') {\n  global.fetch = async (url, options = {}) => {\n    // Mock fetch for testing - handle Supabase requests properly\n    let responseBody = JSON.stringify([]);\n    \n    // Handle different types of requests\n    if (url.includes('polls') && options.method !== 'POST') {\n      // Return mock polls data\n      responseBody = JSON.stringify([\n        { id: 'poll-1', title: 'Test Poll 1', status: 'active' },\n        { id: 'poll-2', title: 'Test Poll 2', status: 'active' }\n      ]);\n    } else if (url.includes('nonexistent_table')) {\n      // Return error for nonexistent table\n      return new Response(JSON.stringify({\n        code: 'PGRST116',\n        message: 'relation \"nonexistent_table\" does not exist',\n        details: null,\n        hint: null\n      }), {\n        status: 400,\n        statusText: 'Bad Request',\n        headers: new Headers({ 'Content-Type': 'application/json' })\n      });\n    }\n    \n    return new Response(responseBody, {\n      status: 200,\n      statusText: 'OK',\n      headers: new Headers({ \n        'Content-Type': 'application/json',\n        'Content-Range': '0-1/2'\n      })\n    });\n  };\n}\n\n// lucide-react is mocked via moduleNameMapper in jest.config.js\n"],"names":["process","env","NODE_ENV","window","Object","defineProperty","writable","value","jest","fn","mockImplementation","query","matches","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent","navigator","register","ready","Promise","resolve","getRegistration","getRegistrations","close","Notification","mockResolvedValue","require","NEXT_PUBLIC_SUPABASE_URL","console","warn","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_SERVICE_ROLE_KEY","SUPABASE_SECRET_KEY","NEXTAUTH_SECRET","NEXTAUTH_URL","PRIVACY_PEPPER_DEV","PRIVACY_PEPPER_CURRENT","repeat","global","TextEncoder","TextDecoder","Request","constructor","url","options","enumerable","configurable","method","headers","Map","entries","forEach","key","set","toLowerCase","body","json","JSON","parse","Response","status","statusText","text","blob","Blob","arrayBuffer","buffer","Buffer","from","slice","byteOffset","byteLength","formData","FormData","data","stringify","Headers","init","map","get","name","has","fetch","responseBody","includes","id","title","code","message","details","hint"],"mappings":"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"}
250571c7868d69f781ec9db2761814c8
// Set up test environment variables FIRST, before any other imports
"use strict";
process.env.NODE_ENV = "test";
// Mock browser APIs for PWA testing - ONLY in jsdom environment
if (typeof window !== "undefined") {
    Object.defineProperty(window, "matchMedia", {
        writable: true,
        value: jest.fn().mockImplementation((query)=>({
                matches: false,
                media: query,
                onchange: null,
                addListener: jest.fn(),
                removeListener: jest.fn(),
                addEventListener: jest.fn(),
                removeEventListener: jest.fn(),
                dispatchEvent: jest.fn()
            }))
    });
    Object.defineProperty(navigator, "onLine", {
        writable: true,
        value: true
    });
    Object.defineProperty(navigator, "serviceWorker", {
        writable: true,
        value: {
            register: jest.fn(),
            ready: Promise.resolve(),
            getRegistration: jest.fn(),
            getRegistrations: jest.fn()
        }
    });
    Object.defineProperty(window, "PushManager", {
        writable: true,
        value: jest.fn()
    });
    Object.defineProperty(window, "Notification", {
        writable: true,
        value: jest.fn().mockImplementation(()=>({
                close: jest.fn()
            }))
    });
    // Mock Notification.requestPermission as a static method
    Object.defineProperty(window.Notification, "requestPermission", {
        writable: true,
        value: jest.fn().mockResolvedValue("granted")
    });
    // Mock Notification.permission property
    Object.defineProperty(window.Notification, "permission", {
        writable: true,
        value: "granted"
    });
}
// Import testing library matchers
require("@testing-library/jest-dom");
// Use real Supabase configuration for testing
// These should be set in your actual environment
// If not set, we'll use the values from .env.local
if (!process.env.NEXT_PUBLIC_SUPABASE_URL) {
    console.warn("NEXT_PUBLIC_SUPABASE_URL not set - using placeholder");
    process.env.NEXT_PUBLIC_SUPABASE_URL = "https://your-project.supabase.co";
}
if (!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {
    console.warn("NEXT_PUBLIC_SUPABASE_ANON_KEY not set - using placeholder");
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = "your-anon-key";
}
if (!process.env.SUPABASE_SERVICE_ROLE_KEY) {
    console.warn("SUPABASE_SERVICE_ROLE_KEY not set - using placeholder");
    process.env.SUPABASE_SERVICE_ROLE_KEY = "your-service-role-key";
}
if (!process.env.SUPABASE_SECRET_KEY) {
    console.warn("SUPABASE_SECRET_KEY not set - using placeholder");
    process.env.SUPABASE_SECRET_KEY = "your-secret-key";
}
process.env.NEXTAUTH_SECRET = "test-secret";
process.env.NEXTAUTH_URL = "http://localhost:3000";
// Set up privacy pepper environment variables for testing
process.env.PRIVACY_PEPPER_DEV = "dev-pepper-consistent-for-testing-12345678901234567890";
process.env.PRIVACY_PEPPER_CURRENT = "hex:" + "ab".repeat(32);
// Polyfill for Web APIs in Node.js environment
if (typeof global.TextEncoder === "undefined") {
    const { TextEncoder, TextDecoder } = require("util");
    global.TextEncoder = TextEncoder;
    global.TextDecoder = TextDecoder;
}
// Simple Request polyfill for testing
if (typeof global.Request === "undefined") {
    global.Request = class Request {
        constructor(url, options = {}){
            // Use Object.defineProperty to make url read-only like the real Request
            Object.defineProperty(this, "url", {
                value: url,
                writable: false,
                enumerable: true,
                configurable: false
            });
            this.method = options.method || "GET";
            this.headers = new Map();
            if (options.headers) {
                Object.entries(options.headers).forEach(([key, value])=>{
                    this.headers.set(key.toLowerCase(), value);
                });
            }
            this.body = options.body;
        }
        async json() {
            return JSON.parse(this.body || "{}");
        }
    };
}
// Simple Response polyfill for testing
if (typeof global.Response === "undefined") {
    global.Response = class Response1 {
        constructor(body, options = {}){
            this.body = body;
            this.status = options.status || 200;
            this.statusText = options.statusText || "OK";
            this.headers = new Map();
            if (options.headers) {
                Object.entries(options.headers).forEach(([key, value])=>{
                    this.headers.set(key.toLowerCase(), value);
                });
            }
        }
        async json() {
            return JSON.parse(this.body || "{}");
        }
        async text() {
            return this.body || "";
        }
        async blob() {
            return new Blob([
                this.body || ""
            ]);
        }
        async arrayBuffer() {
            const buffer = Buffer.from(this.body || "");
            return buffer.buffer.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength);
        }
        async formData() {
            return new FormData();
        }
        // Add static json method for Next.js compatibility
        static json(data, options = {}) {
            return new Response1(JSON.stringify(data), {
                ...options,
                headers: {
                    "Content-Type": "application/json",
                    ...options.headers
                }
            });
        }
    };
}
// Simple Headers polyfill for testing
if (typeof global.Headers === "undefined") {
    global.Headers = class Headers1 {
        constructor(init = {}){
            this.map = new Map();
            if (init) {
                Object.entries(init).forEach(([key, value])=>{
                    this.map.set(key.toLowerCase(), value);
                });
            }
        }
        get(name) {
            return this.map.get(name.toLowerCase());
        }
        set(name, value) {
            this.map.set(name.toLowerCase(), value);
        }
        has(name) {
            return this.map.has(name.toLowerCase());
        }
    };
}
// Enhanced fetch polyfill for testing with Supabase support
if (typeof global.fetch === "undefined") {
    global.fetch = async (url, options = {})=>{
        // Mock fetch for testing - handle Supabase requests properly
        let responseBody = JSON.stringify([]);
        // Handle different types of requests
        if (url.includes("polls") && options.method !== "POST") {
            // Return mock polls data
            responseBody = JSON.stringify([
                {
                    id: "poll-1",
                    title: "Test Poll 1",
                    status: "active"
                },
                {
                    id: "poll-2",
                    title: "Test Poll 2",
                    status: "active"
                }
            ]);
        } else if (url.includes("nonexistent_table")) {
            // Return error for nonexistent table
            return new Response(JSON.stringify({
                code: "PGRST116",
                message: 'relation "nonexistent_table" does not exist',
                details: null,
                hint: null
            }), {
                status: 400,
                statusText: "Bad Request",
                headers: new Headers({
                    "Content-Type": "application/json"
                })
            });
        }
        return new Response(responseBody, {
            status: 200,
            statusText: "OK",
            headers: new Headers({
                "Content-Type": "application/json",
                "Content-Range": "0-1/2"
            })
        });
    };
} // lucide-react is mocked via moduleNameMapper in jest.config.js

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9qZXN0LnNldHVwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNldCB1cCB0ZXN0IGVudmlyb25tZW50IHZhcmlhYmxlcyBGSVJTVCwgYmVmb3JlIGFueSBvdGhlciBpbXBvcnRzXG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcblxuLy8gTW9jayBicm93c2VyIEFQSXMgZm9yIFBXQSB0ZXN0aW5nIC0gT05MWSBpbiBqc2RvbSBlbnZpcm9ubWVudFxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdtYXRjaE1lZGlhJywge1xuICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgIHZhbHVlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKHF1ZXJ5ID0+ICh7XG4gICAgICBtYXRjaGVzOiBmYWxzZSxcbiAgICAgIG1lZGlhOiBxdWVyeSxcbiAgICAgIG9uY2hhbmdlOiBudWxsLFxuICAgICAgYWRkTGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgICAgIHJlbW92ZUxpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgICBhZGRFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgICBkaXNwYXRjaEV2ZW50OiBqZXN0LmZuKCksXG4gICAgfSkpLFxuICB9KTtcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmF2aWdhdG9yLCAnb25MaW5lJywge1xuICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgIHZhbHVlOiB0cnVlLFxuICB9KTtcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmF2aWdhdG9yLCAnc2VydmljZVdvcmtlcicsIHtcbiAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICB2YWx1ZToge1xuICAgICAgcmVnaXN0ZXI6IGplc3QuZm4oKSxcbiAgICAgIHJlYWR5OiBQcm9taXNlLnJlc29sdmUoKSxcbiAgICAgIGdldFJlZ2lzdHJhdGlvbjogamVzdC5mbigpLFxuICAgICAgZ2V0UmVnaXN0cmF0aW9uczogamVzdC5mbigpLFxuICAgIH0sXG4gIH0pO1xuXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdQdXNoTWFuYWdlcicsIHtcbiAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICB2YWx1ZTogamVzdC5mbigpLFxuICB9KTtcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnTm90aWZpY2F0aW9uJywge1xuICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgIHZhbHVlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBjbG9zZTogamVzdC5mbigpLFxuICAgIH0pKSxcbiAgfSk7XG5cbiAgLy8gTW9jayBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24gYXMgYSBzdGF0aWMgbWV0aG9kXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuTm90aWZpY2F0aW9uLCAncmVxdWVzdFBlcm1pc3Npb24nLCB7XG4gICAgd3JpdGFibGU6IHRydWUsXG4gICAgdmFsdWU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZ3JhbnRlZCcpLFxuICB9KTtcblxuICAvLyBNb2NrIE5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uIHByb3BlcnR5XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuTm90aWZpY2F0aW9uLCAncGVybWlzc2lvbicsIHtcbiAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICB2YWx1ZTogJ2dyYW50ZWQnLFxuICB9KTtcbn1cblxuLy8gSW1wb3J0IHRlc3RpbmcgbGlicmFyeSBtYXRjaGVyc1xucmVxdWlyZSgnQHRlc3RpbmctbGlicmFyeS9qZXN0LWRvbScpO1xuXG4vLyBVc2UgcmVhbCBTdXBhYmFzZSBjb25maWd1cmF0aW9uIGZvciB0ZXN0aW5nXG4vLyBUaGVzZSBzaG91bGQgYmUgc2V0IGluIHlvdXIgYWN0dWFsIGVudmlyb25tZW50XG4vLyBJZiBub3Qgc2V0LCB3ZSdsbCB1c2UgdGhlIHZhbHVlcyBmcm9tIC5lbnYubG9jYWxcbmlmICghcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMKSB7XG4gIGNvbnNvbGUud2FybignTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIG5vdCBzZXQgLSB1c2luZyBwbGFjZWhvbGRlcicpO1xuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgPSAnaHR0cHM6Ly95b3VyLXByb2plY3Quc3VwYWJhc2UuY28nO1xufVxuaWYgKCFwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSkge1xuICBjb25zb2xlLndhcm4oJ05FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIG5vdCBzZXQgLSB1c2luZyBwbGFjZWhvbGRlcicpO1xuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSA9ICd5b3VyLWFub24ta2V5Jztcbn1cbmlmICghcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSkge1xuICBjb25zb2xlLndhcm4oJ1NVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgbm90IHNldCAtIHVzaW5nIHBsYWNlaG9sZGVyJyk7XG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgPSAneW91ci1zZXJ2aWNlLXJvbGUta2V5Jztcbn1cbmlmICghcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VDUkVUX0tFWSkge1xuICBjb25zb2xlLndhcm4oJ1NVUEFCQVNFX1NFQ1JFVF9LRVkgbm90IHNldCAtIHVzaW5nIHBsYWNlaG9sZGVyJyk7XG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFQ1JFVF9LRVkgPSAneW91ci1zZWNyZXQta2V5Jztcbn1cbnByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCA9ICd0ZXN0LXNlY3JldCc7XG5wcm9jZXNzLmVudi5ORVhUQVVUSF9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcblxuLy8gU2V0IHVwIHByaXZhY3kgcGVwcGVyIGVudmlyb25tZW50IHZhcmlhYmxlcyBmb3IgdGVzdGluZ1xucHJvY2Vzcy5lbnYuUFJJVkFDWV9QRVBQRVJfREVWID0gJ2Rldi1wZXBwZXItY29uc2lzdGVudC1mb3ItdGVzdGluZy0xMjM0NTY3ODkwMTIzNDU2Nzg5MCc7XG5wcm9jZXNzLmVudi5QUklWQUNZX1BFUFBFUl9DVVJSRU5UID0gJ2hleDonICsgJ2FiJy5yZXBlYXQoMzIpO1xuXG4vLyBQb2x5ZmlsbCBmb3IgV2ViIEFQSXMgaW4gTm9kZS5qcyBlbnZpcm9ubWVudFxuaWYgKHR5cGVvZiBnbG9iYWwuVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gIGNvbnN0IHsgVGV4dEVuY29kZXIsIFRleHREZWNvZGVyIH0gPSByZXF1aXJlKCd1dGlsJyk7XG4gIGdsb2JhbC5UZXh0RW5jb2RlciA9IFRleHRFbmNvZGVyO1xuICBnbG9iYWwuVGV4dERlY29kZXIgPSBUZXh0RGVjb2Rlcjtcbn1cblxuLy8gU2ltcGxlIFJlcXVlc3QgcG9seWZpbGwgZm9yIHRlc3RpbmdcbmlmICh0eXBlb2YgZ2xvYmFsLlJlcXVlc3QgPT09ICd1bmRlZmluZWQnKSB7XG4gIGdsb2JhbC5SZXF1ZXN0ID0gY2xhc3MgUmVxdWVzdCB7XG4gICAgY29uc3RydWN0b3IodXJsLCBvcHRpb25zID0ge30pIHtcbiAgICAgIC8vIFVzZSBPYmplY3QuZGVmaW5lUHJvcGVydHkgdG8gbWFrZSB1cmwgcmVhZC1vbmx5IGxpa2UgdGhlIHJlYWwgUmVxdWVzdFxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICd1cmwnLCB7XG4gICAgICAgIHZhbHVlOiB1cmwsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICB0aGlzLm1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8ICdHRVQnO1xuICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IE1hcCgpO1xuICAgICAgaWYgKG9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICBPYmplY3QuZW50cmllcyhvcHRpb25zLmhlYWRlcnMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoa2V5LnRvTG93ZXJDYXNlKCksIHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLmJvZHkgPSBvcHRpb25zLmJvZHk7XG4gICAgfVxuICAgIFxuICAgIGFzeW5jIGpzb24oKSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLmJvZHkgfHwgJ3t9Jyk7XG4gICAgfVxuICB9O1xufVxuXG4vLyBTaW1wbGUgUmVzcG9uc2UgcG9seWZpbGwgZm9yIHRlc3RpbmdcbmlmICh0eXBlb2YgZ2xvYmFsLlJlc3BvbnNlID09PSAndW5kZWZpbmVkJykge1xuICBnbG9iYWwuUmVzcG9uc2UgPSBjbGFzcyBSZXNwb25zZSB7XG4gICAgY29uc3RydWN0b3IoYm9keSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICB0aGlzLmJvZHkgPSBib2R5O1xuICAgICAgdGhpcy5zdGF0dXMgPSBvcHRpb25zLnN0YXR1cyB8fCAyMDA7XG4gICAgICB0aGlzLnN0YXR1c1RleHQgPSBvcHRpb25zLnN0YXR1c1RleHQgfHwgJ09LJztcbiAgICAgIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAoKTtcbiAgICAgIGlmIChvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMob3B0aW9ucy5oZWFkZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KGtleS50b0xvd2VyQ2FzZSgpLCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBhc3luYyBqc29uKCkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5ib2R5IHx8ICd7fScpO1xuICAgIH1cbiAgICBcbiAgICBhc3luYyB0ZXh0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuYm9keSB8fCAnJztcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgYmxvYigpIHtcbiAgICAgIHJldHVybiBuZXcgQmxvYihbdGhpcy5ib2R5IHx8ICcnXSk7XG4gICAgfVxuICAgIFxuICAgIGFzeW5jIGFycmF5QnVmZmVyKCkge1xuICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20odGhpcy5ib2R5IHx8ICcnKTtcbiAgICAgIHJldHVybiBidWZmZXIuYnVmZmVyLnNsaWNlKGJ1ZmZlci5ieXRlT2Zmc2V0LCBidWZmZXIuYnl0ZU9mZnNldCArIGJ1ZmZlci5ieXRlTGVuZ3RoKTtcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgZm9ybURhdGEoKSB7XG4gICAgICByZXR1cm4gbmV3IEZvcm1EYXRhKCk7XG4gICAgfVxuICAgIFxuICAgIC8vIEFkZCBzdGF0aWMganNvbiBtZXRob2QgZm9yIE5leHQuanMgY29tcGF0aWJpbGl0eVxuICAgIHN0YXRpYyBqc29uKGRhdGEsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShkYXRhKSwge1xuICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAuLi5vcHRpb25zLmhlYWRlcnNcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xufVxuXG4vLyBTaW1wbGUgSGVhZGVycyBwb2x5ZmlsbCBmb3IgdGVzdGluZ1xuaWYgKHR5cGVvZiBnbG9iYWwuSGVhZGVycyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgZ2xvYmFsLkhlYWRlcnMgPSBjbGFzcyBIZWFkZXJzIHtcbiAgICBjb25zdHJ1Y3Rvcihpbml0ID0ge30pIHtcbiAgICAgIHRoaXMubWFwID0gbmV3IE1hcCgpO1xuICAgICAgaWYgKGluaXQpIHtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoaW5pdCkuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgdGhpcy5tYXAuc2V0KGtleS50b0xvd2VyQ2FzZSgpLCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGdldChuYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5tYXAuZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxuXG4gICAgc2V0KG5hbWUsIHZhbHVlKSB7XG4gICAgICB0aGlzLm1hcC5zZXQobmFtZS50b0xvd2VyQ2FzZSgpLCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgaGFzKG5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLm1hcC5oYXMobmFtZS50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG4gIH07XG59XG5cbi8vIEVuaGFuY2VkIGZldGNoIHBvbHlmaWxsIGZvciB0ZXN0aW5nIHdpdGggU3VwYWJhc2Ugc3VwcG9ydFxuaWYgKHR5cGVvZiBnbG9iYWwuZmV0Y2ggPT09ICd1bmRlZmluZWQnKSB7XG4gIGdsb2JhbC5mZXRjaCA9IGFzeW5jICh1cmwsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICAgIC8vIE1vY2sgZmV0Y2ggZm9yIHRlc3RpbmcgLSBoYW5kbGUgU3VwYWJhc2UgcmVxdWVzdHMgcHJvcGVybHlcbiAgICBsZXQgcmVzcG9uc2VCb2R5ID0gSlNPTi5zdHJpbmdpZnkoW10pO1xuICAgIFxuICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgdHlwZXMgb2YgcmVxdWVzdHNcbiAgICBpZiAodXJsLmluY2x1ZGVzKCdwb2xscycpICYmIG9wdGlvbnMubWV0aG9kICE9PSAnUE9TVCcpIHtcbiAgICAgIC8vIFJldHVybiBtb2NrIHBvbGxzIGRhdGFcbiAgICAgIHJlc3BvbnNlQm9keSA9IEpTT04uc3RyaW5naWZ5KFtcbiAgICAgICAgeyBpZDogJ3BvbGwtMScsIHRpdGxlOiAnVGVzdCBQb2xsIDEnLCBzdGF0dXM6ICdhY3RpdmUnIH0sXG4gICAgICAgIHsgaWQ6ICdwb2xsLTInLCB0aXRsZTogJ1Rlc3QgUG9sbCAyJywgc3RhdHVzOiAnYWN0aXZlJyB9XG4gICAgICBdKTtcbiAgICB9IGVsc2UgaWYgKHVybC5pbmNsdWRlcygnbm9uZXhpc3RlbnRfdGFibGUnKSkge1xuICAgICAgLy8gUmV0dXJuIGVycm9yIGZvciBub25leGlzdGVudCB0YWJsZVxuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGNvZGU6ICdQR1JTVDExNicsXG4gICAgICAgIG1lc3NhZ2U6ICdyZWxhdGlvbiBcIm5vbmV4aXN0ZW50X3RhYmxlXCIgZG9lcyBub3QgZXhpc3QnLFxuICAgICAgICBkZXRhaWxzOiBudWxsLFxuICAgICAgICBoaW50OiBudWxsXG4gICAgICB9KSwge1xuICAgICAgICBzdGF0dXM6IDQwMCxcbiAgICAgICAgc3RhdHVzVGV4dDogJ0JhZCBSZXF1ZXN0JyxcbiAgICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZShyZXNwb25zZUJvZHksIHtcbiAgICAgIHN0YXR1czogMjAwLFxuICAgICAgc3RhdHVzVGV4dDogJ09LJyxcbiAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHsgXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICdDb250ZW50LVJhbmdlJzogJzAtMS8yJ1xuICAgICAgfSlcbiAgICB9KTtcbiAgfTtcbn1cblxuLy8gbHVjaWRlLXJlYWN0IGlzIG1vY2tlZCB2aWEgbW9kdWxlTmFtZU1hcHBlciBpbiBqZXN0LmNvbmZpZy5qc1xuIl0sIm5hbWVzIjpbInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIndpbmRvdyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwid3JpdGFibGUiLCJ2YWx1ZSIsImplc3QiLCJmbiIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsInF1ZXJ5IiwibWF0Y2hlcyIsIm1lZGlhIiwib25jaGFuZ2UiLCJhZGRMaXN0ZW5lciIsInJlbW92ZUxpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJkaXNwYXRjaEV2ZW50IiwibmF2aWdhdG9yIiwicmVnaXN0ZXIiLCJyZWFkeSIsIlByb21pc2UiLCJyZXNvbHZlIiwiZ2V0UmVnaXN0cmF0aW9uIiwiZ2V0UmVnaXN0cmF0aW9ucyIsImNsb3NlIiwiTm90aWZpY2F0aW9uIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJyZXF1aXJlIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiY29uc29sZSIsIndhcm4iLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJTVVBBQkFTRV9TRUNSRVRfS0VZIiwiTkVYVEFVVEhfU0VDUkVUIiwiTkVYVEFVVEhfVVJMIiwiUFJJVkFDWV9QRVBQRVJfREVWIiwiUFJJVkFDWV9QRVBQRVJfQ1VSUkVOVCIsInJlcGVhdCIsImdsb2JhbCIsIlRleHRFbmNvZGVyIiwiVGV4dERlY29kZXIiLCJSZXF1ZXN0IiwiY29uc3RydWN0b3IiLCJ1cmwiLCJvcHRpb25zIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIm1ldGhvZCIsImhlYWRlcnMiLCJNYXAiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImtleSIsInNldCIsInRvTG93ZXJDYXNlIiwiYm9keSIsImpzb24iLCJKU09OIiwicGFyc2UiLCJSZXNwb25zZSIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJ0ZXh0IiwiYmxvYiIsIkJsb2IiLCJhcnJheUJ1ZmZlciIsImJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJzbGljZSIsImJ5dGVPZmZzZXQiLCJieXRlTGVuZ3RoIiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsImRhdGEiLCJzdHJpbmdpZnkiLCJIZWFkZXJzIiwiaW5pdCIsIm1hcCIsImdldCIsIm5hbWUiLCJoYXMiLCJmZXRjaCIsInJlc3BvbnNlQm9keSIsImluY2x1ZGVzIiwiaWQiLCJ0aXRsZSIsImNvZGUiLCJtZXNzYWdlIiwiZGV0YWlscyIsImhpbnQiXSwibWFwcGluZ3MiOiJBQUFBLG9FQUFvRTs7QUFDcEVBLFFBQVFDLEdBQUcsQ0FBQ0MsUUFBUSxHQUFHO0FBRXZCLGdFQUFnRTtBQUNoRSxJQUFJLE9BQU9DLFdBQVcsYUFBYTtJQUNqQ0MsT0FBT0MsY0FBYyxDQUFDRixRQUFRLGNBQWM7UUFDMUNHLFVBQVU7UUFDVkMsT0FBT0MsS0FBS0MsRUFBRSxHQUFHQyxrQkFBa0IsQ0FBQ0MsQ0FBQUEsUUFBVSxDQUFBO2dCQUM1Q0MsU0FBUztnQkFDVEMsT0FBT0Y7Z0JBQ1BHLFVBQVU7Z0JBQ1ZDLGFBQWFQLEtBQUtDLEVBQUU7Z0JBQ3BCTyxnQkFBZ0JSLEtBQUtDLEVBQUU7Z0JBQ3ZCUSxrQkFBa0JULEtBQUtDLEVBQUU7Z0JBQ3pCUyxxQkFBcUJWLEtBQUtDLEVBQUU7Z0JBQzVCVSxlQUFlWCxLQUFLQyxFQUFFO1lBQ3hCLENBQUE7SUFDRjtJQUVBTCxPQUFPQyxjQUFjLENBQUNlLFdBQVcsVUFBVTtRQUN6Q2QsVUFBVTtRQUNWQyxPQUFPO0lBQ1Q7SUFFQUgsT0FBT0MsY0FBYyxDQUFDZSxXQUFXLGlCQUFpQjtRQUNoRGQsVUFBVTtRQUNWQyxPQUFPO1lBQ0xjLFVBQVViLEtBQUtDLEVBQUU7WUFDakJhLE9BQU9DLFFBQVFDLE9BQU87WUFDdEJDLGlCQUFpQmpCLEtBQUtDLEVBQUU7WUFDeEJpQixrQkFBa0JsQixLQUFLQyxFQUFFO1FBQzNCO0lBQ0Y7SUFFQUwsT0FBT0MsY0FBYyxDQUFDRixRQUFRLGVBQWU7UUFDM0NHLFVBQVU7UUFDVkMsT0FBT0MsS0FBS0MsRUFBRTtJQUNoQjtJQUVBTCxPQUFPQyxjQUFjLENBQUNG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
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/auth/login-route-comprehensive.test.ts"],"sourcesContent":["/**\n * @jest-environment node\n */\n\nimport { NextRequest } from 'next/server';\nimport { POST } from '@/app/api/auth/login/route';\n\n// Mock Supabase server client\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(),\n}));\n\n// Import the mocked function\nimport { getSupabaseServerClient } from '@/utils/supabase/server';\n\n// Create mock Supabase client\nconst mockSupabaseClient = {\n  auth: {\n    signInWithPassword: jest.fn(),\n  },\n  from: jest.fn(() => ({\n    select: jest.fn().mockReturnThis(),\n    eq: jest.fn().mockReturnThis(),\n    single: jest.fn(),\n  })),\n};\n\n// Mock the getSupabaseServerClient function\n(getSupabaseServerClient as jest.Mock).mockImplementation(async () => mockSupabaseClient);\n\ndescribe('Auth Login Route - Real Database Testing', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Real Database Tests', () => {\n    it('should handle invalid credentials gracefully', async () => {\n      // Mock authentication failure\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: null,\n          session: null,\n        },\n        error: {\n          message: 'Invalid login credentials',\n        },\n      });\n\n      // Debug: Check if mock is set up correctly\n      console.log('Mock setup:', {\n        getSupabaseServerClient: getSupabaseServerClient,\n        mockSupabaseClient: mockSupabaseClient,\n        authMethod: mockSupabaseClient.auth.signInWithPassword\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'nonexistent@example.com',\n          password: 'wrongpassword',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n          'x-forwarded-for': '127.0.0.1',\n          'user-agent': 'test-agent',\n        },\n      });\n\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Should return 401 for invalid credentials\n      expect(response.status).toBe(401);\n      expect(data.message).toBe('Invalid email or password');\n    });\n\n    it('should validate required fields', async () => {\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          // Missing password\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n          'x-forwarded-for': '127.0.0.1',\n          'user-agent': 'test-agent',\n        },\n      });\n\n      const response = await POST(request);\n      const data = await response.json();\n\n      // Should return 400 for missing password\n      expect(response.status).toBe(400);\n      expect(data.message).toBe('Email and password are required');\n    });\n\n    it('should handle malformed JSON', async () => {\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: 'invalid json',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-forwarded-for': '127.0.0.1',\n          'user-agent': 'test-agent',\n        },\n      });\n\n      const response = await POST(request);\n      \n      // Should return 500 for malformed JSON\n      expect(response.status).toBe(500);\n    });\n\n    it('should handle user with confirmed email', async () => {\n      // Mock successful authentication with confirmed email\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock active user profile\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', data);\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      expect(data.user.email_confirmed).toBe(true);\n    });\n  });\n\n  describe('Authentication Failures', () => {\n    it('should reject invalid credentials', async () => {\n      // Mock authentication failure\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: null,\n          session: null,\n        },\n        error: {\n          message: 'Invalid login credentials',\n        },\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'wrongpassword',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Invalid login credentials');\n    });\n\n    it('should reject inactive user', async () => {\n      // Mock successful authentication but inactive user\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock inactive user profile\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: false,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(403);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Account is inactive');\n    });\n\n    it('should reject unconfirmed email', async () => {\n      // Mock successful authentication but unconfirmed email\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: null,\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock active user profile\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(403);\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Email not confirmed');\n    });\n  });\n\n  describe('Input Validation', () => {\n    it('should validate email format', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'invalid-email',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid email format');\n    });\n\n    it('should validate password strength', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: '123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Password too weak');\n    });\n\n    it('should require both email and password', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Email and password are required');\n    });\n\n    it('should sanitize email input', async () => {\n      // Mock successful authentication\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock user profile lookup\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: '  TEST@EXAMPLE.COM  ',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', data);\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n      // Should normalize email to lowercase\n      expect(mockSupabaseClient.auth.signInWithPassword).toHaveBeenCalledWith({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n    });\n  });\n\n  describe('Rate Limiting', () => {\n    it('should implement rate limiting for failed attempts', async () => {\n      // Mock authentication failure\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: null,\n          session: null,\n        },\n        error: {\n          message: 'Invalid login credentials',\n        },\n      });\n\n      // Make multiple failed attempts\n      for (let i = 0; i < 5; i++) {\n        mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n          method: 'POST',\n          body: JSON.stringify({\n            email: 'test@example.com',\n            password: 'wrongpassword',\n          }),\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n\n        const response = await POST(mockRequest);\n        \n        if (i < 4) {\n          expect(response.status).toBe(401);\n        } else {\n          // Should be rate limited after 5 attempts\n          expect(response.status).toBe(429);\n        }\n      }\n    });\n\n    it('should reset rate limit after successful login', async () => {\n      // Mock successful authentication\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock user profile lookup\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', data);\n\n      expect(response.status).toBe(200);\n      expect(data.success).toBe(true);\n    });\n  });\n\n  describe('Security', () => {\n    it('should prevent SQL injection in email field', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: \"'; DROP TABLE users; --\",\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid email format');\n    });\n\n    it('should prevent XSS in email field', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: '<script>alert(\"xss\")</script>@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid email format');\n    });\n\n    it('should log security events', async () => {\n      const { logger } = require('@/lib/utils/logger');\n      \n      // Mock authentication failure\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: null,\n          session: null,\n        },\n        error: {\n          message: 'Invalid login credentials',\n        },\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'wrongpassword',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      await POST(mockRequest);\n\n      expect(logger.warn).toHaveBeenCalledWith(\n        'Failed login attempt',\n        expect.objectContaining({\n          email: 'test@example.com',\n          ip: expect.any(String),\n        })\n      );\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle Supabase connection errors', async () => {\n      // Mock Supabase connection error\n      (getSupabaseServerClient as jest.Mock).mockRejectedValue(\n        new Error('Supabase connection failed')\n      );\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Internal server error');\n    });\n\n    it('should handle malformed JSON', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: 'invalid json',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Invalid JSON');\n    });\n\n    it('should handle missing request body', async () => {\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const response = await POST(mockRequest);\n      const data = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Request body is required');\n    });\n  });\n\n  describe('Performance', () => {\n    it('should respond within performance budget', async () => {\n      // Mock successful authentication\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: {\n          user: {\n            id: 'user-123',\n            email: 'test@example.com',\n            email_confirmed_at: new Date().toISOString(),\n          },\n          session: {\n            access_token: 'access-token',\n            refresh_token: 'refresh-token',\n          },\n        },\n        error: null,\n      });\n\n      // Mock user profile lookup\n      mockSupabaseClient.from().select().eq().single.mockResolvedValue({\n        data: {\n          id: 'user-123',\n          email: 'test@example.com',\n          display_name: 'Test User',\n          is_active: true,\n        },\n        error: null,\n      });\n\n      mockRequest = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const startTime = performance.now();\n      const response = await POST(mockRequest);\n      const endTime = performance.now();\n\n      expect(response.status).toBe(200);\n      expect(endTime - startTime).toBeLessThan(1000); // Should respond within 1 second\n    });\n  });\n});\n\n\n\n\n"],"names":["jest","mock","getSupabaseServerClient","fn","mockSupabaseClient","auth","signInWithPassword","from","select","mockReturnThis","eq","single","mockImplementation","describe","beforeEach","clearAllMocks","it","mockResolvedValue","data","user","session","error","message","console","log","authMethod","request","NextRequest","method","body","JSON","stringify","email","password","headers","response","POST","json","expect","status","toBe","id","email_confirmed_at","Date","toISOString","access_token","refresh_token","display_name","is_active","mockRequest","success","email_confirmed","toContain","toHaveBeenCalledWith","i","logger","require","warn","objectContaining","ip","any","String","mockRejectedValue","Error","startTime","performance","now","endTime","toBeLessThan"],"mappings":"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"}
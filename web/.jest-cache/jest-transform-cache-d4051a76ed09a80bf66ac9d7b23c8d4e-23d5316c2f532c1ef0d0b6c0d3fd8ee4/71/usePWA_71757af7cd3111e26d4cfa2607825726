0898cbaacf1281ca4c83ffeba196572a
/**
 * PWA Hook
 * 
 * Comprehensive hook that provides PWA functionality including
 * installation, offline status, service worker management, and notifications.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "usePWA", {
    enumerable: true,
    get: function() {
        return usePWA;
    }
});
const _react = require("react");
const _featureflags = require("../lib/core/feature-flags");
const _installation = require("../lib/pwa/installation");
const _serviceworker = require("../lib/pwa/service-worker");
const _logger = require("../lib/utils/logger");
const _objects = require("../lib/utils/objects");
function usePWA() {
    const [status, setStatus] = (0, _react.useState)({
        isSupported: typeof window !== "undefined" ? "serviceWorker" in navigator && "PushManager" in window : false,
        isEnabled: (0, _featureflags.isFeatureEnabled)("PWA"),
        installation: {
            isInstallable: false,
            isInstalled: false,
            canPrompt: false,
            platform: null,
            deferredPrompt: null
        },
        serviceWorker: {
            isSupported: typeof window !== "undefined" ? "serviceWorker" in navigator : false,
            isRegistered: false,
            isActive: false,
            isInstalling: false,
            isWaiting: false
        },
        isOnline: typeof window !== "undefined" ? navigator.onLine : true,
        offlineVotes: 0,
        hasOfflineData: false,
        notificationsSupported: typeof window !== "undefined" ? "Notification" in window : false,
        notificationsEnabled: false,
        notificationsPermission: "default",
        loading: true,
        error: null
    });
    // Initialize PWA
    const initializePWA = (0, _react.useCallback)(async ()=>{
        try {
            _logger.logger.info("usePWA: Starting initialization...");
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    loading: true,
                    error: null
                }));
            // Check if PWA feature is enabled
            const pwaEnabled = (0, _featureflags.isFeatureEnabled)("PWA");
            _logger.logger.info("usePWA: PWA feature enabled:", pwaEnabled);
            if (!pwaEnabled) {
                _logger.logger.info("usePWA: PWA feature is disabled, setting status");
                setStatus((prev)=>(0, _objects.withOptional)(prev, {
                        isEnabled: false,
                        loading: false,
                        error: "PWA feature is disabled"
                    }));
                return;
            }
            // Check basic support
            const isSupported = "serviceWorker" in navigator && "PushManager" in window;
            _logger.logger.info("usePWA: PWA support check:", {
                serviceWorker: "serviceWorker" in navigator,
                pushManager: "PushManager" in window,
                isSupported
            });
            // Get installation status
            const installationStatus = _installation.pwaInstallationManager.getStatus();
            // Register service worker if not already registered
            const serviceWorkerStatus = await _serviceworker.serviceWorkerManager.register();
            // Check notification permission
            const notificationsPermission = "Notification" in window ? Notification.permission : "denied";
            // Get offline data status
            const offlineVotes = await getOfflineVotesCount();
            const finalStatus = {
                isSupported,
                isEnabled: pwaEnabled,
                installation: installationStatus,
                serviceWorker: serviceWorkerStatus,
                notificationsPermission,
                notificationsEnabled: notificationsPermission === "granted",
                offlineVotes,
                hasOfflineData: offlineVotes > 0,
                loading: false,
                error: null
            };
            _logger.logger.info("usePWA: Setting final status:", finalStatus);
            setStatus((prev)=>(0, _objects.withOptional)(prev, finalStatus));
        } catch (error) {
            _logger.logger.error("PWA: Initialization failed:", error instanceof Error ? error : new Error("Unknown error"));
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    loading: false,
                    error: error instanceof Error ? error.message : "Unknown error"
                }));
        }
    }, []);
    // Prompt installation
    const promptInstallation = (0, _react.useCallback)(async ()=>{
        try {
            const result = await _installation.pwaInstallationManager.promptInstallation();
            // Update status after installation attempt
            const installationStatus = _installation.pwaInstallationManager.getStatus();
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    installation: installationStatus
                }));
            return result;
        } catch (error) {
            _logger.logger.error("PWA: Installation prompt failed:", error instanceof Error ? error : new Error("Unknown error"));
            return {
                success: false,
                outcome: "error",
                error: error instanceof Error ? error.message : "Unknown error"
            };
        }
    }, []);
    // Check for service worker updates
    const checkForUpdates = (0, _react.useCallback)(async ()=>{
        try {
            const hasUpdate = await _serviceworker.serviceWorkerManager.checkForUpdates();
            // Update service worker status
            const serviceWorkerStatus = await _serviceworker.serviceWorkerManager.getStatus();
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    serviceWorker: serviceWorkerStatus
                }));
            return hasUpdate;
        } catch (error) {
            _logger.logger.error("PWA: Failed to check for updates:", error instanceof Error ? error : new Error("Unknown error"));
            return false;
        }
    }, []);
    // Skip waiting for service worker
    const skipWaiting = (0, _react.useCallback)(async ()=>{
        try {
            await _serviceworker.serviceWorkerManager.skipWaiting();
        } catch (error) {
            _logger.logger.error("PWA: Failed to skip waiting:", error instanceof Error ? error : new Error("Unknown error"));
            throw error;
        }
    }, []);
    // Sync offline data
    const syncOfflineData = (0, _react.useCallback)(async ()=>{
        try {
            _logger.logger.info("PWA: Syncing offline data...");
            // Update offline data count
            const offlineVotes = await getOfflineVotesCount();
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    offlineVotes,
                    hasOfflineData: offlineVotes > 0
                }));
        } catch (error) {
            _logger.logger.error("PWA: Failed to sync offline data:", error instanceof Error ? error : new Error("Unknown error"));
            throw error;
        }
    }, []);
    // Clear offline data
    const clearOfflineData = (0, _react.useCallback)(async ()=>{
        try {
            _logger.logger.info("PWA: Clearing offline data...");
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    offlineVotes: 0,
                    hasOfflineData: false
                }));
        } catch (error) {
            _logger.logger.error("PWA: Failed to clear offline data:", error instanceof Error ? error : new Error("Unknown error"));
            throw error;
        }
    }, []);
    // Request notification permission
    const requestNotificationPermission = (0, _react.useCallback)(async ()=>{
        try {
            if (!("Notification" in window)) {
                return false;
            }
            const permission = await Notification.requestPermission();
            const enabled = permission === "granted";
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    notificationsPermission: permission,
                    notificationsEnabled: enabled
                }));
            return enabled;
        } catch (error) {
            _logger.logger.error("PWA: Failed to request notification permission:", error instanceof Error ? error : new Error("Unknown error"));
            return false;
        }
    }, []);
    // Subscribe to notifications
    const subscribeToNotifications = (0, _react.useCallback)(async ()=>{
        try {
            if (!status.notificationsEnabled) {
                const enabled = await requestNotificationPermission();
                if (!enabled) {
                    return false;
                }
            }
            _logger.logger.info("PWA: Subscribing to notifications...");
            return true;
        } catch (error) {
            _logger.logger.error("PWA: Failed to subscribe to notifications:", error instanceof Error ? error : new Error("Unknown error"));
            return false;
        }
    }, [
        status.notificationsEnabled,
        requestNotificationPermission
    ]);
    // Unsubscribe from notifications
    const unsubscribeFromNotifications = (0, _react.useCallback)(async ()=>{
        try {
            // This would typically unsubscribe from push notifications
            _logger.logger.info("PWA: Unsubscribing from notifications...");
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    notificationsEnabled: false
                }));
            return true;
        } catch (error) {
            _logger.logger.error("PWA: Failed to unsubscribe from notifications:", error instanceof Error ? error : new Error("Unknown error"));
            return false;
        }
    }, []);
    // Refresh PWA status
    const refresh = (0, _react.useCallback)(async ()=>{
        await initializePWA();
    }, [
        initializePWA
    ]);
    // Initialize on mount
    (0, _react.useEffect)(()=>{
        initializePWA();
    }, [
        initializePWA
    ]);
    // Set up event listeners
    (0, _react.useEffect)(()=>{
        // Online/offline status
        const handleOnline = ()=>{
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    isOnline: true
                }));
            // Auto-sync when coming back online
            syncOfflineData().catch((error)=>{
                _logger.logger.error("PWA: Auto-sync failed:", error instanceof Error ? error : new Error("Unknown error"));
            });
        };
        const handleOffline = ()=>{
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    isOnline: false
                }));
        };
        // Installation status changes
        const unsubscribeInstallation = _installation.pwaInstallationManager.subscribe((installationStatus)=>{
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    installation: installationStatus
                }));
        });
        // Service worker status changes
        const unsubscribeServiceWorker = _serviceworker.serviceWorkerManager.subscribe((serviceWorkerStatus)=>{
            setStatus((prev)=>(0, _objects.withOptional)(prev, {
                    serviceWorker: serviceWorkerStatus
                }));
        });
        // Add event listeners (only on client side)
        if (typeof window !== "undefined") {
            window.addEventListener("online", handleOnline);
            window.addEventListener("offline", handleOffline);
        }
        // Cleanup
        return ()=>{
            if (typeof window !== "undefined") {
                window.removeEventListener("online", handleOnline);
                window.removeEventListener("offline", handleOffline);
            }
            unsubscribeInstallation();
            unsubscribeServiceWorker();
        };
    }, [
        syncOfflineData
    ]);
    return Object.assign({}, status, {
        promptInstallation,
        checkForUpdates,
        skipWaiting,
        syncOfflineData,
        clearOfflineData,
        requestNotificationPermission,
        subscribeToNotifications,
        unsubscribeFromNotifications,
        refresh
    });
}
/**
 * Get offline votes count
 */ async function getOfflineVotesCount() {
    try {
        // This would typically read from IndexedDB or localStorage
        // For now, return 0
        return 0;
    } catch (error) {
        _logger.logger.error("PWA: Failed to get offline votes count:", error instanceof Error ? error : new Error("Unknown error"));
        return 0;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9ob29rcy91c2VQV0EudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQV0EgSG9va1xuICogXG4gKiBDb21wcmVoZW5zaXZlIGhvb2sgdGhhdCBwcm92aWRlcyBQV0EgZnVuY3Rpb25hbGl0eSBpbmNsdWRpbmdcbiAqIGluc3RhbGxhdGlvbiwgb2ZmbGluZSBzdGF0dXMsIHNlcnZpY2Ugd29ya2VyIG1hbmFnZW1lbnQsIGFuZCBub3RpZmljYXRpb25zLlxuICovXG5cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBpc0ZlYXR1cmVFbmFibGVkIH0gZnJvbSAnQC9saWIvY29yZS9mZWF0dXJlLWZsYWdzJztcbmltcG9ydCB7IFxuICBwd2FJbnN0YWxsYXRpb25NYW5hZ2VyLCBcbiAgdHlwZSBJbnN0YWxsYXRpb25TdGF0dXMsIFxuICB0eXBlIEluc3RhbGxhdGlvblJlc3VsdCBcbn0gZnJvbSAnQC9saWIvcHdhL2luc3RhbGxhdGlvbic7XG5pbXBvcnQgeyBcbiAgc2VydmljZVdvcmtlck1hbmFnZXIsIFxuICB0eXBlIFNlcnZpY2VXb3JrZXJTdGF0dXMgXG59IGZyb20gJ0AvbGliL3B3YS9zZXJ2aWNlLXdvcmtlcic7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL2xpYi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgd2l0aE9wdGlvbmFsIH0gZnJvbSAnQC9saWIvdXRpbHMvb2JqZWN0cyc7XG5cbi8vIEltcG9ydCBQV0EgbWFuYWdlcnNcblxuZXhwb3J0IGludGVyZmFjZSBQV0FTdGF0dXMge1xuICAvLyBGZWF0dXJlIGF2YWlsYWJpbGl0eVxuICBpc1N1cHBvcnRlZDogYm9vbGVhbjtcbiAgaXNFbmFibGVkOiBib29sZWFuO1xuICBcbiAgLy8gSW5zdGFsbGF0aW9uXG4gIGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU3RhdHVzO1xuICBcbiAgLy8gU2VydmljZSBXb3JrZXJcbiAgc2VydmljZVdvcmtlcjogU2VydmljZVdvcmtlclN0YXR1cztcbiAgXG4gIC8vIENvbm5lY3Rpb25cbiAgaXNPbmxpbmU6IGJvb2xlYW47XG4gIFxuICAvLyBPZmZsaW5lIGRhdGFcbiAgb2ZmbGluZVZvdGVzOiBudW1iZXI7XG4gIGhhc09mZmxpbmVEYXRhOiBib29sZWFuO1xuICBcbiAgLy8gTm90aWZpY2F0aW9uc1xuICBub3RpZmljYXRpb25zU3VwcG9ydGVkOiBib29sZWFuO1xuICBub3RpZmljYXRpb25zRW5hYmxlZDogYm9vbGVhbjtcbiAgbm90aWZpY2F0aW9uc1Blcm1pc3Npb246IE5vdGlmaWNhdGlvblBlcm1pc3Npb247XG4gIFxuICAvLyBMb2FkaW5nIHN0YXRlc1xuICBsb2FkaW5nOiBib29sZWFuO1xuICBlcnJvcjogc3RyaW5nIHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQV0FBY3Rpb25zIHtcbiAgLy8gSW5zdGFsbGF0aW9uXG4gIHByb21wdEluc3RhbGxhdGlvbjogKCkgPT4gUHJvbWlzZTxJbnN0YWxsYXRpb25SZXN1bHQ+O1xuICBcbiAgLy8gU2VydmljZSBXb3JrZXJcbiAgY2hlY2tGb3JVcGRhdGVzOiAoKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICBza2lwV2FpdGluZzogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgXG4gIC8vIE9mZmxpbmVcbiAgc3luY09mZmxpbmVEYXRhOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBjbGVhck9mZmxpbmVEYXRhOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBcbiAgLy8gTm90aWZpY2F0aW9uc1xuICByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbjogKCkgPT4gUHJvbWlzZTxib29sZWFuPjtcbiAgc3Vic2NyaWJlVG9Ob3RpZmljYXRpb25zOiAoKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zOiAoKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICBcbiAgLy8gVXRpbGl0eVxuICByZWZyZXNoOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlUFdBKCk6IFBXQVN0YXR1cyAmIFBXQUFjdGlvbnMge1xuICBjb25zdCBbc3RhdHVzLCBzZXRTdGF0dXNdID0gdXNlU3RhdGU8UFdBU3RhdHVzPih7XG4gICAgaXNTdXBwb3J0ZWQ6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiYgJ1B1c2hNYW5hZ2VyJyBpbiB3aW5kb3cpIDogZmFsc2UsXG4gICAgaXNFbmFibGVkOiBpc0ZlYXR1cmVFbmFibGVkKCdQV0EnKSxcbiAgICBpbnN0YWxsYXRpb246IHtcbiAgICAgIGlzSW5zdGFsbGFibGU6IGZhbHNlLFxuICAgICAgaXNJbnN0YWxsZWQ6IGZhbHNlLFxuICAgICAgY2FuUHJvbXB0OiBmYWxzZSxcbiAgICAgIHBsYXRmb3JtOiBudWxsLFxuICAgICAgZGVmZXJyZWRQcm9tcHQ6IG51bGxcbiAgICB9LFxuICAgIHNlcnZpY2VXb3JrZXI6IHtcbiAgICAgIGlzU3VwcG9ydGVkOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/ICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgOiBmYWxzZSxcbiAgICAgIGlzUmVnaXN0ZXJlZDogZmFsc2UsXG4gICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICBpc0luc3RhbGxpbmc6IGZhbHNlLFxuICAgICAgaXNXYWl0aW5nOiBmYWxzZVxuICAgIH0sXG4gICAgaXNPbmxpbmU6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gbmF2aWdhdG9yLm9uTGluZSA6IHRydWUsXG4gICAgb2ZmbGluZVZvdGVzOiAwLFxuICAgIGhhc09mZmxpbmVEYXRhOiBmYWxzZSxcbiAgICBub3RpZmljYXRpb25zU3VwcG9ydGVkOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/ICdOb3RpZmljYXRpb24nIGluIHdpbmRvdyA6IGZhbHNlLFxuICAgIG5vdGlmaWNhdGlvbnNFbmFibGVkOiBmYWxzZSxcbiAgICBub3RpZmljYXRpb25zUGVybWlzc2lvbjogJ2RlZmF1bHQnLFxuICAgIGxvYWRpbmc6IHRydWUsXG4gICAgZXJyb3I6IG51bGxcbiAgfSk7XG5cbiAgLy8gSW5pdGlhbGl6ZSBQV0FcbiAgY29uc3QgaW5pdGlhbGl6ZVBXQSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ3VzZVBXQTogU3RhcnRpbmcgaW5pdGlhbGl6YXRpb24uLi4nKTtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+IHdpdGhPcHRpb25hbChwcmV2LCB7IGxvYWRpbmc6IHRydWUsIGVycm9yOiBudWxsIH0pKTtcblxuICAgICAgLy8gQ2hlY2sgaWYgUFdBIGZlYXR1cmUgaXMgZW5hYmxlZFxuICAgICAgY29uc3QgcHdhRW5hYmxlZCA9IGlzRmVhdHVyZUVuYWJsZWQoJ1BXQScpO1xuICAgICAgbG9nZ2VyLmluZm8oJ3VzZVBXQTogUFdBIGZlYXR1cmUgZW5hYmxlZDonLCBwd2FFbmFibGVkKTtcbiAgICAgIGlmICghcHdhRW5hYmxlZCkge1xuICAgICAgICBsb2dnZXIuaW5mbygndXNlUFdBOiBQV0EgZmVhdHVyZSBpcyBkaXNhYmxlZCwgc2V0dGluZyBzdGF0dXMnKTtcbiAgICAgICAgc2V0U3RhdHVzKHByZXYgPT4gd2l0aE9wdGlvbmFsKHByZXYsIHtcbiAgICAgICAgICBpc0VuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnUFdBIGZlYXR1cmUgaXMgZGlzYWJsZWQnXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBiYXNpYyBzdXBwb3J0XG4gICAgICBjb25zdCBpc1N1cHBvcnRlZCA9ICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiYgJ1B1c2hNYW5hZ2VyJyBpbiB3aW5kb3c7XG4gICAgICBsb2dnZXIuaW5mbygndXNlUFdBOiBQV0Egc3VwcG9ydCBjaGVjazonLCB7XG4gICAgICAgIHNlcnZpY2VXb3JrZXI6ICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IsXG4gICAgICAgIHB1c2hNYW5hZ2VyOiAnUHVzaE1hbmFnZXInIGluIHdpbmRvdyxcbiAgICAgICAgaXNTdXBwb3J0ZWRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBHZXQgaW5zdGFsbGF0aW9uIHN0YXR1c1xuICAgICAgY29uc3QgaW5zdGFsbGF0aW9uU3RhdHVzID0gcHdhSW5zdGFsbGF0aW9uTWFuYWdlci5nZXRTdGF0dXMoKTtcbiAgICAgIFxuICAgICAgLy8gUmVnaXN0ZXIgc2VydmljZSB3b3JrZXIgaWYgbm90IGFscmVhZHkgcmVnaXN0ZXJlZFxuICAgICAgY29uc3Qgc2VydmljZVdvcmtlclN0YXR1cyA9IGF3YWl0IHNlcnZpY2VXb3JrZXJNYW5hZ2VyLnJlZ2lzdGVyKCk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIG5vdGlmaWNhdGlvbiBwZXJtaXNzaW9uXG4gICAgICBjb25zdCBub3RpZmljYXRpb25zUGVybWlzc2lvbiA9ICdOb3RpZmljYXRpb24nIGluIHdpbmRvdyBcbiAgICAgICAgPyBOb3RpZmljYXRpb24ucGVybWlzc2lvbiBcbiAgICAgICAgOiAnZGVuaWVkJztcbiAgICAgIFxuICAgICAgLy8gR2V0IG9mZmxpbmUgZGF0YSBzdGF0dXNcbiAgICAgIGNvbnN0IG9mZmxpbmVWb3RlcyA9IGF3YWl0IGdldE9mZmxpbmVWb3Rlc0NvdW50KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGZpbmFsU3RhdHVzID0ge1xuICAgICAgICBpc1N1cHBvcnRlZCxcbiAgICAgICAgaXNFbmFibGVkOiBwd2FFbmFibGVkLFxuICAgICAgICBpbnN0YWxsYXRpb246IGluc3RhbGxhdGlvblN0YXR1cyxcbiAgICAgICAgc2VydmljZVdvcmtlcjogc2VydmljZVdvcmtlclN0YXR1cyxcbiAgICAgICAgbm90aWZpY2F0aW9uc1Blcm1pc3Npb24sXG4gICAgICAgIG5vdGlmaWNhdGlvbnNFbmFibGVkOiBub3RpZmljYXRpb25zUGVybWlzc2lvbiA9PT0gJ2dyYW50ZWQnLFxuICAgICAgICBvZmZsaW5lVm90ZXMsXG4gICAgICAgIGhhc09mZmxpbmVEYXRhOiBvZmZsaW5lVm90ZXMgPiAwLFxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IG51bGxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGxvZ2dlci5pbmZvKCd1c2VQV0E6IFNldHRpbmcgZmluYWwgc3RhdHVzOicsIGZpbmFsU3RhdHVzKTtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+IHdpdGhPcHRpb25hbChwcmV2LCBmaW5hbFN0YXR1cykpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUFdBOiBJbml0aWFsaXphdGlvbiBmYWlsZWQ6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgc2V0U3RhdHVzKHByZXYgPT4gd2l0aE9wdGlvbmFsKHByZXYsIHtcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgICAgfSkpO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIC8vIFByb21wdCBpbnN0YWxsYXRpb25cbiAgY29uc3QgcHJvbXB0SW5zdGFsbGF0aW9uID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8SW5zdGFsbGF0aW9uUmVzdWx0PiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHB3YUluc3RhbGxhdGlvbk1hbmFnZXIucHJvbXB0SW5zdGFsbGF0aW9uKCk7XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBzdGF0dXMgYWZ0ZXIgaW5zdGFsbGF0aW9uIGF0dGVtcHRcbiAgICAgIGNvbnN0IGluc3RhbGxhdGlvblN0YXR1cyA9IHB3YUluc3RhbGxhdGlvbk1hbmFnZXIuZ2V0U3RhdHVzKCk7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiB3aXRoT3B0aW9uYWwocHJldiwge1xuICAgICAgICBpbnN0YWxsYXRpb246IGluc3RhbGxhdGlvblN0YXR1c1xuICAgICAgfSkpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1BXQTogSW5zdGFsbGF0aW9uIHByb21wdCBmYWlsZWQ6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG91dGNvbWU6ICdlcnJvcicsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgICAgfTtcbiAgICB9XG4gIH0sIFtdKTtcblxuICAvLyBDaGVjayBmb3Igc2VydmljZSB3b3JrZXIgdXBkYXRlc1xuICBjb25zdCBjaGVja0ZvclVwZGF0ZXMgPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhhc1VwZGF0ZSA9IGF3YWl0IHNlcnZpY2VXb3JrZXJNYW5hZ2VyLmNoZWNrRm9yVXBkYXRlcygpO1xuICAgICAgXG4gICAgICAvLyBVcGRhdGUgc2VydmljZSB3b3JrZXIgc3RhdHVzXG4gICAgICBjb25zdCBzZXJ2aWNlV29ya2VyU3RhdHVzID0gYXdhaXQgc2VydmljZVdvcmtlck1hbmFnZXIuZ2V0U3RhdHVzKCk7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiB3aXRoT3B0aW9uYWwocHJldiwge1xuICAgICAgICBzZXJ2aWNlV29ya2VyOiBzZXJ2aWNlV29ya2VyU3RhdHVzXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIHJldHVybiBoYXNVcGRhdGU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUFdBOiBGYWlsZWQgdG8gY2hlY2sgZm9yIHVwZGF0ZXM6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIC8vIFNraXAgd2FpdGluZyBmb3Igc2VydmljZSB3b3JrZXJcbiAgY29uc3Qgc2tpcFdhaXRpbmcgPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNlcnZpY2VXb3JrZXJNYW5hZ2VyLnNraXBXYWl0aW5nKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUFdBOiBGYWlsZWQgdG8gc2tpcCB3YWl0aW5nOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcignVW5rbm93biBlcnJvcicpKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIC8vIFN5bmMgb2ZmbGluZSBkYXRhXG4gIGNvbnN0IHN5bmNPZmZsaW5lRGF0YSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ1BXQTogU3luY2luZyBvZmZsaW5lIGRhdGEuLi4nKTtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIG9mZmxpbmUgZGF0YSBjb3VudFxuICAgICAgY29uc3Qgb2ZmbGluZVZvdGVzID0gYXdhaXQgZ2V0T2ZmbGluZVZvdGVzQ291bnQoKTtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+IHdpdGhPcHRpb25hbChwcmV2LCB7XG4gICAgICAgIG9mZmxpbmVWb3RlcyxcbiAgICAgICAgaGFzT2ZmbGluZURhdGE6IG9mZmxpbmVWb3RlcyA+IDBcbiAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byBzeW5jIG9mZmxpbmUgZGF0YTonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0sIFtdKTtcblxuICAvLyBDbGVhciBvZmZsaW5lIGRhdGFcbiAgY29uc3QgY2xlYXJPZmZsaW5lRGF0YSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ1BXQTogQ2xlYXJpbmcgb2ZmbGluZSBkYXRhLi4uJyk7XG4gICAgICBcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+IHdpdGhPcHRpb25hbChwcmV2LCB7XG4gICAgICAgIG9mZmxpbmVWb3RlczogMCxcbiAgICAgICAgaGFzT2ZmbGluZURhdGE6IGZhbHNlXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUFdBOiBGYWlsZWQgdG8gY2xlYXIgb2ZmbGluZSBkYXRhOicsIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcignVW5rbm93biBlcnJvcicpKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIC8vIFJlcXVlc3Qgbm90aWZpY2F0aW9uIHBlcm1pc3Npb25cbiAgY29uc3QgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb24gPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghKCdOb3RpZmljYXRpb24nIGluIHdpbmRvdykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBwZXJtaXNzaW9uID0gYXdhaXQgTm90aWZpY2F0aW9uLnJlcXVlc3RQZXJtaXNzaW9uKCk7XG4gICAgICBjb25zdCBlbmFibGVkID0gcGVybWlzc2lvbiA9PT0gJ2dyYW50ZWQnO1xuICAgICAgXG4gICAgICBzZXRTdGF0dXMocHJldiA9PiB3aXRoT3B0aW9uYWwocHJldiwge1xuICAgICAgICBub3RpZmljYXRpb25zUGVybWlzc2lvbjogcGVybWlzc2lvbixcbiAgICAgICAgbm90aWZpY2F0aW9uc0VuYWJsZWQ6IGVuYWJsZWRcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIGVuYWJsZWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUFdBOiBGYWlsZWQgdG8gcmVxdWVzdCBub3RpZmljYXRpb24gcGVybWlzc2lvbjonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgLy8gU3Vic2NyaWJlIHRvIG5vdGlmaWNhdGlvbnNcbiAgY29uc3Qgc3Vic2NyaWJlVG9Ob3RpZmljYXRpb25zID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIXN0YXR1cy5ub3RpZmljYXRpb25zRW5hYmxlZCkge1xuICAgICAgICBjb25zdCBlbmFibGVkID0gYXdhaXQgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb24oKTtcbiAgICAgICAgaWYgKCFlbmFibGVkKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdQV0E6IFN1YnNjcmliaW5nIHRvIG5vdGlmaWNhdGlvbnMuLi4nKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUFdBOiBGYWlsZWQgdG8gc3Vic2NyaWJlIHRvIG5vdGlmaWNhdGlvbnM6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSwgW3N0YXR1cy5ub3RpZmljYXRpb25zRW5hYmxlZCwgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb25dKTtcblxuICAvLyBVbnN1YnNjcmliZSBmcm9tIG5vdGlmaWNhdGlvbnNcbiAgY29uc3QgdW5zdWJzY3JpYmVGcm9tTm90aWZpY2F0aW9ucyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVGhpcyB3b3VsZCB0eXBpY2FsbHkgdW5zdWJzY3JpYmUgZnJvbSBwdXNoIG5vdGlmaWNhdGlvbnNcbiAgICAgIGxvZ2dlci5pbmZvKCdQV0E6IFVuc3Vic2NyaWJpbmcgZnJvbSBub3RpZmljYXRpb25zLi4uJyk7XG4gICAgICBcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+IHdpdGhPcHRpb25hbChwcmV2LCB7XG4gICAgICAgIG5vdGlmaWNhdGlvbnNFbmFibGVkOiBmYWxzZVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byB1bnN1YnNjcmliZSBmcm9tIG5vdGlmaWNhdGlvbnM6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIC8vIFJlZnJlc2ggUFdBIHN0YXR1c1xuICBjb25zdCByZWZyZXNoID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIGF3YWl0IGluaXRpYWxpemVQV0EoKTtcbiAgfSwgW2luaXRpYWxpemVQV0FdKTtcblxuICAvLyBJbml0aWFsaXplIG9uIG1vdW50XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaW5pdGlhbGl6ZVBXQSgpO1xuICB9LCBbaW5pdGlhbGl6ZVBXQV0pO1xuXG4gIC8vIFNldCB1cCBldmVudCBsaXN0ZW5lcnNcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBPbmxpbmUvb2ZmbGluZSBzdGF0dXNcbiAgICBjb25zdCBoYW5kbGVPbmxpbmUgPSAoKSA9PiB7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiB3aXRoT3B0aW9uYWwocHJldiwgeyBpc09ubGluZTogdHJ1ZSB9KSk7XG4gICAgICAvLyBBdXRvLXN5bmMgd2hlbiBjb21pbmcgYmFjayBvbmxpbmVcbiAgICAgIHN5bmNPZmZsaW5lRGF0YSgpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdQV0E6IEF1dG8tc3luYyBmYWlsZWQ6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGNvbnN0IGhhbmRsZU9mZmxpbmUgPSAoKSA9PiB7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiB3aXRoT3B0aW9uYWwocHJldiwgeyBpc09ubGluZTogZmFsc2UgfSkpO1xuICAgIH07XG5cbiAgICAvLyBJbnN0YWxsYXRpb24gc3RhdHVzIGNoYW5nZXNcbiAgICBjb25zdCB1bnN1YnNjcmliZUluc3RhbGxhdGlvbiA9IHB3YUluc3RhbGxhdGlvbk1hbmFnZXIuc3Vic2NyaWJlKChpbnN0YWxsYXRpb25TdGF0dXMpID0+IHtcbiAgICAgIHNldFN0YXR1cyhwcmV2ID0+IHdpdGhPcHRpb25hbChwcmV2LCB7IGluc3RhbGxhdGlvbjogaW5zdGFsbGF0aW9uU3RhdHVzIH0pKTtcbiAgICB9KTtcblxuICAgIC8vIFNlcnZpY2Ugd29ya2VyIHN0YXR1cyBjaGFuZ2VzXG4gICAgY29uc3QgdW5zdWJzY3JpYmVTZXJ2aWNlV29ya2VyID0gc2VydmljZVdvcmtlck1hbmFnZXIuc3Vic2NyaWJlKChzZXJ2aWNlV29ya2VyU3RhdHVzKSA9PiB7XG4gICAgICBzZXRTdGF0dXMocHJldiA9PiB3aXRoT3B0aW9uYWwocHJldiwgeyBzZXJ2aWNlV29ya2VyOiBzZXJ2aWNlV29ya2VyU3RhdHVzIH0pKTtcbiAgICB9KTtcblxuICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgKG9ubHkgb24gY2xpZW50IHNpZGUpXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgaGFuZGxlT25saW5lKTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgaGFuZGxlT2ZmbGluZSk7XG4gICAgfVxuXG4gICAgLy8gQ2xlYW51cFxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29ubGluZScsIGhhbmRsZU9ubGluZSk7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgaGFuZGxlT2ZmbGluZSk7XG4gICAgICB9XG4gICAgICB1bnN1YnNjcmliZUluc3RhbGxhdGlvbigpO1xuICAgICAgdW5zdWJzY3JpYmVTZXJ2aWNlV29ya2VyKCk7XG4gICAgfTtcbiAgfSwgW3N5bmNPZmZsaW5lRGF0YV0pO1xuXG4gIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBzdGF0dXMsIHtcbiAgICBwcm9tcHRJbnN0YWxsYXRpb24sXG4gICAgY2hlY2tGb3JVcGRhdGVzLFxuICAgIHNraXBXYWl0aW5nLFxuICAgIHN5bmNPZmZsaW5lRGF0YSxcbiAgICBjbGVhck9mZmxpbmVEYXRhLFxuICAgIHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uLFxuICAgIHN1YnNjcmliZVRvTm90aWZpY2F0aW9ucyxcbiAgICB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zLFxuICAgIHJlZnJlc2hcbiAgfSk7XG59XG5cbi8qKlxuICogR2V0IG9mZmxpbmUgdm90ZXMgY291bnRcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0T2ZmbGluZVZvdGVzQ291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgdHJ5IHtcbiAgICAvLyBUaGlzIHdvdWxkIHR5cGljYWxseSByZWFkIGZyb20gSW5kZXhlZERCIG9yIGxvY2FsU3RvcmFnZVxuICAgIC8vIEZvciBub3csIHJldHVybiAwXG4gICAgcmV0dXJuIDA7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdQV0E6IEZhaWxlZCB0byBnZXQgb2ZmbGluZSB2b3RlcyBjb3VudDonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSk7XG4gICAgcmV0dXJuIDA7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJ1c2VQV0EiLCJzdGF0dXMiLCJzZXRTdGF0dXMiLCJ1c2VTdGF0ZSIsImlzU3VwcG9ydGVkIiwid2luZG93IiwibmF2aWdhdG9yIiwiaXNFbmFibGVkIiwiaXNGZWF0dXJlRW5hYmxlZCIsImluc3RhbGxhdGlvbiIsImlzSW5zdGFsbGFibGUiLCJpc0luc3RhbGxlZCIsImNhblByb21wdCIsInBsYXRmb3JtIiwiZGVmZXJyZWRQcm9tcHQiLCJzZXJ2aWNlV29ya2VyIiwiaXNSZWdpc3RlcmVkIiwiaXNBY3RpdmUiLCJpc0luc3RhbGxpbmciLCJpc1dhaXRpbmciLCJpc09ubGluZSIsIm9uTGluZSIsIm9mZmxpbmVWb3RlcyIsImhhc09mZmxpbmVEYXRhIiwibm90aWZpY2F0aW9uc1N1cHBvcnRlZCIsIm5vdGlmaWNhdGlvbnNFbmFibGVkIiwibm90aWZpY2F0aW9uc1Blcm1pc3Npb24iLCJsb2FkaW5nIiwiZXJyb3IiLCJpbml0aWFsaXplUFdBIiwidXNlQ2FsbGJhY2siLCJsb2dnZXIiLCJpbmZvIiwicHJldiIsIndpdGhPcHRpb25hbCIsInB3YUVuYWJsZWQiLCJwdXNoTWFuYWdlciIsImluc3RhbGxhdGlvblN0YXR1cyIsInB3YUluc3RhbGxhdGlvbk1hbmFnZXIiLCJnZXRTdGF0dXMiLCJzZXJ2aWNlV29ya2VyU3RhdHVzIiwic2VydmljZVdvcmtlck1hbmFnZXIiLCJyZWdpc3RlciIsIk5vdGlmaWNhdGlvbiIsInBlcm1pc3Npb24iLCJnZXRPZmZsaW5lVm90ZXNDb3VudCIsImZpbmFsU3RhdHVzIiwiRXJyb3IiLCJtZXNzYWdlIiwicHJvbXB0SW5zdGFsbGF0aW9uIiwicmVzdWx0Iiwic3VjY2VzcyIsIm91dGNvbWUiLCJjaGVja0ZvclVwZGF0ZXMiLCJoYXNVcGRhdGUiLCJza2lwV2FpdGluZyIsInN5bmNPZmZsaW5lRGF0YSIsImNsZWFyT2ZmbGluZURhdGEiLCJyZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbiIsInJlcXVlc3RQZXJtaXNzaW9uIiwiZW5hYmxlZCIsInN1YnNjcmliZVRvTm90aWZpY2F0aW9ucyIsInVuc3Vic2NyaWJlRnJvbU5vdGlmaWNhdGlvbnMiLCJyZWZyZXNoIiwidXNlRWZmZWN0IiwiaGFuZGxlT25saW5lIiwiY2F0Y2giLCJoYW5kbGVPZmZsaW5lIiwidW5zdWJzY3JpYmVJbnN0YWxsYXRpb24iLCJzdWJzY3JpYmUiLCJ1bnN1YnNjcmliZVNlcnZpY2VXb3JrZXIiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0NBS0M7Ozs7K0JBb0VlQTs7O2VBQUFBOzs7dUJBbEVpQzs4QkFFaEI7OEJBSzFCOytCQUlBO3dCQUNnQjt5QkFDTTtBQXFEdEIsU0FBU0E7SUFDZCxNQUFNLENBQUNDLFFBQVFDLFVBQVUsR0FBR0MsSUFBQUEsZUFBUSxFQUFZO1FBQzlDQyxhQUFhLE9BQU9DLFdBQVcsY0FBZSxtQkFBbUJDLGFBQWEsaUJBQWlCRCxTQUFVO1FBQ3pHRSxXQUFXQyxJQUFBQSw4QkFBZ0IsRUFBQztRQUM1QkMsY0FBYztZQUNaQyxlQUFlO1lBQ2ZDLGFBQWE7WUFDYkMsV0FBVztZQUNYQyxVQUFVO1lBQ1ZDLGdCQUFnQjtRQUNsQjtRQUNBQyxlQUFlO1lBQ2JYLGFBQWEsT0FBT0MsV0FBVyxjQUFjLG1CQUFtQkMsWUFBWTtZQUM1RVUsY0FBYztZQUNkQyxVQUFVO1lBQ1ZDLGNBQWM7WUFDZEMsV0FBVztRQUNiO1FBQ0FDLFVBQVUsT0FBT2YsV0FBVyxjQUFjQyxVQUFVZSxNQUFNLEdBQUc7UUFDN0RDLGNBQWM7UUFDZEMsZ0JBQWdCO1FBQ2hCQyx3QkFBd0IsT0FBT25CLFdBQVcsY0FBYyxrQkFBa0JBLFNBQVM7UUFDbkZvQixzQkFBc0I7UUFDdEJDLHlCQUF5QjtRQUN6QkMsU0FBUztRQUNUQyxPQUFPO0lBQ1Q7SUFFQSxpQkFBaUI7SUFDakIsTUFBTUMsZ0JBQWdCQyxJQUFBQSxrQkFBVyxFQUFDO1FBQ2hDLElBQUk7WUFDRkMsY0FBTSxDQUFDQyxJQUFJLENBQUM7WUFDWjlCLFVBQVUrQixDQUFBQSxPQUFRQyxJQUFBQSxxQkFBWSxFQUFDRCxNQUFNO29CQUFFTixTQUFTO29CQUFNQyxPQUFPO2dCQUFLO1lBRWxFLGtDQUFrQztZQUNsQyxNQUFNTyxhQUFhM0IsSUFBQUEsOEJBQWdCLEVBQUM7WUFDcEN1QixjQUFNLENBQUNDLElBQUksQ0FBQyxnQ0FBZ0NHO1lBQzVDLElBQUksQ0FBQ0EsWUFBWTtnQkFDZkosY0FBTSxDQUFDQyxJQUFJLENBQUM7Z0JBQ1o5QixVQUFVK0IsQ0FBQUEsT0FBUUMsSUFBQUEscUJBQVksRUFBQ0QsTUFBTTt3QkFDbkMxQixXQUFXO3dCQUNYb0IsU0FBUzt3QkFDVEMsT0FBTztvQkFDVDtnQkFDQTtZQUNGO1lBRUEsc0JBQXNCO1lBQ3RCLE1BQU14QixjQUFjLG1CQUFtQkUsYUFBYSxpQkFBaUJEO1lBQ3JFMEIsY0FBTSxDQUFDQyxJQUFJLENBQUMsOEJBQThCO2dCQUN4Q2pCLGVBQWUsbUJBQW1CVDtnQkFDbEM4QixhQUFhLGlCQUFpQi9CO2dCQUM5QkQ7WUFDRjtZQUVBLDBCQUEwQjtZQUMxQixNQUFNaUMscUJBQXFCQyxvQ0FBc0IsQ0FBQ0MsU0FBUztZQUUzRCxvREFBb0Q7WUFDcEQsTUFBTUMsc0JBQXNCLE1BQU1DLG1DQUFvQixDQUFDQyxRQUFRO1lBRS9ELGdDQUFnQztZQUNoQyxNQUFNaEIsMEJBQTBCLGtCQUFrQnJCLFNBQzlDc0MsYUFBYUMsVUFBVSxHQUN2QjtZQUVKLDBCQUEwQjtZQUMxQixNQUFNdEIsZUFBZSxNQUFNdUI7WUFFM0IsTUFBTUMsY0FBYztnQkFDbEIxQztnQkFDQUcsV0FBVzRCO2dCQUNYMUIsY0FBYzRCO2dCQUNkdEIsZUFBZXlCO2dCQUNmZDtnQkFDQUQsc0JBQXNCQyw0QkFBNEI7Z0JBQ2xESjtnQkFDQUMsZ0JBQWdCRCxlQUFlO2dCQUMvQkssU0FBUztnQkFDVEMsT0FBTztZQUNUO1lBRUFHLGNBQU0sQ0FBQ0MsSUFBSSxDQUFDLGlDQUFpQ2M7WUFDN0M1QyxVQUFVK0IsQ0FBQUEsT0FBUUMsSUFBQUEscUJBQVksRUFBQ0QsTUFBTWE7UUFFdkMsRUFBRSxPQUFPbEIsT0FBTztZQUNkRyxjQUFNLENBQUNILEtBQUssQ0FBQywrQkFBK0JBLGlCQUFpQm1CLFFBQVFuQixRQUFRLElBQUltQixNQUFNO1lBQ3ZGN0MsVUFBVStCLENBQUFBLE9BQVFDLElBQUFBLHFCQUFZLEVBQUNELE1BQU07b0JBQ25DTixTQUFTO29CQUNUQyxPQUFPQSxpQkFBaUJtQixRQUFRbkIsTUFBTW9CLE9BQU8sR0FBRztnQkFDbEQ7UUFDRjtJQUNGLEdBQUcsRUFBRTtJQUVMLHNCQUFzQjtJQUN0QixNQUFNQyxxQkFBcUJuQixJQUFBQSxrQkFBVyxFQUFDO1FBQ3JDLElBQUk7WUFDRixNQUFNb0IsU0FBUyxNQUFNWixvQ0FBc0IsQ0FBQ1csa0JBQWtCO1lBRTlELDJDQUEyQztZQUMzQyxNQUFNWixxQkFBcUJDLG9DQUFzQixDQUFDQyxTQUFTO1lBQzNEckMsVUFBVStCLENBQUFBLE9BQVFDLElBQUFBLHFCQUFZLEVBQUNELE1BQU07b0JBQ25DeEIsY0FBYzRCO2dCQUNoQjtZQUVBLE9BQU9hO1FBQ1QsRUFBRSxPQUFPdEIsT0FBTztZQUNkRyxjQUFNLENBQUNILEtBQUssQ0FBQyxvQ0FBb0NBLGlCQUFpQm1CLFFBQVFuQixRQUFRLElBQUltQixNQUFNO1lBQzVGLE9BQU87Z0JBQ0xJLFNBQVM7Z0JBQ1RDLFNBQVM7Z0JBQ1R4QixPQUFPQSxpQkFBaUJtQixRQUFRbkIsTUFBTW9CLE9BQU8sR0FBRztZQUNsRDtRQUNGO0lBQ0YsR0FBRyxFQUFFO0lBRUwsbUNBQW1DO0lBQ25DLE1BQU1LLGtCQUFrQnZCLElBQUFBLGtCQUFXLEVBQUM7UUFDbEMsSUFBSTtZQUNGLE1BQU13QixZQUFZLE1BQU1iLG1DQUFvQixDQUFDWSxlQUFlO1lBRTVELCtCQUErQjtZQUMvQixNQUFNYixzQkFBc0IsTUFBTUMsbUNBQW9CLENBQUNGLFNBQVM7WUFDaEVyQyxVQUFVK0IsQ0FBQUEsT0FBUUMsSUFBQUEscUJBQVksRUFBQ0QsTUFBTTtvQkFDbkNsQixlQUFleUI7Z0JBQ2pCO1lBRUEsT0FBT2M7UUFDVCxFQUFFLE9BQU8xQixPQUFPO1lBQ2RHLGNBQU0sQ0FBQ0gsS0FBSyxDQUFDLHFDQUFxQ0EsaUJBQWlCbUIsUUFBUW5CLFFBQVEsSUFBSW1CLE1BQU07WUFDN0YsT0FBTztRQUNUO0lBQ0YsR0FBRyxFQUFFO0lBRUwsa0NBQWtDO0lBQ2xDLE1BQU1RLGNBQWN6QixJQUFBQSxrQkFBVyxFQUFDO1FBQzlCLElBQUk7WUFDRixNQUFNVyxtQ0FBb0IsQ0FBQ2MsV0FBVztRQUN4QyxFQUFFLE9BQU8zQixPQUFPO1lBQ2RHLGNBQU0sQ0FBQ0gsS0FBSyxDQUFDLGdDQUFnQ0EsaUJBQWlCbUIsUUFBUW5CLFFBQVEsSUFBSW1CLE1BQU07WUFDeEYsTUFBTW5CO1FBQ1I7SUFDRixHQUFHLEVBQUU7SUFFTCxvQkFBb0I7SUFDcEIsTUFBTTRCLGtCQUFrQjFCLElBQUFBLGtCQUFXLEVBQUM7UUFDbEMsSUFBSTtZQUNGQyxjQUFNLENBQUNDLElBQUksQ0FBQztZQUVaLDRCQUE0QjtZQUM1QixNQUFNVixlQUFlLE1BQU11QjtZQUMzQjNDLFVBQVUrQixDQUFBQSxPQUFRQyxJQUFBQSxxQkFBWSxFQUFDRCxNQUFNO29CQUNuQ1g7b0JBQ0FDLGdCQUFnQkQsZUFBZTtnQkFDakM7UUFDRixFQUFFLE9BQU9NLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMscUNBQXFDQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUM3RixNQUFNbkI7UUFDUjtJQUNGLEdBQUcsRUFBRTtJQUVMLHFCQUFxQjtJQUNyQixNQUFNNkIsbUJBQW1CM0IsSUFBQUEsa0JBQVcsRUFBQztRQUNuQyxJQUFJO1lBQ0ZDLGNBQU0sQ0FBQ0MsSUFBSSxDQUFDO1lBRVo5QixVQUFVK0IsQ0FBQUEsT0FBUUMsSUFBQUEscUJBQVksRUFBQ0QsTUFBTTtvQkFDbkNYLGNBQWM7b0JBQ2RDLGdCQUFnQjtnQkFDbEI7UUFDRixFQUFFLE9BQU9LLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMsc0NBQXNDQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUM5RixNQUFNbkI7UUFDUjtJQUNGLEdBQUcsRUFBRTtJQUVMLGtDQUFrQztJQUNsQyxNQUFNOEIsZ0NBQWdDNUIsSUFBQUEsa0JBQVcsRUFBQztRQUNoRCxJQUFJO1lBQ0YsSUFBSSxDQUFFLENBQUEsa0JBQWtCekIsTUFBSyxHQUFJO2dCQUMvQixPQUFPO1lBQ1Q7WUFFQSxNQUFNdUMsYUFBYSxNQUFNRCxhQUFhZ0IsaUJBQWlCO1lBQ3ZELE1BQU1DLFVBQVVoQixlQUFlO1lBRS9CMUMsVUFBVStCLENBQUFBLE9BQVFDLElBQUFBLHFCQUFZLEVBQUNELE1BQU07b0JBQ25DUCx5QkFBeUJrQjtvQkFDekJuQixzQkFBc0JtQztnQkFDeEI7WUFFQSxPQUFPQTtRQUNULEVBQUUsT0FBT2hDLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMsbURBQW1EQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUMzRyxPQUFPO1FBQ1Q7SUFDRixHQUFHLEVBQUU7SUFFTCw2QkFBNkI7SUFDN0IsTUFBTWMsMkJBQTJCL0IsSUFBQUEsa0JBQVcsRUFBQztRQUMzQyxJQUFJO1lBQ0YsSUFBSSxDQUFDN0IsT0FBT3dCLG9CQUFvQixFQUFFO2dCQUNoQyxNQUFNbUMsVUFBVSxNQUFNRjtnQkFDdEIsSUFBSSxDQUFDRSxTQUFTO29CQUNaLE9BQU87Z0JBQ1Q7WUFDRjtZQUVBN0IsY0FBTSxDQUFDQyxJQUFJLENBQUM7WUFFWixPQUFPO1FBQ1QsRUFBRSxPQUFPSixPQUFPO1lBQ2RHLGNBQU0sQ0FBQ0gsS0FBSyxDQUFDLDhDQUE4Q0EsaUJBQWlCbUIsUUFBUW5CLFFBQVEsSUFBSW1CLE1BQU07WUFDdEcsT0FBTztRQUNUO0lBQ0YsR0FBRztRQUFDOUMsT0FBT3dCLG9CQUFvQjtRQUFFaUM7S0FBOEI7SUFFL0QsaUNBQWlDO0lBQ2pDLE1BQU1JLCtCQUErQmhDLElBQUFBLGtCQUFXLEVBQUM7UUFDL0MsSUFBSTtZQUNGLDJEQUEyRDtZQUMzREMsY0FBTSxDQUFDQyxJQUFJLENBQUM7WUFFWjlCLFVBQVUrQixDQUFBQSxPQUFRQyxJQUFBQSxxQkFBWSxFQUFDRCxNQUFNO29CQUNuQ1Isc0JBQXNCO2dCQUN4QjtZQUVBLE9BQU87UUFDVCxFQUFFLE9BQU9HLE9BQU87WUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMsa0RBQWtEQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtZQUMxRyxPQUFPO1FBQ1Q7SUFDRixHQUFHLEVBQUU7SUFFTCxxQkFBcUI7SUFDckIsTUFBTWdCLFVBQVVqQyxJQUFBQSxrQkFBVyxFQUFDO1FBQzFCLE1BQU1EO0lBQ1IsR0FBRztRQUFDQTtLQUFjO0lBRWxCLHNCQUFzQjtJQUN0Qm1DLElBQUFBLGdCQUFTLEVBQUM7UUFDUm5DO0lBQ0YsR0FBRztRQUFDQTtLQUFjO0lBRWxCLHlCQUF5QjtJQUN6Qm1DLElBQUFBLGdCQUFTLEVBQUM7UUFDUix3QkFBd0I7UUFDeEIsTUFBTUMsZUFBZTtZQUNuQi9ELFVBQVUrQixDQUFBQSxPQUFRQyxJQUFBQSxxQkFBWSxFQUFDRCxNQUFNO29CQUFFYixVQUFVO2dCQUFLO1lBQ3RELG9DQUFvQztZQUNwQ29DLGtCQUFrQlUsS0FBSyxDQUFDdEMsQ0FBQUE7Z0JBQ3RCRyxjQUFNLENBQUNILEtBQUssQ0FBQywwQkFBMEJBLGlCQUFpQm1CLFFBQVFuQixRQUFRLElBQUltQixNQUFNO1lBQ3BGO1FBQ0Y7UUFFQSxNQUFNb0IsZ0JBQWdCO1lBQ3BCakUsVUFBVStCLENBQUFBLE9BQVFDLElBQUFBLHFCQUFZLEVBQUNELE1BQU07b0JBQUViLFVBQVU7Z0JBQU07UUFDekQ7UUFFQSw4QkFBOEI7UUFDOUIsTUFBTWdELDBCQUEwQjlCLG9DQUFzQixDQUFDK0IsU0FBUyxDQUFDLENBQUNoQztZQUNoRW5DLFVBQVUrQixDQUFBQSxPQUFRQyxJQUFBQSxxQkFBWSxFQUFDRCxNQUFNO29CQUFFeEIsY0FBYzRCO2dCQUFtQjtRQUMxRTtRQUVBLGdDQUFnQztRQUNoQyxNQUFNaUMsMkJBQTJCN0IsbUNBQW9CLENBQUM0QixTQUFTLENBQUMsQ0FBQzdCO1lBQy9EdEMsVUFBVStCLENBQUFBLE9BQVFDLElBQUFBLHFCQUFZLEVBQUNELE1BQU07b0JBQUVsQixlQUFleUI7Z0JBQW9CO1FBQzVFO1FBRUEsNENBQTRDO1FBQzVDLElBQUksT0FBT25DLFdBQVcsYUFBYTtZQUNqQ0EsT0FBT2tFLGdCQUFnQixDQUFDLFVBQVVOO1lBQ2xDNUQsT0FBT2tFLGdCQUFnQixDQUFDLFdBQVdKO1FBQ3JDO1FBRUEsVUFBVTtRQUNWLE9BQU87WUFDTCxJQUFJLE9BQU85RCxXQUFXLGFBQWE7Z0JBQ2pDQSxPQUFPbUUsbUJBQW1CLENBQUMsVUFBVVA7Z0JBQ3JDNUQsT0FBT21FLG1CQUFtQixDQUFDLFdBQVdMO1lBQ3hDO1lBQ0FDO1lBQ0FFO1FBQ0Y7SUFDRixHQUFHO1FBQUNkO0tBQWdCO0lBRXBCLE9BQU9pQixPQUFPQyxNQUFNLENBQUMsQ0FBQyxHQUFHekUsUUFBUTtRQUMvQmdEO1FBQ0FJO1FBQ0FFO1FBQ0FDO1FBQ0FDO1FBQ0FDO1FBQ0FHO1FBQ0FDO1FBQ0FDO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ0QsZUFBZWxCO0lBQ2IsSUFBSTtRQUNGLDJEQUEyRDtRQUMzRCxvQkFBb0I7UUFDcEIsT0FBTztJQUNULEVBQUUsT0FBT2pCLE9BQU87UUFDZEcsY0FBTSxDQUFDSCxLQUFLLENBQUMsMkNBQTJDQSxpQkFBaUJtQixRQUFRbkIsUUFBUSxJQUFJbUIsTUFBTTtRQUNuRyxPQUFPO0lBQ1Q7QUFDRiJ9
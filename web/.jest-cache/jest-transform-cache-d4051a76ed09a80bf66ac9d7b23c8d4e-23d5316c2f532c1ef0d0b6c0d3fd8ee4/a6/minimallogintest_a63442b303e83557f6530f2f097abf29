ab16472b8568fa3ad3525447bfadc8a8
/**
 * Minimal Login Route Test
 */ "use strict";
// Mock all dependencies with minimal setup
jest.mock("@/utils/supabase/server", ()=>({
        getSupabaseServerClient: jest.fn()
    }));
jest.mock("@/lib/utils/logger", ()=>({
        logger: {
            info: jest.fn(),
            error: jest.fn(),
            warn: jest.fn()
        }
    }));
jest.mock("@/lib/core/security/rate-limit", ()=>({
        rateLimiters: {
            auth: {
                check: jest.fn().mockResolvedValue({
                    allowed: true,
                    success: true,
                    remaining: 10,
                    resetTime: new Date(),
                    retryAfter: null
                })
            }
        }
    }));
jest.mock("@/app/api/auth/_shared", ()=>({
        validateCsrfProtection: jest.fn().mockReturnValue(true),
        createCsrfErrorResponse: jest.fn().mockReturnValue(new Response(JSON.stringify({
            error: "CSRF token validation failed"
        }), {
            status: 403
        }))
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _server = require("next/server");
const _route = require("../../../../../app/api/auth/login/route");
describe("Minimal Login Route", ()=>{
    it("should return a response", async ()=>{
        const { getSupabaseServerClient } = require("@/utils/supabase/server");
        // Mock Supabase client to return a simple response
        getSupabaseServerClient.mockResolvedValue({
            auth: {
                signInWithPassword: jest.fn().mockResolvedValue({
                    data: {
                        user: {
                            id: "user-123",
                            email: "test@example.com"
                        },
                        session: {
                            access_token: "token"
                        }
                    },
                    error: null
                })
            },
            from: jest.fn(()=>({
                    select: jest.fn(()=>({
                            eq: jest.fn(()=>({
                                    single: jest.fn().mockResolvedValue({
                                        data: {
                                            id: "user-123",
                                            is_active: true,
                                            username: "testuser"
                                        },
                                        error: null
                                    })
                                }))
                        }))
                }))
        });
        const request = new _server.NextRequest("http://localhost:3000/api/auth/login", {
            method: "POST",
            body: JSON.stringify({
                email: "test@example.com",
                password: "password123"
            }),
            headers: {
                "Content-Type": "application/json"
            }
        });
        const response = await (0, _route.POST)(request);
        expect(response).toBeDefined();
        expect(response).toBeInstanceOf(Response);
        expect(response.status).toBe(200);
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvYXBpL2F1dGgvbWluaW1hbC1sb2dpbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWluaW1hbCBMb2dpbiBSb3V0ZSBUZXN0XG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBQT1NUIH0gZnJvbSAnQC9hcHAvYXBpL2F1dGgvbG9naW4vcm91dGUnO1xuXG4vLyBNb2NrIGFsbCBkZXBlbmRlbmNpZXMgd2l0aCBtaW5pbWFsIHNldHVwXG5qZXN0Lm1vY2soJ0AvdXRpbHMvc3VwYWJhc2Uvc2VydmVyJywgKCkgPT4gKHtcbiAgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQ6IGplc3QuZm4oKSxcbn0pKTtcblxuamVzdC5tb2NrKCdAL2xpYi91dGlscy9sb2dnZXInLCAoKSA9PiAoe1xuICBsb2dnZXI6IHtcbiAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICB3YXJuOiBqZXN0LmZuKCksXG4gIH0sXG59KSk7XG5cbmplc3QubW9jaygnQC9saWIvY29yZS9zZWN1cml0eS9yYXRlLWxpbWl0JywgKCkgPT4gKHtcbiAgcmF0ZUxpbWl0ZXJzOiB7XG4gICAgYXV0aDoge1xuICAgICAgY2hlY2s6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IFxuICAgICAgICBhbGxvd2VkOiB0cnVlLCBcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgcmVtYWluaW5nOiAxMCxcbiAgICAgICAgcmVzZXRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICByZXRyeUFmdGVyOiBudWxsXG4gICAgICB9KVxuICAgIH1cbiAgfVxufSkpO1xuXG5qZXN0Lm1vY2soJ0AvYXBwL2FwaS9hdXRoL19zaGFyZWQnLCAoKSA9PiAoe1xuICB2YWxpZGF0ZUNzcmZQcm90ZWN0aW9uOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxuICBjcmVhdGVDc3JmRXJyb3JSZXNwb25zZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShcbiAgICBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogJ0NTUkYgdG9rZW4gdmFsaWRhdGlvbiBmYWlsZWQnIH0pLCB7IHN0YXR1czogNDAzIH0pXG4gIClcbn0pKTtcblxuZGVzY3JpYmUoJ01pbmltYWwgTG9naW4gUm91dGUnLCAoKSA9PiB7XG4gIGl0KCdzaG91bGQgcmV0dXJuIGEgcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgeyBnZXRTdXBhYmFzZVNlcnZlckNsaWVudCB9ID0gcmVxdWlyZSgnQC91dGlscy9zdXBhYmFzZS9zZXJ2ZXInKTtcbiAgICBcbiAgICAvLyBNb2NrIFN1cGFiYXNlIGNsaWVudCB0byByZXR1cm4gYSBzaW1wbGUgcmVzcG9uc2VcbiAgICBnZXRTdXBhYmFzZVNlcnZlckNsaWVudC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBhdXRoOiB7XG4gICAgICAgIHNpZ25JbldpdGhQYXNzd29yZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VyOiB7IGlkOiAndXNlci0xMjMnLCBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nIH0sXG4gICAgICAgICAgICBzZXNzaW9uOiB7IGFjY2Vzc190b2tlbjogJ3Rva2VuJyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgfSksXG4gICAgICB9LFxuICAgICAgZnJvbTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICBkYXRhOiB7IGlkOiAndXNlci0xMjMnLCBpc19hY3RpdmU6IHRydWUsIHVzZXJuYW1lOiAndGVzdHVzZXInIH0sXG4gICAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9KSksXG4gICAgICB9KSksXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IE5leHRSZXF1ZXN0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2F1dGgvbG9naW4nLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgICB9KSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFBPU1QocmVxdWVzdCk7XG4gICAgXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChyZXNwb25zZSkudG9CZUluc3RhbmNlT2YoUmVzcG9uc2UpO1xuICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImdldFN1cGFiYXNlU2VydmVyQ2xpZW50IiwiZm4iLCJsb2dnZXIiLCJpbmZvIiwiZXJyb3IiLCJ3YXJuIiwicmF0ZUxpbWl0ZXJzIiwiYXV0aCIsImNoZWNrIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJhbGxvd2VkIiwic3VjY2VzcyIsInJlbWFpbmluZyIsInJlc2V0VGltZSIsIkRhdGUiLCJyZXRyeUFmdGVyIiwidmFsaWRhdGVDc3JmUHJvdGVjdGlvbiIsIm1vY2tSZXR1cm5WYWx1ZSIsImNyZWF0ZUNzcmZFcnJvclJlc3BvbnNlIiwiUmVzcG9uc2UiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RhdHVzIiwiZGVzY3JpYmUiLCJpdCIsInJlcXVpcmUiLCJzaWduSW5XaXRoUGFzc3dvcmQiLCJkYXRhIiwidXNlciIsImlkIiwiZW1haWwiLCJzZXNzaW9uIiwiYWNjZXNzX3Rva2VuIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiaXNfYWN0aXZlIiwidXNlcm5hbWUiLCJyZXF1ZXN0IiwiTmV4dFJlcXVlc3QiLCJtZXRob2QiLCJib2R5IiwicGFzc3dvcmQiLCJoZWFkZXJzIiwicmVzcG9uc2UiLCJQT1NUIiwiZXhwZWN0IiwidG9CZURlZmluZWQiLCJ0b0JlSW5zdGFuY2VPZiIsInRvQmUiXSwibWFwcGluZ3MiOiJBQUFBOztDQUVDO0FBS0QsMkNBQTJDO0FBQzNDQSxLQUFLQyxJQUFJLENBQUMsMkJBQTJCLElBQU8sQ0FBQTtRQUMxQ0MseUJBQXlCRixLQUFLRyxFQUFFO0lBQ2xDLENBQUE7QUFFQUgsS0FBS0MsSUFBSSxDQUFDLHNCQUFzQixJQUFPLENBQUE7UUFDckNHLFFBQVE7WUFDTkMsTUFBTUwsS0FBS0csRUFBRTtZQUNiRyxPQUFPTixLQUFLRyxFQUFFO1lBQ2RJLE1BQU1QLEtBQUtHLEVBQUU7UUFDZjtJQUNGLENBQUE7QUFFQUgsS0FBS0MsSUFBSSxDQUFDLGtDQUFrQyxJQUFPLENBQUE7UUFDakRPLGNBQWM7WUFDWkMsTUFBTTtnQkFDSkMsT0FBT1YsS0FBS0csRUFBRSxHQUFHUSxpQkFBaUIsQ0FBQztvQkFDakNDLFNBQVM7b0JBQ1RDLFNBQVM7b0JBQ1RDLFdBQVc7b0JBQ1hDLFdBQVcsSUFBSUM7b0JBQ2ZDLFlBQVk7Z0JBQ2Q7WUFDRjtRQUNGO0lBQ0YsQ0FBQTtBQUVBakIsS0FBS0MsSUFBSSxDQUFDLDBCQUEwQixJQUFPLENBQUE7UUFDekNpQix3QkFBd0JsQixLQUFLRyxFQUFFLEdBQUdnQixlQUFlLENBQUM7UUFDbERDLHlCQUF5QnBCLEtBQUtHLEVBQUUsR0FBR2dCLGVBQWUsQ0FDaEQsSUFBSUUsU0FBU0MsS0FBS0MsU0FBUyxDQUFDO1lBQUVqQixPQUFPO1FBQStCLElBQUk7WUFBRWtCLFFBQVE7UUFBSTtJQUUxRixDQUFBOzs7O3dCQW5DNEI7dUJBQ1A7QUFvQ3JCQyxTQUFTLHVCQUF1QjtJQUM5QkMsR0FBRyw0QkFBNEI7UUFDN0IsTUFBTSxFQUFFeEIsdUJBQXVCLEVBQUUsR0FBR3lCLFFBQVE7UUFFNUMsbURBQW1EO1FBQ25EekIsd0JBQXdCUyxpQkFBaUIsQ0FBQztZQUN4Q0YsTUFBTTtnQkFDSm1CLG9CQUFvQjVCLEtBQUtHLEVBQUUsR0FBR1EsaUJBQWlCLENBQUM7b0JBQzlDa0IsTUFBTTt3QkFDSkMsTUFBTTs0QkFBRUMsSUFBSTs0QkFBWUMsT0FBTzt3QkFBbUI7d0JBQ2xEQyxTQUFTOzRCQUFFQyxjQUFjO3dCQUFRO29CQUNuQztvQkFDQTVCLE9BQU87Z0JBQ1Q7WUFDRjtZQUNBNkIsTUFBTW5DLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7b0JBQ25CaUMsUUFBUXBDLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7NEJBQ3JCa0MsSUFBSXJDLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7b0NBQ2pCbUMsUUFBUXRDLEtBQUtHLEVBQUUsR0FBR1EsaUJBQWlCLENBQUM7d0NBQ2xDa0IsTUFBTTs0Q0FBRUUsSUFBSTs0Q0FBWVEsV0FBVzs0Q0FBTUMsVUFBVTt3Q0FBVzt3Q0FDOURsQyxPQUFPO29DQUNUO2dDQUNGLENBQUE7d0JBQ0YsQ0FBQTtnQkFDRixDQUFBO1FBQ0Y7UUFFQSxNQUFNbUMsVUFBVSxJQUFJQyxtQkFBVyxDQUFDLHdDQUF3QztZQUN0RUMsUUFBUTtZQUNSQyxNQUFNdEIsS0FBS0MsU0FBUyxDQUFDO2dCQUNuQlMsT0FBTztnQkFDUGEsVUFBVTtZQUNaO1lBQ0FDLFNBQVM7Z0JBQ1AsZ0JBQWdCO1lBQ2xCO1FBQ0Y7UUFFQSxNQUFNQyxXQUFXLE1BQU1DLElBQUFBLFdBQUksRUFBQ1A7UUFFNUJRLE9BQU9GLFVBQVVHLFdBQVc7UUFDNUJELE9BQU9GLFVBQVVJLGNBQWMsQ0FBQzlCO1FBQ2hDNEIsT0FBT0YsU0FBU3ZCLE1BQU0sRUFBRTRCLElBQUksQ0FBQztJQUMvQjtBQUNGIn0=
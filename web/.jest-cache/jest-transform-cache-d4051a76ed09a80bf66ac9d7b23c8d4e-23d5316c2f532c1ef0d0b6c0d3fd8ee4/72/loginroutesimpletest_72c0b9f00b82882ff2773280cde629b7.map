{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/auth/login-route-simple.test.ts"],"sourcesContent":["/**\n * Simple Login API Route Tests\n * \n * Tests the POST /api/auth/login endpoint with minimal mocking\n * Focuses on actual functionality rather than heavy mocks\n */\n\nimport { describe, it, expect, beforeEach } from '@jest/globals';\nimport { NextRequest } from 'next/server';\n\n// Test the actual API route structure\ndescribe('Login API Route Structure', () => {\n  it('should have proper route handler structure', async () => {\n    // Test that the route file exists and can be imported\n    const { POST } = await import('@/app/api/auth/login/route');\n    expect(typeof POST).toBe('function');\n  });\n\n  it('should handle missing request body', async () => {\n    const { POST } = await import('@/app/api/auth/login/route');\n    \n    // Create a request without body\n    const request = new NextRequest('http://localhost:3000/api/auth/login', {\n      method: 'POST',\n      headers: {\n        'content-type': 'application/json',\n      },\n    });\n\n    // Mock the required dependencies\n    jest.doMock('@/lib/core/security/rate-limit', () => ({\n      rateLimiters: {\n        auth: {\n          check: jest.fn().mockResolvedValue({ allowed: true }),\n        },\n      },\n    }));\n\n    jest.doMock('@/app/api/auth/_shared', () => ({\n      validateCsrfProtection: jest.fn().mockReturnValue(true),\n      createCsrfErrorResponse: jest.fn().mockReturnValue(new Response('CSRF Error', { status: 403 })),\n    }));\n\n    jest.doMock('@/lib/utils/logger', () => ({\n      logger: {\n        warn: jest.fn(),\n        error: jest.fn(),\n        info: jest.fn(),\n      },\n    }));\n\n    // Mock Supabase to return an error for missing body\n    jest.doMock('@/utils/supabase/server', () => ({\n      getSupabaseServerClient: jest.fn().mockResolvedValue({\n        auth: {\n          signInWithPassword: jest.fn().mockRejectedValue(new Error('Invalid credentials')),\n        },\n      }),\n    }));\n\n    try {\n      const response = await POST(request);\n      expect(response).toBeDefined();\n    } catch (error) {\n      // Expected to fail due to missing body\n      expect(error).toBeDefined();\n    }\n  });\n\n  it('should validate required fields', async () => {\n    const { POST } = await import('@/app/api/auth/login/route');\n    \n    // Create a request with empty body\n    const request = new NextRequest('http://localhost:3000/api/auth/login', {\n      method: 'POST',\n      headers: {\n        'content-type': 'application/json',\n      },\n      body: JSON.stringify({}),\n    });\n\n    // Mock dependencies\n    jest.doMock('@/lib/core/security/rate-limit', () => ({\n      rateLimiters: {\n        auth: {\n          check: jest.fn().mockResolvedValue({ allowed: true }),\n        },\n      },\n    }));\n\n    jest.doMock('@/app/api/auth/_shared', () => ({\n      validateCsrfProtection: jest.fn().mockReturnValue(true),\n      createCsrfErrorResponse: jest.fn().mockReturnValue(new Response('CSRF Error', { status: 403 })),\n    }));\n\n    jest.doMock('@/lib/utils/logger', () => ({\n      logger: {\n        warn: jest.fn(),\n        error: jest.fn(),\n        info: jest.fn(),\n      },\n    }));\n\n    jest.doMock('@/utils/supabase/server', () => ({\n      getSupabaseServerClient: jest.fn().mockResolvedValue({\n        auth: {\n          signInWithPassword: jest.fn(),\n        },\n      }),\n    }));\n\n    try {\n      const response = await POST(request);\n      expect(response).toBeDefined();\n      if (response instanceof Response) {\n        expect(response.status).toBe(400);\n      }\n    } catch (error) {\n      // Expected behavior for validation errors\n      expect(error).toBeDefined();\n    }\n  });\n});\n\ndescribe('Login API Route Integration', () => {\n  it('should have proper error handling structure', () => {\n    // Test that the route has proper error handling\n    expect(true).toBe(true); // Placeholder for actual error handling tests\n  });\n\n  it('should have proper authentication flow', () => {\n    // Test that the route has proper authentication flow\n    expect(true).toBe(true); // Placeholder for actual auth flow tests\n  });\n\n  it('should have proper rate limiting integration', () => {\n    // Test that the route has proper rate limiting\n    expect(true).toBe(true); // Placeholder for actual rate limiting tests\n  });\n});\n"],"names":["describe","it","POST","expect","toBe","request","NextRequest","method","headers","jest","doMock","rateLimiters","auth","check","fn","mockResolvedValue","allowed","validateCsrfProtection","mockReturnValue","createCsrfErrorResponse","Response","status","logger","warn","error","info","getSupabaseServerClient","signInWithPassword","mockRejectedValue","Error","response","toBeDefined","body","JSON","stringify"],"mappings":"AAAA;;;;;CAKC;;;;yBAEgD;wBACrB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE5B,sCAAsC;AACtCA,IAAAA,iBAAQ,EAAC,6BAA6B;IACpCC,IAAAA,WAAE,EAAC,8CAA8C;QAC/C,sDAAsD;QACtD,MAAM,EAAEC,IAAI,EAAE,GAAG,MAAM,mEAAA,QAAO;QAC9BC,IAAAA,eAAM,EAAC,OAAOD,MAAME,IAAI,CAAC;IAC3B;IAEAH,IAAAA,WAAE,EAAC,sCAAsC;QACvC,MAAM,EAAEC,IAAI,EAAE,GAAG,MAAM,mEAAA,QAAO;QAE9B,gCAAgC;QAChC,MAAMG,UAAU,IAAIC,mBAAW,CAAC,wCAAwC;YACtEC,QAAQ;YACRC,SAAS;gBACP,gBAAgB;YAClB;QACF;QAEA,iCAAiC;QACjCC,KAAKC,MAAM,CAAC,kCAAkC,IAAO,CAAA;gBACnDC,cAAc;oBACZC,MAAM;wBACJC,OAAOJ,KAAKK,EAAE,GAAGC,iBAAiB,CAAC;4BAAEC,SAAS;wBAAK;oBACrD;gBACF;YACF,CAAA;QAEAP,KAAKC,MAAM,CAAC,0BAA0B,IAAO,CAAA;gBAC3CO,wBAAwBR,KAAKK,EAAE,GAAGI,eAAe,CAAC;gBAClDC,yBAAyBV,KAAKK,EAAE,GAAGI,eAAe,CAAC,IAAIE,SAAS,cAAc;oBAAEC,QAAQ;gBAAI;YAC9F,CAAA;QAEAZ,KAAKC,MAAM,CAAC,sBAAsB,IAAO,CAAA;gBACvCY,QAAQ;oBACNC,MAAMd,KAAKK,EAAE;oBACbU,OAAOf,KAAKK,EAAE;oBACdW,MAAMhB,KAAKK,EAAE;gBACf;YACF,CAAA;QAEA,oDAAoD;QACpDL,KAAKC,MAAM,CAAC,2BAA2B,IAAO,CAAA;gBAC5CgB,yBAAyBjB,KAAKK,EAAE,GAAGC,iBAAiB,CAAC;oBACnDH,MAAM;wBACJe,oBAAoBlB,KAAKK,EAAE,GAAGc,iBAAiB,CAAC,IAAIC,MAAM;oBAC5D;gBACF;YACF,CAAA;QAEA,IAAI;YACF,MAAMC,WAAW,MAAM5B,KAAKG;YAC5BF,IAAAA,eAAM,EAAC2B,UAAUC,WAAW;QAC9B,EAAE,OAAOP,OAAO;YACd,uCAAuC;YACvCrB,IAAAA,eAAM,EAACqB,OAAOO,WAAW;QAC3B;IACF;IAEA9B,IAAAA,WAAE,EAAC,mCAAmC;QACpC,MAAM,EAAEC,IAAI,EAAE,GAAG,MAAM,mEAAA,QAAO;QAE9B,mCAAmC;QACnC,MAAMG,UAAU,IAAIC,mBAAW,CAAC,wCAAwC;YACtEC,QAAQ;YACRC,SAAS;gBACP,gBAAgB;YAClB;YACAwB,MAAMC,KAAKC,SAAS,CAAC,CAAC;QACxB;QAEA,oBAAoB;QACpBzB,KAAKC,MAAM,CAAC,kCAAkC,IAAO,CAAA;gBACnDC,cAAc;oBACZC,MAAM;wBACJC,OAAOJ,KAAKK,EAAE,GAAGC,iBAAiB,CAAC;4BAAEC,SAAS;wBAAK;oBACrD;gBACF;YACF,CAAA;QAEAP,KAAKC,MAAM,CAAC,0BAA0B,IAAO,CAAA;gBAC3CO,wBAAwBR,KAAKK,EAAE,GAAGI,eAAe,CAAC;gBAClDC,yBAAyBV,KAAKK,EAAE,GAAGI,eAAe,CAAC,IAAIE,SAAS,cAAc;oBAAEC,QAAQ;gBAAI;YAC9F,CAAA;QAEAZ,KAAKC,MAAM,CAAC,sBAAsB,IAAO,CAAA;gBACvCY,QAAQ;oBACNC,MAAMd,KAAKK,EAAE;oBACbU,OAAOf,KAAKK,EAAE;oBACdW,MAAMhB,KAAKK,EAAE;gBACf;YACF,CAAA;QAEAL,KAAKC,MAAM,CAAC,2BAA2B,IAAO,CAAA;gBAC5CgB,yBAAyBjB,KAAKK,EAAE,GAAGC,iBAAiB,CAAC;oBACnDH,MAAM;wBACJe,oBAAoBlB,KAAKK,EAAE;oBAC7B;gBACF;YACF,CAAA;QAEA,IAAI;YACF,MAAMgB,WAAW,MAAM5B,KAAKG;YAC5BF,IAAAA,eAAM,EAAC2B,UAAUC,WAAW;YAC5B,IAAID,oBAAoBV,UAAU;gBAChCjB,IAAAA,eAAM,EAAC2B,SAAST,MAAM,EAAEjB,IAAI,CAAC;YAC/B;QACF,EAAE,OAAOoB,OAAO;YACd,0CAA0C;YAC1CrB,IAAAA,eAAM,EAACqB,OAAOO,WAAW;QAC3B;IACF;AACF;AAEA/B,IAAAA,iBAAQ,EAAC,+BAA+B;IACtCC,IAAAA,WAAE,EAAC,+CAA+C;QAChD,gDAAgD;QAChDE,IAAAA,eAAM,EAAC,MAAMC,IAAI,CAAC,OAAO,8CAA8C;IACzE;IAEAH,IAAAA,WAAE,EAAC,0CAA0C;QAC3C,qDAAqD;QACrDE,IAAAA,eAAM,EAAC,MAAMC,IAAI,CAAC,OAAO,yCAAyC;IACpE;IAEAH,IAAAA,WAAE,EAAC,gDAAgD;QACjD,+CAA+C;QAC/CE,IAAAA,eAAM,EAAC,MAAMC,IAAI,CAAC,OAAO,6CAA6C;IACxE;AACF"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/core/polls-crud.test.ts"],"sourcesContent":["/**\n * Polls CRUD API Tests\n * \n * Tests the polls API endpoints including:\n * - GET /api/polls (list polls)\n * - POST /api/polls (create poll)\n * - GET /api/polls/[id] (get poll)\n * - PUT /api/polls/[id] (update poll)\n * - DELETE /api/polls/[id] (delete poll)\n */\n\nimport { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET, POST } from '@/app/api/polls/route';\n\n// Mock Supabase client\nconst mockSupabaseClient = {\n  from: jest.fn(() => ({\n    select: jest.fn(() => ({\n      eq: jest.fn(() => ({\n        order: jest.fn(() => ({\n          limit: jest.fn(() => ({\n            range: jest.fn().mockResolvedValue({\n              data: [],\n              error: null,\n            }),\n          })),\n        })),\n      })),\n    })),\n    insert: jest.fn(() => ({\n      select: jest.fn().mockResolvedValue({\n        data: [{ id: 'poll-123', title: 'Test Poll' }],\n        error: null,\n      }),\n    })),\n  })),\n  auth: {\n    getUser: jest.fn(),\n  },\n};\n\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(() => Promise.resolve(mockSupabaseClient)),\n}));\n\n// Mock authentication\njest.mock('@/lib/core/auth/server-actions', () => ({\n  getUser: jest.fn(() => Promise.resolve({\n    id: 'user-123',\n    email: 'test@example.com',\n  })),\n}));\n\n// Mock logger\njest.mock('@/lib/utils/logger', () => ({\n  devLog: jest.fn(),\n  logger: {\n    info: jest.fn(),\n    error: jest.fn(),\n  },\n}));\n\ndescribe('Polls CRUD API', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    jest.resetAllMocks();\n  });\n\n  describe('GET /api/polls - List Polls', () => {\n    it('should return list of polls with pagination', async () => {\n      const mockPolls = [\n        {\n          id: 'poll-1',\n          title: 'Test Poll 1',\n          description: 'Description 1',\n          status: 'active',\n          created_at: '2025-01-01T00:00:00Z',\n          total_votes: 10,\n        },\n        {\n          id: 'poll-2',\n          title: 'Test Poll 2',\n          description: 'Description 2',\n          status: 'ended',\n          created_at: '2025-01-02T00:00:00Z',\n          total_votes: 25,\n        },\n      ];\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => ({\n              limit: jest.fn(() => ({\n                range: jest.fn().mockResolvedValue({\n                  data: mockPolls,\n                  error: null,\n                }),\n              })),\n            })),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls?page=1&limit=10');\n      const response = await GET(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.polls).toHaveLength(2);\n      expect(responseData.polls[0].title).toBe('Test Poll 1');\n      expect(responseData.polls[1].title).toBe('Test Poll 2');\n    });\n\n    it('should handle empty poll list', async () => {\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => ({\n              limit: jest.fn(() => ({\n                range: jest.fn().mockResolvedValue({\n                  data: [],\n                  error: null,\n                }),\n              })),\n            })),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      const response = await GET(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.polls).toHaveLength(0);\n    });\n\n    it('should handle database errors', async () => {\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => ({\n              limit: jest.fn(() => ({\n                range: jest.fn().mockResolvedValue({\n                  data: null,\n                  error: { message: 'Database error' },\n                }),\n              })),\n            })),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      const response = await GET(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(responseData.error).toBe('Failed to fetch polls');\n    });\n  });\n\n  describe('POST /api/polls - Create Poll', () => {\n    it('should create a new poll with valid data', async () => {\n      const mockPoll = {\n        id: 'poll-123',\n        title: 'New Test Poll',\n        description: 'Test description',\n        options: [\n          { text: 'Option 1' },\n          { text: 'Option 2' },\n        ],\n        voting_method: 'single',\n        category: 'general',\n        privacy_level: 'public',\n        created_by: 'user-123',\n      };\n\n      mockSupabaseClient.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn().mockResolvedValue({\n            data: [mockPoll],\n            error: null,\n          }),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          description: 'Test description',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n          votingMethod: 'single',\n          category: 'general',\n          privacyLevel: 'public',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(responseData.poll.title).toBe('New Test Poll');\n      expect(responseData.poll.id).toBe('poll-123');\n    });\n\n    it('should reject poll creation without authentication', async () => {\n      const { getUser } = require('@/lib/core/auth/server-actions');\n      getUser.mockResolvedValue(null);\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(responseData.error).toBe('Authentication required to create polls');\n    });\n\n    it('should reject poll creation with missing title', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.error).toBe('Title and at least 2 options are required');\n    });\n\n    it('should reject poll creation with insufficient options', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'Option 1' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.error).toBe('Title and at least 2 options are required');\n    });\n\n    it('should reject poll creation with empty options', async () => {\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.error).toBe('Title and at least 2 options are required');\n    });\n\n    it('should handle inactive user', async () => {\n      const { getUser } = require('@/lib/core/auth/server-actions');\n      getUser.mockResolvedValue({\n        id: 'user-123',\n        email: 'test@example.com',\n      });\n\n      // Mock inactive user profile\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: { is_active: false },\n              error: null,\n            }),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(403);\n      expect(responseData.error).toBe('Active account required to create polls');\n    });\n\n    it('should handle database errors during creation', async () => {\n      mockSupabaseClient.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn().mockResolvedValue({\n            data: null,\n            error: { message: 'Database error' },\n          }),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(responseData.error).toBe('Failed to create poll');\n    });\n\n    it('should sanitize poll options', async () => {\n      const mockPoll = {\n        id: 'poll-123',\n        title: 'New Test Poll',\n        options: [\n          { text: 'Option 1' },\n          { text: 'Option 2' },\n        ],\n      };\n\n      mockSupabaseClient.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn().mockResolvedValue({\n            data: [mockPoll],\n            error: null,\n          }),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n            { text: '' }, // Empty option should be filtered\n            { text: '   ' }, // Whitespace-only option should be filtered\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(responseData.poll.options).toHaveLength(2);\n    });\n\n    it('should handle different voting methods', async () => {\n      const mockPoll = {\n        id: 'poll-123',\n        title: 'New Test Poll',\n        voting_method: 'approval',\n      };\n\n      mockSupabaseClient.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn().mockResolvedValue({\n            data: [mockPoll],\n            error: null,\n          }),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n          votingMethod: 'approval',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(responseData.poll.voting_method).toBe('approval');\n    });\n\n    it('should handle hashtags in poll creation', async () => {\n      const mockPoll = {\n        id: 'poll-123',\n        title: 'New Test Poll',\n        hashtags: ['politics', 'democracy'],\n        primary_hashtag: 'politics',\n      };\n\n      mockSupabaseClient.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn().mockResolvedValue({\n            data: [mockPoll],\n            error: null,\n          }),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n          hashtags: ['politics', 'democracy'],\n          primaryHashtag: 'politics',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(responseData.poll.hashtags).toEqual(['politics', 'democracy']);\n      expect(responseData.poll.primary_hashtag).toBe('politics');\n    });\n  });\n\n  describe('Input Validation', () => {\n    it('should validate poll title length', async () => {\n      const longTitle = 'a'.repeat(201); // Exceeds 200 character limit\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: longTitle,\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.error).toContain('Title too long');\n    });\n\n    it('should validate poll description length', async () => {\n      const longDescription = 'a'.repeat(1001); // Exceeds 1000 character limit\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          description: longDescription,\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.error).toContain('Description too long');\n    });\n\n    it('should validate option text length', async () => {\n      const longOption = 'a'.repeat(201); // Exceeds 200 character limit\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: longOption },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.error).toContain('Option text too long');\n    });\n\n    it('should validate maximum number of options', async () => {\n      const manyOptions = Array.from({ length: 11 }, (_, i) => ({ text: `Option ${i + 1}` }));\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: manyOptions,\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.error).toContain('Too many options');\n    });\n  });\n\n  describe('Security Measures', () => {\n    it('should sanitize HTML in poll title', async () => {\n      const mockPoll = {\n        id: 'poll-123',\n        title: 'New Test Poll',\n      };\n\n      mockSupabaseClient.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn().mockResolvedValue({\n            data: [mockPoll],\n            error: null,\n          }),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: '<script>alert(\"xss\")</script>New Test Poll',\n          options: [\n            { text: 'Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(responseData.poll.title).toBe('New Test Poll');\n    });\n\n    it('should sanitize HTML in poll options', async () => {\n      const mockPoll = {\n        id: 'poll-123',\n        title: 'New Test Poll',\n        options: [\n          { text: 'Option 1' },\n          { text: 'Option 2' },\n        ],\n      };\n\n      mockSupabaseClient.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn().mockResolvedValue({\n            data: [mockPoll],\n            error: null,\n          }),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Test Poll',\n          options: [\n            { text: '<script>alert(\"xss\")</script>Option 1' },\n            { text: 'Option 2' },\n          ],\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(201);\n      expect(responseData.poll.options[0].text).toBe('Option 1');\n    });\n  });\n});\n"],"names":["jest","mock","getSupabaseServerClient","fn","Promise","resolve","mockSupabaseClient","getUser","id","email","devLog","logger","info","error","from","select","eq","order","limit","range","mockResolvedValue","data","insert","title","auth","describe","beforeEach","clearAllMocks","afterEach","resetAllMocks","it","mockPolls","description","status","created_at","total_votes","mockReturnValue","request","NextRequest","response","GET","responseData","json","expect","toBe","polls","toHaveLength","message","mockPoll","options","text","voting_method","category","privacy_level","created_by","method","headers","body","JSON","stringify","votingMethod","privacyLevel","POST","poll","require","single","is_active","hashtags","primary_hashtag","primaryHashtag","toEqual","longTitle","repeat","toContain","longDescription","longOption","manyOptions","Array","length","_","i"],"mappings":"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"}
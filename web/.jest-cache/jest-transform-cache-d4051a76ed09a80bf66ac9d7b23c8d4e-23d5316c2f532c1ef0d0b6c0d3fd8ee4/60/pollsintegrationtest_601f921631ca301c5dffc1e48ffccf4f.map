{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/integration/api/polls-integration.test.ts"],"sourcesContent":["/**\n * Integration Tests - API + Database (20% of tests)\n * \n * These tests focus on how components work together.\n * Test API endpoints with real database operations.\n */\n\nimport { describe, it, expect, beforeAll, afterAll, beforeEach, afterEach } from '@jest/globals';\nimport { createClient } from '@supabase/supabase-js';\nimport { NextRequest } from 'next/server';\nimport { GET, POST } from '@/app/api/polls/route';\nimport { \n  setupTestDatabase, \n  createTestUser, \n  mockAuthentication,\n  cleanupTestDatabase \n} from '../../helpers/database-test-utils';\n\n// Use test database setup\nlet supabase: any;\nlet testUser: any;\n\n// Mock Supabase client for testing\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn().mockImplementation(() => ({\n    from: jest.fn().mockReturnValue({\n      insert: jest.fn().mockReturnValue({\n        select: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({\n            data: null,\n            error: null\n          })\n        })\n      }),\n      select: jest.fn().mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({\n            data: null,\n            error: null\n          })\n        })\n      }),\n      update: jest.fn().mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          select: jest.fn().mockReturnValue({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: null\n            })\n          })\n        })\n      }),\n      delete: jest.fn().mockReturnValue({\n        eq: jest.fn().mockResolvedValue({\n          data: null,\n          error: null\n        })\n      })\n    }),\n    auth: {\n      signInWithPassword: jest.fn().mockResolvedValue({\n        data: {\n          user: {\n            id: 'test-user-id',\n            email: 'test@example.com'\n          }\n        },\n        error: null\n      }),\n      signUp: jest.fn().mockResolvedValue({\n        data: {\n          user: {\n            id: 'test-user-id',\n            email: 'test@example.com'\n          }\n        },\n        error: null\n      }),\n      signOut: jest.fn().mockResolvedValue({\n        error: null\n      }),\n      getUser: jest.fn().mockResolvedValue({\n        data: {\n          user: {\n            id: 'test-user-id',\n            email: 'test@example.com'\n          }\n        },\n        error: null\n      })\n    }\n  }))\n}));\n\ndescribe('Integration Tests - API + Database', () => {\n  let testUser: any;\n  let testPollId: string | null = null;\n\n  beforeAll(async () => {\n    // Setup test database\n    supabase = await setupTestDatabase();\n    testUser = await createTestUser();\n    \n    // Mock authentication\n    await mockAuthentication(supabase, testUser);\n    \n    // Mock successful poll creation\n    supabase.from('polls').insert = jest.fn().mockReturnValue({\n      select: jest.fn().mockReturnValue({\n        single: jest.fn().mockResolvedValue({\n          data: {\n            id: 'test-poll-id',\n            title: 'Test Poll',\n            description: 'A test poll',\n            votingMethod: 'single',\n            options: [\n              { id: 'option-1', text: 'Option 1' },\n              { id: 'option-2', text: 'Option 2' }\n            ],\n            status: 'active',\n            createdAt: new Date().toISOString(),\n            closeAt: new Date(Date.now() + 86400000).toISOString(),\n            createdBy: 'test-user-id'\n          },\n          error: null\n        })\n      })\n    });\n\n    // Mock successful poll retrieval\n    supabase.from('polls').select = jest.fn().mockReturnValue({\n      eq: jest.fn().mockReturnValue({\n        single: jest.fn().mockResolvedValue({\n          data: {\n            id: 'test-poll-id',\n            title: 'Test Poll',\n            description: 'A test poll',\n            votingMethod: 'single',\n            options: [\n              { id: 'option-1', text: 'Option 1' },\n              { id: 'option-2', text: 'Option 2' }\n            ],\n            status: 'active',\n            createdAt: new Date().toISOString(),\n            closeAt: new Date(Date.now() + 86400000).toISOString(),\n            createdBy: 'test-user-id'\n          },\n          error: null\n        })\n      })\n    });\n    \n    console.log('Integration: Test database setup complete');\n  });\n\n  afterAll(async () => {\n    // Clean up test database\n    await cleanupTestDatabase();\n    console.log('Integration: Test database cleanup complete');\n    \n    if (testPollId) {\n      console.log('Integration: Cleaning up test poll:', testPollId);\n      await supabase.from('polls').delete().eq('id', testPollId);\n    }\n\n    // Sign out\n    await supabase.auth.signOut();\n  });\n\n  beforeEach(() => {\n    // Reset test poll ID\n    testPollId = null;\n  });\n\n  afterEach(async () => {\n    if (!supabase) return;\n\n    // Clean up any test data created during the test\n    if (testPollId) {\n      await supabase.from('polls').delete().eq('id', testPollId);\n      testPollId = null;\n    }\n  });\n\n  describe('API + Database Integration', () => {\n    it('should create poll and retrieve it via API', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // Integration test: API + Database\n      // 1. Create poll via database\n      const pollData = {\n        title: 'Integration Test Poll',\n        options: [\n          { text: 'Integration Option 1', votes: 0 },\n          { text: 'Integration Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data: createdPoll, error: createError } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      expect(createError).toBeNull();\n      expect(createdPoll).toBeDefined();\n      expect(createdPoll.title).toBe('Integration Test Poll');\n\n      // Store for cleanup\n      testPollId = createdPoll.id;\n\n      // 2. Retrieve poll via API\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      const response = await GET(request);\n      const responseData = await response.json();\n\n      console.log('Integration: API response:', responseData);\n\n      // 3. Verify integration\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(Array.isArray(responseData.polls)).toBe(true);\n      \n      // Check if our created poll is in the results\n      const foundPoll = responseData.polls.find((poll: any) => poll.poll_id === createdPoll.id);\n      expect(foundPoll).toBeDefined();\n    });\n\n    it('should handle poll creation with voting integration', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // Integration test: Poll creation + Voting\n      // 1. Create poll\n      const pollData = {\n        title: 'Voting Integration Poll',\n        options: [\n          { text: 'Vote Option 1', votes: 0 },\n          { text: 'Vote Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data: poll, error: pollError } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      expect(pollError).toBeNull();\n      expect(poll).toBeDefined();\n\n      // Store for cleanup\n      testPollId = poll.id;\n\n      // 2. Add votes\n      const voteData = {\n        poll_id: poll.id,\n        user_id: testUser.id,\n        option_index: 0,\n        created_at: new Date().toISOString()\n      };\n\n      const { data: vote, error: voteError } = await supabase\n        .from('votes')\n        .insert(voteData)\n        .select()\n        .single();\n\n      expect(voteError).toBeNull();\n      expect(vote).toBeDefined();\n\n      // 3. Update poll vote count\n      const { data: updatedPoll, error: updateError } = await supabase\n        .from('polls')\n        .update({ total_votes: 1 })\n        .eq('id', poll.id)\n        .select()\n        .single();\n\n      expect(updateError).toBeNull();\n      expect(updatedPoll.total_votes).toBe(1);\n\n      // 4. Verify integration\n      const { data: finalPoll, error: finalError } = await supabase\n        .from('polls')\n        .select('*')\n        .eq('id', poll.id)\n        .single();\n\n      expect(finalError).toBeNull();\n      expect(finalPoll.total_votes).toBe(1);\n    });\n\n    it('should handle poll results calculation integration', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // Integration test: Poll + Votes + Results\n      // 1. Create poll\n      const pollData = {\n        title: 'Results Integration Poll',\n        options: [\n          { text: 'Results Option 1', votes: 0 },\n          { text: 'Results Option 2', votes: 0 }\n        ],\n        created_by: testUser.id,\n        total_votes: 0,\n        status: 'active'\n      };\n\n      const { data: poll, error: pollError } = await supabase\n        .from('polls')\n        .insert(pollData)\n        .select()\n        .single();\n\n      expect(pollError).toBeNull();\n      expect(poll).toBeDefined();\n\n      // Store for cleanup\n      testPollId = poll.id;\n\n      // 2. Add multiple votes\n      const votes = [\n        { poll_id: poll.id, user_id: testUser.id, option_index: 0 },\n        { poll_id: poll.id, user_id: 'user2', option_index: 0 },\n        { poll_id: poll.id, user_id: 'user3', option_index: 1 }\n      ];\n\n      for (const vote of votes) {\n        const { error: voteError } = await supabase\n          .from('votes')\n          .insert(vote);\n\n        expect(voteError).toBeNull();\n      }\n\n      // 3. Calculate results\n      const { data: allVotes, error: votesError } = await supabase\n        .from('votes')\n        .select('*')\n        .eq('poll_id', poll.id);\n\n      expect(votesError).toBeNull();\n      expect(allVotes).toHaveLength(3);\n\n      // 4. Verify integration\n      const option1Votes = allVotes.filter((vote: any) => vote.option_index === 0).length;\n      const option2Votes = allVotes.filter((vote: any) => vote.option_index === 1).length;\n\n      expect(option1Votes).toBe(2);\n      expect(option2Votes).toBe(1);\n    });\n  });\n\n  describe('API Error Handling Integration', () => {\n    it('should handle database errors gracefully', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // Integration test: API error handling\n      // 1. Test invalid poll data\n      const invalidPollData = {\n        // Missing required fields\n        options: [\n          { text: 'Invalid Option 1' }\n        ],\n        created_by: testUser.id\n      };\n\n      const { data, error } = await supabase\n        .from('polls')\n        .insert(invalidPollData)\n        .select()\n        .single();\n\n      // 2. Verify error handling\n      expect(error).not.toBeNull();\n      expect(error.message).toContain('title');\n\n      // 3. Test API error response\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      const response = await GET(request);\n      const responseData = await response.json();\n\n      // API should still work despite database error\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n    });\n\n    it('should handle authentication errors integration', async () => {\n      if (!supabase) {\n        console.warn('Skipping test - Real Supabase credentials not set up');\n        return;\n      }\n\n      // Integration test: Authentication + API\n      // 1. Test with invalid user\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email: 'invalid@example.com',\n        password: 'invalidpassword'\n      });\n\n      // 2. Verify authentication error\n      expect(error).not.toBeNull();\n      expect(error.message).toContain('Invalid login credentials');\n\n      // 3. Test API with invalid authentication\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      const response = await GET(request);\n      const responseData = await response.json();\n\n      // API should still work (public endpoint)\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","mockImplementation","from","mockReturnValue","insert","select","single","mockResolvedValue","data","error","eq","update","delete","auth","signInWithPassword","user","id","email","signUp","signOut","getUser","supabase","testUser","describe","testPollId","beforeAll","setupTestDatabase","createTestUser","mockAuthentication","title","description","votingMethod","options","text","status","createdAt","Date","toISOString","closeAt","now","createdBy","console","log","afterAll","cleanupTestDatabase","beforeEach","afterEach","it","warn","pollData","votes","created_by","total_votes","createdPoll","createError","expect","toBeNull","toBeDefined","toBe","request","NextRequest","response","GET","responseData","json","success","Array","isArray","polls","foundPoll","find","poll","poll_id","pollError","voteData","user_id","option_index","created_at","vote","voteError","updatedPoll","updateError","finalPoll","finalError","allVotes","votesError","toHaveLength","option1Votes","filter","length","option2Votes","invalidPollData","not","message","toContain","password"],"mappings":"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"}
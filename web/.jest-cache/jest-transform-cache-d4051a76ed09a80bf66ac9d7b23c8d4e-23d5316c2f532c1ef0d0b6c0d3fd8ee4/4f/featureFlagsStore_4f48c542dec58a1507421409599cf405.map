{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/stores/featureFlagsStore.ts"],"sourcesContent":["/**\n * Feature Flags Store\n * \n * Centralized Zustand store for feature flag management.\n * Replaces the complex useFeatureFlags hook system with a simpler,\n * more performant Zustand-based approach.\n * \n * Created: October 10, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { create } from 'zustand';\nimport { devtools, persist } from 'zustand/middleware';\nimport { immer } from 'zustand/middleware/immer';\n\nimport { \n  FEATURE_FLAGS, \n  featureFlagManager,\n  type FeatureFlag,\n  type FeatureFlagKey,\n  type FeatureFlagConfig,\n  type FeatureFlagMetadata\n} from '@/lib/core/feature-flags';\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport interface FeatureFlagsStore {\n  // State\n  flags: Map<string, FeatureFlag>;\n  enabledFlags: string[];\n  disabledFlags: string[];\n  categories: Record<string, string[]>;\n  systemInfo: {\n    totalFlags: number;\n    enabledFlags: number;\n    disabledFlags: number;\n    environment: string;\n    categories: Record<string, number>;\n  };\n  isLoading: boolean;\n  error: string | null;\n  \n  // Actions\n  enableFlag: (flagId: string) => boolean;\n  disableFlag: (flagId: string) => boolean;\n  toggleFlag: (flagId: string) => boolean;\n  isEnabled: (flagId: string) => boolean;\n  isDisabled: (flagId: string) => boolean;\n  getFlag: (flagId: string) => FeatureFlag | undefined;\n  getFlagsByCategory: (category: string) => FeatureFlag[];\n  getEnabledFlags: () => FeatureFlag[];\n  getDisabledFlags: () => FeatureFlag[];\n  updateFlagMetadata: (flagId: string, metadata: FeatureFlagMetadata) => boolean;\n  resetFlags: () => void;\n  exportConfig: () => FeatureFlagConfig;\n  importConfig: (config: FeatureFlagConfig) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n  clearError: () => void;\n  \n  // Initialization\n  initializeFlags: () => void;\n}\n\n// ============================================================================\n// STORE IMPLEMENTATION\n// ============================================================================\n\nexport const useFeatureFlagsStore = create<FeatureFlagsStore>()(\n  devtools(\n    persist(\n      immer((set, get) => ({\n        // Initial State\n        flags: new Map(),\n        enabledFlags: [],\n        disabledFlags: [],\n        categories: {},\n        systemInfo: {\n          totalFlags: 0,\n          enabledFlags: 0,\n          disabledFlags: 0,\n          environment: process.env.NODE_ENV || 'development',\n          categories: {}\n        },\n        isLoading: true,\n        error: null,\n\n        // Actions\n        enableFlag: (flagId: string) => {\n          const success = featureFlagManager.enable(flagId);\n          if (success) {\n            set((state) => {\n              const flag = state.flags.get(flagId);\n              if (flag) {\n                flag.enabled = true;\n                state.enabledFlags = Array.from(state.flags.values())\n                  .filter(f => f.enabled)\n                  .map(f => f.id);\n                state.disabledFlags = Array.from(state.flags.values())\n                  .filter(f => !f.enabled)\n                  .map(f => f.id);\n                state.systemInfo.enabledFlags = state.enabledFlags.length;\n                state.systemInfo.disabledFlags = state.disabledFlags.length;\n              }\n            });\n          }\n          return success;\n        },\n\n        disableFlag: (flagId: string) => {\n          const success = featureFlagManager.disable(flagId);\n          if (success) {\n            set((state) => {\n              const flag = state.flags.get(flagId);\n              if (flag) {\n                flag.enabled = false;\n                state.enabledFlags = Array.from(state.flags.values())\n                  .filter(f => f.enabled)\n                  .map(f => f.id);\n                state.disabledFlags = Array.from(state.flags.values())\n                  .filter(f => !f.enabled)\n                  .map(f => f.id);\n                state.systemInfo.enabledFlags = state.enabledFlags.length;\n                state.systemInfo.disabledFlags = state.disabledFlags.length;\n              }\n            });\n          }\n          return success;\n        },\n\n        toggleFlag: (flagId: string) => {\n          const success = featureFlagManager.toggle(flagId);\n          if (success) {\n            set((state) => {\n              const flag = state.flags.get(flagId);\n              if (flag) {\n                flag.enabled = !flag.enabled;\n                state.enabledFlags = Array.from(state.flags.values())\n                  .filter(f => f.enabled)\n                  .map(f => f.id);\n                state.disabledFlags = Array.from(state.flags.values())\n                  .filter(f => !f.enabled)\n                  .map(f => f.id);\n                state.systemInfo.enabledFlags = state.enabledFlags.length;\n                state.systemInfo.disabledFlags = state.disabledFlags.length;\n              }\n            });\n          }\n          return success;\n        },\n\n        isEnabled: (flagId: string) => {\n          return featureFlagManager.isEnabled(flagId);\n        },\n\n        isDisabled: (flagId: string) => {\n          return !featureFlagManager.isEnabled(flagId);\n        },\n\n        getFlag: (flagId: string) => {\n          return get().flags.get(flagId);\n        },\n\n        getFlagsByCategory: (category: string) => {\n          return Array.from(get().flags.values())\n            .filter(flag => flag.category === category);\n        },\n\n        getEnabledFlags: () => {\n          return Array.from(get().flags.values())\n            .filter(flag => flag.enabled);\n        },\n\n        getDisabledFlags: () => {\n          return Array.from(get().flags.values())\n            .filter(flag => !flag.enabled);\n        },\n\n        updateFlagMetadata: (flagId: string, metadata: FeatureFlagMetadata) => {\n          const success = featureFlagManager.updateFlagMetadata(flagId, metadata);\n          // Note: FeatureFlag type doesn't include metadata, so we just return success\n          return success;\n        },\n\n        resetFlags: () => {\n          featureFlagManager.reset();\n          set((state) => {\n            // Reset to default flags\n            const defaultFlags = new Map();\n            Object.entries(FEATURE_FLAGS).forEach(([key, enabled]) => {\n              defaultFlags.set(key, {\n                id: key,\n                name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n                enabled,\n                description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n                key: key as FeatureFlagKey,\n                category: 'general'\n              });\n            });\n            state.flags = defaultFlags;\n            state.enabledFlags = Array.from(defaultFlags.values())\n              .filter(f => f.enabled)\n              .map(f => f.id);\n            state.disabledFlags = Array.from(defaultFlags.values())\n              .filter(f => !f.enabled)\n              .map(f => f.id);\n            state.systemInfo.enabledFlags = state.enabledFlags.length;\n            state.systemInfo.disabledFlags = state.disabledFlags.length;\n          });\n        },\n\n        exportConfig: () => {\n          return featureFlagManager.exportConfig();\n        },\n\n        importConfig: (config: FeatureFlagConfig) => {\n          featureFlagManager.importConfig(config);\n          get().initializeFlags();\n        },\n\n        setLoading: (loading: boolean) => {\n          set((state) => {\n            state.isLoading = loading;\n          });\n        },\n\n        setError: (error: string | null) => {\n          set((state) => {\n            state.error = error;\n          });\n        },\n\n        clearError: () => {\n          set((state) => {\n            state.error = null;\n          });\n        },\n\n        initializeFlags: () => {\n          set((state) => {\n            state.isLoading = true;\n            state.error = null;\n          });\n\n          try {\n            // Get all flags from the feature flag manager\n            const allFlags = featureFlagManager.getAllFlags();\n            \n            set((state) => {\n              state.flags = allFlags;\n              state.enabledFlags = Array.from(allFlags.values())\n                .filter(f => f.enabled)\n                .map(f => f.id);\n              state.disabledFlags = Array.from(allFlags.values())\n                .filter(f => !f.enabled)\n                .map(f => f.id);\n              \n              // Update system info\n              state.systemInfo.totalFlags = allFlags.size;\n              state.systemInfo.enabledFlags = state.enabledFlags.length;\n              state.systemInfo.disabledFlags = state.disabledFlags.length;\n              \n              // Categorize flags\n              const categories: Record<string, string[]> = {};\n              allFlags.forEach((flag) => {\n                const category = flag.category || 'uncategorized';\n                if (!categories[category]) {\n                  categories[category] = [];\n                }\n                categories[category].push(flag.id);\n              });\n              state.categories = categories;\n              state.systemInfo.categories = Object.fromEntries(\n                Object.entries(categories).map(([cat, flags]) => [cat, flags.length])\n              );\n              \n              state.isLoading = false;\n            });\n\n            // Subscribe to flag changes\n            featureFlagManager.subscribe((flags) => {\n              set((state) => {\n                const flagMap = new Map();\n                Object.entries(flags).forEach(([key, enabled]) => {\n                  flagMap.set(key, {\n                    id: key,\n                    name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n                    enabled,\n                    description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n                    key: key as FeatureFlagKey,\n                    category: 'general'\n                  });\n                });\n                state.flags = flagMap;\n                state.enabledFlags = Array.from(flagMap.values())\n                  .filter(f => f.enabled)\n                  .map(f => f.id);\n                state.disabledFlags = Array.from(flagMap.values())\n                  .filter(f => !f.enabled)\n                  .map(f => f.id);\n                state.systemInfo.enabledFlags = state.enabledFlags.length;\n                state.systemInfo.disabledFlags = state.disabledFlags.length;\n              });\n            });\n\n          } catch (error) {\n            set((state) => {\n              state.error = error instanceof Error ? error.message : 'Failed to initialize feature flags';\n              state.isLoading = false;\n            });\n          }\n        }\n      })),\n      {\n        name: 'feature-flags-storage',\n        partialize: (state) => ({\n          flags: Object.fromEntries(state.flags),\n          enabledFlags: state.enabledFlags,\n          disabledFlags: state.disabledFlags,\n          categories: state.categories,\n          systemInfo: state.systemInfo\n        })\n      }\n    ),\n    { name: 'feature-flags-store' }\n  )\n);\n\n// ============================================================================\n// SELECTORS\n// ============================================================================\n\nexport const useFeatureFlags = () => useFeatureFlagsStore();\nexport const useFeatureFlag = (flagId: string) => useFeatureFlagsStore(state => state.flags.get(flagId));\nexport const useIsFeatureEnabled = (flagId: string) => useFeatureFlagsStore(state => state.isEnabled(flagId));\nexport const useIsFeatureDisabled = (flagId: string) => useFeatureFlagsStore(state => state.isDisabled(flagId));\nexport const useEnabledFlags = () => useFeatureFlagsStore(state => state.getEnabledFlags());\nexport const useDisabledFlags = () => useFeatureFlagsStore(state => state.getDisabledFlags());\nexport const useFlagsByCategory = (category: string) => useFeatureFlagsStore(state => state.getFlagsByCategory(category));\nexport const useFeatureFlagsLoading = () => useFeatureFlagsStore(state => state.isLoading);\nexport const useFeatureFlagsError = () => useFeatureFlagsStore(state => state.error);\nexport const useFeatureFlagsSystemInfo = () => useFeatureFlagsStore(state => state.systemInfo);\n\n// ============================================================================\n// ACTIONS\n// ============================================================================\n\nexport const useFeatureFlagsActions = () => useFeatureFlagsStore(state => ({\n  enableFlag: state.enableFlag,\n  disableFlag: state.disableFlag,\n  toggleFlag: state.toggleFlag,\n  updateFlagMetadata: state.updateFlagMetadata,\n  resetFlags: state.resetFlags,\n  exportConfig: state.exportConfig,\n  importConfig: state.importConfig,\n  setLoading: state.setLoading,\n  setError: state.setError,\n  clearError: state.clearError,\n  initializeFlags: state.initializeFlags\n}));\n\n// ============================================================================\n// UTILITIES\n// ============================================================================\n\nexport const useFeatureFlagWithDependencies = (flagId: string) => {\n  const flag = useFeatureFlag(flagId);\n  const isEnabled = useIsFeatureEnabled(flagId);\n  const isLoading = useFeatureFlagsLoading();\n  \n  return {\n    enabled: isEnabled,\n    disabled: !isEnabled,\n    dependenciesMet: true, // Simplified for now\n    flag,\n    loading: isLoading\n  };\n};\n\nexport const useFeatureFlagManagement = () => {\n  const flags = useFeatureFlagsStore(state => state.flags);\n  const systemInfo = useFeatureFlagsSystemInfo();\n  const actions = useFeatureFlagsActions();\n  const loading = useFeatureFlagsLoading();\n  \n  return {\n    flags,\n    systemInfo,\n    updateFlagMetadata: actions.updateFlagMetadata,\n    reset: actions.resetFlags,\n    exportConfig: actions.exportConfig,\n    importConfig: actions.importConfig,\n    loading\n  };\n};\n"],"names":["useDisabledFlags","useEnabledFlags","useFeatureFlag","useFeatureFlagManagement","useFeatureFlagWithDependencies","useFeatureFlags","useFeatureFlagsActions","useFeatureFlagsError","useFeatureFlagsLoading","useFeatureFlagsStore","useFeatureFlagsSystemInfo","useFlagsByCategory","useIsFeatureDisabled","useIsFeatureEnabled","create","devtools","persist","immer","set","get","flags","Map","enabledFlags","disabledFlags","categories","systemInfo","totalFlags","environment","process","env","NODE_ENV","isLoading","error","enableFlag","flagId","success","featureFlagManager","enable","state","flag","enabled","Array","from","values","filter","f","map","id","length","disableFlag","disable","toggleFlag","toggle","isEnabled","isDisabled","getFlag","getFlagsByCategory","category","getEnabledFlags","getDisabledFlags","updateFlagMetadata","metadata","resetFlags","reset","defaultFlags","Object","entries","FEATURE_FLAGS","forEach","key","name","replace","toLowerCase","l","toUpperCase","description","exportConfig","importConfig","config","initializeFlags","setLoading","loading","setError","clearError","allFlags","getAllFlags","size","push","fromEntries","cat","subscribe","flagMap","Error","message","partialize","disabled","dependenciesMet","actions"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/polls-get-only.test.ts"],"sourcesContent":["/**\n * Polls API GET Test - Focus on GET endpoint only\n * \n * This test focuses specifically on the GET endpoint to debug the mocking issue.\n */\n\nimport { describe, it, expect, beforeEach } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET } from '@/app/api/polls/route';\n\n// Mock the Supabase server client\nconst mockSupabaseClient = {\n  from: jest.fn(() => ({\n    select: jest.fn(() => ({\n      eq: jest.fn(() => ({\n        limit: jest.fn().mockResolvedValue({\n          data: [\n            {\n              id: 'poll-1',\n              title: 'Test Poll 1',\n              total_votes: 10,\n              options: [\n                { id: 'opt-1', text: 'Option 1', votes: 6 },\n                { id: 'opt-2', text: 'Option 2', votes: 4 }\n              ],\n              status: 'active'\n            }\n          ],\n          error: null,\n        }),\n      })),\n    })),\n  })),\n};\n\n// Mock the Supabase server client\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(),\n}));\n\n// Mock logger\njest.mock('@/lib/utils/logger', () => ({\n  devLog: jest.fn(),\n}));\n\ndescribe('Polls API GET - Mock Supabase Client', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Set up the mock to return our mock client\n    const { getSupabaseServerClient } = require('@/utils/supabase/server');\n    getSupabaseServerClient.mockResolvedValue(mockSupabaseClient);\n  });\n\n  it('should return list of polls with mock data', async () => {\n    const request = new NextRequest('http://localhost:3000/api/polls');\n    \n    // Check if the mock is set up correctly\n    const { getSupabaseServerClient } = require('@/utils/supabase/server');\n    console.log('Mock function:', getSupabaseServerClient);\n    console.log('Mock calls:', getSupabaseServerClient.mock.calls);\n    \n    const response = await GET(request);\n    const responseData = await response.json();\n\n    console.log('GET response status:', response.status);\n    console.log('GET response data:', responseData);\n    console.log('Mock was called:', getSupabaseServerClient.mock.calls.length > 0);\n    console.log('Mock calls:', getSupabaseServerClient.mock.calls);\n    \n    // Check what the mock is actually returning\n    const mockResult = await getSupabaseServerClient();\n    console.log('Mock result:', mockResult);\n    console.log('Mock result type:', typeof mockResult);\n    console.log('Mock result from method:', mockResult?.from);\n\n    expect(response.status).toBe(200);\n    expect(responseData.success).toBe(true);\n    expect(Array.isArray(responseData.polls)).toBe(true);\n    expect(responseData.polls.length).toBe(1);\n    expect(responseData.count).toBe(1);\n    expect(responseData.message).toBe('Aggregated poll results only - no individual vote data');\n  });\n});\n"],"names":["jest","mock","getSupabaseServerClient","fn","devLog","mockSupabaseClient","from","select","eq","limit","mockResolvedValue","data","id","title","total_votes","options","text","votes","status","error","describe","beforeEach","clearAllMocks","require","it","request","NextRequest","console","log","calls","response","GET","responseData","json","length","mockResult","expect","toBe","success","Array","isArray","polls","count","message"],"mappings":"AAAA;;;;CAIC;AA+BD,kCAAkC;AAClCA,KAAKC,IAAI,CAAC,2BAA2B,IAAO,CAAA;QAC1CC,yBAAyBF,KAAKG,EAAE;IAClC,CAAA;AAEA,cAAc;AACdH,KAAKC,IAAI,CAAC,sBAAsB,IAAO,CAAA;QACrCG,QAAQJ,KAAKG,EAAE;IACjB,CAAA;;;;yBArCiD;wBACrB;uBACR;AAEpB,kCAAkC;AAClC,MAAME,qBAAqB;IACzBC,MAAMN,KAAKG,EAAE,CAAC,IAAO,CAAA;YACnBI,QAAQP,KAAKG,EAAE,CAAC,IAAO,CAAA;oBACrBK,IAAIR,KAAKG,EAAE,CAAC,IAAO,CAAA;4BACjBM,OAAOT,KAAKG,EAAE,GAAGO,iBAAiB,CAAC;gCACjCC,MAAM;oCACJ;wCACEC,IAAI;wCACJC,OAAO;wCACPC,aAAa;wCACbC,SAAS;4CACP;gDAAEH,IAAI;gDAASI,MAAM;gDAAYC,OAAO;4CAAE;4CAC1C;gDAAEL,IAAI;gDAASI,MAAM;gDAAYC,OAAO;4CAAE;yCAC3C;wCACDC,QAAQ;oCACV;iCACD;gCACDC,OAAO;4BACT;wBACF,CAAA;gBACF,CAAA;QACF,CAAA;AACF;AAYAC,IAAAA,iBAAQ,EAAC,wCAAwC;IAC/CC,IAAAA,mBAAU,EAAC;QACTrB,KAAKsB,aAAa;QAElB,4CAA4C;QAC5C,MAAM,EAAEpB,uBAAuB,EAAE,GAAGqB,QAAQ;QAC5CrB,wBAAwBQ,iBAAiB,CAACL;IAC5C;IAEAmB,IAAAA,WAAE,EAAC,8CAA8C;QAC/C,MAAMC,UAAU,IAAIC,mBAAW,CAAC;QAEhC,wCAAwC;QACxC,MAAM,EAAExB,uBAAuB,EAAE,GAAGqB,QAAQ;QAC5CI,QAAQC,GAAG,CAAC,kBAAkB1B;QAC9ByB,QAAQC,GAAG,CAAC,eAAe1B,wBAAwBD,IAAI,CAAC4B,KAAK;QAE7D,MAAMC,WAAW,MAAMC,IAAAA,UAAG,EAACN;QAC3B,MAAMO,eAAe,MAAMF,SAASG,IAAI;QAExCN,QAAQC,GAAG,CAAC,wBAAwBE,SAASZ,MAAM;QACnDS,QAAQC,GAAG,CAAC,sBAAsBI;QAClCL,QAAQC,GAAG,CAAC,oBAAoB1B,wBAAwBD,IAAI,CAAC4B,KAAK,CAACK,MAAM,GAAG;QAC5EP,QAAQC,GAAG,CAAC,eAAe1B,wBAAwBD,IAAI,CAAC4B,KAAK;QAE7D,4CAA4C;QAC5C,MAAMM,aAAa,MAAMjC;QACzByB,QAAQC,GAAG,CAAC,gBAAgBO;QAC5BR,QAAQC,GAAG,CAAC,qBAAqB,OAAOO;QACxCR,QAAQC,GAAG,CAAC,4BAA4BO,YAAY7B;QAEpD8B,IAAAA,eAAM,EAACN,SAASZ,MAAM,EAAEmB,IAAI,CAAC;QAC7BD,IAAAA,eAAM,EAACJ,aAAaM,OAAO,EAAED,IAAI,CAAC;QAClCD,IAAAA,eAAM,EAACG,MAAMC,OAAO,CAACR,aAAaS,KAAK,GAAGJ,IAAI,CAAC;QAC/CD,IAAAA,eAAM,EAACJ,aAAaS,KAAK,CAACP,MAAM,EAAEG,IAAI,CAAC;QACvCD,IAAAA,eAAM,EAACJ,aAAaU,KAAK,EAAEL,IAAI,CAAC;QAChCD,IAAAA,eAAM,EAACJ,aAAaW,OAAO,EAAEN,IAAI,CAAC;IACpC;AACF"}
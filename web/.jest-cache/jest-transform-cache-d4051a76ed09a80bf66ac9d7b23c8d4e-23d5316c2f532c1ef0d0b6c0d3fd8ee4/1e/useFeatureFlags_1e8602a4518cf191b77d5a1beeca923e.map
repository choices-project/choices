{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/hooks/useFeatureFlags.ts"],"sourcesContent":["/**\n * React Hook for Feature Flags\n * \n * Provides easy access to feature flags in React components with automatic\n * re-rendering when flags change.\n */\n\nimport { useState, useEffect, useCallback, useMemo } from 'react';\n\nimport type { \n  FeatureFlag, \n  FeatureFlagManager,\n  FeatureFlagConfig} from '@/lib/core/feature-flags';\nimport { \n  featureFlagManager,\n  isFeatureEnabled as _isFeatureEnabled,\n  enableFeature as _enableFeature,\n  disableFeature as _disableFeature,\n  toggleFeature as _toggleFeature,\n  getFeatureFlag as _getFeatureFlag,\n  getAllFeatureFlags as _getAllFeatureFlags\n} from '@/lib/core/feature-flags';\n\nexport interface UseFeatureFlagsReturn {\n  // Flag checking\n  isEnabled: (flagId: string) => boolean;\n  isDisabled: (flagId: string) => boolean;\n  \n  // Flag management\n  enable: (flagId: string) => boolean;\n  disable: (flagId: string) => boolean;\n  toggle: (flagId: string) => boolean;\n  \n  // Flag data\n  getFlag: (flagId: string) => FeatureFlag | undefined;\n  getAllFlags: () => Map<string, FeatureFlag>;\n  getEnabledFlags: () => FeatureFlag[];\n  getDisabledFlags: () => FeatureFlag[];\n  getFlagsByCategory: (category: 'core' | 'optional' | 'experimental') => FeatureFlag[];\n  \n  // System info\n  systemInfo: {\n    totalFlags: number;\n    enabledFlags: number;\n    disabledFlags: number;\n    environment: string;\n    categories: Record<string, number>;\n  };\n  \n  // Loading state\n  loading: boolean;\n  \n  // Manager instance\n  manager: FeatureFlagManager;\n}\n\n/**\n * Main hook for feature flags\n */\nexport function useFeatureFlags(): UseFeatureFlagsReturn {\n  const [, setFlags] = useState<Map<string, FeatureFlag>>(new Map());\n  const [loading, setLoading] = useState(true);\n\n  // Initialize flags on mount\n  useEffect(() => {\n    setFlags(featureFlagManager.getAllFlags());\n    setLoading(false);\n\n    // Subscribe to flag changes\n    const subscription = featureFlagManager.subscribe((newFlags) => {\n      setFlags(new Map(Object.entries(newFlags).map(([key, enabled]) => [key, {\n        id: key,\n        name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n        enabled,\n        description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`\n      }])));\n    });\n\n    return subscription.unsubscribe;\n  }, []);\n\n  // Memoized functions to prevent unnecessary re-renders\n  const isEnabled = useCallback((flagId: string): boolean => {\n    return featureFlagManager.isEnabled(flagId);\n  }, []);\n\n  const isDisabled = useCallback((flagId: string): boolean => {\n    return !featureFlagManager.isEnabled(flagId);\n  }, []);\n\n  const enable = useCallback((flagId: string): boolean => {\n    return featureFlagManager.enable(flagId);\n  }, []);\n\n  const disable = useCallback((flagId: string): boolean => {\n    return featureFlagManager.disable(flagId);\n  }, []);\n\n  const toggle = useCallback((flagId: string): boolean => {\n    return featureFlagManager.toggle(flagId);\n  }, []);\n\n  const getFlag = useCallback((flagId: string): FeatureFlag | undefined => {\n    return featureFlagManager.getFlag(flagId) || undefined;\n  }, []);\n\n  const getAllFlags = useCallback((): Map<string, FeatureFlag> => {\n    return featureFlagManager.getAllFlags();\n  }, []);\n\n  const getEnabledFlags = useCallback((): FeatureFlag[] => {\n    return featureFlagManager.getEnabledFlags();\n  }, []);\n\n  const getDisabledFlags = useCallback((): FeatureFlag[] => {\n    return featureFlagManager.getDisabledFlags();\n  }, []);\n\n  const getFlagsByCategory = useCallback((category: 'core' | 'optional' | 'experimental'): FeatureFlag[] => {\n    return featureFlagManager.getFlagsByCategory(category);\n  }, []);\n\n  const systemInfo = useMemo(() => {\n    return featureFlagManager.getSystemInfo();\n  }, []);\n\n  return {\n    isEnabled,\n    isDisabled,\n    enable,\n    disable,\n    toggle,\n    getFlag,\n    getAllFlags,\n    getEnabledFlags,\n    getDisabledFlags,\n    getFlagsByCategory,\n    systemInfo,\n    loading,\n    manager: featureFlagManager\n  };\n}\n\n/**\n * Hook for checking a specific feature flag\n */\nexport function useFeatureFlag(flagId: string): {\n  enabled: boolean;\n  disabled: boolean;\n  flag: FeatureFlag | undefined;\n  toggle: () => boolean;\n  enable: () => boolean;\n  disable: () => boolean;\n  loading: boolean;\n} {\n  const { isEnabled, isDisabled, toggle, enable, disable, getFlag, loading } = useFeatureFlags();\n  \n  const enabled = isEnabled(flagId);\n  const disabled = isDisabled(flagId);\n  const flag = getFlag(flagId);\n\n  const handleToggle = useCallback(() => toggle(flagId), [toggle, flagId]);\n  const handleEnable = useCallback(() => enable(flagId), [enable, flagId]);\n  const handleDisable = useCallback(() => disable(flagId), [disable, flagId]);\n\n  return {\n    enabled,\n    disabled,\n    flag,\n    toggle: handleToggle,\n    enable: handleEnable,\n    disable: handleDisable,\n    loading\n  };\n}\n\n/**\n * Hook for checking multiple feature flags at once\n */\nexport function useFeatureFlagsBatch(flagIds: string[]): {\n  enabled: Record<string, boolean>;\n  disabled: Record<string, boolean>;\n  allEnabled: boolean;\n  anyEnabled: boolean;\n  loading: boolean;\n} {\n  const { isEnabled, isDisabled, loading } = useFeatureFlags();\n  \n  const enabled = useMemo(() => {\n    const result: Record<string, boolean> = {};\n    flagIds.forEach(id => {\n      result[id] = isEnabled(id);\n    });\n    return result;\n  }, [flagIds, isEnabled]);\n\n  const disabled = useMemo(() => {\n    const result: Record<string, boolean> = {};\n    flagIds.forEach(id => {\n      result[id] = isDisabled(id);\n    });\n    return result;\n  }, [flagIds, isDisabled]);\n\n  const allEnabled = useMemo(() => {\n    return flagIds.every(id => enabled[id]);\n  }, [flagIds, enabled]);\n\n  const anyEnabled = useMemo(() => {\n    return flagIds.some(id => enabled[id]);\n  }, [flagIds, enabled]);\n\n  return {\n    enabled,\n    disabled,\n    allEnabled,\n    anyEnabled,\n    loading\n  };\n}\n\n/**\n * Hook for feature flags with dependencies\n */\nexport function useFeatureFlagWithDependencies(flagId: string): {\n  enabled: boolean;\n  disabled: boolean;\n  dependenciesMet: boolean;\n  flag: FeatureFlag | undefined;\n  loading: boolean;\n} {\n  const { isEnabled, isDisabled, getFlag, loading } = useFeatureFlags();\n  \n  const enabled = isEnabled(flagId);\n  const disabled = isDisabled(flagId);\n  const flag = getFlag(flagId);\n  \n  const dependenciesMet = useMemo(() => {\n    return featureFlagManager.areDependenciesEnabled(flagId);\n  }, [flagId]);\n\n  return {\n    enabled,\n    disabled,\n    dependenciesMet,\n    flag,\n    loading\n  };\n}\n\n/**\n * Hook for admin/management features\n */\nexport function useFeatureFlagManagement(): {\n  flags: Map<string, FeatureFlag>;\n  systemInfo: {\n    totalFlags: number;\n    enabledFlags: number;\n    disabledFlags: number;\n    environment: string;\n    categories: Record<string, number>;\n  };\n  updateFlagMetadata: (flagId: string, metadata: Record<string, unknown>) => boolean;\n  reset: () => void;\n  exportConfig: () => Record<string, unknown>;\n  importConfig: (config: FeatureFlagConfig) => void;\n  loading: boolean;\n} {\n  const { getAllFlags, systemInfo, loading, manager } = useFeatureFlags();\n  \n  const flags = getAllFlags();\n  \n  const updateFlagMetadata = useCallback((flagId: string, metadata: Record<string, any>) => {\n    return manager.updateFlagMetadata(flagId, metadata);\n  }, [manager]);\n\n  const reset = useCallback(() => {\n    manager.reset();\n  }, [manager]);\n\n  const exportConfig = useCallback(() => {\n    return manager.exportConfig();\n  }, [manager]);\n\n  const importConfig = useCallback((config: FeatureFlagConfig) => {\n    manager.importConfig(config);\n  }, [manager]);\n\n  return {\n    flags,\n    systemInfo,\n    updateFlagMetadata,\n    reset,\n    exportConfig,\n    importConfig,\n    loading\n  };\n}\n\n// Export convenience functions for non-hook usage\nexport const isFeatureEnabled = _isFeatureEnabled;\nexport const enableFeature = _enableFeature;\nexport const disableFeature = _disableFeature;\nexport const toggleFeature = _toggleFeature;\nexport const getFeatureFlag = _getFeatureFlag;\nexport const getAllFeatureFlags = _getAllFeatureFlags;\n"],"names":["disableFeature","enableFeature","getAllFeatureFlags","getFeatureFlag","isFeatureEnabled","toggleFeature","useFeatureFlag","useFeatureFlagManagement","useFeatureFlagWithDependencies","useFeatureFlags","useFeatureFlagsBatch","setFlags","useState","Map","loading","setLoading","useEffect","featureFlagManager","getAllFlags","subscription","subscribe","newFlags","Object","entries","map","key","enabled","id","name","replace","toLowerCase","l","toUpperCase","description","unsubscribe","isEnabled","useCallback","flagId","isDisabled","enable","disable","toggle","getFlag","undefined","getEnabledFlags","getDisabledFlags","getFlagsByCategory","category","systemInfo","useMemo","getSystemInfo","manager","disabled","flag","handleToggle","handleEnable","handleDisable","flagIds","result","forEach","allEnabled","every","anyEnabled","some","dependenciesMet","areDependenciesEnabled","flags","updateFlagMetadata","metadata","reset","exportConfig","importConfig","config","_isFeatureEnabled","_enableFeature","_disableFeature","_toggleFeature","_getFeatureFlag","_getAllFeatureFlags"],"mappings":"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"}
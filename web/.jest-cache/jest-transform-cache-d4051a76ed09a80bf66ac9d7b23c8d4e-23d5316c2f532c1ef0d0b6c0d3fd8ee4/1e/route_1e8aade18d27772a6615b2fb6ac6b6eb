3ab899687544db0fa7925520943c32e0
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    GET: function() {
        return GET;
    },
    POST: function() {
        return POST;
    },
    dynamic: function() {
        return dynamic;
    }
});
const _server = require("next/server");
const _middleware = require("../../../lib/core/auth/middleware");
const _logger = require("../../../lib/utils/logger");
const _server1 = require("../../../utils/supabase/server");
const dynamic = "force-dynamic";
async function GET(request) {
    try {
        const supabaseClient = await (0, _server1.getSupabaseServerClient)();
        if (!supabaseClient) {
            return _server.NextResponse.json({
                error: "Supabase client not available"
            }, {
                status: 500
            });
        }
        const { searchParams } = new URL(request.url);
        const limit = parseInt(searchParams.get("limit") || "20");
        const _status = searchParams.get("status") || "active";
        // Fetch active polls from polls table
        let polls;
        try {
            (0, _logger.devLog)("Fetching active polls from polls table...");
            const { data: directPolls, error: directError } = await supabaseClient.from("polls").select("id, title, total_votes, options, status").eq("status", "active").limit(limit);
            if (directError) {
                throw directError;
            }
            (0, _logger.devLog)("Found polls:", directPolls.length || 0);
            // Manually aggregate results (temporary solution)
            polls = (directPolls ?? []).map((poll)=>({
                    id: poll.id,
                    title: poll.title,
                    total_votes: poll.total_votes || 0,
                    aggregated_results: Array.isArray(poll.options) ? poll.options.reduce((acc, option, index)=>{
                        acc[`option_${index + 1}`] = option.votes || 0;
                        return acc;
                    }, {}) : {},
                    status: poll.status
                }));
        } catch (fallbackError) {
            (0, _logger.devLog)("Error fetching polls:", fallbackError);
            return _server.NextResponse.json({
                error: "Failed to fetch polls"
            }, {
                status: 500
            });
        }
        // Additional security: ensure no sensitive data is returned
        const sanitizedPolls = polls.map((poll)=>({
                poll_id: poll.id,
                title: poll.title,
                total_votes: poll.total_votes,
                // Only include safe fields
                status: "active",
                created_at: new Date().toISOString()
            })) || [];
        return _server.NextResponse.json({
            success: true,
            polls: sanitizedPolls,
            count: sanitizedPolls.length,
            message: "Aggregated poll results only - no individual vote data"
        });
    } catch (error) {
        (0, _logger.devLog)("Error in polls API:", error);
        return _server.NextResponse.json({
            error: "Internal server error"
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // Always require authentication - no E2E bypasses
        const supabase = await (0, _server1.getSupabaseServerClient)();
        if (!supabase) {
            return _server.NextResponse.json({
                error: "Supabase client not available"
            }, {
                status: 500
            });
        }
        // Always require authentication
        let user;
        try {
            user = await (0, _middleware.getUser)();
        } catch (error) {
            (0, _logger.devLog)("Authentication error during poll creation:", error);
            return _server.NextResponse.json({
                error: "Authentication required to create polls"
            }, {
                status: 401
            });
        }
        // Check if user is authenticated
        if (!user) {
            return _server.NextResponse.json({
                error: "Authentication required to create polls"
            }, {
                status: 401
            });
        }
        // Verify user is active
        if (user) {
            const { data: userProfile } = await supabase.from("user_profiles").select("is_active").eq("user_id", user.id).single();
            if (!userProfile || !("is_active" in userProfile) || !userProfile.is_active) {
                return _server.NextResponse.json({
                    error: "Active account required to create polls"
                }, {
                    status: 403
                });
            }
        }
        const body = await request.json();
        const { title, options, votingMethod = "single", description, category = "general", privacyLevel = "public", allowMultipleVotes = false, showResults = true, allowComments = true, endTime, hashtags = [], primaryHashtag } = body;
        // Validate required fields
        if (!title || !options || !Array.isArray(options) || options.length < 2) {
            return _server.NextResponse.json({
                error: "Title and at least 2 options are required"
            }, {
                status: 400
            });
        }
        // Sanitize and validate options
        const sanitizedOptions = options.filter((option)=>typeof option === "string" && option.trim().length > 0).map((option)=>option.trim()).slice(0, 10); // Limit to 10 options max
        if (sanitizedOptions.length < 2) {
            return _server.NextResponse.json({
                error: "At least 2 valid options are required"
            }, {
                status: 400
            });
        }
        // Create poll with user as creator
        const { data: poll, error: pollError } = await supabase.from("polls").insert({
            title: title.trim(),
            description: description?.trim() || null,
            options: sanitizedOptions,
            voting_method: votingMethod,
            privacy_level: privacyLevel,
            category,
            status: "active",
            created_by: user?.id || "",
            total_votes: 0,
            participation: 0,
            end_time: endTime || null,
            hashtags: hashtags || [],
            primary_hashtag: primaryHashtag || null,
            poll_settings: {
                allowMultipleVotes,
                showResults,
                allowComments
            }
        }).select().single();
        if (pollError) {
            (0, _logger.devLog)("Error creating poll:", pollError);
            return _server.NextResponse.json({
                error: "Failed to create poll",
                details: pollError
            }, {
                status: 500
            });
        }
        // Return sanitized poll data (no sensitive information)
        const sanitizedPoll = poll && !("error" in poll) ? {
            id: poll.id,
            title: poll.title,
            description: poll.description,
            options: poll.options,
            voting_method: poll.voting_method,
            privacy_level: poll.privacy_level,
            category: poll.category,
            status: poll.status,
            total_votes: poll.total_votes,
            participation: poll.participation,
            end_time: poll.end_time,
            hashtags: poll.hashtags || [],
            primary_hashtag: poll.primary_hashtag,
            poll_settings: poll.poll_settings,
            created_at: poll.created_at
        } : null;
        return _server.NextResponse.json(sanitizedPoll);
    } catch (error) {
        (0, _logger.devLog)("Error in polls API:", error);
        return _server.NextResponse.json({
            error: "Internal server error"
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9hcHAvYXBpL3BvbGxzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3R9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuaW1wb3J0IHsgZ2V0VXNlciB9IGZyb20gJ0AvbGliL2NvcmUvYXV0aC9taWRkbGV3YXJlJztcbmltcG9ydCB7IGRldkxvZyB9IGZyb20gJ0AvbGliL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRTdXBhYmFzZVNlcnZlckNsaWVudCB9IGZyb20gJ0AvdXRpbHMvc3VwYWJhc2Uvc2VydmVyJztcblxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSAnZm9yY2UtZHluYW1pYyc7XG5cbi8vIFR5cGUgZGVmaW5pdGlvbnMgZm9yIHBvbGwgZGF0YVxuaW50ZXJmYWNlIFBvbGxPcHRpb24ge1xuICBpZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIHZvdGVzPzogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgX1BvbGxEYXRhIHtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgdG90YWxfdm90ZXM6IG51bWJlcjtcbiAgb3B0aW9uczogUG9sbE9wdGlvbltdO1xuICBzdGF0dXM6IHN0cmluZztcbn1cblxuLy8gR0VUIC9hcGkvcG9sbHMgLSBHZXQgYWN0aXZlIHBvbGxzIHdpdGggYWdncmVnYXRlZCByZXN1bHRzIG9ubHlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZUNsaWVudCA9IGF3YWl0IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XG4gICAgXG4gICAgaWYgKCFzdXBhYmFzZUNsaWVudCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnU3VwYWJhc2UgY2xpZW50IG5vdCBhdmFpbGFibGUnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChzZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpIHx8ICcyMCcpO1xuICAgIGNvbnN0IF9zdGF0dXMgPSBzZWFyY2hQYXJhbXMuZ2V0KCdzdGF0dXMnKSB8fCAnYWN0aXZlJztcblxuICAgIC8vIEZldGNoIGFjdGl2ZSBwb2xscyBmcm9tIHBvbGxzIHRhYmxlXG4gICAgbGV0IHBvbGxzO1xuXG4gICAgdHJ5IHtcbiAgICAgIGRldkxvZygnRmV0Y2hpbmcgYWN0aXZlIHBvbGxzIGZyb20gcG9sbHMgdGFibGUuLi4nKTtcbiAgICAgIGNvbnN0IHsgZGF0YTogZGlyZWN0UG9sbHMsIGVycm9yOiBkaXJlY3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VDbGllbnRcbiAgICAgICAgLmZyb20oJ3BvbGxzJylcbiAgICAgICAgLnNlbGVjdCgnaWQsIHRpdGxlLCB0b3RhbF92b3Rlcywgb3B0aW9ucywgc3RhdHVzJylcbiAgICAgICAgLmVxKCdzdGF0dXMnLCAnYWN0aXZlJylcbiAgICAgICAgLmxpbWl0KGxpbWl0KTtcblxuICAgICAgaWYgKGRpcmVjdEVycm9yKSB7XG4gICAgICAgIHRocm93IGRpcmVjdEVycm9yO1xuICAgICAgfVxuXG4gICAgICBkZXZMb2coJ0ZvdW5kIHBvbGxzOicsIGRpcmVjdFBvbGxzLmxlbmd0aCB8fCAwKTtcblxuICAgICAgLy8gTWFudWFsbHkgYWdncmVnYXRlIHJlc3VsdHMgKHRlbXBvcmFyeSBzb2x1dGlvbilcbiAgICAgIHBvbGxzID0gKGRpcmVjdFBvbGxzID8/IFtdKS5tYXAocG9sbCA9PiAoe1xuICAgICAgICBpZDogcG9sbC5pZCxcbiAgICAgICAgdGl0bGU6IHBvbGwudGl0bGUsXG4gICAgICAgIHRvdGFsX3ZvdGVzOiBwb2xsLnRvdGFsX3ZvdGVzIHx8IDAsXG4gICAgICAgIGFnZ3JlZ2F0ZWRfcmVzdWx0czogQXJyYXkuaXNBcnJheShwb2xsLm9wdGlvbnMpID8gXG4gICAgICAgICAgcG9sbC5vcHRpb25zLnJlZHVjZSgoYWNjOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+LCBvcHRpb246IFBvbGxPcHRpb24sIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIGFjY1tgb3B0aW9uXyR7aW5kZXggKyAxfWBdID0gb3B0aW9uLnZvdGVzIHx8IDA7XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgIH0sIHt9KSA6IHt9LFxuICAgICAgICBzdGF0dXM6IHBvbGwuc3RhdHVzXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZmFsbGJhY2tFcnJvcikge1xuICAgICAgZGV2TG9nKCdFcnJvciBmZXRjaGluZyBwb2xsczonLCBmYWxsYmFja0Vycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFkZGl0aW9uYWwgc2VjdXJpdHk6IGVuc3VyZSBubyBzZW5zaXRpdmUgZGF0YSBpcyByZXR1cm5lZFxuICAgIGNvbnN0IHNhbml0aXplZFBvbGxzID0gcG9sbHMubWFwKHBvbGwgPT4gKHtcbiAgICAgIHBvbGxfaWQ6IHBvbGwuaWQsXG4gICAgICB0aXRsZTogcG9sbC50aXRsZSxcbiAgICAgIHRvdGFsX3ZvdGVzOiBwb2xsLnRvdGFsX3ZvdGVzLFxuICAgICAgLy8gT25seSBpbmNsdWRlIHNhZmUgZmllbGRzXG4gICAgICBzdGF0dXM6ICdhY3RpdmUnLCAvLyBBbHdheXMgc2hvdyBhcyBhY3RpdmUgZm9yIHB1YmxpYyB2aWV3XG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksIC8vIEdlbmVyaWMgdGltZXN0YW1wXG4gICAgfSkpIHx8IFtdO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBwb2xsczogc2FuaXRpemVkUG9sbHMsXG4gICAgICBjb3VudDogc2FuaXRpemVkUG9sbHMubGVuZ3RoLFxuICAgICAgbWVzc2FnZTogJ0FnZ3JlZ2F0ZWQgcG9sbCByZXN1bHRzIG9ubHkgLSBubyBpbmRpdmlkdWFsIHZvdGUgZGF0YSdcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGRldkxvZygnRXJyb3IgaW4gcG9sbHMgQVBJOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG4vLyBQT1NUIC9hcGkvcG9sbHMgLSBDcmVhdGUgbmV3IHBvbGwgKGF1dGhlbnRpY2F0ZWQgdXNlcnMgb25seSlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gQWx3YXlzIHJlcXVpcmUgYXV0aGVudGljYXRpb24gLSBubyBFMkUgYnlwYXNzZXNcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XG4gICAgXG4gICAgaWYgKCFzdXBhYmFzZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnU3VwYWJhc2UgY2xpZW50IG5vdCBhdmFpbGFibGUnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBBbHdheXMgcmVxdWlyZSBhdXRoZW50aWNhdGlvblxuICAgIGxldCB1c2VyO1xuICAgIHRyeSB7XG4gICAgICB1c2VyID0gYXdhaXQgZ2V0VXNlcigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ0F1dGhlbnRpY2F0aW9uIGVycm9yIGR1cmluZyBwb2xsIGNyZWF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cbiAgICBcbiAgICAvLyBWZXJpZnkgdXNlciBpcyBhY3RpdmVcbiAgICBpZiAodXNlcikge1xuICAgICAgY29uc3QgeyBkYXRhOiB1c2VyUHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxuICAgICAgICAuc2VsZWN0KCdpc19hY3RpdmUnKVxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmICghdXNlclByb2ZpbGUgfHwgISgnaXNfYWN0aXZlJyBpbiB1c2VyUHJvZmlsZSkgfHwgIXVzZXJQcm9maWxlLmlzX2FjdGl2ZSkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ0FjdGl2ZSBhY2NvdW50IHJlcXVpcmVkIHRvIGNyZWF0ZSBwb2xscycgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBcbiAgICAgIHRpdGxlLCBcbiAgICAgIG9wdGlvbnMsIFxuICAgICAgdm90aW5nTWV0aG9kID0gJ3NpbmdsZScsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIGNhdGVnb3J5ID0gJ2dlbmVyYWwnLFxuICAgICAgcHJpdmFjeUxldmVsID0gJ3B1YmxpYycsXG4gICAgICBhbGxvd011bHRpcGxlVm90ZXMgPSBmYWxzZSxcbiAgICAgIHNob3dSZXN1bHRzID0gdHJ1ZSxcbiAgICAgIGFsbG93Q29tbWVudHMgPSB0cnVlLFxuICAgICAgZW5kVGltZSxcbiAgICAgIGhhc2h0YWdzID0gW10sXG4gICAgICBwcmltYXJ5SGFzaHRhZ1xuICAgIH0gPSBib2R5O1xuXG4gICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgaWYgKCF0aXRsZSB8fCAhb3B0aW9ucyB8fCAhQXJyYXkuaXNBcnJheShvcHRpb25zKSB8fCBvcHRpb25zLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1RpdGxlIGFuZCBhdCBsZWFzdCAyIG9wdGlvbnMgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gU2FuaXRpemUgYW5kIHZhbGlkYXRlIG9wdGlvbnNcbiAgICBjb25zdCBzYW5pdGl6ZWRPcHRpb25zID0gb3B0aW9uc1xuICAgICAgLmZpbHRlcihvcHRpb24gPT4gdHlwZW9mIG9wdGlvbiA9PT0gJ3N0cmluZycgJiYgb3B0aW9uLnRyaW0oKS5sZW5ndGggPiAwKVxuICAgICAgLm1hcChvcHRpb24gPT4gb3B0aW9uLnRyaW0oKSlcbiAgICAgIC5zbGljZSgwLCAxMCk7IC8vIExpbWl0IHRvIDEwIG9wdGlvbnMgbWF4XG5cbiAgICBpZiAoc2FuaXRpemVkT3B0aW9ucy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdBdCBsZWFzdCAyIHZhbGlkIG9wdGlvbnMgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHBvbGwgd2l0aCB1c2VyIGFzIGNyZWF0b3JcbiAgICBjb25zdCB7IGRhdGE6IHBvbGwsIGVycm9yOiBwb2xsRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHRpdGxlOiB0aXRsZS50cmltKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbj8udHJpbSgpIHx8IG51bGwsXG4gICAgICAgIG9wdGlvbnM6IHNhbml0aXplZE9wdGlvbnMsXG4gICAgICAgIHZvdGluZ19tZXRob2Q6IHZvdGluZ01ldGhvZCxcbiAgICAgICAgcHJpdmFjeV9sZXZlbDogcHJpdmFjeUxldmVsLFxuICAgICAgICBjYXRlZ29yeSxcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgY3JlYXRlZF9ieTogdXNlcj8uaWQgfHwgJycsXG4gICAgICAgIHRvdGFsX3ZvdGVzOiAwLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uOiAwLFxuICAgICAgICBlbmRfdGltZTogZW5kVGltZSB8fCBudWxsLFxuICAgICAgICBoYXNodGFnczogaGFzaHRhZ3MgfHwgW10sXG4gICAgICAgIHByaW1hcnlfaGFzaHRhZzogcHJpbWFyeUhhc2h0YWcgfHwgbnVsbCxcbiAgICAgICAgcG9sbF9zZXR0aW5nczoge1xuICAgICAgICAgIGFsbG93TXVsdGlwbGVWb3RlcyxcbiAgICAgICAgICBzaG93UmVzdWx0cyxcbiAgICAgICAgICBhbGxvd0NvbW1lbnRzXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChwb2xsRXJyb3IpIHtcbiAgICAgIGRldkxvZygnRXJyb3IgY3JlYXRpbmcgcG9sbDonLCBwb2xsRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBwb2xsJywgZGV0YWlsczogcG9sbEVycm9yIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gc2FuaXRpemVkIHBvbGwgZGF0YSAobm8gc2Vuc2l0aXZlIGluZm9ybWF0aW9uKVxuICAgIGNvbnN0IHNhbml0aXplZFBvbGwgPSBwb2xsICYmICEoJ2Vycm9yJyBpbiBwb2xsKSA/IHtcbiAgICAgIGlkOiBwb2xsLmlkLFxuICAgICAgdGl0bGU6IHBvbGwudGl0bGUsXG4gICAgICBkZXNjcmlwdGlvbjogcG9sbC5kZXNjcmlwdGlvbixcbiAgICAgIG9wdGlvbnM6IHBvbGwub3B0aW9ucyxcbiAgICAgIHZvdGluZ19tZXRob2Q6IHBvbGwudm90aW5nX21ldGhvZCxcbiAgICAgIHByaXZhY3lfbGV2ZWw6IHBvbGwucHJpdmFjeV9sZXZlbCxcbiAgICAgIGNhdGVnb3J5OiBwb2xsLmNhdGVnb3J5LFxuICAgICAgc3RhdHVzOiBwb2xsLnN0YXR1cyxcbiAgICAgIHRvdGFsX3ZvdGVzOiBwb2xsLnRvdGFsX3ZvdGVzLFxuICAgICAgcGFydGljaXBhdGlvbjogcG9sbC5wYXJ0aWNpcGF0aW9uLFxuICAgICAgZW5kX3RpbWU6IHBvbGwuZW5kX3RpbWUsXG4gICAgICBoYXNodGFnczogcG9sbC5oYXNodGFncyB8fCBbXSxcbiAgICAgIHByaW1hcnlfaGFzaHRhZzogcG9sbC5wcmltYXJ5X2hhc2h0YWcsXG4gICAgICBwb2xsX3NldHRpbmdzOiBwb2xsLnBvbGxfc2V0dGluZ3MsXG4gICAgICBjcmVhdGVkX2F0OiBwb2xsLmNyZWF0ZWRfYXRcbiAgICB9IDogbnVsbDtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihzYW5pdGl6ZWRQb2xsKTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGRldkxvZygnRXJyb3IgaW4gcG9sbHMgQVBJOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkdFVCIsIlBPU1QiLCJkeW5hbWljIiwicmVxdWVzdCIsInN1cGFiYXNlQ2xpZW50IiwiZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJsaW1pdCIsInBhcnNlSW50IiwiZ2V0IiwiX3N0YXR1cyIsInBvbGxzIiwiZGV2TG9nIiwiZGF0YSIsImRpcmVjdFBvbGxzIiwiZGlyZWN0RXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJsZW5ndGgiLCJtYXAiLCJwb2xsIiwiaWQiLCJ0aXRsZSIsInRvdGFsX3ZvdGVzIiwiYWdncmVnYXRlZF9yZXN1bHRzIiwiQXJyYXkiLCJpc0FycmF5Iiwib3B0aW9ucyIsInJlZHVjZSIsImFjYyIsIm9wdGlvbiIsImluZGV4Iiwidm90ZXMiLCJmYWxsYmFja0Vycm9yIiwic2FuaXRpemVkUG9sbHMiLCJwb2xsX2lkIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInN1Y2Nlc3MiLCJjb3VudCIsIm1lc3NhZ2UiLCJzdXBhYmFzZSIsInVzZXIiLCJnZXRVc2VyIiwidXNlclByb2ZpbGUiLCJzaW5nbGUiLCJpc19hY3RpdmUiLCJib2R5Iiwidm90aW5nTWV0aG9kIiwiZGVzY3JpcHRpb24iLCJjYXRlZ29yeSIsInByaXZhY3lMZXZlbCIsImFsbG93TXVsdGlwbGVWb3RlcyIsInNob3dSZXN1bHRzIiwiYWxsb3dDb21tZW50cyIsImVuZFRpbWUiLCJoYXNodGFncyIsInByaW1hcnlIYXNodGFnIiwic2FuaXRpemVkT3B0aW9ucyIsImZpbHRlciIsInRyaW0iLCJzbGljZSIsInBvbGxFcnJvciIsImluc2VydCIsInZvdGluZ19tZXRob2QiLCJwcml2YWN5X2xldmVsIiwiY3JlYXRlZF9ieSIsInBhcnRpY2lwYXRpb24iLCJlbmRfdGltZSIsInByaW1hcnlfaGFzaHRhZyIsInBvbGxfc2V0dGluZ3MiLCJkZXRhaWxzIiwic2FuaXRpemVkUG9sbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7SUF5QnNCQSxHQUFHO2VBQUhBOztJQStFQUMsSUFBSTtlQUFKQTs7SUFqR1RDLE9BQU87ZUFBUEE7Ozt3QkFOZ0I7NEJBRUw7d0JBQ0Q7eUJBQ2lCO0FBRWpDLE1BQU1BLFVBQVU7QUFrQmhCLGVBQWVGLElBQUlHLE9BQW9CO0lBQzVDLElBQUk7UUFDRixNQUFNQyxpQkFBaUIsTUFBTUMsSUFBQUEsZ0NBQXVCO1FBRXBELElBQUksQ0FBQ0QsZ0JBQWdCO1lBQ25CLE9BQU9FLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBZ0MsR0FDekM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU0sRUFBRUMsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSVIsUUFBUVMsR0FBRztRQUM1QyxNQUFNQyxRQUFRQyxTQUFTSixhQUFhSyxHQUFHLENBQUMsWUFBWTtRQUNwRCxNQUFNQyxVQUFVTixhQUFhSyxHQUFHLENBQUMsYUFBYTtRQUU5QyxzQ0FBc0M7UUFDdEMsSUFBSUU7UUFFSixJQUFJO1lBQ0ZDLElBQUFBLGNBQU0sRUFBQztZQUNQLE1BQU0sRUFBRUMsTUFBTUMsV0FBVyxFQUFFWixPQUFPYSxXQUFXLEVBQUUsR0FBRyxNQUFNakIsZUFDckRrQixJQUFJLENBQUMsU0FDTEMsTUFBTSxDQUFDLDJDQUNQQyxFQUFFLENBQUMsVUFBVSxVQUNiWCxLQUFLLENBQUNBO1lBRVQsSUFBSVEsYUFBYTtnQkFDZixNQUFNQTtZQUNSO1lBRUFILElBQUFBLGNBQU0sRUFBQyxnQkFBZ0JFLFlBQVlLLE1BQU0sSUFBSTtZQUU3QyxrREFBa0Q7WUFDbERSLFFBQVEsQUFBQ0csQ0FBQUEsZUFBZSxFQUFFLEFBQUQsRUFBR00sR0FBRyxDQUFDQyxDQUFBQSxPQUFTLENBQUE7b0JBQ3ZDQyxJQUFJRCxLQUFLQyxFQUFFO29CQUNYQyxPQUFPRixLQUFLRSxLQUFLO29CQUNqQkMsYUFBYUgsS0FBS0csV0FBVyxJQUFJO29CQUNqQ0Msb0JBQW9CQyxNQUFNQyxPQUFPLENBQUNOLEtBQUtPLE9BQU8sSUFDNUNQLEtBQUtPLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDLENBQUNDLEtBQTZCQyxRQUFvQkM7d0JBQ3BFRixHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUVFLFFBQVEsRUFBRSxDQUFDLENBQUMsR0FBR0QsT0FBT0UsS0FBSyxJQUFJO3dCQUM3QyxPQUFPSDtvQkFDVCxHQUFHLENBQUMsS0FBSyxDQUFDO29CQUNaM0IsUUFBUWtCLEtBQUtsQixNQUFNO2dCQUNyQixDQUFBO1FBQ0YsRUFBRSxPQUFPK0IsZUFBZTtZQUN0QnRCLElBQUFBLGNBQU0sRUFBQyx5QkFBeUJzQjtZQUNoQyxPQUFPbEMsb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUF3QixHQUNqQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsNERBQTREO1FBQzVELE1BQU1nQyxpQkFBaUJ4QixNQUFNUyxHQUFHLENBQUNDLENBQUFBLE9BQVMsQ0FBQTtnQkFDeENlLFNBQVNmLEtBQUtDLEVBQUU7Z0JBQ2hCQyxPQUFPRixLQUFLRSxLQUFLO2dCQUNqQkMsYUFBYUgsS0FBS0csV0FBVztnQkFDN0IsMkJBQTJCO2dCQUMzQnJCLFFBQVE7Z0JBQ1JrQyxZQUFZLElBQUlDLE9BQU9DLFdBQVc7WUFDcEMsQ0FBQSxNQUFPLEVBQUU7UUFFVCxPQUFPdkMsb0JBQVksQ0FBQ0MsSUFBSSxDQUFDO1lBQ3ZCdUMsU0FBUztZQUNUN0IsT0FBT3dCO1lBQ1BNLE9BQU9OLGVBQWVoQixNQUFNO1lBQzVCdUIsU0FBUztRQUNYO0lBRUYsRUFBRSxPQUFPeEMsT0FBTztRQUNkVSxJQUFBQSxjQUFNLEVBQUMsdUJBQXVCVjtRQUM5QixPQUFPRixvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO1lBQUVDLE9BQU87UUFBd0IsR0FDakM7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0Y7QUFHTyxlQUFlUixLQUFLRSxPQUFvQjtJQUM3QyxJQUFJO1FBQ0Ysa0RBQWtEO1FBQ2xELE1BQU04QyxXQUFXLE1BQU01QyxJQUFBQSxnQ0FBdUI7UUFFOUMsSUFBSSxDQUFDNEMsVUFBVTtZQUNiLE9BQU8zQyxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQWdDLEdBQ3pDO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxnQ0FBZ0M7UUFDaEMsSUFBSXlDO1FBQ0osSUFBSTtZQUNGQSxPQUFPLE1BQU1DLElBQUFBLG1CQUFPO1FBQ3RCLEVBQUUsT0FBTzNDLE9BQU87WUFDZFUsSUFBQUEsY0FBTSxFQUFDLDhDQUE4Q1Y7WUFDckQsT0FBT0Ysb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUEwQyxHQUNuRDtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsaUNBQWlDO1FBQ2pDLElBQUksQ0FBQ3lDLE1BQU07WUFDVCxPQUFPNUMsb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUEwQyxHQUNuRDtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsd0JBQXdCO1FBQ3hCLElBQUl5QyxNQUFNO1lBQ1IsTUFBTSxFQUFFL0IsTUFBTWlDLFdBQVcsRUFBRSxHQUFHLE1BQU1ILFNBQ2pDM0IsSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUMsYUFDUEMsRUFBRSxDQUFDLFdBQVcwQixLQUFLdEIsRUFBRSxFQUNyQnlCLE1BQU07WUFFVCxJQUFJLENBQUNELGVBQWUsQ0FBRSxDQUFBLGVBQWVBLFdBQVUsS0FBTSxDQUFDQSxZQUFZRSxTQUFTLEVBQUU7Z0JBQzNFLE9BQU9oRCxvQkFBWSxDQUFDQyxJQUFJLENBQ3RCO29CQUFFQyxPQUFPO2dCQUEwQyxHQUNuRDtvQkFBRUMsUUFBUTtnQkFBSTtZQUVsQjtRQUNGO1FBRUEsTUFBTThDLE9BQU8sTUFBTXBELFFBQVFJLElBQUk7UUFDL0IsTUFBTSxFQUNKc0IsS0FBSyxFQUNMSyxPQUFPLEVBQ1BzQixlQUFlLFFBQVEsRUFDdkJDLFdBQVcsRUFDWEMsV0FBVyxTQUFTLEVBQ3BCQyxlQUFlLFFBQVEsRUFDdkJDLHFCQUFxQixLQUFLLEVBQzFCQyxjQUFjLElBQUksRUFDbEJDLGdCQUFnQixJQUFJLEVBQ3BCQyxPQUFPLEVBQ1BDLFdBQVcsRUFBRSxFQUNiQyxjQUFjLEVBQ2YsR0FBR1Y7UUFFSiwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDMUIsU0FBUyxDQUFDSyxXQUFXLENBQUNGLE1BQU1DLE9BQU8sQ0FBQ0MsWUFBWUEsUUFBUVQsTUFBTSxHQUFHLEdBQUc7WUFDdkUsT0FBT25CLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBNEMsR0FDckQ7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLGdDQUFnQztRQUNoQyxNQUFNeUQsbUJBQW1CaEMsUUFDdEJpQyxNQUFNLENBQUM5QixDQUFBQSxTQUFVLE9BQU9BLFdBQVcsWUFBWUEsT0FBTytCLElBQUksR0FBRzNDLE1BQU0sR0FBRyxHQUN0RUMsR0FBRyxDQUFDVyxDQUFBQSxTQUFVQSxPQUFPK0IsSUFBSSxJQUN6QkMsS0FBSyxDQUFDLEdBQUcsS0FBSywwQkFBMEI7UUFFM0MsSUFBSUgsaUJBQWlCekMsTUFBTSxHQUFHLEdBQUc7WUFDL0IsT0FBT25CLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBd0MsR0FDakQ7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLG1DQUFtQztRQUNuQyxNQUFNLEVBQUVVLE1BQU1RLElBQUksRUFBRW5CLE9BQU84RCxTQUFTLEVBQUUsR0FBRyxNQUFNckIsU0FDNUMzQixJQUFJLENBQUMsU0FDTGlELE1BQU0sQ0FBQztZQUNOMUMsT0FBT0EsTUFBTXVDLElBQUk7WUFDakJYLGFBQWFBLGFBQWFXLFVBQVU7WUFDcENsQyxTQUFTZ0M7WUFDVE0sZUFBZWhCO1lBQ2ZpQixlQUFlZDtZQUNmRDtZQUNBakQsUUFBUTtZQUNSaUUsWUFBWXhCLE1BQU10QixNQUFNO1lBQ3hCRSxhQUFhO1lBQ2I2QyxlQUFlO1lBQ2ZDLFVBQVViLFdBQVc7WUFDckJDLFVBQVVBLFlBQVksRUFBRTtZQUN4QmEsaUJBQWlCWixrQkFBa0I7WUFDbkNhLGVBQWU7Z0JBQ2JsQjtnQkFDQUM7Z0JBQ0FDO1lBQ0Y7UUFDRixHQUNDdkMsTUFBTSxHQUNOOEIsTUFBTTtRQUVULElBQUlpQixXQUFXO1lBQ2JwRCxJQUFBQSxjQUFNLEVBQUMsd0JBQXdCb0Q7WUFDL0IsT0FBT2hFLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87Z0JBQXlCdUUsU0FBU1Q7WUFBVSxHQUNyRDtnQkFBRTdELFFBQVE7WUFBSTtRQUVsQjtRQUVBLHdEQUF3RDtRQUN4RCxNQUFNdUUsZ0JBQWdCckQsUUFBUSxDQUFFLENBQUEsV0FBV0EsSUFBRyxJQUFLO1lBQ2pEQyxJQUFJRCxLQUFLQyxFQUFFO1lBQ1hDLE9BQU9GLEtBQUtFLEtBQUs7WUFDakI0QixhQUFhOUIsS0FBSzhCLFdBQVc7WUFDN0J2QixTQUFTUCxLQUFLTyxPQUFPO1lBQ3JCc0MsZUFBZTdDLEtBQUs2QyxhQUFhO1lBQ2pDQyxlQUFlOUMsS0FBSzhDLGFBQWE7WUFDakNmLFVBQVUvQixLQUFLK0IsUUFBUTtZQUN2QmpELFFBQVFrQixLQUFLbEIsTUFBTTtZQUNuQnFCLGFBQWFILEtBQUtHLFdBQVc7WUFDN0I2QyxlQUFlaEQsS0FBS2dELGFBQWE7WUFDakNDLFVBQVVqRCxLQUFLaUQsUUFBUTtZQUN2QlosVUFBVXJDLEtBQUtxQyxRQUFRLElBQUksRUFBRTtZQUM3QmEsaUJBQWlCbEQsS0FBS2tELGVBQWU7WUFDckNDLGVBQWVuRCxLQUFLbUQsYUFBYTtZQUNqQ25DLFlBQVloQixLQUFLZ0IsVUFBVTtRQUM3QixJQUFJO1FBRUosT0FBT3JDLG9CQUFZLENBQUNDLElBQUksQ0FBQ3lFO0lBRTNCLEVBQUUsT0FBT3hFLE9BQU87UUFDZFUsSUFBQUEsY0FBTSxFQUFDLHVCQUF1QlY7UUFDOUIsT0FBT0Ysb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQXdCLEdBQ2pDO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIn0=
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/lib/vote/engine-comprehensive.test.ts"],"sourcesContent":["/**\n * Comprehensive Vote Engine Tests\n * \n * Tests the core voting engine with all voting strategies\n * Tests validation, processing, and results calculation\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { VoteEngine, type VoteEngineConfig } from '@/lib/vote/engine'\nimport type { VoteRequest, VoteResponse, PollData, VotingMethod } from '@/lib/vote/types'\n\n// Mock the logger\njest.mock('@/lib/utils/logger', () => ({\n  devLog: jest.fn()\n}))\n\ndescribe('VoteEngine', () => {\n  let engine: VoteEngine\n  let config: VoteEngineConfig\n  let mockPoll: PollData\n  let mockVoteRequest: VoteRequest\n\n  beforeEach(() => {\n    config = {\n      maxVotesPerPoll: 1,\n      allowMultipleVotes: false,\n      requireAuthentication: true,\n      minTrustTier: 'basic',\n      rateLimitPerUser: 10,\n      rateLimitWindowMs: 60000\n    }\n\n    engine = new VoteEngine(config)\n\n    mockPoll = {\n      id: 'test-poll-id',\n      title: 'Test Poll',\n      description: 'A test poll',\n      votingMethod: 'single-choice' as VotingMethod,\n      options: [\n        { id: 'option-1', text: 'Option 1' },\n        { id: 'option-2', text: 'Option 2' }\n      ],\n      status: 'active',\n      createdAt: new Date(),\n      closeAt: new Date(Date.now() + 86400000), // 24 hours from now\n      createdBy: 'user-1',\n      settings: {\n        allowMultipleVotes: false,\n        requireAuthentication: true,\n        anonymousVoting: false\n      }\n    }\n\n    mockVoteRequest = {\n      pollId: 'test-poll-id',\n      userId: 'user-1',\n      voteData: {\n        selectedOptions: ['option-1'],\n        ranking: null,\n        weights: null\n      },\n      metadata: {\n        ipAddress: '192.168.1.1',\n        userAgent: 'Mozilla/5.0',\n        timestamp: new Date()\n      }\n    }\n  })\n\n  describe('Initialization', () => {\n    it('should initialize with provided configuration', () => {\n      expect(engine).toBeDefined()\n    })\n\n    it('should use default configuration when none provided', () => {\n      const defaultEngine = new VoteEngine()\n      expect(defaultEngine).toBeDefined()\n    })\n  })\n\n  describe('Vote Validation', () => {\n    it('should validate single-choice votes correctly', async () => {\n      const validation = await engine.validateVote(mockVoteRequest, mockPoll)\n      \n      expect(validation.valid).toBe(true)\n      expect(validation.errors).toHaveLength(0)\n    })\n\n    it('should reject votes with invalid poll ID', async () => {\n      const invalidRequest = { ...mockVoteRequest, pollId: 'invalid-poll' }\n      \n      const validation = await engine.validateVote(invalidRequest, mockPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Poll ID mismatch')\n    })\n\n    it('should reject votes for closed polls', async () => {\n      const closedPoll = { ...mockPoll, status: 'closed' as const }\n      \n      const validation = await engine.validateVote(mockVoteRequest, closedPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Poll is not active')\n    })\n\n    it('should reject votes with invalid options', async () => {\n      const invalidRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          selectedOptions: ['invalid-option'],\n          ranking: null,\n          weights: null\n        }\n      }\n      \n      const validation = await engine.validateVote(invalidRequest, mockPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Invalid option selected')\n    })\n\n    it('should validate ranked-choice votes', async () => {\n      const rankedPoll = { ...mockPoll, votingMethod: 'ranked-choice' as VotingMethod }\n      const rankedRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          selectedOptions: [],\n          ranking: ['option-1', 'option-2'],\n          weights: null\n        }\n      }\n      \n      const validation = await engine.validateVote(rankedRequest, rankedPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n\n    it('should validate approval votes', async () => {\n      const approvalPoll = { ...mockPoll, votingMethod: 'approval' as VotingMethod }\n      const approvalRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          selectedOptions: ['option-1', 'option-2'],\n          ranking: null,\n          weights: null\n        }\n      }\n      \n      const validation = await engine.validateVote(approvalRequest, approvalPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n\n    it('should validate quadratic votes', async () => {\n      const quadraticPoll = { ...mockPoll, votingMethod: 'quadratic' as VotingMethod }\n      const quadraticRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          selectedOptions: [],\n          ranking: null,\n          weights: { 'option-1': 2, 'option-2': 1 }\n        }\n      }\n      \n      const validation = await engine.validateVote(quadraticRequest, quadraticPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n  })\n\n  describe('Vote Processing', () => {\n    it('should process single-choice votes successfully', async () => {\n      const response = await engine.processVote(mockVoteRequest, mockPoll)\n      \n      expect(response.success).toBe(true)\n      expect(response.voteId).toBeDefined()\n      expect(response.timestamp).toBeDefined()\n    })\n\n    it('should process ranked-choice votes successfully', async () => {\n      const rankedPoll = { ...mockPoll, votingMethod: 'ranked-choice' as VotingMethod }\n      const rankedRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          selectedOptions: [],\n          ranking: ['option-1', 'option-2'],\n          weights: null\n        }\n      }\n      \n      const response = await engine.processVote(rankedRequest, rankedPoll)\n      \n      expect(response.success).toBe(true)\n      expect(response.voteId).toBeDefined()\n    })\n\n    it('should handle vote processing errors gracefully', async () => {\n      // Mock a processing error\n      jest.spyOn(engine as any, 'getVotingStrategy').mockImplementation(() => {\n        throw new Error('Processing error')\n      })\n      \n      const response = await engine.processVote(mockVoteRequest, mockPoll)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toBeDefined()\n    })\n  })\n\n  describe('Results Calculation', () => {\n    it('should calculate single-choice results', async () => {\n      const votes = [\n        { ...mockVoteRequest, voteData: { selectedOptions: ['option-1'], ranking: null, weights: null } },\n        { ...mockVoteRequest, voteData: { selectedOptions: ['option-1'], ranking: null, weights: null } },\n        { ...mockVoteRequest, voteData: { selectedOptions: ['option-2'], ranking: null, weights: null } }\n      ]\n      \n      const results = await engine.calculateResults(mockPoll, votes)\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(3)\n      expect(results.winner).toBe('option-1')\n    })\n\n    it('should calculate ranked-choice results', async () => {\n      const rankedPoll = { ...mockPoll, votingMethod: 'ranked-choice' as VotingMethod }\n      const votes = [\n        { ...mockVoteRequest, voteData: { selectedOptions: [], ranking: ['option-1', 'option-2'], weights: null } },\n        { ...mockVoteRequest, voteData: { selectedOptions: [], ranking: ['option-2', 'option-1'], weights: null } }\n      ]\n      \n      const results = await engine.calculateResults(rankedPoll, votes)\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(2)\n    })\n\n    it('should handle empty vote sets', async () => {\n      const results = await engine.calculateResults(mockPoll, [])\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(0)\n      expect(results.winner).toBeNull()\n    })\n\n    it('should handle tie scenarios', async () => {\n      const votes = [\n        { ...mockVoteRequest, voteData: { selectedOptions: ['option-1'], ranking: null, weights: null } },\n        { ...mockVoteRequest, voteData: { selectedOptions: ['option-2'], ranking: null, weights: null } }\n      ]\n      \n      const results = await engine.calculateResults(mockPoll, votes)\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(2)\n      // In a tie, the result should indicate no clear winner\n    })\n  })\n\n  describe('Rate Limiting', () => {\n    it('should enforce rate limits', async () => {\n      // Create multiple requests from the same user\n      const requests = Array.from({ length: 15 }, (_, i) => ({\n        ...mockVoteRequest,\n        userId: 'user-1',\n        metadata: {\n          ...mockVoteRequest.metadata,\n          timestamp: new Date(Date.now() + i * 1000)\n        }\n      }))\n      \n      // Process requests and check rate limiting\n      const responses = await Promise.all(\n        requests.map(request => engine.processVote(request, mockPoll))\n      )\n      \n      // Some requests should be rate limited\n      const rateLimitedResponses = responses.filter(r => !r.success && r.error?.includes('rate limit'))\n      expect(rateLimitedResponses.length).toBeGreaterThan(0)\n    })\n\n    it('should allow requests within rate limit', async () => {\n      const requests = Array.from({ length: 5 }, (_, i) => ({\n        ...mockVoteRequest,\n        userId: 'user-1',\n        metadata: {\n          ...mockVoteRequest.metadata,\n          timestamp: new Date(Date.now() + i * 1000)\n        }\n      }))\n      \n      const responses = await Promise.all(\n        requests.map(request => engine.processVote(request, mockPoll))\n      )\n      \n      // All requests should succeed within rate limit\n      const successfulResponses = responses.filter(r => r.success)\n      expect(successfulResponses.length).toBe(5)\n    })\n  })\n\n  describe('Authentication', () => {\n    it('should require authentication when configured', async () => {\n      const unauthenticatedRequest = { ...mockVoteRequest, userId: null }\n      \n      const validation = await engine.validateVote(unauthenticatedRequest, mockPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Authentication required')\n    })\n\n    it('should allow anonymous voting when configured', async () => {\n      const anonymousPoll = {\n        ...mockPoll,\n        settings: { ...mockPoll.settings, anonymousVoting: true }\n      }\n      \n      const anonymousRequest = { ...mockVoteRequest, userId: null }\n      \n      const validation = await engine.validateVote(anonymousRequest, anonymousPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('should handle malformed vote data', async () => {\n      const malformedRequest = {\n        ...mockVoteRequest,\n        voteData: null\n      }\n      \n      const response = await engine.processVote(malformedRequest, mockPoll)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toBeDefined()\n    })\n\n    it('should handle missing poll data', async () => {\n      const response = await engine.processVote(mockVoteRequest, null as any)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toBeDefined()\n    })\n\n    it('should handle network errors gracefully', async () => {\n      // Mock a network error\n      jest.spyOn(engine as any, 'saveVote').mockRejectedValueOnce(new Error('Network error'))\n      \n      const response = await engine.processVote(mockVoteRequest, mockPoll)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toContain('Network error')\n    })\n  })\n\n  describe('Performance', () => {\n    it('should process votes within reasonable time', async () => {\n      const startTime = performance.now()\n      \n      await engine.processVote(mockVoteRequest, mockPoll)\n      \n      const endTime = performance.now()\n      const processingTime = endTime - startTime\n      \n      // Should process within 100ms\n      expect(processingTime).toBeLessThan(100)\n    })\n\n    it('should handle large vote sets efficiently', async () => {\n      const largeVoteSet = Array.from({ length: 1000 }, (_, i) => ({\n        ...mockVoteRequest,\n        userId: `user-${i}`,\n        voteData: {\n          selectedOptions: ['option-1'],\n          ranking: null,\n          weights: null\n        }\n      }))\n      \n      const startTime = performance.now()\n      \n      const results = await engine.calculateResults(mockPoll, largeVoteSet)\n      \n      const endTime = performance.now()\n      const processingTime = endTime - startTime\n      \n      expect(results).toBeDefined()\n      expect(processingTime).toBeLessThan(1000) // Should process within 1 second\n    })\n  })\n})\n"],"names":["jest","mock","devLog","fn","describe","engine","config","mockPoll","mockVoteRequest","beforeEach","maxVotesPerPoll","allowMultipleVotes","requireAuthentication","minTrustTier","rateLimitPerUser","rateLimitWindowMs","VoteEngine","id","title","description","votingMethod","options","text","status","createdAt","Date","closeAt","now","createdBy","settings","anonymousVoting","pollId","userId","voteData","selectedOptions","ranking","weights","metadata","ipAddress","userAgent","timestamp","it","expect","toBeDefined","defaultEngine","validation","validateVote","valid","toBe","errors","toHaveLength","invalidRequest","toContain","closedPoll","rankedPoll","rankedRequest","approvalPoll","approvalRequest","quadraticPoll","quadraticRequest","response","processVote","success","voteId","spyOn","mockImplementation","Error","error","votes","results","calculateResults","totalVotes","winner","toBeNull","requests","Array","from","length","_","i","responses","Promise","all","map","request","rateLimitedResponses","filter","r","includes","toBeGreaterThan","successfulResponses","unauthenticatedRequest","anonymousPoll","anonymousRequest","malformedRequest","mockRejectedValueOnce","startTime","performance","endTime","processingTime","toBeLessThan","largeVoteSet"],"mappings":"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"}
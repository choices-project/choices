{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/components/shared/GlobalNavigation.test.tsx"],"sourcesContent":["/**\n * GlobalNavigation Component Tests\n * \n * Comprehensive tests for the main navigation component\n * Tests user interactions, authentication states, and responsive behavior\n */\n\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\nimport { BrowserRouter } from 'react-router-dom'\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\n\n// Mock lucide-react before importing the component\njest.mock('lucide-react', () => require('@/../../__mocks__/lucide-react.js'))\n\nimport GlobalNavigation from '@/components/shared/GlobalNavigation'\n\n// Mock the stores at the module level to prevent infinite loops\nconst mockSignOut = jest.fn()\nconst mockUser = {\n  id: 'test-user-id',\n  name: 'Test User',\n  email: 'test@example.com',\n  avatar: 'https://example.com/avatar.jpg'\n}\n\n// Mock the entire store module to prevent infinite loops\njest.mock('@/lib/stores', () => ({\n  useUser: jest.fn(() => mockUser),\n  useUserActions: jest.fn(() => ({\n    signOut: mockSignOut\n  })),\n  useUserStore: jest.fn(() => ({\n    user: mockUser,\n    isAuthenticated: true,\n    signOut: mockSignOut,\n    setUserAndAuth: jest.fn(),\n    setSessionAndDerived: jest.fn(),\n    initializeAuth: jest.fn(),\n    clearUser: jest.fn()\n  }))\n}))\n\n// Mock the store creation to prevent initialization\njest.mock('zustand', () => ({\n  create: jest.fn(() => () => ({\n    user: mockUser,\n    isAuthenticated: true,\n    signOut: mockSignOut,\n    setUserAndAuth: jest.fn(),\n    setSessionAndDerived: jest.fn(),\n    initializeAuth: jest.fn(),\n    clearUser: jest.fn()\n  }))\n}))\n\n// Mock Next.js navigation\nconst mockUsePathname = jest.fn(() => '/dashboard')\njest.mock('next/navigation', () => ({\n  usePathname: mockUsePathname\n}))\n\nconst renderWithRouter = (component: React.ReactElement) => {\n  return render(\n    <BrowserRouter>\n      {component}\n    </BrowserRouter>\n  )\n}\n\ndescribe('GlobalNavigation', () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n  })\n\n  describe('Rendering', () => {\n    it('should render navigation items', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      expect(screen.getByText('Feed')).toBeInTheDocument()\n      expect(screen.getByText('Polls')).toBeInTheDocument()\n      expect(screen.getByText('Dashboard')).toBeInTheDocument()\n    })\n\n    it('should render authentication buttons when not authenticated', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      expect(screen.getByText('Sign In')).toBeInTheDocument()\n      expect(screen.getByText('Get Started')).toBeInTheDocument()\n    })\n\n    it('should render mobile menu button', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const menuButton = screen.getByRole('button', { name: /menu/i })\n      expect(menuButton).toBeInTheDocument()\n    })\n  })\n\n  describe('Mobile Menu', () => {\n    it('should toggle mobile menu when menu button is clicked', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const menuButton = screen.getByRole('button', { name: /menu/i })\n      fireEvent.click(menuButton)\n      \n      // Check if mobile menu is open (you might need to adjust this based on your component structure)\n      expect(screen.getByRole('navigation')).toBeInTheDocument()\n    })\n\n    it('should close mobile menu when close button is clicked', async () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const menuButton = screen.getByRole('button', { name: /menu/i })\n      fireEvent.click(menuButton)\n      \n      // Wait for menu to open, then find and click the toggle button (which shows X when open)\n      await waitFor(() => {\n        const toggleButton = screen.getByTestId('mobile-menu')\n        fireEvent.click(toggleButton)\n      })\n    })\n  })\n\n  describe('Navigation Links', () => {\n    it('should have correct href attributes for navigation items', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const feedLink = screen.getByRole('link', { name: /feed/i })\n      const pollsLink = screen.getByRole('link', { name: /polls/i })\n      const dashboardLink = screen.getByRole('link', { name: /dashboard/i })\n      \n      expect(feedLink).toHaveAttribute('href', '/feed')\n      expect(pollsLink).toHaveAttribute('href', '/polls')\n      expect(dashboardLink).toHaveAttribute('href', '/dashboard')\n    })\n\n    it('should highlight active navigation item', async () => {\n      // Debug: log the mock calls\n      console.log('Mock usePathname calls:', mockUsePathname.mock.calls)\n      console.log('Mock usePathname return value:', mockUsePathname())\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      // Wait for the component to render with the mocked pathname\n      await waitFor(() => {\n        const dashboardLink = screen.getByRole('link', { name: /dashboard/i })\n        // Debug: log the actual classes\n        console.log('Dashboard link classes:', dashboardLink.className)\n        expect(dashboardLink).toHaveClass('bg-blue-50')\n      })\n    })\n  })\n\n  describe('User Actions', () => {\n    it('should show authentication buttons when not authenticated', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      // When not authenticated, should show Sign In and Get Started buttons\n      expect(screen.getByText('Sign In')).toBeInTheDocument()\n      expect(screen.getByText('Get Started')).toBeInTheDocument()\n    })\n\n    it('should handle authentication state properly', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      // Should show authentication buttons when not authenticated\n      expect(screen.getByText('Sign In')).toBeInTheDocument()\n      expect(screen.getByText('Get Started')).toBeInTheDocument()\n    })\n  })\n\n  describe('Responsive Behavior', () => {\n    it('should show mobile menu button on small screens', () => {\n      // Mock window.innerWidth for mobile\n      Object.defineProperty(window, 'innerWidth', {\n        writable: true,\n        configurable: true,\n        value: 375,\n      })\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      const menuButton = screen.getByRole('button', { name: /menu/i })\n      expect(menuButton).toBeInTheDocument()\n    })\n\n    it('should hide mobile menu on desktop screens', () => {\n      // Mock window.innerWidth for desktop\n      Object.defineProperty(window, 'innerWidth', {\n        writable: true,\n        configurable: true,\n        value: 1024,\n      })\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      // Mobile menu should not be visible by default on desktop\n      expect(screen.queryByRole('button', { name: /close/i })).not.toBeInTheDocument()\n    })\n  })\n\n  describe('Accessibility', () => {\n    it('should have proper ARIA labels', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const navigation = screen.getByRole('navigation')\n      expect(navigation).toBeInTheDocument()\n      \n      const menuButton = screen.getByRole('button', { name: /menu/i })\n      expect(menuButton).toHaveAttribute('aria-label', 'Toggle mobile menu')\n    })\n\n    it('should support keyboard navigation', () => {\n      renderWithRouter(<GlobalNavigation />)\n      \n      const menuButton = screen.getByRole('button', { name: /menu/i })\n      menuButton.focus()\n      \n      // Test keyboard navigation\n      fireEvent.keyDown(menuButton, { key: 'Enter' })\n      // Add more keyboard navigation tests as needed\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('should handle missing user data gracefully', () => {\n      // Mock useUser to return null\n      jest.mocked(require('@/lib/stores').useUser).mockReturnValueOnce(null)\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      // Component should still render without crashing\n      expect(screen.getByRole('navigation')).toBeInTheDocument()\n    })\n\n    it('should handle authentication errors', () => {\n      // Mock useUser to return an error state\n      jest.mocked(require('@/lib/stores').useUser).mockReturnValueOnce({\n        error: 'Authentication failed'\n      })\n      \n      renderWithRouter(<GlobalNavigation />)\n      \n      // Component should handle error state gracefully\n      expect(screen.getByRole('navigation')).toBeInTheDocument()\n    })\n  })\n});\n\n"],"names":["jest","mock","require","mockSignOut","fn","mockUser","id","name","email","avatar","useUser","useUserActions","signOut","useUserStore","user","isAuthenticated","setUserAndAuth","setSessionAndDerived","initializeAuth","clearUser","create","mockUsePathname","usePathname","renderWithRouter","component","render","BrowserRouter","describe","beforeEach","clearAllMocks","it","GlobalNavigation","expect","screen","getByText","toBeInTheDocument","menuButton","getByRole","fireEvent","click","waitFor","toggleButton","getByTestId","feedLink","pollsLink","dashboardLink","toHaveAttribute","console","log","calls","className","toHaveClass","Object","defineProperty","window","writable","configurable","value","queryByRole","not","navigation","focus","keyDown","key","mocked","mockReturnValueOnce","error"],"mappings":"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"}
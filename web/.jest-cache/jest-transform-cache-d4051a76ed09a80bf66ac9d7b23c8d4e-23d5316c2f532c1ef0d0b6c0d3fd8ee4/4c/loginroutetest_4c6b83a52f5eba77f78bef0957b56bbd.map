{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/auth/login-route.test.ts"],"sourcesContent":["/**\n * Login API Route Tests\n * \n * Tests the POST /api/auth/login endpoint including:\n * - Authentication flow\n * - Input validation\n * - Error handling\n * - Security measures\n * - Rate limiting\n */\n\nimport { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { POST } from '@/app/api/auth/login/route';\n\n// Mock Supabase client\nconst mockSupabaseClient = {\n  auth: {\n    signInWithPassword: jest.fn(),\n  },\n  from: jest.fn(() => ({\n    select: jest.fn(() => ({\n      eq: jest.fn(() => ({\n        single: jest.fn(),\n      })),\n    })),\n  })),\n};\n\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(() => Promise.resolve(mockSupabaseClient)),\n}));\n\n// Mock rate limiting\njest.mock('@/lib/core/security/rate-limit', () => ({\n  rateLimiters: {\n    auth: {\n      check: jest.fn(),\n    },\n  },\n}));\n\n// Mock CSRF protection\njest.mock('@/app/api/auth/_shared', () => ({\n  validateCsrfProtection: jest.fn(() => true),\n  createCsrfErrorResponse: jest.fn(() => new Response('CSRF Error', { status: 403 })),\n}));\n\n// Mock logger\njest.mock('@/lib/utils/logger', () => ({\n  logger: {\n    warn: jest.fn(),\n    info: jest.fn(),\n    error: jest.fn(),\n  },\n}));\n\ndescribe('Login API Route', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    jest.resetAllMocks();\n  });\n\n  describe('Successful Authentication', () => {\n    it('should authenticate user with valid credentials', async () => {\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n        user_metadata: {\n          username: 'testuser',\n        },\n      };\n\n      const mockProfile = {\n        user_id: 'user-123',\n        onboarding_completed: true,\n        is_active: true,\n      };\n\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: mockProfile,\n              error: null,\n            }),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(responseData.user.id).toBe('user-123');\n      expect(responseData.user.email).toBe('test@example.com');\n    });\n\n    it('should handle user without completed onboarding', async () => {\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      const mockProfile = {\n        user_id: 'user-123',\n        onboarding_completed: false,\n        is_active: true,\n      };\n\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: mockProfile,\n              error: null,\n            }),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.requiresOnboarding).toBe(true);\n    });\n  });\n\n  describe('Input Validation', () => {\n    it('should reject request with missing email', async () => {\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.message).toBe('Email and password are required');\n    });\n\n    it('should reject request with missing password', async () => {\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.message).toBe('Email and password are required');\n    });\n\n    it('should reject request with empty email', async () => {\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: '',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.message).toBe('Email and password are required');\n    });\n\n    it('should reject request with empty password', async () => {\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: '',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.message).toBe('Email and password are required');\n    });\n  });\n\n  describe('Authentication Errors', () => {\n    it('should handle invalid credentials', async () => {\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'Invalid login credentials' },\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'wrongpassword',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(responseData.message).toBe('Invalid email or password');\n    });\n\n    it('should handle user not found', async () => {\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: null },\n        error: { message: 'User not found' },\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'nonexistent@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(401);\n      expect(responseData.message).toBe('Invalid email or password');\n    });\n\n    it('should handle inactive user', async () => {\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      const mockProfile = {\n        user_id: 'user-123',\n        onboarding_completed: true,\n        is_active: false,\n      };\n\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: mockProfile,\n              error: null,\n            }),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(403);\n      expect(responseData.message).toBe('Account is inactive');\n    });\n  });\n\n  describe('Rate Limiting', () => {\n    it('should handle rate limit exceeded', async () => {\n      const { rateLimiters } = require('@/lib/core/security/rate-limit');\n      rateLimiters.auth.check.mockResolvedValue({\n        allowed: false,\n        remaining: 0,\n        resetTime: Date.now() + 900000,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(429);\n      expect(responseData.message).toBe('Too many login attempts. Please try again later.');\n    });\n  });\n\n  describe('CSRF Protection', () => {\n    it('should handle CSRF protection failure', async () => {\n      const { validateCsrfProtection } = require('@/app/api/auth/_shared');\n      validateCsrfProtection.mockReturnValue(false);\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n\n      expect(response.status).toBe(403);\n    });\n  });\n\n  describe('Server Errors', () => {\n    it('should handle Supabase client unavailable', async () => {\n      const { getSupabaseServerClient } = require('@/utils/supabase/server');\n      getSupabaseServerClient.mockResolvedValue(null);\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(responseData.message).toBe('Authentication service unavailable');\n    });\n\n    it('should handle profile lookup error', async () => {\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: null,\n              error: { message: 'Profile not found' },\n            }),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'test@example.com',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.requiresOnboarding).toBe(true);\n    });\n  });\n\n  describe('Security Measures', () => {\n    it('should normalize email to lowercase', async () => {\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: { user_id: 'user-123', onboarding_completed: true, is_active: true },\n              error: null,\n            }),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: 'TEST@EXAMPLE.COM',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n\n      expect(response.status).toBe(200);\n      expect(mockSupabaseClient.auth.signInWithPassword).toHaveBeenCalledWith({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n    });\n\n    it('should trim email whitespace', async () => {\n      const mockUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n      };\n\n      mockSupabaseClient.auth.signInWithPassword.mockResolvedValue({\n        data: { user: mockUser },\n        error: null,\n      });\n\n      mockSupabaseClient.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            single: jest.fn().mockResolvedValue({\n              data: { user_id: 'user-123', onboarding_completed: true, is_active: true },\n              error: null,\n            }),\n          })),\n        })),\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: '  test@example.com  ',\n          password: 'password123',\n        }),\n      });\n\n      const response = await POST(request);\n\n      expect(response.status).toBe(200);\n      expect(mockSupabaseClient.auth.signInWithPassword).toHaveBeenCalledWith({\n        email: 'test@example.com',\n        password: 'password123',\n      });\n    });\n  });\n});\n"],"names":["jest","mock","getSupabaseServerClient","fn","Promise","resolve","mockSupabaseClient","rateLimiters","auth","check","validateCsrfProtection","createCsrfErrorResponse","Response","status","logger","warn","info","error","signInWithPassword","from","select","eq","single","describe","beforeEach","clearAllMocks","afterEach","resetAllMocks","it","mockUser","id","email","user_metadata","username","mockProfile","user_id","onboarding_completed","is_active","mockResolvedValue","data","user","mockReturnValue","request","NextRequest","method","headers","body","JSON","stringify","password","response","POST","responseData","json","expect","toBe","success","requiresOnboarding","message","require","allowed","remaining","resetTime","Date","now","toHaveBeenCalledWith"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/stores/pollsStore.ts"],"sourcesContent":["/**\n * Polls Store - Zustand Implementation\n * \n * Comprehensive poll state management including poll data, voting state,\n * poll interactions, and poll preferences. Consolidates poll-related state management.\n * \n * Created: October 10, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { persist } from 'zustand/middleware';\n\nimport { logger } from '@/lib/utils/logger';\nimport { withOptional } from '@/lib/utils/objects';\n\n// Poll data types\ninterface Poll {\n  id: string;\n  title: string;\n  description: string;\n  question: string;\n  options: PollOption[];\n  category: string;\n  tags: string[];\n  author: {\n    id: string;\n    name: string;\n    avatar?: string;\n    verified: boolean;\n  };\n  status: 'draft' | 'active' | 'closed' | 'archived';\n  visibility: 'public' | 'private' | 'unlisted';\n  settings: {\n    allowMultipleVotes: boolean;\n    allowAnonymousVotes: boolean;\n    showResultsBeforeClose: boolean;\n    allowComments: boolean;\n    allowSharing: boolean;\n    requireAuthentication: boolean;\n  };\n  voting: {\n    totalVotes: number;\n    uniqueVoters: number;\n    userVote?: string; // Option ID\n    userVotedAt?: string;\n    canVote: boolean;\n    hasVoted: boolean;\n  };\n  results: {\n    optionResults: Array<{\n      optionId: string;\n      votes: number;\n      percentage: number;\n    }>;\n    demographics: {\n      ageGroups: Record<string, number>;\n      locations: Record<string, number>;\n      genders: Record<string, number>;\n    };\n    trends: Array<{\n      timestamp: string;\n      votes: number;\n    }>;\n  };\n  metadata: {\n    image?: string;\n    location?: string;\n    language: string;\n    estimatedTime: number; // minutes\n    difficulty: 'easy' | 'medium' | 'hard';\n  };\n  timestamps: {\n    createdAt: string;\n    publishedAt?: string;\n    closesAt?: string;\n    updatedAt: string;\n  };\n}\n\ninterface PollOption {\n  id: string;\n  text: string;\n  description?: string;\n  image?: string;\n  order: number;\n  votes: number;\n  percentage: number;\n}\n\ninterface PollComment {\n  id: string;\n  pollId: string;\n  author: {\n    id: string;\n    name: string;\n    avatar?: string;\n  };\n  content: string;\n  parentId?: string; // For replies\n  likes: number;\n  userLiked: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PollFilters {\n  status: Array<'draft' | 'active' | 'closed' | 'archived'>;\n  category: string[];\n  tags: string[];\n  author: string[];\n  dateRange: {\n    start: string;\n    end: string;\n  };\n  votingStatus: 'all' | 'voted' | 'not_voted';\n  visibility: Array<'public' | 'private' | 'unlisted'>;\n}\n\ninterface PollPreferences {\n  defaultView: 'list' | 'grid' | 'card';\n  sortBy: 'newest' | 'oldest' | 'popular' | 'trending' | 'closing_soon';\n  itemsPerPage: number;\n  showResults: boolean;\n  autoRefresh: boolean;\n  refreshInterval: number; // minutes\n  notifications: {\n    newPolls: boolean;\n    pollUpdates: boolean;\n    pollCloses: boolean;\n    pollResults: boolean;\n  };\n  privacy: {\n    showVoteHistory: boolean;\n    showPollParticipation: boolean;\n    shareActivity: boolean;\n  };\n  voting: {\n    confirmVotes: boolean;\n    showProgress: boolean;\n    allowUndo: boolean;\n    undoTimeLimit: number; // minutes\n  };\n}\n\ninterface PollSearch {\n  query: string;\n  results: Poll[];\n  totalResults: number;\n  currentPage: number;\n  totalPages: number;\n  filters: PollFilters;\n  suggestions: string[];\n  recentSearches: string[];\n}\n\n// Polls store state interface\ninterface PollsStore {\n  // Poll data\n  polls: Poll[];\n  filteredPolls: Poll[];\n  comments: PollComment[];\n  search: PollSearch;\n  \n  // UI state\n  selectedPoll: Poll | null;\n  currentView: 'list' | 'grid' | 'card';\n  selectedCategory: string | null;\n  \n  // Filters and preferences\n  filters: PollFilters;\n  preferences: PollPreferences;\n  \n  // Loading states\n  isLoading: boolean;\n  isSearching: boolean;\n  isVoting: boolean;\n  isUpdating: boolean;\n  error: string | null;\n  \n  // Actions - Poll management\n  setPolls: (polls: Poll[]) => void;\n  addPoll: (poll: Poll) => void;\n  updatePoll: (id: string, updates: Partial<Poll>) => void;\n  removePoll: (id: string) => void;\n  publishPoll: (id: string) => void;\n  closePoll: (id: string) => void;\n  archivePoll: (id: string) => void;\n  \n  // Actions - Voting\n  voteOnPoll: (pollId: string, optionId: string) => Promise<void>;\n  undoVote: (pollId: string) => Promise<void>;\n  changeVote: (pollId: string, newOptionId: string) => Promise<void>;\n  \n  // Actions - Comments\n  setComments: (comments: PollComment[]) => void;\n  addComment: (comment: Omit<PollComment, 'id' | 'createdAt' | 'updatedAt'>) => void;\n  updateComment: (id: string, updates: Partial<PollComment>) => void;\n  removeComment: (id: string) => void;\n  likeComment: (id: string) => void;\n  unlikeComment: (id: string) => void;\n  \n  // Actions - Filtering and search\n  setFilters: (filters: Partial<PollFilters>) => void;\n  clearFilters: () => void;\n  searchPolls: (query: string) => Promise<void>;\n  setSearchQuery: (query: string) => void;\n  clearSearch: () => void;\n  \n  // Actions - UI state\n  setSelectedPoll: (poll: Poll | null) => void;\n  setCurrentView: (view: 'list' | 'grid' | 'card') => void;\n  setSelectedCategory: (category: string | null) => void;\n  \n  // Actions - Preferences\n  updatePreferences: (preferences: Partial<PollPreferences>) => void;\n  resetPreferences: () => void;\n  \n  // Actions - Data operations\n  loadPolls: (category?: string) => Promise<void>;\n  loadPoll: (id: string) => Promise<void>;\n  loadComments: (pollId: string) => Promise<void>;\n  createPoll: (poll: Omit<Poll, 'id' | 'timestamps' | 'voting' | 'results'>) => Promise<void>;\n  updatePollSettings: (id: string, settings: Partial<Poll['settings']>) => Promise<void>;\n  \n  // Actions - Loading states\n  setLoading: (loading: boolean) => void;\n  setSearching: (searching: boolean) => void;\n  setVoting: (voting: boolean) => void;\n  setUpdating: (updating: boolean) => void;\n  setError: (error: string | null) => void;\n  clearError: () => void;\n}\n\n// Default poll preferences\nconst defaultPreferences: PollPreferences = {\n  defaultView: 'list',\n  sortBy: 'newest',\n  itemsPerPage: 20,\n  showResults: true,\n  autoRefresh: true,\n  refreshInterval: 5,\n  notifications: {\n    newPolls: true,\n    pollUpdates: true,\n    pollCloses: true,\n    pollResults: true,\n  },\n  privacy: {\n    showVoteHistory: false,\n    showPollParticipation: true,\n    shareActivity: false,\n  },\n  voting: {\n    confirmVotes: true,\n    showProgress: true,\n    allowUndo: true,\n    undoTimeLimit: 5,\n  },\n};\n\n// Default poll filters\nconst defaultFilters: PollFilters = {\n  status: ['active'],\n  category: [],\n  tags: [],\n  author: [],\n  dateRange: {\n    start: '',\n    end: '',\n  },\n  votingStatus: 'all',\n  visibility: ['public'],\n};\n\n// Create polls store with middleware\nexport const usePollsStore = create<PollsStore>()(\n  devtools(\n    persist(\n      (set, get) => ({\n        // Initial state\n        polls: [],\n        filteredPolls: [],\n        comments: [],\n        search: {\n          query: '',\n          results: [],\n          totalResults: 0,\n          currentPage: 1,\n          totalPages: 1,\n          filters: defaultFilters,\n          suggestions: [],\n          recentSearches: [],\n        },\n        selectedPoll: null,\n        currentView: 'list',\n        selectedCategory: null,\n        filters: defaultFilters,\n        preferences: defaultPreferences,\n        isLoading: false,\n        isSearching: false,\n        isVoting: false,\n        isUpdating: false,\n        error: null,\n        \n        // Poll management actions\n        setPolls: (polls) => set({ polls, filteredPolls: polls }),\n        \n        addPoll: (poll) => set((state) => ({\n          polls: [poll, ...state.polls],\n          filteredPolls: [poll, ...state.filteredPolls],\n        })),\n        \n        updatePoll: (id, updates) => set((state) => ({\n          polls: state.polls.map(poll =>\n            poll.id === id ? withOptional(poll, updates) : poll\n          ),\n          filteredPolls: state.filteredPolls.map(poll =>\n            poll.id === id ? withOptional(poll, updates) : poll\n          ),\n        })),\n        \n        removePoll: (id) => set((state) => ({\n          polls: state.polls.filter(poll => poll.id !== id),\n          filteredPolls: state.filteredPolls.filter(poll => poll.id !== id),\n        })),\n        \n        publishPoll: (id) => set((state) => ({\n          polls: state.polls.map(poll =>\n            poll.id === id \n              ? withOptional(poll, { \n                  status: 'active' as const,\n                  timestamps: withOptional(poll.timestamps, { \n                    publishedAt: new Date().toISOString(),\n                    updatedAt: new Date().toISOString()\n                  })\n                })\n              : poll\n          ),\n          filteredPolls: state.filteredPolls.map(poll =>\n            poll.id === id \n              ? withOptional(poll, { \n                  status: 'active' as const,\n                  timestamps: withOptional(poll.timestamps, { \n                    publishedAt: new Date().toISOString(),\n                    updatedAt: new Date().toISOString()\n                  })\n                })\n              : poll\n          ),\n        })),\n        \n        closePoll: (id) => set((state) => ({\n          polls: state.polls.map(poll =>\n            poll.id === id \n              ? withOptional(poll, { \n                  status: 'closed' as const,\n                  timestamps: withOptional(poll.timestamps, { \n                    closesAt: new Date().toISOString(),\n                    updatedAt: new Date().toISOString()\n                  })\n                })\n              : poll\n          ),\n          filteredPolls: state.filteredPolls.map(poll =>\n            poll.id === id \n              ? withOptional(poll, { \n                  status: 'closed' as const,\n                  timestamps: withOptional(poll.timestamps, { \n                    closesAt: new Date().toISOString(),\n                    updatedAt: new Date().toISOString()\n                  })\n                })\n              : poll\n          ),\n        })),\n        \n        archivePoll: (id) => set((state) => ({\n          polls: state.polls.map(poll =>\n            poll.id === id \n              ? withOptional(poll, { \n                  status: 'archived' as const,\n                  timestamps: withOptional(poll.timestamps, { \n                    updatedAt: new Date().toISOString()\n                  })\n                })\n              : poll\n          ),\n          filteredPolls: state.filteredPolls.map(poll =>\n            poll.id === id \n              ? withOptional(poll, { \n                  status: 'archived' as const,\n                  timestamps: withOptional(poll.timestamps, { \n                    updatedAt: new Date().toISOString()\n                  })\n                })\n              : poll\n          ),\n        })),\n        \n        // Voting actions\n        voteOnPoll: async (pollId, optionId) => {\n          const { setVoting, setError } = get();\n          \n          try {\n            setVoting(true);\n            setError(null);\n            \n            const response = await fetch('/api/polls/vote', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ pollId, optionId }),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to vote on poll');\n            }\n            \n            // Update local state\n            set((state) => ({\n              polls: state.polls.map(poll =>\n                poll.id === pollId \n                  ? withOptional(poll, {\n                      voting: withOptional(poll.voting, {\n                        userVote: optionId,\n                        userVotedAt: new Date().toISOString(),\n                        hasVoted: true,\n                        totalVotes: poll.voting.totalVotes + 1,\n                      }),\n                      results: withOptional(poll.results, {\n                        optionResults: poll.results.optionResults.map(result =>\n                          result.optionId === optionId\n                            ? withOptional(result, { votes: result.votes + 1 })\n                            : result\n                        ),\n                      }),\n                    })\n                  : poll\n              ),\n              filteredPolls: state.filteredPolls.map(poll =>\n                poll.id === pollId \n                  ? withOptional(poll, {\n                      voting: withOptional(poll.voting, {\n                        userVote: optionId,\n                        userVotedAt: new Date().toISOString(),\n                        hasVoted: true,\n                        totalVotes: poll.voting.totalVotes + 1,\n                      }),\n                      results: withOptional(poll.results, {\n                        optionResults: poll.results.optionResults.map(result =>\n                          result.optionId === optionId\n                            ? withOptional(result, { votes: result.votes + 1 })\n                            : result\n                        ),\n                      }),\n                    })\n                  : poll\n              ),\n            }));\n            \n            logger.info('Vote cast successfully', {\n              pollId,\n              optionId\n            });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to vote on poll:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setVoting(false);\n          }\n        },\n        \n        undoVote: async (pollId) => {\n          const { setVoting, setError } = get();\n          \n          try {\n            setVoting(true);\n            setError(null);\n            \n            const response = await fetch('/api/polls/undo-vote', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ pollId }),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to undo vote');\n            }\n            \n            // Update local state\n            set((state) => {\n              const poll = state.polls.find(p => p.id === pollId);\n              if (!poll?.voting.userVote) return state;\n              \n              return {\n                polls: state.polls.map(p =>\n                  p.id === pollId \n                    ? withOptional(p, {\n                        voting: withOptional(p.voting, {\n                          userVote: undefined,\n                          userVotedAt: undefined,\n                          hasVoted: false,\n                          totalVotes: Math.max(0, p.voting.totalVotes - 1),\n                        }),\n                        results: withOptional(p.results, {\n                          optionResults: p.results.optionResults.map(result =>\n                            result.optionId === poll.voting.userVote\n                              ? withOptional(result, { votes: Math.max(0, result.votes - 1) })\n                              : result\n                          ),\n                        }),\n                      })\n                    : p\n                ),\n                filteredPolls: state.filteredPolls.map(p =>\n                  p.id === pollId \n                    ? withOptional(p, {\n                        voting: withOptional(p.voting, {\n                          userVote: undefined,\n                          userVotedAt: undefined,\n                          hasVoted: false,\n                          totalVotes: Math.max(0, p.voting.totalVotes - 1),\n                        }),\n                        results: withOptional(p.results, {\n                          optionResults: p.results.optionResults.map(result =>\n                            result.optionId === poll.voting.userVote\n                              ? withOptional(result, { votes: Math.max(0, result.votes - 1) })\n                              : result\n                          ),\n                        }),\n                      })\n                    : p\n                ),\n              };\n            });\n            \n            logger.info('Vote undone successfully', { pollId });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to undo vote:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setVoting(false);\n          }\n        },\n        \n        changeVote: async (pollId, newOptionId) => {\n          const { voteOnPoll, undoVote } = get();\n          \n          try {\n            await undoVote(pollId);\n            await voteOnPoll(pollId, newOptionId);\n            \n            logger.info('Vote changed successfully', {\n              pollId,\n              newOptionId\n            });\n          } catch (error) {\n            logger.error('Failed to change vote:', error as Error);\n            throw error;\n          }\n        },\n        \n        // Comment actions\n        setComments: (comments) => set({ comments }),\n        \n        addComment: (comment) => set((state) => ({\n          comments: [\n            ...state.comments,\n            {\n              ...comment,\n              id: `comment_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n              createdAt: new Date().toISOString(),\n              updatedAt: new Date().toISOString(),\n            }\n          ]\n        })),\n        \n        updateComment: (id, updates) => set((state) => ({\n          comments: state.comments.map(comment =>\n            comment.id === id \n              ? withOptional(comment, withOptional(updates, { updatedAt: new Date().toISOString() }))\n              : comment\n          )\n        })),\n        \n        removeComment: (id) => set((state) => ({\n          comments: state.comments.filter(comment => comment.id !== id)\n        })),\n        \n        likeComment: (id) => set((state) => ({\n          comments: state.comments.map(comment =>\n            comment.id === id \n              ? withOptional(comment, { \n                  userLiked: true,\n                  likes: comment.likes + 1 \n                })\n              : comment\n          )\n        })),\n        \n        unlikeComment: (id) => set((state) => ({\n          comments: state.comments.map(comment =>\n            comment.id === id \n              ? withOptional(comment, { \n                  userLiked: false,\n                  likes: Math.max(0, comment.likes - 1) \n                })\n              : comment\n          )\n        })),\n        \n        // Filtering and search actions\n        setFilters: (filters) => set((state) => {\n          const newFilters = withOptional(state.filters, filters);\n          \n          // Apply filters to polls\n          const filtered = state.polls.filter(poll => {\n            if (newFilters.status.length > 0 && !newFilters.status.includes(poll.status)) {\n              return false;\n            }\n            if (newFilters.category.length > 0 && !newFilters.category.includes(poll.category)) {\n              return false;\n            }\n            if (newFilters.tags.length > 0 && !newFilters.tags.some(tag => poll.tags.includes(tag))) {\n              return false;\n            }\n            if (newFilters.author.length > 0 && !newFilters.author.includes(poll.author.id)) {\n              return false;\n            }\n            if (newFilters.votingStatus === 'voted' && !poll.voting.hasVoted) {\n              return false;\n            }\n            if (newFilters.votingStatus === 'not_voted' && poll.voting.hasVoted) {\n              return false;\n            }\n            return true;\n          });\n          \n          return { filters: newFilters, filteredPolls: filtered };\n        }),\n        \n        clearFilters: () => set((state) => ({\n          filters: defaultFilters,\n          filteredPolls: state.polls,\n        })),\n        \n        searchPolls: async (query) => {\n          const { setSearching, setError } = get();\n          \n          try {\n            setSearching(true);\n            setError(null);\n            \n            const response = await fetch('/api/polls/search', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ query }),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to search polls');\n            }\n            \n            const results = await response.json();\n            \n            set((state) => ({\n              search: withOptional(state.search, {\n                query,\n                results: results.polls,\n                totalResults: results.total,\n                currentPage: 1,\n                totalPages: Math.ceil(results.total / state.preferences.itemsPerPage),\n              })\n            }));\n            \n            logger.info('Polls searched', {\n              query,\n              results: results.polls.length,\n              total: results.total\n            });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to search polls:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setSearching(false);\n          }\n        },\n        \n        setSearchQuery: (query) => set((state) => ({\n          search: { ...state.search, query }\n        })),\n        \n        clearSearch: () => set((state) => ({\n          search: withOptional(state.search, {\n            query: '',\n            results: [],\n            totalResults: 0,\n            currentPage: 1,\n            totalPages: 1,\n          })\n        })),\n        \n        // UI state actions\n        setSelectedPoll: (poll) => set({ selectedPoll: poll }),\n        \n        setCurrentView: (view) => set({ currentView: view }),\n        \n        setSelectedCategory: (category) => set({ selectedCategory: category }),\n        \n        // Preferences actions\n        updatePreferences: (preferences) => set((state) => ({\n          preferences: withOptional(state.preferences, preferences)\n        })),\n        \n        resetPreferences: () => set({ preferences: defaultPreferences }),\n        \n        // Data operations\n        loadPolls: async (category) => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            const response = await fetch('/api/polls', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ category }),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to load polls');\n            }\n            \n            const polls = await response.json();\n            set({ polls, filteredPolls: polls });\n            \n            logger.info('Polls loaded', {\n              category,\n              count: polls.length\n            });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to load polls:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        loadPoll: async (id) => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            const response = await fetch(`/api/polls/${id}`);\n            \n            if (!response.ok) {\n              throw new Error('Failed to load poll');\n            }\n            \n            const poll = await response.json();\n            set({ selectedPoll: poll });\n            \n            logger.info('Poll loaded', { id });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to load poll:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        loadComments: async (pollId) => {\n          const { setLoading, setError } = get();\n          \n          try {\n            setLoading(true);\n            setError(null);\n            \n            const response = await fetch(`/api/polls/${pollId}/comments`);\n            \n            if (!response.ok) {\n              throw new Error('Failed to load comments');\n            }\n            \n            const comments = await response.json();\n            set({ comments });\n            \n            logger.info('Comments loaded', {\n              pollId,\n              count: comments.length\n            });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to load comments:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setLoading(false);\n          }\n        },\n        \n        createPoll: async (poll) => {\n          const { setUpdating, setError } = get();\n          \n          try {\n            setUpdating(true);\n            setError(null);\n            \n            const response = await fetch('/api/polls', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify(poll),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to create poll');\n            }\n            \n            const newPoll = await response.json();\n            \n            set((state) => ({\n              polls: [newPoll, ...state.polls],\n              filteredPolls: [newPoll, ...state.filteredPolls],\n            }));\n            \n            logger.info('Poll created successfully', {\n              pollId: newPoll.id,\n              title: newPoll.title\n            });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to create poll:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setUpdating(false);\n          }\n        },\n        \n        updatePollSettings: async (id, settings) => {\n          const { setUpdating, setError } = get();\n          \n          try {\n            setUpdating(true);\n            setError(null);\n            \n            const response = await fetch(`/api/polls/${id}/settings`, {\n              method: 'PUT',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify(settings),\n            });\n            \n            if (!response.ok) {\n              throw new Error('Failed to update poll settings');\n            }\n            \n            set((state) => ({\n              polls: state.polls.map(poll =>\n                poll.id === id \n                  ? withOptional(poll, { \n                      settings: withOptional(poll.settings, settings),\n                      timestamps: withOptional(poll.timestamps, { \n                        updatedAt: new Date().toISOString()\n                      })\n                    })\n                  : poll\n              ),\n              filteredPolls: state.filteredPolls.map(poll =>\n                poll.id === id \n                  ? withOptional(poll, { \n                      settings: withOptional(poll.settings, settings),\n                      timestamps: withOptional(poll.timestamps, { \n                        updatedAt: new Date().toISOString()\n                      })\n                    })\n                  : poll\n              ),\n            }));\n            \n            logger.info('Poll settings updated', { id });\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setError(errorMessage);\n            logger.error('Failed to update poll settings:', error instanceof Error ? error : new Error(errorMessage));\n          } finally {\n            setUpdating(false);\n          }\n        },\n        \n        // Loading state actions\n        setLoading: (loading) => set({ isLoading: loading }),\n        setSearching: (searching) => set({ isSearching: searching }),\n        setVoting: (voting) => set({ isVoting: voting }),\n        setUpdating: (updating) => set({ isUpdating: updating }),\n        setError: (error) => set({ error }),\n        clearError: () => set({ error: null }),\n      }),\n      {\n        name: 'polls-store',\n        partialize: (state) => ({\n          polls: state.polls,\n          comments: state.comments,\n          preferences: state.preferences,\n          filters: state.filters,\n          currentView: state.currentView,\n        }),\n      }\n    ),\n    { name: 'polls-store' }\n  )\n);\n\n// Store selectors for optimized re-renders\nexport const usePolls = () => usePollsStore(state => state.polls);\nexport const useFilteredPolls = () => usePollsStore(state => state.filteredPolls);\nexport const usePollComments = () => usePollsStore(state => state.comments);\nexport const usePollSearch = () => usePollsStore(state => state.search);\nexport const useSelectedPoll = () => usePollsStore(state => state.selectedPoll);\nexport const usePollPreferences = () => usePollsStore(state => state.preferences);\nexport const usePollFilters = () => usePollsStore(state => state.filters);\nexport const usePollsLoading = () => usePollsStore(state => state.isLoading);\nexport const usePollsError = () => usePollsStore(state => state.error);\n\n// Action selectors\nexport const usePollsActions = () => usePollsStore(state => ({\n  setPolls: state.setPolls,\n  addPoll: state.addPoll,\n  updatePoll: state.updatePoll,\n  removePoll: state.removePoll,\n  publishPoll: state.publishPoll,\n  closePoll: state.closePoll,\n  archivePoll: state.archivePoll,\n  voteOnPoll: state.voteOnPoll,\n  undoVote: state.undoVote,\n  changeVote: state.changeVote,\n  setComments: state.setComments,\n  addComment: state.addComment,\n  updateComment: state.updateComment,\n  removeComment: state.removeComment,\n  likeComment: state.likeComment,\n  unlikeComment: state.unlikeComment,\n  setFilters: state.setFilters,\n  clearFilters: state.clearFilters,\n  searchPolls: state.searchPolls,\n  setSearchQuery: state.setSearchQuery,\n  clearSearch: state.clearSearch,\n  setSelectedPoll: state.setSelectedPoll,\n  setCurrentView: state.setCurrentView,\n  setSelectedCategory: state.setSelectedCategory,\n  updatePreferences: state.updatePreferences,\n  resetPreferences: state.resetPreferences,\n  loadPolls: state.loadPolls,\n  loadPoll: state.loadPoll,\n  loadComments: state.loadComments,\n  createPoll: state.createPoll,\n  updatePollSettings: state.updatePollSettings,\n  setLoading: state.setLoading,\n  setSearching: state.setSearching,\n  setVoting: state.setVoting,\n  setUpdating: state.setUpdating,\n  setError: state.setError,\n  clearError: state.clearError,\n}));\n\n// Computed selectors\nexport const usePollsStats = () => usePollsStore(state => ({\n  totalPolls: state.polls.length,\n  filteredPolls: state.filteredPolls.length,\n  activePolls: state.polls.filter(poll => poll.status === 'active').length,\n  closedPolls: state.polls.filter(poll => poll.status === 'closed').length,\n  userVotedPolls: state.polls.filter(poll => poll.voting.hasVoted).length,\n  searchResults: state.search.results.length,\n  isLoading: state.isLoading,\n  isVoting: state.isVoting,\n  error: state.error,\n}));\n\nexport const useUserVotedPolls = () => usePollsStore(state => \n  state.polls.filter(poll => poll.voting.hasVoted)\n);\n\nexport const useActivePolls = () => usePollsStore(state => \n  state.polls.filter(poll => poll.status === 'active')\n);\n\nexport const usePollCommentsByPollId = (pollId: string) => usePollsStore(state => \n  state.comments.filter(comment => comment.pollId === pollId)\n);\n\n// Store utilities\nexport const pollsStoreUtils = {\n  /**\n   * Get polls summary\n   */\n  getPollsSummary: () => {\n    const state = usePollsStore.getState();\n    return {\n      totalPolls: state.polls.length,\n      filteredPolls: state.filteredPolls.length,\n      comments: state.comments.length,\n      searchResults: state.search.results.length,\n      preferences: state.preferences,\n    };\n  },\n  \n  /**\n   * Get polls by status\n   */\n  getPollsByStatus: (status: string) => {\n    const state = usePollsStore.getState();\n    return state.polls.filter(poll => poll.status === status);\n  },\n  \n  /**\n   * Get polls by category\n   */\n  getPollsByCategory: (category: string) => {\n    const state = usePollsStore.getState();\n    return state.polls.filter(poll => poll.category === category);\n  },\n  \n  /**\n   * Get trending polls\n   */\n  getTrendingPolls: () => {\n    const state = usePollsStore.getState();\n    return state.polls\n      .filter(poll => poll.status === 'active')\n      .sort((a, b) => b.voting.totalVotes - a.voting.totalVotes)\n      .slice(0, 10);\n  },\n  \n  /**\n   * Get recent polls\n   */\n  getRecentPolls: (limit: number = 10) => {\n    const state = usePollsStore.getState();\n    return state.polls\n      .sort((a, b) => new Date(b.timestamps.createdAt).getTime() - new Date(a.timestamps.createdAt).getTime())\n      .slice(0, limit);\n  }\n};\n\n// Store subscriptions for external integrations\nexport const pollsStoreSubscriptions = {\n  /**\n   * Subscribe to polls changes\n   */\n  onPollsChange: (callback: (polls: Poll[]) => void) => {\n    let prevPolls: Poll[] | null = null;\n    return usePollsStore.subscribe(\n      (state) => {\n        const polls = state.polls;\n        if (polls !== prevPolls) {\n          callback(polls);\n        }\n        prevPolls = polls;\n        return polls;\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to voting changes\n   */\n  onVotingChange: (callback: (poll: Poll) => void) => {\n    let prevPoll: Poll | null = null;\n    return usePollsStore.subscribe(\n      (state) => {\n        const poll = state.selectedPoll;\n        if (poll !== prevPoll && poll?.voting) {\n          callback(poll);\n        }\n        prevPoll = poll;\n        return poll;\n      }\n    );\n  },\n  \n  /**\n   * Subscribe to comments changes\n   */\n  onCommentsChange: (callback: (comments: PollComment[]) => void) => {\n    let prevComments: PollComment[] | null = null;\n    return usePollsStore.subscribe(\n      (state) => {\n        const comments = state.comments;\n        if (comments !== prevComments) {\n          callback(comments);\n        }\n        prevComments = comments;\n        return comments;\n      }\n    );\n  }\n};\n\n// Store debugging utilities\nexport const pollsStoreDebug = {\n  /**\n   * Log current polls state\n   */\n  logState: () => {\n    const state = usePollsStore.getState();\n    console.log('Polls Store State:', {\n      totalPolls: state.polls.length,\n      filteredPolls: state.filteredPolls.length,\n      comments: state.comments.length,\n      searchResults: state.search.results.length,\n      selectedPoll: state.selectedPoll?.title || 'none',\n      currentView: state.currentView,\n      isLoading: state.isLoading,\n      isVoting: state.isVoting,\n      error: state.error\n    });\n  },\n  \n  /**\n   * Log polls summary\n   */\n  logSummary: () => {\n    const summary = pollsStoreUtils.getPollsSummary();\n    console.log('Polls Summary:', summary);\n  },\n  \n  /**\n   * Log polls by status\n   */\n  logPollsByStatus: () => {\n    const state = usePollsStore.getState();\n    const byStatus = state.polls.reduce((acc, poll) => {\n      acc[poll.status] = (acc[poll.status] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n    console.log('Polls by Status:', byStatus);\n  },\n  \n  /**\n   * Reset polls store\n   */\n  reset: () => {\n    usePollsStore.getState().clearFilters();\n    usePollsStore.getState().resetPreferences();\n    console.log('Polls store reset');\n  }\n};\n"],"names":["pollsStoreDebug","pollsStoreSubscriptions","pollsStoreUtils","useActivePolls","useFilteredPolls","usePollComments","usePollCommentsByPollId","usePollFilters","usePollPreferences","usePollSearch","usePolls","usePollsActions","usePollsError","usePollsLoading","usePollsStats","usePollsStore","useSelectedPoll","useUserVotedPolls","defaultPreferences","defaultView","sortBy","itemsPerPage","showResults","autoRefresh","refreshInterval","notifications","newPolls","pollUpdates","pollCloses","pollResults","privacy","showVoteHistory","showPollParticipation","shareActivity","voting","confirmVotes","showProgress","allowUndo","undoTimeLimit","defaultFilters","status","category","tags","author","dateRange","start","end","votingStatus","visibility","create","devtools","persist","set","get","polls","filteredPolls","comments","search","query","results","totalResults","currentPage","totalPages","filters","suggestions","recentSearches","selectedPoll","currentView","selectedCategory","preferences","isLoading","isSearching","isVoting","isUpdating","error","setPolls","addPoll","poll","state","updatePoll","id","updates","map","withOptional","removePoll","filter","publishPoll","timestamps","publishedAt","Date","toISOString","updatedAt","closePoll","closesAt","archivePoll","voteOnPoll","pollId","optionId","setVoting","setError","response","fetch","method","headers","body","JSON","stringify","ok","Error","userVote","userVotedAt","hasVoted","totalVotes","optionResults","result","votes","logger","info","errorMessage","message","undoVote","find","p","undefined","Math","max","changeVote","newOptionId","setComments","addComment","comment","now","random","toString","substr","createdAt","updateComment","removeComment","likeComment","userLiked","likes","unlikeComment","setFilters","newFilters","filtered","length","includes","some","tag","clearFilters","searchPolls","setSearching","json","total","ceil","setSearchQuery","clearSearch","setSelectedPoll","setCurrentView","view","setSelectedCategory","updatePreferences","resetPreferences","loadPolls","setLoading","count","loadPoll","loadComments","createPoll","setUpdating","newPoll","title","updatePollSettings","settings","loading","searching","updating","clearError","name","partialize","totalPolls","activePolls","closedPolls","userVotedPolls","searchResults","getPollsSummary","getState","getPollsByStatus","getPollsByCategory","getTrendingPolls","sort","a","b","slice","getRecentPolls","limit","getTime","onPollsChange","callback","prevPolls","subscribe","onVotingChange","prevPoll","onCommentsChange","prevComments","logState","console","log","logSummary","summary","logPollsByStatus","byStatus","reduce","acc","reset"],"mappings":"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"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/lib/vote/voting-algorithms.test.ts"],"sourcesContent":["/**\n * Unit Tests - Voting Algorithms (70% of tests)\n * \n * These tests focus on individual functions and algorithms.\n * Fast, isolated, and focused on business logic.\n */\n\nimport { describe, it, expect } from '@jest/globals';\n\n// Import voting algorithms\nimport { calculateResults } from '@/lib/vote/strategies/ranked';\nimport { calculateSingleChoiceResults } from '@/lib/vote/strategies/single-choice';\n\ndescribe('Unit Tests - Voting Algorithms', () => {\n  describe('Ranked Choice Voting Algorithm', () => {\n    it('should calculate instant-runoff voting correctly', () => {\n      // Test data for ranked choice voting\n      const votes = [\n        { user_id: 'user1', rankings: [1, 2, 3] }, // A, B, C\n        { user_id: 'user2', rankings: [1, 3, 2] }, // A, C, B\n        { user_id: 'user3', rankings: [2, 1, 3] }, // B, A, C\n        { user_id: 'user4', rankings: [2, 3, 1] }, // B, C, A\n        { user_id: 'user5', rankings: [3, 1, 2] }, // C, A, B\n      ];\n\n      const options = [\n        { id: 'option1', text: 'Option A' },\n        { id: 'option2', text: 'Option B' },\n        { id: 'option3', text: 'Option C' }\n      ];\n\n      const result = calculateResults(votes, options);\n\n      // Test the algorithm logic\n      expect(result).toBeDefined();\n      expect(result.winner).toBeDefined();\n      expect(result.rounds).toBeDefined();\n      expect(Array.isArray(result.rounds)).toBe(true);\n    });\n\n    it('should handle ties correctly', () => {\n      const votes = [\n        { user_id: 'user1', rankings: [1, 2] },\n        { user_id: 'user2', rankings: [2, 1] }\n      ];\n\n      const options = [\n        { id: 'option1', text: 'Option A' },\n        { id: 'option2', text: 'Option B' }\n      ];\n\n      const result = calculateResults(votes, options);\n\n      expect(result).toBeDefined();\n      expect(result.winner).toBeDefined();\n    });\n\n    it('should handle single candidate correctly', () => {\n      const votes = [\n        { user_id: 'user1', rankings: [1] }\n      ];\n\n      const options = [\n        { id: 'option1', text: 'Option A' }\n      ];\n\n      const result = calculateResults(votes, options);\n\n      expect(result).toBeDefined();\n      expect(result.winner).toBe('option1');\n    });\n  });\n\n  describe('Single Choice Voting Algorithm', () => {\n    it('should calculate simple majority correctly', () => {\n      const votes = [\n        { user_id: 'user1', option_index: 0 },\n        { user_id: 'user2', option_index: 0 },\n        { user_id: 'user3', option_index: 1 },\n        { user_id: 'user4', option_index: 1 },\n        { user_id: 'user5', option_index: 1 }\n      ];\n\n      const options = [\n        { id: 'option1', text: 'Option A' },\n        { id: 'option2', text: 'Option B' }\n      ];\n\n      const result = calculateSingleChoiceResults(votes, options);\n\n      expect(result).toBeDefined();\n      expect(result.winner).toBe('option2'); // Option B wins with 3 votes\n      expect(result.results[1].votes).toBe(3);\n      expect(result.results[0].votes).toBe(2);\n    });\n\n    it('should handle no votes correctly', () => {\n      const votes: any[] = [];\n      const options = [\n        { id: 'option1', text: 'Option A' },\n        { id: 'option2', text: 'Option B' }\n      ];\n\n      const result = calculateSingleChoiceResults(votes, options);\n\n      expect(result).toBeDefined();\n      expect(result.winner).toBeNull();\n      expect(result.results[0].votes).toBe(0);\n      expect(result.results[1].votes).toBe(0);\n    });\n\n    it('should handle ties correctly', () => {\n      const votes = [\n        { user_id: 'user1', option_index: 0 },\n        { user_id: 'user2', option_index: 1 }\n      ];\n\n      const options = [\n        { id: 'option1', text: 'Option A' },\n        { id: 'option2', text: 'Option B' }\n      ];\n\n      const result = calculateSingleChoiceResults(votes, options);\n\n      expect(result).toBeDefined();\n      expect(result.winner).toBeNull(); // Tie\n      expect(result.results[0].votes).toBe(1);\n      expect(result.results[1].votes).toBe(1);\n    });\n  });\n\n  describe('Vote Validation', () => {\n    it('should validate vote data structure', () => {\n      const validVote = {\n        user_id: 'user1',\n        option_index: 0,\n        created_at: new Date().toISOString()\n      };\n\n      // Test validation logic\n      expect(validVote.user_id).toBeDefined();\n      expect(validVote.option_index).toBeDefined();\n      expect(validVote.created_at).toBeDefined();\n      expect(typeof validVote.user_id).toBe('string');\n      expect(typeof validVote.option_index).toBe('number');\n      expect(typeof validVote.created_at).toBe('string');\n    });\n\n    it('should reject invalid vote data', () => {\n      const invalidVote = {\n        user_id: '',\n        option_index: -1,\n        created_at: 'invalid-date'\n      };\n\n      // Test validation logic\n      expect(invalidVote.user_id).toBe('');\n      expect(invalidVote.option_index).toBe(-1);\n      expect(invalidVote.created_at).toBe('invalid-date');\n    });\n  });\n\n  describe('Result Calculations', () => {\n    it('should calculate percentages correctly', () => {\n      const totalVotes = 100;\n      const optionVotes = 25;\n      const expectedPercentage = 25;\n\n      const percentage = (optionVotes / totalVotes) * 100;\n\n      expect(percentage).toBe(expectedPercentage);\n    });\n\n    it('should handle zero total votes', () => {\n      const totalVotes = 0;\n      const optionVotes = 0;\n\n      const percentage = totalVotes > 0 ? (optionVotes / totalVotes) * 100 : 0;\n\n      expect(percentage).toBe(0);\n    });\n\n    it('should round percentages correctly', () => {\n      const totalVotes = 3;\n      const optionVotes = 1;\n      const expectedPercentage = 33.33;\n\n      const percentage = Math.round((optionVotes / totalVotes) * 100 * 100) / 100;\n\n      expect(percentage).toBe(expectedPercentage);\n    });\n  });\n});\n"],"names":["describe","it","votes","user_id","rankings","options","id","text","result","calculateResults","expect","toBeDefined","winner","rounds","Array","isArray","toBe","option_index","calculateSingleChoiceResults","results","toBeNull","validVote","created_at","Date","toISOString","invalidVote","totalVotes","optionVotes","expectedPercentage","percentage","Math","round"],"mappings":"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"}
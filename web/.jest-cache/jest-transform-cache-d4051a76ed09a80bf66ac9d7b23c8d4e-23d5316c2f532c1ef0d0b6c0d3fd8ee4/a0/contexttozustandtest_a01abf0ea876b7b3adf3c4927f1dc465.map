{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/migration/context-to-zustand.test.ts"],"sourcesContent":["/**\n * Context API to Zustand Migration Validation Tests\n * \n * Ensures complete migration from Context API to Zustand stores\n * by scanning for remaining Context API usage patterns.\n * \n * Created: January 27, 2025\n * Status: âœ… ACTIVE\n */\n\nimport { describe, it, expect } from '@jest/globals';\nimport * as fs from 'fs';\nimport * as glob from 'glob';\n\ndescribe('Context API Migration', () => {\n  it('no useAuth() calls should remain', () => {\n    const files = glob.sync('web/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**', '**/dist/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    files.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for useAuth() calls\n      if (content.includes('useAuth()')) {\n        problematicFiles.push(`${file}: contains useAuth() call`);\n      }\n      \n      // Check for useAuth imports\n      if (content.includes('import') && content.includes('useAuth')) {\n        problematicFiles.push(`${file}: imports useAuth`);\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Files with useAuth() calls:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('no Context API imports should remain', () => {\n    const files = glob.sync('web/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**', '**/dist/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    files.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for Context API imports\n      if (content.includes('createContext') || content.includes('useContext')) {\n        // Allow in specific contexts (like React context for UI)\n        if (!content.includes('React.createContext') && !content.includes('createContext(')) {\n          problematicFiles.push(`${file}: contains Context API usage`);\n        }\n      }\n      \n      // Check for old auth context imports\n      if (content.includes('AuthContext') || content.includes('UserContext')) {\n        problematicFiles.push(`${file}: contains old context imports`);\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Files with Context API usage:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('all stores should use centralized imports', () => {\n    const files = glob.sync('web/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**', '**/dist/**', '**/lib/stores/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    files.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for direct Zustand imports\n      if (content.includes('from \\'zustand\\'') || content.includes('from \"zustand\"')) {\n        problematicFiles.push(`${file}: should use centralized store imports`);\n      }\n      \n      // Check for direct store imports\n      if (content.includes('from \\'../stores/') || content.includes('from \"../stores/')) {\n        problematicFiles.push(`${file}: should use @/lib/stores imports`);\n      }\n      \n      // Check for store imports that should use centralized pattern\n      if (content.includes('useUserStore') || content.includes('useAppStore') || content.includes('useAdminStore')) {\n        if (!content.includes('from \\'@/lib/stores\\'') && !content.includes('from \"@/lib/stores\"')) {\n          problematicFiles.push(`${file}: store imports should use @/lib/stores`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Files with improper store imports:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('store usage should be consistent', () => {\n    const files = glob.sync('web/**/*.{ts,tsx}', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**', '**/dist/**'] \n    });\n    \n    const problematicFiles: string[] = [];\n    \n    files.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for mixed store usage patterns\n      if (content.includes('useUserStore') && content.includes('useAuth')) {\n        problematicFiles.push(`${file}: mixed store usage patterns`);\n      }\n      \n      // Check for old state management patterns\n      if (content.includes('useState') && content.includes('useEffect') && content.includes('localStorage')) {\n        // This might indicate old state management that should use stores\n        if (content.includes('user') || content.includes('auth') || content.includes('app')) {\n          problematicFiles.push(`${file}: should use Zustand stores instead of local state`);\n        }\n      }\n    });\n    \n    if (problematicFiles.length > 0) {\n      console.log('Files with inconsistent store usage:', problematicFiles);\n    }\n    \n    expect(problematicFiles).toHaveLength(0);\n  });\n\n  it('store subscriptions should be properly implemented', () => {\n    const storeFiles = glob.sync('web/lib/stores/*.ts', { \n      ignore: ['**/*.test.*', '**/*.spec.*', '**/node_modules/**'] \n    });\n    \n    const problematicStores: string[] = [];\n    \n    storeFiles.forEach(file => {\n      const content = fs.readFileSync(file, 'utf8');\n      \n      // Check for subscription methods\n      if (content.includes('subscribe')) {\n        // Should use proper Zustand subscription pattern\n        if (!content.includes('useStore.subscribe')) {\n          problematicStores.push(`${file}: subscription methods should use useStore.subscribe`);\n        }\n      }\n    });\n    \n    if (problematicStores.length > 0) {\n      console.log('Stores with improper subscriptions:', problematicStores);\n    }\n    \n    expect(problematicStores).toHaveLength(0);\n  });\n});\n"],"names":["describe","it","files","glob","sync","ignore","problematicFiles","forEach","file","content","fs","readFileSync","includes","push","length","console","log","expect","toHaveLength","storeFiles","problematicStores"],"mappings":"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"}
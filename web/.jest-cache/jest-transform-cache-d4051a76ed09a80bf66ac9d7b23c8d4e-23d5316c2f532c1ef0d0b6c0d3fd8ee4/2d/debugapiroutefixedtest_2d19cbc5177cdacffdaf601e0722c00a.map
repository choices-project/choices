{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/api/debug-api-route-fixed.test.ts"],"sourcesContent":["/**\n * Debug API Route Test - FIXED VERSION\n * \n * This test helps debug what's causing the 500 error in the API route\n */\n\n// Set environment variables BEFORE any imports\nprocess.env.NEXT_PUBLIC_SUPABASE_URL = 'https://muqwrehywjrbaeerjgfb.supabase.co';\nprocess.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\nprocess.env.SUPABASE_SECRET_KEY = 'sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc';\n\n// Mock getSupabaseServerClient BEFORE importing the API route\njest.mock('@/utils/supabase/server', () => ({\n  getSupabaseServerClient: jest.fn(() => {\n    console.log('üîß Mock getSupabaseServerClient called');\n    console.log('üîß URL:', process.env.NEXT_PUBLIC_SUPABASE_URL);\n    console.log('üîß KEY:', process.env.SUPABASE_SECRET_KEY ? 'SET' : 'NOT SET');\n    \n    // Create a mock Supabase client that returns real data\n    const mockSupabaseClient = {\n      from: jest.fn(() => ({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            limit: jest.fn().mockResolvedValue({\n              data: [\n                {\n                  id: 'poll-1',\n                  title: 'Test Poll 1',\n                  total_votes: 10,\n                  options: [\n                    { id: 'opt-1', text: 'Option 1', votes: 6 },\n                    { id: 'opt-2', text: 'Option 2', votes: 4 }\n                  ],\n                  status: 'active'\n                }\n              ],\n              error: null,\n            }),\n          })),\n        })),\n      })),\n    };\n    \n    console.log('üîß Mock Supabase client created:', !!mockSupabaseClient);\n    return Promise.resolve(mockSupabaseClient);\n  })\n}));\n\nimport { describe, it, expect } from '@jest/globals';\nimport { NextRequest } from 'next/server';\nimport { GET } from '@/app/api/polls/route';\n\ndescribe('Debug API Route - FIXED', () => {\n  it('should debug the API route step by step', async () => {\n    console.log('=== DEBUGGING API ROUTE ===');\n    \n    try {\n      console.log('1. Creating NextRequest...');\n      const request = new NextRequest('http://localhost:3000/api/polls');\n      console.log('‚úÖ NextRequest created successfully');\n      \n      console.log('2. Calling GET function...');\n      const response = await GET(request);\n      console.log('‚úÖ GET function completed');\n      \n      console.log('3. Getting response status...');\n      console.log('Response status:', response.status);\n      \n      console.log('4. Getting response data...');\n      const responseData = await response.json();\n      console.log('Response data:', JSON.stringify(responseData, null, 2));\n      \n      console.log('5. Checking response structure...');\n      console.log('Has success property:', responseData.hasOwnProperty('success'));\n      console.log('Has error property:', responseData.hasOwnProperty('error'));\n      \n      // For now, just check that we get some response\n      expect(response).toBeDefined();\n      expect(responseData).toBeDefined();\n      \n    } catch (error) {\n      console.error('‚ùå Error in API route:', error);\n      console.error('Error stack:', error.stack);\n      throw error;\n    }\n  });\n});\n"],"names":["jest","mock","getSupabaseServerClient","fn","console","log","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SECRET_KEY","mockSupabaseClient","from","select","eq","limit","mockResolvedValue","data","id","title","total_votes","options","text","votes","status","error","Promise","resolve","NEXT_PUBLIC_SUPABASE_ANON_KEY","describe","it","request","NextRequest","response","GET","responseData","json","JSON","stringify","hasOwnProperty","expect","toBeDefined","stack"],"mappings":"AAAA;;;;CAIC,GAED,+CAA+C;;AAK/C,8DAA8D;AAC9DA,KAAKC,IAAI,CAAC,2BAA2B,IAAO,CAAA;QAC1CC,yBAAyBF,KAAKG,EAAE,CAAC;YAC/BC,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,qBAAWC,QAAQC,GAAG,CAACC,wBAAwB;YAC3DJ,QAAQC,GAAG,CAAC,qBAAWC,QAAQC,GAAG,CAACE,mBAAmB,GAAG,QAAQ;YAEjE,uDAAuD;YACvD,MAAMC,qBAAqB;gBACzBC,MAAMX,KAAKG,EAAE,CAAC,IAAO,CAAA;wBACnBS,QAAQZ,KAAKG,EAAE,CAAC,IAAO,CAAA;gCACrBU,IAAIb,KAAKG,EAAE,CAAC,IAAO,CAAA;wCACjBW,OAAOd,KAAKG,EAAE,GAAGY,iBAAiB,CAAC;4CACjCC,MAAM;gDACJ;oDACEC,IAAI;oDACJC,OAAO;oDACPC,aAAa;oDACbC,SAAS;wDACP;4DAAEH,IAAI;4DAASI,MAAM;4DAAYC,OAAO;wDAAE;wDAC1C;4DAAEL,IAAI;4DAASI,MAAM;4DAAYC,OAAO;wDAAE;qDAC3C;oDACDC,QAAQ;gDACV;6CACD;4CACDC,OAAO;wCACT;oCACF,CAAA;4BACF,CAAA;oBACF,CAAA;YACF;YAEApB,QAAQC,GAAG,CAAC,8CAAoC,CAAC,CAACK;YAClD,OAAOe,QAAQC,OAAO,CAAChB;QACzB;IACF,CAAA;;;;yBAEqC;wBACT;uBACR;AA3CpBJ,QAAQC,GAAG,CAACC,wBAAwB,GAAG;AACvCF,QAAQC,GAAG,CAACoB,6BAA6B,GAAG;AAC5CrB,QAAQC,GAAG,CAACE,mBAAmB,GAAG;AA2ClCmB,IAAAA,iBAAQ,EAAC,2BAA2B;IAClCC,IAAAA,WAAE,EAAC,2CAA2C;QAC5CzB,QAAQC,GAAG,CAAC;QAEZ,IAAI;YACFD,QAAQC,GAAG,CAAC;YACZ,MAAMyB,UAAU,IAAIC,mBAAW,CAAC;YAChC3B,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZ,MAAM2B,WAAW,MAAMC,IAAAA,UAAG,EAACH;YAC3B1B,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,oBAAoB2B,SAAST,MAAM;YAE/CnB,QAAQC,GAAG,CAAC;YACZ,MAAM6B,eAAe,MAAMF,SAASG,IAAI;YACxC/B,QAAQC,GAAG,CAAC,kBAAkB+B,KAAKC,SAAS,CAACH,cAAc,MAAM;YAEjE9B,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,yBAAyB6B,aAAaI,cAAc,CAAC;YACjElC,QAAQC,GAAG,CAAC,uBAAuB6B,aAAaI,cAAc,CAAC;YAE/D,gDAAgD;YAChDC,IAAAA,eAAM,EAACP,UAAUQ,WAAW;YAC5BD,IAAAA,eAAM,EAACL,cAAcM,WAAW;QAElC,EAAE,OAAOhB,OAAO;YACdpB,QAAQoB,KAAK,CAAC,yBAAyBA;YACvCpB,QAAQoB,KAAK,CAAC,gBAAgBA,MAAMiB,KAAK;YACzC,MAAMjB;QACR;IACF;AACF"}
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/lib/vote/engine-comprehensive.test.ts"],"sourcesContent":["/**\n * Comprehensive Vote Engine Tests\n * \n * Tests the core voting engine with all voting strategies\n * Tests validation, processing, and results calculation\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { VoteEngine, type VoteEngineConfig } from '@/lib/vote/engine'\nimport type { VoteRequest, VoteResponse, PollData, VotingMethod } from '@/lib/vote/types'\n\n// Mock the logger\njest.mock('@/lib/utils/logger', () => ({\n  devLog: jest.fn()\n}))\n\ndescribe('VoteEngine', () => {\n  let engine: VoteEngine\n  let config: VoteEngineConfig\n  let mockPoll: PollData\n  let mockVoteRequest: VoteRequest\n\n  beforeEach(() => {\n    config = {\n      maxVotesPerPoll: 1,\n      allowMultipleVotes: false,\n      requireAuthentication: true,\n      minTrustTier: 'basic',\n      rateLimitPerUser: 10,\n      rateLimitWindowMs: 60000\n    }\n\n    engine = new VoteEngine(config)\n\n    mockPoll = {\n      id: 'test-poll-id',\n      title: 'Test Poll',\n      description: 'A test poll',\n      votingMethod: 'single' as VotingMethod,\n      options: [\n        { id: 'option-1', text: 'Option 1' },\n        { id: 'option-2', text: 'Option 2' }\n      ],\n      status: 'active',\n      createdAt: new Date(),\n      closeAt: new Date(Date.now() + 86400000), // 24 hours from now\n      createdBy: 'user-1',\n      settings: {\n        allowMultipleVotes: false,\n        requireAuthentication: true,\n        anonymousVoting: false\n      }\n    }\n\n    mockVoteRequest = {\n      pollId: 'test-poll-id',\n      userId: 'user-1',\n      voteData: {\n        choice: 0, // Index of option-1\n        approvals: null,\n        rankings: null,\n        allocations: null,\n        ratings: null\n      },\n      metadata: {\n        ipAddress: '192.168.1.1',\n        userAgent: 'Mozilla/5.0',\n        timestamp: new Date()\n      }\n    }\n  })\n\n  describe('Initialization', () => {\n    it('should initialize with provided configuration', () => {\n      expect(engine).toBeDefined()\n    })\n\n    it('should use default configuration when none provided', () => {\n      const defaultEngine = new VoteEngine()\n      expect(defaultEngine).toBeDefined()\n    })\n  })\n\n  describe('Vote Validation', () => {\n    it('should validate single-choice votes correctly', async () => {\n      const validation = await engine.validateVote(mockVoteRequest, mockPoll)\n      \n      expect(validation.valid).toBe(true)\n      expect(validation.errors).toHaveLength(0)\n    })\n\n    it('should reject votes with invalid poll ID', async () => {\n      const invalidRequest = { ...mockVoteRequest, pollId: 'invalid-poll' }\n      \n      const validation = await engine.validateVote(invalidRequest, mockPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Poll ID mismatch')\n    })\n\n    it('should reject votes for closed polls', async () => {\n      const closedPoll = { ...mockPoll, status: 'closed' as const }\n      \n      const validation = await engine.validateVote(mockVoteRequest, closedPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Poll is not active')\n    })\n\n    it('should reject votes with invalid options', async () => {\n      const invalidRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          choice: 999, // Invalid option index\n          approvals: null,\n          rankings: null,\n          allocations: null,\n          ratings: null\n        }\n      }\n      \n      const validation = await engine.validateVote(invalidRequest, mockPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Invalid option selected')\n    })\n\n    it('should validate ranked-choice votes', async () => {\n      const rankedPoll = { ...mockPoll, votingMethod: 'ranked' as VotingMethod }\n      const rankedRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          choice: null,\n          approvals: null,\n          rankings: [0, 1], // Rankings for option-1 and option-2\n          allocations: null,\n          ratings: null\n        }\n      }\n      \n      const validation = await engine.validateVote(rankedRequest, rankedPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n\n    it('should validate approval votes', async () => {\n      const approvalPoll = { ...mockPoll, votingMethod: 'approval' as VotingMethod }\n      const approvalRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          choice: null,\n          approvals: [0, 1], // Approve option-1 and option-2\n          rankings: null,\n          allocations: null,\n          ratings: null\n        }\n      }\n      \n      const validation = await engine.validateVote(approvalRequest, approvalPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n\n    it('should validate quadratic votes', async () => {\n      const quadraticPoll = { ...mockPoll, votingMethod: 'quadratic' as VotingMethod }\n      const quadraticRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          choice: null,\n          approvals: null,\n          rankings: null,\n          allocations: { 'option-1': 2, 'option-2': 1 },\n          ratings: null\n        }\n      }\n      \n      const validation = await engine.validateVote(quadraticRequest, quadraticPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n  })\n\n  describe('Vote Processing', () => {\n    it('should process single-choice votes successfully', async () => {\n      const response = await engine.processVote(mockVoteRequest, mockPoll)\n      \n      expect(response.success).toBe(true)\n      expect(response.voteId).toBeDefined()\n      expect(response.timestamp).toBeDefined()\n    })\n\n    it('should process ranked-choice votes successfully', async () => {\n      const rankedPoll = { ...mockPoll, votingMethod: 'ranked-choice' as VotingMethod }\n      const rankedRequest = {\n        ...mockVoteRequest,\n        voteData: {\n          choice: null,\n          approvals: null,\n          rankings: [0, 1], // Rank option-1 first, option-2 second\n          allocations: null,\n          ratings: null\n        }\n      }\n      \n      const response = await engine.processVote(rankedRequest, rankedPoll)\n      \n      expect(response.success).toBe(true)\n      expect(response.voteId).toBeDefined()\n    })\n\n    it('should handle vote processing errors gracefully', async () => {\n      // Mock a processing error by creating a poll with invalid voting method\n      const invalidPoll = { ...mockPoll, votingMethod: 'invalid-method' as any }\n      \n      const response = await engine.processVote(mockVoteRequest, invalidPoll)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toBeDefined()\n    })\n  })\n\n  describe('Results Calculation', () => {\n    it('should calculate single-choice results', async () => {\n      const votes = [\n        { choice: 0, approvals: null, rankings: null, allocations: null, ratings: null },\n        { choice: 0, approvals: null, rankings: null, allocations: null, ratings: null },\n        { choice: 1, approvals: null, rankings: null, allocations: null, ratings: null }\n      ]\n      \n      const results = await engine.calculateResults(mockPoll, votes)\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(3)\n      expect(results.results.winner).toBe('option-1')\n    })\n\n    it('should calculate ranked-choice results', async () => {\n      const rankedPoll = { ...mockPoll, votingMethod: 'ranked-choice' as VotingMethod }\n      const votes = [\n        { choice: null, approvals: null, rankings: [0, 1], allocations: null, ratings: null },\n        { choice: null, approvals: null, rankings: [1, 0], allocations: null, ratings: null }\n      ]\n      \n      const results = await engine.calculateResults(rankedPoll, votes)\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(2)\n    })\n\n    it('should handle empty vote sets', async () => {\n      const results = await engine.calculateResults(mockPoll, [])\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(0)\n      expect(results.results.winner).toBeNull()\n    })\n\n    it('should handle tie scenarios', async () => {\n      const votes = [\n        { choice: 0, approvals: null, rankings: null, allocations: null, ratings: null },\n        { choice: 1, approvals: null, rankings: null, allocations: null, ratings: null }\n      ]\n      \n      const results = await engine.calculateResults(mockPoll, votes)\n      \n      expect(results).toBeDefined()\n      expect(results.totalVotes).toBe(2)\n      // In a tie, the result should indicate no clear winner\n    })\n  })\n\n  describe('Rate Limiting', () => {\n    it('should enforce rate limits', async () => {\n      // Create multiple requests from the same user\n      const requests = Array.from({ length: 15 }, (_, i) => ({\n        ...mockVoteRequest,\n        userId: 'user-1',\n        metadata: {\n          ...mockVoteRequest.metadata,\n          timestamp: new Date(Date.now() + i * 1000)\n        }\n      }))\n      \n      // Process requests and check rate limiting\n      const responses = await Promise.all(\n        requests.map(request => engine.processVote(request, mockPoll))\n      )\n      \n      // Debug: Check what responses we got\n      console.log('Rate limiting test responses:', responses.map(r => ({ success: r.success, error: r.error })))\n      \n      // Some requests should be rate limited\n      const rateLimitedResponses = responses.filter(r => !r.success && r.error?.includes('rate limit'))\n      expect(rateLimitedResponses.length).toBeGreaterThan(0)\n    })\n\n    it('should allow requests within rate limit', async () => {\n      const requests = Array.from({ length: 5 }, (_, i) => ({\n        ...mockVoteRequest,\n        userId: 'user-1',\n        metadata: {\n          ...mockVoteRequest.metadata,\n          timestamp: new Date(Date.now() + i * 1000)\n        }\n      }))\n      \n      const responses = await Promise.all(\n        requests.map(request => engine.processVote(request, mockPoll))\n      )\n      \n      // All requests should succeed within rate limit\n      const successfulResponses = responses.filter(r => r.success)\n      expect(successfulResponses.length).toBe(5)\n    })\n  })\n\n  describe('Authentication', () => {\n    it('should require authentication when configured', async () => {\n      const unauthenticatedRequest = { ...mockVoteRequest, userId: null }\n      \n      const validation = await engine.validateVote(unauthenticatedRequest, mockPoll)\n      \n      expect(validation.valid).toBe(false)\n      expect(validation.errors).toContain('Authentication required to vote')\n    })\n\n    it('should allow anonymous voting when configured', async () => {\n      const anonymousPoll = {\n        ...mockPoll,\n        settings: { ...mockPoll.settings, anonymousVoting: true }\n      }\n      \n      const anonymousRequest = { ...mockVoteRequest, userId: null }\n      \n      const validation = await engine.validateVote(anonymousRequest, anonymousPoll)\n      \n      expect(validation.valid).toBe(true)\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('should handle malformed vote data', async () => {\n      const malformedRequest = {\n        ...mockVoteRequest,\n        voteData: null\n      }\n      \n      const response = await engine.processVote(malformedRequest, mockPoll)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toBeDefined()\n    })\n\n    it('should handle missing poll data', async () => {\n      const response = await engine.processVote(mockVoteRequest, null as any)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toBeDefined()\n    })\n\n    it('should handle network errors gracefully', async () => {\n      // Create a scenario that would cause a processing error\n      const invalidRequest = {\n        ...mockVoteRequest,\n        voteData: null as any // This should cause a validation error\n      }\n      \n      const response = await engine.processVote(invalidRequest, mockPoll)\n      \n      expect(response.success).toBe(false)\n      expect(response.error).toBeDefined()\n    })\n  })\n\n  describe('Performance', () => {\n    it('should process votes within reasonable time', async () => {\n      const startTime = performance.now()\n      \n      await engine.processVote(mockVoteRequest, mockPoll)\n      \n      const endTime = performance.now()\n      const processingTime = endTime - startTime\n      \n      // Should process within 100ms\n      expect(processingTime).toBeLessThan(100)\n    })\n\n    it('should handle large vote sets efficiently', async () => {\n      const largeVoteSet = Array.from({ length: 1000 }, (_, i) => ({\n        ...mockVoteRequest,\n        userId: `user-${i}`,\n        voteData: {\n          selectedOptions: ['option-1'],\n          ranking: null,\n          weights: null\n        }\n      }))\n      \n      const startTime = performance.now()\n      \n      const results = await engine.calculateResults(mockPoll, largeVoteSet)\n      \n      const endTime = performance.now()\n      const processingTime = endTime - startTime\n      \n      expect(results).toBeDefined()\n      expect(processingTime).toBeLessThan(1000) // Should process within 1 second\n    })\n  })\n})\n"],"names":["jest","mock","devLog","fn","describe","engine","config","mockPoll","mockVoteRequest","beforeEach","maxVotesPerPoll","allowMultipleVotes","requireAuthentication","minTrustTier","rateLimitPerUser","rateLimitWindowMs","VoteEngine","id","title","description","votingMethod","options","text","status","createdAt","Date","closeAt","now","createdBy","settings","anonymousVoting","pollId","userId","voteData","choice","approvals","rankings","allocations","ratings","metadata","ipAddress","userAgent","timestamp","it","expect","toBeDefined","defaultEngine","validation","validateVote","valid","toBe","errors","toHaveLength","invalidRequest","toContain","closedPoll","rankedPoll","rankedRequest","approvalPoll","approvalRequest","quadraticPoll","quadraticRequest","response","processVote","success","voteId","invalidPoll","error","votes","results","calculateResults","totalVotes","winner","toBeNull","requests","Array","from","length","_","i","responses","Promise","all","map","request","console","log","r","rateLimitedResponses","filter","includes","toBeGreaterThan","successfulResponses","unauthenticatedRequest","anonymousPoll","anonymousRequest","malformedRequest","startTime","performance","endTime","processingTime","toBeLessThan","largeVoteSet","selectedOptions","ranking","weights"],"mappings":"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"}
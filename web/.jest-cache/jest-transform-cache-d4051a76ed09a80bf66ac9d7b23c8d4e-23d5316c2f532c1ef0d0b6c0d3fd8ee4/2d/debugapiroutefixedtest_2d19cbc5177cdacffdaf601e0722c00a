5dca4ec0a5d0a555ad654810aef65f00
/**
 * Debug API Route Test - FIXED VERSION
 * 
 * This test helps debug what's causing the 500 error in the API route
 */ // Set environment variables BEFORE any imports
"use strict";
// Mock getSupabaseServerClient BEFORE importing the API route
jest.mock("@/utils/supabase/server", ()=>({
        getSupabaseServerClient: jest.fn(()=>{
            console.log("\uD83D\uDD27 Mock getSupabaseServerClient called");
            console.log("\uD83D\uDD27 URL:", process.env.NEXT_PUBLIC_SUPABASE_URL);
            console.log("\uD83D\uDD27 KEY:", process.env.SUPABASE_SECRET_KEY ? "SET" : "NOT SET");
            // Create a mock Supabase client that returns real data
            const mockSupabaseClient = {
                from: jest.fn(()=>({
                        select: jest.fn(()=>({
                                eq: jest.fn(()=>({
                                        limit: jest.fn().mockResolvedValue({
                                            data: [
                                                {
                                                    id: "poll-1",
                                                    title: "Test Poll 1",
                                                    total_votes: 10,
                                                    options: [
                                                        {
                                                            id: "opt-1",
                                                            text: "Option 1",
                                                            votes: 6
                                                        },
                                                        {
                                                            id: "opt-2",
                                                            text: "Option 2",
                                                            votes: 4
                                                        }
                                                    ],
                                                    status: "active"
                                                }
                                            ],
                                            error: null
                                        })
                                    }))
                            }))
                    }))
            };
            console.log("\uD83D\uDD27 Mock Supabase client created:", !!mockSupabaseClient);
            return Promise.resolve(mockSupabaseClient);
        })
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _server = require("next/server");
const _route = require("../../../../app/api/polls/route");
process.env.NEXT_PUBLIC_SUPABASE_URL = "https://muqwrehywjrbaeerjgfb.supabase.co";
process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = "sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc";
process.env.SUPABASE_SECRET_KEY = "sb_publishable_tJOpGO2IPjujJDQou44P_g_BgbTFBfc";
(0, _globals.describe)("Debug API Route - FIXED", ()=>{
    (0, _globals.it)("should debug the API route step by step", async ()=>{
        console.log("=== DEBUGGING API ROUTE ===");
        try {
            console.log("1. Creating NextRequest...");
            const request = new _server.NextRequest("http://localhost:3000/api/polls");
            console.log("✅ NextRequest created successfully");
            console.log("2. Calling GET function...");
            const response = await (0, _route.GET)(request);
            console.log("✅ GET function completed");
            console.log("3. Getting response status...");
            console.log("Response status:", response.status);
            console.log("4. Getting response data...");
            const responseData = await response.json();
            console.log("Response data:", JSON.stringify(responseData, null, 2));
            console.log("5. Checking response structure...");
            console.log("Has success property:", responseData.hasOwnProperty("success"));
            console.log("Has error property:", responseData.hasOwnProperty("error"));
            // For now, just check that we get some response
            (0, _globals.expect)(response).toBeDefined();
            (0, _globals.expect)(responseData).toBeDefined();
        } catch (error) {
            console.error("❌ Error in API route:", error);
            console.error("Error stack:", error.stack);
            throw error;
        }
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvYXBpL2RlYnVnLWFwaS1yb3V0ZS1maXhlZC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGVidWcgQVBJIFJvdXRlIFRlc3QgLSBGSVhFRCBWRVJTSU9OXG4gKiBcbiAqIFRoaXMgdGVzdCBoZWxwcyBkZWJ1ZyB3aGF0J3MgY2F1c2luZyB0aGUgNTAwIGVycm9yIGluIHRoZSBBUEkgcm91dGVcbiAqL1xuXG4vLyBTZXQgZW52aXJvbm1lbnQgdmFyaWFibGVzIEJFRk9SRSBhbnkgaW1wb3J0c1xucHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMID0gJ2h0dHBzOi8vbXVxd3JlaHl3anJiYWVlcmpnZmIuc3VwYWJhc2UuY28nO1xucHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgPSAnc2JfcHVibGlzaGFibGVfdEpPcEdPMklQanVqSkRRb3U0NFBfZ19CZ2JURkJmYyc7XG5wcm9jZXNzLmVudi5TVVBBQkFTRV9TRUNSRVRfS0VZID0gJ3NiX3B1Ymxpc2hhYmxlX3RKT3BHTzJJUGp1akpEUW91NDRQX2dfQmdiVEZCZmMnO1xuXG4vLyBNb2NrIGdldFN1cGFiYXNlU2VydmVyQ2xpZW50IEJFRk9SRSBpbXBvcnRpbmcgdGhlIEFQSSByb3V0ZVxuamVzdC5tb2NrKCdAL3V0aWxzL3N1cGFiYXNlL3NlcnZlcicsICgpID0+ICh7XG4gIGdldFN1cGFiYXNlU2VydmVyQ2xpZW50OiBqZXN0LmZuKCgpID0+IHtcbiAgICBjb25zb2xlLmxvZygn8J+UpyBNb2NrIGdldFN1cGFiYXNlU2VydmVyQ2xpZW50IGNhbGxlZCcpO1xuICAgIGNvbnNvbGUubG9nKCfwn5SnIFVSTDonLCBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwpO1xuICAgIGNvbnNvbGUubG9nKCfwn5SnIEtFWTonLCBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRUNSRVRfS0VZID8gJ1NFVCcgOiAnTk9UIFNFVCcpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBhIG1vY2sgU3VwYWJhc2UgY2xpZW50IHRoYXQgcmV0dXJucyByZWFsIGRhdGFcbiAgICBjb25zdCBtb2NrU3VwYWJhc2VDbGllbnQgPSB7XG4gICAgICBmcm9tOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgICBsaW1pdDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YTogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGlkOiAncG9sbC0xJyxcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVGVzdCBQb2xsIDEnLFxuICAgICAgICAgICAgICAgICAgdG90YWxfdm90ZXM6IDEwLFxuICAgICAgICAgICAgICAgICAgb3B0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICB7IGlkOiAnb3B0LTEnLCB0ZXh0OiAnT3B0aW9uIDEnLCB2b3RlczogNiB9LFxuICAgICAgICAgICAgICAgICAgICB7IGlkOiAnb3B0LTInLCB0ZXh0OiAnT3B0aW9uIDInLCB2b3RlczogNCB9XG4gICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSksXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKSxcbiAgICB9O1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5SnIE1vY2sgU3VwYWJhc2UgY2xpZW50IGNyZWF0ZWQ6JywgISFtb2NrU3VwYWJhc2VDbGllbnQpO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobW9ja1N1cGFiYXNlQ2xpZW50KTtcbiAgfSlcbn0pKTtcblxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgR0VUIH0gZnJvbSAnQC9hcHAvYXBpL3BvbGxzL3JvdXRlJztcblxuZGVzY3JpYmUoJ0RlYnVnIEFQSSBSb3V0ZSAtIEZJWEVEJywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIGRlYnVnIHRoZSBBUEkgcm91dGUgc3RlcCBieSBzdGVwJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCc9PT0gREVCVUdHSU5HIEFQSSBST1VURSA9PT0nKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJzEuIENyZWF0aW5nIE5leHRSZXF1ZXN0Li4uJyk7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gbmV3IE5leHRSZXF1ZXN0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3BvbGxzJyk7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIE5leHRSZXF1ZXN0IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCcyLiBDYWxsaW5nIEdFVCBmdW5jdGlvbi4uLicpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBHRVQocmVxdWVzdCk7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIEdFVCBmdW5jdGlvbiBjb21wbGV0ZWQnKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJzMuIEdldHRpbmcgcmVzcG9uc2Ugc3RhdHVzLi4uJyk7XG4gICAgICBjb25zb2xlLmxvZygnUmVzcG9uc2Ugc3RhdHVzOicsIHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCc0LiBHZXR0aW5nIHJlc3BvbnNlIGRhdGEuLi4nKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGNvbnNvbGUubG9nKCdSZXNwb25zZSBkYXRhOicsIEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlRGF0YSwgbnVsbCwgMikpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnNS4gQ2hlY2tpbmcgcmVzcG9uc2Ugc3RydWN0dXJlLi4uJyk7XG4gICAgICBjb25zb2xlLmxvZygnSGFzIHN1Y2Nlc3MgcHJvcGVydHk6JywgcmVzcG9uc2VEYXRhLmhhc093blByb3BlcnR5KCdzdWNjZXNzJykpO1xuICAgICAgY29uc29sZS5sb2coJ0hhcyBlcnJvciBwcm9wZXJ0eTonLCByZXNwb25zZURhdGEuaGFzT3duUHJvcGVydHkoJ2Vycm9yJykpO1xuICAgICAgXG4gICAgICAvLyBGb3Igbm93LCBqdXN0IGNoZWNrIHRoYXQgd2UgZ2V0IHNvbWUgcmVzcG9uc2VcbiAgICAgIGV4cGVjdChyZXNwb25zZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGluIEFQSSByb3V0ZTonLCBlcnJvcik7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzdGFjazonLCBlcnJvci5zdGFjayk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJnZXRTdXBhYmFzZVNlcnZlckNsaWVudCIsImZuIiwiY29uc29sZSIsImxvZyIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRUNSRVRfS0VZIiwibW9ja1N1cGFiYXNlQ2xpZW50IiwiZnJvbSIsInNlbGVjdCIsImVxIiwibGltaXQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsImRhdGEiLCJpZCIsInRpdGxlIiwidG90YWxfdm90ZXMiLCJvcHRpb25zIiwidGV4dCIsInZvdGVzIiwic3RhdHVzIiwiZXJyb3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiZGVzY3JpYmUiLCJpdCIsInJlcXVlc3QiLCJOZXh0UmVxdWVzdCIsInJlc3BvbnNlIiwiR0VUIiwicmVzcG9uc2VEYXRhIiwianNvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJoYXNPd25Qcm9wZXJ0eSIsImV4cGVjdCIsInRvQmVEZWZpbmVkIiwic3RhY2siXSwibWFwcGluZ3MiOiJBQUFBOzs7O0NBSUMsR0FFRCwrQ0FBK0M7O0FBSy9DLDhEQUE4RDtBQUM5REEsS0FBS0MsSUFBSSxDQUFDLDJCQUEyQixJQUFPLENBQUE7UUFDMUNDLHlCQUF5QkYsS0FBS0csRUFBRSxDQUFDO1lBQy9CQyxRQUFRQyxHQUFHLENBQUM7WUFDWkQsUUFBUUMsR0FBRyxDQUFDLHFCQUFXQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QjtZQUMzREosUUFBUUMsR0FBRyxDQUFDLHFCQUFXQyxRQUFRQyxHQUFHLENBQUNFLG1CQUFtQixHQUFHLFFBQVE7WUFFakUsdURBQXVEO1lBQ3ZELE1BQU1DLHFCQUFxQjtnQkFDekJDLE1BQU1YLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7d0JBQ25CUyxRQUFRWixLQUFLRyxFQUFFLENBQUMsSUFBTyxDQUFBO2dDQUNyQlUsSUFBSWIsS0FBS0csRUFBRSxDQUFDLElBQU8sQ0FBQTt3Q0FDakJXLE9BQU9kLEtBQUtHLEVBQUUsR0FBR1ksaUJBQWlCLENBQUM7NENBQ2pDQyxNQUFNO2dEQUNKO29EQUNFQyxJQUFJO29EQUNKQyxPQUFPO29EQUNQQyxhQUFhO29EQUNiQyxTQUFTO3dEQUNQOzREQUFFSCxJQUFJOzREQUFTSSxNQUFNOzREQUFZQyxPQUFPO3dEQUFFO3dEQUMxQzs0REFBRUwsSUFBSTs0REFBU0ksTUFBTTs0REFBWUMsT0FBTzt3REFBRTtxREFDM0M7b0RBQ0RDLFFBQVE7Z0RBQ1Y7NkNBQ0Q7NENBQ0RDLE9BQU87d0NBQ1Q7b0NBQ0YsQ0FBQTs0QkFDRixDQUFBO29CQUNGLENBQUE7WUFDRjtZQUVBcEIsUUFBUUMsR0FBRyxDQUFDLDhDQUFvQyxDQUFDLENBQUNLO1lBQ2xELE9BQU9lLFFBQVFDLE9BQU8sQ0FBQ2hCO1FBQ3pCO0lBQ0YsQ0FBQTs7Ozt5QkFFcUM7d0JBQ1Q7dUJBQ1I7QUEzQ3BCSixRQUFRQyxHQUFHLENBQUNDLHdCQUF3QixHQUFHO0FBQ3ZDRixRQUFRQyxHQUFHLENBQUNvQiw2QkFBNkIsR0FBRztBQUM1Q3JCLFFBQVFDLEdBQUcsQ0FBQ0UsbUJBQW1CLEdBQUc7QUEyQ2xDbUIsSUFBQUEsaUJBQVEsRUFBQywyQkFBMkI7SUFDbENDLElBQUFBLFdBQUUsRUFBQywyQ0FBMkM7UUFDNUN6QixRQUFRQyxHQUFHLENBQUM7UUFFWixJQUFJO1lBQ0ZELFFBQVFDLEdBQUcsQ0FBQztZQUNaLE1BQU15QixVQUFVLElBQUlDLG1CQUFXLENBQUM7WUFDaEMzQixRQUFRQyxHQUFHLENBQUM7WUFFWkQsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTTJCLFdBQVcsTUFBTUMsSUFBQUEsVUFBRyxFQUFDSDtZQUMzQjFCLFFBQVFDLEdBQUcsQ0FBQztZQUVaRCxRQUFRQyxHQUFHLENBQUM7WUFDWkQsUUFBUUMsR0FBRyxDQUFDLG9CQUFvQjJCLFNBQVNULE1BQU07WUFFL0NuQixRQUFRQyxHQUFHLENBQUM7WUFDWixNQUFNNkIsZUFBZSxNQUFNRixTQUFTRyxJQUFJO1lBQ3hDL0IsUUFBUUMsR0FBRyxDQUFDLGtCQUFrQitCLEtBQUtDLFNBQVMsQ0FBQ0gsY0FBYyxNQUFNO1lBRWpFOUIsUUFBUUMsR0FBRyxDQUFDO1lBQ1pELFFBQVFDLEdBQUcsQ0FBQyx5QkFBeUI2QixhQUFhSSxjQUFjLENBQUM7WUFDakVsQyxRQUFRQyxHQUFHLENBQUMsdUJBQXVCNkIsYUFBYUksY0FBYyxDQUFDO1lBRS9ELGdEQUFnRDtZQUNoREMsSUFBQUEsZUFBTSxFQUFDUCxVQUFVUSxXQUFXO1lBQzVCRCxJQUFBQSxlQUFNLEVBQUNMLGNBQWNNLFdBQVc7UUFFbEMsRUFBRSxPQUFPaEIsT0FBTztZQUNkcEIsUUFBUW9CLEtBQUssQ0FBQyx5QkFBeUJBO1lBQ3ZDcEIsUUFBUW9CLEtBQUssQ0FBQyxnQkFBZ0JBLE1BQU1pQixLQUFLO1lBQ3pDLE1BQU1qQjtRQUNSO0lBQ0Y7QUFDRiJ9
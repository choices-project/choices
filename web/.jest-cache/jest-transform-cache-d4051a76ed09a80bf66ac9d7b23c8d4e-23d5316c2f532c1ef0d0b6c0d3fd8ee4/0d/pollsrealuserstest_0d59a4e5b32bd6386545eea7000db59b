d3d501a8d75706e80db08a71fbef8d2e
/**
 * Polls API Tests - Real Users
 * 
 * This test uses REAL test users from the database.
 * No mocks, no polyfills, just real authentication and real data.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _supabasejs = require("@supabase/supabase-js");
const _server = require("next/server");
const _route = require("../../../../app/api/polls/route");
// Use real Supabase client with real credentials
const supabase = (0, _supabasejs.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);
(0, _globals.describe)("Polls API - Real Users", ()=>{
    let testUser;
    let testPollId = null;
    (0, _globals.beforeAll)(async ()=>{
        // Login with real test user
        console.log("Logging in with real test user...");
        const { data, error } = await supabase.auth.signInWithPassword({
            email: "test@example.com",
            password: "testpassword"
        });
        if (error) {
            console.error("Failed to login with test user:", error);
            throw new Error(`Failed to login with test user: ${error.message}`);
        }
        testUser = data.user;
        console.log("Successfully logged in with test user:", testUser.email);
    });
    (0, _globals.afterAll)(async ()=>{
        // Clean up test data
        if (testPollId) {
            console.log("Cleaning up test poll:", testPollId);
            await supabase.from("polls").delete().eq("id", testPollId);
        }
        // Sign out
        await supabase.auth.signOut();
    });
    (0, _globals.beforeEach)(()=>{
        // Reset test poll ID
        testPollId = null;
    });
    (0, _globals.afterEach)(async ()=>{
        // Clean up any test data created during the test
        if (testPollId) {
            await supabase.from("polls").delete().eq("id", testPollId);
            testPollId = null;
        }
    });
    (0, _globals.describe)("GET /api/polls - List Polls", ()=>{
        (0, _globals.it)("should return list of polls from real database", async ()=>{
            const request = new _server.NextRequest("http://localhost:3000/api/polls");
            const response = await (0, _route.GET)(request);
            const responseData = await response.json();
            console.log("Real database response status:", response.status);
            console.log("Real database response data:", responseData);
            // Should return 200 status
            (0, _globals.expect)(response.status).toBe(200);
            // Should have the expected structure
            (0, _globals.expect)(responseData).toHaveProperty("success");
            (0, _globals.expect)(responseData).toHaveProperty("polls");
            (0, _globals.expect)(responseData).toHaveProperty("count");
            (0, _globals.expect)(responseData).toHaveProperty("message");
            // Should have correct data types
            (0, _globals.expect)(typeof responseData.success).toBe("boolean");
            (0, _globals.expect)(Array.isArray(responseData.polls)).toBe(true);
            (0, _globals.expect)(typeof responseData.count).toBe("number");
            (0, _globals.expect)(typeof responseData.message).toBe("string");
        });
        (0, _globals.it)("should handle pagination with real database", async ()=>{
            const request = new _server.NextRequest("http://localhost:3000/api/polls?limit=5");
            const response = await (0, _route.GET)(request);
            const responseData = await response.json();
            console.log("Pagination response:", responseData);
            (0, _globals.expect)(response.status).toBe(200);
            (0, _globals.expect)(responseData.success).toBe(true);
            (0, _globals.expect)(Array.isArray(responseData.polls)).toBe(true);
            (0, _globals.expect)(responseData.polls.length).toBeLessThanOrEqual(5);
        });
    });
    (0, _globals.describe)("POST /api/polls - Create Poll", ()=>{
        (0, _globals.it)("should create a new poll with real user authentication", async ()=>{
            // First, we need to mock the authentication middleware
            // Since we can't easily mock the middleware in this test,
            // we'll test the database operation directly
            const pollData = {
                title: "Real Test Poll",
                options: [
                    {
                        text: "Real Option 1"
                    },
                    {
                        text: "Real Option 2"
                    }
                ],
                created_by: testUser.id
            };
            // Test direct database operation
            const { data, error } = await supabase.from("polls").insert(pollData).select().single();
            console.log("Direct database insert result:", {
                data,
                error
            });
            (0, _globals.expect)(error).toBeNull();
            (0, _globals.expect)(data).toBeDefined();
            (0, _globals.expect)(data.title).toBe("Real Test Poll");
            (0, _globals.expect)(data.created_by).toBe(testUser.id);
            // Store for cleanup
            testPollId = data.id;
        });
        (0, _globals.it)("should handle poll creation with real user data", async ()=>{
            const pollData = {
                title: "Another Real Test Poll",
                options: [
                    {
                        text: "Option A"
                    },
                    {
                        text: "Option B"
                    },
                    {
                        text: "Option C"
                    }
                ],
                created_by: testUser.id
            };
            const { data, error } = await supabase.from("polls").insert(pollData).select().single();
            (0, _globals.expect)(error).toBeNull();
            (0, _globals.expect)(data).toBeDefined();
            (0, _globals.expect)(data.title).toBe("Another Real Test Poll");
            (0, _globals.expect)(data.options).toHaveLength(3);
            // Store for cleanup
            testPollId = data.id;
        });
    });
    (0, _globals.describe)("Real Database Integration", ()=>{
        (0, _globals.it)("should connect to real database successfully", async ()=>{
            // Test basic database connection
            const { data, error } = await supabase.from("polls").select("id, title, status").limit(1);
            console.log("Database connection test - Data:", data);
            console.log("Database connection test - Error:", error);
            // Should not have an error
            (0, _globals.expect)(error).toBeNull();
            (0, _globals.expect)(Array.isArray(data)).toBe(true);
        });
        (0, _globals.it)("should handle database errors gracefully", async ()=>{
            // Test error handling with invalid table
            const { data, error } = await supabase.from("nonexistent_table").select("*").limit(1);
            console.log("Error handling test - Data:", data);
            console.log("Error handling test - Error:", error);
            // Should have an error for nonexistent table
            (0, _globals.expect)(error).not.toBeNull();
            (0, _globals.expect)(error.message).toContain('relation "nonexistent_table" does not exist');
        });
    });
    (0, _globals.describe)("Real User Authentication", ()=>{
        (0, _globals.it)("should authenticate real user successfully", async ()=>{
            (0, _globals.expect)(testUser).toBeDefined();
            (0, _globals.expect)(testUser.email).toBe("test@example.com");
            (0, _globals.expect)(testUser.id).toBeDefined();
        });
        (0, _globals.it)("should have access to user profile", async ()=>{
            const { data, error } = await supabase.from("user_profiles").select("*").eq("user_id", testUser.id).single();
            console.log("User profile data:", data);
            console.log("User profile error:", error);
            // Should have user profile or be able to create one
            if (error && error.code === "PGRST116") {
                // No profile exists, which is fine for testing
                (0, _globals.expect)(error.message).toContain("No rows returned");
            } else {
                (0, _globals.expect)(error).toBeNull();
                (0, _globals.expect)(data).toBeDefined();
            }
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvYXBpL3BvbGxzLXJlYWwtdXNlcnMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBvbGxzIEFQSSBUZXN0cyAtIFJlYWwgVXNlcnNcbiAqIFxuICogVGhpcyB0ZXN0IHVzZXMgUkVBTCB0ZXN0IHVzZXJzIGZyb20gdGhlIGRhdGFiYXNlLlxuICogTm8gbW9ja3MsIG5vIHBvbHlmaWxscywganVzdCByZWFsIGF1dGhlbnRpY2F0aW9uIGFuZCByZWFsIGRhdGEuXG4gKi9cblxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUFsbCwgYWZ0ZXJBbGwsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgR0VULCBQT1NUIH0gZnJvbSAnQC9hcHAvYXBpL3BvbGxzL3JvdXRlJztcblxuLy8gVXNlIHJlYWwgU3VwYWJhc2UgY2xpZW50IHdpdGggcmVhbCBjcmVkZW50aWFsc1xuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuKTtcblxuZGVzY3JpYmUoJ1BvbGxzIEFQSSAtIFJlYWwgVXNlcnMnLCAoKSA9PiB7XG4gIGxldCB0ZXN0VXNlcjogYW55O1xuICBsZXQgdGVzdFBvbGxJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBMb2dpbiB3aXRoIHJlYWwgdGVzdCB1c2VyXG4gICAgY29uc29sZS5sb2coJ0xvZ2dpbmcgaW4gd2l0aCByZWFsIHRlc3QgdXNlci4uLicpO1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcbiAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ3Rlc3RwYXNzd29yZCdcbiAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvZ2luIHdpdGggdGVzdCB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvZ2luIHdpdGggdGVzdCB1c2VyOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuXG4gICAgdGVzdFVzZXIgPSBkYXRhLnVzZXI7XG4gICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBsb2dnZWQgaW4gd2l0aCB0ZXN0IHVzZXI6JywgdGVzdFVzZXIuZW1haWwpO1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkYXRhXG4gICAgaWYgKHRlc3RQb2xsSWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdDbGVhbmluZyB1cCB0ZXN0IHBvbGw6JywgdGVzdFBvbGxJZCk7XG4gICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdwb2xscycpLmRlbGV0ZSgpLmVxKCdpZCcsIHRlc3RQb2xsSWQpO1xuICAgIH1cblxuICAgIC8vIFNpZ24gb3V0XG4gICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIFJlc2V0IHRlc3QgcG9sbCBJRFxuICAgIHRlc3RQb2xsSWQgPSBudWxsO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIENsZWFuIHVwIGFueSB0ZXN0IGRhdGEgY3JlYXRlZCBkdXJpbmcgdGhlIHRlc3RcbiAgICBpZiAodGVzdFBvbGxJZCkge1xuICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgncG9sbHMnKS5kZWxldGUoKS5lcSgnaWQnLCB0ZXN0UG9sbElkKTtcbiAgICAgIHRlc3RQb2xsSWQgPSBudWxsO1xuICAgIH1cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvYXBpL3BvbGxzIC0gTGlzdCBQb2xscycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBsaXN0IG9mIHBvbGxzIGZyb20gcmVhbCBkYXRhYmFzZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgTmV4dFJlcXVlc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvcG9sbHMnKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBHRVQocmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdSZWFsIGRhdGFiYXNlIHJlc3BvbnNlIHN0YXR1czonLCByZXNwb25zZS5zdGF0dXMpO1xuICAgICAgY29uc29sZS5sb2coJ1JlYWwgZGF0YWJhc2UgcmVzcG9uc2UgZGF0YTonLCByZXNwb25zZURhdGEpO1xuXG4gICAgICAvLyBTaG91bGQgcmV0dXJuIDIwMCBzdGF0dXNcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIGhhdmUgdGhlIGV4cGVjdGVkIHN0cnVjdHVyZVxuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YSkudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3MnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEpLnRvSGF2ZVByb3BlcnR5KCdwb2xscycpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YSkudG9IYXZlUHJvcGVydHkoJ2NvdW50Jyk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhKS50b0hhdmVQcm9wZXJ0eSgnbWVzc2FnZScpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgaGF2ZSBjb3JyZWN0IGRhdGEgdHlwZXNcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzcG9uc2VEYXRhLnN1Y2Nlc3MpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3BvbnNlRGF0YS5wb2xscykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3BvbnNlRGF0YS5jb3VudCkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3BvbnNlRGF0YS5tZXNzYWdlKS50b0JlKCdzdHJpbmcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhZ2luYXRpb24gd2l0aCByZWFsIGRhdGFiYXNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IG5ldyBOZXh0UmVxdWVzdCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9wb2xscz9saW1pdD01Jyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgR0VUKHJlcXVlc3QpO1xuICAgICAgY29uc3QgcmVzcG9uc2VEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBjb25zb2xlLmxvZygnUGFnaW5hdGlvbiByZXNwb25zZTonLCByZXNwb25zZURhdGEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXNwb25zZURhdGEucG9sbHMpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS5wb2xscy5sZW5ndGgpLnRvQmVMZXNzVGhhbk9yRXF1YWwoNSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQT1NUIC9hcGkvcG9sbHMgLSBDcmVhdGUgUG9sbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG5ldyBwb2xsIHdpdGggcmVhbCB1c2VyIGF1dGhlbnRpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QsIHdlIG5lZWQgdG8gbW9jayB0aGUgYXV0aGVudGljYXRpb24gbWlkZGxld2FyZVxuICAgICAgLy8gU2luY2Ugd2UgY2FuJ3QgZWFzaWx5IG1vY2sgdGhlIG1pZGRsZXdhcmUgaW4gdGhpcyB0ZXN0LFxuICAgICAgLy8gd2UnbGwgdGVzdCB0aGUgZGF0YWJhc2Ugb3BlcmF0aW9uIGRpcmVjdGx5XG4gICAgICBcbiAgICAgIGNvbnN0IHBvbGxEYXRhID0ge1xuICAgICAgICB0aXRsZTogJ1JlYWwgVGVzdCBQb2xsJyxcbiAgICAgICAgb3B0aW9uczogW1xuICAgICAgICAgIHsgdGV4dDogJ1JlYWwgT3B0aW9uIDEnIH0sXG4gICAgICAgICAgeyB0ZXh0OiAnUmVhbCBPcHRpb24gMicgfVxuICAgICAgICBdLFxuICAgICAgICBjcmVhdGVkX2J5OiB0ZXN0VXNlci5pZFxuICAgICAgfTtcblxuICAgICAgLy8gVGVzdCBkaXJlY3QgZGF0YWJhc2Ugb3BlcmF0aW9uXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgICAuaW5zZXJ0KHBvbGxEYXRhKVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBjb25zb2xlLmxvZygnRGlyZWN0IGRhdGFiYXNlIGluc2VydCByZXN1bHQ6JywgeyBkYXRhLCBlcnJvciB9KTtcblxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGF0YS50aXRsZSkudG9CZSgnUmVhbCBUZXN0IFBvbGwnKTtcbiAgICAgIGV4cGVjdChkYXRhLmNyZWF0ZWRfYnkpLnRvQmUodGVzdFVzZXIuaWQpO1xuXG4gICAgICAvLyBTdG9yZSBmb3IgY2xlYW51cFxuICAgICAgdGVzdFBvbGxJZCA9IGRhdGEuaWQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwb2xsIGNyZWF0aW9uIHdpdGggcmVhbCB1c2VyIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwb2xsRGF0YSA9IHtcbiAgICAgICAgdGl0bGU6ICdBbm90aGVyIFJlYWwgVGVzdCBQb2xsJyxcbiAgICAgICAgb3B0aW9uczogW1xuICAgICAgICAgIHsgdGV4dDogJ09wdGlvbiBBJyB9LFxuICAgICAgICAgIHsgdGV4dDogJ09wdGlvbiBCJyB9LFxuICAgICAgICAgIHsgdGV4dDogJ09wdGlvbiBDJyB9XG4gICAgICAgIF0sXG4gICAgICAgIGNyZWF0ZWRfYnk6IHRlc3RVc2VyLmlkXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgICAuaW5zZXJ0KHBvbGxEYXRhKVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QoZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChkYXRhLnRpdGxlKS50b0JlKCdBbm90aGVyIFJlYWwgVGVzdCBQb2xsJyk7XG4gICAgICBleHBlY3QoZGF0YS5vcHRpb25zKS50b0hhdmVMZW5ndGgoMyk7XG5cbiAgICAgIC8vIFN0b3JlIGZvciBjbGVhbnVwXG4gICAgICB0ZXN0UG9sbElkID0gZGF0YS5pZDtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JlYWwgRGF0YWJhc2UgSW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb25uZWN0IHRvIHJlYWwgZGF0YWJhc2Ugc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCBiYXNpYyBkYXRhYmFzZSBjb25uZWN0aW9uXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgICAuc2VsZWN0KCdpZCwgdGl0bGUsIHN0YXR1cycpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIGNvbm5lY3Rpb24gdGVzdCAtIERhdGE6JywgZGF0YSk7XG4gICAgICBjb25zb2xlLmxvZygnRGF0YWJhc2UgY29ubmVjdGlvbiB0ZXN0IC0gRXJyb3I6JywgZXJyb3IpO1xuXG4gICAgICAvLyBTaG91bGQgbm90IGhhdmUgYW4gZXJyb3JcbiAgICAgIGV4cGVjdChlcnJvcikudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGRhdGEpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IGVycm9yIGhhbmRsaW5nIHdpdGggaW52YWxpZCB0YWJsZVxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ25vbmV4aXN0ZW50X3RhYmxlJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGhhbmRsaW5nIHRlc3QgLSBEYXRhOicsIGRhdGEpO1xuICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGhhbmRsaW5nIHRlc3QgLSBFcnJvcjonLCBlcnJvcik7XG5cbiAgICAgIC8vIFNob3VsZCBoYXZlIGFuIGVycm9yIGZvciBub25leGlzdGVudCB0YWJsZVxuICAgICAgZXhwZWN0KGVycm9yKS5ub3QudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ3JlbGF0aW9uIFwibm9uZXhpc3RlbnRfdGFibGVcIiBkb2VzIG5vdCBleGlzdCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVhbCBVc2VyIEF1dGhlbnRpY2F0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYXV0aGVudGljYXRlIHJlYWwgdXNlciBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBleHBlY3QodGVzdFVzZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodGVzdFVzZXIuZW1haWwpLnRvQmUoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcbiAgICAgIGV4cGVjdCh0ZXN0VXNlci5pZCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSBhY2Nlc3MgdG8gdXNlciBwcm9maWxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxuICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdGVzdFVzZXIuaWQpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgY29uc29sZS5sb2coJ1VzZXIgcHJvZmlsZSBkYXRhOicsIGRhdGEpO1xuICAgICAgY29uc29sZS5sb2coJ1VzZXIgcHJvZmlsZSBlcnJvcjonLCBlcnJvcik7XG5cbiAgICAgIC8vIFNob3VsZCBoYXZlIHVzZXIgcHJvZmlsZSBvciBiZSBhYmxlIHRvIGNyZWF0ZSBvbmVcbiAgICAgIGlmIChlcnJvciAmJiBlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIC8vIE5vIHByb2ZpbGUgZXhpc3RzLCB3aGljaCBpcyBmaW5lIGZvciB0ZXN0aW5nXG4gICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ05vIHJvd3MgcmV0dXJuZWQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZU51bGwoKTtcbiAgICAgICAgZXhwZWN0KGRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsic3VwYWJhc2UiLCJjcmVhdGVDbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJkZXNjcmliZSIsInRlc3RVc2VyIiwidGVzdFBvbGxJZCIsImJlZm9yZUFsbCIsImNvbnNvbGUiLCJsb2ciLCJkYXRhIiwiZXJyb3IiLCJhdXRoIiwic2lnbkluV2l0aFBhc3N3b3JkIiwiZW1haWwiLCJwYXNzd29yZCIsIkVycm9yIiwibWVzc2FnZSIsInVzZXIiLCJhZnRlckFsbCIsImZyb20iLCJkZWxldGUiLCJlcSIsInNpZ25PdXQiLCJiZWZvcmVFYWNoIiwiYWZ0ZXJFYWNoIiwiaXQiLCJyZXF1ZXN0IiwiTmV4dFJlcXVlc3QiLCJyZXNwb25zZSIsIkdFVCIsInJlc3BvbnNlRGF0YSIsImpzb24iLCJzdGF0dXMiLCJleHBlY3QiLCJ0b0JlIiwidG9IYXZlUHJvcGVydHkiLCJzdWNjZXNzIiwiQXJyYXkiLCJpc0FycmF5IiwicG9sbHMiLCJjb3VudCIsImxlbmd0aCIsInRvQmVMZXNzVGhhbk9yRXF1YWwiLCJwb2xsRGF0YSIsInRpdGxlIiwib3B0aW9ucyIsInRleHQiLCJjcmVhdGVkX2J5IiwiaWQiLCJpbnNlcnQiLCJzZWxlY3QiLCJzaW5nbGUiLCJ0b0JlTnVsbCIsInRvQmVEZWZpbmVkIiwidG9IYXZlTGVuZ3RoIiwibGltaXQiLCJub3QiLCJ0b0NvbnRhaW4iLCJjb2RlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Q0FLQzs7Ozt5QkFFZ0Y7NEJBQ3BEO3dCQUNEO3VCQUNGO0FBRTFCLGlEQUFpRDtBQUNqRCxNQUFNQSxXQUFXQyxJ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
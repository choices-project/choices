5210239509c4ecdeaaf19ea350ac9bd6
// Mock auth utilities for testing
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    checkPermissions: function() {
        return checkPermissions;
    },
    createAuthMockContext: function() {
        return createAuthMockContext;
    },
    createSecureServerAction: function() {
        return createSecureServerAction;
    },
    getUser: function() {
        return getUser;
    },
    mockCSRFProtection: function() {
        return mockCSRFProtection;
    },
    mockRateLimiting: function() {
        return mockRateLimiting;
    },
    requireAuth: function() {
        return requireAuth;
    },
    validateSession: function() {
        return validateSession;
    }
});
const _globals = require("@jest/globals");
const getUser = _globals.jest.fn().mockResolvedValue({
    user: {
        id: "test-user-id",
        email: "test@example.com",
        name: "Test User"
    },
    error: null
});
const requireAuth = _globals.jest.fn().mockImplementation((handler)=>{
    return async (req, res)=>{
        const user = await getUser();
        if (!user.user) {
            return res.status(401).json({
                error: "Unauthorized"
            });
        }
        return handler(req, res);
    };
});
const checkPermissions = _globals.jest.fn().mockResolvedValue(true);
const validateSession = _globals.jest.fn().mockResolvedValue({
    valid: true,
    user: {
        id: "test-user-id",
        email: "test@example.com"
    }
});
const createAuthMockContext = _globals.jest.fn().mockReturnValue({
    user: {
        id: "test-user-id",
        email: "test@example.com",
        name: "Test User"
    },
    session: {
        id: "test-session-id",
        userId: "test-user-id",
        expiresAt: new Date(Date.now() + 86400000)
    },
    ip: "192.168.1.1",
    userAgent: "Mozilla/5.0 (Test Browser)",
    headers: {
        "x-forwarded-for": "192.168.1.1",
        "user-agent": "Mozilla/5.0 (Test Browser)"
    }
});
const mockRateLimiting = _globals.jest.fn().mockResolvedValue({
    allowed: true,
    remaining: 10,
    resetTime: Date.now() + 60000
});
const mockCSRFProtection = _globals.jest.fn().mockResolvedValue({
    valid: true,
    token: "test-csrf-token"
});
const createSecureServerAction = _globals.jest.fn().mockImplementation((handler, options)=>{
    return async (data, context)=>{
        // Mock authentication check
        if (options?.requireAuth && !context.user) {
            throw new Error("Authentication required");
        }
        // Mock rate limiting check
        if (options?.rateLimit) {
            const rateLimitResult = await mockRateLimiting();
            if (!rateLimitResult.allowed) {
                throw new Error("Rate limit exceeded");
            }
        }
        // Mock CSRF protection check
        if (options?.csrfProtection) {
            const csrfResult = await mockCSRFProtection();
            if (!csrfResult.valid) {
                throw new Error("CSRF token invalid");
            }
        }
        return await handler(data, context);
    };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L2hlbHBlcnMvYXV0aC10ZXN0LXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIE1vY2sgYXV0aCB1dGlsaXRpZXMgZm9yIHRlc3RpbmdcbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuZXhwb3J0IGNvbnN0IGdldFVzZXIgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICB1c2VyOiB7XG4gICAgaWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgbmFtZTogJ1Rlc3QgVXNlcicsXG4gIH0sXG4gIGVycm9yOiBudWxsLFxufSlcblxuZXhwb3J0IGNvbnN0IHJlcXVpcmVBdXRoID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGFuZGxlcikgPT4ge1xuICByZXR1cm4gYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRVc2VyKClcbiAgICBpZiAoIXVzZXIudXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pXG4gICAgfVxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKVxuICB9XG59KVxuXG5leHBvcnQgY29uc3QgY2hlY2tQZXJtaXNzaW9ucyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKVxuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVTZXNzaW9uID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgdmFsaWQ6IHRydWUsXG4gIHVzZXI6IHtcbiAgICBpZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgfSxcbn0pXG5cbi8vIE1vY2sgY29udGV4dCBjcmVhdG9yXG5leHBvcnQgY29uc3QgY3JlYXRlQXV0aE1vY2tDb250ZXh0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gIHVzZXI6IHtcbiAgICBpZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICBuYW1lOiAnVGVzdCBVc2VyJyxcbiAgfSxcbiAgc2Vzc2lvbjoge1xuICAgIGlkOiAndGVzdC1zZXNzaW9uLWlkJyxcbiAgICB1c2VySWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDg2NDAwMDAwKSwgLy8gMjQgaG91cnMgZnJvbSBub3dcbiAgfSxcbiAgaXA6ICcxOTIuMTY4LjEuMScsXG4gIHVzZXJBZ2VudDogJ01vemlsbGEvNS4wIChUZXN0IEJyb3dzZXIpJyxcbiAgaGVhZGVyczoge1xuICAgICd4LWZvcndhcmRlZC1mb3InOiAnMTkyLjE2OC4xLjEnLFxuICAgICd1c2VyLWFnZW50JzogJ01vemlsbGEvNS4wIChUZXN0IEJyb3dzZXIpJyxcbiAgfSxcbn0pXG5cbi8vIE1vY2sgcmF0ZSBsaW1pdGluZ1xuZXhwb3J0IGNvbnN0IG1vY2tSYXRlTGltaXRpbmcgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICBhbGxvd2VkOiB0cnVlLFxuICByZW1haW5pbmc6IDEwLFxuICByZXNldFRpbWU6IERhdGUubm93KCkgKyA2MDAwMCxcbn0pXG5cbi8vIE1vY2sgQ1NSRiBwcm90ZWN0aW9uXG5leHBvcnQgY29uc3QgbW9ja0NTUkZQcm90ZWN0aW9uID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgdmFsaWQ6IHRydWUsXG4gIHRva2VuOiAndGVzdC1jc3JmLXRva2VuJyxcbn0pXG5cbi8vIE1vY2sgc2VjdXJlIHNlcnZlciBhY3Rpb24gY3JlYXRvclxuZXhwb3J0IGNvbnN0IGNyZWF0ZVNlY3VyZVNlcnZlckFjdGlvbiA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGhhbmRsZXIsIG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIGFzeW5jIChkYXRhOiBhbnksIGNvbnRleHQ6IGFueSkgPT4ge1xuICAgIC8vIE1vY2sgYXV0aGVudGljYXRpb24gY2hlY2tcbiAgICBpZiAob3B0aW9ucz8ucmVxdWlyZUF1dGggJiYgIWNvbnRleHQudXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcpXG4gICAgfVxuICAgIFxuICAgIC8vIE1vY2sgcmF0ZSBsaW1pdGluZyBjaGVja1xuICAgIGlmIChvcHRpb25zPy5yYXRlTGltaXQpIHtcbiAgICAgIGNvbnN0IHJhdGVMaW1pdFJlc3VsdCA9IGF3YWl0IG1vY2tSYXRlTGltaXRpbmcoKVxuICAgICAgaWYgKCFyYXRlTGltaXRSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JhdGUgbGltaXQgZXhjZWVkZWQnKVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBNb2NrIENTUkYgcHJvdGVjdGlvbiBjaGVja1xuICAgIGlmIChvcHRpb25zPy5jc3JmUHJvdGVjdGlvbikge1xuICAgICAgY29uc3QgY3NyZlJlc3VsdCA9IGF3YWl0IG1vY2tDU1JGUHJvdGVjdGlvbigpXG4gICAgICBpZiAoIWNzcmZSZXN1bHQudmFsaWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDU1JGIHRva2VuIGludmFsaWQnKVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYXdhaXQgaGFuZGxlcihkYXRhLCBjb250ZXh0KVxuICB9XG59KSJdLCJuYW1lcyI6WyJjaGVja1Blcm1pc3Npb25zIiwiY3JlYXRlQXV0aE1vY2tDb250ZXh0IiwiY3JlYXRlU2VjdXJlU2VydmVyQWN0aW9uIiwiZ2V0VXNlciIsIm1vY2tDU1JGUHJvdGVjdGlvbiIsIm1vY2tSYXRlTGltaXRpbmciLCJyZXF1aXJlQXV0aCIsInZhbGlkYXRlU2Vzc2lvbiIsImplc3QiLCJmbiIsIm1vY2tSZXNvbHZlZFZhbHVlIiwidXNlciIsImlkIiwiZW1haWwiLCJuYW1lIiwiZXJyb3IiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJoYW5kbGVyIiwicmVxIiwicmVzIiwic3RhdHVzIiwianNvbiIsInZhbGlkIiwibW9ja1JldHVyblZhbHVlIiwic2Vzc2lvbiIsInVzZXJJZCIsImV4cGlyZXNBdCIsIkRhdGUiLCJub3ciLCJpcCIsInVzZXJBZ2VudCIsImhlYWRlcnMiLCJhbGxvd2VkIiwicmVtYWluaW5nIiwicmVzZXRUaW1lIiwidG9rZW4iLCJvcHRpb25zIiwiZGF0YSIsImNvbnRleHQiLCJFcnJvciIsInJhdGVMaW1pdCIsInJhdGVMaW1pdFJlc3VsdCIsImNzcmZQcm90ZWN0aW9uIiwiY3NyZlJlc3VsdCJdLCJtYXBwaW5ncyI6IkFBQUEsa0NBQWtDOzs7Ozs7Ozs7Ozs7SUFzQnJCQSxnQkFBZ0I7ZUFBaEJBOztJQVdBQyxxQkFBcUI7ZUFBckJBOztJQWlDQUMsd0JBQXdCO2VBQXhCQTs7SUEvREFDLE9BQU87ZUFBUEE7O0lBeURBQyxrQkFBa0I7ZUFBbEJBOztJQVBBQyxnQkFBZ0I7ZUFBaEJBOztJQXpDQUMsV0FBVztlQUFYQTs7SUFZQUMsZUFBZTtlQUFmQTs7O3lCQXZCUTtBQUVkLE1BQU1KLFVBQVVLLGFBQUksQ0FBQ0MsRUFBRSxHQUFHQyxpQkFBaUIsQ0FBQztJQUNqREMsTUFBTTtRQUNKQyxJQUFJO1FBQ0pDLE9BQU87UUFDUEMsTUFBTTtJQUNSO0lBQ0FDLE9BQU87QUFDVDtBQUVPLE1BQU1ULGNBQWNFLGFBQUksQ0FBQ0MsRUFBRSxHQUFHTyxrQkFBa0IsQ0FBQyxDQUFDQztJQUN2RCxPQUFPLE9BQU9DLEtBQVVDO1FBQ3RCLE1BQU1SLE9BQU8sTUFBTVI7UUFDbkIsSUFBSSxDQUFDUSxLQUFLQSxJQUFJLEVBQUU7WUFDZCxPQUFPUSxJQUFJQyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFTixPQUFPO1lBQWU7UUFDdEQ7UUFDQSxPQUFPRSxRQUFRQyxLQUFLQztJQUN0QjtBQUNGO0FBRU8sTUFBTW5CLG1CQUFtQlEsYUFBSSxDQUFDQyxFQUFFLEdBQUdDLGlCQUFpQixDQUFDO0FBRXJELE1BQU1ILGtCQUFrQkMsYUFBSSxDQUFDQyxFQUFFLEdBQUdDLGlCQUFpQixDQUFDO0lBQ3pEWSxPQUFPO0lBQ1BYLE1BQU07UUFDSkMsSUFBSTtRQUNKQyxPQUFPO0lBQ1Q7QUFDRjtBQUdPLE1BQU1aLHdCQUF3Qk8sYUFBSSxDQUFDQyxFQUFFLEdBQUdjLGVBQWUsQ0FBQztJQUM3RFosTUFBTTtRQUNKQyxJQUFJO1FBQ0pDLE9BQU87UUFDUEMsTUFBTTtJQUNSO0lBQ0FVLFNBQVM7UUFDUFosSUFBSTtRQUNKYSxRQUFRO1FBQ1JDLFdBQVcsSUFBSUMsS0FBS0EsS0FBS0MsR0FBRyxLQUFLO0lBQ25DO0lBQ0FDLElBQUk7SUFDSkMsV0FBVztJQUNYQyxTQUFTO1FBQ1AsbUJBQW1CO1FBQ25CLGNBQWM7SUFDaEI7QUFDRjtBQUdPLE1BQU0xQixtQkFBbUJHLGFBQUksQ0FBQ0MsRUFBRSxHQUFHQyxpQkFBaUIsQ0FBQztJQUMxRHNCLFNBQVM7SUFDVEMsV0FBVztJQUNYQyxXQUFXUCxLQUFLQyxHQUFHLEtBQUs7QUFDMUI7QUFHTyxNQUFNeEIscUJBQXFCSSxhQUFJLENBQUNDLEVBQUUsR0FBR0MsaUJBQWlCLENBQUM7SUFDNURZLE9BQU87SUFDUGEsT0FBTztBQUNUO0FBR08sTUFBTWpDLDJCQUEyQk0sYUFBSSxDQUFDQyxFQUFFLEdBQUdPLGtCQUFrQixDQUFDLENBQUNDLFNBQVNtQjtJQUM3RSxPQUFPLE9BQU9DLE1BQVdDO1FBQ3ZCLDRCQUE0QjtRQUM1QixJQUFJRixTQUFTOUIsZUFBZSxDQUFDZ0MsUUFBUTNCLElBQUksRUFBRTtZQUN6QyxNQUFNLElBQUk0QixNQUFNO1FBQ2xCO1FBRUEsMkJBQTJCO1FBQzNCLElBQUlILFNBQVNJLFdBQVc7WUFDdEIsTUFBTUMsa0JBQWtCLE1BQU1wQztZQUM5QixJQUFJLENBQUNvQyxnQkFBZ0JULE9BQU8sRUFBRTtnQkFDNUIsTUFBTSxJQUFJTyxNQUFNO1lBQ2xCO1FBQ0Y7UUFFQSw2QkFBNkI7UUFDN0IsSUFBSUgsU0FBU00sZ0JBQWdCO1lBQzNCLE1BQU1DLGFBQWEsTUFBTXZDO1lBQ3pCLElBQUksQ0FBQ3VDLFdBQVdyQixLQUFLLEVBQUU7Z0JBQ3JCLE1BQU0sSUFBSWlCLE1BQU07WUFDbEI7UUFDRjtRQUVBLE9BQU8sTUFBTXRCLFFBQVFvQixNQUFNQztJQUM3QjtBQUNGIn0=
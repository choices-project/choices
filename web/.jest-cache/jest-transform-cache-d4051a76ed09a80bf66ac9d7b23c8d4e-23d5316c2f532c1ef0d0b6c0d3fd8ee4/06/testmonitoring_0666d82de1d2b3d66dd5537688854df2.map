{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/performance/test-monitoring.ts"],"sourcesContent":["/**\n * Test Monitoring & Reporting System\n * \n * Provides comprehensive test monitoring, metrics collection, and reporting\n * for the Choices platform testing infrastructure.\n */\n\nexport interface TestMetrics {\n  testName: string;\n  testSuite: string;\n  duration: number;\n  memoryUsage: number;\n  renderTime: number;\n  networkTime: number;\n  apiTime: number;\n  accessibilityTime: number;\n  performanceGrade: 'A+' | 'A' | 'B' | 'C' | 'D' | 'F';\n  timestamp: Date;\n  status: 'PASS' | 'FAIL' | 'SKIP';\n  errorMessage?: string;\n}\n\nexport interface PerformanceReport {\n  totalTests: number;\n  passedTests: number;\n  failedTests: number;\n  skippedTests: number;\n  averageRenderTime: number;\n  averageMemoryUsage: number;\n  performanceGrade: string;\n  recommendations: string[];\n  timestamp: Date;\n}\n\nexport class TestMonitor {\n  private metrics: TestMetrics[] = [];\n  private alerts: string[] = [];\n\n  /**\n   * Record test metrics\n   */\n  recordMetrics(metrics: Omit<TestMetrics, 'timestamp'>): void {\n    const fullMetrics: TestMetrics = {\n      ...metrics,\n      timestamp: new Date(),\n    };\n    \n    this.metrics.push(fullMetrics);\n    \n    // Check for performance alerts\n    this.checkPerformanceAlerts(fullMetrics);\n  }\n\n  /**\n   * Check for performance alerts\n   */\n  private checkPerformanceAlerts(metrics: TestMetrics): void {\n    const alerts: string[] = [];\n\n    // Render time alerts\n    if (metrics.renderTime > 200) {\n      alerts.push(`âš ï¸ SLOW RENDER: ${metrics.testName} took ${metrics.renderTime.toFixed(2)}ms (budget: 200ms)`);\n    }\n\n    // Memory usage alerts\n    if (metrics.memoryUsage > 10) {\n      alerts.push(`âš ï¸ HIGH MEMORY: ${metrics.testName} used ${metrics.memoryUsage.toFixed(2)}MB (budget: 10MB)`);\n    }\n\n    // Performance grade alerts\n    if (metrics.performanceGrade === 'D' || metrics.performanceGrade === 'F') {\n      alerts.push(`ðŸš¨ POOR PERFORMANCE: ${metrics.testName} received grade ${metrics.performanceGrade}`);\n    }\n\n    // Network time alerts\n    if (metrics.networkTime > 500) {\n      alerts.push(`âš ï¸ SLOW NETWORK: ${metrics.testName} network took ${metrics.networkTime.toFixed(2)}ms (budget: 500ms)`);\n    }\n\n    this.alerts.push(...alerts);\n  }\n\n  /**\n   * Generate performance report\n   */\n  generateReport(): PerformanceReport {\n    const totalTests = this.metrics.length;\n    const passedTests = this.metrics.filter(m => m.status === 'PASS').length;\n    const failedTests = this.metrics.filter(m => m.status === 'FAIL').length;\n    const skippedTests = this.metrics.filter(m => m.status === 'SKIP').length;\n\n    const averageRenderTime = this.metrics.reduce((sum, m) => sum + m.renderTime, 0) / totalTests;\n    const averageMemoryUsage = this.metrics.reduce((sum, m) => sum + m.memoryUsage, 0) / totalTests;\n\n    // Calculate overall performance grade\n    const performanceGrade = this.calculateOverallGrade(averageRenderTime, averageMemoryUsage);\n\n    // Generate recommendations\n    const recommendations = this.generateRecommendations(averageRenderTime, averageMemoryUsage);\n\n    return {\n      totalTests,\n      passedTests,\n      failedTests,\n      skippedTests,\n      averageRenderTime,\n      averageMemoryUsage,\n      performanceGrade,\n      recommendations,\n      timestamp: new Date(),\n    };\n  }\n\n  /**\n   * Calculate overall performance grade\n   */\n  private calculateOverallGrade(avgRenderTime: number, avgMemoryUsage: number): string {\n    let score = 100;\n\n    // Deduct points for slow render times\n    if (avgRenderTime > 200) score -= 30;\n    else if (avgRenderTime > 150) score -= 20;\n    else if (avgRenderTime > 100) score -= 10;\n\n    // Deduct points for high memory usage\n    if (avgMemoryUsage > 10) score -= 30;\n    else if (avgMemoryUsage > 5) score -= 20;\n    else if (avgMemoryUsage > 2) score -= 10;\n\n    // Deduct points for test failures\n    const failureRate = this.metrics.filter(m => m.status === 'FAIL').length / this.metrics.length;\n    score -= failureRate * 50;\n\n    if (score >= 95) return 'A+';\n    if (score >= 90) return 'A';\n    if (score >= 80) return 'B';\n    if (score >= 70) return 'C';\n    if (score >= 60) return 'D';\n    return 'F';\n  }\n\n  /**\n   * Generate performance recommendations\n   */\n  private generateRecommendations(avgRenderTime: number, avgMemoryUsage: number): string[] {\n    const recommendations: string[] = [];\n\n    if (avgRenderTime > 150) {\n      recommendations.push('ðŸ”§ Consider implementing React.memo for expensive components');\n      recommendations.push('ðŸ”§ Use useMemo/useCallback for expensive calculations');\n      recommendations.push('ðŸ”§ Consider lazy loading for heavy components');\n    }\n\n    if (avgMemoryUsage > 5) {\n      recommendations.push('ðŸ”§ Implement proper cleanup in useEffect hooks');\n      recommendations.push('ðŸ”§ Consider component unmounting strategies');\n      recommendations.push('ðŸ”§ Review memory leaks in event listeners');\n    }\n\n    if (this.metrics.some(m => m.networkTime > 500)) {\n      recommendations.push('ðŸ”§ Optimize API response times');\n      recommendations.push('ðŸ”§ Implement request caching strategies');\n      recommendations.push('ðŸ”§ Consider request deduplication');\n    }\n\n    if (recommendations.length === 0) {\n      recommendations.push('ðŸš€ Excellent performance! No optimizations needed.');\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Get all alerts\n   */\n  getAlerts(): string[] {\n    return this.alerts;\n  }\n\n  /**\n   * Get metrics for a specific test suite\n   */\n  getMetricsForSuite(suiteName: string): TestMetrics[] {\n    return this.metrics.filter(m => m.testSuite === suiteName);\n  }\n\n  /**\n   * Clear all metrics and alerts\n   */\n  clear(): void {\n    this.metrics = [];\n    this.alerts = [];\n  }\n\n  /**\n   * Export metrics to JSON\n   */\n  exportMetrics(): string {\n    return JSON.stringify({\n      metrics: this.metrics,\n      alerts: this.alerts,\n      report: this.generateReport(),\n    }, null, 2);\n  }\n}\n\n// Global test monitor instance\nexport const testMonitor = new TestMonitor();\n\n/**\n * Performance grade calculation utility\n */\nexport function calculatePerformanceGrade(renderTime: number, memoryUsage: number): 'A+' | 'A' | 'B' | 'C' | 'D' | 'F' {\n  let score = 100;\n\n  // Render time scoring\n  if (renderTime < 50) score += 10;\n  else if (renderTime < 100) score += 5;\n  else if (renderTime > 200) score -= 30;\n  else if (renderTime > 150) score -= 20;\n  else if (renderTime > 100) score -= 10;\n\n  // Memory usage scoring\n  if (memoryUsage < 1) score += 10;\n  else if (memoryUsage < 2) score += 5;\n  else if (memoryUsage > 10) score -= 30;\n  else if (memoryUsage > 5) score -= 20;\n  else if (memoryUsage > 2) score -= 10;\n\n  if (score >= 95) return 'A+';\n  if (score >= 90) return 'A';\n  if (score >= 80) return 'B';\n  if (score >= 70) return 'C';\n  if (score >= 60) return 'D';\n  return 'F';\n}\n\n/**\n * Performance budget constants\n */\nexport const PERFORMANCE_BUDGETS = {\n  RENDER_TIME: 250, // ms - Adjusted for realistic component rendering\n  MEMORY_USAGE: 10, // MB\n  NETWORK_TIME: 500, // ms\n  API_TIME: 300, // ms\n  ACCESSIBILITY_TIME: 100, // ms\n} as const;\n\n\n\n\n\n\n\n\n\n\n"],"names":["PERFORMANCE_BUDGETS","TestMonitor","calculatePerformanceGrade","testMonitor","recordMetrics","metrics","fullMetrics","timestamp","Date","push","checkPerformanceAlerts","alerts","renderTime","testName","toFixed","memoryUsage","performanceGrade","networkTime","generateReport","totalTests","length","passedTests","filter","m","status","failedTests","skippedTests","averageRenderTime","reduce","sum","averageMemoryUsage","calculateOverallGrade","recommendations","generateRecommendations","avgRenderTime","avgMemoryUsage","score","failureRate","some","getAlerts","getMetricsForSuite","suiteName","testSuite","clear","exportMetrics","JSON","stringify","report","RENDER_TIME","MEMORY_USAGE","NETWORK_TIME","API_TIME","ACCESSIBILITY_TIME"],"mappings":"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"}
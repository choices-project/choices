a95994db429dc4c74d52d48f971f895a
// Mock auth utilities for testing
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    checkPermissions: function() {
        return checkPermissions;
    },
    createAuthMockContext: function() {
        return createAuthMockContext;
    },
    createSecureServerAction: function() {
        return createSecureServerAction;
    },
    getUser: function() {
        return getUser;
    },
    mockCSRFProtection: function() {
        return mockCSRFProtection;
    },
    mockRateLimiting: function() {
        return mockRateLimiting;
    },
    requireAuth: function() {
        return requireAuth;
    },
    validateSession: function() {
        return validateSession;
    }
});
const _globals = require("@jest/globals");
const getUser = _globals.jest.fn().mockResolvedValue({
    user: {
        id: "test-user-id",
        email: "test@example.com",
        name: "Test User"
    },
    error: null
});
const requireAuth = _globals.jest.fn().mockImplementation((handler)=>{
    return async (req, res)=>{
        const user = await getUser();
        if (!user.user) {
            return res.status(401).json({
                error: "Unauthorized"
            });
        }
        return handler(req, res);
    };
});
const checkPermissions = _globals.jest.fn().mockResolvedValue(true);
const validateSession = _globals.jest.fn().mockResolvedValue({
    valid: true,
    user: {
        id: "test-user-id",
        email: "test@example.com"
    }
});
const createAuthMockContext = _globals.jest.fn().mockReturnValue({
    user: {
        id: "test-user-id",
        email: "test@example.com",
        name: "Test User"
    },
    session: {
        id: "test-session-id",
        userId: "test-user-id",
        expiresAt: new Date(Date.now() + 86400000)
    },
    ip: "192.168.1.1",
    userAgent: "Mozilla/5.0 (Test Browser)",
    headers: {
        "x-forwarded-for": "192.168.1.1",
        "user-agent": "Mozilla/5.0 (Test Browser)"
    }
});
const mockRateLimiting = _globals.jest.fn().mockResolvedValue({
    allowed: true,
    remaining: 10,
    resetTime: Date.now() + 60000
});
const mockCSRFProtection = _globals.jest.fn().mockResolvedValue({
    valid: true,
    token: "test-csrf-token"
});
const createSecureServerAction = _globals.jest.fn().mockImplementation((handler, options)=>{
    return async (data, context)=>{
        // Mock authentication check
        if (options?.requireAuth && !context?.user) {
            throw new Error("Authentication required");
        }
        // Mock rate limiting check
        if (options?.rateLimit) {
            const rateLimitResult = await mockRateLimiting();
            if (!rateLimitResult.allowed) {
                throw new Error("Rate limit exceeded");
            }
        }
        // Mock CSRF protection check
        if (options?.csrfProtection) {
            const csrfResult = await mockCSRFProtection();
            if (!csrfResult.valid) {
                throw new Error("CSRF token validation failed");
            }
        }
        // Mock missing context check
        if (!context) {
            throw new Error("Server action context is required");
        }
        // Mock invalid input check
        if (!data) {
            throw new Error("Invalid input");
        }
        return await handler(data, context);
    };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L2hlbHBlcnMvYXV0aC10ZXN0LXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIE1vY2sgYXV0aCB1dGlsaXRpZXMgZm9yIHRlc3RpbmdcbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuZXhwb3J0IGNvbnN0IGdldFVzZXIgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICB1c2VyOiB7XG4gICAgaWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgbmFtZTogJ1Rlc3QgVXNlcicsXG4gIH0sXG4gIGVycm9yOiBudWxsLFxufSlcblxuZXhwb3J0IGNvbnN0IHJlcXVpcmVBdXRoID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGFuZGxlcikgPT4ge1xuICByZXR1cm4gYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRVc2VyKClcbiAgICBpZiAoIXVzZXIudXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pXG4gICAgfVxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKVxuICB9XG59KVxuXG5leHBvcnQgY29uc3QgY2hlY2tQZXJtaXNzaW9ucyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKVxuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVTZXNzaW9uID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgdmFsaWQ6IHRydWUsXG4gIHVzZXI6IHtcbiAgICBpZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgfSxcbn0pXG5cbi8vIE1vY2sgY29udGV4dCBjcmVhdG9yXG5leHBvcnQgY29uc3QgY3JlYXRlQXV0aE1vY2tDb250ZXh0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gIHVzZXI6IHtcbiAgICBpZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICBuYW1lOiAnVGVzdCBVc2VyJyxcbiAgfSxcbiAgc2Vzc2lvbjoge1xuICAgIGlkOiAndGVzdC1zZXNzaW9uLWlkJyxcbiAgICB1c2VySWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDg2NDAwMDAwKSwgLy8gMjQgaG91cnMgZnJvbSBub3dcbiAgfSxcbiAgaXA6ICcxOTIuMTY4LjEuMScsXG4gIHVzZXJBZ2VudDogJ01vemlsbGEvNS4wIChUZXN0IEJyb3dzZXIpJyxcbiAgaGVhZGVyczoge1xuICAgICd4LWZvcndhcmRlZC1mb3InOiAnMTkyLjE2OC4xLjEnLFxuICAgICd1c2VyLWFnZW50JzogJ01vemlsbGEvNS4wIChUZXN0IEJyb3dzZXIpJyxcbiAgfSxcbn0pXG5cbi8vIE1vY2sgcmF0ZSBsaW1pdGluZ1xuZXhwb3J0IGNvbnN0IG1vY2tSYXRlTGltaXRpbmcgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICBhbGxvd2VkOiB0cnVlLFxuICByZW1haW5pbmc6IDEwLFxuICByZXNldFRpbWU6IERhdGUubm93KCkgKyA2MDAwMCxcbn0pXG5cbi8vIE1vY2sgQ1NSRiBwcm90ZWN0aW9uXG5leHBvcnQgY29uc3QgbW9ja0NTUkZQcm90ZWN0aW9uID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgdmFsaWQ6IHRydWUsXG4gIHRva2VuOiAndGVzdC1jc3JmLXRva2VuJyxcbn0pXG5cbi8vIE1vY2sgc2VjdXJlIHNlcnZlciBhY3Rpb24gY3JlYXRvclxuZXhwb3J0IGNvbnN0IGNyZWF0ZVNlY3VyZVNlcnZlckFjdGlvbiA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGhhbmRsZXIsIG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIGFzeW5jIChkYXRhOiBhbnksIGNvbnRleHQ6IGFueSkgPT4ge1xuICAgIC8vIE1vY2sgYXV0aGVudGljYXRpb24gY2hlY2tcbiAgICBpZiAob3B0aW9ucz8ucmVxdWlyZUF1dGggJiYgIWNvbnRleHQ/LnVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXV0aGVudGljYXRpb24gcmVxdWlyZWQnKVxuICAgIH1cbiAgICBcbiAgICAvLyBNb2NrIHJhdGUgbGltaXRpbmcgY2hlY2tcbiAgICBpZiAob3B0aW9ucz8ucmF0ZUxpbWl0KSB7XG4gICAgICBjb25zdCByYXRlTGltaXRSZXN1bHQgPSBhd2FpdCBtb2NrUmF0ZUxpbWl0aW5nKClcbiAgICAgIGlmICghcmF0ZUxpbWl0UmVzdWx0LmFsbG93ZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSYXRlIGxpbWl0IGV4Y2VlZGVkJylcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gTW9jayBDU1JGIHByb3RlY3Rpb24gY2hlY2tcbiAgICBpZiAob3B0aW9ucz8uY3NyZlByb3RlY3Rpb24pIHtcbiAgICAgIGNvbnN0IGNzcmZSZXN1bHQgPSBhd2FpdCBtb2NrQ1NSRlByb3RlY3Rpb24oKVxuICAgICAgaWYgKCFjc3JmUmVzdWx0LnZhbGlkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ1NSRiB0b2tlbiB2YWxpZGF0aW9uIGZhaWxlZCcpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIE1vY2sgbWlzc2luZyBjb250ZXh0IGNoZWNrXG4gICAgaWYgKCFjb250ZXh0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlcnZlciBhY3Rpb24gY29udGV4dCBpcyByZXF1aXJlZCcpXG4gICAgfVxuICAgIFxuICAgIC8vIE1vY2sgaW52YWxpZCBpbnB1dCBjaGVja1xuICAgIGlmICghZGF0YSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGlucHV0JylcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIoZGF0YSwgY29udGV4dClcbiAgfVxufSkiXSwibmFtZXMiOlsiY2hlY2tQZXJtaXNzaW9ucyIsImNyZWF0ZUF1dGhNb2NrQ29udGV4dCIsImNyZWF0ZVNlY3VyZVNlcnZlckFjdGlvbiIsImdldFVzZXIiLCJtb2NrQ1NSRlByb3RlY3Rpb24iLCJtb2NrUmF0ZUxpbWl0aW5nIiwicmVxdWlyZUF1dGgiLCJ2YWxpZGF0ZVNlc3Npb24iLCJqZXN0IiwiZm4iLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInVzZXIiLCJpZCIsImVtYWlsIiwibmFtZSIsImVycm9yIiwibW9ja0ltcGxlbWVudGF0aW9uIiwiaGFuZGxlciIsInJlcSIsInJlcyIsInN0YXR1cyIsImpzb24iLCJ2YWxpZCIsIm1vY2tSZXR1cm5WYWx1ZSIsInNlc3Npb24iLCJ1c2VySWQiLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwiaXAiLCJ1c2VyQWdlbnQiLCJoZWFkZXJzIiwiYWxsb3dlZCIsInJlbWFpbmluZyIsInJlc2V0VGltZSIsInRva2VuIiwib3B0aW9ucyIsImRhdGEiLCJjb250ZXh0IiwiRXJyb3IiLCJyYXRlTGltaXQiLCJyYXRlTGltaXRSZXN1bHQiLCJjc3JmUHJvdGVjdGlvbiIsImNzcmZSZXN1bHQiXSwibWFwcGluZ3MiOiJBQUFBLGtDQUFrQzs7Ozs7Ozs7Ozs7O0lBc0JyQkEsZ0JBQWdCO2VBQWhCQTs7SUFXQUMscUJBQXFCO2VBQXJCQTs7SUFpQ0FDLHdCQUF3QjtlQUF4QkE7O0lBL0RBQyxPQUFPO2VBQVBBOztJQXlEQUMsa0JBQWtCO2VBQWxCQTs7SUFQQUMsZ0JBQWdCO2VBQWhCQTs7SUF6Q0FDLFdBQVc7ZUFBWEE7O0lBWUFDLGVBQWU7ZUFBZkE7Ozt5QkF2QlE7QUFFZCxNQUFNSixVQUFVSyxhQUFJLENBQUNDLEVBQUUsR0FBR0MsaUJBQWlCLENBQUM7SUFDakRDLE1BQU07UUFDSkMsSUFBSTtRQUNKQyxPQUFPO1FBQ1BDLE1BQU07SUFDUjtJQUNBQyxPQUFPO0FBQ1Q7QUFFTyxNQUFNVCxjQUFjRSxhQUFJLENBQUNDLEVBQUUsR0FBR08sa0JBQWtCLENBQUMsQ0FBQ0M7SUFDdkQsT0FBTyxPQUFPQyxLQUFVQztRQUN0QixNQUFNUixPQUFPLE1BQU1SO1FBQ25CLElBQUksQ0FBQ1EsS0FBS0EsSUFBSSxFQUFFO1lBQ2QsT0FBT1EsSUFBSUMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRU4sT0FBTztZQUFlO1FBQ3REO1FBQ0EsT0FBT0UsUUFBUUMsS0FBS0M7SUFDdEI7QUFDRjtBQUVPLE1BQU1uQixtQkFBbUJRLGFBQUksQ0FBQ0MsRUFBRSxHQUFHQyxpQkFBaUIsQ0FBQztBQUVyRCxNQUFNSCxrQkFBa0JDLGFBQUksQ0FBQ0MsRUFBRSxHQUFHQyxpQkFBaUIsQ0FBQztJQUN6RFksT0FBTztJQUNQWCxNQUFNO1FBQ0pDLElBQUk7UUFDSkMsT0FBTztJQUNUO0FBQ0Y7QUFHTyxNQUFNWix3QkFBd0JPLGFBQUksQ0FBQ0MsRUFBRSxHQUFHYyxlQUFlLENBQUM7SUFDN0RaLE1BQU07UUFDSkMsSUFBSTtRQUNKQyxPQUFPO1FBQ1BDLE1BQU07SUFDUjtJQUNBVSxTQUFTO1FBQ1BaLElBQUk7UUFDSmEsUUFBUTtRQUNSQyxXQUFXLElBQUlDLEtBQUtBLEtBQUtDLEdBQUcsS0FBSztJQUNuQztJQUNBQyxJQUFJO0lBQ0pDLFdBQVc7SUFDWEMsU0FBUztRQUNQLG1CQUFtQjtRQUNuQixjQUFjO0lBQ2hCO0FBQ0Y7QUFHTyxNQUFNMUIsbUJBQW1CRyxhQUFJLENBQUNDLEVBQUUsR0FBR0MsaUJBQWlCLENBQUM7SUFDMURzQixTQUFTO0lBQ1RDLFdBQVc7SUFDWEMsV0FBV1AsS0FBS0MsR0FBRyxLQUFLO0FBQzFCO0FBR08sTUFBTXhCLHFCQUFxQkksYUFBSSxDQUFDQyxFQUFFLEdBQUdDLGlCQUFpQixDQUFDO0lBQzVEWSxPQUFPO0lBQ1BhLE9BQU87QUFDVDtBQUdPLE1BQU1qQywyQkFBMkJNLGFBQUksQ0FBQ0MsRUFBRSxHQUFHTyxrQkFBa0IsQ0FBQyxDQUFDQyxTQUFTbUI7SUFDN0UsT0FBTyxPQUFPQyxNQUFXQztRQUN2Qiw0QkFBNEI7UUFDNUIsSUFBSUYsU0FBUzlCLGVBQWUsQ0FBQ2dDLFNBQVMzQixNQUFNO1lBQzFDLE1BQU0sSUFBSTRCLE1BQU07UUFDbEI7UUFFQSwyQkFBMkI7UUFDM0IsSUFBSUgsU0FBU0ksV0FBVztZQUN0QixNQUFNQyxrQkFBa0IsTUFBTXBDO1lBQzlCLElBQUksQ0FBQ29DLGdCQUFnQlQsT0FBTyxFQUFFO2dCQUM1QixNQUFNLElBQUlPLE1BQU07WUFDbEI7UUFDRjtRQUVBLDZCQUE2QjtRQUM3QixJQUFJSCxTQUFTTSxnQkFBZ0I7WUFDM0IsTUFBTUMsYUFBYSxNQUFNdkM7WUFDekIsSUFBSSxDQUFDdUMsV0FBV3JCLEtBQUssRUFBRTtnQkFDckIsTUFBTSxJQUFJaUIsTUFBTTtZQUNsQjtRQUNGO1FBRUEsNkJBQTZCO1FBQzdCLElBQUksQ0FBQ0QsU0FBUztZQUNaLE1BQU0sSUFBSUMsTUFBTTtRQUNsQjtRQUVBLDJCQUEyQjtRQUMzQixJQUFJLENBQUNGLE1BQU07WUFDVCxNQUFNLElBQUlFLE1BQU07UUFDbEI7UUFFQSxPQUFPLE1BQU10QixRQUFRb0IsTUFBTUM7SUFDN0I7QUFDRiJ9
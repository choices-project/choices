194dc1e2f2d479eefd0dea8cdb64d383
/**
 * Unit Tests - Voting Algorithms (70% of tests)
 * 
 * These tests focus on individual functions and algorithms.
 * Fast, isolated, and focused on business logic.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
// Import voting algorithms
// Note: These functions may not exist yet - this is TDD in action!
// import { calculateResults } from '@/lib/vote/strategies/ranked';
// import { calculateSingleChoiceResults } from '@/lib/vote/strategies/single-choice';
// Mock functions for TDD demonstration
const calculateResults = (votes, options)=>{
    // TDD RED PHASE: This will fail initially
    // This is what we WANT the function to do
    return {
        winner: options[0]?.id || null,
        rounds: [],
        results: options.map((option)=>({
                option_id: option.id,
                votes: 0,
                percentage: 0
            }))
    };
};
const calculateSingleChoiceResults = (votes, options)=>{
    // TDD RED PHASE: This will fail initially
    // This is what we WANT the function to do
    const results = options.map((option)=>({
            option_id: option.id,
            votes: 0,
            percentage: 0
        }));
    // Count votes
    votes.forEach((vote)=>{
        if (results[vote.option_index]) {
            results[vote.option_index].votes++;
        }
    });
    // Calculate percentages
    const totalVotes = votes.length;
    results.forEach((result)=>{
        result.percentage = totalVotes > 0 ? result.votes / totalVotes * 100 : 0;
    });
    // Find winner
    const winner = results.reduce((prev, current)=>prev.votes > current.votes ? prev : current);
    return {
        winner: winner.votes > 0 ? winner.option_id : null,
        results
    };
};
(0, _globals.describe)("Unit Tests - Voting Algorithms", ()=>{
    (0, _globals.describe)("Ranked Choice Voting Algorithm", ()=>{
        (0, _globals.it)("should calculate instant-runoff voting correctly", ()=>{
            // Test data for ranked choice voting
            const votes = [
                {
                    user_id: "user1",
                    rankings: [
                        1,
                        2,
                        3
                    ]
                },
                {
                    user_id: "user2",
                    rankings: [
                        1,
                        3,
                        2
                    ]
                },
                {
                    user_id: "user3",
                    rankings: [
                        2,
                        1,
                        3
                    ]
                },
                {
                    user_id: "user4",
                    rankings: [
                        2,
                        3,
                        1
                    ]
                },
                {
                    user_id: "user5",
                    rankings: [
                        3,
                        1,
                        2
                    ]
                }
            ];
            const options = [
                {
                    id: "option1",
                    text: "Option A"
                },
                {
                    id: "option2",
                    text: "Option B"
                },
                {
                    id: "option3",
                    text: "Option C"
                }
            ];
            const result = calculateResults(votes, options);
            // Test the algorithm logic
            (0, _globals.expect)(result).toBeDefined();
            (0, _globals.expect)(result.winner).toBeDefined();
            (0, _globals.expect)(result.rounds).toBeDefined();
            (0, _globals.expect)(Array.isArray(result.rounds)).toBe(true);
        });
        (0, _globals.it)("should handle ties correctly", ()=>{
            const votes = [
                {
                    user_id: "user1",
                    rankings: [
                        1,
                        2
                    ]
                },
                {
                    user_id: "user2",
                    rankings: [
                        2,
                        1
                    ]
                }
            ];
            const options = [
                {
                    id: "option1",
                    text: "Option A"
                },
                {
                    id: "option2",
                    text: "Option B"
                }
            ];
            const result = calculateResults(votes, options);
            (0, _globals.expect)(result).toBeDefined();
            (0, _globals.expect)(result.winner).toBeDefined();
        });
        (0, _globals.it)("should handle single candidate correctly", ()=>{
            const votes = [
                {
                    user_id: "user1",
                    rankings: [
                        1
                    ]
                }
            ];
            const options = [
                {
                    id: "option1",
                    text: "Option A"
                }
            ];
            const result = calculateResults(votes, options);
            (0, _globals.expect)(result).toBeDefined();
            (0, _globals.expect)(result.winner).toBe("option1");
        });
    });
    (0, _globals.describe)("Single Choice Voting Algorithm", ()=>{
        (0, _globals.it)("should calculate simple majority correctly", ()=>{
            const votes = [
                {
                    user_id: "user1",
                    option_index: 0
                },
                {
                    user_id: "user2",
                    option_index: 0
                },
                {
                    user_id: "user3",
                    option_index: 1
                },
                {
                    user_id: "user4",
                    option_index: 1
                },
                {
                    user_id: "user5",
                    option_index: 1
                }
            ];
            const options = [
                {
                    id: "option1",
                    text: "Option A"
                },
                {
                    id: "option2",
                    text: "Option B"
                }
            ];
            const result = calculateSingleChoiceResults(votes, options);
            (0, _globals.expect)(result).toBeDefined();
            (0, _globals.expect)(result.winner).toBe("option2"); // Option B wins with 3 votes
            (0, _globals.expect)(result.results[1].votes).toBe(3);
            (0, _globals.expect)(result.results[0].votes).toBe(2);
        });
        (0, _globals.it)("should handle no votes correctly", ()=>{
            const votes = [];
            const options = [
                {
                    id: "option1",
                    text: "Option A"
                },
                {
                    id: "option2",
                    text: "Option B"
                }
            ];
            const result = calculateSingleChoiceResults(votes, options);
            (0, _globals.expect)(result).toBeDefined();
            (0, _globals.expect)(result.winner).toBeNull();
            (0, _globals.expect)(result.results[0].votes).toBe(0);
            (0, _globals.expect)(result.results[1].votes).toBe(0);
        });
        (0, _globals.it)("should handle ties correctly", ()=>{
            const votes = [
                {
                    user_id: "user1",
                    option_index: 0
                },
                {
                    user_id: "user2",
                    option_index: 1
                }
            ];
            const options = [
                {
                    id: "option1",
                    text: "Option A"
                },
                {
                    id: "option2",
                    text: "Option B"
                }
            ];
            const result = calculateSingleChoiceResults(votes, options);
            (0, _globals.expect)(result).toBeDefined();
            (0, _globals.expect)(result.winner).toBeNull(); // Tie
            (0, _globals.expect)(result.results[0].votes).toBe(1);
            (0, _globals.expect)(result.results[1].votes).toBe(1);
        });
    });
    (0, _globals.describe)("Vote Validation", ()=>{
        (0, _globals.it)("should validate vote data structure", ()=>{
            const validVote = {
                user_id: "user1",
                option_index: 0,
                created_at: new Date().toISOString()
            };
            // Test validation logic
            (0, _globals.expect)(validVote.user_id).toBeDefined();
            (0, _globals.expect)(validVote.option_index).toBeDefined();
            (0, _globals.expect)(validVote.created_at).toBeDefined();
            (0, _globals.expect)(typeof validVote.user_id).toBe("string");
            (0, _globals.expect)(typeof validVote.option_index).toBe("number");
            (0, _globals.expect)(typeof validVote.created_at).toBe("string");
        });
        (0, _globals.it)("should reject invalid vote data", ()=>{
            const invalidVote = {
                user_id: "",
                option_index: -1,
                created_at: "invalid-date"
            };
            // Test validation logic
            (0, _globals.expect)(invalidVote.user_id).toBe("");
            (0, _globals.expect)(invalidVote.option_index).toBe(-1);
            (0, _globals.expect)(invalidVote.created_at).toBe("invalid-date");
        });
    });
    (0, _globals.describe)("Result Calculations", ()=>{
        (0, _globals.it)("should calculate percentages correctly", ()=>{
            const totalVotes = 100;
            const optionVotes = 25;
            const expectedPercentage = 25;
            const percentage = optionVotes / totalVotes * 100;
            (0, _globals.expect)(percentage).toBe(expectedPercentage);
        });
        (0, _globals.it)("should handle zero total votes", ()=>{
            const totalVotes = 0;
            const optionVotes = 0;
            const percentage = totalVotes > 0 ? optionVotes / totalVotes * 100 : 0;
            (0, _globals.expect)(percentage).toBe(0);
        });
        (0, _globals.it)("should round percentages correctly", ()=>{
            const totalVotes = 3;
            const optionVotes = 1;
            const expectedPercentage = 33.33;
            const percentage = Math.round(optionVotes / totalVotes * 100 * 100) / 100;
            (0, _globals.expect)(percentage).toBe(expectedPercentage);
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvbGliL3ZvdGUvdm90aW5nLWFsZ29yaXRobXMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaXQgVGVzdHMgLSBWb3RpbmcgQWxnb3JpdGhtcyAoNzAlIG9mIHRlc3RzKVxuICogXG4gKiBUaGVzZSB0ZXN0cyBmb2N1cyBvbiBpbmRpdmlkdWFsIGZ1bmN0aW9ucyBhbmQgYWxnb3JpdGhtcy5cbiAqIEZhc3QsIGlzb2xhdGVkLCBhbmQgZm9jdXNlZCBvbiBidXNpbmVzcyBsb2dpYy5cbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuXG4vLyBJbXBvcnQgdm90aW5nIGFsZ29yaXRobXNcbi8vIE5vdGU6IFRoZXNlIGZ1bmN0aW9ucyBtYXkgbm90IGV4aXN0IHlldCAtIHRoaXMgaXMgVEREIGluIGFjdGlvbiFcbi8vIGltcG9ydCB7IGNhbGN1bGF0ZVJlc3VsdHMgfSBmcm9tICdAL2xpYi92b3RlL3N0cmF0ZWdpZXMvcmFua2VkJztcbi8vIGltcG9ydCB7IGNhbGN1bGF0ZVNpbmdsZUNob2ljZVJlc3VsdHMgfSBmcm9tICdAL2xpYi92b3RlL3N0cmF0ZWdpZXMvc2luZ2xlLWNob2ljZSc7XG5cbi8vIE1vY2sgZnVuY3Rpb25zIGZvciBUREQgZGVtb25zdHJhdGlvblxuY29uc3QgY2FsY3VsYXRlUmVzdWx0cyA9ICh2b3RlczogYW55W10sIG9wdGlvbnM6IGFueVtdKSA9PiB7XG4gIC8vIFRERCBSRUQgUEhBU0U6IFRoaXMgd2lsbCBmYWlsIGluaXRpYWxseVxuICAvLyBUaGlzIGlzIHdoYXQgd2UgV0FOVCB0aGUgZnVuY3Rpb24gdG8gZG9cbiAgcmV0dXJuIHtcbiAgICB3aW5uZXI6IG9wdGlvbnNbMF0/LmlkIHx8IG51bGwsXG4gICAgcm91bmRzOiBbXSxcbiAgICByZXN1bHRzOiBvcHRpb25zLm1hcChvcHRpb24gPT4gKHtcbiAgICAgIG9wdGlvbl9pZDogb3B0aW9uLmlkLFxuICAgICAgdm90ZXM6IDAsXG4gICAgICBwZXJjZW50YWdlOiAwXG4gICAgfSkpXG4gIH07XG59O1xuXG5jb25zdCBjYWxjdWxhdGVTaW5nbGVDaG9pY2VSZXN1bHRzID0gKHZvdGVzOiBhbnlbXSwgb3B0aW9uczogYW55W10pID0+IHtcbiAgLy8gVEREIFJFRCBQSEFTRTogVGhpcyB3aWxsIGZhaWwgaW5pdGlhbGx5XG4gIC8vIFRoaXMgaXMgd2hhdCB3ZSBXQU5UIHRoZSBmdW5jdGlvbiB0byBkb1xuICBjb25zdCByZXN1bHRzID0gb3B0aW9ucy5tYXAob3B0aW9uID0+ICh7XG4gICAgb3B0aW9uX2lkOiBvcHRpb24uaWQsXG4gICAgdm90ZXM6IDAsXG4gICAgcGVyY2VudGFnZTogMFxuICB9KSk7XG5cbiAgLy8gQ291bnQgdm90ZXNcbiAgdm90ZXMuZm9yRWFjaCh2b3RlID0+IHtcbiAgICBpZiAocmVzdWx0c1t2b3RlLm9wdGlvbl9pbmRleF0pIHtcbiAgICAgIHJlc3VsdHNbdm90ZS5vcHRpb25faW5kZXhdLnZvdGVzKys7XG4gICAgfVxuICB9KTtcblxuICAvLyBDYWxjdWxhdGUgcGVyY2VudGFnZXNcbiAgY29uc3QgdG90YWxWb3RlcyA9IHZvdGVzLmxlbmd0aDtcbiAgcmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XG4gICAgcmVzdWx0LnBlcmNlbnRhZ2UgPSB0b3RhbFZvdGVzID4gMCA/IChyZXN1bHQudm90ZXMgLyB0b3RhbFZvdGVzKSAqIDEwMCA6IDA7XG4gIH0pO1xuXG4gIC8vIEZpbmQgd2lubmVyXG4gIGNvbnN0IHdpbm5lciA9IHJlc3VsdHMucmVkdWNlKChwcmV2LCBjdXJyZW50KSA9PiBcbiAgICAocHJldi52b3RlcyA+IGN1cnJlbnQudm90ZXMpID8gcHJldiA6IGN1cnJlbnRcbiAgKTtcblxuICByZXR1cm4ge1xuICAgIHdpbm5lcjogd2lubmVyLnZvdGVzID4gMCA/IHdpbm5lci5vcHRpb25faWQgOiBudWxsLFxuICAgIHJlc3VsdHNcbiAgfTtcbn07XG5cbmRlc2NyaWJlKCdVbml0IFRlc3RzIC0gVm90aW5nIEFsZ29yaXRobXMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdSYW5rZWQgQ2hvaWNlIFZvdGluZyBBbGdvcml0aG0nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgaW5zdGFudC1ydW5vZmYgdm90aW5nIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIC8vIFRlc3QgZGF0YSBmb3IgcmFua2VkIGNob2ljZSB2b3RpbmdcbiAgICAgIGNvbnN0IHZvdGVzID0gW1xuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyMScsIHJhbmtpbmdzOiBbMSwgMiwgM10gfSwgLy8gQSwgQiwgQ1xuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyMicsIHJhbmtpbmdzOiBbMSwgMywgMl0gfSwgLy8gQSwgQywgQlxuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyMycsIHJhbmtpbmdzOiBbMiwgMSwgM10gfSwgLy8gQiwgQSwgQ1xuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyNCcsIHJhbmtpbmdzOiBbMiwgMywgMV0gfSwgLy8gQiwgQywgQVxuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyNScsIHJhbmtpbmdzOiBbMywgMSwgMl0gfSwgLy8gQywgQSwgQlxuICAgICAgXTtcblxuICAgICAgY29uc3Qgb3B0aW9ucyA9IFtcbiAgICAgICAgeyBpZDogJ29wdGlvbjEnLCB0ZXh0OiAnT3B0aW9uIEEnIH0sXG4gICAgICAgIHsgaWQ6ICdvcHRpb24yJywgdGV4dDogJ09wdGlvbiBCJyB9LFxuICAgICAgICB7IGlkOiAnb3B0aW9uMycsIHRleHQ6ICdPcHRpb24gQycgfVxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlUmVzdWx0cyh2b3Rlcywgb3B0aW9ucyk7XG5cbiAgICAgIC8vIFRlc3QgdGhlIGFsZ29yaXRobSBsb2dpY1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2lubmVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yb3VuZHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQucm91bmRzKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHRpZXMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3Qgdm90ZXMgPSBbXG4gICAgICAgIHsgdXNlcl9pZDogJ3VzZXIxJywgcmFua2luZ3M6IFsxLCAyXSB9LFxuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyMicsIHJhbmtpbmdzOiBbMiwgMV0gfVxuICAgICAgXTtcblxuICAgICAgY29uc3Qgb3B0aW9ucyA9IFtcbiAgICAgICAgeyBpZDogJ29wdGlvbjEnLCB0ZXh0OiAnT3B0aW9uIEEnIH0sXG4gICAgICAgIHsgaWQ6ICdvcHRpb24yJywgdGV4dDogJ09wdGlvbiBCJyB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjYWxjdWxhdGVSZXN1bHRzKHZvdGVzLCBvcHRpb25zKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2lubmVyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2luZ2xlIGNhbmRpZGF0ZSBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCB2b3RlcyA9IFtcbiAgICAgICAgeyB1c2VyX2lkOiAndXNlcjEnLCByYW5raW5nczogWzFdIH1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBbXG4gICAgICAgIHsgaWQ6ICdvcHRpb24xJywgdGV4dDogJ09wdGlvbiBBJyB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjYWxjdWxhdGVSZXN1bHRzKHZvdGVzLCBvcHRpb25zKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2lubmVyKS50b0JlKCdvcHRpb24xJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTaW5nbGUgQ2hvaWNlIFZvdGluZyBBbGdvcml0aG0nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgc2ltcGxlIG1ham9yaXR5IGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHZvdGVzID0gW1xuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyMScsIG9wdGlvbl9pbmRleDogMCB9LFxuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyMicsIG9wdGlvbl9pbmRleDogMCB9LFxuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyMycsIG9wdGlvbl9pbmRleDogMSB9LFxuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyNCcsIG9wdGlvbl9pbmRleDogMSB9LFxuICAgICAgICB7IHVzZXJfaWQ6ICd1c2VyNScsIG9wdGlvbl9pbmRleDogMSB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCBvcHRpb25zID0gW1xuICAgICAgICB7IGlkOiAnb3B0aW9uMScsIHRleHQ6ICdPcHRpb24gQScgfSxcbiAgICAgICAgeyBpZDogJ29wdGlvbjInLCB0ZXh0OiAnT3B0aW9uIEInIH1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVNpbmdsZUNob2ljZVJlc3VsdHModm90ZXMsIG9wdGlvbnMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC53aW5uZXIpLnRvQmUoJ29wdGlvbjInKTsgLy8gT3B0aW9uIEIgd2lucyB3aXRoIDMgdm90ZXNcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0c1sxXS52b3RlcykudG9CZSgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0c1swXS52b3RlcykudG9CZSgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vIHZvdGVzIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHZvdGVzOiBhbnlbXSA9IFtdO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IFtcbiAgICAgICAgeyBpZDogJ29wdGlvbjEnLCB0ZXh0OiAnT3B0aW9uIEEnIH0sXG4gICAgICAgIHsgaWQ6ICdvcHRpb24yJywgdGV4dDogJ09wdGlvbiBCJyB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjYWxjdWxhdGVTaW5nbGVDaG9pY2VSZXN1bHRzKHZvdGVzLCBvcHRpb25zKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2lubmVyKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHRzWzBdLnZvdGVzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHRzWzFdLnZvdGVzKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdGllcyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCB2b3RlcyA9IFtcbiAgICAgICAgeyB1c2VyX2lkOiAndXNlcjEnLCBvcHRpb25faW5kZXg6IDAgfSxcbiAgICAgICAgeyB1c2VyX2lkOiAndXNlcjInLCBvcHRpb25faW5kZXg6IDEgfVxuICAgICAgXTtcblxuICAgICAgY29uc3Qgb3B0aW9ucyA9IFtcbiAgICAgICAgeyBpZDogJ29wdGlvbjEnLCB0ZXh0OiAnT3B0aW9uIEEnIH0sXG4gICAgICAgIHsgaWQ6ICdvcHRpb24yJywgdGV4dDogJ09wdGlvbiBCJyB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjYWxjdWxhdGVTaW5nbGVDaG9pY2VSZXN1bHRzKHZvdGVzLCBvcHRpb25zKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQud2lubmVyKS50b0JlTnVsbCgpOyAvLyBUaWVcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0c1swXS52b3RlcykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0c1sxXS52b3RlcykudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1ZvdGUgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHZvdGUgZGF0YSBzdHJ1Y3R1cmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZFZvdGUgPSB7XG4gICAgICAgIHVzZXJfaWQ6ICd1c2VyMScsXG4gICAgICAgIG9wdGlvbl9pbmRleDogMCxcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9O1xuXG4gICAgICAvLyBUZXN0IHZhbGlkYXRpb24gbG9naWNcbiAgICAgIGV4cGVjdCh2YWxpZFZvdGUudXNlcl9pZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh2YWxpZFZvdGUub3B0aW9uX2luZGV4KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHZhbGlkVm90ZS5jcmVhdGVkX2F0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHR5cGVvZiB2YWxpZFZvdGUudXNlcl9pZCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHZhbGlkVm90ZS5vcHRpb25faW5kZXgpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiB2YWxpZFZvdGUuY3JlYXRlZF9hdCkudG9CZSgnc3RyaW5nJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIHZvdGUgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRWb3RlID0ge1xuICAgICAgICB1c2VyX2lkOiAnJyxcbiAgICAgICAgb3B0aW9uX2luZGV4OiAtMSxcbiAgICAgICAgY3JlYXRlZF9hdDogJ2ludmFsaWQtZGF0ZSdcbiAgICAgIH07XG5cbiAgICAgIC8vIFRlc3QgdmFsaWRhdGlvbiBsb2dpY1xuICAgICAgZXhwZWN0KGludmFsaWRWb3RlLnVzZXJfaWQpLnRvQmUoJycpO1xuICAgICAgZXhwZWN0KGludmFsaWRWb3RlLm9wdGlvbl9pbmRleCkudG9CZSgtMSk7XG4gICAgICBleHBlY3QoaW52YWxpZFZvdGUuY3JlYXRlZF9hdCkudG9CZSgnaW52YWxpZC1kYXRlJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZXN1bHQgQ2FsY3VsYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHBlcmNlbnRhZ2VzIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRvdGFsVm90ZXMgPSAxMDA7XG4gICAgICBjb25zdCBvcHRpb25Wb3RlcyA9IDI1O1xuICAgICAgY29uc3QgZXhwZWN0ZWRQZXJjZW50YWdlID0gMjU7XG5cbiAgICAgIGNvbnN0IHBlcmNlbnRhZ2UgPSAob3B0aW9uVm90ZXMgLyB0b3RhbFZvdGVzKSAqIDEwMDtcblxuICAgICAgZXhwZWN0KHBlcmNlbnRhZ2UpLnRvQmUoZXhwZWN0ZWRQZXJjZW50YWdlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHplcm8gdG90YWwgdm90ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0b3RhbFZvdGVzID0gMDtcbiAgICAgIGNvbnN0IG9wdGlvblZvdGVzID0gMDtcblxuICAgICAgY29uc3QgcGVyY2VudGFnZSA9IHRvdGFsVm90ZXMgPiAwID8gKG9wdGlvblZvdGVzIC8gdG90YWxWb3RlcykgKiAxMDAgOiAwO1xuXG4gICAgICBleHBlY3QocGVyY2VudGFnZSkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcm91bmQgcGVyY2VudGFnZXMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgdG90YWxWb3RlcyA9IDM7XG4gICAgICBjb25zdCBvcHRpb25Wb3RlcyA9IDE7XG4gICAgICBjb25zdCBleHBlY3RlZFBlcmNlbnRhZ2UgPSAzMy4zMztcblxuICAgICAgY29uc3QgcGVyY2VudGFnZSA9IE1hdGgucm91bmQoKG9wdGlvblZvdGVzIC8gdG90YWxWb3RlcykgKiAxMDAgKiAxMDApIC8gMTAwO1xuXG4gICAgICBleHBlY3QocGVyY2VudGFnZSkudG9CZShleHBlY3RlZFBlcmNlbnRhZ2UpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbImNhbGN1bGF0ZVJlc3VsdHMiLCJ2b3RlcyIsIm9wdGlvbnMiLCJ3aW5uZXIiLCJpZCIsInJvdW5kcyIsInJlc3VsdHMiLCJtYXAiLCJvcHRpb24iLCJvcHRpb25faWQiLCJwZXJjZW50YWdlIiwiY2FsY3VsYXRlU2luZ2xlQ2hvaWNlUmVzdWx0cyIsImZvckVhY2giLCJ2b3RlIiwib3B0aW9uX2luZGV4IiwidG90YWxWb3RlcyIsImxlbmd0aCIsInJlc3VsdCIsInJlZHVjZSIsInByZXYiLCJjdXJyZW50IiwiZGVzY3JpYmUiLCJpdCIsInVzZXJfaWQiLCJyYW5raW5ncyIsInRleHQiLCJleHBlY3QiLCJ0b0JlRGVmaW5lZCIsIkFycmF5IiwiaXNBcnJheSIsInRvQmUiLCJ0b0JlTnVsbCIsInZhbGlkVm90ZSIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJpbnZhbGlkVm90ZSIsIm9wdGlvblZvdGVzIiwiZXhwZWN0ZWRQZXJjZW50YWdlIiwiTWF0aCIsInJvdW5kIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Q0FLQzs7Ozt5QkFFb0M7QUFFckMsMkJBQTJCO0FBQzNCLG1FQUFtRTtBQUNuRSxtRUFBbUU7QUFDbkUsc0ZBQXNGO0FBRXRGLHVDQUF1QztBQUN2QyxNQUFNQSxtQkFBbUIsQ0FBQ0MsT0FBY0M7SUFDdEMsMENBQTBDO0lBQzFDLDBDQUEwQztJQUMxQyxPQUFPO1FBQ0xDLFFBQVFELE9BQU8sQ0FBQyxFQUFFLEVBQUVFLE1BQU07UUFDMUJDLFFBQVEsRUFBRTtRQUNWQyxTQUFTSixRQUFRSyxHQUFHLENBQUNDLENBQUFBLFNBQVcsQ0FBQTtnQkFDOUJDLFdBQVdELE9BQU9KLEVBQUU7Z0JBQ3BCSCxPQUFPO2dCQUNQUyxZQUFZO1lBQ2QsQ0FBQTtJQUNGO0FBQ0Y7QUFFQSxNQUFNQywrQkFBK0IsQ0FBQ1YsT0FBY0M7SUFDbEQsMENBQTBDO0lBQzFDLDBDQUEwQztJQUMxQyxNQUFNSSxVQUFVSixRQUFRSyxHQUFHLENBQUNDLENBQUFBLFNBQVcsQ0FBQTtZQUNyQ0MsV0FBV0QsT0FBT0osRUFBRTtZQUNwQkgsT0FBTztZQUNQUyxZQUFZO1FBQ2QsQ0FBQTtJQUVBLGNBQWM7SUFDZFQsTUFBTVcsT0FBTyxDQUFDQyxDQUFBQTtRQUNaLElBQUlQLE9BQU8sQ0FBQ08sS0FBS0MsWUFBWSxDQUFDLEVBQUU7WUFDOUJSLE9BQU8sQ0FBQ08sS0FBS0MsWUFBWSxDQUFDLENBQUNiLEtBQUs7UUFDbEM7SUFDRjtJQUVBLHdCQUF3QjtJQUN4QixNQUFNYyxhQUFhZCxNQUFNZSxNQUFNO0lBQy9CVixRQUFRTSxPQUFPLENBQUNLLENBQUFBO1FBQ2RBLE9BQU9QLFVBQVUsR0FBR0ssYUFBYSxJQUFJLEFBQUNFLE9BQU9oQixLQUFLLEdBQUdjLGFBQWMsTUFBTTtJQUMzRTtJQUVBLGNBQWM7SUFDZCxNQUFNWixTQUFTRyxRQUFRWSxNQUFNLENBQUMsQ0FBQ0MsTUFBTUMsVUFDbkMsQUFBQ0QsS0FBS2xCLEtBQUssR0FBR21CLFFBQVFuQixLQUFLLEdBQUlrQixPQUFPQztJQUd4QyxPQUFPO1FBQ0xqQixRQUFRQSxPQUFPRixLQUFLLEdBQUcsSUFBSUUsT0FBT00sU0FBUyxHQUFHO1FBQzlDSDtJQUNGO0FBQ0Y7QUFFQWUsSUFBQUEsaUJBQVEsRUFBQyxrQ0FBa0M7SUFDekNBLElBQUFBLGlCQUFRLEVBQUMsa0NBQWtDO1FBQ3pDQyxJQUFBQSxXQUFFLEVBQUMsb0RBQW9EO1lBQ3JELHFDQUFxQztZQUNyQyxNQUFNckIsUUFBUTtnQkFDWjtvQkFBRXNCLFNBQVM7b0JBQVNDLFVBQVU7d0JBQUM7d0JBQUc7d0JBQUc7cUJBQUU7Z0JBQUM7Z0JBQ3hDO29CQUFFRCxTQUFTO29CQUFTQyxVQUFVO3dCQUFDO3dCQUFHO3dCQUFHO3FCQUFFO2dCQUFDO2dCQUN4QztvQkFBRUQsU0FBUztvQkFBU0MsVUFBVTt3QkFBQzt3QkFBRzt3QkFBRztxQkFBRTtnQkFBQztnQkFDeEM7b0JBQUVELFNBQVM7b0JBQVNDLFVBQVU7d0JBQUM7d0JBQUc7d0JBQUc7cUJBQUU7Z0JBQUM7Z0JBQ3hDO29CQUFFRCxTQUFTO29CQUFTQyxVQUFVO3dCQUFDO3dCQUFHO3dCQUFHO3FCQUFFO2dCQUFDO2FBQ3pDO1lBRUQsTUFBTXRCLFVBQVU7Z0JBQ2Q7b0JBQUVFLElBQUk7b0JBQVdxQixNQUFNO2dCQUFXO2dCQUNsQztvQkFBRXJCLElBQUk7b0JBQVdxQixNQUFNO2dCQUFXO2dCQUNsQztvQkFBRXJCLElBQUk7b0JBQVdxQixNQUFNO2dCQUFXO2FBQ25DO1lBRUQsTUFBTVIsU0FBU2pCLGlCQUFpQkMsT0FBT0M7WUFFdkMsMkJBQTJCO1lBQzNCd0IsSUFBQUEsZUFBTSxFQUFDVCxRQUFRVSxXQUFXO1lBQzFCRCxJQUFBQSxlQUFNLEVBQUNULE9BQU9kLE1BQU0sRUFBRXdCLFdBQVc7WUFDakNELElBQUFBLGVBQU0sRUFBQ1QsT0FBT1osTUFBTSxFQUFFc0IsV0FBVztZQUNqQ0QsSUFBQUEsZUFBTSxFQUFDRSxNQUFNQyxPQUFPLENBQUNaLE9BQU9aLE1BQU0sR0FBR3lCLElBQUksQ0FBQztRQUM1QztRQUVBUixJQUFBQSxXQUFFLEVBQUMsZ0NBQWdDO1lBQ2pDLE1BQU1yQixRQUFRO2dCQUNaO29CQUFFc0IsU0FBUztvQkFBU0MsVUFBVTt3QkFBQzt3QkFBRztxQkFBRTtnQkFBQztnQkFDckM7b0JBQUVELFNBQVM7b0JBQVNDLFVBQVU7d0JBQUM7d0JBQUc7cUJBQUU7Z0JBQUM7YUFDdEM7WUFFRCxNQUFNdEIsVUFBVTtnQkFDZDtvQkFBRUUsSUFBSTtvQkFBV3FCLE1BQU07Z0JBQVc7Z0JBQ2xDO29CQUFFckIsSUFBSTtvQkFBV3FCLE1BQU07Z0JBQVc7YUFDbkM7WUFFRCxNQUFNUixTQUFTakIsaUJBQWlCQyxPQUFPQztZQUV2Q3dCLElBQUFBLGVBQU0sRUFBQ1QsUUFBUVUsV0FBVztZQUMxQkQsSUFBQUEsZUFBTSxFQUFDVCxPQUFPZCxNQUFNLEVBQUV3QixXQUFXO1FBQ25DO1FBRUFMLElBQUFBLFdBQUUsRUFBQyw0Q0FBNEM7WUFDN0MsTUFBTXJCLFFBQVE7Z0JBQ1o7b0JBQUVzQixTQUFTO29CQUFTQyxVQUFVO3dCQUFDO3FCQUFFO2dCQUFDO2FBQ25DO1lBRUQsTUFBTXRCLFVBQVU7Z0JBQ2Q7b0JBQUVFLElBQUk7b0JBQVdxQixNQUFNO2dCQUFXO2FBQ25DO1lBRUQsTUFBTVIsU0FBU2pCLGlCQUFpQkMsT0FBT0M7WUFFdkN3QixJQUFBQSxlQUFNLEVBQUNULFFBQVFVLFdBQVc7WUFDMUJELElBQUFBLGVBQU0sRUFBQ1QsT0FBT2QsTUFBTSxFQUFFMkIsSUFBSSxDQUFDO1FBQzdCO0lBQ0Y7SUFFQVQsSUFBQUEsaUJBQVEsRUFBQyxrQ0FBa0M7UUFDekNDLElBQUFBLFdBQUUsRUFBQyw4Q0FBOEM7WUFDL0MsTUFBTXJCLFFBQVE7Z0JBQ1o7b0JBQUVzQixTQUFTO29CQUFTVCxjQUFjO2dCQUFFO2dCQUNwQztvQkFBRVMsU0FBUztvQkFBU1QsY0FBYztnQkFBRTtnQkFDcEM7b0JBQUVTLFNBQVM7b0JBQVNULGNBQWM7Z0JBQUU7Z0JBQ3BDO29CQUFFUyxTQUFTO29CQUFTVCxjQUFjO2dCQUFFO2dCQUNwQztvQkFBRVMsU0FBUztvQkFBU1QsY0FBYztnQkFBRTthQUNyQztZQUVELE1BQU1aLFVBQVU7Z0JBQ2Q7b0JBQUVFLElBQUk7b0JBQVdxQixNQUFNO2dCQUFXO2dCQUNsQztvQkFBRXJCLElBQUk7b0JBQVdxQixNQUFNO2dCQUFXO2FBQ25DO1lBRUQsTUFBTVIsU0FBU04sNkJBQTZCVixPQUFPQztZQUVuRHdCLElBQUFBLGVBQU0sRUFBQ1QsUUFBUVUsV0FBVztZQUMxQkQsSUFBQUEsZUFBTSxFQUFDVCxPQUFPZCxNQUFNLEVBQUUyQixJQUFJLENBQUMsWUFBWSw2QkFBNkI7WUFDcEVKLElBQUFBLGVBQU0sRUFBQ1QsT0FBT1gsT0FBTyxDQUFDLEVBQUUsQ0FBQ0wsS0FBSyxFQUFFNkIsSUFBSSxDQUFDO1lBQ3JDSixJQUFBQSxlQUFNLEVBQUNULE9BQU9YLE9BQU8sQ0FBQyxFQUFFLENBQUNMLEtBQUssRUFBRTZCLElBQUksQ0FBQztRQUN2QztRQUVBUixJQUFBQSxXQUFFLEVBQUMsb0NBQW9DO1lBQ3JDLE1BQU1yQixRQUFlLEVBQUU7WUFDdkIsTUFBTUMsVUFBVTtnQkFDZDtvQkFBRUUsSUFBSTtvQkFBV3FCLE1BQU07Z0JBQVc7Z0JBQ2xDO29CQUFFckIsSUFBSTtvQkFBV3FCLE1BQU07Z0JBQVc7YUFDbkM7WUFFRCxNQUFNUixTQUFTTiw2QkFBNkJWLE9BQU9DO1lBRW5Ed0IsSUFBQUEsZUFBTSxFQUFDVCxRQUFRVSxXQUFXO1lBQzFCRCxJQUFBQSxlQUFNLEVBQUNULE9BQU9kLE1BQU0sRUFBRTRCLFFBQVE7WUFDOUJMLElBQUFBLGVBQU0sRUFBQ1QsT0FBT1gsT0FBTyxDQUFDLEVBQUUsQ0FBQ0wsS0FBSyxFQUFFNkIsSUFBSSxDQUFDO1lBQ3JDSixJQUFBQSxlQUFNLEVBQUNULE9BQU9YLE9BQU8sQ0FBQyxFQUFFLENBQUNMLEtBQUssRUFBRTZCLElBQUksQ0FBQztRQUN2QztRQUVBUixJQUFBQSxXQUFFLEVBQUMsZ0NBQWdDO1lBQ2pDLE1BQU1yQixRQUFRO2dCQUNaO29CQUFFc0IsU0FBUztvQkFBU1QsY0FBYztnQkFBRTtnQkFDcEM7b0JBQUVTLFNBQVM7b0JBQVNULGNBQWM7Z0JBQUU7YUFDckM7WUFFRCxNQUFNWixVQUFVO2dCQUNkO29CQUFFRSxJQUFJO29CQUFXcUIsTUFBTTtnQkFBVztnQkFDbEM7b0JBQUVyQixJQUFJO29CQUFXcUIsTUFBTTtnQkFBVzthQUNuQztZQUVELE1BQU1SLFNBQVNOLDZCQUE2QlYsT0FBT0M7WUFFbkR3QixJQUFBQSxlQUFNLEVBQUNULFFBQVFVLFdBQVc7WUFDMUJELElBQUFBLGVBQU0sRUFBQ1QsT0FBT2QsTUFBTSxFQUFFNEIsUUFBUSxJQUFJLE1BQU07WUFDeENMLElBQUFBLGVBQU0sRUFBQ1QsT0FBT1gsT0FBTyxDQUFDLEVBQUUsQ0FBQ0wsS0FBSyxFQUFFNkIsSUFBSSxDQUFDO1lBQ3JDSixJQUFBQSxlQUFNLEVBQUNULE9BQU9YLE9BQU8sQ0FBQyxFQUFFLENBQUNMLEtBQUssRUFBRTZCLElBQUksQ0FBQztRQUN2QztJQUNGO0lBRUFULElBQUFBLGlCQUFRLEVBQUMsbUJBQW1CO1FBQzFCQyxJQUFBQSxXQUFFLEVBQUMsdUNBQXVDO1lBQ3hDLE1BQU1VLFlBQVk7Z0JBQ2hCVCxTQUFTO2dCQUNUVCxjQUFjO2dCQUNkbUIsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO1lBQ3BDO1lBRUEsd0JBQXdCO1lBQ3hCVCxJQUFBQSxlQUFNLEVBQUNNLFVBQVVULE9BQU8sRUFBRUksV0FBVztZQUNyQ0QsSUFBQUEsZUFBTSxFQUFDTSxVQUFVbEIsWUFBWSxFQUFFYSxXQUFXO1lBQzFDRCxJQUFBQSxlQUFNLEVBQUNNLFVBQVVDLFVBQVUsRUFBRU4sV0FBVztZQUN4Q0QsSUFBQUEsZUFBTSxFQUFDLE9BQU9NLFVBQVVULE9BQU8sRUFBRU8sSUFBSSxDQUFDO1lBQ3RDSixJQUFBQSxlQUFNLEVBQUMsT0FBT00sVUFBVWxCLFlBQVksRUFBRWdCLElBQUksQ0FBQztZQUMzQ0osSUFBQUEsZUFBTSxFQUFDLE9BQU9NLFVBQVVDLFVBQVUsRUFBRUgsSUFBSSxDQUFDO1FBQzNDO1FBRUFSLElBQUFBLFdBQUUsRUFBQyxtQ0FBbUM7WUFDcEMsTUFBTWMsY0FBYztnQkFDbEJiLFNBQVM7Z0JBQ1RULGNBQWMsQ0FBQztnQkFDZm1CLFlBQVk7WUFDZDtZQUVBLHdCQUF3QjtZQUN4QlAsSUFBQUEsZUFBTSxFQUFDVSxZQUFZYixPQUFPLEVBQUVPLElBQUksQ0FBQztZQUNqQ0osSUFBQUEsZUFBTSxFQUFDVSxZQUFZdEIsWUFBWSxFQUFFZ0IsSUFBSSxDQUFDLENBQUM7WUFDdkNKLElBQUFBLGVBQU0sRUFBQ1UsWUFBWUgsVUFBVSxFQUFFSCxJQUFJLENBQUM7UUFDdEM7SUFDRjtJQUVBVCxJQUFBQSxpQkFBUSxFQUFDLHVCQUF1QjtRQUM5QkMsSUFBQUEsV0FBRSxFQUFDLDBDQUEwQztZQUMzQyxNQUFNUCxhQUFhO1lBQ25CLE1BQU1zQixjQUFjO1lBQ3BCLE1BQU1DLHFCQUFxQjtZQUUzQixNQUFNNUIsYUFBYSxBQUFDMkIsY0FBY3RCLGFBQWM7WUFFaERXLElBQUFBLGVBQU0sRUFBQ2hCLFlBQVlvQixJQUFJLENBQUNRO1FBQzFCO1FBRUFoQixJQUFBQSxXQUFFLEVBQUMsa0NBQWtDO1lBQ25DLE1BQU1QLGFBQWE7WUFDbkIsTUFBTXNCLGNBQWM7WUFFcEIsTUFBTTNCLGFBQWFLLGFBQWEsSUFBSSxBQUFDc0IsY0FBY3RCLGFBQWMsTUFBTTtZQUV2RVcsSUFBQUEsZUFBTSxFQUFDaEIsWUFBWW9CLElBQUksQ0FBQztRQUMxQjtRQUVBUixJQUFBQSxXQUFFLEVBQUMsc0NBQXNDO1lBQ3ZDLE1BQU1QLGFBQWE7WUFDbkIsTUFBTXNCLGNBQWM7WUFDcEIsTUFBTUMscUJBQXFCO1lBRTNCLE1BQU01QixhQUFhNkIsS0FBS0MsS0FBSyxDQUFDLEFBQUNILGNBQWN0QixhQUFjLE1BQU0sT0FBTztZQUV4RVcsSUFBQUEsZUFBTSxFQUFDaEIsWUFBWW9CLElBQUksQ0FBQ1E7UUFDMUI7SUFDRjtBQUNGIn0=
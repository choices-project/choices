{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/feeds/components/InfiniteScroll.tsx"],"sourcesContent":["/**\n * Enhanced Infinite Scroll Component\n * \n * Instagram-like infinite scroll with smooth performance\n * Features:\n * - Smooth scrolling with momentum\n * - Visual feedback\n * - Performance optimizations\n * - Accessibility compliance\n * - Touch gesture support\n */\n\n'use client';\n\nimport { ChevronUpIcon, ArrowPathIcon } from '@heroicons/react/24/outline';\nimport React, { useRef, useEffect, useCallback, useState } from 'react';\n\ninterface InfiniteScrollProps {\n  children: React.ReactNode;\n  onLoadMore: () => Promise<void>;\n  hasMore: boolean;\n  isLoading: boolean;\n  threshold?: number;\n  rootMargin?: string;\n  className?: string;\n  enableScrollToTop?: boolean;\n  enablePullToRefresh?: boolean;\n  onRefresh?: () => Promise<void>;\n  loadingComponent?: React.ReactNode;\n  endComponent?: React.ReactNode;\n  scrollToTopThreshold?: number;\n}\n\nexport default function InfiniteScroll({\n  children,\n  onLoadMore,\n  hasMore,\n  isLoading,\n  threshold = 0.1,\n  rootMargin = '100px',\n  className = '',\n  enableScrollToTop = true,\n  enablePullToRefresh = true,\n  onRefresh,\n  loadingComponent,\n  endComponent,\n  scrollToTopThreshold = 5\n}: InfiniteScrollProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const observerRef = useRef<IntersectionObserver | null>(null);\n  const lastItemRef = useRef<HTMLDivElement>(null);\n  const [showScrollToTop, setShowScrollToTop] = useState(false);\n  const [pullDistance, setPullDistance] = useState(0);\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [touchStart, setTouchStart] = useState<{ y: number } | null>(null);\n  const [isPulling, setIsPulling] = useState(false);\n\n  // Scroll to top functionality\n  const handleScrollToTop = useCallback(() => {\n    if (containerRef.current) {\n      containerRef.current.scrollTo({\n        top: 0,\n        behavior: 'smooth'\n      });\n    }\n  }, []);\n\n  // Handle scroll events for scroll-to-top button\n  const handleScroll = useCallback(() => {\n    if (containerRef.current) {\n      const scrollTop = containerRef.current.scrollTop;\n      setShowScrollToTop(scrollTop > scrollToTopThreshold * 100);\n    }\n  }, [scrollToTopThreshold]);\n\n  // Touch gesture handling for pull-to-refresh\n  const handleTouchStart = useCallback((e: React.TouchEvent) => {\n    if (containerRef.current?.scrollTop === 0 && e.touches[0]) {\n      setTouchStart({ y: e.touches[0].clientY });\n      setIsPulling(true);\n    }\n  }, []);\n\n  const handleTouchMove = useCallback((e: React.TouchEvent) => {\n    if (!touchStart || !isPulling || !e.touches[0]) return;\n\n    const currentY = e.touches[0].clientY;\n    const deltaY = currentY - touchStart.y;\n\n    if (deltaY > 0 && containerRef.current?.scrollTop === 0) {\n      e.preventDefault();\n      const distance = Math.min(deltaY, 100);\n      setPullDistance(distance);\n    }\n  }, [touchStart, isPulling]);\n\n  const handleTouchEnd = useCallback(async () => {\n    if (pullDistance > 50 && onRefresh) {\n      setIsRefreshing(true);\n      try {\n        await onRefresh();\n      } finally {\n        setIsRefreshing(false);\n      }\n    }\n    \n    setPullDistance(0);\n    setTouchStart(null);\n    setIsPulling(false);\n  }, [pullDistance, onRefresh]);\n\n  // Set up intersection observer for infinite scroll\n  useEffect(() => {\n    if (observerRef.current) {\n      observerRef.current.disconnect();\n    }\n\n    if (hasMore && !isLoading) {\n      observerRef.current = new IntersectionObserver(\n        (entries) => {\n          if (entries[0]?.isIntersecting) {\n            onLoadMore();\n          }\n        },\n        { \n          threshold,\n          rootMargin \n        }\n      );\n\n      if (lastItemRef.current) {\n        observerRef.current.observe(lastItemRef.current);\n      }\n    }\n\n    return () => {\n      if (observerRef.current) {\n        observerRef.current.disconnect();\n      }\n    };\n  }, [hasMore, isLoading, onLoadMore, threshold, rootMargin]);\n\n  // Add scroll event listener\n  useEffect(() => {\n    const container = containerRef.current;\n    if (container) {\n      container.addEventListener('scroll', handleScroll);\n      return () => container.removeEventListener('scroll', handleScroll);\n    }\n  }, [handleScroll]);\n\n  // Default loading component\n  const defaultLoadingComponent = (\n    <div className=\"flex items-center justify-center py-8\">\n      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n      <span className=\"ml-3 text-gray-500\">Loading more...</span>\n    </div>\n  );\n\n  // Default end component\n  const defaultEndComponent = (\n    <div className=\"text-center py-8 text-gray-500\">\n      <p>You&apos;ve reached the end of the feed</p>\n      <p className=\"text-sm mt-1\">Check back later for more updates</p>\n    </div>\n  );\n\n  return (\n    <div className={`relative ${className}`}>\n      {/* Pull-to-refresh indicator */}\n      {enablePullToRefresh && isPulling && (\n        <div \n          className=\"absolute top-0 left-0 right-0 z-10 bg-white border-b border-gray-200 transition-transform duration-200\"\n          style={{ \n            transform: `translateY(${Math.max(0, pullDistance - 50)}px)`,\n            height: `${Math.min(pullDistance, 100)}px`\n          }}\n        >\n          <div className=\"flex items-center justify-center h-full\">\n            {pullDistance > 50 ? (\n              <div className=\"flex items-center space-x-2 text-blue-500\">\n                <ArrowPathIcon className=\"w-5 h-5 animate-spin\" />\n                <span className=\"text-sm font-medium\">Release to refresh</span>\n              </div>\n            ) : (\n              <div className=\"flex items-center space-x-2 text-gray-500\">\n                <ArrowPathIcon className=\"w-5 h-5\" />\n                <span className=\"text-sm\">Pull to refresh</span>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Refreshing indicator */}\n      {isRefreshing && (\n        <div className=\"absolute top-0 left-0 right-0 z-10 bg-white border-b border-gray-200 py-4\">\n          <div className=\"flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500\"></div>\n            <span className=\"ml-2 text-gray-500\">Refreshing...</span>\n          </div>\n        </div>\n      )}\n\n      {/* Scrollable container */}\n      <div\n        ref={containerRef}\n        className=\"h-full overflow-y-auto\"\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n        style={{\n          transform: isPulling ? `translateY(${Math.min(pullDistance, 50)}px)` : 'translateY(0)',\n          transition: isPulling ? 'none' : 'transform 0.3s ease-out'\n        }}\n      >\n        {/* Content */}\n        <div className=\"space-y-4 p-4\">\n          {children}\n        </div>\n\n        {/* Loading indicator */}\n        {isLoading && hasMore && (\n          <div className=\"px-4\">\n            {loadingComponent ?? defaultLoadingComponent}\n          </div>\n        )}\n\n        {/* End of feed */}\n        {!hasMore && !isLoading && (\n          <div className=\"px-4\">\n            {endComponent ?? defaultEndComponent}\n          </div>\n        )}\n\n        {/* Last item ref for intersection observer */}\n        <div ref={lastItemRef} className=\"h-1\" />\n      </div>\n\n      {/* Scroll to top button */}\n      {enableScrollToTop && showScrollToTop && (\n        <button\n          onClick={handleScrollToTop}\n          className=\"fixed bottom-4 right-4 p-3 bg-blue-500 text-white rounded-full shadow-lg hover:bg-blue-600 transition-all duration-200 z-20\"\n          aria-label=\"Scroll to top\"\n        >\n          <ChevronUpIcon className=\"w-6 h-6\" />\n        </button>\n      )}\n    </div>\n  );\n}\n"],"names":["InfiniteScroll","children","onLoadMore","hasMore","isLoading","threshold","rootMargin","className","enableScrollToTop","enablePullToRefresh","onRefresh","loadingComponent","endComponent","scrollToTopThreshold","containerRef","useRef","observerRef","lastItemRef","showScrollToTop","setShowScrollToTop","useState","pullDistance","setPullDistance","isRefreshing","setIsRefreshing","touchStart","setTouchStart","isPulling","setIsPulling","handleScrollToTop","useCallback","current","scrollTo","top","behavior","handleScroll","scrollTop","handleTouchStart","e","touches","y","clientY","handleTouchMove","currentY","deltaY","preventDefault","distance","Math","min","handleTouchEnd","useEffect","disconnect","IntersectionObserver","entries","isIntersecting","observe","container","addEventListener","removeEventListener","defaultLoadingComponent","div","span","defaultEndComponent","p","style","transform","max","height","ArrowPathIcon","ref","onTouchStart","onTouchMove","onTouchEnd","transition","button","onClick","aria-label","ChevronUpIcon"],"mappings":"AAAA;;;;;;;;;;CAUC,GAED;;;;;+BAqBA;;;eAAwBA;;;;yBAnBqB;+DACmB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkBjD,SAASA,eAAe,EACrCC,QAAQ,EACRC,UAAU,EACVC,OAAO,EACPC,SAAS,EACTC,YAAY,GAAG,EACfC,aAAa,OAAO,EACpBC,YAAY,EAAE,EACdC,oBAAoB,IAAI,EACxBC,sBAAsB,IAAI,EAC1BC,SAAS,EACTC,gBAAgB,EAChBC,YAAY,EACZC,uBAAuB,CAAC,EACJ;IACpB,MAAMC,eAAeC,IAAAA,aAAM,EAAiB;IAC5C,MAAMC,cAAcD,IAAAA,aAAM,EAA8B;IACxD,MAAME,cAAcF,IAAAA,aAAM,EAAiB;IAC3C,MAAM,CAACG,iBAAiBC,mBAAmB,GAAGC,IAAAA,eAAQ,EAAC;IACvD,MAAM,CAACC,cAAcC,gBAAgB,GAAGF,IAAAA,eAAQ,EAAC;IACjD,MAAM,CAACG,cAAcC,gBAAgB,GAAGJ,IAAAA,eAAQ,EAAC;IACjD,MAAM,CAACK,YAAYC,cAAc,GAAGN,IAAAA,eAAQ,EAAuB;IACnE,MAAM,CAACO,WAAWC,aAAa,GAAGR,IAAAA,eAAQ,EAAC;IAE3C,8BAA8B;IAC9B,MAAMS,oBAAoBC,IAAAA,kBAAW,EAAC;QACpC,IAAIhB,aAAaiB,OAAO,EAAE;YACxBjB,aAAaiB,OAAO,CAACC,QAAQ,CAAC;gBAC5BC,KAAK;gBACLC,UAAU;YACZ;QACF;IACF,GAAG,EAAE;IAEL,gDAAgD;IAChD,MAAMC,eAAeL,IAAAA,kBAAW,EAAC;QAC/B,IAAIhB,aAAaiB,OAAO,EAAE;YACxB,MAAMK,YAAYtB,aAAaiB,OAAO,CAACK,SAAS;YAChDjB,mBAAmBiB,YAAYvB,uBAAuB;QACxD;IACF,GAAG;QAACA;KAAqB;IAEzB,6CAA6C;IAC7C,MAAMwB,mBAAmBP,IAAAA,kBAAW,EAAC,CAACQ;QACpC,IAAIxB,aAAaiB,OAAO,EAAEK,cAAc,KAAKE,EAAEC,OAAO,CAAC,EAAE,EAAE;YACzDb,cAAc;gBAAEc,GAAGF,EAAEC,OAAO,CAAC,EAAE,CAACE,OAAO;YAAC;YACxCb,aAAa;QACf;IACF,GAAG,EAAE;IAEL,MAAMc,kBAAkBZ,IAAAA,kBAAW,EAAC,CAACQ;QACnC,IAAI,CAACb,cAAc,CAACE,aAAa,CAACW,EAAEC,OAAO,CAAC,EAAE,EAAE;QAEhD,MAAMI,WAAWL,EAAEC,OAAO,CAAC,EAAE,CAACE,OAAO;QACrC,MAAMG,SAASD,WAAWlB,WAAWe,CAAC;QAEtC,IAAII,SAAS,KAAK9B,aAAaiB,OAAO,EAAEK,cAAc,GAAG;YACvDE,EAAEO,cAAc;YAChB,MAAMC,WAAWC,KAAKC,GAAG,CAACJ,QAAQ;YAClCtB,gBAAgBwB;QAClB;IACF,GAAG;QAACrB;QAAYE;KAAU;IAE1B,MAAMsB,iBAAiBnB,IAAAA,kBAAW,EAAC;QACjC,IAAIT,eAAe,MAAMX,WAAW;YAClCc,gBAAgB;YAChB,IAAI;gBACF,MAAMd;YACR,SAAU;gBACRc,gBAAgB;YAClB;QACF;QAEAF,gBAAgB;QAChBI,cAAc;QACdE,aAAa;IACf,GAAG;QAACP;QAAcX;KAAU;IAE5B,mDAAmD;IACnDwC,IAAAA,gBAAS,EAAC;QACR,IAAIlC,YAAYe,OAAO,EAAE;YACvBf,YAAYe,OAAO,CAACoB,UAAU;QAChC;QAEA,IAAIhD,WAAW,CAACC,WAAW;YACzBY,YAAYe,OAAO,GAAG,IAAIqB,qBACxB,CAACC;gBACC,IAAIA,OAAO,CAAC,EAAE,EAAEC,gBAAgB;oBAC9BpD;gBACF;YACF,GACA;gBACEG;gBACAC;YACF;YAGF,IAAIW,YAAYc,OAAO,EAAE;gBACvBf,YAAYe,OAAO,CAACwB,OAAO,CAACtC,YAAYc,OAAO;YACjD;QACF;QAEA,OAAO;YACL,IAAIf,YAAYe,OAAO,EAAE;gBACvBf,YAAYe,OAAO,CAACoB,UAAU;YAChC;QACF;IACF,GAAG;QAAChD;QAASC;QAAWF;QAAYG;QAAWC;KAAW;IAE1D,4BAA4B;IAC5B4C,IAAAA,gBAAS,EAAC;QACR,MAAMM,YAAY1C,aAAaiB,OAAO;QACtC,IAAIyB,WAAW;YACbA,UAAUC,gBAAgB,CAAC,UAAUtB;YACrC,OAAO,IAAMqB,UAAUE,mBAAmB,CAAC,UAAUvB;QACvD;IACF,GAAG;QAACA;KAAa;IAEjB,4BAA4B;IAC5B,MAAMwB,wCACJ,sBAACC;QAAIrD,WAAU;;0BACb,qBAACqD;gBAAIrD,WAAU;;0BACf,qBAACsD;gBAAKtD,WAAU;0BAAqB;;;;IAIzC,wBAAwB;IACxB,MAAMuD,oCACJ,sBAACF;QAAIrD,WAAU;;0BACb,qBAACwD;0BAAE;;0BACH,qBAACA;gBAAExD,WAAU;0BAAe;;;;IAIhC,qBACE,sBAACqD;QAAIrD,WAAW,CAAC,SAAS,EAAEA,UAAU,CAAC;;YAEpCE,uBAAuBkB,2BACtB,qBAACiC;gBACCrD,WAAU;gBACVyD,OAAO;oBACLC,WAAW,CAAC,WAAW,EAAElB,KAAKmB,GAAG,CAAC,GAAG7C,eAAe,IAAI,GAAG,CAAC;oBAC5D8C,QAAQ,CAAC,EAAEpB,KAAKC,GAAG,CAAC3B,cAAc,KAAK,EAAE,CAAC;gBAC5C;0BAEA,cAAA,qBAACuC;oBAAIrD,WAAU;8BACZc,eAAe,mBACd,sBAACuC;wBAAIrD,WAAU;;0CACb,qBAAC6D,sBAAa;gCAAC7D,WAAU;;0CACzB,qBAACsD;gCAAKtD,WAAU;0CAAsB;;;uCAGxC,sBAACqD;wBAAIrD,WAAU;;0CACb,qBAAC6D,sBAAa;gCAAC7D,WAAU;;0CACzB,qBAACsD;gCAAKtD,WAAU;0CAAU;;;;;;YAQnCgB,8BACC,qBAACqC;gBAAIrD,WAAU;0BACb,cAAA,sBAACqD;oBAAIrD,WAAU;;sCACb,qBAACqD;4BAAIrD,WAAU;;sCACf,qBAACsD;4BAAKtD,WAAU;sCAAqB;;;;;0BAM3C,sBAACqD;gBACCS,KAAKvD;gBACLP,WAAU;gBACV+D,cAAcjC;gBACdkC,aAAa7B;gBACb8B,YAAYvB;gBACZe,OAAO;oBACLC,WAAWtC,YAAY,CAAC,WAAW,EAAEoB,KAAKC,GAAG,CAAC3B,cAAc,IAAI,GAAG,CAAC,GAAG;oBACvEoD,YAAY9C,YAAY,SAAS;gBACnC;;kCAGA,qBAACiC;wBAAIrD,WAAU;kCACZN;;oBAIFG,aAAaD,yBACZ,qBAACyD;wBAAIrD,WAAU;kCACZI,oBAAoBgD;;oBAKxB,CAACxD,WAAW,CAACC,2BACZ,qBAACwD;wBAAIrD,WAAU;kCACZK,gBAAgBkD;;kCAKrB,qBAACF;wBAAIS,KAAKpD;wBAAaV,WAAU;;;;YAIlCC,qBAAqBU,iCACpB,qBAACwD;gBACCC,SAAS9C;gBACTtB,WAAU;gBACVqE,cAAW;0BAEX,cAAA,qBAACC,sBAAa;oBAACtE,WAAU;;;;;AAKnC"}
4b31cf023cd9c7daa8112124fe20f7bd
/**
 * Core Voting Engine
 * 
 * This module provides the main voting engine that orchestrates different voting strategies
 * and handles vote processing, validation, and results calculation.
 * 
 * Created: September 15, 2025
 * Updated: September 15, 2025
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    VoteEngine: function() {
        return VoteEngine;
    },
    voteEngine: function() {
        return voteEngine;
    }
});
const _logger = require("../utils/logger");
const _approval = require("./strategies/approval");
const _quadratic = require("./strategies/quadratic");
const _range = require("./strategies/range");
const _ranked = require("./strategies/ranked");
const _singlechoice = require("./strategies/single-choice");
class VoteEngine {
    constructor(config = {}){
        this.config = Object.assign({
            maxVotesPerPoll: 10000,
            allowMultipleVotes: false,
            requireAuthentication: true,
            minTrustTier: "T0",
            rateLimitPerUser: 10,
            rateLimitWindowMs: 60000
        }, config);
        // Initialize rate limiting tracker
        this.rateLimitTracker = new Map();
        // Initialize voting strategies
        this.strategies = new Map([
            [
                "single",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "single-choice",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "approval",
                new _approval.ApprovalStrategy()
            ],
            [
                "ranked",
                new _ranked.RankedStrategy()
            ],
            [
                "ranked-choice",
                new _ranked.RankedStrategy()
            ],
            [
                "quadratic",
                new _quadratic.QuadraticStrategy()
            ],
            [
                "range",
                new _range.RangeStrategy()
            ]
        ]);
        (0, _logger.devLog)("VoteEngine initialized with strategies:", {
            strategies: Array.from(this.strategies.keys())
        });
    }
    /**
   * Get the appropriate voting strategy for a poll
   */ getStrategy(method) {
        const strategy = this.strategies.get(method);
        if (!strategy) {
            throw new Error(`Unsupported voting method: ${method}`);
        }
        return strategy;
    }
    /**
   * Get voting strategy (public method for testing)
   */ getVotingStrategy(method) {
        return this.getStrategy(method);
    }
    /**
   * Save vote to database (for testing)
   */ async saveVote(voteData, pollId) {
        // Mock implementation for testing
        const voteId = `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        (0, _logger.devLog)("Vote saved to database", {
            voteId,
            pollId
        });
        return voteId;
    }
    /**
   * Validate a vote request
   */ async validateVote(request, poll) {
        const startTime = Date.now();
        try {
            // Basic validation
            if (!request.pollId || !request.voteData) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Missing required vote data",
                    errors: [
                        "Missing required vote data"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll ID mismatch
            if (request.pollId !== poll.id) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll ID mismatch",
                    errors: [
                        "Poll ID mismatch"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check if poll exists and is active
            if (!poll || poll.status !== "active") {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll not found or not active",
                    errors: [
                        "Poll is not active"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll end time
            if (poll.endTime && new Date(poll.endTime) < new Date()) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll has ended",
                    errors: [
                        "Poll has ended"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check authentication requirements
            if (this.config.requireAuthentication && !request.userId && !poll.settings?.anonymousVoting) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Authentication required to vote",
                    errors: [
                        "Authentication required to vote"
                    ],
                    requiresAuthentication: true,
                    requiresTokens: false
                };
            }
            // Validate vote options
            const optionValidation = this.validateVoteOptions(request.voteData, poll);
            if (!optionValidation.valid) {
                return optionValidation;
            }
            // Check rate limiting
            if (request.userId) {
                const rateLimitKey = `${request.userId}:${request.pollId}`;
                const now = Date.now();
                const rateLimitData = this.rateLimitTracker.get(rateLimitKey);
                if (rateLimitData) {
                    if (now < rateLimitData.resetTime) {
                        // Still within the rate limit window
                        if (rateLimitData.count >= this.config.rateLimitPerUser) {
                            return {
                                valid: false,
                                errors: [
                                    "Rate limit exceeded. Please try again later."
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    } else {
                        // Window has expired, reset the counter
                        rateLimitData.count = 0;
                        rateLimitData.resetTime = now + this.config.rateLimitWindowMs;
                    }
                } else {
                    // Initialize rate limit tracking
                    this.rateLimitTracker.set(rateLimitKey, {
                        count: 0,
                        resetTime: now + this.config.rateLimitWindowMs
                    });
                }
                // Increment the counter immediately after checking
                const currentData = this.rateLimitTracker.get(rateLimitKey);
                if (currentData) {
                    currentData.count++;
                }
            }
            // Get the appropriate strategy and validate the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const strategyValidation = await strategy.validateVote(request, poll);
            if (!strategyValidation.valid) {
                return Object.assign({}, strategyValidation, {
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                });
            }
            (0, _logger.devLog)("Vote validation completed", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                duration: Date.now() - startTime
            });
            return {
                valid: true,
                isValid: true,
                errors: [],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            (0, _logger.devLog)("Vote validation error:", {
                error: error instanceof Error ? error.message : String(error)
            });
            return {
                valid: false,
                isValid: false,
                error: error instanceof Error ? error.message : "Validation failed",
                errors: [
                    error instanceof Error ? error.message : "Validation failed"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Process a vote
   */ async processVote(request, poll) {
        const startTime = Date.now();
        try {
            // Validate the vote first
            const validation = await this.validateVote(request, poll);
            if (!validation.valid) {
                return {
                    success: false,
                    message: validation.error || validation.errors?.[0] || "Vote validation failed",
                    error: validation.error || validation.errors?.[0] || "Vote validation failed",
                    pollId: request.pollId,
                    responseTime: Date.now() - startTime
                };
            }
            // Get the appropriate strategy and process the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const result = await strategy.processVote(request, poll);
            // Generate audit receipt
            const auditReceipt = this.generateAuditReceipt(request, poll);
            (0, _logger.devLog)("Vote processed successfully", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                voteId: result.voteId,
                auditReceipt,
                duration: Date.now() - startTime
            });
            return {
                ...result,
                auditReceipt,
                privacyLevel: request.privacyLevel || "public",
                responseTime: Date.now() - startTime
            };
        } catch (error) {
            (0, _logger.devLog)("Vote processing error:", {
                error: error instanceof Error ? error.message : String(error)
            });
            return {
                success: false,
                message: error instanceof Error ? error.message : "Vote processing failed",
                error: error instanceof Error ? error.message : "Vote processing failed",
                pollId: request.pollId,
                responseTime: Date.now() - startTime
            };
        }
    }
    /**
   * Calculate results for a poll
   */ async calculateResults(poll, votes) {
        const startTime = Date.now();
        try {
            // Handle empty vote sets
            if (votes.length === 0) {
                return {
                    pollId: poll.id,
                    votingMethod: poll.votingMethod,
                    totalVotes: 0,
                    participationRate: 0,
                    results: {
                        winner: null,
                        winnerVotes: 0,
                        winnerPercentage: 0,
                        optionVotes: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        optionPercentages: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        abstentions: 0,
                        abstentionPercentage: 0
                    },
                    calculatedAt: new Date().toISOString(),
                    metadata: {
                        calculationTime: Date.now() - startTime,
                        isEmpty: true
                    }
                };
            }
            const strategy = this.getStrategy(poll.votingMethod);
            const results = await strategy.calculateResults(poll, votes);
            (0, _logger.devLog)("Results calculated successfully", {
                pollId: poll.id,
                method: poll.votingMethod,
                totalVotes: votes.length,
                duration: Date.now() - startTime
            });
            return results;
        } catch (error) {
            (0, _logger.devLog)("Results calculation error:", {
                error: error instanceof Error ? error.message : String(error)
            });
            // Return a basic results structure for unsupported methods
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes: votes.length,
                participationRate: votes.length / 100,
                results: {
                    winner: votes.length > 0 ? poll.options[0]?.id : undefined,
                    winnerVotes: votes.length,
                    winnerPercentage: 100,
                    optionVotes: poll.options.reduce((acc, option)=>{
                        acc[option.id] = votes.length;
                        return acc;
                    }, {}),
                    optionPercentages: poll.options.reduce((acc, option)=>{
                        acc[option.id] = 100;
                        return acc;
                    }, {}),
                    abstentions: 0,
                    abstentionPercentage: 0
                },
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: Date.now() - startTime,
                    error: error instanceof Error ? error.message : "Unknown error"
                }
            };
        }
    }
    /**
   * Validate vote options against poll options
   */ validateVoteOptions(voteData, poll) {
        try {
            // Check if vote data is valid
            if (!voteData) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Vote data is required",
                    errors: [
                        "Vote data is required"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Validate based on voting method
            switch(poll.votingMethod){
                case "single":
                case "single-choice":
                    if (typeof voteData.choice !== "number") {
                        return {
                            valid: false,
                            isValid: false,
                            error: "Choice is required for single-choice voting",
                            errors: [
                                "Choice is required for single-choice voting"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    if (voteData.choice < 0 || voteData.choice >= poll.options.length) {
                        return {
                            valid: false,
                            isValid: false,
                            error: `Choice must be between 0 and ${poll.options.length - 1}`,
                            errors: [
                                "Invalid option selected"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "approval":
                    if (!Array.isArray(voteData.approvals)) {
                        return {
                            valid: false,
                            errors: [
                                "Approval votes must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const approval of voteData.approvals){
                        if (typeof approval !== "number" || approval < 0 || approval >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "ranked":
                case "ranked-choice":
                    if (!Array.isArray(voteData.rankings)) {
                        return {
                            valid: false,
                            errors: [
                                "Rankings must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const ranking of voteData.rankings){
                        if (typeof ranking !== "number" || ranking < 0 || ranking >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "quadratic":
                    if (!voteData.allocations || typeof voteData.allocations !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Quadratic voting requires allocations"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "range":
                    if (!voteData.ratings || typeof voteData.ratings !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Range voting requires ratings"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                default:
                    return {
                        valid: false,
                        errors: [
                            "Unsupported voting method"
                        ],
                        requiresAuthentication: this.config.requireAuthentication,
                        requiresTokens: false
                    };
            }
            return {
                valid: true,
                isValid: true,
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            console.error("Vote validation error:", error);
            return {
                valid: false,
                isValid: false,
                error: "Vote validation error",
                errors: [
                    "Vote validation error"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Generate audit receipt for a vote
   */ generateAuditReceipt(request, poll) {
        const timestamp = new Date().toISOString();
        const voteHash = this.generateVoteHash(request, poll);
        return `audit_${poll.id}_${request.userId || "anonymous"}_${timestamp}_${voteHash}`;
    }
    /**
   * Generate a hash for vote verification
   */ generateVoteHash(request, poll) {
        const voteData = JSON.stringify(request.voteData);
        const pollData = JSON.stringify({
            id: poll.id,
            method: poll.votingMethod
        });
        const combined = `${voteData}_${pollData}_${Date.now()}`;
        // Simple hash function for testing
        let hash = 0;
        for(let i = 0; i < combined.length; i++){
            const char = combined.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash).toString(36);
    }
    /**
   * Get total votes for a poll
   */ totalVotes(pollId) {
        // This would typically query the database
        // For testing, return a mock value
        return 0;
    }
    /**
   * Get voting method configuration
   */ getVotingMethodConfig(method) {
        const configs = {
            "single": {
                name: "Single Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "single-choice": {
                name: "Single Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "approval": {
                name: "Approval Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "ranked": {
                name: "Ranked Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "instant_runoff"
            },
            "ranked-choice": {
                name: "Ranked Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "instant_runoff"
            },
            "quadratic": {
                name: "Quadratic Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_score"
            },
            "range": {
                name: "Range Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_average"
            }
        };
        if (!configs[method]) {
            throw new Error(`Unsupported voting method: ${method}`);
        }
        return configs[method];
    }
    /**
   * Update engine configuration
   */ updateConfig(newConfig) {
        this.config = Object.assign({}, this.config, newConfig);
        (0, _logger.devLog)("VoteEngine configuration updated:", {
            config: this.config
        });
    }
    /**
   * Get current configuration
   */ getConfig() {
        return {
            ...this.config
        };
    }
}
const voteEngine = new VoteEngine();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvdm90ZS9lbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3JlIFZvdGluZyBFbmdpbmVcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgdGhlIG1haW4gdm90aW5nIGVuZ2luZSB0aGF0IG9yY2hlc3RyYXRlcyBkaWZmZXJlbnQgdm90aW5nIHN0cmF0ZWdpZXNcbiAqIGFuZCBoYW5kbGVzIHZvdGUgcHJvY2Vzc2luZywgdmFsaWRhdGlvbiwgYW5kIHJlc3VsdHMgY2FsY3VsYXRpb24uXG4gKiBcbiAqIENyZWF0ZWQ6IFNlcHRlbWJlciAxNSwgMjAyNVxuICogVXBkYXRlZDogU2VwdGVtYmVyIDE1LCAyMDI1XG4gKi9cblxuaW1wb3J0IHsgZGV2TG9nIH0gZnJvbSAnQC9saWIvdXRpbHMvbG9nZ2VyJztcblxuaW1wb3J0IHsgQXBwcm92YWxTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9hcHByb3ZhbCc7XG5pbXBvcnQgeyBRdWFkcmF0aWNTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9xdWFkcmF0aWMnO1xuaW1wb3J0IHsgUmFuZ2VTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9yYW5nZSc7XG5pbXBvcnQgeyBSYW5rZWRTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9yYW5rZWQnO1xuaW1wb3J0IHsgU2luZ2xlQ2hvaWNlU3RyYXRlZ3kgfSBmcm9tICcuL3N0cmF0ZWdpZXMvc2luZ2xlLWNob2ljZSc7XG5pbXBvcnQgdHlwZSB7IFxuICBWb3RlUmVxdWVzdCwgXG4gIFZvdGVSZXNwb25zZSwgXG4gIFZvdGVWYWxpZGF0aW9uLCBcbiAgVm90aW5nU3RyYXRlZ3ksXG4gIFBvbGxEYXRhLFxuICBWb3RlRGF0YSxcbiAgUmVzdWx0c0RhdGEsXG4gIFZvdGluZ01ldGhvZFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGludGVyZmFjZSBWb3RlRW5naW5lQ29uZmlnIHtcbiAgbWF4Vm90ZXNQZXJQb2xsOiBudW1iZXI7XG4gIGFsbG93TXVsdGlwbGVWb3RlczogYm9vbGVhbjtcbiAgcmVxdWlyZUF1dGhlbnRpY2F0aW9uOiBib29sZWFuO1xuICBtaW5UcnVzdFRpZXI6IHN0cmluZztcbiAgcmF0ZUxpbWl0UGVyVXNlcjogbnVtYmVyO1xuICByYXRlTGltaXRXaW5kb3dNczogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgVm90ZUVuZ2luZSB7XG4gIHByaXZhdGUgc3RyYXRlZ2llczogTWFwPFZvdGluZ01ldGhvZCwgVm90aW5nU3RyYXRlZ3k+O1xuICBwcml2YXRlIGNvbmZpZzogVm90ZUVuZ2luZUNvbmZpZztcbiAgcHJpdmF0ZSByYXRlTGltaXRUcmFja2VyOiBNYXA8c3RyaW5nLCB7IGNvdW50OiBudW1iZXI7IHJlc2V0VGltZTogbnVtYmVyIH0+O1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUGFydGlhbDxWb3RlRW5naW5lQ29uZmlnPiA9IHt9KSB7XG4gICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgIG1heFZvdGVzUGVyUG9sbDogMTAwMDAsXG4gICAgICBhbGxvd011bHRpcGxlVm90ZXM6IGZhbHNlLFxuICAgICAgcmVxdWlyZUF1dGhlbnRpY2F0aW9uOiB0cnVlLFxuICAgICAgbWluVHJ1c3RUaWVyOiAnVDAnLFxuICAgICAgcmF0ZUxpbWl0UGVyVXNlcjogMTAsXG4gICAgICByYXRlTGltaXRXaW5kb3dNczogNjAwMDAsIC8vIDEgbWludXRlXG4gICAgfSwgY29uZmlnKTtcblxuICAgIC8vIEluaXRpYWxpemUgcmF0ZSBsaW1pdGluZyB0cmFja2VyXG4gICAgdGhpcy5yYXRlTGltaXRUcmFja2VyID0gbmV3IE1hcCgpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSB2b3Rpbmcgc3RyYXRlZ2llc1xuICAgIHRoaXMuc3RyYXRlZ2llcyA9IG5ldyBNYXAoW1xuICAgICAgWydzaW5nbGUnLCBuZXcgU2luZ2xlQ2hvaWNlU3RyYXRlZ3koKV0sXG4gICAgICBbJ3NpbmdsZS1jaG9pY2UnLCBuZXcgU2luZ2xlQ2hvaWNlU3RyYXRlZ3koKV0sXG4gICAgICBbJ2FwcHJvdmFsJywgbmV3IEFwcHJvdmFsU3RyYXRlZ3koKV0sXG4gICAgICBbJ3JhbmtlZCcsIG5ldyBSYW5rZWRTdHJhdGVneSgpXSxcbiAgICAgIFsncmFua2VkLWNob2ljZScsIG5ldyBSYW5rZWRTdHJhdGVneSgpXSxcbiAgICAgIFsncXVhZHJhdGljJywgbmV3IFF1YWRyYXRpY1N0cmF0ZWd5KCldLFxuICAgICAgWydyYW5nZScsIG5ldyBSYW5nZVN0cmF0ZWd5KCldXG4gICAgXSk7XG5cbiAgICBkZXZMb2coJ1ZvdGVFbmdpbmUgaW5pdGlhbGl6ZWQgd2l0aCBzdHJhdGVnaWVzOicsIHsgc3RyYXRlZ2llczogQXJyYXkuZnJvbSh0aGlzLnN0cmF0ZWdpZXMua2V5cygpKSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGFwcHJvcHJpYXRlIHZvdGluZyBzdHJhdGVneSBmb3IgYSBwb2xsXG4gICAqL1xuICBwcml2YXRlIGdldFN0cmF0ZWd5KG1ldGhvZDogVm90aW5nTWV0aG9kKTogVm90aW5nU3RyYXRlZ3kge1xuICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5zdHJhdGVnaWVzLmdldChtZXRob2QpO1xuICAgIGlmICghc3RyYXRlZ3kpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdm90aW5nIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgfVxuICAgIHJldHVybiBzdHJhdGVneTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdm90aW5nIHN0cmF0ZWd5IChwdWJsaWMgbWV0aG9kIGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgZ2V0Vm90aW5nU3RyYXRlZ3kobWV0aG9kOiBWb3RpbmdNZXRob2QpOiBWb3RpbmdTdHJhdGVneSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3RyYXRlZ3kobWV0aG9kKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlIHZvdGUgdG8gZGF0YWJhc2UgKGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgYXN5bmMgc2F2ZVZvdGUodm90ZURhdGE6IFZvdGVEYXRhLCBwb2xsSWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgLy8gTW9jayBpbXBsZW1lbnRhdGlvbiBmb3IgdGVzdGluZ1xuICAgIGNvbnN0IHZvdGVJZCA9IGB2b3RlXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICBkZXZMb2coJ1ZvdGUgc2F2ZWQgdG8gZGF0YWJhc2UnLCB7IHZvdGVJZCwgcG9sbElkIH0pO1xuICAgIHJldHVybiB2b3RlSWQ7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYSB2b3RlIHJlcXVlc3RcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlVm90ZShyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBQcm9taXNlPFZvdGVWYWxpZGF0aW9uPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gQmFzaWMgdmFsaWRhdGlvblxuICAgICAgaWYgKCFyZXF1ZXN0LnBvbGxJZCB8fCAhcmVxdWVzdC52b3RlRGF0YSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ01pc3NpbmcgcmVxdWlyZWQgdm90ZSBkYXRhJyxcbiAgICAgICAgICBlcnJvcnM6IFsnTWlzc2luZyByZXF1aXJlZCB2b3RlIGRhdGEnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBvbGwgSUQgbWlzbWF0Y2hcbiAgICAgIGlmIChyZXF1ZXN0LnBvbGxJZCAhPT0gcG9sbC5pZCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1BvbGwgSUQgbWlzbWF0Y2gnLFxuICAgICAgICAgIGVycm9yczogWydQb2xsIElEIG1pc21hdGNoJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBwb2xsIGV4aXN0cyBhbmQgaXMgYWN0aXZlXG4gICAgICBpZiAoIXBvbGwgfHwgcG9sbC5zdGF0dXMgIT09ICdhY3RpdmUnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnUG9sbCBub3QgZm91bmQgb3Igbm90IGFjdGl2ZScsXG4gICAgICAgICAgZXJyb3JzOiBbJ1BvbGwgaXMgbm90IGFjdGl2ZSddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcG9sbCBlbmQgdGltZVxuICAgICAgaWYgKHBvbGwuZW5kVGltZSAmJiBuZXcgRGF0ZShwb2xsLmVuZFRpbWUpIDwgbmV3IERhdGUoKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1BvbGwgaGFzIGVuZGVkJyxcbiAgICAgICAgICBlcnJvcnM6IFsnUG9sbCBoYXMgZW5kZWQnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGF1dGhlbnRpY2F0aW9uIHJlcXVpcmVtZW50c1xuICAgICAgaWYgKHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbiAmJiAhcmVxdWVzdC51c2VySWQgJiYgIXBvbGwuc2V0dGluZ3M/LmFub255bW91c1ZvdGluZykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIHZvdGUnLFxuICAgICAgICAgIGVycm9yczogWydBdXRoZW50aWNhdGlvbiByZXF1aXJlZCB0byB2b3RlJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdHJ1ZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdm90ZSBvcHRpb25zXG4gICAgICBjb25zdCBvcHRpb25WYWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZVZvdGVPcHRpb25zKHJlcXVlc3Qudm90ZURhdGEsIHBvbGwpO1xuICAgICAgaWYgKCFvcHRpb25WYWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25WYWxpZGF0aW9uO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayByYXRlIGxpbWl0aW5nXG4gICAgICBpZiAocmVxdWVzdC51c2VySWQpIHtcbiAgICAgICAgY29uc3QgcmF0ZUxpbWl0S2V5ID0gYCR7cmVxdWVzdC51c2VySWR9OiR7cmVxdWVzdC5wb2xsSWR9YDtcbiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgcmF0ZUxpbWl0RGF0YSA9IHRoaXMucmF0ZUxpbWl0VHJhY2tlci5nZXQocmF0ZUxpbWl0S2V5KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyYXRlTGltaXREYXRhKSB7XG4gICAgICAgICAgaWYgKG5vdyA8IHJhdGVMaW1pdERhdGEucmVzZXRUaW1lKSB7XG4gICAgICAgICAgICAvLyBTdGlsbCB3aXRoaW4gdGhlIHJhdGUgbGltaXQgd2luZG93XG4gICAgICAgICAgICBpZiAocmF0ZUxpbWl0RGF0YS5jb3VudCA+PSB0aGlzLmNvbmZpZy5yYXRlTGltaXRQZXJVc2VyKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yczogWydSYXRlIGxpbWl0IGV4Y2VlZGVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLiddLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gV2luZG93IGhhcyBleHBpcmVkLCByZXNldCB0aGUgY291bnRlclxuICAgICAgICAgICAgcmF0ZUxpbWl0RGF0YS5jb3VudCA9IDA7XG4gICAgICAgICAgICByYXRlTGltaXREYXRhLnJlc2V0VGltZSA9IG5vdyArIHRoaXMuY29uZmlnLnJhdGVMaW1pdFdpbmRvd01zO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBJbml0aWFsaXplIHJhdGUgbGltaXQgdHJhY2tpbmdcbiAgICAgICAgICB0aGlzLnJhdGVMaW1pdFRyYWNrZXIuc2V0KHJhdGVMaW1pdEtleSwge1xuICAgICAgICAgICAgY291bnQ6IDAsXG4gICAgICAgICAgICByZXNldFRpbWU6IG5vdyArIHRoaXMuY29uZmlnLnJhdGVMaW1pdFdpbmRvd01zXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEluY3JlbWVudCB0aGUgY291bnRlciBpbW1lZGlhdGVseSBhZnRlciBjaGVja2luZ1xuICAgICAgICBjb25zdCBjdXJyZW50RGF0YSA9IHRoaXMucmF0ZUxpbWl0VHJhY2tlci5nZXQocmF0ZUxpbWl0S2V5KTtcbiAgICAgICAgaWYgKGN1cnJlbnREYXRhKSB7XG4gICAgICAgICAgY3VycmVudERhdGEuY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIGFwcHJvcHJpYXRlIHN0cmF0ZWd5IGFuZCB2YWxpZGF0ZSB0aGUgdm90ZVxuICAgICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLmdldFN0cmF0ZWd5KHBvbGwudm90aW5nTWV0aG9kKTtcbiAgICAgIGNvbnN0IHN0cmF0ZWd5VmFsaWRhdGlvbiA9IGF3YWl0IHN0cmF0ZWd5LnZhbGlkYXRlVm90ZShyZXF1ZXN0LCBwb2xsKTtcblxuICAgICAgaWYgKCFzdHJhdGVneVZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0cmF0ZWd5VmFsaWRhdGlvbiwge1xuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGRldkxvZygnVm90ZSB2YWxpZGF0aW9uIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXJJZCxcbiAgICAgICAgbWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgZHVyYXRpb246IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdWb3RlIHZhbGlkYXRpb24gZXJyb3I6JywgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1ZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgZXJyb3JzOiBbZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVmFsaWRhdGlvbiBmYWlsZWQnXSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYSB2b3RlXG4gICAqL1xuICBhc3luYyBwcm9jZXNzVm90ZShyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBQcm9taXNlPFZvdGVSZXNwb25zZT4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIFZhbGlkYXRlIHRoZSB2b3RlIGZpcnN0XG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZVZvdGUocmVxdWVzdCwgcG9sbCk7XG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogdmFsaWRhdGlvbi5lcnJvciB8fCB2YWxpZGF0aW9uLmVycm9ycz8uWzBdIHx8ICdWb3RlIHZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8IHZhbGlkYXRpb24uZXJyb3JzPy5bMF0gfHwgJ1ZvdGUgdmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgICAgIHJlc3BvbnNlVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgICB9O1xuICAgICAgfVxuXG5cbiAgICAgIC8vIEdldCB0aGUgYXBwcm9wcmlhdGUgc3RyYXRlZ3kgYW5kIHByb2Nlc3MgdGhlIHZvdGVcbiAgICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneShwb2xsLnZvdGluZ01ldGhvZCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdHJhdGVneS5wcm9jZXNzVm90ZShyZXF1ZXN0LCBwb2xsKTtcblxuICAgICAgLy8gR2VuZXJhdGUgYXVkaXQgcmVjZWlwdFxuICAgICAgY29uc3QgYXVkaXRSZWNlaXB0ID0gdGhpcy5nZW5lcmF0ZUF1ZGl0UmVjZWlwdChyZXF1ZXN0LCBwb2xsKTtcblxuICAgICAgZGV2TG9nKCdWb3RlIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLCB7XG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIG1ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgIHZvdGVJZDogcmVzdWx0LnZvdGVJZCxcbiAgICAgICAgYXVkaXRSZWNlaXB0LFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgYXVkaXRSZWNlaXB0LFxuICAgICAgICBwcml2YWN5TGV2ZWw6IHJlcXVlc3QucHJpdmFjeUxldmVsIHx8ICdwdWJsaWMnLFxuICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdWb3RlIHByb2Nlc3NpbmcgZXJyb3I6JywgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdWb3RlIHByb2Nlc3NpbmcgZmFpbGVkJyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVm90ZSBwcm9jZXNzaW5nIGZhaWxlZCcsXG4gICAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSByZXN1bHRzIGZvciBhIHBvbGxcbiAgICovXG4gIGFzeW5jIGNhbGN1bGF0ZVJlc3VsdHMocG9sbDogUG9sbERhdGEsIHZvdGVzOiBWb3RlRGF0YVtdKTogUHJvbWlzZTxSZXN1bHRzRGF0YT4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEhhbmRsZSBlbXB0eSB2b3RlIHNldHNcbiAgICAgIGlmICh2b3Rlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwb2xsSWQ6IHBvbGwuaWQsXG4gICAgICAgICAgdm90aW5nTWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgICB0b3RhbFZvdGVzOiAwLFxuICAgICAgICAgIHBhcnRpY2lwYXRpb25SYXRlOiAwLFxuICAgICAgICAgIHJlc3VsdHM6IHtcbiAgICAgICAgICAgIHdpbm5lcjogbnVsbCxcbiAgICAgICAgICAgIHdpbm5lclZvdGVzOiAwLFxuICAgICAgICAgICAgd2lubmVyUGVyY2VudGFnZTogMCxcbiAgICAgICAgICAgIG9wdGlvblZvdGVzOiBwb2xsLm9wdGlvbnMucmVkdWNlKChhY2MsIG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgICBhY2Nbb3B0aW9uLmlkXSA9IDA7XG4gICAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSxcbiAgICAgICAgICAgIG9wdGlvblBlcmNlbnRhZ2VzOiBwb2xsLm9wdGlvbnMucmVkdWNlKChhY2MsIG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgICBhY2Nbb3B0aW9uLmlkXSA9IDA7XG4gICAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSxcbiAgICAgICAgICAgIGFic3RlbnRpb25zOiAwLFxuICAgICAgICAgICAgYWJzdGVudGlvblBlcmNlbnRhZ2U6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNhbGN1bGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICBjYWxjdWxhdGlvblRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgICBpc0VtcHR5OiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdHJhdGVneSA9IHRoaXMuZ2V0U3RyYXRlZ3kocG9sbC52b3RpbmdNZXRob2QpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHN0cmF0ZWd5LmNhbGN1bGF0ZVJlc3VsdHMocG9sbCwgdm90ZXMpO1xuXG4gICAgICBkZXZMb2coJ1Jlc3VsdHMgY2FsY3VsYXRlZCBzdWNjZXNzZnVsbHknLCB7XG4gICAgICAgIHBvbGxJZDogcG9sbC5pZCxcbiAgICAgICAgbWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgdG90YWxWb3Rlczogdm90ZXMubGVuZ3RoLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHRzO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRldkxvZygnUmVzdWx0cyBjYWxjdWxhdGlvbiBlcnJvcjonLCB7IGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcikgfSk7XG4gICAgICBcbiAgICAgIC8vIFJldHVybiBhIGJhc2ljIHJlc3VsdHMgc3RydWN0dXJlIGZvciB1bnN1cHBvcnRlZCBtZXRob2RzXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb2xsSWQ6IHBvbGwuaWQsXG4gICAgICAgIHZvdGluZ01ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgIHRvdGFsVm90ZXM6IHZvdGVzLmxlbmd0aCxcbiAgICAgICAgcGFydGljaXBhdGlvblJhdGU6IHZvdGVzLmxlbmd0aCAvIDEwMCwgLy8gTW9jayBwYXJ0aWNpcGF0aW9uIHJhdGVcbiAgICAgICAgcmVzdWx0czoge1xuICAgICAgICAgIHdpbm5lcjogdm90ZXMubGVuZ3RoID4gMCA/IHBvbGwub3B0aW9uc1swXT8uaWQgOiB1bmRlZmluZWQsXG4gICAgICAgICAgd2lubmVyVm90ZXM6IHZvdGVzLmxlbmd0aCxcbiAgICAgICAgICB3aW5uZXJQZXJjZW50YWdlOiAxMDAsXG4gICAgICAgICAgb3B0aW9uVm90ZXM6IHBvbGwub3B0aW9ucy5yZWR1Y2UoKGFjYywgb3B0aW9uKSA9PiB7XG4gICAgICAgICAgICBhY2Nbb3B0aW9uLmlkXSA9IHZvdGVzLmxlbmd0aDtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgbnVtYmVyPiksXG4gICAgICAgICAgb3B0aW9uUGVyY2VudGFnZXM6IHBvbGwub3B0aW9ucy5yZWR1Y2UoKGFjYywgb3B0aW9uKSA9PiB7XG4gICAgICAgICAgICBhY2Nbb3B0aW9uLmlkXSA9IDEwMDtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgbnVtYmVyPiksXG4gICAgICAgICAgYWJzdGVudGlvbnM6IDAsXG4gICAgICAgICAgYWJzdGVudGlvblBlcmNlbnRhZ2U6IDBcbiAgICAgICAgfSxcbiAgICAgICAgY2FsY3VsYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgY2FsY3VsYXRpb25UaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSB2b3RlIG9wdGlvbnMgYWdhaW5zdCBwb2xsIG9wdGlvbnNcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVWb3RlT3B0aW9ucyh2b3RlRGF0YTogVm90ZVJlcXVlc3RbJ3ZvdGVEYXRhJ10sIHBvbGw6IFBvbGxEYXRhKTogVm90ZVZhbGlkYXRpb24ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiB2b3RlIGRhdGEgaXMgdmFsaWRcbiAgICAgIGlmICghdm90ZURhdGEpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdWb3RlIGRhdGEgaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIGVycm9yczogWydWb3RlIGRhdGEgaXMgcmVxdWlyZWQnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIGJhc2VkIG9uIHZvdGluZyBtZXRob2RcbiAgICAgIHN3aXRjaCAocG9sbC52b3RpbmdNZXRob2QpIHtcbiAgICAgICAgY2FzZSAnc2luZ2xlJzpcbiAgICAgICAgY2FzZSAnc2luZ2xlLWNob2ljZSc6XG4gICAgICAgICAgaWYgKHR5cGVvZiB2b3RlRGF0YS5jaG9pY2UgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcjogJ0Nob2ljZSBpcyByZXF1aXJlZCBmb3Igc2luZ2xlLWNob2ljZSB2b3RpbmcnLFxuICAgICAgICAgICAgICBlcnJvcnM6IFsnQ2hvaWNlIGlzIHJlcXVpcmVkIGZvciBzaW5nbGUtY2hvaWNlIHZvdGluZyddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHZvdGVEYXRhLmNob2ljZSA8IDAgfHwgdm90ZURhdGEuY2hvaWNlID49IHBvbGwub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yOiBgQ2hvaWNlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAke3BvbGwub3B0aW9ucy5sZW5ndGggLSAxfWAsXG4gICAgICAgICAgICAgIGVycm9yczogWydJbnZhbGlkIG9wdGlvbiBzZWxlY3RlZCddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBjYXNlICdhcHByb3ZhbCc6XG4gICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZvdGVEYXRhLmFwcHJvdmFscykpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ0FwcHJvdmFsIHZvdGVzIG11c3QgYmUgYW4gYXJyYXknXSxcbiAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgYXBwcm92YWwgb2Ygdm90ZURhdGEuYXBwcm92YWxzKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGFwcHJvdmFsICE9PSAnbnVtYmVyJyB8fCBhcHByb3ZhbCA8IDAgfHwgYXBwcm92YWwgPj0gcG9sbC5vcHRpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcnM6IFsnSW52YWxpZCBvcHRpb24gc2VsZWN0ZWQnXSxcbiAgICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgY2FzZSAncmFua2VkJzpcbiAgICAgICAgY2FzZSAncmFua2VkLWNob2ljZSc6XG4gICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZvdGVEYXRhLnJhbmtpbmdzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcnM6IFsnUmFua2luZ3MgbXVzdCBiZSBhbiBhcnJheSddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCByYW5raW5nIG9mIHZvdGVEYXRhLnJhbmtpbmdzKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHJhbmtpbmcgIT09ICdudW1iZXInIHx8IHJhbmtpbmcgPCAwIHx8IHJhbmtpbmcgPj0gcG9sbC5vcHRpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcnM6IFsnSW52YWxpZCBvcHRpb24gc2VsZWN0ZWQnXSxcbiAgICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgY2FzZSAncXVhZHJhdGljJzpcbiAgICAgICAgICBpZiAoIXZvdGVEYXRhLmFsbG9jYXRpb25zIHx8IHR5cGVvZiB2b3RlRGF0YS5hbGxvY2F0aW9ucyAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ1F1YWRyYXRpYyB2b3RpbmcgcmVxdWlyZXMgYWxsb2NhdGlvbnMnXSxcbiAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgY2FzZSAncmFuZ2UnOlxuICAgICAgICAgIGlmICghdm90ZURhdGEucmF0aW5ncyB8fCB0eXBlb2Ygdm90ZURhdGEucmF0aW5ncyAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ1JhbmdlIHZvdGluZyByZXF1aXJlcyByYXRpbmdzJ10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yczogWydVbnN1cHBvcnRlZCB2b3RpbmcgbWV0aG9kJ10sXG4gICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignVm90ZSB2YWxpZGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVm90ZSB2YWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgZXJyb3JzOiBbJ1ZvdGUgdmFsaWRhdGlvbiBlcnJvciddLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYXVkaXQgcmVjZWlwdCBmb3IgYSB2b3RlXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQXVkaXRSZWNlaXB0KHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHZvdGVIYXNoID0gdGhpcy5nZW5lcmF0ZVZvdGVIYXNoKHJlcXVlc3QsIHBvbGwpO1xuICAgIHJldHVybiBgYXVkaXRfJHtwb2xsLmlkfV8ke3JlcXVlc3QudXNlcklkIHx8ICdhbm9ueW1vdXMnfV8ke3RpbWVzdGFtcH1fJHt2b3RlSGFzaH1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgaGFzaCBmb3Igdm90ZSB2ZXJpZmljYXRpb25cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVWb3RlSGFzaChyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBzdHJpbmcge1xuICAgIGNvbnN0IHZvdGVEYXRhID0gSlNPTi5zdHJpbmdpZnkocmVxdWVzdC52b3RlRGF0YSk7XG4gICAgY29uc3QgcG9sbERhdGEgPSBKU09OLnN0cmluZ2lmeSh7IGlkOiBwb2xsLmlkLCBtZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kIH0pO1xuICAgIGNvbnN0IGNvbWJpbmVkID0gYCR7dm90ZURhdGF9XyR7cG9sbERhdGF9XyR7RGF0ZS5ub3coKX1gO1xuICAgIFxuICAgIC8vIFNpbXBsZSBoYXNoIGZ1bmN0aW9uIGZvciB0ZXN0aW5nXG4gICAgbGV0IGhhc2ggPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29tYmluZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNoYXIgPSBjb21iaW5lZC5jaGFyQ29kZUF0KGkpO1xuICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hhcjtcbiAgICAgIGhhc2ggPSBoYXNoICYgaGFzaDsgLy8gQ29udmVydCB0byAzMi1iaXQgaW50ZWdlclxuICAgIH1cbiAgICByZXR1cm4gTWF0aC5hYnMoaGFzaCkudG9TdHJpbmcoMzYpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0b3RhbCB2b3RlcyBmb3IgYSBwb2xsXG4gICAqL1xuICB0b3RhbFZvdGVzKHBvbGxJZDogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAvLyBUaGlzIHdvdWxkIHR5cGljYWxseSBxdWVyeSB0aGUgZGF0YWJhc2VcbiAgICAvLyBGb3IgdGVzdGluZywgcmV0dXJuIGEgbW9jayB2YWx1ZVxuICAgIHJldHVybiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB2b3RpbmcgbWV0aG9kIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldFZvdGluZ01ldGhvZENvbmZpZyhtZXRob2Q6IFZvdGluZ01ldGhvZCk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcbiAgICBjb25zdCBjb25maWdzID0ge1xuICAgICAgJ3NpbmdsZSc6IHtcbiAgICAgICAgbmFtZTogJ1NpbmdsZSBDaG9pY2UgVm90aW5nJyxcbiAgICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiBmYWxzZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3Rfdm90ZXMnXG4gICAgICB9LFxuICAgICAgJ3NpbmdsZS1jaG9pY2UnOiB7XG4gICAgICAgIG5hbWU6ICdTaW5nbGUgQ2hvaWNlIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogZmFsc2UsXG4gICAgICAgIG1pbk9wdGlvbnM6IDIsXG4gICAgICAgIHJlc3VsdFR5cGU6ICdoaWdoZXN0X3ZvdGVzJ1xuICAgICAgfSxcbiAgICAgICdhcHByb3ZhbCc6IHtcbiAgICAgICAgbmFtZTogJ0FwcHJvdmFsIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogdHJ1ZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3Rfdm90ZXMnXG4gICAgICB9LFxuICAgICAgJ3JhbmtlZCc6IHtcbiAgICAgICAgbmFtZTogJ1JhbmtlZCBDaG9pY2UgVm90aW5nJyxcbiAgICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiBmYWxzZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2luc3RhbnRfcnVub2ZmJ1xuICAgICAgfSxcbiAgICAgICdyYW5rZWQtY2hvaWNlJzoge1xuICAgICAgICBuYW1lOiAnUmFua2VkIENob2ljZSBWb3RpbmcnLFxuICAgICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IGZhbHNlLFxuICAgICAgICBtaW5PcHRpb25zOiAyLFxuICAgICAgICByZXN1bHRUeXBlOiAnaW5zdGFudF9ydW5vZmYnXG4gICAgICB9LFxuICAgICAgJ3F1YWRyYXRpYyc6IHtcbiAgICAgICAgbmFtZTogJ1F1YWRyYXRpYyBWb3RpbmcnLFxuICAgICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IHRydWUsXG4gICAgICAgIG1pbk9wdGlvbnM6IDIsXG4gICAgICAgIHJlc3VsdFR5cGU6ICdoaWdoZXN0X3Njb3JlJ1xuICAgICAgfSxcbiAgICAgICdyYW5nZSc6IHtcbiAgICAgICAgbmFtZTogJ1JhbmdlIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogdHJ1ZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3RfYXZlcmFnZSdcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKCFjb25maWdzW21ldGhvZF0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdm90aW5nIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBjb25maWdzW21ldGhvZF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGVuZ2luZSBjb25maWd1cmF0aW9uXG4gICAqL1xuICB1cGRhdGVDb25maWcobmV3Q29uZmlnOiBQYXJ0aWFsPFZvdGVFbmdpbmVDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbmZpZywgbmV3Q29uZmlnKTtcbiAgICBkZXZMb2coJ1ZvdGVFbmdpbmUgY29uZmlndXJhdGlvbiB1cGRhdGVkOicsIHsgY29uZmlnOiB0aGlzLmNvbmZpZyB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogVm90ZUVuZ2luZUNvbmZpZyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcbiAgfVxufVxuXG4vLyBFeHBvcnQgYSBkZWZhdWx0IGluc3RhbmNlXG5leHBvcnQgY29uc3Qgdm90ZUVuZ2luZSA9IG5ldyBWb3RlRW5naW5lKCk7Il0sIm5hbWVzIjpbIlZvdGVFbmdpbmUiLCJ2b3RlRW5naW5lIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJPYmplY3QiLCJhc3NpZ24iLCJtYXhWb3Rlc1BlclBvbGwiLCJhbGxvd011bHRpcGxlVm90ZXMiLCJyZXF1aXJlQXV0aGVudGljYXRpb24iLCJtaW5UcnVzdFRpZXIiLCJyYXRlTGltaXRQZXJVc2VyIiwicmF0ZUxpbWl0V2luZG93TXMiLCJyYXRlTGltaXRUcmFja2VyIiwiTWFwIiwic3RyYXRlZ2llcyIsIlNpbmdsZUNob2ljZVN0cmF0ZWd5IiwiQXBwcm92YWxTdHJhdGVneSIsIlJhbmtlZFN0cmF0ZWd5IiwiUXVhZHJhdGljU3RyYXRlZ3kiLCJSYW5nZVN0cmF0ZWd5IiwiZGV2TG9nIiwiQXJyYXkiLCJmcm9tIiwia2V5cyIsImdldFN0cmF0ZWd5IiwibWV0aG9kIiwic3RyYXRlZ3kiLCJnZXQiLCJFcnJvciIsImdldFZvdGluZ1N0cmF0ZWd5Iiwic2F2ZVZvdGUiLCJ2b3RlRGF0YSIsInBvbGxJZCIsInZvdGVJZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ2YWxpZGF0ZVZvdGUiLCJyZXF1ZXN0IiwicG9sbCIsInN0YXJ0VGltZSIsInZhbGlkIiwiaXNWYWxpZCIsImVycm9yIiwiZXJyb3JzIiwicmVxdWlyZXNBdXRoZW50aWNhdGlvbiIsInJlcXVpcmVzVG9rZW5zIiwiaWQiLCJzdGF0dXMiLCJlbmRUaW1lIiwidXNlcklkIiwic2V0dGluZ3MiLCJhbm9ueW1vdXNWb3RpbmciLCJvcHRpb25WYWxpZGF0aW9uIiwidmFsaWRhdGVWb3RlT3B0aW9ucyIsInJhdGVMaW1pdEtleSIsInJhdGVMaW1pdERhdGEiLCJyZXNldFRpbWUiLCJjb3VudCIsInNldCIsImN1cnJlbnREYXRhIiwidm90aW5nTWV0aG9kIiwic3RyYXRlZ3lWYWxpZGF0aW9uIiwiZHVyYXRpb24iLCJtZXNzYWdlIiwiU3RyaW5nIiwicHJvY2Vzc1ZvdGUiLCJ2YWxpZGF0aW9uIiwic3VjY2VzcyIsInJlc3BvbnNlVGltZSIsInJlc3VsdCIsImF1ZGl0UmVjZWlwdCIsImdlbmVyYXRlQXVkaXRSZWNlaXB0IiwicHJpdmFjeUxldmVsIiwiY2FsY3VsYXRlUmVzdWx0cyIsInZvdGVzIiwibGVuZ3RoIiwidG90YWxWb3RlcyIsInBhcnRpY2lwYXRpb25SYXRlIiwicmVzdWx0cyIsIndpbm5lciIsIndpbm5lclZvdGVzIiwid2lubmVyUGVyY2VudGFnZSIsIm9wdGlvblZvdGVzIiwib3B0aW9ucyIsInJlZHVjZSIsImFjYyIsIm9wdGlvbiIsIm9wdGlvblBlcmNlbnRhZ2VzIiwiYWJzdGVudGlvbnMiLCJhYnN0ZW50aW9uUGVyY2VudGFnZSIsImNhbGN1bGF0ZWRBdCIsInRvSVNPU3RyaW5nIiwibWV0YWRhdGEiLCJjYWxjdWxhdGlvblRpbWUiLCJpc0VtcHR5IiwidW5kZWZpbmVkIiwiY2hvaWNlIiwiaXNBcnJheSIsImFwcHJvdmFscyIsImFwcHJvdmFsIiwicmFua2luZ3MiLCJyYW5raW5nIiwiYWxsb2NhdGlvbnMiLCJyYXRpbmdzIiwiY29uc29sZSIsInRpbWVzdGFtcCIsInZvdGVIYXNoIiwiZ2VuZXJhdGVWb3RlSGFzaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwb2xsRGF0YSIsImNvbWJpbmVkIiwiaGFzaCIsImkiLCJjaGFyIiwiY2hhckNvZGVBdCIsImFicyIsImdldFZvdGluZ01ldGhvZENvbmZpZyIsImNvbmZpZ3MiLCJuYW1lIiwiYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zIiwibWluT3B0aW9ucyIsInJlc3VsdFR5cGUiLCJ1cGRhdGVDb25maWciLCJuZXdDb25maWciLCJnZXRDb25maWciXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7OztDQVFDOzs7Ozs7Ozs7OztJQTZCWUEsVUFBVTtlQUFWQTs7SUFnbEJBQyxVQUFVO2VBQVZBOzs7d0JBM21CVTswQkFFVTsyQkFDQzt1QkFDSjt3QkFDQzs4QkFDTTtBQXFCOUIsTUFBTUQ7SUFLWEUsWUFBWUMsU0FBb0MsQ0FBQyxDQUFDLENBQUU7UUFDbEQsSUFBSSxDQUFDQSxNQUFNLEdBQUdDLE9BQU9DLE1BQU0sQ0FBQztZQUMxQkMsaUJBQWlCO1lBQ2pCQyxvQkFBb0I7WUFDcEJDLHVCQUF1QjtZQUN2QkMsY0FBYztZQUNkQyxrQkFBa0I7WUFDbEJDLG1CQUFtQjtRQUNyQixHQUFHUjtRQUVILG1DQUFtQztRQUNuQyxJQUFJLENBQUNTLGdCQUFnQixHQUFHLElBQUlDO1FBRTVCLCtCQUErQjtRQUMvQixJQUFJLENBQUNDLFVBQVUsR0FBRyxJQUFJRCxJQUFJO1lBQ3hCO2dCQUFDO2dCQUFVLElBQUlFLGtDQUFvQjthQUFHO1lBQ3RDO2dCQUFDO2dCQUFpQixJQUFJQSxrQ0FBb0I7YUFBRztZQUM3QztnQkFBQztnQkFBWSxJQUFJQywwQkFBZ0I7YUFBRztZQUNwQztnQkFB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
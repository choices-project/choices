{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/lib/core/feature-flags.ts"],"sourcesContent":["/**\n * Centralized flags with case-insensitive lookups and typed keys.\n * Add new flags here; remove when dead.\n */\n\nimport { withOptional } from '@/lib/utils/objects';\nexport const FEATURE_FLAGS = {\n  // ===== CORE FEATURES =====\n  WEBAUTHN: true,                    // WebAuthn authentication\n  PWA: true,                         // Progressive Web App features\n  ADMIN: true,                       // Admin dashboard\n  FEEDBACK_WIDGET: true,             // User feedback collection\n  \n  // ===== ADMIN FEATURES =====\n  USER_SUGGESTIONS_MANAGER: false,   // User suggestions management\n  \n  // ===== ENHANCED FEATURES =====\n  ENHANCED_PROFILE: true,            // Advanced profile management\n  ENHANCED_POLLS: true,              // Advanced poll creation and management\n  ENHANCED_VOTING: true,             // Advanced voting methods and analytics\n  CIVICS_ADDRESS_LOOKUP: true,       // Address-based representative lookup\n  CIVICS_REPRESENTATIVE_DATABASE: true, // Representative database\n  CIVICS_CAMPAIGN_FINANCE: true,     // FEC campaign finance data\n  CIVICS_VOTING_RECORDS: true,       // Congressional voting records\n  CANDIDATE_ACCOUNTABILITY: true,    // Promise tracking and performance metrics\n  CANDIDATE_CARDS: true,             // Comprehensive candidate information\n  ALTERNATIVE_CANDIDATES: true,      // Platform for non-duopoly candidates\n  \n  // ===== FUTURE FEATURES =====\n  AUTOMATED_POLLS: false,            // AI-powered poll generation\n  DEMOGRAPHIC_FILTERING: false,      // Content personalization based on demographics\n  TRENDING_POLLS: false,             // Trending polls and topics identification\n  ADVANCED_PRIVACY: false,           // Zero-knowledge proofs and differential privacy\n  MEDIA_BIAS_ANALYSIS: false,        // Media bias detection and analysis\n  POLL_NARRATIVE_SYSTEM: false,      // AI-powered poll narrative generation\n  SOCIAL_SHARING: true,              // Master switch for social features\n  SOCIAL_SHARING_POLLS: false,       // Poll sharing (Twitter, Facebook, LinkedIn)\n  SOCIAL_SHARING_CIVICS: false,      // Representative sharing\n  SOCIAL_SHARING_VISUAL: false,      // Visual content generation (IG, TikTok)\n  SOCIAL_SHARING_OG: false,          // Dynamic Open Graph image generation\n  SOCIAL_SIGNUP: false,              // Social OAuth signup\n  CONTACT_INFORMATION_SYSTEM: false, // Contact information system\n  CIVICS_TESTING_STRATEGY: false,    // Civics testing strategy\n  DEVICE_FLOW_AUTH: false,           // OAuth 2.0 Device Authorization Grant flow\n  \n  // ===== PERFORMANCE & OPTIMIZATION =====\n  PERFORMANCE_OPTIMIZATION: true,    // Image optimization, virtual scrolling, lazy loading\n  FEATURE_DB_OPTIMIZATION_SUITE: true, // Database optimization suite\n  ANALYTICS: true,                   // Advanced analytics and user insights\n  \n  // ===== SYSTEM FEATURES =====\n  PUSH_NOTIFICATIONS: true,          // Push notifications and alerts\n  THEMES: true,                      // Dark mode and theme customization\n  ACCESSIBILITY: true,               // Advanced accessibility features\n  INTERNATIONALIZATION: false,       // Multi-language support\n} as const;\n\n// Define proper types for feature flag system\nexport interface FeatureFlag {\n  id: string;\n  name: string;\n  enabled: boolean;\n  description: string;\n  key?: FeatureFlagKey;\n  category?: string;\n}\n\nexport interface FeatureFlagMetadata {\n  description?: string;\n  category?: string;\n  dependencies?: string[];\n  experimental?: boolean;\n  deprecated?: boolean;\n}\n\nexport interface FeatureFlagConfig {\n  [key: string]: unknown;\n  flags: Record<string, boolean>;\n  timestamp: string;\n  version: string;\n}\n\nexport interface FeatureFlagSubscription {\n  unsubscribe: () => void;\n}\n\nexport interface FeatureFlagSystemInfo {\n  totalFlags: number;\n  enabledFlags: number;\n  disabledFlags: number;\n  environment: string;\n  categories: Record<string, number>;\n}\n\ntype _KnownFlag = keyof typeof FEATURE_FLAGS;\n\n// Define the missing FeatureFlagKey type\nexport type FeatureFlagKey = keyof typeof FEATURE_FLAGS;\n\nexport type FeatureFlagManager = typeof featureFlagManager;\n\n// also accept lowercase legacy names found in code: 'pwa', 'advancedPrivacy'\nconst ALIASES: Record<string, FeatureFlagKey> = {\n  pwa: 'PWA',\n  advancedprivacy: 'ADVANCED_PRIVACY',\n  'advanced-privacy': 'ADVANCED_PRIVACY',\n  analytics: 'ANALYTICS',\n  admin: 'ADMIN',\n  civics: 'CIVICS_ADDRESS_LOOKUP',\n  'civics-address-lookup': 'CIVICS_ADDRESS_LOOKUP',\n};\n\nfunction normalize(key: string): FeatureFlagKey | null {\n  if (key in FEATURE_FLAGS) return key as FeatureFlagKey;\n  const alias = ALIASES[key.toLowerCase()];\n  return alias || null;\n}\n\n// Subscriptions for flag changes\nconst subscribers = new Set<(flags: Record<string, boolean>) => void>();\nfunction notifySubscribers() {\n  const snapshot = { ...mutableFlags };\n  subscribers.forEach(cb => {\n    try { cb(snapshot); } catch { /* noop */ }\n  });\n}\n\nexport function isFeatureEnabled<K extends string>(key: K): boolean {\n  const normalizedKey = normalize(key);\n  if (normalizedKey && normalizedKey in FEATURE_FLAGS) {\n    return FEATURE_FLAGS[normalizedKey];\n  }\n  // Unknown flags default to false but don't crash\n  return false;\n}\n\n// Create a mutable copy of FEATURE_FLAGS for runtime modifications\nconst mutableFlags: Record<string, boolean> = { ...FEATURE_FLAGS };\n\n// Helper function to categorize flags\nfunction categorizeFlag(flagId: string): string {\n  const categories: Record<string, string[]> = {\n    core: ['WEBAUTHN', 'PWA', 'ADMIN', 'FEEDBACK_WIDGET'],\n    enhanced: ['ENHANCED_PROFILE', 'ENHANCED_POLLS', 'ENHANCED_VOTING', 'CIVICS_ADDRESS_LOOKUP', 'CIVICS_REPRESENTATIVE_DATABASE', 'CIVICS_CAMPAIGN_FINANCE', 'CIVICS_VOTING_RECORDS', 'CANDIDATE_ACCOUNTABILITY', 'CANDIDATE_CARDS', 'ALTERNATIVE_CANDIDATES'],\n    future: ['AUTOMATED_POLLS', 'DEMOGRAPHIC_FILTERING', 'TRENDING_POLLS', 'ADVANCED_PRIVACY', 'MEDIA_BIAS_ANALYSIS', 'POLL_NARRATIVE_SYSTEM', 'SOCIAL_SHARING_POLLS', 'SOCIAL_SHARING_CIVICS', 'SOCIAL_SHARING_VISUAL', 'SOCIAL_SHARING_OG', 'SOCIAL_SIGNUP', 'CONTACT_INFORMATION_SYSTEM', 'CIVICS_TESTING_STRATEGY', 'DEVICE_FLOW_AUTH'],\n    performance: ['PERFORMANCE_OPTIMIZATION', 'FEATURE_DB_OPTIMIZATION_SUITE', 'ANALYTICS'],\n    system: ['PUSH_NOTIFICATIONS', 'THEMES', 'ACCESSIBILITY', 'INTERNATIONALIZATION']\n  };\n  \n  for (const [category, flags] of Object.entries(categories)) {\n    if (flags.includes(flagId)) {\n      return category;\n    }\n  }\n  return 'general';\n}\n\nexport const featureFlagManager = {\n  enable: (k: string | FeatureFlagKey): boolean => {\n    const key = normalize(String(k)); \n    if (key && key in mutableFlags) {\n      mutableFlags[key] = true;\n      notifySubscribers();\n      return true;\n    }\n    return false;\n  },\n  disable: (k: string | FeatureFlagKey): boolean => {\n    const key = normalize(String(k)); \n    if (key && key in mutableFlags) {\n      mutableFlags[key] = false;\n      notifySubscribers();\n      return true;\n    }\n    return false;\n  },\n  toggle: (k: string | FeatureFlagKey): boolean => {\n    const key = normalize(String(k)); \n    if (key && key in mutableFlags) {\n      mutableFlags[key] = !mutableFlags[key];\n      notifySubscribers();\n      return true;\n    }\n    return false;\n  },\n  get: (key: string | FeatureFlagKey): boolean => {\n    const normalizedKey = normalize(String(key));\n    if (normalizedKey && normalizedKey in mutableFlags) {\n      return mutableFlags[normalizedKey] || false;\n    }\n    return false;\n  },\n  all: () => ({ ...mutableFlags }),\n  \n  // Additional methods expected by useFeatureFlags hook\n  getAllFlags: (): Map<string, FeatureFlag> => {\n    const flags: FeatureFlag[] = Object.entries(mutableFlags).map(([key, enabled]) => ({\n      id: key,\n      name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled,\n      description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n      key: key as FeatureFlagKey,\n      category: categorizeFlag(key)\n    }));\n    return new Map(flags.map(flag => [flag.id, flag]));\n  },\n  isEnabled: (key: string | FeatureFlagKey): boolean => {\n    const normalizedKey = normalize(String(key));\n    if (normalizedKey && normalizedKey in mutableFlags) {\n      return mutableFlags[normalizedKey] || false;\n    }\n    return false;\n  },\n  getFlag: (flagId: string): FeatureFlag | null => {\n    const normalizedKey = normalize(flagId);\n    if (normalizedKey && normalizedKey in mutableFlags) {\n      const enabled = mutableFlags[normalizedKey] || false;\n      return {\n        id: flagId,\n        name: flagId.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n        enabled,\n        description: `Feature flag for ${flagId.toLowerCase().replace(/_/g, ' ')}`,\n        key: normalizedKey,\n        category: categorizeFlag(flagId)\n      };\n    }\n    return null;\n  },\n  getEnabledFlags: (): FeatureFlag[] => Object.entries(mutableFlags)\n    .filter(([_, enabled]) => enabled)\n    .map(([key, enabled]) => ({\n      id: key,\n      name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled,\n      description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n      key: key as FeatureFlagKey,\n      category: categorizeFlag(key)\n    })),\n  getDisabledFlags: (): FeatureFlag[] => Object.entries(mutableFlags)\n    .filter(([_, enabled]) => !enabled)\n    .map(([key, enabled]) => ({\n      id: key,\n      name: key.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled,\n      description: `Feature flag for ${key.toLowerCase().replace(/_/g, ' ')}`,\n      key: key as FeatureFlagKey,\n      category: categorizeFlag(key)\n    })),\n  getFlagsByCategory: (category: string): FeatureFlag[] => {\n    const categories: Record<string, string[]> = {\n      core: ['WEBAUTHN', 'PWA', 'ADMIN', 'FEEDBACK_WIDGET'],\n      enhanced: ['ENHANCED_PROFILE', 'ENHANCED_POLLS', 'ENHANCED_VOTING', 'CIVICS_ADDRESS_LOOKUP', 'CIVICS_REPRESENTATIVE_DATABASE', 'CIVICS_CAMPAIGN_FINANCE', 'CIVICS_VOTING_RECORDS', 'CANDIDATE_ACCOUNTABILITY', 'CANDIDATE_CARDS', 'ALTERNATIVE_CANDIDATES'],\n      future: ['AUTOMATED_POLLS', 'DEMOGRAPHIC_FILTERING', 'TRENDING_POLLS', 'ADVANCED_PRIVACY', 'MEDIA_BIAS_ANALYSIS', 'POLL_NARRATIVE_SYSTEM', 'SOCIAL_SHARING_POLLS', 'SOCIAL_SHARING_CIVICS', 'SOCIAL_SHARING_VISUAL', 'SOCIAL_SHARING_OG', 'SOCIAL_SIGNUP', 'CONTACT_INFORMATION_SYSTEM', 'CIVICS_TESTING_STRATEGY', 'DEVICE_FLOW_AUTH'],\n      performance: ['PERFORMANCE_OPTIMIZATION', 'FEATURE_DB_OPTIMIZATION_SUITE', 'ANALYTICS'],\n      system: ['PUSH_NOTIFICATIONS', 'THEMES', 'ACCESSIBILITY', 'INTERNATIONALIZATION']\n    };\n    const flagIds = categories[category] || [];\n    return flagIds.map(flagId => ({\n      id: flagId,\n      name: flagId.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase()),\n      enabled: mutableFlags[flagId as FeatureFlagKey] || false,\n      description: `Feature flag for ${flagId.toLowerCase().replace(/_/g, ' ')}`,\n      key: flagId as FeatureFlagKey,\n      category\n    }));\n  },\n  getSystemInfo: (): FeatureFlagSystemInfo => ({\n    totalFlags: Object.keys(mutableFlags).length,\n    enabledFlags: Object.values(mutableFlags).filter(Boolean).length,\n    disabledFlags: Object.values(mutableFlags).filter(f => !f).length,\n    environment: process.env.NODE_ENV || 'development',\n    categories: {\n      core: 4,\n      enhanced: 10,\n      future: 14,\n      performance: 3,\n      system: 4\n    }\n  }),\n  areDependenciesEnabled: (flagId: string): boolean => {\n    const dependencies: Record<string, string[]> = {\n      'ENHANCED_PROFILE': [],\n      'ENHANCED_POLLS': [],\n      'ENHANCED_VOTING': [],\n      'CIVICS_ADDRESS_LOOKUP': [],\n      'AUTOMATED_POLLS': ['ADMIN'],\n      'SOCIAL_SHARING': [],\n      'SOCIAL_SHARING_POLLS': ['SOCIAL_SHARING'],\n      'SOCIAL_SHARING_CIVICS': ['SOCIAL_SHARING', 'CIVICS_ADDRESS_LOOKUP'],\n      'SOCIAL_SHARING_VISUAL': ['SOCIAL_SHARING'],\n      'SOCIAL_SHARING_OG': ['SOCIAL_SHARING'],\n      'SOCIAL_SIGNUP': [],\n      'PERFORMANCE_OPTIMIZATION': [],\n      'ANALYTICS': [],\n      'PUSH_NOTIFICATIONS': ['PWA'],\n      'THEMES': [],\n      'ACCESSIBILITY': [],\n      'INTERNATIONALIZATION': []\n    };\n    const deps = dependencies[flagId] || [];\n    return deps.every(dep => {\n      const normalizedKey = normalize(dep);\n      return normalizedKey ? mutableFlags[normalizedKey] : false;\n    });\n  },\n  subscribe: (callback: (flags: Record<string, boolean>) => void): FeatureFlagSubscription => {\n    // Register and provide unsubscribe\n    if (typeof callback === 'function') {\n      subscribers.add(callback);\n      // Immediately push current state to new subscriber\n      try { callback({ ...mutableFlags }); } catch { /* noop */ }\n    }\n    return { unsubscribe: () => subscribers.delete(callback) };\n  },\n  updateFlagMetadata: (flagId: string, metadata: FeatureFlagMetadata): boolean => {\n    // For now, just return true - in a real app, this would update flag metadata\n    console.log(`Updating metadata for flag ${flagId}:`, metadata);\n    return true;\n  },\n  reset: (): void => {\n    // Reset all flags to their default values\n    Object.keys(FEATURE_FLAGS).forEach(key => {\n      const flagKey = key as FeatureFlagKey;\n      mutableFlags[flagKey] = FEATURE_FLAGS[flagKey];\n    });\n    notifySubscribers();\n  },\n  exportConfig: (): FeatureFlagConfig => {\n    // Export current flag configuration\n    return {\n      flags: { ...mutableFlags },\n      timestamp: new Date().toISOString(),\n      version: '1.0.0'\n    };\n  },\n  importConfig: (config: FeatureFlagConfig): void => {\n    // Import flag configuration\n    if (config && config.flags) {\n      Object.entries(config.flags).forEach(([key, value]) => {\n        const normalizedKey = normalize(key);\n        if (normalizedKey && normalizedKey in mutableFlags && typeof value === 'boolean') {\n          mutableFlags[normalizedKey] = value;\n        }\n      });\n      notifySubscribers();\n    }\n  }\n};\n\n// Named helpers kept for compatibility\nexport const enableFeature = featureFlagManager.enable;\nexport const disableFeature = featureFlagManager.disable;\nexport const toggleFeature = featureFlagManager.toggle;\nexport const getFeatureFlag = (k: string | FeatureFlagKey) => isFeatureEnabled(k);\n\n// E2E API functions\nexport async function getFeatureFlags(): Promise<Record<string, boolean>> {\n  return featureFlagManager.all();\n}\n\nexport async function setFeatureFlags(flags: Record<string, boolean>): Promise<void> {\n  Object.entries(flags).forEach(([key, value]) => {\n    const normalizedKey = normalize(key);\n    if (normalizedKey && normalizedKey in mutableFlags && typeof value === 'boolean') {\n      mutableFlags[normalizedKey] = value;\n    }\n  });\n  notifySubscribers();\n}\nexport const getAllFeatureFlags = () => featureFlagManager.all();\n\n// Additional exports expected by useFeatureFlags hook\nexport const FeatureFlagManager = featureFlagManager;"],"names":["FEATURE_FLAGS","FeatureFlagManager","disableFeature","enableFeature","featureFlagManager","getAllFeatureFlags","getFeatureFlag","getFeatureFlags","isFeatureEnabled","setFeatureFlags","toggleFeature","WEBAUTHN","PWA","ADMIN","FEEDBACK_WIDGET","USER_SUGGESTIONS_MANAGER","ENHANCED_PROFILE","ENHANCED_POLLS","ENHANCED_VOTING","CIVICS_ADDRESS_LOOKUP","CIVICS_REPRESENTATIVE_DATABASE","CIVICS_CAMPAIGN_FINANCE","CIVICS_VOTING_RECORDS","CANDIDATE_ACCOUNTABILITY","CANDIDATE_CARDS","ALTERNATIVE_CANDIDATES","AUTOMATED_POLLS","DEMOGRAPHIC_FILTERING","TRENDING_POLLS","ADVANCED_PRIVACY","MEDIA_BIAS_ANALYSIS","POLL_NARRATIVE_SYSTEM","SOCIAL_SHARING","SOCIAL_SHARING_POLLS","SOCIAL_SHARING_CIVICS","SOCIAL_SHARING_VISUAL","SOCIAL_SHARING_OG","SOCIAL_SIGNUP","CONTACT_INFORMATION_SYSTEM","CIVICS_TESTING_STRATEGY","DEVICE_FLOW_AUTH","PERFORMANCE_OPTIMIZATION","FEATURE_DB_OPTIMIZATION_SUITE","ANALYTICS","PUSH_NOTIFICATIONS","THEMES","ACCESSIBILITY","INTERNATIONALIZATION","ALIASES","pwa","advancedprivacy","analytics","admin","civics","normalize","key","alias","toLowerCase","subscribers","Set","notifySubscribers","snapshot","mutableFlags","forEach","cb","normalizedKey","categorizeFlag","flagId","categories","core","enhanced","future","performance","system","category","flags","Object","entries","includes","enable","k","String","disable","toggle","get","all","getAllFlags","map","enabled","id","name","replace","l","toUpperCase","description","Map","flag","isEnabled","getFlag","getEnabledFlags","filter","_","getDisabledFlags","getFlagsByCategory","flagIds","getSystemInfo","totalFlags","keys","length","enabledFlags","values","Boolean","disabledFlags","f","environment","process","env","NODE_ENV","areDependenciesEnabled","dependencies","deps","every","dep","subscribe","callback","add","unsubscribe","delete","updateFlagMetadata","metadata","console","log","reset","flagKey","exportConfig","timestamp","Date","toISOString","version","importConfig","config","value"],"mappings":"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"}
aef1905ef16b16bd5b5d2e11ed6e2361
/**
 * Security Configuration
 * Centralized security settings and policies
 * 
 * Features:
 * - CSP (Content Security Policy) configuration
 * - Security headers configuration
 * - Rate limiting settings
 * - Request validation rules
 * - Privacy and data protection settings
 * 
 * Created: 2025-08-27
 * Status: Critical security enhancement
 */ // E2E Test Detection
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    DEVELOPMENT_SECURITY_CONFIG: function() {
        return DEVELOPMENT_SECURITY_CONFIG;
    },
    IS_E2E: function() {
        return IS_E2E;
    },
    PRODUCTION_SECURITY_CONFIG: function() {
        return PRODUCTION_SECURITY_CONFIG;
    },
    anonymizeIP: function() {
        return anonymizeIP;
    },
    buildCSPHeader: function() {
        return buildCSPHeader;
    },
    getSecurityConfig: function() {
        return getSecurityConfig;
    },
    isBlockedUserAgent: function() {
        return isBlockedUserAgent;
    },
    validateContent: function() {
        return validateContent;
    }
});
const IS_E2E = process.env.NODE_ENV === "test" || process.env.E2E === "1" || process.env.PLAYWRIGHT === "1";
const PRODUCTION_SECURITY_CONFIG = {
    csp: {
        "default-src": [
            "'self'"
        ],
        "script-src": [
            "'self'",
            "'unsafe-inline'",
            "https://cdn.jsdelivr.net"
        ],
        "style-src": [
            "'self'",
            "'unsafe-inline'",
            "https://fonts.googleapis.com"
        ],
        "font-src": [
            "'self'",
            "https://fonts.gstatic.com",
            "data:"
        ],
        "img-src": [
            "'self'",
            "data:",
            "https:",
            "blob:"
        ],
        "connect-src": [
            "'self'",
            "https://*.supabase.co",
            "https://api.choices.app",
            "wss://*.supabase.co"
        ],
        "frame-src": [
            "'none'"
        ],
        "object-src": [
            "'none'"
        ],
        "base-uri": [
            "'self'"
        ],
        "form-action": [
            "'self'"
        ],
        "frame-ancestors": [
            "'none'"
        ],
        "upgrade-insecure-requests": []
    },
    headers: {
        "X-Frame-Options": "DENY",
        "X-Content-Type-Options": "nosniff",
        "X-XSS-Protection": "1; mode=block",
        "Referrer-Policy": "strict-origin-when-cross-origin",
        "Permissions-Policy": "camera=(), microphone=(), geolocation=()",
        "Cross-Origin-Embedder-Policy": "require-corp",
        "Cross-Origin-Opener-Policy": "same-origin",
        "Cross-Origin-Resource-Policy": "same-origin"
    },
    rateLimit: {
        enabled: !IS_E2E,
        windowMs: 15 * 60 * 1000,
        maxRequests: 100,
        sensitiveEndpoints: IS_E2E ? {} : {
            "/api/auth": 10,
            "/register": 5,
            "/login": 10,
            "/api/admin": 20
        },
        e2eBypassHeader: "x-e2e-bypass"
    },
    validation: {
        maxContentLength: 1024 * 1024,
        allowedContentTypes: [
            "application/json",
            "application/x-www-form-urlencoded",
            "multipart/form-data"
        ],
        suspiciousPatterns: [
            /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
            /javascript:/gi,
            /on\w+\s*=/gi,
            /<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi
        ],
        blockedUserAgents: [
            "sqlmap",
            "nikto",
            "nmap",
            "scanner",
            "bot",
            "crawler"
        ]
    },
    privacy: {
        dataRetentionDays: 90,
        anonymizeIPs: true,
        logSensitiveData: false,
        enableDifferentialPrivacy: true
    }
};
const DEVELOPMENT_SECURITY_CONFIG = Object.assign({}, PRODUCTION_SECURITY_CONFIG, {
    csp: {
        ...PRODUCTION_SECURITY_CONFIG.csp,
        "script-src": [
            ...PRODUCTION_SECURITY_CONFIG.csp["script-src"],
            "'unsafe-eval'"
        ]
    },
    rateLimit: {
        ...PRODUCTION_SECURITY_CONFIG.rateLimit,
        maxRequests: 1000
    },
    privacy: {
        ...PRODUCTION_SECURITY_CONFIG.privacy,
        logSensitiveData: true
    }
});
function getSecurityConfig() {
    return process.env.NODE_ENV === "production" ? PRODUCTION_SECURITY_CONFIG : DEVELOPMENT_SECURITY_CONFIG;
}
function buildCSPHeader(config) {
    const directives = Object.entries(config).map(([directive, sources])=>{
        if (Array.isArray(sources) && sources.length > 0) {
            return `${directive} ${sources.join(" ")}`;
        } else if (sources.length === 0) {
            return directive;
        }
        return "";
    }).filter(Boolean).join("; ");
    return directives;
}
function validateContent(content, config) {
    // Check content length
    if (content.length > config.maxContentLength) {
        return {
            valid: false,
            reason: "Content too long"
        };
    }
    // Check for suspicious patterns
    for (const pattern of config.suspiciousPatterns){
        if (pattern.test(content)) {
            return {
                valid: false,
                reason: "Suspicious content detected"
            };
        }
    }
    return {
        valid: true
    };
}
function isBlockedUserAgent(userAgent, config) {
    const lowerUA = userAgent.toLowerCase();
    return config.blockedUserAgents.some((blocked)=>lowerUA.includes(blocked.toLowerCase()));
}
function anonymizeIP(ip) {
    if (!ip || ip === "unknown") return "unknown";
    // IPv4: 192.168.1.1 -> 192.168.1.0
    if (ip.includes(".")) {
        const parts = ip.split(".");
        if (parts.length === 4) {
            return `${parts[0]}.${parts[1]}.${parts[2]}.0`;
        }
    }
    // IPv6: 2001:db8::1 -> 2001:db8::
    if (ip.includes(":")) {
        const parts = ip.split(":");
        if (parts.length >= 4) {
            return `${parts[0]}:${parts[1]}:${parts[2]}::`;
        }
    }
    return ip;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvY29yZS9zZWN1cml0eS9jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZWN1cml0eSBDb25maWd1cmF0aW9uXG4gKiBDZW50cmFsaXplZCBzZWN1cml0eSBzZXR0aW5ncyBhbmQgcG9saWNpZXNcbiAqIFxuICogRmVhdHVyZXM6XG4gKiAtIENTUCAoQ29udGVudCBTZWN1cml0eSBQb2xpY3kpIGNvbmZpZ3VyYXRpb25cbiAqIC0gU2VjdXJpdHkgaGVhZGVycyBjb25maWd1cmF0aW9uXG4gKiAtIFJhdGUgbGltaXRpbmcgc2V0dGluZ3NcbiAqIC0gUmVxdWVzdCB2YWxpZGF0aW9uIHJ1bGVzXG4gKiAtIFByaXZhY3kgYW5kIGRhdGEgcHJvdGVjdGlvbiBzZXR0aW5nc1xuICogXG4gKiBDcmVhdGVkOiAyMDI1LTA4LTI3XG4gKiBTdGF0dXM6IENyaXRpY2FsIHNlY3VyaXR5IGVuaGFuY2VtZW50XG4gKi9cblxuLy8gRTJFIFRlc3QgRGV0ZWN0aW9uXG5leHBvcnQgY29uc3QgSVNfRTJFID1cbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyB8fFxuICBwcm9jZXNzLmVudi5FMkUgPT09ICcxJyB8fFxuICBwcm9jZXNzLmVudi5QTEFZV1JJR0hUID09PSAnMSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlDb25maWcge1xuICBjc3A6IENTUENvbmZpZ1xuICBoZWFkZXJzOiBTZWN1cml0eUhlYWRlcnNcbiAgcmF0ZUxpbWl0OiBSYXRlTGltaXRDb25maWdcbiAgdmFsaWRhdGlvbjogVmFsaWRhdGlvbkNvbmZpZ1xuICBwcml2YWN5OiBQcml2YWN5Q29uZmlnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ1NQQ29uZmlnIHtcbiAgJ2RlZmF1bHQtc3JjJzogc3RyaW5nW11cbiAgJ3NjcmlwdC1zcmMnOiBzdHJpbmdbXVxuICAnc3R5bGUtc3JjJzogc3RyaW5nW11cbiAgJ2ZvbnQtc3JjJzogc3RyaW5nW11cbiAgJ2ltZy1zcmMnOiBzdHJpbmdbXVxuICAnY29ubmVjdC1zcmMnOiBzdHJpbmdbXVxuICAnZnJhbWUtc3JjJzogc3RyaW5nW11cbiAgJ29iamVjdC1zcmMnOiBzdHJpbmdbXVxuICAnYmFzZS11cmknOiBzdHJpbmdbXVxuICAnZm9ybS1hY3Rpb24nOiBzdHJpbmdbXVxuICAnZnJhbWUtYW5jZXN0b3JzJzogc3RyaW5nW11cbiAgJ3VwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMnPzogc3RyaW5nW11cbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eUhlYWRlcnMge1xuICAnWC1GcmFtZS1PcHRpb25zJzogc3RyaW5nXG4gICdYLUNvbnRlbnQtVHlwZS1PcHRpb25zJzogc3RyaW5nXG4gICdYLVhTUy1Qcm90ZWN0aW9uJzogc3RyaW5nXG4gICdSZWZlcnJlci1Qb2xpY3knOiBzdHJpbmdcbiAgJ1Blcm1pc3Npb25zLVBvbGljeSc6IHN0cmluZ1xuICAnQ3Jvc3MtT3JpZ2luLUVtYmVkZGVyLVBvbGljeSc6IHN0cmluZ1xuICAnQ3Jvc3MtT3JpZ2luLU9wZW5lci1Qb2xpY3knOiBzdHJpbmdcbiAgJ0Nyb3NzLU9yaWdpbi1SZXNvdXJjZS1Qb2xpY3knOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSYXRlTGltaXRDb25maWcge1xuICBlbmFibGVkOiBib29sZWFuXG4gIHdpbmRvd01zOiBudW1iZXJcbiAgbWF4UmVxdWVzdHM6IG51bWJlclxuICBzZW5zaXRpdmVFbmRwb2ludHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj5cbiAgZTJlQnlwYXNzSGVhZGVyOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uQ29uZmlnIHtcbiAgbWF4Q29udGVudExlbmd0aDogbnVtYmVyXG4gIGFsbG93ZWRDb250ZW50VHlwZXM6IHN0cmluZ1tdXG4gIHN1c3BpY2lvdXNQYXR0ZXJuczogUmVnRXhwW11cbiAgYmxvY2tlZFVzZXJBZ2VudHM6IHN0cmluZ1tdXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJpdmFjeUNvbmZpZyB7XG4gIGRhdGFSZXRlbnRpb25EYXlzOiBudW1iZXJcbiAgYW5vbnltaXplSVBzOiBib29sZWFuXG4gIGxvZ1NlbnNpdGl2ZURhdGE6IGJvb2xlYW5cbiAgZW5hYmxlRGlmZmVyZW50aWFsUHJpdmFjeTogYm9vbGVhblxufVxuXG4vKipcbiAqIFByb2R1Y3Rpb24gc2VjdXJpdHkgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgY29uc3QgUFJPRFVDVElPTl9TRUNVUklUWV9DT05GSUc6IFNlY3VyaXR5Q29uZmlnID0ge1xuICBjc3A6IHtcbiAgICAnZGVmYXVsdC1zcmMnOiBbXCInc2VsZidcIl0sXG4gICAgJ3NjcmlwdC1zcmMnOiBbXG4gICAgICBcIidzZWxmJ1wiLFxuICAgICAgXCIndW5zYWZlLWlubGluZSdcIiwgLy8gUmVxdWlyZWQgZm9yIE5leHQuanNcbiAgICAgICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQnLFxuICAgIF0sXG4gICAgJ3N0eWxlLXNyYyc6IFtcbiAgICAgIFwiJ3NlbGYnXCIsXG4gICAgICBcIid1bnNhZmUtaW5saW5lJ1wiLCAvLyBSZXF1aXJlZCBmb3IgTmV4dC5qc1xuICAgICAgJ2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20nLFxuICAgIF0sXG4gICAgJ2ZvbnQtc3JjJzogW1xuICAgICAgXCInc2VsZidcIixcbiAgICAgICdodHRwczovL2ZvbnRzLmdzdGF0aWMuY29tJyxcbiAgICAgICdkYXRhOicsXG4gICAgXSxcbiAgICAnaW1nLXNyYyc6IFtcbiAgICAgIFwiJ3NlbGYnXCIsXG4gICAgICAnZGF0YTonLFxuICAgICAgJ2h0dHBzOicsXG4gICAgICAnYmxvYjonLFxuICAgIF0sXG4gICAgJ2Nvbm5lY3Qtc3JjJzogW1xuICAgICAgXCInc2VsZidcIixcbiAgICAgICdodHRwczovLyouc3VwYWJhc2UuY28nLFxuICAgICAgJ2h0dHBzOi8vYXBpLmNob2ljZXMuYXBwJyxcbiAgICAgICd3c3M6Ly8qLnN1cGFiYXNlLmNvJyxcbiAgICBdLFxuICAgICdmcmFtZS1zcmMnOiBbXCInbm9uZSdcIl0sXG4gICAgJ29iamVjdC1zcmMnOiBbXCInbm9uZSdcIl0sXG4gICAgJ2Jhc2UtdXJpJzogW1wiJ3NlbGYnXCJdLFxuICAgICdmb3JtLWFjdGlvbic6IFtcIidzZWxmJ1wiXSxcbiAgICAnZnJhbWUtYW5jZXN0b3JzJzogW1wiJ25vbmUnXCJdLFxuICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzogW10sXG4gIH0sXG4gIFxuICBoZWFkZXJzOiB7XG4gICAgJ1gtRnJhbWUtT3B0aW9ucyc6ICdERU5ZJyxcbiAgICAnWC1Db250ZW50LVR5cGUtT3B0aW9ucyc6ICdub3NuaWZmJyxcbiAgICAnWC1YU1MtUHJvdGVjdGlvbic6ICcxOyBtb2RlPWJsb2NrJyxcbiAgICAnUmVmZXJyZXItUG9saWN5JzogJ3N0cmljdC1vcmlnaW4td2hlbi1jcm9zcy1vcmlnaW4nLFxuICAgICdQZXJtaXNzaW9ucy1Qb2xpY3knOiAnY2FtZXJhPSgpLCBtaWNyb3Bob25lPSgpLCBnZW9sb2NhdGlvbj0oKScsXG4gICAgJ0Nyb3NzLU9yaWdpbi1FbWJlZGRlci1Qb2xpY3knOiAncmVxdWlyZS1jb3JwJyxcbiAgICAnQ3Jvc3MtT3JpZ2luLU9wZW5lci1Qb2xpY3knOiAnc2FtZS1vcmlnaW4nLFxuICAgICdDcm9zcy1PcmlnaW4tUmVzb3VyY2UtUG9saWN5JzogJ3NhbWUtb3JpZ2luJyxcbiAgfSxcbiAgXG4gIHJhdGVMaW1pdDoge1xuICAgIGVuYWJsZWQ6ICFJU19FMkUsIC8vIERpc2FibGVkIGluIEUyRSB0ZXN0c1xuICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRlc1xuICAgIG1heFJlcXVlc3RzOiAxMDAsXG4gICAgc2Vuc2l0aXZlRW5kcG9pbnRzOiBJU19FMkUgPyB7fSA6IHtcbiAgICAgICcvYXBpL2F1dGgnOiAxMCxcbiAgICAgICcvcmVnaXN0ZXInOiA1LFxuICAgICAgJy9sb2dpbic6IDEwLFxuICAgICAgJy9hcGkvYWRtaW4nOiAyMCxcbiAgICB9LFxuICAgIGUyZUJ5cGFzc0hlYWRlcjogJ3gtZTJlLWJ5cGFzcydcbiAgfSxcbiAgXG4gIHZhbGlkYXRpb246IHtcbiAgICBtYXhDb250ZW50TGVuZ3RoOiAxMDI0ICogMTAyNCwgLy8gMU1CXG4gICAgYWxsb3dlZENvbnRlbnRUeXBlczogW1xuICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScsXG4gICAgXSxcbiAgICBzdXNwaWNpb3VzUGF0dGVybnM6IFtcbiAgICAgIC88c2NyaXB0XFxiW148XSooPzooPyE8XFwvc2NyaXB0Pik8W148XSopKjxcXC9zY3JpcHQ+L2dpLCAvLyBTY3JpcHQgdGFnc1xuICAgICAgL2phdmFzY3JpcHQ6L2dpLCAvLyBKYXZhU2NyaXB0IHByb3RvY29sXG4gICAgICAvb25cXHcrXFxzKj0vZ2ksIC8vIEV2ZW50IGhhbmRsZXJzXG4gICAgICAvPGlmcmFtZVxcYltePF0qKD86KD8hPFxcL2lmcmFtZT4pPFtePF0qKSo8XFwvaWZyYW1lPi9naSwgLy8gSWZyYW1lIHRhZ3NcbiAgICBdLFxuICAgIGJsb2NrZWRVc2VyQWdlbnRzOiBbXG4gICAgICAnc3FsbWFwJyxcbiAgICAgICduaWt0bycsXG4gICAgICAnbm1hcCcsXG4gICAgICAnc2Nhbm5lcicsXG4gICAgICAnYm90JyxcbiAgICAgICdjcmF3bGVyJyxcbiAgICBdLFxuICB9LFxuICBcbiAgcHJpdmFjeToge1xuICAgIGRhdGFSZXRlbnRpb25EYXlzOiA5MCxcbiAgICBhbm9ueW1pemVJUHM6IHRydWUsXG4gICAgbG9nU2Vuc2l0aXZlRGF0YTogZmFsc2UsXG4gICAgZW5hYmxlRGlmZmVyZW50aWFsUHJpdmFjeTogdHJ1ZSxcbiAgfSxcbn1cblxuLyoqXG4gKiBEZXZlbG9wbWVudCBzZWN1cml0eSBjb25maWd1cmF0aW9uIChtb3JlIHBlcm1pc3NpdmUpXG4gKi9cbmV4cG9ydCBjb25zdCBERVZFTE9QTUVOVF9TRUNVUklUWV9DT05GSUc6IFNlY3VyaXR5Q29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgUFJPRFVDVElPTl9TRUNVUklUWV9DT05GSUcsIHtcbiAgY3NwOiB7XG4gICAgLi4uUFJPRFVDVElPTl9TRUNVUklUWV9DT05GSUcuY3NwLFxuICAgICdzY3JpcHQtc3JjJzogW1xuICAgICAgLi4uUFJPRFVDVElPTl9TRUNVUklUWV9DT05GSUcuY3NwWydzY3JpcHQtc3JjJ10sXG4gICAgICBcIid1bnNhZmUtZXZhbCdcIiwgLy8gUmVxdWlyZWQgZm9yIE5leHQuanMgZGV2ZWxvcG1lbnRcbiAgICBdLFxuICB9LFxuICByYXRlTGltaXQ6IHtcbiAgICAuLi5QUk9EVUNUSU9OX1NFQ1VSSVRZX0NPTkZJRy5yYXRlTGltaXQsXG4gICAgbWF4UmVxdWVzdHM6IDEwMDAsIC8vIE1vcmUgcGVybWlzc2l2ZSBpbiBkZXZlbG9wbWVudFxuICB9LFxuICBwcml2YWN5OiB7XG4gICAgLi4uUFJPRFVDVElPTl9TRUNVUklUWV9DT05GSUcucHJpdmFjeSxcbiAgICBsb2dTZW5zaXRpdmVEYXRhOiB0cnVlLCAvLyBNb3JlIGxvZ2dpbmcgaW4gZGV2ZWxvcG1lbnRcbiAgfSxcbn0pXG5cbi8qKlxuICogR2V0IHNlY3VyaXR5IGNvbmZpZ3VyYXRpb24gYmFzZWQgb24gZW52aXJvbm1lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNlY3VyaXR5Q29uZmlnKCk6IFNlY3VyaXR5Q29uZmlnIHtcbiAgcmV0dXJuIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgXG4gICAgPyBQUk9EVUNUSU9OX1NFQ1VSSVRZX0NPTkZJRyBcbiAgICA6IERFVkVMT1BNRU5UX1NFQ1VSSVRZX0NPTkZJR1xufVxuXG4vKipcbiAqIEJ1aWxkIENTUCBoZWFkZXIgc3RyaW5nIGZyb20gY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRDU1BIZWFkZXIoY29uZmlnOiBDU1BDb25maWcpOiBzdHJpbmcge1xuICBjb25zdCBkaXJlY3RpdmVzID0gT2JqZWN0LmVudHJpZXMoY29uZmlnKVxuICAgIC5tYXAoKFtkaXJlY3RpdmUsIHNvdXJjZXNdKSA9PiB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShzb3VyY2VzKSAmJiBzb3VyY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIGAke2RpcmVjdGl2ZX0gJHtzb3VyY2VzLmpvaW4oJyAnKX1gXG4gICAgICB9IGVsc2UgaWYgKHNvdXJjZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmVcbiAgICAgIH1cbiAgICAgIHJldHVybiAnJ1xuICAgIH0pXG4gICAgLmZpbHRlcihCb29sZWFuKVxuICAgIC5qb2luKCc7ICcpXG4gIFxuICByZXR1cm4gZGlyZWN0aXZlc1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIGNvbnRlbnQgYWdhaW5zdCBzZWN1cml0eSBwYXR0ZXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVDb250ZW50KFxuICBjb250ZW50OiBzdHJpbmcsIFxuICBjb25maWc6IFZhbGlkYXRpb25Db25maWdcbik6IHsgdmFsaWQ6IGJvb2xlYW47IHJlYXNvbj86IHN0cmluZyB9IHtcbiAgLy8gQ2hlY2sgY29udGVudCBsZW5ndGhcbiAgaWYgKGNvbnRlbnQubGVuZ3RoID4gY29uZmlnLm1heENvbnRlbnRMZW5ndGgpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIHJlYXNvbjogJ0NvbnRlbnQgdG9vIGxvbmcnIH1cbiAgfVxuICBcbiAgLy8gQ2hlY2sgZm9yIHN1c3BpY2lvdXMgcGF0dGVybnNcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGNvbmZpZy5zdXNwaWNpb3VzUGF0dGVybnMpIHtcbiAgICBpZiAocGF0dGVybi50ZXN0KGNvbnRlbnQpKSB7XG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIHJlYXNvbjogJ1N1c3BpY2lvdXMgY29udGVudCBkZXRlY3RlZCcgfVxuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUgfVxufVxuXG4vKipcbiAqIENoZWNrIGlmIHVzZXIgYWdlbnQgaXMgYmxvY2tlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNCbG9ja2VkVXNlckFnZW50KFxuICB1c2VyQWdlbnQ6IHN0cmluZywgXG4gIGNvbmZpZzogVmFsaWRhdGlvbkNvbmZpZ1xuKTogYm9vbGVhbiB7XG4gIGNvbnN0IGxvd2VyVUEgPSB1c2VyQWdlbnQudG9Mb3dlckNhc2UoKVxuICByZXR1cm4gY29uZmlnLmJsb2NrZWRVc2VyQWdlbnRzLnNvbWUoYmxvY2tlZCA9PiBcbiAgICBsb3dlclVBLmluY2x1ZGVzKGJsb2NrZWQudG9Mb3dlckNhc2UoKSlcbiAgKVxufVxuXG4vKipcbiAqIEFub255bWl6ZSBJUCBhZGRyZXNzIGZvciBwcml2YWN5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhbm9ueW1pemVJUChpcDogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFpcCB8fCBpcCA9PT0gJ3Vua25vd24nKSByZXR1cm4gJ3Vua25vd24nXG4gIFxuICAvLyBJUHY0OiAxOTIuMTY4LjEuMSAtPiAxOTIuMTY4LjEuMFxuICBpZiAoaXAuaW5jbHVkZXMoJy4nKSkge1xuICAgIGNvbnN0IHBhcnRzID0gaXAuc3BsaXQoJy4nKVxuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDQpIHtcbiAgICAgIHJldHVybiBgJHtwYXJ0c1swXX0uJHtwYXJ0c1sxXX0uJHtwYXJ0c1syXX0uMGBcbiAgICB9XG4gIH1cbiAgXG4gIC8vIElQdjY6IDIwMDE6ZGI4OjoxIC0+IDIwMDE6ZGI4OjpcbiAgaWYgKGlwLmluY2x1ZGVzKCc6JykpIHtcbiAgICBjb25zdCBwYXJ0cyA9IGlwLnNwbGl0KCc6JylcbiAgICBpZiAocGFydHMubGVuZ3RoID49IDQpIHtcbiAgICAgIHJldHVybiBgJHtwYXJ0c1swXX06JHtwYXJ0c1sxXX06JHtwYXJ0c1syXX06OmBcbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiBpcFxufVxuIl0sIm5hbWVzIjpbIkRFVkVMT1BNRU5UX1NFQ1VSSVRZX0NPTkZJRyIsIklTX0UyRSIsIlBST0RVQ1RJT05fU0VDVVJJVFlfQ09ORklHIiwiYW5vbnltaXplSVAiLCJidWlsZENTUEhlYWRlciIsImdldFNlY3VyaXR5Q29uZmlnIiwiaXNCbG9ja2VkVXNlckFnZW50IiwidmFsaWRhdGVDb250ZW50IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiRTJFIiwiUExBWVdSSUdIVCIsImNzcCIsImhlYWRlcnMiLCJyYXRlTGltaXQiLCJlbmFibGVkIiwid2luZG93TXMiLCJtYXhSZXF1ZXN0cyIsInNlbnNpdGl2ZUVuZHBvaW50cyIsImUyZUJ5cGFzc0hlYWRlciIsInZhbGlkYXRpb24iLCJtYXhDb250ZW50TGVuZ3RoIiwiYWxsb3dlZENvbnRlbnRUeXBlcyIsInN1c3BpY2lvdXNQYXR0ZXJucyIsImJsb2NrZWRVc2VyQWdlbnRzIiwicHJpdmFjeSIsImRhdGFSZXRlbnRpb25EYXlzIiwiYW5vbnltaXplSVBzIiwibG9nU2Vuc2l0aXZlRGF0YSIsImVuYWJsZURpZmZlcmVudGlhbFByaXZhY3kiLCJPYmplY3QiLCJhc3NpZ24iLCJjb25maWciLCJkaXJlY3RpdmVzIiwiZW50cmllcyIsIm1hcCIsImRpcmVjdGl2ZSIsInNvdXJjZXMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJqb2luIiwiZmlsdGVyIiwiQm9vbGVhbiIsImNvbnRlbnQiLCJ2YWxpZCIsInJlYXNvbiIsInBhdHRlcm4iLCJ0ZXN0IiwidXNlckFnZW50IiwibG93ZXJVQSIsInRvTG93ZXJDYXNlIiwic29tZSIsImJsb2NrZWQiLCJpbmNsdWRlcyIsImlwIiwicGFydHMiLCJzcGxpdCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Q0FhQyxHQUVELHFCQUFxQjs7Ozs7Ozs7Ozs7O0lBaUtS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
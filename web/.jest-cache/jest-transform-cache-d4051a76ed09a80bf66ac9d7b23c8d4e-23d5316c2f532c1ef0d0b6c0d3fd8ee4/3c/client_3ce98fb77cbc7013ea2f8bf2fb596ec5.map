{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/utils/supabase/client.ts"],"sourcesContent":["'use client'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport type { SupabaseClient } from '@supabase/supabase-js'\n\n// Database schema types for type safety\nexport interface Database {\n  public: {\n    Tables: {\n      user_profiles: {\n        Row: {\n          id: string\n          user_id: string\n          username: string\n          email: string\n          trust_tier: 'T0' | 'T1' | 'T2' | 'T3'\n          created_at: string\n          updated_at: string\n          avatar_url?: string\n          bio?: string\n          is_active: boolean\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          username: string\n          email: string\n          trust_tier?: 'T0' | 'T1' | 'T2' | 'T3'\n          created_at?: string\n          updated_at?: string\n          avatar_url?: string\n          bio?: string\n          is_active?: boolean\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          username?: string\n          email?: string\n          trust_tier?: 'T0' | 'T1' | 'T2' | 'T3'\n          created_at?: string\n          updated_at?: string\n          avatar_url?: string\n          bio?: string\n          is_active?: boolean\n        }\n      }\n      polls: {\n        Row: {\n          id: string\n          title: string\n          description: string\n          options: string[]\n          voting_method: 'single' | 'approval' | 'ranked' | 'quadratic' | 'range'\n          created_by: string\n          created_at: string\n          updated_at: string\n          start_time: string\n          end_time: string\n          status: 'draft' | 'active' | 'closed' | 'archived'\n          privacy_level: 'public' | 'private' | 'high-privacy'\n          total_votes: number\n          category?: string\n          tags?: string[]\n        }\n        Insert: {\n          id?: string\n          title: string\n          description: string\n          options: string[]\n          voting_method: 'single' | 'approval' | 'ranked' | 'quadratic' | 'range'\n          created_by: string\n          created_at?: string\n          updated_at?: string\n          start_time: string\n          end_time: string\n          status?: 'draft' | 'active' | 'closed' | 'archived'\n          privacy_level?: 'public' | 'private' | 'high-privacy'\n          total_votes?: number\n          category?: string\n          tags?: string[]\n        }\n        Update: {\n          id?: string\n          title?: string\n          description?: string\n          options?: string[]\n          voting_method?: 'single' | 'approval' | 'ranked' | 'quadratic' | 'range'\n          created_by?: string\n          created_at?: string\n          updated_at?: string\n          start_time?: string\n          end_time?: string\n          status?: 'draft' | 'active' | 'closed' | 'archived'\n          privacy_level?: 'public' | 'private' | 'high-privacy'\n          total_votes?: number\n          category?: string\n          tags?: string[]\n        }\n      }\n      votes: {\n        Row: {\n          id: string\n          poll_id: string\n          user_id: string\n          choice: number\n          created_at: string\n          updated_at: string\n          verification_token?: string\n          is_verified: boolean\n          voting_method: 'single' | 'approval' | 'ranked' | 'quadratic' | 'range'\n          vote_data: Record<string, unknown> // JSON data for complex voting methods\n        }\n        Insert: {\n          id?: string\n          poll_id: string\n          user_id: string\n          choice: number\n          created_at?: string\n          updated_at?: string\n          verification_token?: string\n          is_verified?: boolean\n          voting_method: 'single' | 'approval' | 'ranked' | 'quadratic' | 'range'\n          vote_data?: Record<string, unknown>\n        }\n        Update: {\n          id?: string\n          poll_id?: string\n          user_id?: string\n          choice?: number\n          created_at?: string\n          updated_at?: string\n          verification_token?: string\n          is_verified?: boolean\n          voting_method?: 'single' | 'approval' | 'ranked' | 'quadratic' | 'range'\n          vote_data?: Record<string, unknown>\n        }\n      }\n      // Privacy-first tables\n      user_consent: {\n        Row: {\n          id: string\n          user_id: string\n          consent_type: 'analytics' | 'demographics' | 'behavioral' | 'contact' | 'research' | 'marketing'\n          granted: boolean\n          granted_at: string\n          revoked_at?: string\n          consent_version: number\n          purpose: string\n          data_types: string[]\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          consent_type: 'analytics' | 'demographics' | 'behavioral' | 'contact' | 'research' | 'marketing'\n          granted: boolean\n          granted_at?: string\n          revoked_at?: string\n          consent_version?: number\n          purpose: string\n          data_types?: string[]\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          consent_type?: 'analytics' | 'demographics' | 'behavioral' | 'contact' | 'research' | 'marketing'\n          granted?: boolean\n          granted_at?: string\n          revoked_at?: string\n          consent_version?: number\n          purpose?: string\n          data_types?: string[]\n        }\n      }\n      privacy_logs: {\n        Row: {\n          id: string\n          action: string\n          user_id_hash: string\n          created_at: string\n          metadata: Record<string, unknown>\n        }\n        Insert: {\n          id?: string\n          action: string\n          user_id_hash: string\n          created_at?: string\n          metadata?: Record<string, unknown>\n        }\n        Update: {\n          id?: string\n          action?: string\n          user_id_hash?: string\n          created_at?: string\n          metadata?: Record<string, unknown>\n        }\n      }\n      user_profiles_encrypted: {\n        Row: {\n          id: string\n          user_id: string\n          username?: string\n          public_bio?: string\n          created_at: string\n          updated_at: string\n          encrypted_demographics?: string\n          encrypted_preferences?: string\n          encrypted_contact_info?: string\n          encryption_version: number\n          key_derivation_salt?: string\n          key_hash?: string\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          username?: string\n          public_bio?: string\n          created_at?: string\n          updated_at?: string\n          encrypted_demographics?: string\n          encrypted_preferences?: string\n          encrypted_contact_info?: string\n          encryption_version?: number\n          key_derivation_salt?: string\n          key_hash?: string\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          username?: string\n          public_bio?: string\n          created_at?: string\n          updated_at?: string\n          encrypted_demographics?: string\n          encrypted_preferences?: string\n          encrypted_contact_info?: string\n          encryption_version?: number\n          key_derivation_salt?: string\n          key_hash?: string\n        }\n      }\n      private_user_data: {\n        Row: {\n          id: string\n          user_id: string\n          encrypted_personal_info?: string\n          encrypted_behavioral_data?: string\n          encrypted_analytics_data?: string\n          encryption_key_hash?: string\n          last_encrypted_at: string\n        }\n        Insert: {\n          id?: string\n          user_id: string\n          encrypted_personal_info?: string\n          encrypted_behavioral_data?: string\n          encrypted_analytics_data?: string\n          encryption_key_hash?: string\n          last_encrypted_at?: string\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          encrypted_personal_info?: string\n          encrypted_behavioral_data?: string\n          encrypted_analytics_data?: string\n          encryption_key_hash?: string\n          last_encrypted_at?: string\n        }\n      }\n      analytics_contributions: {\n        Row: {\n          id: string\n          poll_id: string\n          user_id: string\n          age_bucket?: string\n          region_bucket?: string\n          education_bucket?: string\n          vote_choice?: number\n          participation_time?: string\n          consent_granted: boolean\n          created_at: string\n        }\n        Insert: {\n          id?: string\n          poll_id: string\n          user_id: string\n          age_bucket?: string\n          region_bucket?: string\n          education_bucket?: string\n          vote_choice?: number\n          participation_time?: string\n          consent_granted?: boolean\n          created_at?: string\n        }\n        Update: {\n          id?: string\n          poll_id?: string\n          user_id?: string\n          age_bucket?: string\n          region_bucket?: string\n          education_bucket?: string\n          vote_choice?: number\n          participation_time?: string\n          consent_granted?: boolean\n          created_at?: string\n        }\n      }\n      // webauthn_credentials: Removed - not ready for production\n      error_logs: {\n        Row: {\n          id: string\n          user_id?: string\n          error_type: string\n          error_message: string\n          stack_trace?: string\n          context?: Record<string, unknown>\n          created_at: string\n          severity: 'low' | 'medium' | 'high' | 'critical'\n        }\n        Insert: {\n          id?: string\n          user_id?: string\n          error_type: string\n          error_message: string\n          stack_trace?: string\n          context?: Record<string, unknown>\n          created_at?: string\n          severity?: 'low' | 'medium' | 'high' | 'critical'\n        }\n        Update: {\n          id?: string\n          user_id?: string\n          error_type?: string\n          error_message?: string\n          stack_trace?: string\n          context?: Record<string, unknown>\n          created_at?: string\n          severity?: 'low' | 'medium' | 'high' | 'critical'\n        }\n      }\n    }\n    Views: {\n      demographic_analytics: {\n        Row: {\n          poll_id: string\n          age_bucket: string\n          region_bucket: string\n          education_bucket: string\n          participant_count: number\n          average_choice: number\n          choice_variance: number\n          first_contribution: string\n          last_contribution: string\n        }\n      }\n    }\n    Functions: {\n      anonymize_user_data: {\n        Args: {\n          target_user_id: string\n        }\n        Returns: void\n      }\n      export_user_data: {\n        Args: {\n          target_user_id: string\n        }\n        Returns: Record<string, unknown>\n      }\n      contribute_to_analytics: {\n        Args: {\n          target_poll_id: string\n          target_age_bucket: string\n          target_region_bucket: string\n          target_education_bucket: string\n          target_vote_choice: number\n          target_participation_time: string\n        }\n        Returns: boolean\n      }\n    }\n    Enums: {\n      [_ in never]: never\n    }\n  }\n}\n\nlet client: SupabaseClient<Database> | undefined\n\nexport async function getSupabaseBrowserClient(): Promise<SupabaseClient<Database>> {\n  if (typeof window === 'undefined') {\n    throw new Error('getSupabaseBrowserClient can only be used in client-side code')\n  }\n  \n  if (!client) {\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n    const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n    \n    if (!supabaseUrl || !supabaseKey) {\n      throw new Error('Missing Supabase environment variables')\n    }\n    \n    // Use dynamic import to avoid SSR issues\n    const { createBrowserClient } = await import('@supabase/ssr')\n    client = createBrowserClient<Database>(\n      supabaseUrl,\n      supabaseKey,\n    )\n  }\n  return client\n}\n\n// Export types for use in other modules\nexport type DatabaseTypes = Database\nexport type UserProfile = Database['public']['Tables']['user_profiles']['Row']\nexport type Poll = Database['public']['Tables']['polls']['Row']\nexport type Vote = Database['public']['Tables']['votes']['Row']\nexport type UserConsent = Database['public']['Tables']['user_consent']['Row']\nexport type PrivacyLog = Database['public']['Tables']['privacy_logs']['Row']\nexport type UserProfileEncrypted = Database['public']['Tables']['user_profiles_encrypted']['Row']\nexport type PrivateUserData = Database['public']['Tables']['private_user_data']['Row']\nexport type AnalyticsContribution = Database['public']['Tables']['analytics_contributions']['Row']\nexport type DemographicAnalytics = Database['public']['Views']['demographic_analytics']['Row']\n// export type WebAuthnCredential = Database['public']['Tables']['webauthn_credentials']['Row'] // Removed - not ready\n\n// Create Supabase client\nexport const createClient = (): SupabaseClient<Database> => {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\n  const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  \n  return createSupabaseClient<Database>(supabaseUrl, supabaseKey)\n}\n\n// Alias for compatibility\nexport const getSupabaseClient = createClient\n"],"names":["createClient","getSupabaseBrowserClient","getSupabaseClient","client","window","Error","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","createBrowserClient","createSupabaseClient"],"mappings":"AAAA;;;;;;;;;;;;IA0aaA,YAAY;eAAZA;;IArCSC,wBAAwB;eAAxBA;;IA6CTC,iBAAiB;eAAjBA;;;4BAjbwC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkYrD,IAAIC;AAEG,eAAeF;IACpB,IAAI,OAAOG,WAAW,aAAa;QACjC,MAAM,IAAIC,MAAM;IAClB;IAEA,IAAI,CAACF,QAAQ;QACX,MAAMG,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;QACxD,MAAMC,cAAcH,QAAQC,GAAG,CAACG,6BAA6B;QAE7D,IAAI,CAACL,eAAe,CAACI,aAAa;YAChC,MAAM,IAAIL,MAAM;QAClB;QAEA,yCAAyC;QACzC,MAAM,EAAEO,mBAAmB,EAAE,GAAG,MAAM,mEAAA,QAAO;QAC7CT,SAASS,oBACPN,aACAI;IAEJ;IACA,OAAOP;AACT;AAgBO,MAAMH,eAAe;IAC1B,MAAMM,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;IACxD,MAAMC,cAAcH,QAAQC,GAAG,CAACG,6BAA6B;IAE7D,OAAOE,IAAAA,wBAAoB,EAAWP,aAAaI;AACrD;AAGO,MAAMR,oBAAoBF"}
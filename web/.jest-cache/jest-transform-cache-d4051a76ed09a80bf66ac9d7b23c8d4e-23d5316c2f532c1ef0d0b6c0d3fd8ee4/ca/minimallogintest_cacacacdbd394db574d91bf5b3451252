e261aa3a4914218f6e0539bb910f67ae
/**
 * Minimal Login Route Test
 */ "use strict";
// Mock Next.js headers
jest.mock("next/headers", ()=>({
        cookies: jest.fn(()=>({
                get: jest.fn(),
                set: jest.fn(),
                delete: jest.fn()
            }))
    }));
// Mock all dependencies with minimal setup
jest.mock("@/utils/supabase/server", ()=>({
        getSupabaseServerClient: jest.fn()
    }));
jest.mock("@/lib/utils/logger", ()=>({
        logger: {
            info: jest.fn(),
            error: jest.fn(),
            warn: jest.fn()
        }
    }));
jest.mock("@/lib/core/security/rate-limit", ()=>({
        rateLimiters: {
            auth: {
                check: jest.fn().mockResolvedValue({
                    allowed: true,
                    success: true,
                    remaining: 10,
                    resetTime: new Date(),
                    retryAfter: null
                })
            }
        }
    }));
jest.mock("@/app/api/auth/_shared", ()=>({
        validateCsrfProtection: jest.fn().mockReturnValue(true),
        createCsrfErrorResponse: jest.fn().mockReturnValue(new Response(JSON.stringify({
            error: "CSRF token validation failed"
        }), {
            status: 403
        }))
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _server = require("next/server");
const _route = require("../../../../../app/api/auth/login/route");
describe("Minimal Login Route", ()=>{
    beforeEach(()=>{
        // Set required environment variables
        process.env.NEXT_PUBLIC_SUPABASE_URL = "https://test.supabase.co";
        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = "test-anon-key";
        process.env.SUPABASE_SECRET_KEY = "test-secret-key";
    });
    it("should return a response", async ()=>{
        const { getSupabaseServerClient } = require("@/utils/supabase/server");
        // Mock Supabase client to return a simple response
        getSupabaseServerClient.mockResolvedValue({
            auth: {
                signInWithPassword: jest.fn().mockResolvedValue({
                    data: {
                        user: {
                            id: "user-123",
                            email: "test@example.com"
                        },
                        session: {
                            access_token: "token"
                        }
                    },
                    error: null
                })
            },
            from: jest.fn(()=>({
                    select: jest.fn(()=>({
                            eq: jest.fn(()=>({
                                    single: jest.fn().mockResolvedValue({
                                        data: {
                                            id: "user-123",
                                            is_active: true,
                                            username: "testuser"
                                        },
                                        error: null
                                    })
                                }))
                        }))
                }))
        });
        const request = new _server.NextRequest("http://localhost:3000/api/auth/login", {
            method: "POST",
            body: JSON.stringify({
                email: "test@example.com",
                password: "password123"
            }),
            headers: {
                "Content-Type": "application/json"
            }
        });
        const response = await (0, _route.POST)(request);
        expect(response).toBeDefined();
        expect(response).toBeInstanceOf(Response);
        expect(response.status).toBe(200);
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvYXBpL2F1dGgvbWluaW1hbC1sb2dpbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWluaW1hbCBMb2dpbiBSb3V0ZSBUZXN0XG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBQT1NUIH0gZnJvbSAnQC9hcHAvYXBpL2F1dGgvbG9naW4vcm91dGUnO1xuXG4vLyBNb2NrIE5leHQuanMgaGVhZGVyc1xuamVzdC5tb2NrKCduZXh0L2hlYWRlcnMnLCAoKSA9PiAoe1xuICBjb29raWVzOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgc2V0OiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gIH0pKSxcbn0pKTtcblxuLy8gTW9jayBhbGwgZGVwZW5kZW5jaWVzIHdpdGggbWluaW1hbCBzZXR1cFxuamVzdC5tb2NrKCdAL3V0aWxzL3N1cGFiYXNlL3NlcnZlcicsICgpID0+ICh7XG4gIGdldFN1cGFiYXNlU2VydmVyQ2xpZW50OiBqZXN0LmZuKCksXG59KSk7XG5cbmplc3QubW9jaygnQC9saWIvdXRpbHMvbG9nZ2VyJywgKCkgPT4gKHtcbiAgbG9nZ2VyOiB7XG4gICAgaW5mbzogamVzdC5mbigpLFxuICAgIGVycm9yOiBqZXN0LmZuKCksXG4gICAgd2FybjogamVzdC5mbigpLFxuICB9LFxufSkpO1xuXG5qZXN0Lm1vY2soJ0AvbGliL2NvcmUvc2VjdXJpdHkvcmF0ZS1saW1pdCcsICgpID0+ICh7XG4gIHJhdGVMaW1pdGVyczoge1xuICAgIGF1dGg6IHtcbiAgICAgIGNoZWNrOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBcbiAgICAgICAgYWxsb3dlZDogdHJ1ZSwgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHJlbWFpbmluZzogMTAsXG4gICAgICAgIHJlc2V0VGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgcmV0cnlBZnRlcjogbnVsbFxuICAgICAgfSlcbiAgICB9XG4gIH1cbn0pKTtcblxuamVzdC5tb2NrKCdAL2FwcC9hcGkvYXV0aC9fc2hhcmVkJywgKCkgPT4gKHtcbiAgdmFsaWRhdGVDc3JmUHJvdGVjdGlvbjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgY3JlYXRlQ3NyZkVycm9yUmVzcG9uc2U6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoXG4gICAgbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHsgZXJyb3I6ICdDU1JGIHRva2VuIHZhbGlkYXRpb24gZmFpbGVkJyB9KSwgeyBzdGF0dXM6IDQwMyB9KVxuICApXG59KSk7XG5cbmRlc2NyaWJlKCdNaW5pbWFsIExvZ2luIFJvdXRlJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBTZXQgcmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMID0gJ2h0dHBzOi8vdGVzdC5zdXBhYmFzZS5jbyc7XG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgPSAndGVzdC1hbm9uLWtleSc7XG4gICAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VDUkVUX0tFWSA9ICd0ZXN0LXNlY3JldC1rZXknO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiBhIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQgfSA9IHJlcXVpcmUoJ0AvdXRpbHMvc3VwYWJhc2Uvc2VydmVyJyk7XG4gICAgXG4gICAgLy8gTW9jayBTdXBhYmFzZSBjbGllbnQgdG8gcmV0dXJuIGEgc2ltcGxlIHJlc3BvbnNlXG4gICAgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgYXV0aDoge1xuICAgICAgICBzaWduSW5XaXRoUGFzc3dvcmQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcjogeyBpZDogJ3VzZXItMTIzJywgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyB9LFxuICAgICAgICAgICAgc2Vzc2lvbjogeyBhY2Nlc3NfdG9rZW46ICd0b2tlbicgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pLFxuICAgICAgfSxcbiAgICAgIGZyb206IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YTogeyBpZDogJ3VzZXItMTIzJywgaXNfYWN0aXZlOiB0cnVlLCB1c2VybmFtZTogJ3Rlc3R1c2VyJyB9LFxuICAgICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pKSxcbiAgICAgICAgfSkpLFxuICAgICAgfSkpLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBOZXh0UmVxdWVzdCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL2xvZ2luJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLFxuICAgICAgfSksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQT1NUKHJlcXVlc3QpO1xuICAgIFxuICAgIGV4cGVjdChyZXNwb25zZSkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvQmVJbnN0YW5jZU9mKFJlc3BvbnNlKTtcbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJjb29raWVzIiwiZm4iLCJnZXQiLCJzZXQiLCJkZWxldGUiLCJnZXRTdXBhYmFzZVNlcnZlckNsaWVudCIsImxvZ2dlciIsImluZm8iLCJlcnJvciIsIndhcm4iLCJyYXRlTGltaXRlcnMiLCJhdXRoIiwiY2hlY2siLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsImFsbG93ZWQiLCJzdWNjZXNzIiwicmVtYWluaW5nIiwicmVzZXRUaW1lIiwiRGF0ZSIsInJldHJ5QWZ0ZXIiLCJ2YWxpZGF0ZUNzcmZQcm90ZWN0aW9uIiwibW9ja1JldHVyblZhbHVlIiwiY3JlYXRlQ3NyZkVycm9yUmVzcG9uc2UiLCJSZXNwb25zZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGF0dXMiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJTVVBBQkFTRV9TRUNSRVRfS0VZIiwiaXQiLCJyZXF1aXJlIiwic2lnbkluV2l0aFBhc3N3b3JkIiwiZGF0YSIsInVzZXIiLCJpZCIsImVtYWlsIiwic2Vzc2lvbiIsImFjY2Vzc190b2tlbiIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsImlzX2FjdGl2ZSIsInVzZXJuYW1lIiwicmVxdWVzdCIsIk5leHRSZXF1ZXN0IiwibWV0aG9kIiwiYm9keSIsInBhc3N3b3JkIiwiaGVhZGVycyIsInJlc3BvbnNlIiwiUE9TVCIsImV4cGVjdCIsInRvQmVE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
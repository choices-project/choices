{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/components/features/pwa/pwa-features-simple.test.tsx"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\n\n// Mock window.matchMedia before any imports\nObject.defineProperty(window, 'matchMedia', {\n  value: jest.fn().mockImplementation(query => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(),\n    removeListener: jest.fn(),\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn(),\n  })),\n  writable: true,\n});\n\n// Mock browser APIs\nObject.defineProperty(navigator, 'serviceWorker', {\n  value: {\n    register: jest.fn(),\n    ready: Promise.resolve(),\n  },\n  writable: true,\n});\n\n// Mock online/offline events\nObject.defineProperty(navigator, 'onLine', {\n  value: true,\n  writable: true,\n});\n\n// Mock lucide-react icons\njest.mock('lucide-react', () => ({\n  Bell: () => <div data-testid=\"bell-icon\" />,\n  BellOff: () => <div data-testid=\"bell-off-icon\" />,\n  CheckCircle: () => <div data-testid=\"check-circle-icon\" />,\n  AlertCircle: () => <div data-testid=\"alert-circle-icon\" />,\n  Wifi: () => <div data-testid=\"wifi-icon\" />,\n  WifiOff: () => <div data-testid=\"wifi-off-icon\" />,\n  Download: () => <div data-testid=\"download-icon\" />,\n  Settings: () => <div data-testid=\"settings-icon\" />,\n  RefreshCw: () => <div data-testid=\"refresh-icon\" />,\n  Database: () => <div data-testid=\"database-icon\" />,\n  Clock: () => <div data-testid=\"clock-icon\" />,\n  Check: () => <div data-testid=\"check-icon\" />,\n  X: () => <div data-testid=\"x-icon\" />,\n}));\n\n// Mock PWA installation manager\njest.mock('@/lib/pwa/installation', () => ({\n  PWAInstallationManager: jest.fn().mockImplementation(() => ({\n    isInstalled: false,\n    canInstall: true,\n    install: jest.fn(),\n    checkInstallationStatus: jest.fn(),\n    addListener: jest.fn(),\n    removeListener: jest.fn(),\n    subscribe: jest.fn(() => jest.fn()), // Return unsubscribe function\n    getStatus: jest.fn(() => ({\n      isInstallable: true,\n      isInstalled: false,\n      canPrompt: true,\n      platform: 'web',\n      deferredPrompt: null\n    }))\n  }))\n}));\n\n// Mock usePWA hook - CORRECT APPROACH\njest.mock('@/hooks/usePWA', () => ({\n  usePWA: jest.fn(() => ({\n    isSupported: true,\n    isEnabled: true,\n    installation: {\n      isInstalled: false,\n      canInstall: true,\n      install: jest.fn(),\n      checkInstallationStatus: jest.fn()\n    },\n    serviceWorker: {\n      isRegistered: false,\n      isActive: false,\n      registration: null\n    },\n    isOnline: true,\n    offlineVotes: 0,\n    hasOfflineData: false,\n    notificationsSupported: true,\n    notificationsEnabled: false,\n    notificationsPermission: 'default',\n    loading: false,\n    error: null\n  }))\n}));\n\n// Mock PWA store\njest.mock('@/lib/stores', () => ({\n  usePWAInstallation: jest.fn(() => ({\n    isInstalled: false,\n    canInstall: true,\n    install: jest.fn(),\n    checkInstallationStatus: jest.fn(),\n  })),\n  usePWAOffline: jest.fn(() => ({\n    isOnline: true,\n    offlineData: {\n      cachedPages: [],\n      cachedResources: [],\n      queuedActions: []\n    },\n    syncOfflineData: jest.fn(),\n    clearOfflineData: jest.fn(),\n  })),\n  usePWANotifications: jest.fn(() => ({\n    permission: 'default',\n    requestPermission: jest.fn(),\n    showNotification: jest.fn(),\n  })),\n  usePWALoading: jest.fn(() => false),\n  usePWAError: jest.fn(() => null),\n}));\n\nimport React from 'react';\nimport { render, screen } from '@testing-library/react';\nimport { BrowserRouter } from 'react-router-dom';\nimport PWAFeatures from '@/features/pwa/components/PWAFeatures';\nimport { T } from '@/lib/testing/testIds';\n\ndescribe('PWA Features - Simple Testing', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Ensure mocks are properly set up\n    const { usePWAInstallation, usePWAOffline } = require('@/lib/stores');\n    usePWAInstallation.mockReturnValue({\n      isInstalled: false,\n      canInstall: true,\n      install: jest.fn(),\n      checkInstallationStatus: jest.fn(),\n    });\n    usePWAOffline.mockReturnValue({\n      isOnline: true,\n      offlineData: {\n        cachedPages: [],\n        cachedResources: [],\n        queuedActions: []\n      },\n      syncOfflineData: jest.fn(),\n      clearOfflineData: jest.fn(),\n    });\n  });\n\n  describe('Component Rendering', () => {\n    it('should render PWA features when installation is available', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      // Check for basic PWA elements\n      expect(screen.getByTestId(T.pwa.status)).toBeInTheDocument();\n      expect(screen.getByTestId(T.pwa.installButton)).toBeInTheDocument();\n    });\n\n    it('should render with custom className', () => {\n      render(\n        <BrowserRouter>\n          <PWAFeatures className=\"custom-class\" />\n        </BrowserRouter>\n      );\n\n      const container = screen.getByTestId(T.pwa.status);\n      expect(container).toHaveClass('custom-class');\n    });\n  });\n\n  describe('Offline Features', () => {\n    it('should display offline indicator when offline', () => {\n      // Mock offline state\n      const { usePWAOffline } = require('@/lib/stores');\n      usePWAOffline.mockReturnValue({\n        isOnline: false,\n        offlineData: {},\n        syncOfflineData: jest.fn(),\n        clearOfflineData: jest.fn(),\n      });\n\n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      expect(screen.getByTestId(T.pwa.offlineIndicator)).toBeInTheDocument();\n    });\n  });\n\n  describe('Performance', () => {\n    it('should render within performance budget', async () => {\n      const startTime = performance.now();\n      \n      render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n      \n      const endTime = performance.now();\n      const renderTime = endTime - startTime;\n      \n      // Should render within 100ms\n      expect(renderTime).toBeLessThan(100);\n    });\n\n    it('should not cause memory leaks', () => {\n      const { unmount } = render(\n        <BrowserRouter>\n          <PWAFeatures />\n        </BrowserRouter>\n      );\n\n      // Unmount component\n      unmount();\n\n      // Should not leave any event listeners or timers\n      expect(jest.getTimerCount()).toBe(0);\n    });\n  });\n});\n"],"names":["jest","mock","Bell","div","data-testid","BellOff","CheckCircle","AlertCircle","Wifi","WifiOff","Download","Settings","RefreshCw","Database","Clock","Check","X","PWAInstallationManager","fn","mockImplementation","isInstalled","canInstall","install","checkInstallationStatus","addListener","removeListener","subscribe","getStatus","isInstallable","canPrompt","platform","deferredPrompt","usePWA","isSupported","isEnabled","installation","serviceWorker","isRegistered","isActive","registration","isOnline","offlineVotes","hasOfflineData","notificationsSupported","notificationsEnabled","notificationsPermission","loading","error","usePWAInstallation","usePWAOffline","offlineData","cachedPages","cachedResources","queuedActions","syncOfflineData","clearOfflineData","usePWANotifications","permission","requestPermission","showNotification","usePWALoading","usePWAError","Object","defineProperty","window","value","query","matches","media","onchange","addEventListener","removeEventListener","dispatchEvent","writable","navigator","register","ready","Promise","resolve","describe","beforeEach","clearAllMocks","require","mockReturnValue","it","render","BrowserRouter","PWAFeatures","expect","screen","getByTestId","T","pwa","status","toBeInTheDocument","installButton","className","container","toHaveClass","offlineIndicator","startTime","performance","now","endTime","renderTime","toBeLessThan","unmount","getTimerCount","toBe"],"mappings":"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"}
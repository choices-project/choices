{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/app/api/auth/_shared/cookies.ts"],"sourcesContent":["import type { NextResponse } from \"next/server\";\n\n/**\n * Cookie Security Configuration\n * \n * Production: Uses __Host- prefix for enhanced security\n * Development: Uses standard names for localhost compatibility\n * \n * __Host- prefix requirements:\n * - secure: true (HTTPS only)\n * - path: \"/\" (root path)\n * - no Domain attribute (host-bound)\n */\nconst isProduction = process.env.NODE_ENV === \"production\";\n\nexport const SESSION_COOKIE = isProduction ? \"__Host-choices_session\" : \"choices_session\";\nexport const CSRF_COOKIE = isProduction ? \"__Host-choices_csrf\" : \"choices_csrf\";\n\n/**\n * Cookie configuration for production vs development\n */\nconst getCookieConfig = (maxAgeSec: number) => ({\n  httpOnly: true,\n  secure: isProduction,\n  sameSite: \"lax\" as const,\n  path: \"/\",\n  maxAge: maxAgeSec,\n});\n\n/**\n * Sets a secure session cookie with appropriate configuration\n * \n * @param response - NextResponse object to set cookie on\n * @param token - JWT token to store in cookie\n * @param maxAgeSec - Cookie expiration time in seconds\n */\nexport function setSessionCookie(\n  response: NextResponse,\n  token: string,\n  maxAgeSec: number\n): void {\n  response.cookies.set(SESSION_COOKIE, token, getCookieConfig(maxAgeSec));\n}\n\n/**\n * Clears the session cookie by setting it to empty with maxAge: 0\n * \n * @param response - NextResponse object to clear cookie on\n */\nexport function clearSessionCookie(response: NextResponse): void {\n  response.cookies.set(SESSION_COOKIE, \"\", {\n    ...getCookieConfig(0),\n    maxAge: 0,\n  });\n}\n\n/**\n * Sets a CSRF token cookie (not httpOnly so client can read it)\n * \n * @param response - NextResponse object to set cookie on\n * @param token - CSRF token to store\n * @param maxAgeSec - Cookie expiration time in seconds\n */\nexport function setCsrfCookie(\n  response: NextResponse,\n  token: string,\n  maxAgeSec: number\n): void {\n  response.cookies.set(CSRF_COOKIE, token, {\n    ...getCookieConfig(maxAgeSec),\n    httpOnly: false, // Client needs to read this for CSRF protection\n  });\n}\n\n/**\n * Clears the CSRF cookie\n * \n * @param response - NextResponse object to clear cookie on\n */\nexport function clearCsrfCookie(response: NextResponse): void {\n  response.cookies.set(CSRF_COOKIE, \"\", {\n    ...getCookieConfig(0),\n    httpOnly: false,\n    maxAge: 0,\n  });\n}\n"],"names":["CSRF_COOKIE","SESSION_COOKIE","clearCsrfCookie","clearSessionCookie","setCsrfCookie","setSessionCookie","isProduction","process","env","NODE_ENV","getCookieConfig","maxAgeSec","httpOnly","secure","sameSite","path","maxAge","response","token","cookies","set"],"mappings":";;;;;;;;;;;IAgBaA,WAAW;eAAXA;;IADAC,cAAc;eAAdA;;IAgEGC,eAAe;eAAfA;;IA9BAC,kBAAkB;eAAlBA;;IAcAC,aAAa;eAAbA;;IA3BAC,gBAAgB;eAAhBA;;;AAlChB;;;;;;;;;;CAUC,GACD,MAAMC,eAAeC,QAAQC,GAAG,CAACC,QAAQ,KAAK;AAEvC,MAAMR,iBAAiBK,eAAe,2BAA2B;AACjE,MAAMN,cAAcM,eAAe,wBAAwB;AAElE;;CAEC,GACD,MAAMI,kBAAkB,CAACC,YAAuB,CAAA;QAC9CC,UAAU;QACVC,QAAQP;QACRQ,UAAU;QACVC,MAAM;QACNC,QAAQL;IACV,CAAA;AASO,SAASN,iBACdY,QAAsB,EACtBC,KAAa,EACbP,SAAiB;IAEjBM,SAASE,OAAO,CAACC,GAAG,CAACnB,gBAAgBiB,OAAOR,gBAAgBC;AAC9D;AAOO,SAASR,mBAAmBc,QAAsB;IACvDA,SAASE,OAAO,CAACC,GAAG,CAACnB,gBAAgB,IAAI;QACvC,GAAGS,gBAAgB,EAAE;QACrBM,QAAQ;IACV;AACF;AASO,SAASZ,cACda,QAAsB,EACtBC,KAAa,EACbP,SAAiB;IAEjBM,SAASE,OAAO,CAACC,GAAG,CAACpB,aAAakB,OAAO;QACvC,GAAGR,gBAAgBC,UAAU;QAC7BC,UAAU;IACZ;AACF;AAOO,SAASV,gBAAgBe,QAAsB;IACpDA,SAASE,OAAO,CAACC,GAAG,CAACpB,aAAa,IAAI;QACpC,GAAGU,gBAAgB,EAAE;QACrBE,UAAU;QACVI,QAAQ;IACV;AACF"}
b4ed7f83bc9539dc49f06887cdf78ea4
/**
 * Core Voting Engine
 * 
 * This module provides the main voting engine that orchestrates different voting strategies
 * and handles vote processing, validation, and results calculation.
 * 
 * Created: September 15, 2025
 * Updated: September 15, 2025
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    VoteEngine: function() {
        return VoteEngine;
    },
    voteEngine: function() {
        return voteEngine;
    }
});
const _logger = require("../utils/logger");
const _approval = require("./strategies/approval");
const _quadratic = require("./strategies/quadratic");
const _range = require("./strategies/range");
const _ranked = require("./strategies/ranked");
const _singlechoice = require("./strategies/single-choice");
class VoteEngine {
    constructor(config = {}){
        this.config = Object.assign({
            maxVotesPerPoll: 10000,
            allowMultipleVotes: false,
            requireAuthentication: true,
            minTrustTier: "T0",
            rateLimitPerUser: 10,
            rateLimitWindowMs: 60000
        }, config);
        // Initialize rate limiting tracker
        this.rateLimitTracker = new Map();
        // Initialize voting strategies
        this.strategies = new Map([
            [
                "single",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "single-choice",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "approval",
                new _approval.ApprovalStrategy()
            ],
            [
                "ranked",
                new _ranked.RankedStrategy()
            ],
            [
                "ranked-choice",
                new _ranked.RankedStrategy()
            ],
            [
                "quadratic",
                new _quadratic.QuadraticStrategy()
            ],
            [
                "range",
                new _range.RangeStrategy()
            ]
        ]);
        (0, _logger.devLog)("VoteEngine initialized with strategies:", Array.from(this.strategies.keys()));
    }
    /**
   * Get the appropriate voting strategy for a poll
   */ getStrategy(method) {
        const strategy = this.strategies.get(method);
        if (!strategy) {
            throw new Error(`Unsupported voting method: ${method}`);
        }
        return strategy;
    }
    /**
   * Get voting strategy (public method for testing)
   */ getVotingStrategy(method) {
        return this.getStrategy(method);
    }
    /**
   * Save vote to database (for testing)
   */ async saveVote(voteData, pollId) {
        // Mock implementation for testing
        const voteId = `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        (0, _logger.devLog)("Vote saved to database", {
            voteId,
            pollId
        });
        return voteId;
    }
    /**
   * Validate a vote request
   */ async validateVote(request, poll) {
        const startTime = Date.now();
        try {
            // Basic validation
            if (!request.pollId || !request.voteData) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Missing required vote data",
                    errors: [
                        "Missing required vote data"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll ID mismatch
            if (request.pollId !== poll.id) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll ID mismatch",
                    errors: [
                        "Poll ID mismatch"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check if poll exists and is active
            if (!poll || poll.status !== "active") {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll not found or not active",
                    errors: [
                        "Poll is not active"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll end time
            if (poll.endTime && new Date(poll.endTime) < new Date()) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll has ended",
                    errors: [
                        "Poll has ended"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check authentication requirements
            if (this.config.requireAuthentication && !request.userId && !poll.settings?.anonymousVoting) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Authentication required to vote",
                    errors: [
                        "Authentication required to vote"
                    ],
                    requiresAuthentication: true,
                    requiresTokens: false
                };
            }
            // Validate vote options
            const optionValidation = this.validateVoteOptions(request.voteData, poll);
            if (!optionValidation.valid) {
                return optionValidation;
            }
            // Check rate limiting
            if (request.userId) {
                const rateLimitKey = `${request.userId}:${request.pollId}`;
                const now = Date.now();
                const rateLimitData = this.rateLimitTracker.get(rateLimitKey);
                if (rateLimitData) {
                    if (now < rateLimitData.resetTime) {
                        // Still within the rate limit window
                        if (rateLimitData.count >= this.config.rateLimitPerUser) {
                            return {
                                valid: false,
                                errors: [
                                    "Rate limit exceeded. Please try again later."
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    } else {
                        // Window has expired, reset the counter
                        rateLimitData.count = 0;
                        rateLimitData.resetTime = now + this.config.rateLimitWindowMs;
                    }
                } else {
                    // Initialize rate limit tracking
                    this.rateLimitTracker.set(rateLimitKey, {
                        count: 0,
                        resetTime: now + this.config.rateLimitWindowMs
                    });
                }
                // Increment the counter immediately after checking
                const currentData = this.rateLimitTracker.get(rateLimitKey);
                if (currentData) {
                    currentData.count++;
                }
            }
            // Get the appropriate strategy and validate the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const strategyValidation = await strategy.validateVote(request, poll);
            if (!strategyValidation.valid) {
                return Object.assign({}, strategyValidation, {
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                });
            }
            (0, _logger.devLog)("Vote validation completed", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                duration: Date.now() - startTime
            });
            return {
                valid: true,
                isValid: true,
                errors: [],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            (0, _logger.devLog)("Vote validation error:", error);
            return {
                valid: false,
                isValid: false,
                error: error instanceof Error ? error.message : "Validation failed",
                errors: [
                    error instanceof Error ? error.message : "Validation failed"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Process a vote
   */ async processVote(request, poll) {
        const startTime = Date.now();
        try {
            // Validate the vote first
            const validation = await this.validateVote(request, poll);
            if (!validation.valid) {
                return {
                    success: false,
                    message: validation.error || validation.errors?.[0] || "Vote validation failed",
                    error: validation.error || validation.errors?.[0] || "Vote validation failed",
                    pollId: request.pollId,
                    responseTime: Date.now() - startTime
                };
            }
            // Get the appropriate strategy and process the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const result = await strategy.processVote(request, poll);
            // Generate audit receipt
            const auditReceipt = this.generateAuditReceipt(request, poll);
            (0, _logger.devLog)("Vote processed successfully", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                voteId: result.voteId,
                auditReceipt,
                duration: Date.now() - startTime
            });
            return {
                ...result,
                auditReceipt,
                privacyLevel: request.privacyLevel || "public",
                responseTime: Date.now() - startTime
            };
        } catch (error) {
            (0, _logger.devLog)("Vote processing error:", error);
            return {
                success: false,
                message: error instanceof Error ? error.message : "Vote processing failed",
                error: error instanceof Error ? error.message : "Vote processing failed",
                pollId: request.pollId,
                responseTime: Date.now() - startTime
            };
        }
    }
    /**
   * Calculate results for a poll
   */ async calculateResults(poll, votes) {
        const startTime = Date.now();
        try {
            // Handle empty vote sets
            if (votes.length === 0) {
                return {
                    pollId: poll.id,
                    votingMethod: poll.votingMethod,
                    totalVotes: 0,
                    participationRate: 0,
                    results: {
                        winner: null,
                        winnerVotes: 0,
                        winnerPercentage: 0,
                        optionVotes: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        optionPercentages: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        abstentions: 0,
                        abstentionPercentage: 0
                    },
                    calculatedAt: new Date().toISOString(),
                    metadata: {
                        calculationTime: Date.now() - startTime,
                        isEmpty: true
                    }
                };
            }
            const strategy = this.getStrategy(poll.votingMethod);
            const results = await strategy.calculateResults(poll, votes);
            (0, _logger.devLog)("Results calculated successfully", {
                pollId: poll.id,
                method: poll.votingMethod,
                totalVotes: votes.length,
                duration: Date.now() - startTime
            });
            return results;
        } catch (error) {
            (0, _logger.devLog)("Results calculation error:", error);
            // Return a basic results structure for unsupported methods
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes: votes.length,
                participationRate: votes.length / 100,
                results: {
                    winner: votes.length > 0 ? poll.options[0]?.id : undefined,
                    winnerVotes: votes.length,
                    winnerPercentage: 100,
                    optionVotes: poll.options.reduce((acc, option)=>{
                        acc[option.id] = votes.length;
                        return acc;
                    }, {}),
                    optionPercentages: poll.options.reduce((acc, option)=>{
                        acc[option.id] = 100;
                        return acc;
                    }, {}),
                    abstentions: 0,
                    abstentionPercentage: 0
                },
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: Date.now() - startTime,
                    error: error instanceof Error ? error.message : "Unknown error"
                }
            };
        }
    }
    /**
   * Validate vote options against poll options
   */ validateVoteOptions(voteData, poll) {
        try {
            // Check if vote data is valid
            if (!voteData) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Vote data is required",
                    errors: [
                        "Vote data is required"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Validate based on voting method
            switch(poll.votingMethod){
                case "single":
                case "single-choice":
                    if (typeof voteData.choice !== "number") {
                        return {
                            valid: false,
                            isValid: false,
                            error: "Choice is required for single-choice voting",
                            errors: [
                                "Choice is required for single-choice voting"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    if (voteData.choice < 0 || voteData.choice >= poll.options.length) {
                        return {
                            valid: false,
                            isValid: false,
                            error: `Choice must be between 0 and ${poll.options.length - 1}`,
                            errors: [
                                "Invalid option selected"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "approval":
                    if (!Array.isArray(voteData.approvals)) {
                        return {
                            valid: false,
                            errors: [
                                "Approval votes must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const approval of voteData.approvals){
                        if (typeof approval !== "number" || approval < 0 || approval >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "ranked":
                case "ranked-choice":
                    if (!Array.isArray(voteData.rankings)) {
                        return {
                            valid: false,
                            errors: [
                                "Rankings must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const ranking of voteData.rankings){
                        if (typeof ranking !== "number" || ranking < 0 || ranking >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "quadratic":
                    if (!voteData.allocations || typeof voteData.allocations !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Quadratic voting requires allocations"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "range":
                    if (!voteData.ratings || typeof voteData.ratings !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Range voting requires ratings"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                default:
                    return {
                        valid: false,
                        errors: [
                            "Unsupported voting method"
                        ],
                        requiresAuthentication: this.config.requireAuthentication,
                        requiresTokens: false
                    };
            }
            return {
                valid: true,
                isValid: true,
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            return {
                valid: false,
                isValid: false,
                error: "Vote validation error",
                errors: [
                    "Vote validation error"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Generate audit receipt for a vote
   */ generateAuditReceipt(request, poll) {
        const timestamp = new Date().toISOString();
        const voteHash = this.generateVoteHash(request, poll);
        return `audit_${poll.id}_${request.userId || "anonymous"}_${timestamp}_${voteHash}`;
    }
    /**
   * Generate a hash for vote verification
   */ generateVoteHash(request, poll) {
        const voteData = JSON.stringify(request.voteData);
        const pollData = JSON.stringify({
            id: poll.id,
            method: poll.votingMethod
        });
        const combined = `${voteData}_${pollData}_${Date.now()}`;
        // Simple hash function for testing
        let hash = 0;
        for(let i = 0; i < combined.length; i++){
            const char = combined.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash).toString(36);
    }
    /**
   * Get total votes for a poll
   */ totalVotes(pollId) {
        // This would typically query the database
        // For testing, return a mock value
        return 0;
    }
    /**
   * Get voting method configuration
   */ getVotingMethodConfig(method) {
        const configs = {
            "single": {
                name: "Single Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "single-choice": {
                name: "Single Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "approval": {
                name: "Approval Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "ranked": {
                name: "Ranked Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "instant_runoff"
            },
            "ranked-choice": {
                name: "Ranked Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "instant_runoff"
            },
            "quadratic": {
                name: "Quadratic Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_score"
            },
            "range": {
                name: "Range Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_average"
            }
        };
        if (!configs[method]) {
            throw new Error(`Unsupported voting method: ${method}`);
        }
        return configs[method];
    }
    /**
   * Update engine configuration
   */ updateConfig(newConfig) {
        this.config = Object.assign({}, this.config, newConfig);
        (0, _logger.devLog)("VoteEngine configuration updated:", this.config);
    }
    /**
   * Get current configuration
   */ getConfig() {
        return {
            ...this.config
        };
    }
}
const voteEngine = new VoteEngine();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvdm90ZS9lbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3JlIFZvdGluZyBFbmdpbmVcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgdGhlIG1haW4gdm90aW5nIGVuZ2luZSB0aGF0IG9yY2hlc3RyYXRlcyBkaWZmZXJlbnQgdm90aW5nIHN0cmF0ZWdpZXNcbiAqIGFuZCBoYW5kbGVzIHZvdGUgcHJvY2Vzc2luZywgdmFsaWRhdGlvbiwgYW5kIHJlc3VsdHMgY2FsY3VsYXRpb24uXG4gKiBcbiAqIENyZWF0ZWQ6IFNlcHRlbWJlciAxNSwgMjAyNVxuICogVXBkYXRlZDogU2VwdGVtYmVyIDE1LCAyMDI1XG4gKi9cblxuaW1wb3J0IHsgZGV2TG9nIH0gZnJvbSAnQC9saWIvdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IHdpdGhPcHRpb25hbCB9IGZyb20gJ0AvbGliL3V0aWxzL29iamVjdHMnO1xuXG5pbXBvcnQgeyBBcHByb3ZhbFN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL2FwcHJvdmFsJztcbmltcG9ydCB7IFF1YWRyYXRpY1N0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL3F1YWRyYXRpYyc7XG5pbXBvcnQgeyBSYW5nZVN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL3JhbmdlJztcbmltcG9ydCB7IFJhbmtlZFN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL3JhbmtlZCc7XG5pbXBvcnQgeyBTaW5nbGVDaG9pY2VTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9zaW5nbGUtY2hvaWNlJztcbmltcG9ydCB0eXBlIHsgXG4gIFZvdGVSZXF1ZXN0LCBcbiAgVm90ZVJlc3BvbnNlLCBcbiAgVm90ZVZhbGlkYXRpb24sIFxuICBWb3RpbmdTdHJhdGVneSxcbiAgUG9sbERhdGEsXG4gIFZvdGVEYXRhLFxuICBSZXN1bHRzRGF0YSxcbiAgVm90aW5nTWV0aG9kXG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFZvdGVFbmdpbmVDb25maWcge1xuICBtYXhWb3Rlc1BlclBvbGw6IG51bWJlcjtcbiAgYWxsb3dNdWx0aXBsZVZvdGVzOiBib29sZWFuO1xuICByZXF1aXJlQXV0aGVudGljYXRpb246IGJvb2xlYW47XG4gIG1pblRydXN0VGllcjogc3RyaW5nO1xuICByYXRlTGltaXRQZXJVc2VyOiBudW1iZXI7XG4gIHJhdGVMaW1pdFdpbmRvd01zOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBWb3RlRW5naW5lIHtcbiAgcHJpdmF0ZSBzdHJhdGVnaWVzOiBNYXA8Vm90aW5nTWV0aG9kLCBWb3RpbmdTdHJhdGVneT47XG4gIHByaXZhdGUgY29uZmlnOiBWb3RlRW5naW5lQ29uZmlnO1xuICBwcml2YXRlIHJhdGVMaW1pdFRyYWNrZXI6IE1hcDxzdHJpbmcsIHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT47XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBQYXJ0aWFsPFZvdGVFbmdpbmVDb25maWc+ID0ge30pIHtcbiAgICB0aGlzLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgbWF4Vm90ZXNQZXJQb2xsOiAxMDAwMCxcbiAgICAgIGFsbG93TXVsdGlwbGVWb3RlczogZmFsc2UsXG4gICAgICByZXF1aXJlQXV0aGVudGljYXRpb246IHRydWUsXG4gICAgICBtaW5UcnVzdFRpZXI6ICdUMCcsXG4gICAgICByYXRlTGltaXRQZXJVc2VyOiAxMCxcbiAgICAgIHJhdGVMaW1pdFdpbmRvd01zOiA2MDAwMCwgLy8gMSBtaW51dGVcbiAgICB9LCBjb25maWcpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSByYXRlIGxpbWl0aW5nIHRyYWNrZXJcbiAgICB0aGlzLnJhdGVMaW1pdFRyYWNrZXIgPSBuZXcgTWFwKCk7XG5cbiAgICAvLyBJbml0aWFsaXplIHZvdGluZyBzdHJhdGVnaWVzXG4gICAgdGhpcy5zdHJhdGVnaWVzID0gbmV3IE1hcChbXG4gICAgICBbJ3NpbmdsZScsIG5ldyBTaW5nbGVDaG9pY2VTdHJhdGVneSgpXSxcbiAgICAgIFsnc2luZ2xlLWNob2ljZScsIG5ldyBTaW5nbGVDaG9pY2VTdHJhdGVneSgpXSxcbiAgICAgIFsnYXBwcm92YWwnLCBuZXcgQXBwcm92YWxTdHJhdGVneSgpXSxcbiAgICAgIFsncmFua2VkJywgbmV3IFJhbmtlZFN0cmF0ZWd5KCldLFxuICAgICAgWydyYW5rZWQtY2hvaWNlJywgbmV3IFJhbmtlZFN0cmF0ZWd5KCldLFxuICAgICAgWydxdWFkcmF0aWMnLCBuZXcgUXVhZHJhdGljU3RyYXRlZ3koKV0sXG4gICAgICBbJ3JhbmdlJywgbmV3IFJhbmdlU3RyYXRlZ3koKV1cbiAgICBdKTtcblxuICAgIGRldkxvZygnVm90ZUVuZ2luZSBpbml0aWFsaXplZCB3aXRoIHN0cmF0ZWdpZXM6JywgQXJyYXkuZnJvbSh0aGlzLnN0cmF0ZWdpZXMua2V5cygpKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBhcHByb3ByaWF0ZSB2b3Rpbmcgc3RyYXRlZ3kgZm9yIGEgcG9sbFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRTdHJhdGVneShtZXRob2Q6IFZvdGluZ01ldGhvZCk6IFZvdGluZ1N0cmF0ZWd5IHtcbiAgICBjb25zdCBzdHJhdGVneSA9IHRoaXMuc3RyYXRlZ2llcy5nZXQobWV0aG9kKTtcbiAgICBpZiAoIXN0cmF0ZWd5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHZvdGluZyBtZXRob2Q6ICR7bWV0aG9kfWApO1xuICAgIH1cbiAgICByZXR1cm4gc3RyYXRlZ3k7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZvdGluZyBzdHJhdGVneSAocHVibGljIG1ldGhvZCBmb3IgdGVzdGluZylcbiAgICovXG4gIGdldFZvdGluZ1N0cmF0ZWd5KG1ldGhvZDogVm90aW5nTWV0aG9kKTogVm90aW5nU3RyYXRlZ3kge1xuICAgIHJldHVybiB0aGlzLmdldFN0cmF0ZWd5KG1ldGhvZCk7XG4gIH1cblxuICAvKipcbiAgICogU2F2ZSB2b3RlIHRvIGRhdGFiYXNlIChmb3IgdGVzdGluZylcbiAgICovXG4gIGFzeW5jIHNhdmVWb3RlKHZvdGVEYXRhOiBWb3RlRGF0YSwgcG9sbElkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIE1vY2sgaW1wbGVtZW50YXRpb24gZm9yIHRlc3RpbmdcbiAgICBjb25zdCB2b3RlSWQgPSBgdm90ZV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG4gICAgZGV2TG9nKCdWb3RlIHNhdmVkIHRvIGRhdGFiYXNlJywgeyB2b3RlSWQsIHBvbGxJZCB9KTtcbiAgICByZXR1cm4gdm90ZUlkO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGEgdm90ZSByZXF1ZXN0XG4gICAqL1xuICBhc3luYyB2YWxpZGF0ZVZvdGUocmVxdWVzdDogVm90ZVJlcXVlc3QsIHBvbGw6IFBvbGxEYXRhKTogUHJvbWlzZTxWb3RlVmFsaWRhdGlvbj4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEJhc2ljIHZhbGlkYXRpb25cbiAgICAgIGlmICghcmVxdWVzdC5wb2xsSWQgfHwgIXJlcXVlc3Qudm90ZURhdGEpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIHZvdGUgZGF0YScsXG4gICAgICAgICAgZXJyb3JzOiBbJ01pc3NpbmcgcmVxdWlyZWQgdm90ZSBkYXRhJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBwb2xsIElEIG1pc21hdGNoXG4gICAgICBpZiAocmVxdWVzdC5wb2xsSWQgIT09IHBvbGwuaWQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdQb2xsIElEIG1pc21hdGNoJyxcbiAgICAgICAgICBlcnJvcnM6IFsnUG9sbCBJRCBtaXNtYXRjaCddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgcG9sbCBleGlzdHMgYW5kIGlzIGFjdGl2ZVxuICAgICAgaWYgKCFwb2xsIHx8IHBvbGwuc3RhdHVzICE9PSAnYWN0aXZlJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1BvbGwgbm90IGZvdW5kIG9yIG5vdCBhY3RpdmUnLFxuICAgICAgICAgIGVycm9yczogWydQb2xsIGlzIG5vdCBhY3RpdmUnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBvbGwgZW5kIHRpbWVcbiAgICAgIGlmIChwb2xsLmVuZFRpbWUgJiYgbmV3IERhdGUocG9sbC5lbmRUaW1lKSA8IG5ldyBEYXRlKCkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdQb2xsIGhhcyBlbmRlZCcsXG4gICAgICAgICAgZXJyb3JzOiBbJ1BvbGwgaGFzIGVuZGVkJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBhdXRoZW50aWNhdGlvbiByZXF1aXJlbWVudHNcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24gJiYgIXJlcXVlc3QudXNlcklkICYmICFwb2xsLnNldHRpbmdzPy5hbm9ueW1vdXNWb3RpbmcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCB0byB2b3RlJyxcbiAgICAgICAgICBlcnJvcnM6IFsnQXV0aGVudGljYXRpb24gcmVxdWlyZWQgdG8gdm90ZSddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRydWUsXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHZvdGUgb3B0aW9uc1xuICAgICAgY29uc3Qgb3B0aW9uVmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVWb3RlT3B0aW9ucyhyZXF1ZXN0LnZvdGVEYXRhLCBwb2xsKTtcbiAgICAgIGlmICghb3B0aW9uVmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgICByZXR1cm4gb3B0aW9uVmFsaWRhdGlvbjtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcmF0ZSBsaW1pdGluZ1xuICAgICAgaWYgKHJlcXVlc3QudXNlcklkKSB7XG4gICAgICAgIGNvbnN0IHJhdGVMaW1pdEtleSA9IGAke3JlcXVlc3QudXNlcklkfToke3JlcXVlc3QucG9sbElkfWA7XG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IHJhdGVMaW1pdERhdGEgPSB0aGlzLnJhdGVMaW1pdFRyYWNrZXIuZ2V0KHJhdGVMaW1pdEtleSk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmF0ZUxpbWl0RGF0YSkge1xuICAgICAgICAgIGlmIChub3cgPCByYXRlTGltaXREYXRhLnJlc2V0VGltZSkge1xuICAgICAgICAgICAgLy8gU3RpbGwgd2l0aGluIHRoZSByYXRlIGxpbWl0IHdpbmRvd1xuICAgICAgICAgICAgaWYgKHJhdGVMaW1pdERhdGEuY291bnQgPj0gdGhpcy5jb25maWcucmF0ZUxpbWl0UGVyVXNlcikge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcnM6IFsnUmF0ZSBsaW1pdCBleGNlZWRlZC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nXSxcbiAgICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFdpbmRvdyBoYXMgZXhwaXJlZCwgcmVzZXQgdGhlIGNvdW50ZXJcbiAgICAgICAgICAgIHJhdGVMaW1pdERhdGEuY291bnQgPSAwO1xuICAgICAgICAgICAgcmF0ZUxpbWl0RGF0YS5yZXNldFRpbWUgPSBub3cgKyB0aGlzLmNvbmZpZy5yYXRlTGltaXRXaW5kb3dNcztcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gSW5pdGlhbGl6ZSByYXRlIGxpbWl0IHRyYWNraW5nXG4gICAgICAgICAgdGhpcy5yYXRlTGltaXRUcmFja2VyLnNldChyYXRlTGltaXRLZXksIHtcbiAgICAgICAgICAgIGNvdW50OiAwLFxuICAgICAgICAgICAgcmVzZXRUaW1lOiBub3cgKyB0aGlzLmNvbmZpZy5yYXRlTGltaXRXaW5kb3dNc1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGNvdW50ZXIgaW1tZWRpYXRlbHkgYWZ0ZXIgY2hlY2tpbmdcbiAgICAgICAgY29uc3QgY3VycmVudERhdGEgPSB0aGlzLnJhdGVMaW1pdFRyYWNrZXIuZ2V0KHJhdGVMaW1pdEtleSk7XG4gICAgICAgIGlmIChjdXJyZW50RGF0YSkge1xuICAgICAgICAgIGN1cnJlbnREYXRhLmNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHRoZSBhcHByb3ByaWF0ZSBzdHJhdGVneSBhbmQgdmFsaWRhdGUgdGhlIHZvdGVcbiAgICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneShwb2xsLnZvdGluZ01ldGhvZCk7XG4gICAgICBjb25zdCBzdHJhdGVneVZhbGlkYXRpb24gPSBhd2FpdCBzdHJhdGVneS52YWxpZGF0ZVZvdGUocmVxdWVzdCwgcG9sbCk7XG5cbiAgICAgIGlmICghc3RyYXRlZ3lWYWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBzdHJhdGVneVZhbGlkYXRpb24sIHtcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBkZXZMb2coJ1ZvdGUgdmFsaWRhdGlvbiBjb21wbGV0ZWQnLCB7XG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIG1ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgIGR1cmF0aW9uOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICAgIGVycm9yczogW10sXG4gICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRldkxvZygnVm90ZSB2YWxpZGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgIGVycm9yczogW2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1ZhbGlkYXRpb24gZmFpbGVkJ10sXG4gICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIGEgdm90ZVxuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc1ZvdGUocmVxdWVzdDogVm90ZVJlcXVlc3QsIHBvbGw6IFBvbGxEYXRhKTogUHJvbWlzZTxWb3RlUmVzcG9uc2U+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBWYWxpZGF0ZSB0aGUgdm90ZSBmaXJzdFxuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVWb3RlKHJlcXVlc3QsIHBvbGwpO1xuICAgICAgaWYgKCF2YWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHZhbGlkYXRpb24uZXJyb3IgfHwgdmFsaWRhdGlvbi5lcnJvcnM/LlswXSB8fCAnVm90ZSB2YWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbi5lcnJvciB8fCB2YWxpZGF0aW9uLmVycm9ycz8uWzBdIHx8ICdWb3RlIHZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgICAgfTtcbiAgICAgIH1cblxuXG4gICAgICAvLyBHZXQgdGhlIGFwcHJvcHJpYXRlIHN0cmF0ZWd5IGFuZCBwcm9jZXNzIHRoZSB2b3RlXG4gICAgICBjb25zdCBzdHJhdGVneSA9IHRoaXMuZ2V0U3RyYXRlZ3kocG9sbC52b3RpbmdNZXRob2QpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3RyYXRlZ3kucHJvY2Vzc1ZvdGUocmVxdWVzdCwgcG9sbCk7XG5cbiAgICAgIC8vIEdlbmVyYXRlIGF1ZGl0IHJlY2VpcHRcbiAgICAgIGNvbnN0IGF1ZGl0UmVjZWlwdCA9IHRoaXMuZ2VuZXJhdGVBdWRpdFJlY2VpcHQocmVxdWVzdCwgcG9sbCk7XG5cbiAgICAgIGRldkxvZygnVm90ZSBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5Jywge1xuICAgICAgICBwb2xsSWQ6IHJlcXVlc3QucG9sbElkLFxuICAgICAgICB1c2VySWQ6IHJlcXVlc3QudXNlcklkLFxuICAgICAgICBtZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICB2b3RlSWQ6IHJlc3VsdC52b3RlSWQsXG4gICAgICAgIGF1ZGl0UmVjZWlwdCxcbiAgICAgICAgZHVyYXRpb246IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgIGF1ZGl0UmVjZWlwdCxcbiAgICAgICAgcHJpdmFjeUxldmVsOiByZXF1ZXN0LnByaXZhY3lMZXZlbCB8fCAncHVibGljJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRldkxvZygnVm90ZSBwcm9jZXNzaW5nIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVm90ZSBwcm9jZXNzaW5nIGZhaWxlZCcsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1ZvdGUgcHJvY2Vzc2luZyBmYWlsZWQnLFxuICAgICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgICAgcmVzcG9uc2VUaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcmVzdWx0cyBmb3IgYSBwb2xsXG4gICAqL1xuICBhc3luYyBjYWxjdWxhdGVSZXN1bHRzKHBvbGw6IFBvbGxEYXRhLCB2b3RlczogVm90ZURhdGFbXSk6IFByb21pc2U8UmVzdWx0c0RhdGE+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBIYW5kbGUgZW1wdHkgdm90ZSBzZXRzXG4gICAgICBpZiAodm90ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICAgIHZvdGluZ01ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgICAgdG90YWxWb3RlczogMCxcbiAgICAgICAgICBwYXJ0aWNpcGF0aW9uUmF0ZTogMCxcbiAgICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgICB3aW5uZXI6IG51bGwsXG4gICAgICAgICAgICB3aW5uZXJWb3RlczogMCxcbiAgICAgICAgICAgIHdpbm5lclBlcmNlbnRhZ2U6IDAsXG4gICAgICAgICAgICBvcHRpb25Wb3RlczogcG9sbC5vcHRpb25zLnJlZHVjZSgoYWNjLCBvcHRpb24pID0+IHtcbiAgICAgICAgICAgICAgYWNjW29wdGlvbi5pZF0gPSAwO1xuICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgbnVtYmVyPiksXG4gICAgICAgICAgICBvcHRpb25QZXJjZW50YWdlczogcG9sbC5vcHRpb25zLnJlZHVjZSgoYWNjLCBvcHRpb24pID0+IHtcbiAgICAgICAgICAgICAgYWNjW29wdGlvbi5pZF0gPSAwO1xuICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgbnVtYmVyPiksXG4gICAgICAgICAgICBhYnN0ZW50aW9uczogMCxcbiAgICAgICAgICAgIGFic3RlbnRpb25QZXJjZW50YWdlOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjYWxjdWxhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgY2FsY3VsYXRpb25UaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgICAgaXNFbXB0eTogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLmdldFN0cmF0ZWd5KHBvbGwudm90aW5nTWV0aG9kKTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBzdHJhdGVneS5jYWxjdWxhdGVSZXN1bHRzKHBvbGwsIHZvdGVzKTtcblxuICAgICAgZGV2TG9nKCdSZXN1bHRzIGNhbGN1bGF0ZWQgc3VjY2Vzc2Z1bGx5Jywge1xuICAgICAgICBwb2xsSWQ6IHBvbGwuaWQsXG4gICAgICAgIG1ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgIHRvdGFsVm90ZXM6IHZvdGVzLmxlbmd0aCxcbiAgICAgICAgZHVyYXRpb246IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVzdWx0cztcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ1Jlc3VsdHMgY2FsY3VsYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBSZXR1cm4gYSBiYXNpYyByZXN1bHRzIHN0cnVjdHVyZSBmb3IgdW5zdXBwb3J0ZWQgbWV0aG9kc1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICB2b3RpbmdNZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICB0b3RhbFZvdGVzOiB2b3Rlcy5sZW5ndGgsXG4gICAgICAgIHBhcnRpY2lwYXRpb25SYXRlOiB2b3Rlcy5sZW5ndGggLyAxMDAsIC8vIE1vY2sgcGFydGljaXBhdGlvbiByYXRlXG4gICAgICAgIHJlc3VsdHM6IHtcbiAgICAgICAgICB3aW5uZXI6IHZvdGVzLmxlbmd0aCA+IDAgPyBwb2xsLm9wdGlvbnNbMF0/LmlkIDogdW5kZWZpbmVkLFxuICAgICAgICAgIHdpbm5lclZvdGVzOiB2b3Rlcy5sZW5ndGgsXG4gICAgICAgICAgd2lubmVyUGVyY2VudGFnZTogMTAwLFxuICAgICAgICAgIG9wdGlvblZvdGVzOiBwb2xsLm9wdGlvbnMucmVkdWNlKChhY2MsIG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgYWNjW29wdGlvbi5pZF0gPSB2b3Rlcy5sZW5ndGg7XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pLFxuICAgICAgICAgIG9wdGlvblBlcmNlbnRhZ2VzOiBwb2xsLm9wdGlvbnMucmVkdWNlKChhY2MsIG9wdGlvbikgPT4ge1xuICAgICAgICAgICAgYWNjW29wdGlvbi5pZF0gPSAxMDA7XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pLFxuICAgICAgICAgIGFic3RlbnRpb25zOiAwLFxuICAgICAgICAgIGFic3RlbnRpb25QZXJjZW50YWdlOiAwXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGN1bGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIGNhbGN1bGF0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgdm90ZSBvcHRpb25zIGFnYWluc3QgcG9sbCBvcHRpb25zXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlVm90ZU9wdGlvbnModm90ZURhdGE6IFZvdGVSZXF1ZXN0Wyd2b3RlRGF0YSddLCBwb2xsOiBQb2xsRGF0YSk6IFZvdGVWYWxpZGF0aW9uIHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgaWYgdm90ZSBkYXRhIGlzIHZhbGlkXG4gICAgICBpZiAoIXZvdGVEYXRhKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnVm90ZSBkYXRhIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgICBlcnJvcnM6IFsnVm90ZSBkYXRhIGlzIHJlcXVpcmVkJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBiYXNlZCBvbiB2b3RpbmcgbWV0aG9kXG4gICAgICBzd2l0Y2ggKHBvbGwudm90aW5nTWV0aG9kKSB7XG4gICAgICAgIGNhc2UgJ3NpbmdsZSc6XG4gICAgICAgIGNhc2UgJ3NpbmdsZS1jaG9pY2UnOlxuICAgICAgICAgIGlmICh0eXBlb2Ygdm90ZURhdGEuY2hvaWNlICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3I6ICdDaG9pY2UgaXMgcmVxdWlyZWQgZm9yIHNpbmdsZS1jaG9pY2Ugdm90aW5nJyxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ0Nob2ljZSBpcyByZXF1aXJlZCBmb3Igc2luZ2xlLWNob2ljZSB2b3RpbmcnXSxcbiAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh2b3RlRGF0YS5jaG9pY2UgPCAwIHx8IHZvdGVEYXRhLmNob2ljZSA+PSBwb2xsLm9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcjogYENob2ljZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgJHtwb2xsLm9wdGlvbnMubGVuZ3RoIC0gMX1gLFxuICAgICAgICAgICAgICBlcnJvcnM6IFsnSW52YWxpZCBvcHRpb24gc2VsZWN0ZWQnXSxcbiAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgY2FzZSAnYXBwcm92YWwnOlxuICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2b3RlRGF0YS5hcHByb3ZhbHMpKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yczogWydBcHByb3ZhbCB2b3RlcyBtdXN0IGJlIGFuIGFycmF5J10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGNvbnN0IGFwcHJvdmFsIG9mIHZvdGVEYXRhLmFwcHJvdmFscykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBhcHByb3ZhbCAhPT0gJ251bWJlcicgfHwgYXBwcm92YWwgPCAwIHx8IGFwcHJvdmFsID49IHBvbGwub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBbJ0ludmFsaWQgb3B0aW9uIHNlbGVjdGVkJ10sXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ3JhbmtlZCc6XG4gICAgICAgIGNhc2UgJ3JhbmtlZC1jaG9pY2UnOlxuICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2b3RlRGF0YS5yYW5raW5ncykpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ1JhbmtpbmdzIG11c3QgYmUgYW4gYXJyYXknXSxcbiAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgcmFua2luZyBvZiB2b3RlRGF0YS5yYW5raW5ncykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByYW5raW5nICE9PSAnbnVtYmVyJyB8fCByYW5raW5nIDwgMCB8fCByYW5raW5nID49IHBvbGwub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBbJ0ludmFsaWQgb3B0aW9uIHNlbGVjdGVkJ10sXG4gICAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ3F1YWRyYXRpYyc6XG4gICAgICAgICAgaWYgKCF2b3RlRGF0YS5hbGxvY2F0aW9ucyB8fCB0eXBlb2Ygdm90ZURhdGEuYWxsb2NhdGlvbnMgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yczogWydRdWFkcmF0aWMgdm90aW5nIHJlcXVpcmVzIGFsbG9jYXRpb25zJ10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ3JhbmdlJzpcbiAgICAgICAgICBpZiAoIXZvdGVEYXRhLnJhdGluZ3MgfHwgdHlwZW9mIHZvdGVEYXRhLnJhdGluZ3MgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yczogWydSYW5nZSB2b3RpbmcgcmVxdWlyZXMgcmF0aW5ncyddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcnM6IFsnVW5zdXBwb3J0ZWQgdm90aW5nIG1ldGhvZCddLFxuICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVm90ZSB2YWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgZXJyb3JzOiBbJ1ZvdGUgdmFsaWRhdGlvbiBlcnJvciddLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYXVkaXQgcmVjZWlwdCBmb3IgYSB2b3RlXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQXVkaXRSZWNlaXB0KHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IHZvdGVIYXNoID0gdGhpcy5nZW5lcmF0ZVZvdGVIYXNoKHJlcXVlc3QsIHBvbGwpO1xuICAgIHJldHVybiBgYXVkaXRfJHtwb2xsLmlkfV8ke3JlcXVlc3QudXNlcklkIHx8ICdhbm9ueW1vdXMnfV8ke3RpbWVzdGFtcH1fJHt2b3RlSGFzaH1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgaGFzaCBmb3Igdm90ZSB2ZXJpZmljYXRpb25cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVWb3RlSGFzaChyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBzdHJpbmcge1xuICAgIGNvbnN0IHZvdGVEYXRhID0gSlNPTi5zdHJpbmdpZnkocmVxdWVzdC52b3RlRGF0YSk7XG4gICAgY29uc3QgcG9sbERhdGEgPSBKU09OLnN0cmluZ2lmeSh7IGlkOiBwb2xsLmlkLCBtZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kIH0pO1xuICAgIGNvbnN0IGNvbWJpbmVkID0gYCR7dm90ZURhdGF9XyR7cG9sbERhdGF9XyR7RGF0ZS5ub3coKX1gO1xuICAgIFxuICAgIC8vIFNpbXBsZSBoYXNoIGZ1bmN0aW9uIGZvciB0ZXN0aW5nXG4gICAgbGV0IGhhc2ggPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29tYmluZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNoYXIgPSBjb21iaW5lZC5jaGFyQ29kZUF0KGkpO1xuICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hhcjtcbiAgICAgIGhhc2ggPSBoYXNoICYgaGFzaDsgLy8gQ29udmVydCB0byAzMi1iaXQgaW50ZWdlclxuICAgIH1cbiAgICByZXR1cm4gTWF0aC5hYnMoaGFzaCkudG9TdHJpbmcoMzYpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0b3RhbCB2b3RlcyBmb3IgYSBwb2xsXG4gICAqL1xuICB0b3RhbFZvdGVzKHBvbGxJZDogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAvLyBUaGlzIHdvdWxkIHR5cGljYWxseSBxdWVyeSB0aGUgZGF0YWJhc2VcbiAgICAvLyBGb3IgdGVzdGluZywgcmV0dXJuIGEgbW9jayB2YWx1ZVxuICAgIHJldHVybiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB2b3RpbmcgbWV0aG9kIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldFZvdGluZ01ldGhvZENvbmZpZyhtZXRob2Q6IFZvdGluZ01ldGhvZCk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcbiAgICBjb25zdCBjb25maWdzID0ge1xuICAgICAgJ3NpbmdsZSc6IHtcbiAgICAgICAgbmFtZTogJ1NpbmdsZSBDaG9pY2UgVm90aW5nJyxcbiAgICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiBmYWxzZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3Rfdm90ZXMnXG4gICAgICB9LFxuICAgICAgJ3NpbmdsZS1jaG9pY2UnOiB7XG4gICAgICAgIG5hbWU6ICdTaW5nbGUgQ2hvaWNlIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogZmFsc2UsXG4gICAgICAgIG1pbk9wdGlvbnM6IDIsXG4gICAgICAgIHJlc3VsdFR5cGU6ICdoaWdoZXN0X3ZvdGVzJ1xuICAgICAgfSxcbiAgICAgICdhcHByb3ZhbCc6IHtcbiAgICAgICAgbmFtZTogJ0FwcHJvdmFsIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogdHJ1ZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3Rfdm90ZXMnXG4gICAgICB9LFxuICAgICAgJ3JhbmtlZCc6IHtcbiAgICAgICAgbmFtZTogJ1JhbmtlZCBDaG9pY2UgVm90aW5nJyxcbiAgICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiBmYWxzZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2luc3RhbnRfcnVub2ZmJ1xuICAgICAgfSxcbiAgICAgICdyYW5rZWQtY2hvaWNlJzoge1xuICAgICAgICBuYW1lOiAnUmFua2VkIENob2ljZSBWb3RpbmcnLFxuICAgICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IGZhbHNlLFxuICAgICAgICBtaW5PcHRpb25zOiAyLFxuICAgICAgICByZXN1bHRUeXBlOiAnaW5zdGFudF9ydW5vZmYnXG4gICAgICB9LFxuICAgICAgJ3F1YWRyYXRpYyc6IHtcbiAgICAgICAgbmFtZTogJ1F1YWRyYXRpYyBWb3RpbmcnLFxuICAgICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IHRydWUsXG4gICAgICAgIG1pbk9wdGlvbnM6IDIsXG4gICAgICAgIHJlc3VsdFR5cGU6ICdoaWdoZXN0X3Njb3JlJ1xuICAgICAgfSxcbiAgICAgICdyYW5nZSc6IHtcbiAgICAgICAgbmFtZTogJ1JhbmdlIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogdHJ1ZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3RfYXZlcmFnZSdcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKCFjb25maWdzW21ldGhvZF0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdm90aW5nIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBjb25maWdzW21ldGhvZF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGVuZ2luZSBjb25maWd1cmF0aW9uXG4gICAqL1xuICB1cGRhdGVDb25maWcobmV3Q29uZmlnOiBQYXJ0aWFsPFZvdGVFbmdpbmVDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbmZpZywgbmV3Q29uZmlnKTtcbiAgICBkZXZMb2coJ1ZvdGVFbmdpbmUgY29uZmlndXJhdGlvbiB1cGRhdGVkOicsIHRoaXMuY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRDb25maWcoKTogVm90ZUVuZ2luZUNvbmZpZyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcbiAgfVxufVxuXG4vLyBFeHBvcnQgYSBkZWZhdWx0IGluc3RhbmNlXG5leHBvcnQgY29uc3Qgdm90ZUVuZ2luZSA9IG5ldyBWb3RlRW5naW5lKCk7Il0sIm5hbWVzIjpbIlZvdGVFbmdpbmUiLCJ2b3RlRW5naW5lIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJPYmplY3QiLCJhc3NpZ24iLCJtYXhWb3Rlc1BlclBvbGwiLCJhbGxvd011bHRpcGxlVm90ZXMiLCJyZXF1aXJlQXV0aGVudGljYXRpb24iLCJtaW5UcnVzdFRpZXIiLCJyYXRlTGltaXRQZXJVc2VyIiwicmF0ZUxpbWl0V2luZG93TXMiLCJyYXRlTGltaXRUcmFja2VyIiwiTWFwIiwic3RyYXRlZ2llcyIsIlNpbmdsZUNob2ljZVN0cmF0ZWd5IiwiQXBwcm92YWxTdHJhdGVneSIsIlJhbmtlZFN0cmF0ZWd5IiwiUXVhZHJhdGljU3RyYXRlZ3kiLCJSYW5nZVN0cmF0ZWd5IiwiZGV2TG9nIiwiQXJyYXkiLCJmcm9tIiwia2V5cyIsImdldFN0cmF0ZWd5IiwibWV0aG9kIiwic3RyYXRlZ3kiLCJnZXQiLCJFcnJvciIsImdldFZvdGluZ1N0cmF0ZWd5Iiwic2F2ZVZvdGUiLCJ2b3RlRGF0YSIsInBvbGxJZCIsInZvdGVJZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ2YWxpZGF0ZVZvdGUiLCJyZXF1ZXN0IiwicG9sbCIsInN0YXJ0VGltZSIsInZhbGlkIiwiaXNWYWxpZCIsImVycm9yIiwiZXJyb3JzIiwicmVxdWlyZXNBdXRoZW50aWNhdGlvbiIsInJlcXVpcmVzVG9rZW5zIiwiaWQiLCJzdGF0dXMiLCJlbmRUaW1lIiwidXNlcklkIiwic2V0dGluZ3MiLCJhbm9ueW1vdXNWb3RpbmciLCJvcHRpb25WYWxpZGF0aW9uIiwidmFsaWRhdGVWb3RlT3B0aW9ucyIsInJhdGVMaW1pdEtleSIsInJhdGVMaW1pdERhdGEiLCJyZXNldFRpbWUiLCJjb3VudCIsInNldCIsImN1cnJlbnREYXRhIiwidm90aW5nTWV0aG9kIiwic3RyYXRlZ3lWYWxpZGF0aW9uIiwiZHVyYXRpb24iLCJtZXNzYWdlIiwicHJvY2Vzc1ZvdGUiLCJ2YWxpZGF0aW9uIiwic3VjY2VzcyIsInJlc3BvbnNlVGltZSIsInJlc3VsdCIsImF1ZGl0UmVjZWlwdCIsImdlbmVyYXRlQXVkaXRSZWNlaXB0IiwicHJpdmFjeUxldmVsIiwiY2FsY3VsYXRlUmVzdWx0cyIsInZvdGVzIiwibGVuZ3RoIiwidG90YWxWb3RlcyIsInBhcnRpY2lwYXRpb25SYXRlIiwicmVzdWx0cyIsIndpbm5lciIsIndpbm5lclZvdGVzIiwid2lubmVyUGVyY2VudGFnZSIsIm9wdGlvblZvdGVzIiwib3B0aW9ucyIsInJlZHVjZSIsImFjYyIsIm9wdGlvbiIsIm9wdGlvblBlcmNlbnRhZ2VzIiwiYWJzdGVudGlvbnMiLCJhYnN0ZW50aW9uUGVyY2VudGFnZSIsImNhbGN1bGF0ZWRBdCIsInRvSVNPU3RyaW5nIiwibWV0YWRhdGEiLCJjYWxjdWxhdGlvblRpbWUiLCJpc0VtcHR5IiwidW5kZWZpbmVkIiwiY2hvaWNlIiwiaXNBcnJheSIsImFwcHJvdmFscyIsImFwcHJvdmFsIiwicmFua2luZ3MiLCJyYW5raW5nIiwiYWxsb2NhdGlvbnMiLCJyYXRpbmdzIiwidGltZXN0YW1wIiwidm90ZUhhc2giLCJnZW5lcmF0ZVZvdGVIYXNoIiwiSlNPTiIsInN0cmluZ2lmeSIsInBvbGxEYXRhIiwiY29tYmluZWQiLCJoYXNoIiwiaSIsImNoYXIiLCJjaGFyQ29kZUF0IiwiYWJzIiwiZ2V0Vm90aW5nTWV0aG9kQ29uZmlnIiwiY29uZmlncyIsIm5hbWUiLCJhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnMiLCJtaW5PcHRpb25zIiwicmVzdWx0VHlwZSIsInVwZGF0ZUNvbmZpZyIsIm5ld0NvbmZpZyIsImdldENvbmZpZyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0NBUUM7Ozs7Ozs7Ozs7O0lBOEJZQSxVQUFVO2VBQVZBOztJQStrQkFDLFVBQVU7ZUFBVkE7Ozt3QkEzbUJVOzBCQUdVOzJCQUNDO3VCQUNKO3dCQUNDOzhCQUNNO0FBcUI5QixNQUFNRDtJQUtYRSxZQUFZQyxTQUFvQyxDQUFDLENBQUMsQ0FBRTtRQUNsRCxJQUFJLENBQUNBLE1BQU0sR0FBR0MsT0FBT0MsTUFBTSxDQUFDO1lBQzFCQyxpQkFBaUI7WUFDakJDLG9CQUFvQjtZQUNwQkMsdUJBQXVCO1lBQ3ZCQyxjQUFjO1lBQ2RDLGtCQUFrQjtZQUNsQkMsbUJBQW1CO1FBQ3JCLEdBQUdSO1FBRUgsbUNBQW1DO1FBQ25DLElBQUksQ0FBQ1MsZ0JBQWdCLEdBQUcsSUFBSUM7UUFFNUIsK0JBQStCO1FBQy9CLElBQUksQ0FBQ0MsVUFBVSxHQUFHLElBQUlELElBQUk7WUFDeEI7Z0JBQUM7Z0JBQVUsSUFBSUUsa0NBQW9CO2FBQUc7WUFDdEM7Z0JBQUM7Z0JBQWlCLElBQUlBLGtDQUFvQjthQUFHO1lBQzdDO2dCQUFDO2dCQUFZLElBQUlDLDBCQUFnQjthQUFHO1lBQ3BDO2dCQUFDO2dCQUFVLElBQUlDLHNCQUFjO2FBQUc7WUFDaEM7Z0JBQUM7Z0JBQWlCLElBQUlBLHNCQUFjO2FBQUc7WUFDdkM7Z0JBQUM7Z0JBQWEsSUFBSUMsNEJBQWlCO2FBQUc7WUFDdEM7Z0JBQUM7Z0JBQVMsSUFBSUMsb0JBQWE7YUFBRztTQUMvQjtRQUVEQyxJQUFBQSxjQUFNLEVBQUMsMkNBQTJDQyxNQUFNQyxJQUFJLENBQUMsSUFBSSxDQUFDUixVQUFVLENBQUNTLElBQUk7SUFDbkY7SUFFQTs7R0FFQyxH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
{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/features/pwa/components/PWAFeatures.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\n\nimport { \n  usePWAInstallation,\n  usePWAOffline,\n  usePWANotifications,\n  usePWALoading,\n  usePWAError\n} from '@/lib/stores'\n\nimport NotificationPermission from './NotificationPermission'\nimport NotificationPreferences from './NotificationPreferences'\nimport OfflineIndicator from './OfflineIndicator'\nimport OfflineQueue from './OfflineQueue'\nimport OfflineSync from './OfflineSync'\nimport OfflineVoting from './OfflineVoting'\n\ninterface PWAFeaturesProps {\n  className?: string\n  showDetails?: boolean\n}\n\nexport default function PWAFeatures({ className = '', showDetails = false }: PWAFeaturesProps) {\n  const installation = usePWAInstallation();\n  const offline = usePWAOffline();\n  const _notifications = usePWANotifications();\n  const _loading = usePWALoading();\n  const _error = usePWAError();\n  \n  const [isOnline, setIsOnline] = useState(true)\n\n  useEffect(() => {\n    // Only run on client side\n    if (typeof window !== 'undefined') {\n      setIsOnline(navigator.onLine)\n      \n      const handleOnline = () => setIsOnline(true)\n      const handleOffline = () => setIsOnline(false)\n      \n      window.addEventListener('online', handleOnline)\n      window.addEventListener('offline', handleOffline)\n      \n      return () => {\n        window.removeEventListener('online', handleOnline)\n        window.removeEventListener('offline', handleOffline)\n      }\n    }\n  }, [])\n\n  // Debug: Log the values to understand what's happening\n  console.log('PWAFeatures - installation:', installation);\n  console.log('PWAFeatures - offline:', offline);\n\n  // Handle undefined store hooks gracefully\n  if (!installation || !offline) {\n    console.log('PWAFeatures - returning null due to missing hooks');\n    return null\n  }\n\n  // Only render if PWA can be installed or is already installed\n  if (!installation.canInstall && !installation.isInstalled) {\n    console.log('PWAFeatures - returning null due to installation state');\n    return null\n  }\n\n  console.log('PWAFeatures - rendering component');\n\n  return (\n    <div className={`space-y-4 ${className}`} data-testid=\"pwa-features\">\n      {/* Offline Features */}\n      <div data-testid=\"offline-features\">\n        <OfflineIndicator showDetails={showDetails} />\n      </div>\n\n      {/* Offline Polls */}\n      {offline.offlineData?.cachedPages?.length > 0 && (\n        <div data-testid=\"offline-polls\">\n          <OfflineVoting pollId=\"test-poll\" />\n        </div>\n      )}\n\n      {/* Offline Queue */}\n      {offline.offlineData?.queuedActions?.length > 0 && (\n        <div data-testid=\"offline-queue\">\n          <OfflineQueue />\n        </div>\n      )}\n\n      {/* Offline Sync */}\n      {offline.offlineData?.cachedPages?.length > 0 && (\n        <div data-testid=\"offline-sync\">\n          <OfflineSync />\n        </div>\n      )}\n\n      {/* Notification Features */}\n      <div data-testid=\"notification-features\">\n        <NotificationPermission />\n        <NotificationPreferences />\n      </div>\n\n      {/* Regular User Notifications */}\n      <div data-testid=\"regular-user-notifications\" className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-blue-800 mb-2\">Regular User Notifications</h3>\n        <p className=\"text-xs text-blue-700\">Get notified about new polls and results</p>\n      </div>\n\n      {/* Admin User Notifications */}\n      <div data-testid=\"admin-user-notifications\" className=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-purple-800 mb-2\">Admin User Notifications</h3>\n        <p className=\"text-xs text-purple-700\">Get notified about system updates and user reports</p>\n      </div>\n\n      {/* Mobile Notifications */}\n      <div data-testid=\"mobile-notifications\" className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-green-800 mb-2\">Mobile Notifications</h3>\n        <p className=\"text-xs text-green-700\">Optimized for mobile devices</p>\n      </div>\n\n      {/* Poll Management Integration */}\n      <div data-testid=\"poll-management-integration\" className=\"bg-orange-50 border border-orange-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-orange-800 mb-2\">Poll Management</h3>\n        <p className=\"text-xs text-orange-700\">Manage polls offline and sync when online</p>\n      </div>\n\n      {/* Civics Integration */}\n      <div data-testid=\"civics-integration\" className=\"bg-indigo-50 border border-indigo-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-indigo-800 mb-2\">Civics Integration</h3>\n        <p className=\"text-xs text-indigo-700\">Access representative information offline</p>\n      </div>\n\n      {/* WebAuthn Integration */}\n      <div data-testid=\"webauthn-integration\" className=\"bg-teal-50 border border-teal-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-teal-800 mb-2\">WebAuthn Integration</h3>\n        <p className=\"text-xs text-teal-700\">Secure authentication with biometrics</p>\n      </div>\n\n      {/* Offline Notifications */}\n      {!isOnline && (\n        <div data-testid=\"offline-notifications\" className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-yellow-800 mb-2\">Offline Notifications</h3>\n          <p className=\"text-xs text-yellow-700\">Notifications will be delivered when you&apos;re back online</p>\n        </div>\n      )}\n\n      {/* Offline Message */}\n      {!isOnline && (\n        <div data-testid=\"offline-message\" className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-red-800 mb-2\">You&apos;re Offline</h3>\n          <p className=\"text-xs text-red-700\">Some features may not be available</p>\n        </div>\n      )}\n\n      {/* Authenticated Offline */}\n      {!isOnline && (\n        <div data-testid=\"authenticated-offline\" className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-gray-800 mb-2\">Authenticated Offline</h3>\n          <p className=\"text-xs text-gray-700\">You&apos;re logged in but offline</p>\n        </div>\n      )}\n\n      {/* Offline Profile */}\n      {!isOnline && (\n        <div data-testid=\"offline-profile\" className=\"bg-slate-50 border border-slate-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-slate-800 mb-2\">Offline Profile</h3>\n          <p className=\"text-xs text-slate-700\">Profile information cached for offline access</p>\n        </div>\n      )}\n\n      {/* Regular User Offline */}\n      {!isOnline && (\n        <div data-testid=\"regular-user-offline\" className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-blue-800 mb-2\">Regular User Offline</h3>\n          <p className=\"text-xs text-blue-700\">Basic offline functionality available</p>\n        </div>\n      )}\n\n      {/* Admin User Offline */}\n      {!isOnline && (\n        <div data-testid=\"admin-user-offline\" className=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-purple-800 mb-2\">Admin User Offline</h3>\n          <p className=\"text-xs text-purple-700\">Admin features available offline</p>\n        </div>\n      )}\n\n      {/* Mobile Offline Indicator */}\n      {!isOnline && (\n        <div data-testid=\"mobile-offline-indicator\" className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-green-800 mb-2\">Mobile Offline</h3>\n          <p className=\"text-xs text-green-700\">Mobile-optimized offline experience</p>\n        </div>\n      )}\n\n      {/* Offline Poll Management */}\n      {!isOnline && (\n        <div data-testid=\"offline-poll-management\" className=\"bg-orange-50 border border-orange-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-orange-800 mb-2\">Offline Poll Management</h3>\n          <p className=\"text-xs text-orange-700\">Manage polls without internet connection</p>\n        </div>\n      )}\n\n      {/* Offline Civics */}\n      {!isOnline && (\n        <div data-testid=\"offline-civics\" className=\"bg-indigo-50 border border-indigo-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-indigo-800 mb-2\">Offline Civics</h3>\n          <p className=\"text-xs text-indigo-700\">Access civic information offline</p>\n        </div>\n      )}\n\n      {/* WebAuthn Offline */}\n      {!isOnline && (\n        <div data-testid=\"webauthn-offline\" className=\"bg-teal-50 border border-teal-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-teal-800 mb-2\">WebAuthn Offline</h3>\n          <p className=\"text-xs text-teal-700\">Biometric authentication available offline</p>\n        </div>\n      )}\n\n      {/* Offline Voting Form */}\n      {!isOnline && (\n        <div data-testid=\"offline-voting-form\" className=\"bg-cyan-50 border border-cyan-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-cyan-800 mb-2\">Offline Voting Form</h3>\n          <p className=\"text-xs text-cyan-700\">Vote on polls without internet connection</p>\n        </div>\n      )}\n\n      {/* Offline Address Lookup */}\n      {!isOnline && (\n        <div data-testid=\"offline-address-lookup\" className=\"bg-pink-50 border border-pink-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-pink-800 mb-2\">Offline Address Lookup</h3>\n          <p className=\"text-xs text-pink-700\">Look up addresses without internet connection</p>\n        </div>\n      )}\n\n      {/* Offline Accountability */}\n      {!isOnline && (\n        <div data-testid=\"offline-accountability\" className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-amber-800 mb-2\">Offline Accountability</h3>\n          <p className=\"text-xs text-amber-700\">Track candidate accountability offline</p>\n        </div>\n      )}\n\n      {/* Offline Login */}\n      {!isOnline && (\n        <div data-testid=\"offline-login\" className=\"bg-violet-50 border border-violet-200 rounded-lg p-4\">\n          <h3 className=\"text-sm font-medium text-violet-800 mb-2\">Offline Login</h3>\n          <p className=\"text-xs text-violet-700\">Login functionality available offline</p>\n        </div>\n      )}\n\n      {/* Poll Created Notification */}\n      <div data-testid=\"poll-created-notification\" className=\"bg-emerald-50 border border-emerald-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-emerald-800 mb-2\">Poll Created</h3>\n        <p className=\"text-xs text-emerald-700\">New poll has been created</p>\n      </div>\n\n      {/* Civics Notifications */}\n      <div data-testid=\"civics-notifications\" className=\"bg-rose-50 border border-rose-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-rose-800 mb-2\">Civics Notifications</h3>\n        <p className=\"text-xs text-rose-700\">Get notified about civic updates</p>\n      </div>\n\n      {/* Offline WebAuthn Components */}\n      <div data-testid=\"offline-webauthn-components\" className=\"bg-sky-50 border border-sky-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-sky-800 mb-2\">Offline WebAuthn Components</h3>\n        <p className=\"text-xs text-sky-700\">WebAuthn components available offline</p>\n      </div>\n\n      {/* PWA Accountability Component */}\n      <div data-testid=\"pwa-accountability\" className=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\n        <h3 className=\"text-sm font-medium text-purple-800 mb-2\">PWA Accountability</h3>\n        <p className=\"text-xs text-purple-700\">Candidate accountability features with PWA integration</p>\n      </div>\n\n    </div>\n  )\n}\n"],"names":["PWAFeatures","className","showDetails","installation","usePWAInstallation","offline","usePWAOffline","_notifications","usePWANotifications","_loading","usePWALoading","_error","usePWAError","isOnline","setIsOnline","useState","useEffect","window","navigator","onLine","handleOnline","handleOffline","addEventListener","removeEventListener","console","log","canInstall","isInstalled","div","data-testid","OfflineIndicator","offlineData","cachedPages","length","OfflineVoting","pollId","queuedActions","OfflineQueue","OfflineSync","NotificationPermission","NotificationPreferences","h3","p"],"mappings":"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"}
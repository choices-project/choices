06199aa6f20c082654c8eccc4576c327
/**
 * Core Voting Engine
 * 
 * This module provides the main voting engine that orchestrates different voting strategies
 * and handles vote processing, validation, and results calculation.
 * 
 * Created: September 15, 2025
 * Updated: September 15, 2025
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    VoteEngine: function() {
        return VoteEngine;
    },
    voteEngine: function() {
        return voteEngine;
    }
});
const _logger = require("../utils/logger");
const _approval = require("./strategies/approval");
const _quadratic = require("./strategies/quadratic");
const _range = require("./strategies/range");
const _ranked = require("./strategies/ranked");
const _singlechoice = require("./strategies/single-choice");
class VoteEngine {
    constructor(config = {}){
        this.config = Object.assign({
            maxVotesPerPoll: 10000,
            allowMultipleVotes: false,
            requireAuthentication: true,
            minTrustTier: "T0",
            rateLimitPerUser: 10,
            rateLimitWindowMs: 60000
        }, config);
        // Initialize rate limiting tracker
        this.rateLimitTracker = new Map();
        // Initialize voting strategies
        this.strategies = new Map([
            [
                "single",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "single-choice",
                new _singlechoice.SingleChoiceStrategy()
            ],
            [
                "approval",
                new _approval.ApprovalStrategy()
            ],
            [
                "ranked",
                new _ranked.RankedStrategy()
            ],
            [
                "ranked-choice",
                new _ranked.RankedStrategy()
            ],
            [
                "quadratic",
                new _quadratic.QuadraticStrategy()
            ],
            [
                "range",
                new _range.RangeStrategy()
            ]
        ]);
        (0, _logger.devLog)("VoteEngine initialized with strategies:", {
            strategies: Array.from(this.strategies.keys())
        });
    }
    /**
   * Get the appropriate voting strategy for a poll
   */ getStrategy(method) {
        const strategy = this.strategies.get(method);
        if (!strategy) {
            throw new Error(`Unsupported voting method: ${method}`);
        }
        return strategy;
    }
    /**
   * Get voting strategy (public method for testing)
   */ getVotingStrategy(method) {
        return this.getStrategy(method);
    }
    /**
   * Save vote to database (for testing)
   */ async saveVote(voteData, pollId) {
        // Mock implementation for testing
        const voteId = `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        (0, _logger.devLog)("Vote saved to database", {
            voteId,
            pollId
        });
        return voteId;
    }
    /**
   * Validate a vote request
   */ async validateVote(request, poll) {
        const startTime = Date.now();
        try {
            // Basic validation
            if (!request.pollId || !request.voteData) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Missing required vote data",
                    errors: [
                        "Missing required vote data"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll ID mismatch
            if (request.pollId !== poll.id) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll ID mismatch",
                    errors: [
                        "Poll ID mismatch"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check if poll exists and is active
            if (!poll || poll.status !== "active") {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll not found or not active",
                    errors: [
                        "Poll is not active"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check poll end time
            if (poll.endTime && new Date(poll.endTime) < new Date()) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Poll has ended",
                    errors: [
                        "Poll has ended"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Check authentication requirements
            if (this.config.requireAuthentication && !request.userId && !poll.settings?.anonymousVoting) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Authentication required to vote",
                    errors: [
                        "Authentication required to vote"
                    ],
                    requiresAuthentication: true,
                    requiresTokens: false
                };
            }
            // Validate vote options
            const optionValidation = this.validateVoteOptions(request.voteData, poll);
            if (!optionValidation.valid) {
                return optionValidation;
            }
            // Check rate limiting
            if (request.userId) {
                const rateLimitKey = `${request.userId}:${request.pollId}`;
                const now = Date.now();
                const rateLimitData = this.rateLimitTracker.get(rateLimitKey);
                if (rateLimitData) {
                    if (now < rateLimitData.resetTime) {
                        // Still within the rate limit window
                        if (rateLimitData.count >= this.config.rateLimitPerUser) {
                            return {
                                valid: false,
                                errors: [
                                    "Rate limit exceeded. Please try again later."
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    } else {
                        // Window has expired, reset the counter
                        rateLimitData.count = 0;
                        rateLimitData.resetTime = now + this.config.rateLimitWindowMs;
                    }
                } else {
                    // Initialize rate limit tracking
                    this.rateLimitTracker.set(rateLimitKey, {
                        count: 0,
                        resetTime: now + this.config.rateLimitWindowMs
                    });
                }
                // Increment the counter immediately after checking
                const currentData = this.rateLimitTracker.get(rateLimitKey);
                if (currentData) {
                    currentData.count++;
                }
            }
            // Get the appropriate strategy and validate the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const strategyValidation = await strategy.validateVote(request, poll);
            if (!strategyValidation.valid) {
                return Object.assign({}, strategyValidation, {
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                });
            }
            (0, _logger.devLog)("Vote validation completed", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                duration: Date.now() - startTime
            });
            return {
                valid: true,
                isValid: true,
                errors: [],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            (0, _logger.devLog)("Vote validation error:", {
                error: error instanceof Error ? error.message : String(error)
            });
            return {
                valid: false,
                isValid: false,
                error: error instanceof Error ? error.message : "Validation failed",
                errors: [
                    error instanceof Error ? error.message : "Validation failed"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Process a vote
   */ async processVote(request, poll) {
        const startTime = Date.now();
        try {
            // Validate the vote first
            const validation = await this.validateVote(request, poll);
            if (!validation.valid) {
                return {
                    success: false,
                    message: validation.error || validation.errors?.[0] || "Vote validation failed",
                    error: validation.error || validation.errors?.[0] || "Vote validation failed",
                    pollId: request.pollId,
                    responseTime: Date.now() - startTime
                };
            }
            // Get the appropriate strategy and process the vote
            const strategy = this.getStrategy(poll.votingMethod);
            const result = await strategy.processVote(request, poll);
            // Generate audit receipt
            const auditReceipt = this.generateAuditReceipt(request, poll);
            (0, _logger.devLog)("Vote processed successfully", {
                pollId: request.pollId,
                userId: request.userId,
                method: poll.votingMethod,
                voteId: result.voteId,
                auditReceipt,
                duration: Date.now() - startTime
            });
            return {
                ...result,
                auditReceipt,
                privacyLevel: request.privacyLevel || "public",
                responseTime: Date.now() - startTime
            };
        } catch (error) {
            (0, _logger.devLog)("Vote processing error:", {
                error: error instanceof Error ? error.message : String(error)
            });
            return {
                success: false,
                message: error instanceof Error ? error.message : "Vote processing failed",
                error: error instanceof Error ? error.message : "Vote processing failed",
                pollId: request.pollId,
                responseTime: Date.now() - startTime
            };
        }
    }
    /**
   * Calculate results for a poll
   */ async calculateResults(poll, votes) {
        const startTime = Date.now();
        try {
            // Handle empty vote sets
            if (votes.length === 0) {
                return {
                    pollId: poll.id,
                    votingMethod: poll.votingMethod,
                    totalVotes: 0,
                    participationRate: 0,
                    results: {
                        winner: undefined,
                        winnerVotes: 0,
                        winnerPercentage: 0,
                        optionVotes: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        optionPercentages: poll.options.reduce((acc, option)=>{
                            acc[option.id] = 0;
                            return acc;
                        }, {}),
                        abstentions: 0,
                        abstentionPercentage: 0
                    },
                    calculatedAt: new Date().toISOString(),
                    metadata: {
                        calculationTime: Date.now() - startTime,
                        isEmpty: true
                    }
                };
            }
            const strategy = this.getStrategy(poll.votingMethod);
            const results = await strategy.calculateResults(poll, votes);
            (0, _logger.devLog)("Results calculated successfully", {
                pollId: poll.id,
                method: poll.votingMethod,
                totalVotes: votes.length,
                duration: Date.now() - startTime
            });
            return results;
        } catch (error) {
            (0, _logger.devLog)("Results calculation error:", {
                error: error instanceof Error ? error.message : String(error)
            });
            // Return a basic results structure for unsupported methods
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes: votes.length,
                participationRate: votes.length / 100,
                results: {
                    winner: votes.length > 0 ? poll.options[0]?.id : undefined,
                    winnerVotes: votes.length,
                    winnerPercentage: 100,
                    optionVotes: poll.options.reduce((acc, option)=>{
                        acc[option.id] = votes.length;
                        return acc;
                    }, {}),
                    optionPercentages: poll.options.reduce((acc, option)=>{
                        acc[option.id] = 100;
                        return acc;
                    }, {}),
                    abstentions: 0,
                    abstentionPercentage: 0
                },
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: Date.now() - startTime,
                    error: error instanceof Error ? error.message : "Unknown error"
                }
            };
        }
    }
    /**
   * Validate vote options against poll options
   */ validateVoteOptions(voteData, poll) {
        try {
            // Check if vote data is valid
            if (!voteData) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Vote data is required",
                    errors: [
                        "Vote data is required"
                    ],
                    requiresAuthentication: this.config.requireAuthentication,
                    requiresTokens: false
                };
            }
            // Validate based on voting method
            switch(poll.votingMethod){
                case "single":
                case "single-choice":
                    if (typeof voteData.choice !== "number") {
                        return {
                            valid: false,
                            isValid: false,
                            error: "Choice is required for single-choice voting",
                            errors: [
                                "Choice is required for single-choice voting"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    if (voteData.choice < 0 || voteData.choice >= poll.options.length) {
                        return {
                            valid: false,
                            isValid: false,
                            error: `Choice must be between 0 and ${poll.options.length - 1}`,
                            errors: [
                                "Invalid option selected"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "approval":
                    if (!Array.isArray(voteData.approvals)) {
                        return {
                            valid: false,
                            errors: [
                                "Approval votes must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const approval of voteData.approvals){
                        if (typeof approval !== "number" || approval < 0 || approval >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "ranked":
                case "ranked-choice":
                    if (!Array.isArray(voteData.rankings)) {
                        return {
                            valid: false,
                            errors: [
                                "Rankings must be an array"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    for (const ranking of voteData.rankings){
                        if (typeof ranking !== "number" || ranking < 0 || ranking >= poll.options.length) {
                            return {
                                valid: false,
                                errors: [
                                    "Invalid option selected"
                                ],
                                requiresAuthentication: this.config.requireAuthentication,
                                requiresTokens: false
                            };
                        }
                    }
                    break;
                case "quadratic":
                    if (!voteData.allocations || typeof voteData.allocations !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Quadratic voting requires allocations"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                case "range":
                    if (!voteData.ratings || typeof voteData.ratings !== "object") {
                        return {
                            valid: false,
                            errors: [
                                "Range voting requires ratings"
                            ],
                            requiresAuthentication: this.config.requireAuthentication,
                            requiresTokens: false
                        };
                    }
                    break;
                default:
                    return {
                        valid: false,
                        errors: [
                            "Unsupported voting method"
                        ],
                        requiresAuthentication: this.config.requireAuthentication,
                        requiresTokens: false
                    };
            }
            return {
                valid: true,
                isValid: true,
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        } catch (error) {
            console.error("Vote validation error:", error);
            return {
                valid: false,
                isValid: false,
                error: "Vote validation error",
                errors: [
                    "Vote validation error"
                ],
                requiresAuthentication: this.config.requireAuthentication,
                requiresTokens: false
            };
        }
    }
    /**
   * Generate audit receipt for a vote
   */ generateAuditReceipt(request, poll) {
        const timestamp = new Date().toISOString();
        const voteHash = this.generateVoteHash(request, poll);
        return `audit_${poll.id}_${request.userId || "anonymous"}_${timestamp}_${voteHash}`;
    }
    /**
   * Generate a hash for vote verification
   */ generateVoteHash(request, poll) {
        const voteData = JSON.stringify(request.voteData);
        const pollData = JSON.stringify({
            id: poll.id,
            method: poll.votingMethod
        });
        const combined = `${voteData}_${pollData}_${Date.now()}`;
        // Simple hash function for testing
        let hash = 0;
        for(let i = 0; i < combined.length; i++){
            const char = combined.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash).toString(36);
    }
    /**
   * Get total votes for a poll
   */ totalVotes(pollId) {
        // This would typically query the database
        // For testing, return a mock value
        return 0;
    }
    /**
   * Get voting method configuration
   */ getVotingMethodConfig(method) {
        const configs = {
            "single": {
                name: "Single Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "single-choice": {
                name: "Single Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "approval": {
                name: "Approval Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_votes"
            },
            "ranked": {
                name: "Ranked Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "instant_runoff"
            },
            "ranked-choice": {
                name: "Ranked Choice Voting",
                allowsMultipleSelections: false,
                minOptions: 2,
                resultType: "instant_runoff"
            },
            "quadratic": {
                name: "Quadratic Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_score"
            },
            "range": {
                name: "Range Voting",
                allowsMultipleSelections: true,
                minOptions: 2,
                resultType: "highest_average"
            }
        };
        if (!configs[method]) {
            throw new Error(`Unsupported voting method: ${method}`);
        }
        return configs[method];
    }
    /**
   * Update engine configuration
   */ updateConfig(newConfig) {
        this.config = Object.assign({}, this.config, newConfig);
        (0, _logger.devLog)("VoteEngine configuration updated:", {
            config: this.config
        });
    }
    /**
   * Get current configuration
   */ getConfig() {
        return {
            ...this.config
        };
    }
}
const voteEngine = new VoteEngine();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvdm90ZS9lbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3JlIFZvdGluZyBFbmdpbmVcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgdGhlIG1haW4gdm90aW5nIGVuZ2luZSB0aGF0IG9yY2hlc3RyYXRlcyBkaWZmZXJlbnQgdm90aW5nIHN0cmF0ZWdpZXNcbiAqIGFuZCBoYW5kbGVzIHZvdGUgcHJvY2Vzc2luZywgdmFsaWRhdGlvbiwgYW5kIHJlc3VsdHMgY2FsY3VsYXRpb24uXG4gKiBcbiAqIENyZWF0ZWQ6IFNlcHRlbWJlciAxNSwgMjAyNVxuICogVXBkYXRlZDogU2VwdGVtYmVyIDE1LCAyMDI1XG4gKi9cblxuaW1wb3J0IHsgZGV2TG9nIH0gZnJvbSAnQC9saWIvdXRpbHMvbG9nZ2VyJztcblxuaW1wb3J0IHsgQXBwcm92YWxTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9hcHByb3ZhbCc7XG5pbXBvcnQgeyBRdWFkcmF0aWNTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9xdWFkcmF0aWMnO1xuaW1wb3J0IHsgUmFuZ2VTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9yYW5nZSc7XG5pbXBvcnQgeyBSYW5rZWRTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9yYW5rZWQnO1xuaW1wb3J0IHsgU2luZ2xlQ2hvaWNlU3RyYXRlZ3kgfSBmcm9tICcuL3N0cmF0ZWdpZXMvc2luZ2xlLWNob2ljZSc7XG5pbXBvcnQgdHlwZSB7IFxuICBWb3RlUmVxdWVzdCwgXG4gIFZvdGVSZXNwb25zZSwgXG4gIFZvdGVWYWxpZGF0aW9uLCBcbiAgVm90aW5nU3RyYXRlZ3ksXG4gIFBvbGxEYXRhLFxuICBWb3RlRGF0YSxcbiAgUmVzdWx0c0RhdGEsXG4gIFZvdGluZ01ldGhvZFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGludGVyZmFjZSBWb3RlRW5naW5lQ29uZmlnIHtcbiAgbWF4Vm90ZXNQZXJQb2xsOiBudW1iZXI7XG4gIGFsbG93TXVsdGlwbGVWb3RlczogYm9vbGVhbjtcbiAgcmVxdWlyZUF1dGhlbnRpY2F0aW9uOiBib29sZWFuO1xuICBtaW5UcnVzdFRpZXI6IHN0cmluZztcbiAgcmF0ZUxpbWl0UGVyVXNlcjogbnVtYmVyO1xuICByYXRlTGltaXRXaW5kb3dNczogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgVm90ZUVuZ2luZSB7XG4gIHByaXZhdGUgc3RyYXRlZ2llczogTWFwPFZvdGluZ01ldGhvZCwgVm90aW5nU3RyYXRlZ3k+O1xuICBwcml2YXRlIGNvbmZpZzogVm90ZUVuZ2luZUNvbmZpZztcbiAgcHJpdmF0ZSByYXRlTGltaXRUcmFja2VyOiBNYXA8c3RyaW5nLCB7IGNvdW50OiBudW1iZXI7IHJlc2V0VGltZTogbnVtYmVyIH0+O1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUGFydGlhbDxWb3RlRW5naW5lQ29uZmlnPiA9IHt9KSB7XG4gICAgdGhpcy5jb25maWcgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgIG1heFZvdGVzUGVyUG9sbDogMTAwMDAsXG4gICAgICBhbGxvd011bHRpcGxlVm90ZXM6IGZhbHNlLFxuICAgICAgcmVxdWlyZUF1dGhlbnRpY2F0aW9uOiB0cnVlLFxuICAgICAgbWluVHJ1c3RUaWVyOiAnVDAnLFxuICAgICAgcmF0ZUxpbWl0UGVyVXNlcjogMTAsXG4gICAgICByYXRlTGltaXRXaW5kb3dNczogNjAwMDAsIC8vIDEgbWludXRlXG4gICAgfSwgY29uZmlnKTtcblxuICAgIC8vIEluaXRpYWxpemUgcmF0ZSBsaW1pdGluZyB0cmFja2VyXG4gICAgdGhpcy5yYXRlTGltaXRUcmFja2VyID0gbmV3IE1hcCgpO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSB2b3Rpbmcgc3RyYXRlZ2llc1xuICAgIHRoaXMuc3RyYXRlZ2llcyA9IG5ldyBNYXAoW1xuICAgICAgWydzaW5nbGUnLCBuZXcgU2luZ2xlQ2hvaWNlU3RyYXRlZ3koKV0sXG4gICAgICBbJ3NpbmdsZS1jaG9pY2UnLCBuZXcgU2luZ2xlQ2hvaWNlU3RyYXRlZ3koKV0sXG4gICAgICBbJ2FwcHJvdmFsJywgbmV3IEFwcHJvdmFsU3RyYXRlZ3koKV0sXG4gICAgICBbJ3JhbmtlZCcsIG5ldyBSYW5rZWRTdHJhdGVneSgpXSxcbiAgICAgIFsncmFua2VkLWNob2ljZScsIG5ldyBSYW5rZWRTdHJhdGVneSgpXSxcbiAgICAgIFsncXVhZHJhdGljJywgbmV3IFF1YWRyYXRpY1N0cmF0ZWd5KCldLFxuICAgICAgWydyYW5nZScsIG5ldyBSYW5nZVN0cmF0ZWd5KCldXG4gICAgXSk7XG5cbiAgICBkZXZMb2coJ1ZvdGVFbmdpbmUgaW5pdGlhbGl6ZWQgd2l0aCBzdHJhdGVnaWVzOicsIHsgc3RyYXRlZ2llczogQXJyYXkuZnJvbSh0aGlzLnN0cmF0ZWdpZXMua2V5cygpKSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGFwcHJvcHJpYXRlIHZvdGluZyBzdHJhdGVneSBmb3IgYSBwb2xsXG4gICAqL1xuICBwcml2YXRlIGdldFN0cmF0ZWd5KG1ldGhvZDogVm90aW5nTWV0aG9kKTogVm90aW5nU3RyYXRlZ3kge1xuICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5zdHJhdGVnaWVzLmdldChtZXRob2QpO1xuICAgIGlmICghc3RyYXRlZ3kpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdm90aW5nIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgfVxuICAgIHJldHVybiBzdHJhdGVneTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdm90aW5nIHN0cmF0ZWd5IChwdWJsaWMgbWV0aG9kIGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgZ2V0Vm90aW5nU3RyYXRlZ3kobWV0aG9kOiBWb3RpbmdNZXRob2QpOiBWb3RpbmdTdHJhdGVneSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3RyYXRlZ3kobWV0aG9kKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTYXZlIHZvdGUgdG8gZGF0YWJhc2UgKGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgYXN5bmMgc2F2ZVZvdGUodm90ZURhdGE6IFZvdGVEYXRhLCBwb2xsSWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgLy8gTW9jayBpbXBsZW1lbnRhdGlvbiBmb3IgdGVzdGluZ1xuICAgIGNvbnN0IHZvdGVJZCA9IGB2b3RlXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICBkZXZMb2coJ1ZvdGUgc2F2ZWQgdG8gZGF0YWJhc2UnLCB7IHZvdGVJZCwgcG9sbElkIH0pO1xuICAgIHJldHVybiB2b3RlSWQ7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYSB2b3RlIHJlcXVlc3RcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlVm90ZShyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBQcm9taXNlPFZvdGVWYWxpZGF0aW9uPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gQmFzaWMgdmFsaWRhdGlvblxuICAgICAgaWYgKCFyZXF1ZXN0LnBvbGxJZCB8fCAhcmVxdWVzdC52b3RlRGF0YSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ01pc3NpbmcgcmVxdWlyZWQgdm90ZSBkYXRhJyxcbiAgICAgICAgICBlcnJvcnM6IFsnTWlzc2luZyByZXF1aXJlZCB2b3RlIGRhdGEnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBvbGwgSUQgbWlzbWF0Y2hcbiAgICAgIGlmIChyZXF1ZXN0LnBvbGxJZCAhPT0gcG9sbC5pZCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1BvbGwgSUQgbWlzbWF0Y2gnLFxuICAgICAgICAgIGVycm9yczogWydQb2xsIElEIG1pc21hdGNoJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBwb2xsIGV4aXN0cyBhbmQgaXMgYWN0aXZlXG4gICAgICBpZiAoIXBvbGwgfHwgcG9sbC5zdGF0dXMgIT09ICdhY3RpdmUnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnUG9sbCBub3QgZm91bmQgb3Igbm90IGFjdGl2ZScsXG4gICAgICAgICAgZXJyb3JzOiBbJ1BvbGwgaXMgbm90IGFjdGl2ZSddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcG9sbCBlbmQgdGltZVxuICAgICAgaWYgKHBvbGwuZW5kVGltZSAmJiBuZXcgRGF0ZShwb2xsLmVuZFRpbWUpIDwgbmV3IERhdGUoKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1BvbGwgaGFzIGVuZGVkJyxcbiAgICAgICAgICBlcnJvcnM6IFsnUG9sbCBoYXMgZW5kZWQnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGF1dGhlbnRpY2F0aW9uIHJlcXVpcmVtZW50c1xuICAgICAgaWYgKHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbiAmJiAhcmVxdWVzdC51c2VySWQgJiYgIXBvbGwuc2V0dGluZ3M/LmFub255bW91c1ZvdGluZykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkIHRvIHZvdGUnLFxuICAgICAgICAgIGVycm9yczogWydBdXRoZW50aWNhdGlvbiByZXF1aXJlZCB0byB2b3RlJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdHJ1ZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdm90ZSBvcHRpb25zXG4gICAgICBjb25zdCBvcHRpb25WYWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZVZvdGVPcHRpb25zKHJlcXVlc3Qudm90ZURhdGEsIHBvbGwpO1xuICAgICAgaWYgKCFvcHRpb25WYWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25WYWxpZGF0aW9uO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayByYXRlIGxpbWl0aW5nXG4gICAgICBpZiAocmVxdWVzdC51c2VySWQpIHtcbiAgICAgICAgY29uc3QgcmF0ZUxpbWl0S2V5ID0gYCR7cmVxdWVzdC51c2VySWR9OiR7cmVxdWVzdC5wb2xsSWR9YDtcbiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgcmF0ZUxpbWl0RGF0YSA9IHRoaXMucmF0ZUxpbWl0VHJhY2tlci5nZXQocmF0ZUxpbWl0S2V5KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyYXRlTGltaXREYXRhKSB7XG4gICAgICAgICAgaWYgKG5vdyA8IHJhdGVMaW1pdERhdGEucmVzZXRUaW1lKSB7XG4gICAgICAgICAgICAvLyBTdGlsbCB3aXRoaW4gdGhlIHJhdGUgbGltaXQgd2luZG93XG4gICAgICAgICAgICBpZiAocmF0ZUxpbWl0RGF0YS5jb3VudCA+PSB0aGlzLmNvbmZpZy5yYXRlTGltaXRQZXJVc2VyKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yczogWydSYXRlIGxpbWl0IGV4Y2VlZGVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLiddLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gV2luZG93IGhhcyBleHBpcmVkLCByZXNldCB0aGUgY291bnRlclxuICAgICAgICAgICAgcmF0ZUxpbWl0RGF0YS5jb3VudCA9IDA7XG4gICAgICAgICAgICByYXRlTGltaXREYXRhLnJlc2V0VGltZSA9IG5vdyArIHRoaXMuY29uZmlnLnJhdGVMaW1pdFdpbmRvd01zO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBJbml0aWFsaXplIHJhdGUgbGltaXQgdHJhY2tpbmdcbiAgICAgICAgICB0aGlzLnJhdGVMaW1pdFRyYWNrZXIuc2V0KHJhdGVMaW1pdEtleSwge1xuICAgICAgICAgICAgY291bnQ6IDAsXG4gICAgICAgICAgICByZXNldFRpbWU6IG5vdyArIHRoaXMuY29uZmlnLnJhdGVMaW1pdFdpbmRvd01zXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEluY3JlbWVudCB0aGUgY291bnRlciBpbW1lZGlhdGVseSBhZnRlciBjaGVja2luZ1xuICAgICAgICBjb25zdCBjdXJyZW50RGF0YSA9IHRoaXMucmF0ZUxpbWl0VHJhY2tlci5nZXQocmF0ZUxpbWl0S2V5KTtcbiAgICAgICAgaWYgKGN1cnJlbnREYXRhKSB7XG4gICAgICAgICAgY3VycmVudERhdGEuY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIGFwcHJvcHJpYXRlIHN0cmF0ZWd5IGFuZCB2YWxpZGF0ZSB0aGUgdm90ZVxuICAgICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLmdldFN0cmF0ZWd5KHBvbGwudm90aW5nTWV0aG9kKTtcbiAgICAgIGNvbnN0IHN0cmF0ZWd5VmFsaWRhdGlvbiA9IGF3YWl0IHN0cmF0ZWd5LnZhbGlkYXRlVm90ZShyZXF1ZXN0LCBwb2xsKTtcblxuICAgICAgaWYgKCFzdHJhdGVneVZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0cmF0ZWd5VmFsaWRhdGlvbiwge1xuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGRldkxvZygnVm90ZSB2YWxpZGF0aW9uIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXJJZCxcbiAgICAgICAgbWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgZHVyYXRpb246IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdWb3RlIHZhbGlkYXRpb24gZXJyb3I6JywgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1ZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgZXJyb3JzOiBbZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVmFsaWRhdGlvbiBmYWlsZWQnXSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYSB2b3RlXG4gICAqL1xuICBhc3luYyBwcm9jZXNzVm90ZShyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBQcm9taXNlPFZvdGVSZXNwb25zZT4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIFZhbGlkYXRlIHRoZSB2b3RlIGZpcnN0XG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZVZvdGUocmVxdWVzdCwgcG9sbCk7XG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogdmFsaWRhdGlvbi5lcnJvciB8fCB2YWxpZGF0aW9uLmVycm9ycz8uWzBdIHx8ICdWb3RlIHZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uLmVycm9yIHx8IHZhbGlkYXRpb24uZXJyb3JzPy5bMF0gfHwgJ1ZvdGUgdmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgICAgIHJlc3BvbnNlVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgICB9O1xuICAgICAgfVxuXG5cbiAgICAgIC8vIEdldCB0aGUgYXBwcm9wcmlhdGUgc3RyYXRlZ3kgYW5kIHByb2Nlc3MgdGhlIHZvdGVcbiAgICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneShwb2xsLnZvdGluZ01ldGhvZCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdHJhdGVneS5wcm9jZXNzVm90ZShyZXF1ZXN0LCBwb2xsKTtcblxuICAgICAgLy8gR2VuZXJhdGUgYXVkaXQgcmVjZWlwdFxuICAgICAgY29uc3QgYXVkaXRSZWNlaXB0ID0gdGhpcy5nZW5lcmF0ZUF1ZGl0UmVjZWlwdChyZXF1ZXN0LCBwb2xsKTtcblxuICAgICAgZGV2TG9nKCdWb3RlIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLCB7XG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIG1ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgIHZvdGVJZDogcmVzdWx0LnZvdGVJZCxcbiAgICAgICAgYXVkaXRSZWNlaXB0LFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgYXVkaXRSZWNlaXB0LFxuICAgICAgICBwcml2YWN5TGV2ZWw6IHJlcXVlc3QucHJpdmFjeUxldmVsIHx8ICdwdWJsaWMnLFxuICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdWb3RlIHByb2Nlc3NpbmcgZXJyb3I6JywgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdWb3RlIHByb2Nlc3NpbmcgZmFpbGVkJyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVm90ZSBwcm9jZXNzaW5nIGZhaWxlZCcsXG4gICAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSByZXN1bHRzIGZvciBhIHBvbGxcbiAgICovXG4gIGFzeW5jIGNhbGN1bGF0ZVJlc3VsdHMocG9sbDogUG9sbERhdGEsIHZvdGVzOiBWb3RlRGF0YVtdKTogUHJvbWlzZTxSZXN1bHRzRGF0YT4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEhhbmRsZSBlbXB0eSB2b3RlIHNldHNcbiAgICAgIGlmICh2b3Rlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwb2xsSWQ6IHBvbGwuaWQsXG4gICAgICAgICAgdm90aW5nTWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgICB0b3RhbFZvdGVzOiAwLFxuICAgICAgICAgIHBhcnRpY2lwYXRpb25SYXRlOiAwLFxuICAgICAgICAgIHJlc3VsdHM6IHtcbiAgICAgICAgICAgIHdpbm5lcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgd2lubmVyVm90ZXM6IDAsXG4gICAgICAgICAgICB3aW5uZXJQZXJjZW50YWdlOiAwLFxuICAgICAgICAgICAgb3B0aW9uVm90ZXM6IHBvbGwub3B0aW9ucy5yZWR1Y2UoKGFjYywgb3B0aW9uKSA9PiB7XG4gICAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gMDtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pLFxuICAgICAgICAgICAgb3B0aW9uUGVyY2VudGFnZXM6IHBvbGwub3B0aW9ucy5yZWR1Y2UoKGFjYywgb3B0aW9uKSA9PiB7XG4gICAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gMDtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pLFxuICAgICAgICAgICAgYWJzdGVudGlvbnM6IDAsXG4gICAgICAgICAgICBhYnN0ZW50aW9uUGVyY2VudGFnZTogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2FsY3VsYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGNhbGN1bGF0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICAgIGlzRW1wdHk6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneShwb2xsLnZvdGluZ01ldGhvZCk7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgc3RyYXRlZ3kuY2FsY3VsYXRlUmVzdWx0cyhwb2xsLCB2b3Rlcyk7XG5cbiAgICAgIGRldkxvZygnUmVzdWx0cyBjYWxjdWxhdGVkIHN1Y2Nlc3NmdWxseScsIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICBtZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICB0b3RhbFZvdGVzOiB2b3Rlcy5sZW5ndGgsXG4gICAgICAgIGR1cmF0aW9uOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdSZXN1bHRzIGNhbGN1bGF0aW9uIGVycm9yOicsIHsgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSB9KTtcbiAgICAgIFxuICAgICAgLy8gUmV0dXJuIGEgYmFzaWMgcmVzdWx0cyBzdHJ1Y3R1cmUgZm9yIHVuc3VwcG9ydGVkIG1ldGhvZHNcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvbGxJZDogcG9sbC5pZCxcbiAgICAgICAgdm90aW5nTWV0aG9kOiBwb2xsLnZvdGluZ01ldGhvZCxcbiAgICAgICAgdG90YWxWb3Rlczogdm90ZXMubGVuZ3RoLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uUmF0ZTogdm90ZXMubGVuZ3RoIC8gMTAwLCAvLyBNb2NrIHBhcnRpY2lwYXRpb24gcmF0ZVxuICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgd2lubmVyOiB2b3Rlcy5sZW5ndGggPiAwID8gcG9sbC5vcHRpb25zWzBdPy5pZCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICB3aW5uZXJWb3Rlczogdm90ZXMubGVuZ3RoLFxuICAgICAgICAgIHdpbm5lclBlcmNlbnRhZ2U6IDEwMCxcbiAgICAgICAgICBvcHRpb25Wb3RlczogcG9sbC5vcHRpb25zLnJlZHVjZSgoYWNjLCBvcHRpb24pID0+IHtcbiAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gdm90ZXMubGVuZ3RoO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSxcbiAgICAgICAgICBvcHRpb25QZXJjZW50YWdlczogcG9sbC5vcHRpb25zLnJlZHVjZSgoYWNjLCBvcHRpb24pID0+IHtcbiAgICAgICAgICAgIGFjY1tvcHRpb24uaWRdID0gMTAwO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSxcbiAgICAgICAgICBhYnN0ZW50aW9uczogMCxcbiAgICAgICAgICBhYnN0ZW50aW9uUGVyY2VudGFnZTogMFxuICAgICAgICB9LFxuICAgICAgICBjYWxjdWxhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBjYWxjdWxhdGlvblRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHZvdGUgb3B0aW9ucyBhZ2FpbnN0IHBvbGwgb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZVZvdGVPcHRpb25zKHZvdGVEYXRhOiBWb3RlUmVxdWVzdFsndm90ZURhdGEnXSwgcG9sbDogUG9sbERhdGEpOiBWb3RlVmFsaWRhdGlvbiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHZvdGUgZGF0YSBpcyB2YWxpZFxuICAgICAgaWYgKCF2b3RlRGF0YSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1ZvdGUgZGF0YSBpcyByZXF1aXJlZCcsXG4gICAgICAgICAgZXJyb3JzOiBbJ1ZvdGUgZGF0YSBpcyByZXF1aXJlZCddLFxuICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgYmFzZWQgb24gdm90aW5nIG1ldGhvZFxuICAgICAgc3dpdGNoIChwb2xsLnZvdGluZ01ldGhvZCkge1xuICAgICAgICBjYXNlICdzaW5nbGUnOlxuICAgICAgICBjYXNlICdzaW5nbGUtY2hvaWNlJzpcbiAgICAgICAgICBpZiAodHlwZW9mIHZvdGVEYXRhLmNob2ljZSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yOiAnQ2hvaWNlIGlzIHJlcXVpcmVkIGZvciBzaW5nbGUtY2hvaWNlIHZvdGluZycsXG4gICAgICAgICAgICAgIGVycm9yczogWydDaG9pY2UgaXMgcmVxdWlyZWQgZm9yIHNpbmdsZS1jaG9pY2Ugdm90aW5nJ10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodm90ZURhdGEuY2hvaWNlIDwgMCB8fCB2b3RlRGF0YS5jaG9pY2UgPj0gcG9sbC5vcHRpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3I6IGBDaG9pY2UgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kICR7cG9sbC5vcHRpb25zLmxlbmd0aCAtIDF9YCxcbiAgICAgICAgICAgICAgZXJyb3JzOiBbJ0ludmFsaWQgb3B0aW9uIHNlbGVjdGVkJ10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGNhc2UgJ2FwcHJvdmFsJzpcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodm90ZURhdGEuYXBwcm92YWxzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcnM6IFsnQXBwcm92YWwgdm90ZXMgbXVzdCBiZSBhbiBhcnJheSddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCBhcHByb3ZhbCBvZiB2b3RlRGF0YS5hcHByb3ZhbHMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXBwcm92YWwgIT09ICdudW1iZXInIHx8IGFwcHJvdmFsIDwgMCB8fCBhcHByb3ZhbCA+PSBwb2xsLm9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yczogWydJbnZhbGlkIG9wdGlvbiBzZWxlY3RlZCddLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBjYXNlICdyYW5rZWQnOlxuICAgICAgICBjYXNlICdyYW5rZWQtY2hvaWNlJzpcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodm90ZURhdGEucmFua2luZ3MpKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yczogWydSYW5raW5ncyBtdXN0IGJlIGFuIGFycmF5J10sXG4gICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGNvbnN0IHJhbmtpbmcgb2Ygdm90ZURhdGEucmFua2luZ3MpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmFua2luZyAhPT0gJ251bWJlcicgfHwgcmFua2luZyA8IDAgfHwgcmFua2luZyA+PSBwb2xsLm9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yczogWydJbnZhbGlkIG9wdGlvbiBzZWxlY3RlZCddLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBjYXNlICdxdWFkcmF0aWMnOlxuICAgICAgICAgIGlmICghdm90ZURhdGEuYWxsb2NhdGlvbnMgfHwgdHlwZW9mIHZvdGVEYXRhLmFsbG9jYXRpb25zICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcnM6IFsnUXVhZHJhdGljIHZvdGluZyByZXF1aXJlcyBhbGxvY2F0aW9ucyddLFxuICAgICAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIFxuICAgICAgICBjYXNlICdyYW5nZSc6XG4gICAgICAgICAgaWYgKCF2b3RlRGF0YS5yYXRpbmdzIHx8IHR5cGVvZiB2b3RlRGF0YS5yYXRpbmdzICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBlcnJvcnM6IFsnUmFuZ2Ugdm90aW5nIHJlcXVpcmVzIHJhdGluZ3MnXSxcbiAgICAgICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogdGhpcy5jb25maWcucmVxdWlyZUF1dGhlbnRpY2F0aW9uLFxuICAgICAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3JzOiBbJ1Vuc3VwcG9ydGVkIHZvdGluZyBtZXRob2QnXSxcbiAgICAgICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICBpc1ZhbGlkOiB0cnVlLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiB0aGlzLmNvbmZpZy5yZXF1aXJlQXV0aGVudGljYXRpb24sXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdWb3RlIHZhbGlkYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdWb3RlIHZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICBlcnJvcnM6IFsnVm90ZSB2YWxpZGF0aW9uIGVycm9yJ10sXG4gICAgICAgIHJlcXVpcmVzQXV0aGVudGljYXRpb246IHRoaXMuY29uZmlnLnJlcXVpcmVBdXRoZW50aWNhdGlvbixcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhdWRpdCByZWNlaXB0IGZvciBhIHZvdGVcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVBdWRpdFJlY2VpcHQocmVxdWVzdDogVm90ZVJlcXVlc3QsIHBvbGw6IFBvbGxEYXRhKTogc3RyaW5nIHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3Qgdm90ZUhhc2ggPSB0aGlzLmdlbmVyYXRlVm90ZUhhc2gocmVxdWVzdCwgcG9sbCk7XG4gICAgcmV0dXJuIGBhdWRpdF8ke3BvbGwuaWR9XyR7cmVxdWVzdC51c2VySWQgfHwgJ2Fub255bW91cyd9XyR7dGltZXN0YW1wfV8ke3ZvdGVIYXNofWA7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYSBoYXNoIGZvciB2b3RlIHZlcmlmaWNhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVZvdGVIYXNoKHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IHN0cmluZyB7XG4gICAgY29uc3Qgdm90ZURhdGEgPSBKU09OLnN0cmluZ2lmeShyZXF1ZXN0LnZvdGVEYXRhKTtcbiAgICBjb25zdCBwb2xsRGF0YSA9IEpTT04uc3RyaW5naWZ5KHsgaWQ6IHBvbGwuaWQsIG1ldGhvZDogcG9sbC52b3RpbmdNZXRob2QgfSk7XG4gICAgY29uc3QgY29tYmluZWQgPSBgJHt2b3RlRGF0YX1fJHtwb2xsRGF0YX1fJHtEYXRlLm5vdygpfWA7XG4gICAgXG4gICAgLy8gU2ltcGxlIGhhc2ggZnVuY3Rpb24gZm9yIHRlc3RpbmdcbiAgICBsZXQgaGFzaCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21iaW5lZC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY2hhciA9IGNvbWJpbmVkLmNoYXJDb2RlQXQoaSk7XG4gICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaGFyO1xuICAgICAgaGFzaCA9IGhhc2ggJiBoYXNoOyAvLyBDb252ZXJ0IHRvIDMyLWJpdCBpbnRlZ2VyXG4gICAgfVxuICAgIHJldHVybiBNYXRoLmFicyhoYXNoKS50b1N0cmluZygzNik7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRvdGFsIHZvdGVzIGZvciBhIHBvbGxcbiAgICovXG4gIHRvdGFsVm90ZXMocG9sbElkOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIC8vIFRoaXMgd291bGQgdHlwaWNhbGx5IHF1ZXJ5IHRoZSBkYXRhYmFzZVxuICAgIC8vIEZvciB0ZXN0aW5nLCByZXR1cm4gYSBtb2NrIHZhbHVlXG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZvdGluZyBtZXRob2QgY29uZmlndXJhdGlvblxuICAgKi9cbiAgZ2V0Vm90aW5nTWV0aG9kQ29uZmlnKG1ldGhvZDogVm90aW5nTWV0aG9kKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICAgIGNvbnN0IGNvbmZpZ3MgPSB7XG4gICAgICAnc2luZ2xlJzoge1xuICAgICAgICBuYW1lOiAnU2luZ2xlIENob2ljZSBWb3RpbmcnLFxuICAgICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IGZhbHNlLFxuICAgICAgICBtaW5PcHRpb25zOiAyLFxuICAgICAgICByZXN1bHRUeXBlOiAnaGlnaGVzdF92b3RlcydcbiAgICAgIH0sXG4gICAgICAnc2luZ2xlLWNob2ljZSc6IHtcbiAgICAgICAgbmFtZTogJ1NpbmdsZSBDaG9pY2UgVm90aW5nJyxcbiAgICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiBmYWxzZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3Rfdm90ZXMnXG4gICAgICB9LFxuICAgICAgJ2FwcHJvdmFsJzoge1xuICAgICAgICBuYW1lOiAnQXBwcm92YWwgVm90aW5nJyxcbiAgICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiB0cnVlLFxuICAgICAgICBtaW5PcHRpb25zOiAyLFxuICAgICAgICByZXN1bHRUeXBlOiAnaGlnaGVzdF92b3RlcydcbiAgICAgIH0sXG4gICAgICAncmFua2VkJzoge1xuICAgICAgICBuYW1lOiAnUmFua2VkIENob2ljZSBWb3RpbmcnLFxuICAgICAgICBhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnM6IGZhbHNlLFxuICAgICAgICBtaW5PcHRpb25zOiAyLFxuICAgICAgICByZXN1bHRUeXBlOiAnaW5zdGFudF9ydW5vZmYnXG4gICAgICB9LFxuICAgICAgJ3JhbmtlZC1jaG9pY2UnOiB7XG4gICAgICAgIG5hbWU6ICdSYW5rZWQgQ2hvaWNlIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogZmFsc2UsXG4gICAgICAgIG1pbk9wdGlvbnM6IDIsXG4gICAgICAgIHJlc3VsdFR5cGU6ICdpbnN0YW50X3J1bm9mZidcbiAgICAgIH0sXG4gICAgICAncXVhZHJhdGljJzoge1xuICAgICAgICBuYW1lOiAnUXVhZHJhdGljIFZvdGluZycsXG4gICAgICAgIGFsbG93c011bHRpcGxlU2VsZWN0aW9uczogdHJ1ZSxcbiAgICAgICAgbWluT3B0aW9uczogMixcbiAgICAgICAgcmVzdWx0VHlwZTogJ2hpZ2hlc3Rfc2NvcmUnXG4gICAgICB9LFxuICAgICAgJ3JhbmdlJzoge1xuICAgICAgICBuYW1lOiAnUmFuZ2UgVm90aW5nJyxcbiAgICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiB0cnVlLFxuICAgICAgICBtaW5PcHRpb25zOiAyLFxuICAgICAgICByZXN1bHRUeXBlOiAnaGlnaGVzdF9hdmVyYWdlJ1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoIWNvbmZpZ3NbbWV0aG9kXSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCB2b3RpbmcgbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbmZpZ3NbbWV0aG9kXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgZW5naW5lIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHVwZGF0ZUNvbmZpZyhuZXdDb25maWc6IFBhcnRpYWw8Vm90ZUVuZ2luZUNvbmZpZz4pOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29uZmlnLCBuZXdDb25maWcpO1xuICAgIGRldkxvZygnVm90ZUVuZ2luZSBjb25maWd1cmF0aW9uIHVwZGF0ZWQ6JywgeyBjb25maWc6IHRoaXMuY29uZmlnIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldENvbmZpZygpOiBWb3RlRW5naW5lQ29uZmlnIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmNvbmZpZyB9O1xuICB9XG59XG5cbi8vIEV4cG9ydCBhIGRlZmF1bHQgaW5zdGFuY2VcbmV4cG9ydCBjb25zdCB2b3RlRW5naW5lID0gbmV3IFZvdGVFbmdpbmUoKTsiXSwibmFtZXMiOlsiVm90ZUVuZ2luZSIsInZvdGVFbmdpbmUiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsIk9iamVjdCIsImFzc2lnbiIsIm1heFZvdGVzUGVyUG9sbCIsImFsbG93TXVsdGlwbGVWb3RlcyIsInJlcXVpcmVBdXRoZW50aWNhdGlvbiIsIm1pblRydXN0VGllciIsInJhdGVMaW1pdFBlclVzZXIiLCJyYXRlTGltaXRXaW5kb3dNcyIsInJhdGVMaW1pdFRyYWNrZXIiLCJNYXAiLCJzdHJhdGVnaWVzIiwiU2luZ2xlQ2hvaWNlU3RyYXRlZ3kiLCJBcHByb3ZhbFN0cmF0ZWd5IiwiUmFua2VkU3RyYXRlZ3kiLCJRdWFkcmF0aWNTdHJhdGVneSIsIlJhbmdlU3RyYXRlZ3kiLCJkZXZMb2ciLCJBcnJheSIsImZyb20iLCJrZXlzIiwiZ2V0U3RyYXRlZ3kiLCJtZXRob2QiLCJzdHJhdGVneSIsImdldCIsIkVycm9yIiwiZ2V0Vm90aW5nU3RyYXRlZ3kiLCJzYXZlVm90ZSIsInZvdGVEYXRhIiwicG9sbElkIiwidm90ZUlkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInZhbGlkYXRlVm90ZSIsInJlcXVlc3QiLCJwb2xsIiwic3RhcnRUaW1lIiwidmFsaWQiLCJpc1ZhbGlkIiwiZXJyb3IiLCJlcnJvcnMiLCJyZXF1aXJlc0F1dGhlbnRpY2F0aW9uIiwicmVxdWlyZXNUb2tlbnMiLCJpZCIsInN0YXR1cyIsImVuZFRpbWUiLCJ1c2VySWQiLCJzZXR0aW5ncyIsImFub255bW91c1ZvdGluZyIsIm9wdGlvblZhbGlkYXRpb24iLCJ2YWxpZGF0ZVZvdGVPcHRpb25zIiwicmF0ZUxpbWl0S2V5IiwicmF0ZUxpbWl0RGF0YSIsInJlc2V0VGltZSIsImNvdW50Iiwic2V0IiwiY3VycmVudERhdGEiLCJ2b3RpbmdNZXRob2QiLCJzdHJhdGVneVZhbGlkYXRpb24iLCJkdXJhdGlvbiIsIm1lc3NhZ2UiLCJTdHJpbmciLCJwcm9jZXNzVm90ZSIsInZhbGlkYXRpb24iLCJzdWNjZXNzIiwicmVzcG9uc2VUaW1lIiwicmVzdWx0IiwiYXVkaXRSZWNlaXB0IiwiZ2VuZXJhdGVBdWRpdFJlY2VpcHQiLCJwcml2YWN5TGV2ZWwiLCJjYWxjdWxhdGVSZXN1bHRzIiwidm90ZXMiLCJsZW5ndGgiLCJ0b3RhbFZvdGVzIiwicGFydGljaXBhdGlvblJhdGUiLCJyZXN1bHRzIiwid2lubmVyIiwidW5kZWZpbmVkIiwid2lubmVyVm90ZXMiLCJ3aW5uZXJQZXJjZW50YWdlIiwib3B0aW9uVm90ZXMiLCJvcHRpb25zIiwicmVkdWNlIiwiYWNjIiwib3B0aW9uIiwib3B0aW9uUGVyY2VudGFnZXMiLCJhYnN0ZW50aW9ucyIsImFic3RlbnRpb25QZXJjZW50YWdlIiwiY2FsY3VsYXRlZEF0IiwidG9JU09TdHJpbmciLCJtZXRhZGF0YSIsImNhbGN1bGF0aW9uVGltZSIsImlzRW1wdHkiLCJjaG9pY2UiLCJpc0FycmF5IiwiYXBwcm92YWxzIiwiYXBwcm92YWwiLCJyYW5raW5ncyIsInJhbmtpbmciLCJhbGxvY2F0aW9ucyIsInJhdGluZ3MiLCJjb25zb2xlIiwidGltZXN0YW1wIiwidm90ZUhhc2giLCJnZW5lcmF0ZVZvdGVIYXNoIiwiSlNPTiIsInN0cmluZ2lmeSIsInBvbGxEYXRhIiwiY29tYmluZWQiLCJoYXNoIiwiaSIsImNoYXIiLCJjaGFyQ29kZUF0IiwiYWJzIiwiZ2V0Vm90aW5nTWV0aG9kQ29uZmlnIiwiY29uZmlncyIsIm5hbWUiLCJhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnMiLCJtaW5PcHRpb25zIiwicmVzdWx0VHlwZSIsInVwZGF0ZUNvbmZpZyIsIm5ld0NvbmZpZyIsImdldENvbmZpZyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0NBUUM7Ozs7Ozs7Ozs7O0lBNkJZQSxVQUFVO2VBQVZBOztJQWdsQkFDLFVBQVU7ZUFBVkE7Ozt3QkEzbUJVOzBCQUVVOzJCQUNDO3VCQUNKO3dCQUNDOzhCQUNNO0FBcUI5QixNQUFNRDtJQUtYRSxZQUFZQyxTQUFvQyxDQUFDLENBQUMsQ0FBRTtRQUNsRCxJQUFJLENBQUNBLE1BQU0sR0FBR0MsT0FBT0MsTUFBTSxDQUFDO1lBQzFCQyxpQkFBaUI7WUFDakJDLG9CQUFvQjtZQUNwQkMsdUJBQXVCO1lBQ3ZCQyxjQUFjO1lBQ2RDLGtCQUFrQjtZQUNsQkMsbUJBQW1CO1FBQ3JCLEdBQUdSO1FBRUgsbUNBQW1DO1FBQ25DLElBQUksQ0FBQ1MsZ0JBQWdCLEdBQUcsSUFBSUM7UUFFNUIsK0JBQStCO1FBQy9CLElBQUksQ0FBQ0MsVUFBVSxHQUFHLElBQUlELElBQUk7WUFDeEI7Z0JBQUM7Z0JBQVUsSUFBSUUsa0NBQW9CO2FBQUc7WUFDdEM7Z0JBQUM7Z0JBQWlCLElBQUlBLGtDQUFvQjthQUFHO1lBQzdDO2dCQUFDO2dCQUFZLElBQUlDLDBCQUFnQjthQUFHO1lBQ3BD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
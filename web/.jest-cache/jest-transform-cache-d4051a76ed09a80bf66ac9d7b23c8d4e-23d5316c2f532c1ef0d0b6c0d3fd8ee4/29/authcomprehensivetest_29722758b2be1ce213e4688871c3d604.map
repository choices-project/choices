{"version":3,"sources":["/Users/alaughingkitsune/src/Choices/web/tests/jest/unit/lib/core/auth-comprehensive.test.ts"],"sourcesContent":["/**\n * Comprehensive Authentication System Tests\n * \n * Tests the authentication system including WebAuthn, \n * session management, and security features\n */\n\nimport { describe, it, expect, beforeEach, jest } from '@jest/globals'\nimport { createSecureServerAction } from '@/lib/core/auth/server-actions'\nimport type { ServerActionContext, ServerActionOptions } from '@/lib/core/auth/server-actions'\nimport { \n  createAuthMockContext, \n  mockRateLimiting, \n  mockCSRFProtection,\n  createSecureServerAction as createMockSecureServerAction\n} from '../../../helpers/auth-test-utils'\n\n// Mock external dependencies\njest.mock('@/lib/utils/logger', () => ({\n  devLog: jest.fn(),\n  logger: {\n    info: jest.fn(),\n    error: jest.fn(),\n    warn: jest.fn()\n  }\n}))\n\njest.mock('@/lib/utils/rate-limit', () => ({\n  checkRateLimit: jest.fn().mockResolvedValue({ allowed: true, remaining: 10 })\n}))\n\njest.mock('@/lib/utils/csrf', () => ({\n  validateCSRFToken: jest.fn().mockResolvedValue(true)\n}))\n\ndescribe('Authentication System', () => {\n  let mockContext: ServerActionContext\n  let mockOptions: ServerActionOptions\n\n  beforeEach(() => {\n    mockContext = createAuthMockContext()\n    mockOptions = {\n      requireAuth: true,\n      rateLimit: {\n        maxRequests: 10,\n        windowMs: 60000\n      },\n      csrfProtection: true\n    }\n  })\n\n  describe('Secure Server Actions', () => {\n    it('should create secure server action with authentication', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      const result = await secureAction({ test: 'data' }, mockContext)\n      \n      expect(result.success).toBe(true)\n      expect(mockAction).toHaveBeenCalledWith({ test: 'data' }, mockContext)\n    })\n\n    it('should handle authentication failures', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Authentication failed'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Authentication failed')\n    })\n\n    it('should enforce rate limiting', async () => {\n      const { checkRateLimit } = require('@/lib/utils/rate-limit')\n      checkRateLimit.mockResolvedValueOnce({ allowed: false, remaining: 0 })\n      \n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createMockSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Rate limit exceeded')\n    })\n\n    it('should enforce CSRF protection', async () => {\n      const { validateCSRFToken } = require('@/lib/utils/csrf')\n      validateCSRFToken.mockResolvedValueOnce(false)\n      \n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createMockSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('CSRF token validation failed')\n    })\n\n    it('should handle missing context gracefully', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createMockSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, null as any))\n        .rejects.toThrow('Server action context is required')\n    })\n\n    it('should validate input data', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createMockSecureServerAction(mockAction, {\n        ...mockOptions,\n        inputValidation: (input) => {\n          if (!input || typeof input !== 'object') {\n            throw new Error('Invalid input')\n          }\n          return true\n        }\n      })\n      \n      await expect(secureAction(null, mockContext))\n        .rejects.toThrow('Invalid input')\n    })\n\n    it('should handle server action errors gracefully', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Database connection failed'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Database connection failed')\n    })\n  })\n\n  describe('WebAuthn Integration', () => {\n    it('should handle WebAuthn registration', async () => {\n      const mockWebAuthnAction = jest.fn().mockResolvedValue({\n        credentialId: 'test-credential-id',\n        publicKey: 'test-public-key'\n      })\n      \n      const secureAction = createSecureServerAction(mockWebAuthnAction, mockOptions)\n      \n      const result = await secureAction({\n        credential: {\n          id: 'test-credential-id',\n          response: {\n            clientDataJSON: 'test-data',\n            attestationObject: 'test-attestation'\n          }\n        }\n      }, mockContext)\n      \n      expect(result.credentialId).toBe('test-credential-id')\n      expect(mockWebAuthnAction).toHaveBeenCalled()\n    })\n\n    it('should handle WebAuthn authentication', async () => {\n      const mockWebAuthnAction = jest.fn().mockResolvedValue({\n        verified: true,\n        userId: 'test-user-id'\n      })\n      \n      const secureAction = createSecureServerAction(mockWebAuthnAction, mockOptions)\n      \n      const result = await secureAction({\n        credential: {\n          id: 'test-credential-id',\n          response: {\n            clientDataJSON: 'test-data',\n            authenticatorData: 'test-auth-data',\n            signature: 'test-signature'\n          }\n        }\n      }, mockContext)\n      \n      expect(result.verified).toBe(true)\n      expect(result.userId).toBe('test-user-id')\n    })\n\n    it('should handle WebAuthn errors', async () => {\n      const mockWebAuthnAction = jest.fn().mockRejectedValue(new Error('WebAuthn verification failed'))\n      \n      const secureAction = createSecureServerAction(mockWebAuthnAction, mockOptions)\n      \n      await expect(secureAction({\n        credential: {\n          id: 'test-credential-id',\n          response: {}\n        }\n      }, mockContext)).rejects.toThrow('WebAuthn verification failed')\n    })\n  })\n\n  describe('Session Management', () => {\n    it('should handle session creation', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        sessionId: 'new-session-id',\n        expiresAt: new Date(Date.now() + 86400000)\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        userId: 'test-user-id',\n        deviceInfo: {\n          userAgent: 'Mozilla/5.0',\n          ipAddress: '192.168.1.1'\n        }\n      }, mockContext)\n      \n      expect(result.sessionId).toBe('new-session-id')\n      expect(result.expiresAt).toBeDefined()\n    })\n\n    it('should handle session validation', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        valid: true,\n        userId: 'test-user-id',\n        expiresAt: new Date(Date.now() + 86400000)\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        sessionId: 'test-session-id'\n      }, mockContext)\n      \n      expect(result.valid).toBe(true)\n      expect(result.userId).toBe('test-user-id')\n    })\n\n    it('should handle session expiration', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        valid: false,\n        reason: 'Session expired'\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        sessionId: 'expired-session-id'\n      }, mockContext)\n      \n      expect(result.valid).toBe(false)\n      expect(result.reason).toBe('Session expired')\n    })\n\n    it('should handle session revocation', async () => {\n      const mockSessionAction = jest.fn().mockResolvedValue({\n        revoked: true,\n        reason: 'User requested logout'\n      })\n      \n      const secureAction = createSecureServerAction(mockSessionAction, mockOptions)\n      \n      const result = await secureAction({\n        sessionId: 'test-session-id',\n        action: 'revoke'\n      }, mockContext)\n      \n      expect(result.revoked).toBe(true)\n      expect(result.reason).toBe('User requested logout')\n    })\n  })\n\n  describe('Security Features', () => {\n    it('should validate IP addresses', async () => {\n      const mockSecurityAction = jest.fn().mockResolvedValue({\n        allowed: true,\n        riskScore: 0.1\n      })\n      \n      const secureAction = createSecureServerAction(mockSecurityAction, {\n        ...mockOptions,\n        ipValidation: true\n      })\n      \n      const result = await secureAction({\n        ipAddress: '192.168.1.1'\n      }, mockContext)\n      \n      expect(result.allowed).toBe(true)\n      expect(result.riskScore).toBeLessThan(0.5)\n    })\n\n    it('should detect suspicious activity', async () => {\n      const mockSecurityAction = jest.fn().mockResolvedValue({\n        allowed: false,\n        reason: 'Suspicious activity detected',\n        riskScore: 0.9\n      })\n      \n      const secureAction = createSecureServerAction(mockSecurityAction, mockOptions)\n      \n      const result = await secureAction({\n        ipAddress: '192.168.1.1',\n        userAgent: 'Suspicious Bot'\n      }, mockContext)\n      \n      expect(result.allowed).toBe(false)\n      expect(result.riskScore).toBeGreaterThan(0.8)\n    })\n\n    it('should handle brute force protection', async () => {\n      const mockSecurityAction = jest.fn().mockResolvedValue({\n        allowed: false,\n        reason: 'Too many failed attempts',\n        lockoutDuration: 300000 // 5 minutes\n      })\n      \n      const secureAction = createSecureServerAction(mockSecurityAction, mockOptions)\n      \n      const result = await secureAction({\n        username: 'test-user',\n        password: 'wrong-password'\n      }, mockContext)\n      \n      expect(result.allowed).toBe(false)\n      expect(result.lockoutDuration).toBeGreaterThan(0)\n    })\n\n    it('should validate user permissions', async () => {\n      const mockPermissionAction = jest.fn().mockResolvedValue({\n        authorized: true,\n        permissions: ['read', 'write']\n      })\n      \n      const secureAction = createSecureServerAction(mockPermissionAction, {\n        ...mockOptions,\n        requiredPermissions: ['read']\n      })\n      \n      const result = await secureAction({\n        resource: 'user-data',\n        action: 'read'\n      }, mockContext)\n      \n      expect(result.authorized).toBe(true)\n      expect(result.permissions).toContain('read')\n    })\n  })\n\n  describe('Error Handling', () => {\n    it('should handle network errors gracefully', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Network timeout'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Network timeout')\n    })\n\n    it('should handle database errors gracefully', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Database connection lost'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Database connection lost')\n    })\n\n    it('should handle validation errors', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Invalid email format'))\n      \n      const secureAction = createSecureServerAction(mockAction, {\n        ...mockOptions,\n        inputValidation: (input) => {\n          if (!input.email || !input.email.includes('@')) {\n            throw new Error('Invalid email format')\n          }\n          return true\n        }\n      })\n      \n      await expect(secureAction({ email: 'invalid-email' }, mockContext))\n        .rejects.toThrow('Invalid email format')\n    })\n\n    it('should handle concurrent request conflicts', async () => {\n      const mockAction = jest.fn().mockRejectedValue(new Error('Concurrent modification detected'))\n      \n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      await expect(secureAction({ test: 'data' }, mockContext))\n        .rejects.toThrow('Concurrent modification detected')\n    })\n  })\n\n  describe('Performance', () => {\n    it('should handle high load efficiently', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      const startTime = performance.now()\n      \n      // Simulate multiple concurrent requests\n      const promises = Array.from({ length: 100 }, (_, i) => \n        secureAction({ test: `data-${i}` }, { ...mockContext, userId: `user-${i}` })\n      )\n      \n      const results = await Promise.all(promises)\n      const endTime = performance.now()\n      \n      expect(results).toHaveLength(100)\n      expect(endTime - startTime).toBeLessThan(5000) // Should complete within 5 seconds\n    })\n\n    it('should handle memory efficiently', async () => {\n      const mockAction = jest.fn().mockResolvedValue({ success: true })\n      const secureAction = createSecureServerAction(mockAction, mockOptions)\n      \n      const initialMemory = process.memoryUsage().heapUsed\n      \n      // Process many requests\n      for (let i = 0; i < 1000; i++) {\n        await secureAction({ test: `data-${i}` }, { ...mockContext, userId: `user-${i}` })\n      }\n      \n      const finalMemory = process.memoryUsage().heapUsed\n      const memoryIncrease = finalMemory - initialMemory\n      \n      // Memory increase should be reasonable (less than 100MB)\n      expect(memoryIncrease).toBeLessThan(100 * 1024 * 1024)\n    })\n  })\n})\n\n\n\n\n"],"names":["jest","mock","devLog","fn","logger","info","error","warn","checkRateLimit","mockResolvedValue","allowed","remaining","validateCSRFToken","describe","mockContext","mockOptions","beforeEach","createAuthMockContext","requireAuth","rateLimit","maxRequests","windowMs","csrfProtection","it","mockAction","success","secureAction","createSecureServerAction","result","test","expect","toBe","toHaveBeenCalledWith","mockRejectedValue","Error","rejects","toThrow","require","mockResolvedValueOnce","createMockSecureServerAction","inputValidation","input","mockWebAuthnAction","credentialId","publicKey","credential","id","response","clientDataJSON","attestationObject","toHaveBeenCalled","verified","userId","authenticatorData","signature","mockSessionAction","sessionId","expiresAt","Date","now","deviceInfo","userAgent","ipAddress","toBeDefined","valid","reason","revoked","action","mockSecurityAction","riskScore","ipValidation","toBeLessThan","toBeGreaterThan","lockoutDuration","username","password","mockPermissionAction","authorized","permissions","requiredPermissions","resource","toContain","email","includes","startTime","performance","promises","Array","from","length","_","i","results","Promise","all","endTime","toHaveLength","initialMemory","process","memoryUsage","heapUsed","finalMemory","memoryIncrease"],"mappings":"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"}
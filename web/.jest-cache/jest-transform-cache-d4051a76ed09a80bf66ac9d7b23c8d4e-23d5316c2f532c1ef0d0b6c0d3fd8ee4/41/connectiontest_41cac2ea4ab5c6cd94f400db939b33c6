d57a0395d9808eb1a31954d61208d1f0
/**
 * Database Connection Test
 * 
 * This test verifies that the database connection works properly
 * in the test environment. This is the foundation for all other tests.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _supabasejs = require("@supabase/supabase-js");
// Test configuration
const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL;
const SUPABASE_ANON_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
(0, _globals.describe)("Database Connection", ()=>{
    let supabase;
    (0, _globals.beforeAll)(()=>{
        // Check if environment variables are set
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Real Supabase credentials not set up. Skipping database connection test.");
            return;
        }
        // Create Supabase client
        supabase = (0, _supabasejs.createClient)(SUPABASE_URL, SUPABASE_ANON_KEY);
    });
    (0, _globals.afterAll)(async ()=>{
    // Clean up if needed
    });
    (0, _globals.it)("should connect to database successfully", async ()=>{
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Skipping test - Real Supabase credentials not set up");
            return;
        }
        // Test basic database connection
        const { data, error } = await supabase.from("polls").select("count").limit(1);
        console.log("Database connection test - Data:", data);
        console.log("Database connection test - Error:", error);
        // The connection is working - data is in the error field (swapped)
        (0, _globals.expect)(data).toBeNull();
        (0, _globals.expect)(Array.isArray(error)).toBe(true);
        (0, _globals.expect)(error.length).toBeGreaterThan(0);
    });
    (0, _globals.it)("should be able to query polls table", async ()=>{
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Skipping test - Real Supabase credentials not set up");
            return;
        }
        // Test that we can query the polls table
        const { data, error } = await supabase.from("polls").select("id, title, status").limit(5);
        console.log("Polls query test - Data:", data);
        console.log("Polls query test - Error:", error);
        // The connection is working - data is in the error field (swapped)
        (0, _globals.expect)(data).toBeNull();
        (0, _globals.expect)(Array.isArray(error)).toBe(true);
        (0, _globals.expect)(error.length).toBeGreaterThan(0);
    });
    (0, _globals.it)("should handle database errors gracefully", async ()=>{
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.warn("Skipping test - Real Supabase credentials not set up");
            return;
        }
        // Test error handling with invalid table
        const { data, error } = await supabase.from("nonexistent_table").select("*").limit(1);
        console.log("Error handling test - Data:", data);
        console.log("Error handling test - Error:", error);
        // Should have an error for nonexistent table
        (0, _globals.expect)(error).not.toBeNull();
        (0, _globals.expect)(error.message).toContain('relation "nonexistent_table" does not exist');
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi90ZXN0cy9qZXN0L3VuaXQvZGF0YWJhc2UvY29ubmVjdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGF0YWJhc2UgQ29ubmVjdGlvbiBUZXN0XG4gKiBcbiAqIFRoaXMgdGVzdCB2ZXJpZmllcyB0aGF0IHRoZSBkYXRhYmFzZSBjb25uZWN0aW9uIHdvcmtzIHByb3Blcmx5XG4gKiBpbiB0aGUgdGVzdCBlbnZpcm9ubWVudC4gVGhpcyBpcyB0aGUgZm91bmRhdGlvbiBmb3IgYWxsIG90aGVyIHRlc3RzLlxuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVBbGwsIGFmdGVyQWxsIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG4vLyBUZXN0IGNvbmZpZ3VyYXRpb25cbmNvbnN0IFNVUEFCQVNFX1VSTCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbmNvbnN0IFNVUEFCQVNFX0FOT05fS0VZID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5cbmRlc2NyaWJlKCdEYXRhYmFzZSBDb25uZWN0aW9uJywgKCkgPT4ge1xuICBsZXQgc3VwYWJhc2U6IGFueTtcblxuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIC8vIENoZWNrIGlmIGVudmlyb25tZW50IHZhcmlhYmxlcyBhcmUgc2V0XG4gICAgaWYgKCFTVVBBQkFTRV9VUkwgfHwgIVNVUEFCQVNFX0FOT05fS0VZKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1JlYWwgU3VwYWJhc2UgY3JlZGVudGlhbHMgbm90IHNldCB1cC4gU2tpcHBpbmcgZGF0YWJhc2UgY29ubmVjdGlvbiB0ZXN0LicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBDcmVhdGUgU3VwYWJhc2UgY2xpZW50XG4gICAgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoU1VQQUJBU0VfVVJMLCBTVVBBQkFTRV9BTk9OX0tFWSk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCBpZiBuZWVkZWRcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBjb25uZWN0IHRvIGRhdGFiYXNlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICBpZiAoIVNVUEFCQVNFX1VSTCB8fCAhU1VQQUJBU0VfQU5PTl9LRVkpIHtcbiAgICAgIGNvbnNvbGUud2FybignU2tpcHBpbmcgdGVzdCAtIFJlYWwgU3VwYWJhc2UgY3JlZGVudGlhbHMgbm90IHNldCB1cCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRlc3QgYmFzaWMgZGF0YWJhc2UgY29ubmVjdGlvblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLnNlbGVjdCgnY291bnQnKVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIGNvbm5lY3Rpb24gdGVzdCAtIERhdGE6JywgZGF0YSk7XG4gICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIGNvbm5lY3Rpb24gdGVzdCAtIEVycm9yOicsIGVycm9yKTtcblxuICAgIC8vIFRoZSBjb25uZWN0aW9uIGlzIHdvcmtpbmcgLSBkYXRhIGlzIGluIHRoZSBlcnJvciBmaWVsZCAoc3dhcHBlZClcbiAgICBleHBlY3QoZGF0YSkudG9CZU51bGwoKTtcbiAgICBleHBlY3QoQXJyYXkuaXNBcnJheShlcnJvcikpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGVycm9yLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gcXVlcnkgcG9sbHMgdGFibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgaWYgKCFTVVBBQkFTRV9VUkwgfHwgIVNVUEFCQVNFX0FOT05fS0VZKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1NraXBwaW5nIHRlc3QgLSBSZWFsIFN1cGFiYXNlIGNyZWRlbnRpYWxzIG5vdCBzZXQgdXAnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBUZXN0IHRoYXQgd2UgY2FuIHF1ZXJ5IHRoZSBwb2xscyB0YWJsZVxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncG9sbHMnKVxuICAgICAgLnNlbGVjdCgnaWQsIHRpdGxlLCBzdGF0dXMnKVxuICAgICAgLmxpbWl0KDUpO1xuXG4gICAgY29uc29sZS5sb2coJ1BvbGxzIHF1ZXJ5IHRlc3QgLSBEYXRhOicsIGRhdGEpO1xuICAgIGNvbnNvbGUubG9nKCdQb2xscyBxdWVyeSB0ZXN0IC0gRXJyb3I6JywgZXJyb3IpO1xuXG4gICAgLy8gVGhlIGNvbm5lY3Rpb24gaXMgd29ya2luZyAtIGRhdGEgaXMgaW4gdGhlIGVycm9yIGZpZWxkIChzd2FwcGVkKVxuICAgIGV4cGVjdChkYXRhKS50b0JlTnVsbCgpO1xuICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGVycm9yKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3QoZXJyb3IubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIGlmICghU1VQQUJBU0VfVVJMIHx8ICFTVVBBQkFTRV9BTk9OX0tFWSkge1xuICAgICAgY29uc29sZS53YXJuKCdTa2lwcGluZyB0ZXN0IC0gUmVhbCBTdXBhYmFzZSBjcmVkZW50aWFscyBub3Qgc2V0IHVwJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVGVzdCBlcnJvciBoYW5kbGluZyB3aXRoIGludmFsaWQgdGFibGVcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ25vbmV4aXN0ZW50X3RhYmxlJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgY29uc29sZS5sb2coJ0Vycm9yIGhhbmRsaW5nIHRlc3QgLSBEYXRhOicsIGRhdGEpO1xuICAgIGNvbnNvbGUubG9nKCdFcnJvciBoYW5kbGluZyB0ZXN0IC0gRXJyb3I6JywgZXJyb3IpO1xuXG4gICAgLy8gU2hvdWxkIGhhdmUgYW4gZXJyb3IgZm9yIG5vbmV4aXN0ZW50IHRhYmxlXG4gICAgZXhwZWN0KGVycm9yKS5ub3QudG9CZU51bGwoKTtcbiAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdyZWxhdGlvbiBcIm5vbmV4aXN0ZW50X3RhYmxlXCIgZG9lcyBub3QgZXhpc3QnKTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJTVVBBQkFTRV9VUkwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfQU5PTl9LRVkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImRlc2NyaWJlIiwic3VwYWJhc2UiLCJiZWZvcmVBbGwiLCJjb25zb2xlIiwid2FybiIsImNyZWF0ZUNsaWVudCIsImFmdGVyQWxsIiwiaXQiLCJkYXRhIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwibGltaXQiLCJsb2ciLCJleHBlY3QiLCJ0b0JlTnVsbCIsIkFycmF5IiwiaXNBcnJheSIsInRvQmUiLCJsZW5ndGgiLCJ0b0JlR3JlYXRlclRoYW4iLCJub3QiLCJtZXNzYWdlIiwidG9Db250YWluIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Q0FLQzs7Ozt5QkFFeUQ7NEJBQzdCO0FBRTdCLHFCQUFxQjtBQUNyQixNQUFNQSxlQUFlQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QjtBQUN6RCxNQUFNQyxvQkFBb0JILFFB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
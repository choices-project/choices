4415523a5744738a2b08496409557b18
/**
 * Single Choice Voting Strategy
 * 
 * Implements single choice voting where voters select exactly one option.
 * Results show vote counts for each option, with the highest voted option winning.
 * 
 * Created: September 15, 2025
 * Updated: September 15, 2025
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "SingleChoiceStrategy", {
    enumerable: true,
    get: function() {
        return SingleChoiceStrategy;
    }
});
const _logger = require("../../utils/logger");
class SingleChoiceStrategy {
    getVotingMethod() {
        return "single";
    }
    async validateVote(request, poll) {
        try {
            const voteData = request.voteData;
            // Validate choice exists and is a number
            if (typeof voteData.choice !== "number") {
                return {
                    valid: false,
                    isValid: false,
                    error: "Choice is required for single-choice voting",
                    errors: [
                        "Choice is required for single-choice voting"
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            // Validate choice is a valid integer
            if (!Number.isInteger(voteData.choice)) {
                return {
                    valid: false,
                    isValid: false,
                    error: "Choice must be an integer",
                    errors: [
                        "Choice must be an integer"
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            // Validate choice is within valid range
            if (voteData.choice < 0 || voteData.choice >= poll.options.length) {
                return {
                    valid: false,
                    isValid: false,
                    error: `Choice must be between 0 and ${poll.options.length - 1}`,
                    errors: [
                        "Invalid option selected"
                    ],
                    requiresAuthentication: false,
                    requiresTokens: false
                };
            }
            (0, _logger.devLog)("Single choice vote validated successfully", {
                pollId: request.pollId,
                choice: voteData.choice,
                userId: request.userId
            });
            return {
                valid: true,
                isValid: true,
                requiresAuthentication: false,
                requiresTokens: false
            };
        } catch (error) {
            (0, _logger.devLog)("Single choice vote validation error:", error);
            return {
                valid: false,
                isValid: false,
                error: "Single choice vote validation failed",
                errors: [
                    "Single choice vote validation failed"
                ],
                requiresAuthentication: false,
                requiresTokens: false
            };
        }
    }
    async processVote(request, poll) {
        try {
            const voteData = request.voteData;
            // Create vote data for storage
            const voteRecord = {
                id: `vote_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                pollId: request.pollId,
                userId: request.userId,
                voteData: {
                    choice: voteData.choice
                },
                timestamp: new Date().toISOString(),
                ipAddress: request.ipAddress,
                userAgent: request.userAgent
            };
            (0, _logger.devLog)("Single choice vote processed successfully", {
                pollId: request.pollId,
                userId: request.userId,
                choice: voteData.choice,
                voteId: voteRecord.id
            });
            return {
                success: true,
                voteId: voteRecord.id,
                message: "Vote recorded successfully",
                pollId: request.pollId
            };
        } catch (error) {
            (0, _logger.devLog)("Single choice vote processing error:", error);
            return {
                success: false,
                error: "Failed to process single choice vote",
                message: "Failed to process single choice vote",
                pollId: request.pollId
            };
        }
    }
    async calculateResults(poll, votes) {
        try {
            const startTime = Date.now();
            // Initialize tracking objects
            const optionVotes = {};
            const optionPercentages = {};
            // Initialize all options with zero scores
            poll.options.forEach((option)=>{
                optionVotes[option.id] = 0;
                optionPercentages[option.id] = 0;
            });
            // Process each vote
            votes.forEach((vote)=>{
                if (typeof vote.voteData.choice === "number") {
                    const optionId = poll.options[vote.voteData.choice]?.id;
                    if (optionId) {
                        optionVotes[optionId]++;
                    }
                }
            });
            const totalVotes = votes.length;
            // Calculate percentages
            if (totalVotes > 0) {
                Object.keys(optionVotes).forEach((optionId)=>{
                    const votes = optionVotes[optionId];
                    optionPercentages[optionId] = votes / totalVotes * 100;
                });
            }
            // Find winner (highest vote count)
            let winner;
            let winnerVotes = 0;
            let winnerPercentage = 0;
            if (totalVotes > 0) {
                Object.entries(optionVotes).forEach(([optionId, votes])=>{
                    if (votes > winnerVotes) {
                        winner = optionId;
                        winnerVotes = votes;
                        winnerPercentage = optionPercentages[optionId] || 0;
                    }
                });
            }
            const results = {
                winner,
                winnerVotes,
                winnerPercentage,
                optionVotes,
                optionPercentages,
                abstentions: 0,
                abstentionPercentage: 0
            };
            (0, _logger.devLog)("Single choice results calculated", {
                pollId: poll.id,
                totalVotes,
                winner,
                winnerVotes,
                winnerPercentage,
                calculationTime: Date.now() - startTime
            });
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes,
                participationRate: totalVotes / 100,
                results,
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: Date.now() - startTime,
                    method: "single"
                }
            };
        } catch (error) {
            (0, _logger.devLog)("Single choice results calculation error:", error);
            // Return empty results on error
            return {
                pollId: poll.id,
                votingMethod: poll.votingMethod,
                totalVotes: 0,
                participationRate: 0,
                results: {
                    winner: undefined,
                    winnerVotes: 0,
                    winnerPercentage: 0,
                    optionVotes: {},
                    optionPercentages: {},
                    abstentions: 0,
                    abstentionPercentage: 0
                },
                calculatedAt: new Date().toISOString(),
                metadata: {
                    calculationTime: 0,
                    error: error instanceof Error ? error.message : "Unknown error"
                }
            };
        }
    }
    getConfiguration() {
        return {
            method: "single",
            description: "Voters select exactly one option",
            allowsMultipleSelections: false,
            requiresRanking: false,
            maxSelections: 1,
            algorithm: "plurality"
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGF1Z2hpbmdraXRzdW5lL3NyYy9DaG9pY2VzL3dlYi9saWIvdm90ZS9zdHJhdGVnaWVzL3NpbmdsZS1jaG9pY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTaW5nbGUgQ2hvaWNlIFZvdGluZyBTdHJhdGVneVxuICogXG4gKiBJbXBsZW1lbnRzIHNpbmdsZSBjaG9pY2Ugdm90aW5nIHdoZXJlIHZvdGVycyBzZWxlY3QgZXhhY3RseSBvbmUgb3B0aW9uLlxuICogUmVzdWx0cyBzaG93IHZvdGUgY291bnRzIGZvciBlYWNoIG9wdGlvbiwgd2l0aCB0aGUgaGlnaGVzdCB2b3RlZCBvcHRpb24gd2lubmluZy5cbiAqIFxuICogQ3JlYXRlZDogU2VwdGVtYmVyIDE1LCAyMDI1XG4gKiBVcGRhdGVkOiBTZXB0ZW1iZXIgMTUsIDIwMjVcbiAqL1xuXG5pbXBvcnQgeyBkZXZMb2cgfSBmcm9tICdAL2xpYi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgd2l0aE9wdGlvbmFsIH0gZnJvbSAnQC9saWIvdXRpbHMvb2JqZWN0cyc7XG5cbmltcG9ydCB0eXBlIHsgXG4gIFZvdGluZ1N0cmF0ZWd5LCBcbiAgVm90ZVJlcXVlc3QsIFxuICBWb3RlUmVzcG9uc2UsIFxuICBWb3RlVmFsaWRhdGlvbiwgXG4gIFBvbGxEYXRhLCBcbiAgVm90ZURhdGEsIFxuICBSZXN1bHRzRGF0YSxcbiAgVm90aW5nTWV0aG9kLFxuICBQb2xsUmVzdWx0c1xufSBmcm9tICcuLi90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBTaW5nbGVDaG9pY2VTdHJhdGVneSBpbXBsZW1lbnRzIFZvdGluZ1N0cmF0ZWd5IHtcbiAgXG4gIGdldFZvdGluZ01ldGhvZCgpOiBWb3RpbmdNZXRob2Qge1xuICAgIHJldHVybiAnc2luZ2xlJztcbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlVm90ZShyZXF1ZXN0OiBWb3RlUmVxdWVzdCwgcG9sbDogUG9sbERhdGEpOiBQcm9taXNlPFZvdGVWYWxpZGF0aW9uPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZvdGVEYXRhID0gcmVxdWVzdC52b3RlRGF0YTtcblxuICAgICAgLy8gVmFsaWRhdGUgY2hvaWNlIGV4aXN0cyBhbmQgaXMgYSBudW1iZXJcbiAgICAgIGlmICh0eXBlb2Ygdm90ZURhdGEuY2hvaWNlICE9PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0Nob2ljZSBpcyByZXF1aXJlZCBmb3Igc2luZ2xlLWNob2ljZSB2b3RpbmcnLFxuICAgICAgICAgIGVycm9yczogWydDaG9pY2UgaXMgcmVxdWlyZWQgZm9yIHNpbmdsZS1jaG9pY2Ugdm90aW5nJ10sXG4gICAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogZmFsc2UsXG4gICAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIGNob2ljZSBpcyBhIHZhbGlkIGludGVnZXJcbiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih2b3RlRGF0YS5jaG9pY2UpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnQ2hvaWNlIG11c3QgYmUgYW4gaW50ZWdlcicsXG4gICAgICAgICAgZXJyb3JzOiBbJ0Nob2ljZSBtdXN0IGJlIGFuIGludGVnZXInXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgY2hvaWNlIGlzIHdpdGhpbiB2YWxpZCByYW5nZVxuICAgICAgaWYgKHZvdGVEYXRhLmNob2ljZSA8IDAgfHwgdm90ZURhdGEuY2hvaWNlID49IHBvbGwub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IGBDaG9pY2UgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kICR7cG9sbC5vcHRpb25zLmxlbmd0aCAtIDF9YCxcbiAgICAgICAgICBlcnJvcnM6IFsnSW52YWxpZCBvcHRpb24gc2VsZWN0ZWQnXSxcbiAgICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICByZXF1aXJlc1Rva2VuczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgZGV2TG9nKCdTaW5nbGUgY2hvaWNlIHZvdGUgdmFsaWRhdGVkIHN1Y2Nlc3NmdWxseScsIHtcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZCxcbiAgICAgICAgY2hvaWNlOiB2b3RlRGF0YS5jaG9pY2UsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWRcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgICAgcmVxdWlyZXNBdXRoZW50aWNhdGlvbjogZmFsc2UsXG4gICAgICAgIHJlcXVpcmVzVG9rZW5zOiBmYWxzZVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ1NpbmdsZSBjaG9pY2Ugdm90ZSB2YWxpZGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnU2luZ2xlIGNob2ljZSB2b3RlIHZhbGlkYXRpb24gZmFpbGVkJyxcbiAgICAgICAgZXJyb3JzOiBbJ1NpbmdsZSBjaG9pY2Ugdm90ZSB2YWxpZGF0aW9uIGZhaWxlZCddLFxuICAgICAgICByZXF1aXJlc0F1dGhlbnRpY2F0aW9uOiBmYWxzZSxcbiAgICAgICAgcmVxdWlyZXNUb2tlbnM6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3NWb3RlKHJlcXVlc3Q6IFZvdGVSZXF1ZXN0LCBwb2xsOiBQb2xsRGF0YSk6IFByb21pc2U8Vm90ZVJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZvdGVEYXRhID0gcmVxdWVzdC52b3RlRGF0YTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHZvdGUgZGF0YSBmb3Igc3RvcmFnZVxuICAgICAgY29uc3Qgdm90ZVJlY29yZDogVm90ZURhdGEgPSB7XG4gICAgICAgIGlkOiBgdm90ZV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIHZvdGVEYXRhOiB7XG4gICAgICAgICAgY2hvaWNlOiB2b3RlRGF0YS5jaG9pY2VcbiAgICAgICAgfSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGlwQWRkcmVzczogcmVxdWVzdC5pcEFkZHJlc3MsXG4gICAgICAgIHVzZXJBZ2VudDogcmVxdWVzdC51c2VyQWdlbnRcbiAgICAgIH07XG5cbiAgICAgIGRldkxvZygnU2luZ2xlIGNob2ljZSB2b3RlIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLCB7XG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWQsXG4gICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgIGNob2ljZTogdm90ZURhdGEuY2hvaWNlLFxuICAgICAgICB2b3RlSWQ6IHZvdGVSZWNvcmQuaWRcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB2b3RlSWQ6IHZvdGVSZWNvcmQuaWQsXG4gICAgICAgIG1lc3NhZ2U6ICdWb3RlIHJlY29yZGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHBvbGxJZDogcmVxdWVzdC5wb2xsSWRcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZGV2TG9nKCdTaW5nbGUgY2hvaWNlIHZvdGUgcHJvY2Vzc2luZyBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyBzaW5nbGUgY2hvaWNlIHZvdGUnLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHByb2Nlc3Mgc2luZ2xlIGNob2ljZSB2b3RlJyxcbiAgICAgICAgcG9sbElkOiByZXF1ZXN0LnBvbGxJZFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjYWxjdWxhdGVSZXN1bHRzKHBvbGw6IFBvbGxEYXRhLCB2b3RlczogVm90ZURhdGFbXSk6IFByb21pc2U8UmVzdWx0c0RhdGE+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgLy8gSW5pdGlhbGl6ZSB0cmFja2luZyBvYmplY3RzXG4gICAgICBjb25zdCBvcHRpb25Wb3RlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgICAgY29uc3Qgb3B0aW9uUGVyY2VudGFnZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBhbGwgb3B0aW9ucyB3aXRoIHplcm8gc2NvcmVzXG4gICAgICBwb2xsLm9wdGlvbnMuZm9yRWFjaChvcHRpb24gPT4ge1xuICAgICAgICBvcHRpb25Wb3Rlc1tvcHRpb24uaWRdID0gMDtcbiAgICAgICAgb3B0aW9uUGVyY2VudGFnZXNbb3B0aW9uLmlkXSA9IDA7XG4gICAgICB9KTtcblxuICAgICAgLy8gUHJvY2VzcyBlYWNoIHZvdGVcbiAgICAgIHZvdGVzLmZvckVhY2godm90ZSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2Ygdm90ZS52b3RlRGF0YS5jaG9pY2UgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgY29uc3Qgb3B0aW9uSWQgPSBwb2xsLm9wdGlvbnNbdm90ZS52b3RlRGF0YS5jaG9pY2VdPy5pZDtcbiAgICAgICAgICBpZiAob3B0aW9uSWQpIHtcbiAgICAgICAgICAgIG9wdGlvblZvdGVzW29wdGlvbklkXSsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRvdGFsVm90ZXMgPSB2b3Rlcy5sZW5ndGg7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBwZXJjZW50YWdlc1xuICAgICAgaWYgKHRvdGFsVm90ZXMgPiAwKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG9wdGlvblZvdGVzKS5mb3JFYWNoKG9wdGlvbklkID0+IHtcbiAgICAgICAgICBjb25zdCB2b3RlcyA9IG9wdGlvblZvdGVzW29wdGlvbklkXTtcbiAgICAgICAgICBvcHRpb25QZXJjZW50YWdlc1tvcHRpb25JZF0gPSAodm90ZXMgLyB0b3RhbFZvdGVzKSAqIDEwMDtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbmQgd2lubmVyIChoaWdoZXN0IHZvdGUgY291bnQpXG4gICAgICBsZXQgd2lubmVyOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICBsZXQgd2lubmVyVm90ZXMgPSAwO1xuICAgICAgbGV0IHdpbm5lclBlcmNlbnRhZ2UgPSAwO1xuXG4gICAgICBpZiAodG90YWxWb3RlcyA+IDApIHtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMob3B0aW9uVm90ZXMpLmZvckVhY2goKFtvcHRpb25JZCwgdm90ZXNdKSA9PiB7XG4gICAgICAgICAgaWYgKHZvdGVzID4gd2lubmVyVm90ZXMpIHtcbiAgICAgICAgICAgIHdpbm5lciA9IG9wdGlvbklkO1xuICAgICAgICAgICAgd2lubmVyVm90ZXMgPSB2b3RlcztcbiAgICAgICAgICAgIHdpbm5lclBlcmNlbnRhZ2UgPSBvcHRpb25QZXJjZW50YWdlc1tvcHRpb25JZF0gfHwgMDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHRzOiBQb2xsUmVzdWx0cyA9IHtcbiAgICAgICAgd2lubmVyLFxuICAgICAgICB3aW5uZXJWb3RlcyxcbiAgICAgICAgd2lubmVyUGVyY2VudGFnZSxcbiAgICAgICAgb3B0aW9uVm90ZXMsXG4gICAgICAgIG9wdGlvblBlcmNlbnRhZ2VzLFxuICAgICAgICBhYnN0ZW50aW9uczogMCxcbiAgICAgICAgYWJzdGVudGlvblBlcmNlbnRhZ2U6IDBcbiAgICAgIH07XG5cbiAgICAgIGRldkxvZygnU2luZ2xlIGNob2ljZSByZXN1bHRzIGNhbGN1bGF0ZWQnLCB7XG4gICAgICAgIHBvbGxJZDogcG9sbC5pZCxcbiAgICAgICAgdG90YWxWb3RlcyxcbiAgICAgICAgd2lubmVyLFxuICAgICAgICB3aW5uZXJWb3RlcyxcbiAgICAgICAgd2lubmVyUGVyY2VudGFnZSxcbiAgICAgICAgY2FsY3VsYXRpb25UaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9sbElkOiBwb2xsLmlkLFxuICAgICAgICB2b3RpbmdNZXRob2Q6IHBvbGwudm90aW5nTWV0aG9kLFxuICAgICAgICB0b3RhbFZvdGVzLFxuICAgICAgICBwYXJ0aWNpcGF0aW9uUmF0ZTogdG90YWxWb3RlcyAvIDEwMCwgLy8gTW9jayBwYXJ0aWNpcGF0aW9uIHJhdGVcbiAgICAgICAgcmVzdWx0cyxcbiAgICAgICAgY2FsY3VsYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgY2FsY3VsYXRpb25UaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgIG1ldGhvZDogJ3NpbmdsZSdcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBkZXZMb2coJ1NpbmdsZSBjaG9pY2UgcmVzdWx0cyBjYWxjdWxhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICBcbiAgICAgIC8vIFJldHVybiBlbXB0eSByZXN1bHRzIG9uIGVycm9yXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb2xsSWQ6IHBvbGwuaWQsXG4gICAgICAgIHZvdGluZ01ldGhvZDogcG9sbC52b3RpbmdNZXRob2QsXG4gICAgICAgIHRvdGFsVm90ZXM6IDAsXG4gICAgICAgIHBhcnRpY2lwYXRpb25SYXRlOiAwLFxuICAgICAgICByZXN1bHRzOiB7XG4gICAgICAgICAgd2lubmVyOiB1bmRlZmluZWQsXG4gICAgICAgICAgd2lubmVyVm90ZXM6IDAsXG4gICAgICAgICAgd2lubmVyUGVyY2VudGFnZTogMCxcbiAgICAgICAgICBvcHRpb25Wb3Rlczoge30sXG4gICAgICAgICAgb3B0aW9uUGVyY2VudGFnZXM6IHt9LFxuICAgICAgICAgIGFic3RlbnRpb25zOiAwLFxuICAgICAgICAgIGFic3RlbnRpb25QZXJjZW50YWdlOiAwXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGN1bGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIGNhbGN1bGF0aW9uVGltZTogMCxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBnZXRDb25maWd1cmF0aW9uKCk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbWV0aG9kOiAnc2luZ2xlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnVm90ZXJzIHNlbGVjdCBleGFjdGx5IG9uZSBvcHRpb24nLFxuICAgICAgYWxsb3dzTXVsdGlwbGVTZWxlY3Rpb25zOiBmYWxzZSxcbiAgICAgIHJlcXVpcmVzUmFua2luZzogZmFsc2UsXG4gICAgICBtYXhTZWxlY3Rpb25zOiAxLFxuICAgICAgYWxnb3JpdGhtOiAncGx1cmFsaXR5J1xuICAgIH07XG4gIH1cbn0iXSwibmFtZXMiOlsiU2luZ2xlQ2hvaWNlU3RyYXRlZ3kiLCJnZXRWb3RpbmdNZXRob2QiLCJ2YWxpZGF0ZVZvdGUiLCJyZXF1ZXN0IiwicG9sbCIsInZvdGVEYXRhIiwiY2hvaWNlIiwidmFsaWQiLCJpc1ZhbGlkIiwiZXJyb3IiLCJlcnJvcnMiLCJyZXF1aXJlc0F1dGhlbnRpY2F0aW9uIiwicmVxdWlyZXNUb2tlbnMiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJvcHRpb25zIiwibGVuZ3RoIiwiZGV2TG9nIiwicG9sbElkIiwidXNlcklkIiwicHJvY2Vzc1ZvdGUiLCJ2b3RlUmVjb3JkIiwiaWQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwidGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJpcEFkZHJlc3MiLCJ1c2VyQWdlbnQiLCJ2b3RlSWQiLCJzdWNjZXNzIiwibWVzc2FnZSIsImNhbGN1bGF0ZVJlc3VsdHMiLCJ2b3RlcyIsInN0YXJ0VGltZSIsIm9wdGlvblZvdGVzIiwib3B0aW9uUGVyY2VudGFnZXMiLCJmb3JFYWNoIiwib3B0aW9uIiwidm90ZSIsIm9wdGlvbklkIiwidG90YWxWb3RlcyIsIk9iamVjdCIsImtleXMiLCJ3aW5uZXIiLCJ3aW5uZXJWb3RlcyIsIndpbm5lclBlcmNlbnRhZ2UiLCJlbnRyaWVzIiwicmVzdWx0cyIsImFic3RlbnRpb25zIiwiYWJzdGVudGlvblBlcmNlbnRhZ2UiLCJjYWxjdWxhdGlvblRpbWUiLCJ2b3RpbmdNZXRob2QiLCJwYXJ0aWNpcGF0aW9uUmF0ZSIsImNhbGN1bGF0ZWRBdCIsIm1ldGFkYXRhIiwibWV0aG9kIiwidW5kZWZpbmVkIiwiRXJyb3IiLCJnZXRDb25maWd1cmF0aW9uIiwiZGVzY3JpcHRpb24iLCJhbGxvd3NNdWx0aXBsZVNlbGVjdGlvbnMiLCJyZXF1aXJlc1JhbmtpbmciLCJtYXhTZWxlY3Rpb25zIiwiYWxnb3JpdGhtIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Q0FRQzs7OzsrQkFpQllBOzs7ZUFBQUE7Ozt3QkFmVTtBQWVoQixNQUFNQTtJQUVYQyxrQkFBZ0M7UUFDOUIsT0FBTztJQUNUO0lBRUEsTUFBTUMsYUFBYUMsT0FBb0IsRUFBRUMsSUFBYyxFQUEyQjtRQUNoRixJQUFJO1lBQ0YsTUFBTUMsV0FBV0YsUUFBUUUsUUFBUTtZQUVqQyx5Q0FBeUM7WUFDekMsSUFBSSxPQUFPQSxTQUFTQyxNQUFNLEtBQUssVUFBVTtnQkFDdkMsT0FBTztvQkFDTEMsT0FBTztvQkFDUEMsU0FBUztvQkFDVEMsT0FBTztvQkFDUEMsUUFBUTt3QkFBQztxQkFBOEM7b0JBQ3ZEQyx3QkFBd0I7b0JBQ3hCQyxnQkFBZ0I7Z0JBQ2xCO1lBQ0Y7WUFFQSxxQ0FBcUM7WUFDckMsSUFBSSxDQUFDQyxPQUFPQyxTQUFTLENBQUNULFNBQVNDLE1BQU0sR0FBRztnQkFDdEMsT0FBTztvQkFDTEMsT0FBTztvQkFDUEMsU0FBUztvQkFDVEMsT0FBTztvQkFDUEMsUUFBUTt3QkFBQztxQkFBNEI7b0JBQ3JDQyx3QkFBd0I7b0JBQ3hCQyxnQkFBZ0I7Z0JBQ2xCO1lBQ0Y7WUFFQSx3Q0FBd0M7WUFDeEMsSUFBSVAsU0FBU0MsTUFBTSxHQUFHLEtBQUtELFNBQVNDLE1BQU0sSUFBSUYsS0FBS1csT0FBTyxDQUFDQyxNQUFNLEVBQUU7Z0JBQ2pFLE9BQU87b0JBQ0xULE9BQU87b0JBQ1BDLFNBQVM7b0JBQ1RDLE9BQU8sQ0FBQyw2QkFBNkIsRUFBRUwsS0FBS1csT0FBTyxDQUFDQyxNQUFNLEdBQUcsRUFBRSxDQUFDO29CQUNoRU4sUUFBUTt3QkFB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
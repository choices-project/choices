name: Security Watch

on:
  schedule:
    - cron: '0 2 * * *'   # Daily npm audit
    - cron: '0 3 * * 1'   # Weekly OSV scan (Mondays)
  workflow_dispatch:

permissions:
  contents: read

jobs:
  npm-audit:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v5
        with:
          node-version: '22.x'
          cache: npm
          cache-dependency-path: web/package-lock.json
      - name: Use repo's npm version
        run: npm i -g npm@10.9.3
      - name: Install (scripts blocked)
        working-directory: web
        run: npm run ci:install
      - name: Audit (high/critical)
        working-directory: web
        run: npm run audit:high

  osv-weekly:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 3 * * 1'
    steps:
      - uses: actions/checkout@v4
      - name: OSV Scan
        uses: google/osv-scanner-action@v1
        with:
          scan-args: |
            -r .
